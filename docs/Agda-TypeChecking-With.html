<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Agda.TypeChecking.With</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">Agda</span><ul class="links" id="page-menu"><li><a href="src/Agda.TypeChecking.With.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Agda.TypeChecking.With</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:splitTelForWith">splitTelForWith</a> :: <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a> -&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)) -&gt; (<a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a>, <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a>, <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a>, <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a>, <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)))</li><li class="src short"><a href="#v:withFunctionType">withFunctionType</a> :: <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)) -&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a> -&gt; <a href="Agda-TypeChecking-Telescope.html#t:Boundary" title="Agda.TypeChecking.Telescope">Boundary</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a>, (<a href="Agda-Syntax-Common.html#t:Nat1" title="Agda.Syntax.Common">Nat1</a>, <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a>))</li><li class="src short"><a href="#v:countWithArgs">countWithArgs</a> :: (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Control-Monad.html#t:Functor" title="Control.Monad">Functor</a> f, <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> f) =&gt; f <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a> -&gt; <a href="Agda-Syntax-Common.html#t:Nat1" title="Agda.Syntax.Common">Nat1</a></li><li class="src short"><a href="#v:countWithPats">countWithPats</a> :: (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Control-Monad.html#t:Functor" title="Control.Monad">Functor</a> f, <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> f) =&gt; f (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)) -&gt; <a href="Agda-Syntax-Common.html#t:Nat1" title="Agda.Syntax.Common">Nat1</a></li><li class="src short"><a href="#v:withArguments">withArguments</a> :: <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)) -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>))</li><li class="src short"><a href="#v:buildWithFunction">buildWithFunction</a> :: [<a href="Agda-Syntax-Abstract-Name.html#t:Name" title="Agda.Syntax.Abstract.Name">Name</a>] -&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a> -&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>] -&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Substitution" title="Agda.Syntax.Internal">Substitution</a> -&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a> -&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a> -&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a> -&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> <a href="Agda-Syntax-Abstract.html#t:SpineClause" title="Agda.Syntax.Abstract">SpineClause</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> <a href="Agda-Syntax-Abstract.html#t:SpineClause" title="Agda.Syntax.Abstract">SpineClause</a>)</li><li class="src short"><a href="#v:stripWithClausePatterns">stripWithClausePatterns</a> :: [<a href="Agda-Syntax-Abstract-Name.html#t:Name" title="Agda.Syntax.Abstract.Name">Name</a>] -&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a> -&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>] -&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a> -&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a> -&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Abstract.html#t:Pattern" title="Agda.Syntax.Abstract">Pattern</a>] -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> ([<a href="Agda-Syntax-Abstract.html#t:ProblemEq" title="Agda.Syntax.Abstract">ProblemEq</a>], [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Abstract.html#t:Pattern" title="Agda.Syntax.Abstract">Pattern</a>])</li><li class="src short"><a href="#v:withDisplayForm">withDisplayForm</a> :: <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a> -&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a> -&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a> -&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>] -&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a> -&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> <a href="Agda-TypeChecking-Monad-Base.html#t:DisplayForm" title="Agda.TypeChecking.Monad.Base">DisplayForm</a></li><li class="src short"><a href="#v:patsToElims">patsToElims</a> :: [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>] -&gt; [<a href="Agda-Syntax-Internal-Elim.html#t:Elim-39-" title="Agda.Syntax.Internal.Elim">Elim'</a> <a href="Agda-TypeChecking-Monad-Base.html#t:DisplayTerm" title="Agda.TypeChecking.Monad.Base">DisplayTerm</a>]</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:splitTelForWith" class="def">splitTelForWith</a> <a href="src/Agda.TypeChecking.With.html#splitTelForWith" class="link">Source</a> <a href="#v:splitTelForWith" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p><strong><code class="inline-code">&#916;</code></strong>             context of types and with-arguments.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a></td><td class="doc"><p><strong><code class="inline-code">&#916; &#8866; t</code></strong>         type of rhs.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>))</td><td class="doc"><p><strong><code class="inline-code">&#916; &#8866; vs : as</code></strong>   with arguments and their types.
 Output:</p></td></tr><tr><td class="src">-&gt; (<a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a>, <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a>, <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a>, <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a>, <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)))</td><td class="doc"><p>(<strong><code class="inline-code">&#916;&#8321;</code></strong>,<strong><code class="inline-code">&#916;&#8322;</code></strong>,<strong><code class="inline-code">&#960;</code></strong>,<strong><code class="inline-code">t'</code></strong>,<strong><code class="inline-code">vtys'</code></strong>) where</p><dl><dt><code class="inline-code">&#916;&#8321;</code></dt><dd>part of context needed for with arguments and their types.</dd><dt><code class="inline-code">&#916;&#8322;</code></dt><dd>part of context not needed for with arguments and their types.</dd><dt><code class="inline-code">&#960;</code></dt><dd>permutation from &#916; to &#916;&#8321;&#916;&#8322; as returned by <code><a href="Agda-TypeChecking-Telescope.html#v:splitTelescope" title="Agda.TypeChecking.Telescope">splitTelescope</a></code>.</dd><dt><code class="inline-code">&#916;&#8321;&#916;&#8322; &#8866; t'</code></dt><dd>type of rhs under <code class="inline-code">&#960;</code></dd><dt><code class="inline-code">&#916;&#8321; &#8866; vtys'</code></dt><dd>with-arguments and their types under <code class="inline-code">&#960;</code>.</dd></dl></td></tr></table></div><div class="doc"><p>Split pattern variables according to with-expressions.</p></div></div><div class="top"><p class="src"><a id="v:withFunctionType" class="def">withFunctionType</a> <a href="src/Agda.TypeChecking.With.html#withFunctionType" class="link">Source</a> <a href="#v:withFunctionType" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p><code class="inline-code">&#916;&#8321;</code>                        context for types of with-expressions.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>))</td><td class="doc"><p><code class="inline-code">&#916;&#8321;,&#916;&#8322; &#8866; vs : raise &#916;&#8322; as</code>  with and rewrite-expressions and their type.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p><code class="inline-code">&#916;&#8321; &#8866; &#916;&#8322;</code>                   context extension to type with-expressions.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a></td><td class="doc"><p><code class="inline-code">&#916;&#8321;,&#916;&#8322; &#8866; b</code>                 type of rhs.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-TypeChecking-Telescope.html#t:Boundary" title="Agda.TypeChecking.Telescope">Boundary</a></td><td class="doc"><p><code class="inline-code">&#916;&#8321;,&#916;&#8322; &#8866; [(i,(u0,u1))] : b</code> boundary of rhs.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a>, (<a href="Agda-Syntax-Common.html#t:Nat1" title="Agda.Syntax.Common">Nat1</a>, <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a>))</td><td class="doc"><p><code class="inline-code">&#916;&#8321; &#8594; wtel &#8594; &#916;&#8322;&#8242; &#8594; b&#8242;</code> such that
     <code class="inline-code">[vs/wtel]wtel = as</code> and
     <code class="inline-code">[vs/wtel]&#916;&#8322;&#8242; = &#916;&#8322;</code> and
     <code class="inline-code">[vs/wtel]b&#8242; = b</code>.
 Plus the final number of with-arguments and the number of visible ones.</p></td></tr></table></div><div class="doc"><p>Abstract with-expressions <code class="inline-code">vs</code> to generate type for with-helper function.</p><p>Each <code class="inline-code">EqualityType</code>, coming from a <code class="inline-code">rewrite</code>, will turn into 2 abstractions.</p></div></div><div class="top"><p class="src"><a id="v:countWithArgs" class="def">countWithArgs</a> :: (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Control-Monad.html#t:Functor" title="Control.Monad">Functor</a> f, <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> f) =&gt; f <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a> -&gt; <a href="Agda-Syntax-Common.html#t:Nat1" title="Agda.Syntax.Common">Nat1</a> <a href="src/Agda.TypeChecking.With.html#countWithArgs" class="link">Source</a> <a href="#v:countWithArgs" class="selflink">#</a></p><div class="doc"><p>Count the number of arguments introduced into the type of the with-function.</p></div></div><div class="top"><p class="src"><a id="v:countWithPats" class="def">countWithPats</a> :: (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Control-Monad.html#t:Functor" title="Control.Monad">Functor</a> f, <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> f) =&gt; f (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)) -&gt; <a href="Agda-Syntax-Common.html#t:Nat1" title="Agda.Syntax.Common">Nat1</a> <a href="src/Agda.TypeChecking.With.html#countWithPats" class="link">Source</a> <a href="#v:countWithPats" class="selflink">#</a></p><div class="doc"><p>Count the number of with-patterns in the with-clause
   that need to be transformed to regular patterns
   in the **current round** of with-abstraction
   (important for nested with).</p></div></div><div class="top"><p class="src"><a id="v:withArguments" class="def">withArguments</a> :: <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> (<a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>, <a href="Agda-Syntax-Internal.html#t:EqualityView" title="Agda.Syntax.Internal">EqualityView</a>)) -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-Syntax-Common.html#t:Arg" title="Agda.Syntax.Common">Arg</a> <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a>)) <a href="src/Agda.TypeChecking.With.html#withArguments" class="link">Source</a> <a href="#v:withArguments" class="selflink">#</a></p><div class="doc"><p>From a list of <code class="inline-code">with</code> and <code class="inline-code">rewrite</code> expressions and their types,
   compute the list of final <code class="inline-code">with</code> expressions (after expanding the <code class="inline-code">rewrite</code>s).</p></div></div><div class="top"><p class="src"><a id="v:buildWithFunction" class="def">buildWithFunction</a> <a href="src/Agda.TypeChecking.With.html#buildWithFunction" class="link">Source</a> <a href="#v:buildWithFunction" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: [<a href="Agda-Syntax-Abstract-Name.html#t:Name" title="Agda.Syntax.Abstract.Name">Name</a>]</td><td class="doc"><p>Names of the module parameters of the parent function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a></td><td class="doc"><p>Name of the parent function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a></td><td class="doc"><p>Name of the with-function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a></td><td class="doc"><p>Types of the parent function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p>Context of parent patterns.</p></td></tr><tr><td class="src">-&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>]</td><td class="doc"><p>Parent patterns.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a></td><td class="doc"><p>Number of module parameters in parent patterns</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Substitution" title="Agda.Syntax.Internal">Substitution</a></td><td class="doc"><p>Substitution from parent lhs to with function lhs</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a></td><td class="doc"><p>Final permutation.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a></td><td class="doc"><p>Number of needed vars.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a></td><td class="doc"><p>Number of with expressions.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> <a href="Agda-Syntax-Abstract.html#t:SpineClause" title="Agda.Syntax.Abstract">SpineClause</a></td><td class="doc"><p>With-clauses.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> <a href="Agda-Syntax-Abstract.html#t:SpineClause" title="Agda.Syntax.Abstract">SpineClause</a>)</td><td class="doc"><p>With-clauses flattened wrt. parent patterns.</p></td></tr></table></div><div class="doc"><p>Compute the clauses for the with-function given the original patterns.</p></div></div><div class="top"><p class="src"><a id="v:stripWithClausePatterns" class="def">stripWithClausePatterns</a> <a href="src/Agda.TypeChecking.With.html#stripWithClausePatterns" class="link">Source</a> <a href="#v:stripWithClausePatterns" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: [<a href="Agda-Syntax-Abstract-Name.html#t:Name" title="Agda.Syntax.Abstract.Name">Name</a>]</td><td class="doc"><p><strong><code class="inline-code">cxtNames</code></strong> names of the module parameters of the parent function</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a></td><td class="doc"><p><strong><code class="inline-code">parent</code></strong> name of the parent function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a></td><td class="doc"><p><strong><code class="inline-code">f</code></strong>   name of with-function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Type" title="Agda.Syntax.Internal">Type</a></td><td class="doc"><p><strong><code class="inline-code">t</code></strong>   top-level type of the original function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p><strong><code class="inline-code">&#916;</code></strong>   context of patterns of parent function.</p></td></tr><tr><td class="src">-&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>]</td><td class="doc"><p><strong><code class="inline-code">qs</code></strong>  internal patterns for original function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a></td><td class="doc"><p><strong><code class="inline-code">npars</code></strong> number of module parameters in <code class="inline-code">qs</code>.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a></td><td class="doc"><p><strong><code class="inline-code">&#960;</code></strong>   permutation taking <code class="inline-code">vars(qs)</code> to <code class="inline-code">support(&#916;)</code>.</p></td></tr><tr><td class="src">-&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Abstract.html#t:Pattern" title="Agda.Syntax.Abstract">Pattern</a>]</td><td class="doc"><p><strong><code class="inline-code">ps</code></strong>  patterns in with clause (eliminating type <code class="inline-code">t</code>).</p></td></tr><tr><td class="src">-&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> ([<a href="Agda-Syntax-Abstract.html#t:ProblemEq" title="Agda.Syntax.Abstract">ProblemEq</a>], [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Abstract.html#t:Pattern" title="Agda.Syntax.Abstract">Pattern</a>])</td><td class="doc"><p><strong><code class="inline-code">ps'</code></strong> patterns for with function (presumably of type <code class="inline-code">&#916;</code>).</p></td></tr></table></div><div class="doc"><pre>stripWithClausePatterns cxtNames parent f t &#916; qs np &#960; ps = ps'</pre><p>Example:</p><pre>  record Stream (A : Set) : Set where
    coinductive
    constructor delay
    field       force : A &#215; Stream A

  record SEq (s t : Stream A) : Set where
    coinductive
    field
      ~force : let a , as = force s
                   b , bs = force t
               in  a &#8801; b &#215; SEq as bs

  test : (s : Nat &#215; Stream Nat) (t : Stream Nat) &#8594; SEq (delay s) t &#8594; SEq t (delay s)
  ~force (test (a     , as) t p) with force t
  ~force (test (suc n , as) t p) | b , bs = ?
</pre><p>With function:</p><pre>  f : (t : Stream Nat) (w : Nat &#215; Stream Nat) (a : Nat) (as : Stream Nat)
      (p : SEq (delay (a , as)) t) &#8594; (fst w &#8801; a) &#215; SEq (snd w) as

  &#916;  = t a as p   -- reorder to bring with-relevant (= needed) vars first
  &#960;  = a as t p &#8594; &#916;
  qs = (a     , as) t p ~force
  ps = (suc n , as) t p ~force
  ps' = (suc n) as t p
</pre><p>Resulting with-function clause is:</p><pre>  f t (b , bs) (suc n) as t p
</pre><p>Note: stripWithClausePatterns factors <strong><code class="inline-code">ps</code></strong> through <strong><code class="inline-code">qs</code></strong>, thus</p><pre>  ps = qs[ps']
</pre><p>where <code class="inline-code">[..]</code> is to be understood as substitution.
The projection patterns have vanished from <strong><code class="inline-code">ps'</code></strong> (as they are already in <strong><code class="inline-code">qs</code></strong>).</p></div></div><div class="top"><p class="src"><a id="v:withDisplayForm" class="def">withDisplayForm</a> <a href="src/Agda.TypeChecking.With.html#withDisplayForm" class="link">Source</a> <a href="#v:withDisplayForm" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a></td><td class="doc"><p>The name of parent function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Abstract-Name.html#t:QName" title="Agda.Syntax.Abstract.Name">QName</a></td><td class="doc"><p>The name of the <code class="inline-code">with</code>-function.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p><strong><code class="inline-code">&#916;&#8321;</code></strong>     The arguments of the <code class="inline-code">with</code> function before the <code class="inline-code">with</code> expressions.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Internal.html#t:Telescope" title="Agda.Syntax.Internal">Telescope</a></td><td class="doc"><p><strong><code class="inline-code">&#916;&#8322;</code></strong>     The arguments of the <code class="inline-code">with</code> function after the <code class="inline-code">with</code> expressions.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a></td><td class="doc"><p><strong><code class="inline-code">n</code></strong>      The number of <code class="inline-code">with</code> expressions.</p></td></tr><tr><td class="src">-&gt; [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>]</td><td class="doc"><p><strong><code class="inline-code">qs</code></strong>      The parent patterns.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a></td><td class="doc"><p><strong><code class="inline-code">perm</code></strong>    Permutation to split into needed and unneeded vars.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-Utils-Permutation.html#t:Permutation" title="Agda.Utils.Permutation">Permutation</a></td><td class="doc"><p><strong><code class="inline-code">lhsPerm</code></strong> Permutation reordering the variables in parent patterns.</p></td></tr><tr><td class="src">-&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> <a href="Agda-TypeChecking-Monad-Base.html#t:DisplayForm" title="Agda.TypeChecking.Monad.Base">DisplayForm</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Construct the display form for a with function. It will display
   applications of the with function as applications to the original function.
   For instance,</p><pre>    aux a b c
  </pre><p>as</p><pre>    f (suc a) (suc b) | c
  </pre></div></div><div class="top"><p class="src"><a id="v:patsToElims" class="def">patsToElims</a> :: [<a href="Agda-Syntax-Common.html#t:NamedArg" title="Agda.Syntax.Common">NamedArg</a> <a href="Agda-Syntax-Internal.html#t:DeBruijnPattern" title="Agda.Syntax.Internal">DeBruijnPattern</a>] -&gt; [<a href="Agda-Syntax-Internal-Elim.html#t:Elim-39-" title="Agda.Syntax.Internal.Elim">Elim'</a> <a href="Agda-TypeChecking-Monad-Base.html#t:DisplayTerm" title="Agda.TypeChecking.Monad.Base">DisplayTerm</a>] <a href="src/Agda.TypeChecking.With.html#patsToElims" class="link">Source</a> <a href="#v:patsToElims" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.30.0</p></div></body></html>