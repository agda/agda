<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html"><span class="hs-identifier">Agda.TypeChecking.Records</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runMaybeT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Writer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runWriter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tell</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html"><span class="hs-identifier">Agda.Syntax.Concrete.Name</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment%27"><span class="hs-identifier">FieldAssignment'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html#unblockOnAnyMetaIn"><span class="hs-identifier">unblockOnAnyMetaIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#isNameInScope"><span class="hs-identifier">isNameInScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html"><span class="hs-identifier">Agda.TypeChecking.Irrelevance</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Warning.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Base.Warning</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TCM</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Reduce.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--instance only</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Cubical.Base.html"><span class="hs-identifier">Agda.TypeChecking.Primitive.Cubical.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Primitive.Cubical.Base.html#isCubicalSubtype"><span class="hs-identifier">isCubicalSubtype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.ProjectionLike.html"><span class="hs-identifier">Agda.TypeChecking.ProjectionLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.ProjectionLike.html#eligibleForProjectionLike"><span class="hs-identifier">eligibleForProjectionLike</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Empty.html"><span class="hs-identifier">Agda.Utils.Empty</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier">applyWhen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier">for</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">($&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;&amp;&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-56"></span><span class="annot"><span class="hs-comment">-- * Tools to build record values</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-type">mkCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-59"></span><span id="mkCon"><span class="annot"><span class="annottext">mkCon :: ConHead -&gt; ConInfo -&gt; Args -&gt; Term
</span><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-var hs-var">mkCon</span></a></span></span><span> </span><span id="local-6989586621682004079"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682004079"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682004080"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004080"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682004081"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004081"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682004079"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004080"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004081"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><span class="hs-comment">-- | Order the fields of a record construction.</span></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#orderFields"><span class="hs-identifier hs-type">orderFields</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003331"><span class="annot"><a href="#local-6989586621682003331"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003331"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Indicates whether this is a @record@ or @record where@ expression.</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Name of record type (for error message).</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ How to fill a missing field.</span></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Field names of the record type.</span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682003331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Provided fields with content in the record expression.</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Warning.html#RecordFieldWarning"><span class="hs-identifier hs-type">RecordFieldWarning</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682003331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Content arranged in official order.</span></span><span>
</span><span id="line-70"></span><span id="orderFields"><span class="annot"><span class="annottext">orderFields :: forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; a)
-&gt; [Arg Name]
-&gt; [(Name, a)]
-&gt; Writer [RecordFieldWarning] [a]
</span><a href="Agda.TypeChecking.Records.html#orderFields"><span class="hs-identifier hs-var hs-var">orderFields</span></a></span></span><span> </span><span id="local-6989586621682004129"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004129"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682004130"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004130"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004131"><span class="annot"><span class="annottext">Arg Name -&gt; a
</span><a href="#local-6989586621682004131"><span class="hs-identifier hs-var">fill</span></a></span></span><span> </span><span id="local-6989586621682004132"><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004132"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span id="local-6989586621682004133"><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004133"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-comment">-- reportSDoc &quot;tc.record&quot; 30 $ vcat</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-comment">--   [ &quot;orderFields&quot;</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-comment">--   , &quot;  official fields: &quot; &lt;+&gt; sep (map pretty xs)</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-comment">--   , &quot;  provided fields: &quot; &lt;+&gt; sep (map pretty ys)</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-comment">--   ]</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; WriterT [RecordFieldWarning] Identity ()
-&gt; WriterT [RecordFieldWarning] Identity ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004129"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; ConInfo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConORecWhere"><span class="hs-identifier hs-var">ConORecWhere</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(WriterT [RecordFieldWarning] Identity ()
 -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; WriterT [RecordFieldWarning] Identity ()
-&gt; WriterT [RecordFieldWarning] Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">[(Name, a)]
-&gt; (List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; WriterT [RecordFieldWarning] Identity ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
[a] -&gt; (List1 a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.List1.html#unlessNull"><span class="hs-identifier hs-var">List1.unlessNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004137"><span class="hs-identifier hs-var">alien</span></a></span><span>     </span><span class="annot"><span class="annottext">((List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
 -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; (List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; WriterT [RecordFieldWarning] Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Name, Range) -&gt; RecordFieldWarning)
-&gt; List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ()
forall {b} {m :: * -&gt; *} {b} {p :: * -&gt; * -&gt; *} {b} {f :: * -&gt; *}
       {a}.
(MonadWriter b m, Singleton b b, Bifunctor p, HasRange b,
 Functor f) =&gt;
(f (p a Range) -&gt; b) -&gt; f (p a b) -&gt; m ()
</span><a href="#local-6989586621682004138"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (Name, Range) -&gt; RecordFieldWarning)
 -&gt; List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; (NonEmpty (Name, Range) -&gt; RecordFieldWarning)
-&gt; List1 (Name, a)
-&gt; WriterT [RecordFieldWarning] Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Name] -&gt; NonEmpty (Name, Range) -&gt; RecordFieldWarning
</span><a href="Agda.TypeChecking.Monad.Base.Warning.html#TooManyFields"><span class="hs-identifier hs-var">W.TooManyFields</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004130"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682004140"><span class="hs-identifier hs-var">missing</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">[(Name, a)]
-&gt; (List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; WriterT [RecordFieldWarning] Identity ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
[a] -&gt; (List1 a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.List1.html#unlessNull"><span class="hs-identifier hs-var">List1.unlessNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004141"><span class="hs-identifier hs-var">duplicate</span></a></span><span> </span><span class="annot"><span class="annottext">((List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
 -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; (List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; WriterT [RecordFieldWarning] Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Name, Range) -&gt; RecordFieldWarning)
-&gt; List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ()
forall {b} {m :: * -&gt; *} {b} {p :: * -&gt; * -&gt; *} {b} {f :: * -&gt; *}
       {a}.
(MonadWriter b m, Singleton b b, Bifunctor p, HasRange b,
 Functor f) =&gt;
(f (p a Range) -&gt; b) -&gt; f (p a b) -&gt; m ()
</span><a href="#local-6989586621682004138"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (Name, Range) -&gt; RecordFieldWarning)
 -&gt; List1 (Name, a) -&gt; WriterT [RecordFieldWarning] Identity ())
-&gt; (NonEmpty (Name, Range) -&gt; RecordFieldWarning)
-&gt; List1 (Name, a)
-&gt; WriterT [RecordFieldWarning] Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (Name, List1 Range) -&gt; RecordFieldWarning
</span><a href="Agda.TypeChecking.Monad.Base.Warning.html#DuplicateFields"><span class="hs-identifier hs-var">W.DuplicateFields</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 (Name, List1 Range) -&gt; RecordFieldWarning)
-&gt; (NonEmpty (Name, Range) -&gt; List1 (Name, List1 Range))
-&gt; NonEmpty (Name, Range)
-&gt; RecordFieldWarning
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Range) -&gt; (Name, List1 Range))
-&gt; NonEmpty (Name, Range) -&gt; List1 (Name, List1 Range)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Range -&gt; List1 Range) -&gt; (Name, Range) -&gt; (Name, List1 Range)
forall a b. (a -&gt; b) -&gt; (Name, a) -&gt; (Name, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; List1 Range
forall a. a -&gt; NonEmpty a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="annottext">[a] -&gt; WriterT [RecordFieldWarning] Identity [a]
forall a. a -&gt; WriterT [RecordFieldWarning] Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; WriterT [RecordFieldWarning] Identity [a])
-&gt; [a] -&gt; WriterT [RecordFieldWarning] Identity [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Arg Name] -&gt; (Arg Name -&gt; a) -&gt; [a]
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004132"><span class="hs-identifier hs-var">axs</span></a></span><span> </span><span class="annot"><span class="annottext">((Arg Name -&gt; a) -&gt; [a]) -&gt; (Arg Name -&gt; a) -&gt; [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004144"><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004144"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a -&gt; a
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Name -&gt; a
</span><a href="#local-6989586621682004131"><span class="hs-identifier hs-var">fill</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004144"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; a) -&gt; Maybe a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Name, a)] -&gt; Maybe a
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Name -&gt; Name
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004144"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004148"><span class="hs-identifier hs-var">uniq</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682004148"><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004148"><span class="hs-identifier hs-var">uniq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004141"><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004141"><span class="hs-identifier hs-var">duplicate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, a) -&gt; Name) -&gt; [(Name, a)] -&gt; ([(Name, a)], [(Name, a)])
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; ([a], [a])
</span><a href="Agda.Utils.List.html#nubAndDuplicatesOn"><span class="hs-identifier hs-var">nubAndDuplicatesOn</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, a) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004133"><span class="hs-identifier hs-var">fs</span></a></span><span>   </span><span class="hs-comment">-- separating duplicate fields</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621682004151"><span class="annot"><span class="annottext">xs :: [Name]
</span><a href="#local-6989586621682004151"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg Name -&gt; Name) -&gt; [Arg Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Name
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004132"><span class="hs-identifier hs-var">axs</span></a></span><span>                       </span><span class="hs-comment">-- official fields (accord. record type)</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621682004140"><span class="annot"><span class="annottext">missing :: [Name]
</span><a href="#local-6989586621682004140"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Name -&gt; Bool) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Name -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; a -&gt; Bool
</span><a href="Agda.Utils.List.html#hasElem"><span class="hs-identifier hs-var">hasElem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, a) -&gt; Name) -&gt; [(Name, a)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, a) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004133"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682004151"><span class="hs-identifier hs-var">xs</span></a></span><span>  </span><span class="hs-comment">-- missing  fields</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621682004137"><span class="annot"><span class="annottext">alien :: [(Name, a)]
</span><a href="#local-6989586621682004137"><span class="hs-identifier hs-var hs-var">alien</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, a) -&gt; Bool) -&gt; [(Name, a)] -&gt; [(Name, a)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ((Name, a) -&gt; Bool) -&gt; (Name, a) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Name -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; a -&gt; Bool
</span><a href="Agda.Utils.List.html#hasElem"><span class="hs-identifier hs-var">hasElem</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682004151"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; ((Name, a) -&gt; Name) -&gt; (Name, a) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, a) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004133"><span class="hs-identifier hs-var">fs</span></a></span><span>      </span><span class="hs-comment">-- spurious fields</span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621682004138"><span class="annot"><span class="annottext">warn :: (f (p a Range) -&gt; b) -&gt; f (p a b) -&gt; m ()
</span><a href="#local-6989586621682004138"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span id="local-6989586621682004182"><span class="annot"><span class="annottext">f (p a Range) -&gt; b
</span><a href="#local-6989586621682004182"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; m ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; m ()) -&gt; (f (p a b) -&gt; b) -&gt; f (p a b) -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; (f (p a b) -&gt; b) -&gt; f (p a b) -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">f (p a Range) -&gt; b
</span><a href="#local-6989586621682004182"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(f (p a Range) -&gt; b)
-&gt; (f (p a b) -&gt; f (p a Range)) -&gt; f (p a b) -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(p a b -&gt; p a Range) -&gt; f (p a b) -&gt; f (p a Range)
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; Range) -&gt; p a b -&gt; p a Range
forall b c a. (b -&gt; c) -&gt; p a b -&gt; p a c
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- | Raise generated 'RecordFieldWarning's as warnings.</span></span><span>
</span><span id="line-89"></span><span id="local-6989586621682003403"><span class="annot"><a href="Agda.TypeChecking.Records.html#warnOnRecordFieldWarnings"><span class="hs-identifier hs-type">warnOnRecordFieldWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Warning.html#RecordFieldWarning"><span class="hs-identifier hs-type">RecordFieldWarning</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682003403"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003403"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-90"></span><span id="warnOnRecordFieldWarnings"><span class="annot"><span class="annottext">warnOnRecordFieldWarnings :: forall a. Writer [RecordFieldWarning] a -&gt; TCM a
</span><a href="Agda.TypeChecking.Records.html#warnOnRecordFieldWarnings"><span class="hs-identifier hs-var hs-var">warnOnRecordFieldWarnings</span></a></span></span><span> </span><span id="local-6989586621682004197"><span class="annot"><span class="annottext">Writer [RecordFieldWarning] a
</span><a href="#local-6989586621682004197"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682004198"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004198"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004199"><span class="annot"><span class="annottext">[RecordFieldWarning]
</span><a href="#local-6989586621682004199"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] a -&gt; (a, [RecordFieldWarning])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] a
</span><a href="#local-6989586621682004197"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">(RecordFieldWarning -&gt; TCMT IO ())
-&gt; [RecordFieldWarning] -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Warning -&gt; TCMT IO ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCMT IO ())
-&gt; (RecordFieldWarning -&gt; Warning)
-&gt; RecordFieldWarning
-&gt; TCMT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RecordFieldWarning -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#RecordFieldWarning"><span class="hs-identifier hs-var">RecordFieldWarning</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[RecordFieldWarning]
</span><a href="#local-6989586621682004199"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; TCMT IO a
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004198"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-comment">-- | Raise generated 'RecordFieldWarning's as errors.</span></span><span>
</span><span id="line-96"></span><span id="local-6989586621682004202"><span class="annot"><a href="Agda.TypeChecking.Records.html#failOnRecordFieldWarnings"><span class="hs-identifier hs-type">failOnRecordFieldWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Warning.html#RecordFieldWarning"><span class="hs-identifier hs-type">RecordFieldWarning</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682004202"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004202"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-97"></span><span id="failOnRecordFieldWarnings"><span class="annot"><span class="annottext">failOnRecordFieldWarnings :: forall a. Writer [RecordFieldWarning] a -&gt; TCM a
</span><a href="Agda.TypeChecking.Records.html#failOnRecordFieldWarnings"><span class="hs-identifier hs-var hs-var">failOnRecordFieldWarnings</span></a></span></span><span> </span><span id="local-6989586621682004215"><span class="annot"><span class="annottext">Writer [RecordFieldWarning] a
</span><a href="#local-6989586621682004215"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682004216"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004216"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004217"><span class="annot"><span class="annottext">[RecordFieldWarning]
</span><a href="#local-6989586621682004217"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] a -&gt; (a, [RecordFieldWarning])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] a
</span><a href="#local-6989586621682004215"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><span class="annottext">(RecordFieldWarning -&gt; TCMT IO (ZonkAny 0))
-&gt; [RecordFieldWarning] -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO (ZonkAny 0)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO (ZonkAny 0))
-&gt; (RecordFieldWarning -&gt; TypeError)
-&gt; RecordFieldWarning
-&gt; TCMT IO (ZonkAny 0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RecordFieldWarning -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#recordFieldWarningToError"><span class="hs-identifier hs-var">recordFieldWarningToError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[RecordFieldWarning]
</span><a href="#local-6989586621682004217"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- This will raise the first warning (if any) as error.</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; TCMT IO a
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004216"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Order the fields of a record construction.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--   Raise generated 'RecordFieldWarning's as warnings.</span><span>
</span><span id="line-105"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#orderFieldsWarn"><span class="hs-identifier hs-type">orderFieldsWarn</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003425"><span class="annot"><a href="#local-6989586621682003425"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003425"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Indicates whether this is a @record@ or @record where@ expression.</span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Name of record type (for error message).</span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003425"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ How to fill a missing field.</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Field names of the record type.</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682003425"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Provided fields with content in the record expression.</span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682003425"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Content arranged in official order.</span></span><span>
</span><span id="line-113"></span><span id="orderFieldsWarn"><span class="annot"><span class="annottext">orderFieldsWarn :: forall a.
HasRange a =&gt;
ConInfo
-&gt; QName -&gt; (Arg Name -&gt; a) -&gt; [Arg Name] -&gt; [(Name, a)] -&gt; TCM [a]
</span><a href="Agda.TypeChecking.Records.html#orderFieldsWarn"><span class="hs-identifier hs-var hs-var">orderFieldsWarn</span></a></span></span><span> </span><span id="local-6989586621682004223"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004223"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004224"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004224"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004225"><span class="annot"><span class="annottext">Arg Name -&gt; a
</span><a href="#local-6989586621682004225"><span class="hs-identifier hs-var">fill</span></a></span></span><span> </span><span id="local-6989586621682004226"><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004226"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span id="local-6989586621682004227"><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004227"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] [a] -&gt; TCM [a]
forall a. Writer [RecordFieldWarning] a -&gt; TCM a
</span><a href="Agda.TypeChecking.Records.html#warnOnRecordFieldWarnings"><span class="hs-identifier hs-var">warnOnRecordFieldWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer [RecordFieldWarning] [a] -&gt; TCM [a])
-&gt; Writer [RecordFieldWarning] [a] -&gt; TCM [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; a)
-&gt; [Arg Name]
-&gt; [(Name, a)]
-&gt; Writer [RecordFieldWarning] [a]
forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; a)
-&gt; [Arg Name]
-&gt; [(Name, a)]
-&gt; Writer [RecordFieldWarning] [a]
</span><a href="Agda.TypeChecking.Records.html#orderFields"><span class="hs-identifier hs-var">orderFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004223"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004224"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; a
</span><a href="#local-6989586621682004225"><span class="hs-identifier hs-var">fill</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004226"><span class="hs-identifier hs-var">axs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004227"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Order the fields of a record construction.</span><span>
</span><span id="line-116"></span><span class="hs-comment">--   Raise generated 'RecordFieldWarning's as errors.</span><span>
</span><span id="line-117"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#orderFieldsFail"><span class="hs-identifier hs-type">orderFieldsFail</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682004229"><span class="annot"><a href="#local-6989586621682004229"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004229"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Indicates whether this is a @record@ or @record where@ expression.</span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Name of record type (for error message).</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004229"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ How to fill a missing field.</span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Field names of the record type.</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682004229"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Provided fields with content in the record expression.</span></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682004229"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Content arranged in official order.</span></span><span>
</span><span id="line-125"></span><span id="orderFieldsFail"><span class="annot"><span class="annottext">orderFieldsFail :: forall a.
HasRange a =&gt;
ConInfo
-&gt; QName -&gt; (Arg Name -&gt; a) -&gt; [Arg Name] -&gt; [(Name, a)] -&gt; TCM [a]
</span><a href="Agda.TypeChecking.Records.html#orderFieldsFail"><span class="hs-identifier hs-var hs-var">orderFieldsFail</span></a></span></span><span> </span><span id="local-6989586621682004232"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004232"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004233"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004233"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004234"><span class="annot"><span class="annottext">Arg Name -&gt; a
</span><a href="#local-6989586621682004234"><span class="hs-identifier hs-var">fill</span></a></span></span><span> </span><span id="local-6989586621682004235"><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004235"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span id="local-6989586621682004236"><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004236"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] [a] -&gt; TCM [a]
forall a. Writer [RecordFieldWarning] a -&gt; TCM a
</span><a href="Agda.TypeChecking.Records.html#failOnRecordFieldWarnings"><span class="hs-identifier hs-var">failOnRecordFieldWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer [RecordFieldWarning] [a] -&gt; TCM [a])
-&gt; Writer [RecordFieldWarning] [a] -&gt; TCM [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; a)
-&gt; [Arg Name]
-&gt; [(Name, a)]
-&gt; Writer [RecordFieldWarning] [a]
forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; a)
-&gt; [Arg Name]
-&gt; [(Name, a)]
-&gt; Writer [RecordFieldWarning] [a]
</span><a href="Agda.TypeChecking.Records.html#orderFields"><span class="hs-identifier hs-var">orderFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004232"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004233"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; a
</span><a href="#local-6989586621682004234"><span class="hs-identifier hs-var">fill</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004235"><span class="hs-identifier hs-var">axs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, a)]
</span><a href="#local-6989586621682004236"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | A record field assignment @record{xs = es}@ might not mention all</span><span>
</span><span id="line-128"></span><span class="hs-comment">--   visible fields.  @insertMissingFields@ inserts placeholders for</span><span>
</span><span id="line-129"></span><span class="hs-comment">--   the missing visible fields and returns the values in order</span><span>
</span><span id="line-130"></span><span class="hs-comment">--   of the fields in the record declaration.</span><span>
</span><span id="line-131"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#insertMissingFields"><span class="hs-identifier hs-type">insertMissingFields</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003428"><span class="annot"><a href="#local-6989586621682003428"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003428"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Indicates whether this is a @record@ or @record where@ expression.</span></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Name of record type (for error reporting).</span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003428"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Function to generate a placeholder for missing visible field.</span></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment%27"><span class="hs-identifier hs-type">FieldAssignment'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003428"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Given fields.</span></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ All record field names with 'ArgInfo'.</span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Warning.html#RecordFieldWarning"><span class="hs-identifier hs-type">RecordFieldWarning</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003428"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Given fields enriched by placeholders for missing explicit fields.</span></span><span>
</span><span id="line-140"></span><span id="insertMissingFields"><span class="annot"><span class="annottext">insertMissingFields :: forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; Writer [RecordFieldWarning] [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFields"><span class="hs-identifier hs-var hs-var">insertMissingFields</span></a></span></span><span> </span><span id="local-6989586621682004258"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004258"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004259"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004259"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004260"><span class="annot"><span class="annottext">Name -&gt; a
</span><a href="#local-6989586621682004260"><span class="hs-identifier hs-var">placeholder</span></a></span></span><span> </span><span id="local-6989586621682004261"><span class="annot"><span class="annottext">[FieldAssignment' a]
</span><a href="#local-6989586621682004261"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682004262"><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004262"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-comment">-- Compute the list of given fields, decorated with the ArgInfo from the record def.</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004263"><span class="annot"><span class="annottext">arg :: Name -&gt; a -&gt; NamedArg a
</span><a href="#local-6989586621682004263"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682004264"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682004264"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682004265"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004265"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Arg Name)
-&gt; NamedArg a -&gt; (Arg Name -&gt; NamedArg a) -&gt; NamedArg a
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Name -&gt; Bool) -&gt; [Arg Name] -&gt; Maybe (Arg Name)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682004264"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (Arg Name -&gt; Name) -&gt; Arg Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Name
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004262"><span class="hs-identifier hs-var">axs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; NamedArg a
forall a. a -&gt; NamedArg a
</span><a href="Agda.Syntax.Common.html#defaultNamedArg"><span class="hs-identifier hs-var">defaultNamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004265"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Arg Name -&gt; NamedArg a) -&gt; NamedArg a)
-&gt; (Arg Name -&gt; NamedArg a) -&gt; NamedArg a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004269"><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004269"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">Arg Name -&gt; a -&gt; Named NamedName a
forall c. Arg Name -&gt; c -&gt; Named_ c
</span><a href="#local-6989586621682004270"><span class="hs-identifier hs-var">nameIfHidden</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004269"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004265"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Named NamedName a -&gt; Arg Name -&gt; NamedArg a
forall a b. a -&gt; Arg b -&gt; Arg a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004269"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span id="local-6989586621682004272"><span class="annot"><span class="annottext">givenFields :: [(Name, Maybe (NamedArg a))]
</span><a href="#local-6989586621682004272"><span class="hs-identifier hs-var hs-var">givenFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682004273"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NamedArg a -&gt; Maybe (NamedArg a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg a -&gt; Maybe (NamedArg a))
-&gt; NamedArg a -&gt; Maybe (NamedArg a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; a -&gt; NamedArg a
</span><a href="#local-6989586621682004263"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682004273"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004274"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-type">FieldAssignment</span></a></span><span> </span><span id="local-6989586621682004273"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682004273"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682004274"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682004274"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FieldAssignment' a]
</span><a href="#local-6989586621682004261"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-comment">-- Omitted explicit fields are filled in with placeholders.</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">-- Omitted implicit or instance fields</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- are still left out and inserted later by checkArguments_.</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><span class="annottext">[Maybe (NamedArg a)] -&gt; [NamedArg a]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (NamedArg a)] -&gt; [NamedArg a])
-&gt; WriterT [RecordFieldWarning] Identity [Maybe (NamedArg a)]
-&gt; WriterT [RecordFieldWarning] Identity [NamedArg a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; Maybe (NamedArg a))
-&gt; [Arg Name]
-&gt; [(Name, Maybe (NamedArg a))]
-&gt; WriterT [RecordFieldWarning] Identity [Maybe (NamedArg a)]
forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Arg Name -&gt; a)
-&gt; [Arg Name]
-&gt; [(Name, a)]
-&gt; Writer [RecordFieldWarning] [a]
</span><a href="Agda.TypeChecking.Records.html#orderFields"><span class="hs-identifier hs-var">orderFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004258"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004259"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Maybe (NamedArg a)
</span><a href="#local-6989586621682004278"><span class="hs-identifier hs-var">fill</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004262"><span class="hs-identifier hs-var">axs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Maybe (NamedArg a))]
</span><a href="#local-6989586621682004272"><span class="hs-identifier hs-var">givenFields</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="#local-6989586621682004278"><span class="hs-identifier hs-type">fill</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003428"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621682004278"><span class="annot"><span class="annottext">fill :: Arg Name -&gt; Maybe (NamedArg a)
</span><a href="#local-6989586621682004278"><span class="hs-identifier hs-var hs-var">fill</span></a></span></span><span> </span><span id="local-6989586621682004279"><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004279"><span class="hs-identifier hs-var">ax</span></a></span></span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004279"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg a -&gt; Maybe (NamedArg a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg a -&gt; Maybe (NamedArg a))
-&gt; NamedArg a -&gt; Maybe (NamedArg a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; NamedArg a -&gt; NamedArg a
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="annot"><span class="annottext">(NamedArg a -&gt; NamedArg a) -&gt; NamedArg a -&gt; NamedArg a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Named NamedName a
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Named NamedName a)
-&gt; (Name -&gt; a) -&gt; Name -&gt; Named NamedName a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; a
</span><a href="#local-6989586621682004260"><span class="hs-identifier hs-var">placeholder</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Named NamedName a) -&gt; Arg Name -&gt; NamedArg a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004279"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (NamedArg a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- Andreas, 2017-04-13, issue #2494</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- We need to put the field names as argument names for hidden arguments.</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- Otherwise, insertImplicit does not do the right thing.</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621682003449"><span class="annot"><a href="#local-6989586621682004270"><span class="hs-identifier hs-type">nameIfHidden</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003449"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Named_"><span class="hs-identifier hs-type">Named_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003449"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621682004270"><span class="annot"><span class="annottext">nameIfHidden :: forall c. Arg Name -&gt; c -&gt; Named_ c
</span><a href="#local-6989586621682004270"><span class="hs-identifier hs-var hs-var">nameIfHidden</span></a></span></span><span> </span><span id="local-6989586621682004290"><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004290"><span class="hs-identifier hs-var">ax</span></a></span></span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004290"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c -&gt; Named NamedName c
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedName -&gt; c -&gt; Named NamedName c
forall name a. name -&gt; a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#named"><span class="hs-identifier hs-var">named</span></a></span><span> </span><span class="annot"><span class="annottext">(NamedName -&gt; c -&gt; Named NamedName c)
-&gt; NamedName -&gt; c -&gt; Named NamedName c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; Ranged ArgName -&gt; NamedName
forall a. Origin -&gt; a -&gt; WithOrigin a
</span><a href="Agda.Syntax.Common.html#WithOrigin"><span class="hs-identifier hs-var">WithOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="annot"><span class="annottext">(Ranged ArgName -&gt; NamedName) -&gt; Ranged ArgName -&gt; NamedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; ArgName -&gt; Ranged ArgName
forall a. Range -&gt; a -&gt; Ranged a
</span><a href="Agda.Syntax.Common.html#Ranged"><span class="hs-identifier hs-var">Ranged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004290"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; Ranged ArgName) -&gt; ArgName -&gt; Ranged ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; ArgName) -&gt; Name -&gt; ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Name
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name
</span><a href="#local-6989586621682004290"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | A record field assignment @record{xs = es}@ might not mention all</span><span>
</span><span id="line-164"></span><span class="hs-comment">--   visible fields.  @insertMissingFields@ inserts placeholders for</span><span>
</span><span id="line-165"></span><span class="hs-comment">--   the missing visible fields and returns the values in order</span><span>
</span><span id="line-166"></span><span class="hs-comment">--   of the fields in the record declaration.</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#insertMissingFieldsWarn"><span class="hs-identifier hs-type">insertMissingFieldsWarn</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003471"><span class="annot"><a href="#local-6989586621682003471"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003471"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Indicates whether this is a @record@ or @record where@ expression.</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Name of record type (for error reporting).</span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003471"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Function to generate a placeholder for missing visible field.</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment%27"><span class="hs-identifier hs-type">FieldAssignment'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003471"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Given fields.</span></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ All record field names with 'ArgInfo'.</span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003471"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Given fields enriched by placeholders for missing explicit fields.</span></span><span>
</span><span id="line-175"></span><span id="insertMissingFieldsWarn"><span class="annot"><span class="annottext">insertMissingFieldsWarn :: forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; TCM [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFieldsWarn"><span class="hs-identifier hs-var hs-var">insertMissingFieldsWarn</span></a></span></span><span> </span><span id="local-6989586621682004297"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004297"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004298"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004298"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004299"><span class="annot"><span class="annottext">Name -&gt; a
</span><a href="#local-6989586621682004299"><span class="hs-identifier hs-var">placeholder</span></a></span></span><span> </span><span id="local-6989586621682004300"><span class="annot"><span class="annottext">[FieldAssignment' a]
</span><a href="#local-6989586621682004300"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682004301"><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004301"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] [NamedArg a] -&gt; TCM [NamedArg a]
forall a. Writer [RecordFieldWarning] a -&gt; TCM a
</span><a href="Agda.TypeChecking.Records.html#warnOnRecordFieldWarnings"><span class="hs-identifier hs-var">warnOnRecordFieldWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer [RecordFieldWarning] [NamedArg a] -&gt; TCM [NamedArg a])
-&gt; Writer [RecordFieldWarning] [NamedArg a] -&gt; TCM [NamedArg a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; Writer [RecordFieldWarning] [NamedArg a]
forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; Writer [RecordFieldWarning] [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFields"><span class="hs-identifier hs-var">insertMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004297"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004298"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; a
</span><a href="#local-6989586621682004299"><span class="hs-identifier hs-var">placeholder</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldAssignment' a]
</span><a href="#local-6989586621682004300"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004301"><span class="hs-identifier hs-var">axs</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | A record field assignment @record{xs = es}@ might not mention all</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   visible fields.  @insertMissingFields@ inserts placeholders for</span><span>
</span><span id="line-180"></span><span class="hs-comment">--   the missing visible fields and returns the values in order</span><span>
</span><span id="line-181"></span><span class="hs-comment">--   of the fields in the record declaration.</span><span>
</span><span id="line-182"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#insertMissingFieldsFail"><span class="hs-identifier hs-type">insertMissingFieldsFail</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682004303"><span class="annot"><a href="#local-6989586621682004303"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004303"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Indicates whether this is a @record@ or @record where@ expression.</span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Name of record type (for error reporting).</span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004303"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Function to generate a placeholder for missing visible field.</span></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment%27"><span class="hs-identifier hs-type">FieldAssignment'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004303"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Given fields.</span></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ All record field names with 'ArgInfo'.</span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004303"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Given fields enriched by placeholders for missing explicit fields.</span></span><span>
</span><span id="line-190"></span><span id="insertMissingFieldsFail"><span class="annot"><span class="annottext">insertMissingFieldsFail :: forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; TCM [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFieldsFail"><span class="hs-identifier hs-var hs-var">insertMissingFieldsFail</span></a></span></span><span> </span><span id="local-6989586621682004306"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004306"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004307"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004307"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004308"><span class="annot"><span class="annottext">Name -&gt; a
</span><a href="#local-6989586621682004308"><span class="hs-identifier hs-var">placeholder</span></a></span></span><span> </span><span id="local-6989586621682004309"><span class="annot"><span class="annottext">[FieldAssignment' a]
</span><a href="#local-6989586621682004309"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682004310"><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004310"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="annottext">Writer [RecordFieldWarning] [NamedArg a] -&gt; TCM [NamedArg a]
forall a. Writer [RecordFieldWarning] a -&gt; TCM a
</span><a href="Agda.TypeChecking.Records.html#failOnRecordFieldWarnings"><span class="hs-identifier hs-var">failOnRecordFieldWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer [RecordFieldWarning] [NamedArg a] -&gt; TCM [NamedArg a])
-&gt; Writer [RecordFieldWarning] [NamedArg a] -&gt; TCM [NamedArg a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; Writer [RecordFieldWarning] [NamedArg a]
forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; Writer [RecordFieldWarning] [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFields"><span class="hs-identifier hs-var">insertMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682004306"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004307"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; a
</span><a href="#local-6989586621682004308"><span class="hs-identifier hs-var">placeholder</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldAssignment' a]
</span><a href="#local-6989586621682004309"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682004310"><span class="hs-identifier hs-var">axs</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-194"></span><span class="annot"><span class="hs-comment">-- * Query information about records from signature</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- | Check if a name refers to a record.</span><span>
</span><span id="line-197"></span><span class="hs-comment">--   If yes, return record definition.</span><span>
</span><span id="line-198"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-pragma hs-type">isRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-pragma hs-type">RecordData</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-199"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-pragma hs-type">isRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-pragma hs-type">ReduceM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-pragma hs-type">RecordData</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-200"></span><span id="local-6989586621682003474"><span class="annot"><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-type">isRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-201"></span><span id="isRecord"><span class="annot"><span class="annottext">isRecord :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var hs-var">isRecord</span></a></span></span><span> </span><span id="local-6989586621682004318"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004318"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004318"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">m Definition -&gt; (Definition -&gt; Defn) -&gt; m Defn
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">m Defn -&gt; (Defn -&gt; Maybe RecordData) -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordDefn"><span class="hs-identifier hs-type">RecordDefn</span></a></span><span> </span><span id="local-6989586621682004322"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004322"><span class="hs-identifier hs-var">rd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Maybe RecordData
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004322"><span class="hs-identifier hs-var">rd</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RecordData
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- | Get the definition for a record. Throws an exception if the name</span><span>
</span><span id="line-207"></span><span class="hs-comment">--   does not refer to a record or the record is abstract.</span><span>
</span><span id="line-208"></span><span id="local-6989586621682003480"><span class="annot"><a href="Agda.TypeChecking.Records.html#getRecordDef"><span class="hs-identifier hs-type">getRecordDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003480"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003480"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003480"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003480"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span></span><span>
</span><span id="line-209"></span><span id="getRecordDef"><span class="annot"><span class="annottext">getRecordDef :: forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadError TCErr m) =&gt;
QName -&gt; m RecordData
</span><a href="Agda.TypeChecking.Records.html#getRecordDef"><span class="hs-identifier hs-var hs-var">getRecordDef</span></a></span></span><span> </span><span id="local-6989586621682004338"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004338"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m RecordData -&gt; m (Maybe RecordData) -&gt; m RecordData
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><a href="Agda.Utils.Maybe.html#fromMaybeM"><span class="hs-identifier hs-var">fromMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">m RecordData
</span><a href="#local-6989586621682004340"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Maybe RecordData) -&gt; m RecordData)
-&gt; m (Maybe RecordData) -&gt; m RecordData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004338"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682004340"><span class="annot"><span class="annottext">err :: m RecordData
</span><a href="#local-6989586621682004340"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m RecordData
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m RecordData) -&gt; TypeError -&gt; m RecordData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBeRecordType"><span class="hs-identifier hs-var">ShouldBeRecordType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
HasCallStack =&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#__DUMMY_SORT__"><span class="hs-identifier hs-var">__DUMMY_SORT__</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004338"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><span class="hs-comment">-- | Get the record name belonging to a field name.</span></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#getRecordOfField"><span class="hs-identifier hs-type">getRecordOfField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span id="getRecordOfField"><span class="annot"><span class="annottext">getRecordOfField :: QName -&gt; TCM (Maybe QName)
</span><a href="Agda.TypeChecking.Records.html#getRecordOfField"><span class="hs-identifier hs-var hs-var">getRecordOfField</span></a></span></span><span> </span><span id="local-6989586621682004346"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004346"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Projection)
-&gt; TCM (Maybe QName)
-&gt; (Projection -&gt; TCM (Maybe QName))
-&gt; TCM (Maybe QName)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; TCMT IO (Maybe Projection)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe Projection)
</span><a href="Agda.TypeChecking.Monad.Signature.html#isProjection"><span class="hs-identifier hs-var">isProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004346"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe QName -&gt; TCM (Maybe QName)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Projection -&gt; TCM (Maybe QName)) -&gt; TCM (Maybe QName))
-&gt; (Projection -&gt; TCM (Maybe QName)) -&gt; TCM (Maybe QName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">\</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Projection"><span class="hs-identifier hs-type">Projection</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">projProper :: Projection -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projProper"><span class="hs-identifier hs-var">projProper</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004351"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682004351"><span class="hs-identifier hs-var">proper</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">projFromType :: Projection -&gt; Arg QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projFromType"><span class="hs-identifier hs-var">projFromType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004353"><span class="annot"><span class="annottext">Arg QName
</span><a href="#local-6989586621682004353"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">Maybe QName -&gt; TCM (Maybe QName)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe QName -&gt; TCM (Maybe QName))
-&gt; Maybe QName -&gt; TCM (Maybe QName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg QName -&gt; QName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg QName
</span><a href="#local-6989586621682004353"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName -&gt; Maybe QName
forall a b. a -&gt; Maybe b -&gt; Maybe a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682004351"><span class="hs-identifier hs-var">proper</span></a></span><span> </span><span class="hs-comment">-- if proper then Just (unArg r) else Nothing</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><span class="hs-comment">-- | Get the field names of a record.</span></span><span>
</span><span id="line-219"></span><span id="local-6989586621682003493"><span class="annot"><a href="Agda.TypeChecking.Records.html#getRecordFieldNames"><span class="hs-identifier hs-type">getRecordFieldNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003493"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003493"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003493"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003493"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-222"></span><span id="getRecordFieldNames"><span class="annot"><span class="annottext">getRecordFieldNames :: forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadError TCErr m) =&gt;
QName -&gt; m [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#getRecordFieldNames"><span class="hs-identifier hs-var hs-var">getRecordFieldNames</span></a></span></span><span> </span><span id="local-6989586621682004363"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004363"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var">recordFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">(RecordData -&gt; [Dom Name]) -&gt; m RecordData -&gt; m [Dom Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m RecordData
forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadError TCErr m) =&gt;
QName -&gt; m RecordData
</span><a href="Agda.TypeChecking.Records.html#getRecordDef"><span class="hs-identifier hs-var">getRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004363"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-type">recordFieldNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span id="recordFieldNames"><span class="annot"><span class="annottext">recordFieldNames :: RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var hs-var">recordFieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Dom Name) -&gt; [Dom' Term QName] -&gt; [Dom Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; Dom' Term QName -&gt; Dom Name
forall a b. (a -&gt; b) -&gt; Dom' Term a -&gt; Dom' Term b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (QName -&gt; Name) -&gt; QName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dom' Term QName] -&gt; [Dom Name])
-&gt; (RecordData -&gt; [Dom' Term QName]) -&gt; RecordData -&gt; [Dom Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><span class="hs-comment">-- | Find all records with at least the given fields.</span></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#findPossibleRecords"><span class="hs-identifier hs-type">findPossibleRecords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span id="findPossibleRecords"><span class="annot"><span class="annottext">findPossibleRecords :: [Name] -&gt; TCM [QName]
</span><a href="Agda.TypeChecking.Records.html#findPossibleRecords"><span class="hs-identifier hs-var hs-var">findPossibleRecords</span></a></span></span><span> </span><span id="local-6989586621682004369"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682004369"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621682004370"><span class="annot"><a href="#local-6989586621682004370"><span class="hs-identifier hs-var">defs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; [Definition]
forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">HMap.elems</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; [Definition])
-&gt; TCMT IO (HashMap QName Definition) -&gt; TCMT IO [Definition]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (HashMap QName Definition)
-&gt; TCMT IO (HashMap QName Definition)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stSignature"><span class="hs-identifier hs-var">stSignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState)
-&gt; ((HashMap QName Definition -&gt; f (HashMap QName Definition))
    -&gt; Signature -&gt; f Signature)
-&gt; (HashMap QName Definition -&gt; f (HashMap QName Definition))
-&gt; TCState
-&gt; f TCState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; f (HashMap QName Definition))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName Definition)
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621682004378"><span class="annot"><a href="#local-6989586621682004378"><span class="hs-identifier hs-var">idefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HMap.elems</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-type">stImports</span></a></span><span>   </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-type">sigDefinitions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621682004383"><span class="annot"><a href="#local-6989586621682004383"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-type">getScope</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`isNameInScope`</span></span><span> </span><span class="annot"><span class="hs-identifier">scope</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682004385"><span class="hs-identifier hs-type">cands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004370"><span class="hs-identifier hs-type">defs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682004385"><span class="hs-identifier hs-type">cands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004378"><span class="hs-identifier hs-type">idefs</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621682004385"><span class="annot"><span class="annottext">cands :: [Definition] -&gt; [QName]
</span><a href="#local-6989586621682004385"><span class="hs-identifier hs-var hs-var">cands</span></a></span></span><span> </span><span id="local-6989586621682004386"><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621682004386"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004388"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682004388"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004388"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621682004386"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Bool
</span><a href="#local-6989586621682004389"><span class="hs-identifier hs-var">possible</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004388"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621682004389"><span class="annot"><span class="annottext">possible :: Definition -&gt; Bool
</span><a href="#local-6989586621682004389"><span class="hs-identifier hs-var hs-var">possible</span></a></span></span><span> </span><span id="local-6989586621682004390"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004390"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-comment">-- Check whether the given fields are contained</span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-comment">-- in the fields of record @def@ (if it is a record).</span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004390"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recFields :: Defn -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#recFields"><span class="hs-identifier hs-var">recFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004393"><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682004393"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621682004395"><span class="hs-identifier hs-var">given</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; Bool) -&gt; Set Name -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; [Name] -&gt; Set Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Name) -&gt; [Dom' Term QName] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name)
-&gt; (Dom' Term QName -&gt; Name) -&gt; Dom' Term QName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Name)
-&gt; (Dom' Term QName -&gt; QName) -&gt; Dom' Term QName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; QName
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682004393"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621682004395"><span class="annot"><span class="annottext">given :: Set Name
</span><a href="#local-6989586621682004395"><span class="hs-identifier hs-var hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682004369"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><span class="hs-comment">-- | Get the field names belonging to a record type.</span></span><span>
</span><span id="line-246"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#getRecordTypeFields"><span class="hs-identifier hs-type">getRecordTypeFields</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Record type.  Need not be reduced.</span></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span id="getRecordTypeFields"><span class="annot"><span class="annottext">getRecordTypeFields :: Type -&gt; TCM [Dom' Term QName]
</span><a href="Agda.TypeChecking.Records.html#getRecordTypeFields"><span class="hs-identifier hs-var hs-var">getRecordTypeFields</span></a></span></span><span> </span><span id="local-6989586621682004399"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004399"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621682004400"><span class="annot"><a href="#local-6989586621682004400"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Type
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004399"><span class="hs-identifier hs-var">t</span></a></span><span>  </span><span class="hs-comment">-- Andreas, 2018-03-03, fix for #2989.</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004400"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682004403"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004403"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621682004404"><span class="annot"><a href="#local-6989586621682004404"><span class="hs-identifier hs-var">rDef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Defn) -&gt; TCMT IO Definition -&gt; TCMT IO Defn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004403"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682004404"><span class="hs-identifier hs-type">rDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recFields :: Defn -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#recFields"><span class="hs-identifier hs-var">recFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004405"><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682004405"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName] -&gt; TCM [Dom' Term QName]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682004405"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM [Dom' Term QName]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM [Dom' Term QName]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- | Returns the given record type's constructor name (with an empty</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- range).</span><span>
</span><span id="line-261"></span><span id="local-6989586621682003520"><span class="annot"><a href="Agda.TypeChecking.Records.html#getRecordConstructor"><span class="hs-identifier hs-type">getRecordConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003520"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003520"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003520"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span></span><span>
</span><span id="line-262"></span><span id="getRecordConstructor"><span class="annot"><span class="annottext">getRecordConstructor :: forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadError TCErr m) =&gt;
QName -&gt; m ConHead
</span><a href="Agda.TypeChecking.Records.html#getRecordConstructor"><span class="hs-identifier hs-var hs-var">getRecordConstructor</span></a></span></span><span> </span><span id="local-6989586621682004417"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004417"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillRangeT ConHead
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">KillRangeT ConHead
-&gt; (RecordData -&gt; ConHead) -&gt; RecordData -&gt; ConHead
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">(RecordData -&gt; ConHead) -&gt; m RecordData -&gt; m ConHead
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m RecordData
forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadError TCErr m) =&gt;
QName -&gt; m RecordData
</span><a href="Agda.TypeChecking.Records.html#getRecordDef"><span class="hs-identifier hs-var">getRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004417"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Reduce a type and check whether it is a record type.</span><span>
</span><span id="line-265"></span><span class="hs-comment">--   Succeeds only if type is not blocked by a meta var.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--   If yes, return its name, parameters, and definition.</span><span>
</span><span id="line-267"></span><span id="local-6989586621682003524"><span class="annot"><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-type">isRecordType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-268"></span><span id="isRecordType"><span class="annot"><span class="annottext">isRecordType :: forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var hs-var">isRecordType</span></a></span></span><span> </span><span id="local-6989586621682004428"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004428"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Blocked Type -&gt; Maybe (QName, Args, RecordData))
-&gt; ((QName, Args, RecordData) -&gt; Maybe (QName, Args, RecordData))
-&gt; Either (Blocked Type) (QName, Args, RecordData)
-&gt; Maybe (QName, Args, RecordData)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QName, Args, RecordData)
-&gt; Blocked Type -&gt; Maybe (QName, Args, RecordData)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, Args, RecordData)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName, Args, RecordData) -&gt; Maybe (QName, Args, RecordData)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Type) (QName, Args, RecordData)
 -&gt; Maybe (QName, Args, RecordData))
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
-&gt; m (Maybe (QName, Args, RecordData))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#tryRecordType"><span class="hs-identifier hs-var">tryRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004428"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | Reduce a type and check whether it is a record type.</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   Succeeds only if type is not blocked by a meta var.</span><span>
</span><span id="line-272"></span><span class="hs-comment">--   If yes, return its name, parameters, and definition.</span><span>
</span><span id="line-273"></span><span class="hs-comment">--   If no, return the reduced type (unless it is blocked).</span><span>
</span><span id="line-274"></span><span id="local-6989586621682003534"><span class="annot"><a href="Agda.TypeChecking.Records.html#tryRecordType"><span class="hs-identifier hs-type">tryRecordType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003534"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003534"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-275"></span><span id="tryRecordType"><span class="annot"><span class="annottext">tryRecordType :: forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#tryRecordType"><span class="hs-identifier hs-var hs-var">tryRecordType</span></a></span></span><span> </span><span id="local-6989586621682004453"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004453"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker
    -&gt; Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; (NotBlocked
    -&gt; Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004453"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004455"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682004455"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682004456"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004456"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Blocked Type) (QName, Args, RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Type) (QName, Args, RecordData)
 -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; Either (Blocked Type) (QName, Args, RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Type -&gt; Either (Blocked Type) (QName, Args, RecordData)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Type -&gt; Either (Blocked Type) (QName, Args, RecordData))
-&gt; Blocked Type -&gt; Either (Blocked Type) (QName, Args, RecordData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; Blocked Type
forall t a. Blocker -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682004455"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004456"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NotBlocked
  -&gt; Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
 -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; (NotBlocked
    -&gt; Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004458"><span class="annot"><span class="annottext">NotBlocked
</span><a href="#local-6989586621682004458"><span class="hs-identifier hs-var">nb</span></a></span></span><span> </span><span id="local-6989586621682004459"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004459"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004460"><span class="annot"><span class="annottext">no :: m (Either (Blocked Type) (QName, Args, RecordData))
</span><a href="#local-6989586621682004460"><span class="hs-identifier hs-var hs-var">no</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Blocked Type) (QName, Args, RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Type) (QName, Args, RecordData)
 -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; Either (Blocked Type) (QName, Args, RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Type -&gt; Either (Blocked Type) (QName, Args, RecordData)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Type -&gt; Either (Blocked Type) (QName, Args, RecordData))
-&gt; Blocked Type -&gt; Either (Blocked Type) (QName, Args, RecordData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotBlocked -&gt; Type -&gt; Blocked Type
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><a href="#local-6989586621682004458"><span class="hs-identifier hs-var">nb</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004459"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004459"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682004462"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004462"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682004463"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004463"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004464"><span class="annot"><span class="annottext">vs :: Args
</span><a href="#local-6989586621682004464"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004463"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">m (Maybe RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
-&gt; (RecordData
    -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004462"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Either (Blocked Type) (QName, Args, RecordData))
</span><a href="#local-6989586621682004460"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">((RecordData
  -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
 -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; (RecordData
    -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004466"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004466"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Blocked Type) (QName, Args, RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Type) (QName, Args, RecordData)
 -&gt; m (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; Either (Blocked Type) (QName, Args, RecordData)
-&gt; m (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName, Args, RecordData)
-&gt; Either (Blocked Type) (QName, Args, RecordData)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004462"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004464"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004466"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Either (Blocked Type) (QName, Args, RecordData))
</span><a href="#local-6989586621682004460"><span class="hs-identifier hs-var">no</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><span class="hs-comment">-- | Get the original projection info for name.</span></span><span>
</span><span id="line-284"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#origProjection"><span class="hs-pragma hs-type">origProjection</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-pragma hs-type">Definition</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Projection"><span class="hs-pragma hs-type">Projection</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-285"></span><span id="local-6989586621682003551"><span class="annot"><a href="Agda.TypeChecking.Records.html#origProjection"><span class="hs-identifier hs-type">origProjection</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003551"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003551"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Projection"><span class="hs-identifier hs-type">Projection</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-286"></span><span id="origProjection"><span class="annot"><span class="annottext">origProjection :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (QName, Definition, Maybe Projection)
</span><a href="Agda.TypeChecking.Records.html#origProjection"><span class="hs-identifier hs-var hs-var">origProjection</span></a></span></span><span> </span><span id="local-6989586621682004481"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004481"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>  </span><span id="local-6989586621682004482"><span class="annot"><a href="#local-6989586621682004482"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004481"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004483"><span class="annot"><a href="#local-6989586621682004483"><span class="hs-identifier hs-var hs-var">proj</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Maybe Projection
</span><a href="Agda.TypeChecking.Monad.Signature.html#isProjection_"><span class="hs-identifier hs-var">isProjection_</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Maybe Projection) -&gt; Defn -&gt; Maybe Projection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004482"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span id="local-6989586621682004485"><span class="annot"><a href="#local-6989586621682004485"><span class="hs-identifier hs-var hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QName, Definition, Maybe Projection)
-&gt; m (QName, Definition, Maybe Projection)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004481"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004482"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Projection
</span><a href="#local-6989586621682004483"><span class="hs-identifier hs-var">proj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-type">caseMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004483"><span class="hs-identifier hs-type">proj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004485"><span class="hs-identifier hs-type">fallback</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004486"><span class="annot"><span class="annottext">p :: Projection
</span><a href="#local-6989586621682004486"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Projection"><span class="hs-identifier hs-type">Projection</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">projProper :: Projection -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projProper"><span class="hs-identifier hs-var">projProper</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004487"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682004487"><span class="hs-identifier hs-var">proper</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">projOrig :: Projection -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projOrig"><span class="hs-identifier hs-var">projOrig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004489"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004489"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682004487"><span class="hs-identifier hs-var">proper</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004481"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004489"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m (QName, Definition, Maybe Projection)
</span><a href="#local-6989586621682004485"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621682004492"><span class="annot"><a href="#local-6989586621682004492"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004489"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682004489"><span class="hs-identifier hs-type">f'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682004492"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#isProjection_"><span class="hs-identifier hs-type">isProjection_</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004492"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | @getDefType f t@ computes the type of (possibly projection-(like))</span><span>
</span><span id="line-297"></span><span class="hs-comment">--   function @f@ whose first argument has type @t@.</span><span>
</span><span id="line-298"></span><span class="hs-comment">--   The `parameters' for @f@ are extracted from @t@.</span><span>
</span><span id="line-299"></span><span class="hs-comment">--   @Nothing@ if @f@ is projection(like) but</span><span>
</span><span id="line-300"></span><span class="hs-comment">--   @t@ is not a data/record/axiom type.</span><span>
</span><span id="line-301"></span><span class="hs-comment">--</span><span>
</span><span id="line-302"></span><span class="hs-comment">--   Precondition: @t@ is reduced.</span><span>
</span><span id="line-303"></span><span class="hs-comment">--</span><span>
</span><span id="line-304"></span><span class="hs-comment">--   See also: 'Agda.TypeChecking.Datatypes.getConType'</span><span>
</span><span id="line-305"></span><span id="local-6989586621682003555"><span class="annot"><a href="Agda.TypeChecking.Records.html#getDefType"><span class="hs-identifier hs-type">getDefType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003555"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003555"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-306"></span><span id="getDefType"><span class="annot"><span class="annottext">getDefType :: forall (m :: * -&gt; *). PureTCM m =&gt; QName -&gt; Type -&gt; m (Maybe Type)
</span><a href="Agda.TypeChecking.Records.html#getDefType"><span class="hs-identifier hs-var hs-var">getDefType</span></a></span></span><span> </span><span id="local-6989586621682004630"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004630"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682004631"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004631"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- Andreas, Issue #1973: we need to take the original projection</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-comment">-- since the parameters from the reduced type t are correct for</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-comment">-- the original projection only.</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-comment">-- Due to module application, the given (non-original) projection f</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- may expect less parameters, those corresponding to a unreduced</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- version of t (which we cannot obtain here).</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682004632"><span class="annot"><a href="#local-6989586621682004632"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004633"><span class="annot"><a href="#local-6989586621682004633"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004634"><span class="annot"><a href="#local-6989586621682004634"><span class="hs-identifier hs-var">mp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (QName, Definition, Maybe Projection)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (QName, Definition, Maybe Projection)
</span><a href="Agda.TypeChecking.Records.html#origProjection"><span class="hs-identifier hs-var">origProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004630"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004635"><span class="annot"><a href="#local-6989586621682004635"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004633"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-comment">-- if @f@ is not a projection (like) function, @a@ is the correct type</span><span>
</span><span id="line-316"></span><span>      </span><span id="local-6989586621682004637"><span class="annot"><a href="#local-6989586621682004637"><span class="hs-identifier hs-var hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; m (Maybe Type)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Type -&gt; m (Maybe Type)) -&gt; Maybe Type -&gt; m (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004635"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.deftype&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;definition f =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004632"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;  -- raw: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004632"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;has type   a =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004635"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;principal  t =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004631"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-322"></span><span>  </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-type">caseMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004634"><span class="hs-identifier hs-type">mp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004637"><span class="hs-identifier hs-type">fallback</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Projection"><span class="hs-identifier hs-type">Projection</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">projIndex :: Projection -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#projIndex"><span class="hs-identifier hs-var">projIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004644"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004644"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004644"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m (Maybe Type)
</span><a href="#local-6989586621682004637"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-comment">-- otherwise, we have to instantiate @a@ to the &quot;parameters&quot; of @f@</span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004646"><span class="annot"><span class="annottext">npars :: Int
</span><a href="#local-6989586621682004646"><span class="hs-identifier hs-var hs-var hs-var">npars</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004644"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-326"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004644"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.deftype&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; m ()) -&gt; ArgName -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;projIndex    = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004644"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-comment">-- we get the parameters from type @t@</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004631"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682004649"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004649"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682004650"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004650"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>          </span><span class="hs-comment">-- Andreas, 2013-10-22</span><span>
</span><span id="line-332"></span><span>          </span><span class="hs-comment">-- we need to check this @Def@ is fully reduced.</span><span>
</span><span id="line-333"></span><span>          </span><span class="hs-comment">-- If it is stuck due to disabled reductions</span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-comment">-- (because of failed termination check),</span><span>
</span><span id="line-335"></span><span>          </span><span class="hs-comment">-- we will produce garbage parameters.</span><span>
</span><span id="line-336"></span><span>          </span><span class="annot"><span class="annottext">m Bool -&gt; m (Maybe Type) -&gt; m (Maybe Type) -&gt; m (Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifNotM"><span class="hs-identifier hs-var">ifNotM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; m Bool
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.ProjectionLike.html#eligibleForProjectionLike"><span class="hs-identifier hs-var">eligibleForProjectionLike</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004649"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe Type)
</span><a href="#local-6989586621682004652"><span class="hs-identifier hs-var">failNotElig</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Maybe Type) -&gt; m (Maybe Type))
-&gt; m (Maybe Type) -&gt; m (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">{- else -}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>            </span><span class="hs-comment">-- now we know it is reduced, we can safely take the parameters</span><span>
</span><span id="line-338"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004653"><span class="annot"><span class="annottext">pars :: Args
</span><a href="#local-6989586621682004653"><span class="hs-identifier hs-var hs-var hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Maybe Args) -&gt; Elims -&gt; Maybe Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Elims
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004646"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004650"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.deftype&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-340"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;head d     = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004649"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-341"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;parameters =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; TCMT IO Doc) -&gt; Args -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Arg Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004653"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.deftype&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;parameters = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004653"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004653"><span class="hs-identifier hs-var">pars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004646"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; m (Maybe Type)
</span><a href="#local-6989586621682004659"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;does not supply enough parameters&quot;</span></span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe Type) -&gt; m Type -&gt; m (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004635"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Args -&gt; m Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; a -&gt; m Type
forall (m :: * -&gt; *).
(MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; Args -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-operator hs-var">`piApplyM`</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004653"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Maybe Type)
</span><a href="#local-6989586621682004661"><span class="hs-identifier hs-var">failNotDef</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621682004652"><span class="annot"><span class="annottext">failNotElig :: m (Maybe Type)
</span><a href="#local-6989586621682004652"><span class="hs-identifier hs-var hs-var">failNotElig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; m (Maybe Type)
</span><a href="#local-6989586621682004659"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;is not eligible for projection-likeness&quot;</span></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621682004661"><span class="annot"><span class="annottext">failNotDef :: m (Maybe Type)
</span><a href="#local-6989586621682004661"><span class="hs-identifier hs-var hs-var">failNotDef</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; m (Maybe Type)
</span><a href="#local-6989586621682004659"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;is not a Def.&quot;</span></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621682004659"><span class="annot"><span class="annottext">failure :: ArgName -&gt; m (Maybe Type)
</span><a href="#local-6989586621682004659"><span class="hs-identifier hs-var hs-var">failure</span></a></span></span><span> </span><span id="local-6989586621682004662"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682004662"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.deftype&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Def. &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004630"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; is projection(like)&quot;</span></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;but the type &quot;</span></span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004631"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;of its argument &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682004662"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.deftype&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;raw type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004631"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">Maybe Type -&gt; m (Maybe Type)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Type -&gt; m (Maybe Type)) -&gt; Maybe Type -&gt; m (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004631"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type
HasCallStack =&gt; Type
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TYPE__"><span class="hs-identifier hs-var">__DUMMY_TYPE__</span></a></span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | Apply a projection to an expression with a known type, returning</span><span>
</span><span id="line-363"></span><span class="hs-comment">--   the type of the projected value.</span><span>
</span><span id="line-364"></span><span class="hs-comment">--   The given type should either be a record type or a type eligible for</span><span>
</span><span id="line-365"></span><span class="hs-comment">--   the principal argument of a projection-like function.</span><span>
</span><span id="line-366"></span><span id="local-6989586621682003609"><span class="annot"><a href="Agda.TypeChecking.Records.html#shouldBeProjectible"><span class="hs-identifier hs-type">shouldBeProjectible</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003609"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003609"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003609"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProjOrigin"><span class="hs-identifier hs-type">ProjOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003609"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-368"></span><span class="hs-comment">-- shouldBeProjectible t f = maybe failure return =&lt;&lt; projectionType t f</span><span>
</span><span id="line-369"></span><span id="shouldBeProjectible"><span class="annot"><span class="annottext">shouldBeProjectible :: forall (m :: * -&gt; *).
(PureTCM m, MonadTCError m, MonadBlock m) =&gt;
Term -&gt; Type -&gt; ProjOrigin -&gt; QName -&gt; m Type
</span><a href="Agda.TypeChecking.Records.html#shouldBeProjectible"><span class="hs-identifier hs-var hs-var">shouldBeProjectible</span></a></span></span><span> </span><span id="local-6989586621682004688"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004688"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682004689"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004689"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682004690"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682004690"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004691"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004691"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621682004692"><span class="annot"><a href="#local-6989586621682004692"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
forall (m :: * -&gt; *) t.
(MonadReduce m, MonadBlock m, IsMeta t, Reduce t) =&gt;
t -&gt; m t
</span><a href="Agda.TypeChecking.Reduce.html#abortIfBlocked"><span class="hs-identifier hs-var">abortIfBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004689"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-type">projectTyped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004688"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004692"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004690"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004691"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004695"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004695"><span class="hs-identifier hs-var">ft</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004695"><span class="hs-identifier hs-var">ft</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Dom' Term Type, Term, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004692"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
HasCallStack =&gt; Type
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TYPE__"><span class="hs-identifier hs-var">__DUMMY_TYPE__</span></a></span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m Type
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m Type) -&gt; TypeError -&gt; m Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBeRecordType"><span class="hs-identifier hs-var">ShouldBeRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004692"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- TODO: more accurate error that makes sense also for proj.-like funs.</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | The analogue of 'piApply'.  If @v@ is a value of record type @t@</span><span>
</span><span id="line-379"></span><span class="hs-comment">--   with field @f@, then @projectTyped v t f@ returns the type of @f v@.</span><span>
</span><span id="line-380"></span><span class="hs-comment">--   And also the record type (as first result).</span><span>
</span><span id="line-381"></span><span class="hs-comment">--</span><span>
</span><span id="line-382"></span><span class="hs-comment">--   Works also for projection-like definitions @f@.</span><span>
</span><span id="line-383"></span><span class="hs-comment">--   In this case, the first result is not a record type.</span><span>
</span><span id="line-384"></span><span class="hs-comment">--</span><span>
</span><span id="line-385"></span><span class="hs-comment">--   Precondition: @t@ is reduced.</span><span>
</span><span id="line-386"></span><span class="hs-comment">--</span><span>
</span><span id="line-387"></span><span id="local-6989586621682003615"><span class="annot"><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-type">projectTyped</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003615"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Head (record value).</span></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Its type.</span></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProjOrigin"><span class="hs-identifier hs-type">ProjOrigin</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Projection.</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003615"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-394"></span><span id="projectTyped"><span class="annot"><span class="annottext">projectTyped :: forall (m :: * -&gt; *).
PureTCM m =&gt;
Term
-&gt; Type
-&gt; ProjOrigin
-&gt; QName
-&gt; m (Maybe (Dom' Term Type, Term, Type))
</span><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-var hs-var">projectTyped</span></a></span></span><span> </span><span id="local-6989586621682004712"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004712"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682004713"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004713"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682004714"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682004714"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004715"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004715"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe Type)
-&gt; m (Maybe (Dom' Term Type, Term, Type))
-&gt; (Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Type -&gt; m (Maybe Type)
forall (m :: * -&gt; *). PureTCM m =&gt; QName -&gt; Type -&gt; m (Maybe Type)
</span><a href="Agda.TypeChecking.Records.html#getDefType"><span class="hs-identifier hs-var">getDefType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004715"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004713"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Dom' Term Type, Term, Type)
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Dom' Term Type, Term, Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
 -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; (Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004716"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004716"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><span class="annottext">Type
-&gt; (Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; (Dom' Term Type
    -&gt; Abs Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall (m :: * -&gt; *) a.
MonadReduce m =&gt;
Type -&gt; (Type -&gt; m a) -&gt; (Dom' Term Type -&gt; Abs Type -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Telescope.html#ifNotPiType"><span class="hs-identifier hs-var">ifNotPiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004716"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Maybe (Dom' Term Type, Term, Type))
-&gt; Type -&gt; m (Maybe (Dom' Term Type, Term, Type))
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Dom' Term Type, Term, Type))
 -&gt; Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; m (Maybe (Dom' Term Type, Term, Type))
-&gt; Type
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Dom' Term Type, Term, Type)
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Dom' Term Type, Term, Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{- else -}</span><span> </span><span class="annot"><span class="annottext">((Dom' Term Type
  -&gt; Abs Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
 -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; (Dom' Term Type
    -&gt; Abs Type -&gt; m (Maybe (Dom' Term Type, Term, Type)))
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004718"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004718"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682004719"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682004719"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621682004720"><span class="annot"><a href="#local-6989586621682004720"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Arg Term -&gt; m Term
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
ProjOrigin -&gt; QName -&gt; Arg Term -&gt; m Term
</span><a href="Agda.TypeChecking.Monad.Signature.html#applyDef"><span class="hs-identifier hs-var">applyDef</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682004714"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004715"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; Arg Type
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004718"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Term -&gt; Arg Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004712"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682004718"><span class="hs-identifier hs-type">dom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682004720"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682004719"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-operator hs-type">`absApp`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004712"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span class="annot"><span class="hs-comment">-- | Typing of an elimination.</span></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-keyword">data</span><span> </span><span id="ElimType"><span class="annot"><a href="Agda.TypeChecking.Records.html#ElimType"><span class="hs-identifier hs-var">ElimType</span></a></span></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ArgT"><span class="annot"><a href="Agda.TypeChecking.Records.html#ArgT"><span class="hs-identifier hs-var">ArgT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Type of the argument.</span></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ProjT"><span class="annot"><a href="Agda.TypeChecking.Records.html#ProjT"><span class="hs-identifier hs-var">ProjT</span></a></span></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="projTRec"><span class="annot"><span class="annottext">ElimType -&gt; Dom' Term Type
</span><a href="Agda.TypeChecking.Records.html#projTRec"><span class="hs-identifier hs-var hs-var">projTRec</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The type of the record which is eliminated.</span></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="projTField"><span class="annot"><span class="annottext">ElimType -&gt; Type
</span><a href="Agda.TypeChecking.Records.html#projTField"><span class="hs-identifier hs-var hs-var">projTField</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The type of the field.</span></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCM"><span class="hs-identifier hs-type">PrettyTCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#ElimType"><span class="hs-identifier hs-type">ElimType</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>  </span><span id="local-6989586621682004752"><span class="annot"><span class="annottext">prettyTCM :: forall (m :: * -&gt; *). MonadPretty m =&gt; ElimType -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var hs-var hs-var">prettyTCM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Records.html#ArgT"><span class="hs-identifier hs-type">ArgT</span></a></span><span> </span><span id="local-6989586621682004753"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004753"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom' Term Type -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Dom' Term Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004753"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Records.html#ProjT"><span class="hs-identifier hs-type">ProjT</span></a></span><span> </span><span id="local-6989586621682004754"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004754"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682004755"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004755"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><span class="annottext">m Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc
forall (m :: * -&gt; *). Functor m =&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Dom' Term Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004754"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">m Doc
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004755"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="annot"><span class="hs-comment">-- | Given a head and its type, compute the types of the eliminations.</span></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#typeElims"><span class="hs-identifier hs-type">typeElims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Records.html#ElimType"><span class="hs-identifier hs-type">ElimType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-416"></span><span id="typeElims"><span class="annot"><span class="annottext">typeElims :: Type -&gt; Term -&gt; Elims -&gt; TCM [ElimType]
</span><a href="Agda.TypeChecking.Records.html#typeElims"><span class="hs-identifier hs-var hs-var">typeElims</span></a></span></span><span> </span><span id="local-6989586621682004758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004758"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ElimType] -&gt; TCM [ElimType]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-417"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#typeElims"><span class="hs-identifier hs-var">typeElims</span></a></span><span> </span><span id="local-6989586621682004759"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004759"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682004760"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004760"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682004761"><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682004761"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682004762"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004762"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682004761"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-comment">-- Andrea 02/08/2017: when going from patterns to elims we</span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-comment">-- generate an Apply elim even for Path types, because we use VarP</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- for both, so we have to allow for a Path type here.</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682004763"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682004763"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Type -&gt; TCM [ElimType])
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; TCM [ElimType])
-&gt; TCM [ElimType]
forall (tcm :: * -&gt; *) a.
(MonadReduce tcm, HasBuiltins tcm) =&gt;
Type
-&gt; (Type -&gt; tcm a)
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; tcm a)
-&gt; tcm a
</span><a href="Agda.TypeChecking.Telescope.html#ifNotPiOrPathType"><span class="hs-identifier hs-var">ifNotPiOrPathType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004759"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM [ElimType]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-comment">{- else -}</span><span> </span><span class="annot"><span class="annottext">((Dom' Term Type -&gt; Abs Type -&gt; TCM [ElimType]) -&gt; TCM [ElimType])
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; TCM [ElimType]) -&gt; TCM [ElimType]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004765"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004765"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682004766"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682004766"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; ElimType
</span><a href="Agda.TypeChecking.Records.html#ArgT"><span class="hs-identifier hs-var">ArgT</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682004765"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ElimType -&gt; [ElimType] -&gt; [ElimType]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ElimType] -&gt; [ElimType]) -&gt; TCM [ElimType] -&gt; TCM [ElimType]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Elims -&gt; TCM [ElimType]
</span><a href="Agda.TypeChecking.Records.html#typeElims"><span class="hs-identifier hs-var">typeElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Type -&gt; SubstArg Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-identifier hs-var">absApp</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682004766"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(SubstArg Type -&gt; Type) -&gt; SubstArg Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg (SubstArg Type) -&gt; SubstArg Type
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
Arg (SubstArg Type)
</span><a href="#local-6989586621682004763"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004760"><span class="hs-identifier hs-var">self</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682004761"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004762"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682004769"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682004769"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004770"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004770"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>      </span><span id="local-6989586621682004771"><span class="annot"><a href="#local-6989586621682004771"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Type
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004759"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682004772"><span class="annot"><a href="#local-6989586621682004772"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004773"><span class="annot"><a href="#local-6989586621682004773"><span class="hs-identifier hs-var">self</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004774"><span class="annot"><a href="#local-6989586621682004774"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-type">projectTyped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004760"><span class="hs-identifier hs-type">self</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004771"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004769"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004770"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjT</span></span><span> </span><span class="annot"><span class="hs-identifier">dom</span></span><span> </span><span class="annot"><span class="hs-identifier">a</span></span><span> </span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#typeElims"><span class="hs-identifier hs-type">typeElims</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004774"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004773"><span class="hs-identifier hs-type">self</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004762"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM [ElimType]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-comment">-- | Given a term with a given type and a list of eliminations, returning the</span><span>
</span><span id="line-431"></span><span class="hs-comment">--   type of the term applied to the eliminations.</span><span>
</span><span id="line-432"></span><span id="local-6989586621682003635"><span class="annot"><a href="Agda.TypeChecking.Records.html#eliminateType"><span class="hs-identifier hs-type">eliminateType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003635"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003635"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Empty.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003635"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-433"></span><span id="eliminateType"><span class="annot"><span class="annottext">eliminateType :: forall (m :: * -&gt; *).
PureTCM m =&gt;
m Empty -&gt; Term -&gt; Type -&gt; Elims -&gt; m Type
</span><a href="Agda.TypeChecking.Records.html#eliminateType"><span class="hs-identifier hs-var hs-var">eliminateType</span></a></span></span><span> </span><span id="local-6989586621682004780"><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004780"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Empty -&gt; (Elims -&gt; Term) -&gt; Type -&gt; Elims -&gt; m Type
forall (m :: * -&gt; *).
PureTCM m =&gt;
m Empty -&gt; (Elims -&gt; Term) -&gt; Type -&gt; Elims -&gt; m Type
</span><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-var">eliminateType'</span></a></span><span> </span><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004780"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">((Elims -&gt; Term) -&gt; Type -&gt; Elims -&gt; m Type)
-&gt; (Term -&gt; Elims -&gt; Term) -&gt; Term -&gt; Type -&gt; Elims -&gt; m Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-identifier hs-var">applyE</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span id="local-6989586621682003638"><span class="annot"><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-type">eliminateType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003638"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003638"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Empty.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003638"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-436"></span><span id="eliminateType%27"><span class="annot"><span class="annottext">eliminateType' :: forall (m :: * -&gt; *).
PureTCM m =&gt;
m Empty -&gt; (Elims -&gt; Term) -&gt; Type -&gt; Elims -&gt; m Type
</span><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-var hs-var">eliminateType'</span></a></span></span><span> </span><span id="local-6989586621682004809"><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004809"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621682004810"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682004810"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682004811"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004811"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004811"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-437"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-var">eliminateType'</span></a></span><span> </span><span id="local-6989586621682004812"><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004812"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621682004813"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682004813"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682004814"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004814"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682004815"><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682004815"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682004816"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004816"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682004815"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682004817"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682004817"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621682004818"><span class="annot"><a href="#local-6989586621682004818"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Empty -&gt; Type -&gt; Arg Term -&gt; m Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
m Empty -&gt; Type -&gt; a -&gt; m Type
forall (m :: * -&gt; *).
(MonadReduce m, HasBuiltins m) =&gt;
m Empty -&gt; Type -&gt; Arg Term -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM%27"><span class="hs-identifier hs-var">piApplyM'</span></a></span><span> </span><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004812"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004814"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682004817"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-type">eliminateType'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004812"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682004813"><span class="hs-identifier hs-type">hd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">e</span></span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682004818"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004816"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682004820"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682004820"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682004821"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004821"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004814"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">m Type -&gt; (Type -&gt; m (Maybe Type)) -&gt; m (Maybe Type)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Type -&gt; m (Maybe Type)
forall (m :: * -&gt; *). PureTCM m =&gt; QName -&gt; Type -&gt; m (Maybe Type)
</span><a href="Agda.TypeChecking.Records.html#getDefType"><span class="hs-identifier hs-var">getDefType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004821"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe Type) -&gt; (Maybe Type -&gt; m Type) -&gt; m Type
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682004822"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004822"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Type -&gt; m Type)
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; m Type)
-&gt; m Type
forall (m :: * -&gt; *) a.
MonadReduce m =&gt;
Type -&gt; (Type -&gt; m a) -&gt; (Dom' Term Type -&gt; Abs Type -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Telescope.html#ifNotPiType"><span class="hs-identifier hs-var">ifNotPiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004822"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Empty -&gt; Type
forall a. Empty -&gt; a
</span><a href="Agda.Utils.Empty.html#absurd"><span class="hs-identifier hs-var">absurd</span></a></span><span> </span><span class="annot"><span class="annottext">(Empty -&gt; Type) -&gt; m Empty -&gt; m Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004812"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Dom' Term Type -&gt; Abs Type -&gt; m Type) -&gt; m Type)
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; m Type) -&gt; m Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Dom' Term Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682004824"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682004824"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><span class="annottext">m Empty -&gt; (Elims -&gt; Term) -&gt; Type -&gt; Elims -&gt; m Type
forall (m :: * -&gt; *).
PureTCM m =&gt;
m Empty -&gt; (Elims -&gt; Term) -&gt; Type -&gt; Elims -&gt; m Type
</span><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-var">eliminateType'</span></a></span><span> </span><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004812"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682004813"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; (Elims -&gt; Elims) -&gt; Elims -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682004815"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Elim -&gt; Elims -&gt; Elims
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682004824"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; SubstArg Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-operator hs-var">`absApp`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682004813"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004816"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Empty -&gt; Type
forall a. Empty -&gt; a
</span><a href="Agda.Utils.Empty.html#absurd"><span class="hs-identifier hs-var">absurd</span></a></span><span> </span><span class="annot"><span class="annottext">(Empty -&gt; Type) -&gt; m Empty -&gt; m Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004812"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682004825"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004825"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621682004826"><span class="annot"><a href="#local-6989586621682004826"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Empty -&gt; Type -&gt; Term -&gt; m Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
m Empty -&gt; Type -&gt; a -&gt; m Type
forall (m :: * -&gt; *).
(MonadReduce m, HasBuiltins m) =&gt;
m Empty -&gt; Type -&gt; Term -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM%27"><span class="hs-identifier hs-var">piApplyM'</span></a></span><span> </span><span class="annot"><span class="annottext">m Empty
</span><a href="#local-6989586621682004812"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004814"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682004825"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Records.html#eliminateType%27"><span class="hs-identifier hs-type">eliminateType'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004812"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682004813"><span class="hs-identifier hs-type">hd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">e</span></span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682004826"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004816"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-comment">-- | Check if a name refers to an eta expandable record.</span><span>
</span><span id="line-450"></span><span class="hs-comment">--</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- The answer is no for a record type with an erased constructor</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- unless the current quantity is \&quot;erased\&quot;.</span><span>
</span><span id="line-453"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-pragma hs-type">isEtaRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Bool</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-454"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-pragma hs-type">isEtaRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-pragma hs-type">ReduceM</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Bool</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-455"></span><span id="local-6989586621682004828"><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-identifier hs-type">isEtaRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004828"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004828"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-456"></span><span id="isEtaRecord"><span class="annot"><span class="annottext">isEtaRecord :: forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-identifier hs-var hs-var">isEtaRecord</span></a></span></span><span> </span><span id="local-6989586621682004845"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004845"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004845"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe RecordData) -&gt; (Maybe RecordData -&gt; m Bool) -&gt; m Bool
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682004846"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004846"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-var">isEtaRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004846"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>     </span><span id="local-6989586621682004848"><span class="annot"><a href="#local-6989586621682004848"><span class="hs-identifier hs-var">constructorQ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Quantity) -&gt; m Definition -&gt; m Quantity
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004846"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>     </span><span id="local-6989586621682004851"><span class="annot"><a href="#local-6989586621682004851"><span class="hs-identifier hs-var">currentQ</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eQuantity"><span class="hs-identifier hs-type">eQuantity</span></a></span><span>
</span><span id="line-461"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682004848"><span class="hs-identifier hs-type">constructorQ</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#moreQuantity"><span class="hs-operator hs-type">`moreQuantity`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004851"><span class="hs-identifier hs-type">currentQ</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="annot"><span class="annottext">Maybe RecordData
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-type">isEtaRecordDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-465"></span><span id="isEtaRecordDef"><span class="annot"><span class="annottext">isEtaRecordDef :: RecordData -&gt; Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-var hs-var">isEtaRecordDef</span></a></span></span><span> </span><span id="local-6989586621682004857"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004857"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; HasEta
</span><a href="Agda.TypeChecking.Monad.Base.html#_recEtaEquality"><span class="hs-identifier hs-var">_recEtaEquality</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004857"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HasEta -&gt; HasEta -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HasEta
forall a. HasEta' a
</span><a href="Agda.Syntax.Common.html#YesEta"><span class="hs-identifier hs-var">YesEta</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaCon"><span class="hs-pragma hs-type">isEtaCon</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Bool</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-468"></span><span id="local-6989586621682004861"><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaCon"><span class="hs-identifier hs-type">isEtaCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004861"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004861"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-469"></span><span id="isEtaCon"><span class="annot"><span class="annottext">isEtaCon :: forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaCon"><span class="hs-identifier hs-var hs-var">isEtaCon</span></a></span></span><span> </span><span id="local-6989586621682004866"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004866"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, RecordData) -&gt; Bool)
-&gt; m (Maybe (QName, RecordData)) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe (QName, RecordData))
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe (QName, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordConstructor"><span class="hs-identifier hs-var">isEtaRecordConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004866"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="annot"><span class="hs-comment">-- | Going under one of these does not count as a decrease in size for the termination checker.</span></span><span>
</span><span id="line-472"></span><span id="local-6989586621682004869"><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaOrCoinductiveRecordConstructor"><span class="hs-identifier hs-type">isEtaOrCoinductiveRecordConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-473"></span><span id="isEtaOrCoinductiveRecordConstructor"><span class="annot"><span class="annottext">isEtaOrCoinductiveRecordConstructor :: forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaOrCoinductiveRecordConstructor"><span class="hs-identifier hs-var hs-var">isEtaOrCoinductiveRecordConstructor</span></a></span></span><span> </span><span id="local-6989586621682004883"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004883"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="annottext">m (Maybe (QName, RecordData))
-&gt; m Bool -&gt; ((QName, RecordData) -&gt; m Bool) -&gt; m Bool
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; m (Maybe (QName, RecordData))
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe (QName, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordConstructor"><span class="hs-identifier hs-var">isRecordConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004883"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((QName, RecordData) -&gt; m Bool) -&gt; m Bool)
-&gt; ((QName, RecordData) -&gt; m Bool) -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004885"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004885"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-var">isEtaRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004885"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m Bool -&gt; m Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#or2M"><span class="hs-operator hs-var">`or2M`</span></a></span><span>
</span><span id="line-476"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#_recInduction"><span class="hs-identifier hs-var">_recInduction</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004885"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Induction -&gt; Maybe Induction -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Induction -&gt; Maybe Induction
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.Aspect.html#Inductive"><span class="hs-identifier hs-var">Inductive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>      </span><span class="hs-comment">-- If in doubt about coinductivity, then yes.</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="annot"><span class="hs-comment">-- | Check if a name refers to a record which is not coinductive.  (Projections are then size-preserving)</span></span><span>
</span><span id="line-480"></span><span id="local-6989586621682004890"><span class="annot"><a href="Agda.TypeChecking.Records.html#isInductiveRecord"><span class="hs-identifier hs-type">isInductiveRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004890"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004890"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-481"></span><span id="isInductiveRecord"><span class="annot"><span class="annottext">isInductiveRecord :: forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isInductiveRecord"><span class="hs-identifier hs-var hs-var">isInductiveRecord</span></a></span></span><span> </span><span id="local-6989586621682004897"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004897"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (RecordData -&gt; Bool) -&gt; Maybe RecordData -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Induction -&gt; Maybe Induction
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.Aspect.html#CoInductive"><span class="hs-identifier hs-var">CoInductive</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Induction -&gt; Maybe Induction -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Induction -&gt; Bool)
-&gt; (RecordData -&gt; Maybe Induction) -&gt; RecordData -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#_recInduction"><span class="hs-identifier hs-var">_recInduction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe RecordData -&gt; Bool) -&gt; m (Maybe RecordData) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004897"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="annot"><span class="hs-comment">-- | Check if a type is an eta expandable record and return the record identifier and the parameters.</span></span><span>
</span><span id="line-484"></span><span id="local-6989586621682003658"><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecordType"><span class="hs-identifier hs-type">isEtaRecordType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003658"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003658"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-487"></span><span id="isEtaRecordType"><span class="annot"><span class="annottext">isEtaRecordType :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
Type -&gt; m (Maybe (QName, Args))
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordType"><span class="hs-identifier hs-var hs-var">isEtaRecordType</span></a></span></span><span> </span><span id="local-6989586621682004911"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004911"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682004911"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-488"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682004912"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004912"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682004913"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004913"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682004914"><span class="annot"><span class="annottext">vs :: Args
</span><a href="#local-6989586621682004914"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682004913"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="annottext">m Bool
-&gt; m (Maybe (QName, Args))
-&gt; m (Maybe (QName, Args))
-&gt; m (Maybe (QName, Args))
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; m Bool
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-identifier hs-var">isEtaRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004912"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QName, Args) -&gt; m (Maybe (QName, Args))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, Args) -&gt; m (Maybe (QName, Args)))
-&gt; Maybe (QName, Args) -&gt; m (Maybe (QName, Args))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName, Args) -&gt; Maybe (QName, Args)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004912"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682004914"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QName, Args) -&gt; m (Maybe (QName, Args))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, Args)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>  </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, Args) -&gt; m (Maybe (QName, Args))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, Args)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-comment">-- | Check if a name refers to a record constructor.</span><span>
</span><span id="line-494"></span><span class="hs-comment">--   If yes, return record definition.</span><span>
</span><span id="line-495"></span><span class="hs-comment">--</span><span>
</span><span id="line-496"></span><span id="local-6989586621682004916"><span class="annot"><a href="Agda.TypeChecking.Records.html#isRecordConstructor"><span class="hs-identifier hs-type">isRecordConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004916"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682004916"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-497"></span><span id="isRecordConstructor"><span class="annot"><span class="annottext">isRecordConstructor :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe (QName, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordConstructor"><span class="hs-identifier hs-var hs-var">isRecordConstructor</span></a></span></span><span> </span><span id="local-6989586621682004932"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004932"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Either SigError Definition)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Either SigError Definition)
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo%27"><span class="hs-identifier hs-var">getConstInfo'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004932"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either SigError Definition)
-&gt; (Either SigError Definition -&gt; m (Maybe (QName, RecordData)))
-&gt; m (Maybe (QName, RecordData))
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#SigUnknown"><span class="hs-identifier hs-type">SigUnknown</span></a></span><span> </span><span id="local-6989586621682004935"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682004935"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Maybe (QName, RecordData))
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-499"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">SigError
</span><a href="Agda.TypeChecking.Monad.Signature.html#SigCubicalNotErasure"><span class="hs-identifier hs-var">SigCubicalNotErasure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Maybe (QName, RecordData))
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">SigError
</span><a href="Agda.TypeChecking.Monad.Signature.html#SigAbstract"><span class="hs-identifier hs-var">SigAbstract</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682004938"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004938"><span class="hs-identifier hs-var">def</span></a></span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Defn) -&gt; Definition -&gt; Defn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682004938"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">conData :: Defn -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#conData"><span class="hs-identifier hs-var">conData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004941"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004941"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RecordData -&gt; (QName, RecordData))
-&gt; Maybe RecordData -&gt; Maybe (QName, RecordData)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004941"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe RecordData -&gt; Maybe (QName, RecordData))
-&gt; m (Maybe RecordData) -&gt; m (Maybe (QName, RecordData))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004941"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span id="local-6989586621682003652"><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecordConstructor"><span class="hs-identifier hs-type">isEtaRecordConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-506"></span><span id="isEtaRecordConstructor"><span class="annot"><span class="annottext">isEtaRecordConstructor :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe (QName, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordConstructor"><span class="hs-identifier hs-var hs-var">isEtaRecordConstructor</span></a></span></span><span> </span><span id="local-6989586621682004950"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004950"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe (QName, RecordData))
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe (QName, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordConstructor"><span class="hs-identifier hs-var">isRecordConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004950"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe (QName, RecordData))
-&gt; (Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData)))
-&gt; m (Maybe (QName, RecordData))
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-507"></span><span>  </span><span class="annot"><span class="annottext">Maybe (QName, RecordData)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-508"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682004951"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004951"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004952"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004952"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-var">isEtaRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004952"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData)))
-&gt; Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName, RecordData) -&gt; Maybe (QName, RecordData)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004951"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004952"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; m (Maybe (QName, RecordData))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QName, RecordData)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">-- | Turn off eta for unguarded recursive records.</span><span>
</span><span id="line-511"></span><span class="hs-comment">--   Projections do not preserve guardedness.</span><span>
</span><span id="line-512"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#unguardedRecord"><span class="hs-identifier hs-type">unguardedRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#PatternOrCopattern"><span class="hs-identifier hs-type">PatternOrCopattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span id="unguardedRecord"><span class="annot"><span class="annottext">unguardedRecord :: QName -&gt; PatternOrCopattern -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Records.html#unguardedRecord"><span class="hs-identifier hs-var hs-var">unguardedRecord</span></a></span></span><span> </span><span id="local-6989586621682004954"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004954"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682004955"><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="#local-6989586621682004955"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (EtaEquality -&gt; EtaEquality) -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
QName -&gt; (EtaEquality -&gt; EtaEquality) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyRecEta"><span class="hs-identifier hs-var">modifyRecEta</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004954"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682004957"><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682004957"><span class="hs-identifier hs-var">eta</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EtaEquality -&gt; HasEta -&gt; EtaEquality
</span><a href="Agda.TypeChecking.Monad.Base.html#setEtaEquality"><span class="hs-identifier hs-var">setEtaEquality</span></a></span><span> </span><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682004957"><span class="hs-identifier hs-var">eta</span></a></span><span> </span><span class="annot"><span class="annottext">(HasEta -&gt; EtaEquality) -&gt; HasEta -&gt; EtaEquality
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern -&gt; HasEta
forall a. a -&gt; HasEta' a
</span><a href="Agda.Syntax.Common.html#NoEta"><span class="hs-identifier hs-var">NoEta</span></a></span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="#local-6989586621682004955"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="hs-comment">-- | Turn on eta for non-recursive and inductive guarded recursive records,</span><span>
</span><span id="line-516"></span><span class="hs-comment">--   unless user declared otherwise.</span><span>
</span><span id="line-517"></span><span class="hs-comment">--   Projections do not preserve guardedness.</span><span>
</span><span id="line-518"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#updateEtaForRecord"><span class="hs-identifier hs-type">updateEtaForRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span id="updateEtaForRecord"><span class="annot"><span class="annottext">updateEtaForRecord :: QName -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Records.html#updateEtaForRecord"><span class="hs-identifier hs-var hs-var">updateEtaForRecord</span></a></span></span><span> </span><span id="local-6989586621682004961"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004961"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Options.html#etaEnabled"><span class="hs-identifier hs-var">etaEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-comment">-- Do we need to switch on eta for record q?</span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621682004964"><span class="annot"><a href="#local-6989586621682004964"><span class="hs-identifier hs-var">switchEta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004961"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Definition -&gt; (Definition -&gt; Defn) -&gt; TCMT IO Defn
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Defn -&gt; (Defn -&gt; Bool) -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recInduction :: Defn -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#recInduction"><span class="hs-identifier hs-var">recInduction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004966"><span class="annot"><span class="annottext">Maybe Induction
</span><a href="#local-6989586621682004966"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recEtaEquality' :: Defn -&gt; EtaEquality
</span><a href="Agda.TypeChecking.Monad.Base.html#recEtaEquality%27"><span class="hs-identifier hs-var">recEtaEquality'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682004968"><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682004968"><span class="hs-identifier hs-var">eta</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Inferred"><span class="hs-identifier hs-type">Inferred</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NoEta"><span class="hs-identifier hs-type">NoEta</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682004968"><span class="hs-identifier hs-var">eta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Induction
</span><a href="#local-6989586621682004966"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Induction -&gt; Maybe Induction -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Induction -&gt; Maybe Induction
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.Aspect.html#CoInductive"><span class="hs-identifier hs-var">CoInductive</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004964"><span class="hs-identifier hs-type">switchEta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyRecEta"><span class="hs-identifier hs-type">modifyRecEta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682004961"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Inferred"><span class="hs-identifier hs-type">Inferred</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#YesEta"><span class="hs-identifier hs-type">YesEta</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-comment">-- | Turn on eta for inductive guarded recursive records.</span><span>
</span><span id="line-531"></span><span class="hs-comment">--   Projections do not preserve guardedness.</span><span>
</span><span id="line-532"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#recursiveRecord"><span class="hs-identifier hs-type">recursiveRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span id="recursiveRecord"><span class="annot"><span class="annottext">recursiveRecord :: QName -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Records.html#recursiveRecord"><span class="hs-identifier hs-var hs-var">recursiveRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Records.html#updateEtaForRecord"><span class="hs-identifier hs-var">updateEtaForRecord</span></a></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="annot"><span class="hs-comment">-- | Turn on eta for non-recursive record, unless user declared otherwise.</span></span><span>
</span><span id="line-536"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#nonRecursiveRecord"><span class="hs-identifier hs-type">nonRecursiveRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span id="nonRecursiveRecord"><span class="annot"><span class="annottext">nonRecursiveRecord :: QName -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Records.html#nonRecursiveRecord"><span class="hs-identifier hs-var hs-var">nonRecursiveRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Records.html#updateEtaForRecord"><span class="hs-identifier hs-var">updateEtaForRecord</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-comment">-- | Check whether record type is marked as recursive.</span><span>
</span><span id="line-540"></span><span class="hs-comment">--</span><span>
</span><span id="line-541"></span><span class="hs-comment">--   Precondition: record type identifier exists in signature.</span><span>
</span><span id="line-542"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#isRecursiveRecord"><span class="hs-identifier hs-type">isRecursiveRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-543"></span><span id="isRecursiveRecord"><span class="annot"><span class="annottext">isRecursiveRecord :: QName -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.Records.html#isRecursiveRecord"><span class="hs-identifier hs-var hs-var">isRecursiveRecord</span></a></span></span><span> </span><span id="local-6989586621682004974"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004974"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Signature
forall (m :: * -&gt; *). ReadTCState m =&gt; m Signature
</span><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-identifier hs-var">getSignature</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Signature
-&gt; (Signature -&gt; Maybe Definition) -&gt; TCMT IO (Maybe Definition)
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Signature -&gt; Maybe Definition
</span><a href="Agda.TypeChecking.Monad.State.html#lookupDefinition"><span class="hs-identifier hs-var">lookupDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682004974"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Definition)
-&gt; (Maybe Definition -&gt; Maybe Defn) -&gt; TCMT IO (Maybe Defn)
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Defn) -&gt; Maybe Definition -&gt; Maybe Defn
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Defn) -&gt; (Maybe Defn -&gt; Bool) -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-545"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordDefn"><span class="hs-identifier hs-type">RecordDefn</span></a></span><span> </span><span id="local-6989586621682004977"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004977"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#recRecursive_"><span class="hs-identifier hs-var">recRecursive_</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682004977"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><span class="annottext">Maybe Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="annot"><span class="hs-comment">{- | @etaExpandBoundVar i = (&#916;, &#963;, &#964;)@

Precondition: The current context is @&#915; = &#915;&#8321;, x:R pars, &#915;&#8322;@ where
  @|&#915;&#8322;| = i@ and @R@ is a eta-expandable record type
  with constructor @c@ and fields @&#915;'@.

Postcondition: @&#916; = &#915;&#8321;, &#915;', &#915;&#8322;[c &#915;']@ and @&#915; &#8866; &#963; : &#916;@ and @&#916; &#8866; &#964; : &#915;@.
-}</span></span><span>
</span><span id="line-556"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandBoundVar"><span class="hs-identifier hs-type">etaExpandBoundVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span id="etaExpandBoundVar"><span class="annot"><span class="annottext">etaExpandBoundVar :: Int -&gt; TCM (Maybe (Telescope, Substitution, Substitution))
</span><a href="Agda.TypeChecking.Records.html#etaExpandBoundVar"><span class="hs-identifier hs-var hs-var">etaExpandBoundVar</span></a></span></span><span> </span><span id="local-6989586621682004980"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004980"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Telescope, Substitution, Substitution, Telescope)
 -&gt; (Telescope, Substitution, Substitution))
-&gt; Maybe (Telescope, Substitution, Substitution, Telescope)
-&gt; Maybe (Telescope, Substitution, Substitution)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682004981"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682004981"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004982"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682004982"><span class="hs-identifier hs-var">sigma</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682004983"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682004983"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682004981"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682004982"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682004983"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Telescope, Substitution, Substitution, Telescope)
 -&gt; Maybe (Telescope, Substitution, Substitution))
-&gt; TCMT
     IO (Maybe (Telescope, Substitution, Substitution, Telescope))
-&gt; TCM (Maybe (Telescope, Substitution, Substitution))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; Telescope
-&gt; TCMT
     IO (Maybe (Telescope, Substitution, Substitution, Telescope))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Int
-&gt; Telescope
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
</span><a href="Agda.TypeChecking.Records.html#expandRecordVar"><span class="hs-identifier hs-var">expandRecordVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682004980"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope
 -&gt; TCMT
      IO (Maybe (Telescope, Substitution, Substitution, Telescope)))
-&gt; TCMT IO Telescope
-&gt; TCMT
     IO (Maybe (Telescope, Substitution, Substitution, Telescope))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="hs-comment">-- | @expandRecordVar i &#915; = (&#916;, &#963;, &#964;, &#915;')@</span><span>
</span><span id="line-561"></span><span class="hs-comment">--</span><span>
</span><span id="line-562"></span><span class="hs-comment">--   Precondition: @&#915; = &#915;&#8321;, x:R pars, &#915;&#8322;@ where</span><span>
</span><span id="line-563"></span><span class="hs-comment">--     @|&#915;&#8322;| = i@ and @R@ is a eta-expandable record type</span><span>
</span><span id="line-564"></span><span class="hs-comment">--     with constructor @c@ and fields @&#915;'@.</span><span>
</span><span id="line-565"></span><span class="hs-comment">--</span><span>
</span><span id="line-566"></span><span class="hs-comment">--   Postcondition: @&#916; = &#915;&#8321;, &#915;', &#915;&#8322;[c &#915;']@ and @&#915; &#8866; &#963; : &#916;@ and @&#916; &#8866; &#964; : &#915;@.</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span id="local-6989586621682003668"><span class="annot"><a href="Agda.TypeChecking.Records.html#expandRecordVar"><span class="hs-identifier hs-type">expandRecordVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003668"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003668"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-569"></span><span id="expandRecordVar"><span class="annot"><span class="annottext">expandRecordVar :: forall (m :: * -&gt; *).
PureTCM m =&gt;
Int
-&gt; Telescope
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
</span><a href="Agda.TypeChecking.Records.html#expandRecordVar"><span class="hs-identifier hs-var hs-var">expandRecordVar</span></a></span></span><span> </span><span id="local-6989586621682005044"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005044"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682005045"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005045"><span class="hs-identifier hs-var">gamma0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-comment">-- Get the context with last variable added last in list.</span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005046"><span class="annot"><span class="annottext">gamma :: [Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005046"><span class="hs-identifier hs-var hs-var hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005045"><span class="hs-identifier hs-var">gamma0</span></a></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-comment">-- Convert the de Bruijn index i to a de Bruijn level</span><span>
</span><span id="line-573"></span><span>      </span><span id="local-6989586621682005048"><span class="annot"><span class="annottext">l :: Int
</span><a href="#local-6989586621682005048"><span class="hs-identifier hs-var hs-var hs-var">l</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005046"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005044"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span class="hs-comment">-- Extract type of @i@th de Bruijn index.</span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-comment">-- &#915; = &#915;&#8321;, x:a, &#915;&#8322;</span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005050"><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005050"><span class="hs-identifier hs-var hs-var">gamma1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005051"><span class="annot"><span class="annottext">dom :: Dom' Term (ArgName, Type)
</span><a href="#local-6989586621682005051"><span class="hs-identifier hs-var hs-var">dom</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005054"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682005054"><span class="hs-identifier hs-var hs-var">ai</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005055"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682005055"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005056"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005056"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682005057"><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005057"><span class="hs-identifier hs-var hs-var">gamma2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Dom' Term (ArgName, Type)]
-&gt; ([Dom' Term (ArgName, Type)], [Dom' Term (ArgName, Type)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005048"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005046"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="hs-comment">-- TODO:: Defined but not used dom, ai</span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-comment">-- This must be a eta-expandable record type.</span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005059"><span class="annot"><span class="annottext">failure :: m (Maybe (Telescope, Substitution, Substitution, Telescope))
</span><a href="#local-6989586621682005059"><span class="hs-identifier hs-var hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.meta.assign.proj&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-580"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;failed to eta-expand variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682005055"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-581"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; since its type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005056"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-582"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; is not a record type&quot;</span></span><span>
</span><span id="line-583"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Telescope, Substitution, Substitution, Telescope)
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Telescope, Substitution, Substitution, Telescope)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-584"></span><span>  </span><span class="annot"><span class="annottext">m (Maybe (QName, Args, RecordData))
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
-&gt; ((QName, Args, RecordData)
    -&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope)))
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; m (Maybe (QName, Args, RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var">isRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005056"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Telescope, Substitution, Substitution, Telescope))
</span><a href="#local-6989586621682005059"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">(((QName, Args, RecordData)
  -&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope)))
 -&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope)))
-&gt; ((QName, Args, RecordData)
    -&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope)))
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005060"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005060"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005061"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005061"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005062"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005062"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-var">isEtaRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005062"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-585"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Telescope, Substitution, Substitution, Telescope)
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Telescope, Substitution, Substitution, Telescope)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-586"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Telescope, Substitution, Substitution, Telescope)
-&gt; Maybe (Telescope, Substitution, Substitution, Telescope)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((Telescope, Substitution, Substitution, Telescope)
 -&gt; Maybe (Telescope, Substitution, Substitution, Telescope))
-&gt; m (Telescope, Substitution, Substitution, Telescope)
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>      </span><span class="hs-comment">-- Get the record fields @&#915;&#8321; &#8866; tel@ (@tel = &#915;'@).</span><span>
</span><span id="line-588"></span><span>      </span><span class="hs-comment">-- TODO: compose argInfo ai with tel.</span><span>
</span><span id="line-589"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005063"><span class="annot"><span class="annottext">tel :: Telescope
</span><a href="#local-6989586621682005063"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Telescope
</span><a href="Agda.TypeChecking.Monad.Base.html#_recTel"><span class="hs-identifier hs-var">_recTel</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005062"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Args -&gt; Telescope
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005061"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-590"></span><span>          </span><span id="local-6989586621682005066"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621682005066"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005063"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-591"></span><span>          </span><span id="local-6989586621682005067"><span class="annot"><span class="annottext">fs :: [Arg QName]
</span><a href="#local-6989586621682005067"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Arg QName) -&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term QName] -&gt; [Arg QName])
-&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005062"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-592"></span><span>      </span><span class="hs-comment">-- Construct the record pattern @&#915;&#8321;, &#915;' &#8866; u := c ys@.</span><span>
</span><span id="line-593"></span><span>          </span><span id="local-6989586621682005068"><span class="annot"><span class="annottext">ys :: Args
</span><a href="#local-6989586621682005068"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; Int -&gt; Arg Term) -&gt; [Arg QName] -&gt; [Int] -&gt; Args
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005070"><span class="annot"><span class="annottext">Arg QName
</span><a href="#local-6989586621682005070"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682005071"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005071"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arg QName
</span><a href="#local-6989586621682005070"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Arg QName -&gt; Term -&gt; Arg Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005071"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682005067"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Args) -&gt; [Int] -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005066"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-594"></span><span>          </span><span id="local-6989586621682005074"><span class="annot"><span class="annottext">u :: Term
</span><a href="#local-6989586621682005074"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Args -&gt; Term
</span><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-var">mkCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005062"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005068"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-595"></span><span>      </span><span class="hs-comment">-- @&#915;&#8321;, &#915;' &#8866; &#964;&#8320; : &#915;&#8321;, x:_@</span><span>
</span><span id="line-596"></span><span>          </span><span id="local-6989586621682005076"><span class="annot"><span class="annottext">tau0 :: Substitution
</span><a href="#local-6989586621682005076"><span class="hs-identifier hs-var hs-var">tau0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Substitution -&gt; Substitution
forall a. DeBruijn a =&gt; a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#consS"><span class="hs-identifier hs-var">consS</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005074"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Substitution -&gt; Substitution) -&gt; Substitution -&gt; Substitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005066"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-597"></span><span>      </span><span class="hs-comment">-- @&#915;&#8321;, &#915;', &#915;&#8322; &#8866; &#964;&#8320; : &#915;&#8321;, x:_, &#915;&#8322;@</span><span>
</span><span id="line-598"></span><span>          </span><span id="local-6989586621682005079"><span class="annot"><span class="annottext">tau :: Substitution
</span><a href="#local-6989586621682005079"><span class="hs-identifier hs-var hs-var">tau</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005057"><span class="hs-identifier hs-var">gamma2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682005076"><span class="hs-identifier hs-var">tau0</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>      </span><span class="hs-comment">--  Fields are in order first-first.</span><span>
</span><span id="line-601"></span><span>          </span><span id="local-6989586621682005081"><span class="annot"><span class="annottext">zs :: Args
</span><a href="#local-6989586621682005081"><span class="hs-identifier hs-var hs-var">zs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg QName] -&gt; (Arg QName -&gt; Arg Term) -&gt; Args
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682005067"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">((Arg QName -&gt; Arg Term) -&gt; Args)
-&gt; (Arg QName -&gt; Arg Term) -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term)
-&gt; (QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005082"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005082"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005082"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-602"></span><span>      </span><span class="hs-comment">--  We need to reverse the field sequence to build the substitution.</span><span>
</span><span id="line-603"></span><span>      </span><span class="hs-comment">-- @&#915;&#8321;, x:_ &#8866; &#963;&#8320; : &#915;&#8321;, &#915;'@</span><span>
</span><span id="line-604"></span><span>          </span><span id="local-6989586621682005085"><span class="annot"><span class="annottext">sigma0 :: Substitution
</span><a href="#local-6989586621682005085"><span class="hs-identifier hs-var hs-var">sigma0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; Args -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005081"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution -&gt; Substitution
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#%2B%2B%23"><span class="hs-operator hs-var">++#</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-605"></span><span>      </span><span class="hs-comment">-- @&#915;&#8321;, x:_, &#915;&#8322; &#8866; &#963;&#8320; : &#915;&#8321;, &#915;', &#915;&#8322;@</span><span>
</span><span id="line-606"></span><span>          </span><span id="local-6989586621682005088"><span class="annot"><span class="annottext">sigma :: Substitution
</span><a href="#local-6989586621682005088"><span class="hs-identifier hs-var hs-var">sigma</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005057"><span class="hs-identifier hs-var">gamma2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682005085"><span class="hs-identifier hs-var">sigma0</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span>      </span><span class="hs-comment">-- Construct @&#916;@ as telescope.</span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-comment">-- Note @&#915;&#8321;, x:_ &#8866; &#915;&#8322;@, thus, @&#915;&#8321;, &#915;' &#8866; [&#964;&#8320;]&#915;&#8322;@</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>          </span><span class="hs-comment">-- Use &quot;f(x)&quot; as variable name for the projection f(x).</span><span>
</span><span id="line-612"></span><span>          </span><span id="local-6989586621682005089"><span class="annot"><span class="annottext">s :: ArgName
</span><a href="#local-6989586621682005089"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682005055"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-613"></span><span>          </span><span id="local-6989586621682005090"><span class="annot"><span class="annottext">tel' :: Telescope
</span><a href="#local-6989586621682005090"><span class="hs-identifier hs-var hs-var">tel'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; ArgName) -&gt; Telescope -&gt; Telescope
forall a. (ArgName -&gt; ArgName) -&gt; Tele a -&gt; Tele a
</span><a href="Agda.Syntax.Internal.html#mapAbsNames"><span class="hs-identifier hs-var">mapAbsNames</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005092"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682005092"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName
</span><a href="Agda.Syntax.Common.html#stringToArgName"><span class="hs-identifier hs-var">stringToArgName</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; ArgName) -&gt; ArgName -&gt; ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName
</span><a href="Agda.Syntax.Common.html#argNameToString"><span class="hs-identifier hs-var">argNameToString</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682005092"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682005089"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005063"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-614"></span><span>          </span><span id="local-6989586621682005095"><span class="annot"><span class="annottext">delta :: Telescope
</span><a href="#local-6989586621682005095"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; Telescope)
-&gt; [Dom' Term (ArgName, Type)] -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005050"><span class="hs-identifier hs-var">gamma1</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005090"><span class="hs-identifier hs-var">tel'</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-615"></span><span>                    </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg Telescope) -&gt; Telescope -&gt; Telescope
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Telescope)
</span><a href="#local-6989586621682005076"><span class="hs-identifier hs-var">tau0</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; Telescope) -&gt; Telescope -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621682005057"><span class="hs-identifier hs-var">gamma2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>                    </span><span class="hs-comment">-- Andreas, 2017-07-29, issue #2644</span><span>
</span><span id="line-617"></span><span>                    </span><span class="hs-comment">-- We cannot substitute directly into a ListTel like gamma2,</span><span>
</span><span id="line-618"></span><span>                    </span><span class="hs-comment">-- we have to convert it to a telescope first, otherwise we get garbage.</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>      </span><span class="annot"><span class="annottext">(Telescope, Substitution, Substitution, Telescope)
-&gt; m (Telescope, Substitution, Substitution, Telescope)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005095"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682005088"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682005079"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005063"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><span class="hs-comment">-- | Precondition: variable list is ordered descendingly.  Can be empty.</span></span><span>
</span><span id="line-623"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#expandRecordVarsRecursively"><span class="hs-identifier hs-type">expandRecordVarsRecursively</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span id="expandRecordVarsRecursively"><span class="annot"><span class="annottext">expandRecordVarsRecursively :: [Int] -&gt; Telescope -&gt; TCM (Telescope, Substitution, Substitution)
</span><a href="Agda.TypeChecking.Records.html#expandRecordVarsRecursively"><span class="hs-identifier hs-var hs-var">expandRecordVarsRecursively</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682005099"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005099"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Telescope, Substitution, Substitution)
-&gt; TCM (Telescope, Substitution, Substitution)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005099"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#expandRecordVarsRecursively"><span class="hs-identifier hs-var">expandRecordVarsRecursively</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005101"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682005102"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682005102"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682005103"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005103"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Maybe (Telescope, Substitution, Substitution, Telescope))
-&gt; TCM (Telescope, Substitution, Substitution)
-&gt; ((Telescope, Substitution, Substitution, Telescope)
    -&gt; TCM (Telescope, Substitution, Substitution))
-&gt; TCM (Telescope, Substitution, Substitution)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Telescope
-&gt; TCMT
     IO (Maybe (Telescope, Substitution, Substitution, Telescope))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Int
-&gt; Telescope
-&gt; m (Maybe (Telescope, Substitution, Substitution, Telescope))
</span><a href="Agda.TypeChecking.Records.html#expandRecordVar"><span class="hs-identifier hs-var">expandRecordVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005101"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005103"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Telescope -&gt; TCM (Telescope, Substitution, Substitution)
</span><a href="Agda.TypeChecking.Records.html#expandRecordVarsRecursively"><span class="hs-identifier hs-var">expandRecordVarsRecursively</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682005102"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005103"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><span class="annottext">(((Telescope, Substitution, Substitution, Telescope)
  -&gt; TCM (Telescope, Substitution, Substitution))
 -&gt; TCM (Telescope, Substitution, Substitution))
-&gt; ((Telescope, Substitution, Substitution, Telescope)
    -&gt; TCM (Telescope, Substitution, Substitution))
-&gt; TCM (Telescope, Substitution, Substitution)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005104"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005104"><span class="hs-identifier hs-var">gamma1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005105"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682005105"><span class="hs-identifier hs-var">sigma1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005106"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682005106"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005107"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005107"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-628"></span><span>    </span><span class="hs-comment">-- &#915; &#8866; &#963;&#8321; : &#915;&#8321;  and  &#915;&#8321; &#8866; &#964;&#8321; : &#915;</span><span>
</span><span id="line-629"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005108"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682005108"><span class="hs-identifier hs-var hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005107"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-630"></span><span>        </span><span id="local-6989586621682005109"><span class="annot"><span class="annottext">newis :: [Int]
</span><a href="#local-6989586621682005109"><span class="hs-identifier hs-var hs-var hs-var">newis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005108"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005101"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005108"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682005111"><span class="annot"><a href="#local-6989586621682005111"><span class="hs-identifier hs-var">gamma2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005112"><span class="annot"><a href="#local-6989586621682005112"><span class="hs-identifier hs-var">sigma2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005113"><span class="annot"><a href="#local-6989586621682005113"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Telescope -&gt; TCM (Telescope, Substitution, Substitution)
</span><a href="Agda.TypeChecking.Records.html#expandRecordVarsRecursively"><span class="hs-identifier hs-var">expandRecordVarsRecursively</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682005109"><span class="hs-identifier hs-var">newis</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682005102"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005104"><span class="hs-identifier hs-var">gamma1</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-comment">-- &#915;&#8321; &#8866; &#963;&#8322; : &#915;&#8322;  and  &#915;&#8322; &#8866; &#964;&#8322; : &#915;&#8321;</span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005111"><span class="hs-identifier hs-type">gamma2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005105"><span class="hs-identifier hs-type">sigma1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005112"><span class="hs-identifier hs-type">sigma2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005113"><span class="hs-identifier hs-type">tau2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005106"><span class="hs-identifier hs-type">tau1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="hs-comment">-- | @curryAt v (&#915; (y : R pars) -&gt; B) n =</span><span>
</span><span id="line-636"></span><span class="hs-comment">--     ( \ v -&gt; &#955; &#915; ys &#8594; v &#915; (c ys)            {- curry   -}</span><span>
</span><span id="line-637"></span><span class="hs-comment">--     , \ v -&gt; &#955; &#915; y &#8594; v &#915; (p1 y) ... (pm y)  {- uncurry -}</span><span>
</span><span id="line-638"></span><span class="hs-comment">--     , &#915; (ys : As) &#8594; B[c ys / y]</span><span>
</span><span id="line-639"></span><span class="hs-comment">--     )@</span><span>
</span><span id="line-640"></span><span class="hs-comment">--</span><span>
</span><span id="line-641"></span><span class="hs-comment">--   where @n = size &#915;@.</span><span>
</span><span id="line-642"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#curryAt"><span class="hs-identifier hs-type">curryAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span id="curryAt"><span class="annot"><span class="annottext">curryAt :: Type -&gt; Int -&gt; TCM (Term -&gt; Term, Term -&gt; Term, Type)
</span><a href="Agda.TypeChecking.Records.html#curryAt"><span class="hs-identifier hs-var hs-var">curryAt</span></a></span></span><span> </span><span id="local-6989586621682005115"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005115"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682005116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005116"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-comment">-- first, strip the leading n domains (which remain unchanged)</span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682005118"><span class="annot"><a href="#local-6989586621682005118"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span id="local-6989586621682005119"><span class="annot"><a href="#local-6989586621682005119"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Int -&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewUpTo"><span class="hs-identifier hs-var">telViewUpTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005116"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005115"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005119"><span class="hs-identifier hs-type">core</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-comment">-- There should be at least one domain left</span><span>
</span><span id="line-648"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005122"><span class="annot"><span class="annottext">dom :: Dom' Term Type
</span><a href="#local-6989586621682005122"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005123"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682005123"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005124"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005124"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682005125"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682005125"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>      </span><span class="hs-comment">-- Eta-expand @dom@ along @qs@ into a telescope @tel@, computing a substitution.</span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-comment">-- For now, we only eta-expand once.</span><span>
</span><span id="line-651"></span><span>      </span><span class="hs-comment">-- This might trigger another call to @etaExpandProjectedVar@ later.</span><span>
</span><span id="line-652"></span><span>      </span><span class="hs-comment">-- A more efficient version does all the eta-expansions at once here.</span><span>
</span><span id="line-653"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682005126"><span class="annot"><a href="#local-6989586621682005126"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005127"><span class="annot"><a href="#local-6989586621682005127"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005128"><span class="annot"><a href="#local-6989586621682005128"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName, Args, RecordData)
-&gt; Maybe (QName, Args, RecordData) -&gt; (QName, Args, RecordData)
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">(QName, Args, RecordData)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, Args, RecordData) -&gt; (QName, Args, RecordData))
-&gt; TCMT IO (Maybe (QName, Args, RecordData))
-&gt; TCMT IO (QName, Args, RecordData)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe (QName, Args, RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var">isRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005124"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NoEta"><span class="hs-identifier hs-type">NoEta</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_recEtaEquality"><span class="hs-identifier hs-type">_recEtaEquality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005128"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-655"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>      </span><span class="hs-comment">-- TODO: compose argInfo ai with tel.</span><span>
</span><span id="line-657"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005129"><span class="annot"><a href="#local-6989586621682005129"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Telescope
</span><a href="Agda.TypeChecking.Monad.Base.html#_recTel"><span class="hs-identifier hs-var">_recTel</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005128"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Args -&gt; Telescope
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005127"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-658"></span><span>          </span><span id="local-6989586621682005130"><span class="annot"><a href="#local-6989586621682005130"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005129"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-659"></span><span>          </span><span id="local-6989586621682005131"><span class="annot"><a href="#local-6989586621682005131"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Arg QName) -&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term QName] -&gt; [Arg QName])
-&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005128"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-660"></span><span>          </span><span id="local-6989586621682005132"><span class="annot"><a href="#local-6989586621682005132"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; Int -&gt; Arg Term) -&gt; [Arg QName] -&gt; [Int] -&gt; Args
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005133"><span class="annot"><span class="annottext">Arg QName
</span><a href="#local-6989586621682005133"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682005134"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005134"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arg QName
</span><a href="#local-6989586621682005133"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Arg QName -&gt; Term -&gt; Arg Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005134"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682005131"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Args) -&gt; [Int] -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005130"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-661"></span><span>          </span><span id="local-6989586621682005135"><span class="annot"><a href="#local-6989586621682005135"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Args -&gt; Term
</span><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-var">mkCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillRangeT ConHead
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">KillRangeT ConHead -&gt; KillRangeT ConHead
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005128"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005132"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-662"></span><span>          </span><span id="local-6989586621682005136"><span class="annot"><a href="#local-6989586621682005136"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Abs Type -&gt; Abs Type
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005130"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682005125"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; SubstArg Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-operator hs-var">`absApp`</span></a></span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Type
</span><a href="#local-6989586621682005135"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-663"></span><span>          </span><span id="local-6989586621682005138"><span class="annot"><a href="#local-6989586621682005138"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005118"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#telePi"><span class="hs-operator hs-var">`telePi`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005129"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#telePi"><span class="hs-operator hs-var">`telePi`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005136"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>          </span><span id="local-6989586621682005140"><span class="annot"><a href="#local-6989586621682005140"><span class="hs-identifier hs-var hs-var">gammai</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; ArgInfo)
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; ArgInfo
forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [ArgInfo])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005118"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-665"></span><span>          </span><span id="local-6989586621682005141"><span class="annot"><a href="#local-6989586621682005141"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Args
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Args) -&gt; Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; Int -&gt; Arg Term) -&gt; [ArgInfo] -&gt; [Int] -&gt; Args
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005142"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682005142"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682005143"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005143"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682005142"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; Term -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005143"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682005140"><span class="hs-identifier hs-var">gammai</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005130"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-666"></span><span>          </span><span id="local-6989586621682005145"><span class="annot"><a href="#local-6989586621682005145"><span class="hs-identifier hs-var hs-var">curry</span></a></span></span><span> </span><span id="local-6989586621682005146"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005146"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
</span><a href="Agda.TypeChecking.Substitute.html#teleLam"><span class="hs-identifier hs-var">teleLam</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005118"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
</span><a href="Agda.TypeChecking.Substitute.html#teleLam"><span class="hs-identifier hs-var">teleLam</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005129"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-667"></span><span>                      </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; Term
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005116"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005130"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005146"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Args -&gt; Term
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005141"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; Args -&gt; Args
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682005123"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005135"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>          </span><span id="local-6989586621682005148"><span class="annot"><a href="#local-6989586621682005148"><span class="hs-identifier hs-var hs-var">zs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg QName] -&gt; (Arg QName -&gt; Arg Term) -&gt; Args
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682005131"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">((Arg QName -&gt; Arg Term) -&gt; Args)
-&gt; (Arg QName -&gt; Arg Term) -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term)
-&gt; (QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005149"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005149"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005149"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-669"></span><span>          </span><span id="local-6989586621682005150"><span class="annot"><a href="#local-6989586621682005150"><span class="hs-identifier hs-var hs-var">atel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; Telescope
forall a. SgTel a =&gt; a -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#sgTel"><span class="hs-identifier hs-var">sgTel</span></a></span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; Telescope)
-&gt; Dom' Term (ArgName, Type) -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Type -&gt; ArgName
forall a. Abs a -&gt; ArgName
</span><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var">absName</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682005125"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; (ArgName, Type))
-&gt; Dom' Term Type -&gt; Dom' Term (ArgName, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005122"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-670"></span><span>          </span><span id="local-6989586621682005153"><span class="annot"><a href="#local-6989586621682005153"><span class="hs-identifier hs-var hs-var">uncurry</span></a></span></span><span> </span><span id="local-6989586621682005154"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005154"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
</span><a href="Agda.TypeChecking.Substitute.html#teleLam"><span class="hs-identifier hs-var">teleLam</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005118"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
</span><a href="Agda.TypeChecking.Substitute.html#teleLam"><span class="hs-identifier hs-var">teleLam</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005150"><span class="hs-identifier hs-var">atel</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-671"></span><span>                        </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; Term
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005116"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005154"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Args -&gt; Term
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005141"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; Args -&gt; Args
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005148"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005145"><span class="hs-identifier hs-type">curry</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682005153"><span class="hs-identifier hs-type">uncurry</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682005138"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Term -&gt; Term, Term -&gt; Term, Type)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="annot"><span class="hs-comment">{-| @etaExpand r pars u@ computes the eta expansion of record value @u@
    at record type @r pars@.

    The first argument @r@ should be the name of an eta-expandable record type.
    Given

      @record R : Set where field x : A; y : B; .z : C@

    and @r : R@,

      @etaExpand R [] r = (tel, [R.x r, R.y r, R.z r])@

    where @tel@ is the record telescope instantiated at the parameters @pars@.
-}</span></span><span>
</span><span id="line-689"></span><span id="local-6989586621682003702"><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandRecord"><span class="hs-identifier hs-type">etaExpandRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003702"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003702"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003702"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Name of record type.</span></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Parameters applied to record type.</span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Term to eta-expand.</span></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003702"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-694"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Field types instantiated to parameters, field values.</span></span><span>
</span><span id="line-695"></span><span id="etaExpandRecord"><span class="annot"><span class="annottext">etaExpandRecord :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m, ReadTCState m) =&gt;
QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord"><span class="hs-identifier hs-var hs-var">etaExpandRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m, ReadTCState m) =&gt;
Bool -&gt; QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27"><span class="hs-identifier hs-var">etaExpandRecord'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="annot"><span class="hs-comment">-- | Eta expand a record regardless of whether it's an eta-record or not.</span></span><span>
</span><span id="line-698"></span><span id="local-6989586621682003705"><span class="annot"><a href="Agda.TypeChecking.Records.html#forceEtaExpandRecord"><span class="hs-identifier hs-type">forceEtaExpandRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003705"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003705"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003705"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003705"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Name of record type.</span></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Parameters applied to record type.</span></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Term to eta-expand.</span></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003705"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-703"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Field types instantiated to parameters, field values.</span></span><span>
</span><span id="line-704"></span><span id="forceEtaExpandRecord"><span class="annot"><span class="annottext">forceEtaExpandRecord :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m, ReadTCState m,
 MonadError TCErr m) =&gt;
QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
</span><a href="Agda.TypeChecking.Records.html#forceEtaExpandRecord"><span class="hs-identifier hs-var hs-var">forceEtaExpandRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m, ReadTCState m) =&gt;
Bool -&gt; QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27"><span class="hs-identifier hs-var">etaExpandRecord'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="annot"><span class="hs-comment">-- | Eta-expand a value at the given record type (must match).</span></span><span>
</span><span id="line-707"></span><span id="local-6989586621682003704"><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27"><span class="hs-identifier hs-type">etaExpandRecord'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003704"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003704"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003704"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Force expansion, overriding '_recEtaEquality'?</span></span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Name of record type.</span></span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Parameters applied to record type.</span></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Term to eta-expand.</span></span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003704"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-713"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Field types instantiated to parameters, field values.</span></span><span>
</span><span id="line-714"></span><span id="etaExpandRecord%27"><span class="annot"><span class="annottext">etaExpandRecord' :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m, ReadTCState m) =&gt;
Bool -&gt; QName -&gt; Args -&gt; Term -&gt; m (Telescope, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27"><span class="hs-identifier hs-var hs-var">etaExpandRecord'</span></a></span></span><span> </span><span id="local-6989586621682005185"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005185"><span class="hs-identifier hs-var">forceEta</span></a></span></span><span> </span><span id="local-6989586621682005186"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005186"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682005187"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005187"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span id="local-6989586621682005188"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005188"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>  </span><span id="local-6989586621682005189"><span class="annot"><a href="#local-6989586621682005189"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Maybe RecordData -&gt; RecordData
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">RecordData
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe RecordData -&gt; RecordData)
-&gt; m (Maybe RecordData) -&gt; m RecordData
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005186"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682005190"><span class="annot"><a href="#local-6989586621682005190"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005191"><span class="annot"><a href="#local-6989586621682005191"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27_"><span class="hs-identifier hs-type">etaExpandRecord'_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005185"><span class="hs-identifier hs-type">forceEta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005186"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005187"><span class="hs-identifier hs-type">pars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005189"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005188"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005190"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682005191"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="annot"><span class="hs-comment">-- | Eta-expand a value at the given eta record type (must match).</span></span><span>
</span><span id="line-720"></span><span id="local-6989586621682003710"><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandRecord_"><span class="hs-identifier hs-type">etaExpandRecord_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003710"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Name of record type.</span></span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Parameters applied to record type.</span></span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Definition of record type.</span></span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Term to eta-expand.</span></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003710"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-726"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Field types instantiated to parameters, disassembled constructor term.</span></span><span>
</span><span id="line-727"></span><span id="etaExpandRecord_"><span class="annot"><span class="annottext">etaExpandRecord_ :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName
-&gt; Args
-&gt; RecordData
-&gt; Term
-&gt; m (Telescope, ConHead, ConInfo, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord_"><span class="hs-identifier hs-var hs-var">etaExpandRecord_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; QName
-&gt; Args
-&gt; RecordData
-&gt; Term
-&gt; m (Telescope, ConHead, ConInfo, Args)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
Bool
-&gt; QName
-&gt; Args
-&gt; RecordData
-&gt; Term
-&gt; m (Telescope, ConHead, ConInfo, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27_"><span class="hs-identifier hs-var">etaExpandRecord'_</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span class="annot"><span class="hs-comment">-- | Eta-expand a value at the given record type (must match).</span></span><span>
</span><span id="line-730"></span><span id="local-6989586621682003709"><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27_"><span class="hs-identifier hs-type">etaExpandRecord'_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003709"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Force expansion, overriding '_recEtaEquality'?</span></span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Name of record type.</span></span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Parameters applied to record type.</span></span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Definition of record type.</span></span><span>
</span><span id="line-735"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Term to eta-expand.</span></span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003709"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-737"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Field types instantiated to parameters, disassembled constructor term.</span></span><span>
</span><span id="line-738"></span><span id="etaExpandRecord%27_"><span class="annot"><span class="annottext">etaExpandRecord'_ :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
Bool
-&gt; QName
-&gt; Args
-&gt; RecordData
-&gt; Term
-&gt; m (Telescope, ConHead, ConInfo, Args)
</span><a href="Agda.TypeChecking.Records.html#etaExpandRecord%27_"><span class="hs-identifier hs-var hs-var">etaExpandRecord'_</span></a></span></span><span> </span><span id="local-6989586621682005269"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005269"><span class="hs-identifier hs-var">forceEta</span></a></span></span><span> </span><span id="local-6989586621682005270"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005270"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682005271"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005271"><span class="hs-identifier hs-var">pars</span></a></span></span><span>
</span><span id="line-739"></span><span>    </span><span id="local-6989586621682005272"><span class="annot"><span class="annottext">def :: RecordData
</span><a href="#local-6989586621682005272"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_recConHead :: RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005274"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005274"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_recFields :: RecordData -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005275"><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682005275"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_recTel :: RecordData -&gt; Telescope
</span><a href="Agda.TypeChecking.Monad.Base.html#_recTel"><span class="hs-identifier hs-var">_recTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005276"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005276"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-740"></span><span>    </span><span id="local-6989586621682005277"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005277"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005278"><span class="annot"><span class="annottext">tel' :: Telescope
</span><a href="#local-6989586621682005278"><span class="hs-identifier hs-var hs-var hs-var">tel'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Args -&gt; Telescope
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005276"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005271"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-comment">-- Make sure we do not expand non-eta records (unless forced to):</span><span>
</span><span id="line-743"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; HasEta
</span><a href="Agda.TypeChecking.Monad.Base.html#_recEtaEquality"><span class="hs-identifier hs-var">_recEtaEquality</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005272"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">HasEta -&gt; HasEta -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HasEta
forall a. HasEta' a
</span><a href="Agda.Syntax.Common.html#YesEta"><span class="hs-identifier hs-var">YesEta</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005269"><span class="hs-identifier hs-var">forceEta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005277"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>    </span><span class="hs-comment">-- Already expanded.</span><span>
</span><span id="line-747"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682005279"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005279"><span class="hs-identifier hs-var">con_</span></a></span></span><span> </span><span id="local-6989586621682005280"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682005280"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682005281"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005281"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-748"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005282"><span class="annot"><span class="annottext">args :: Args
</span><a href="#local-6989586621682005282"><span class="hs-identifier hs-var hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005281"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-749"></span><span>      </span><span class="hs-comment">-- Andreas, 2019-10-21, issue #4148</span><span>
</span><span id="line-750"></span><span>      </span><span class="hs-comment">-- @con == con_@ might fail, but their normal forms should be equal.</span><span>
</span><span id="line-751"></span><span>      </span><span class="annot"><span class="annottext">m (Maybe QName) -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenNothingM"><span class="hs-identifier hs-var">whenNothingM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005274"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; m (Maybe QName)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; QName -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Signature.html#sameDef"><span class="hs-operator hs-var">`sameDef`</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005279"><span class="hs-identifier hs-var">con_</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-752"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-753"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;etaExpandRecord_: the following two constructors should be identical&quot;</span></span><span>
</span><span id="line-754"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;con  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005274"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-755"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;con_ = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005279"><span class="hs-identifier hs-var">con_</span></a></span><span>
</span><span id="line-756"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-757"></span><span>        </span><span class="annot"><span class="annottext">m ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-758"></span><span>      </span><span class="annot"><span class="annottext">(Telescope, ConHead, ConInfo, Args)
-&gt; m (Telescope, ConHead, ConInfo, Args)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005278"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005274"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682005280"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005282"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-comment">-- Not yet expanded.</span><span>
</span><span id="line-761"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-762"></span><span>      </span><span class="hs-comment">-- Andreas, &lt; 2016-01-18: Note: recFields are always the original projections,</span><span>
</span><span id="line-763"></span><span>      </span><span class="hs-comment">-- thus, we can use them in Proj directly.</span><span>
</span><span id="line-764"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005286"><span class="annot"><span class="annottext">xs' :: Args
</span><a href="#local-6989586621682005286"><span class="hs-identifier hs-var hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg QName] -&gt; (Arg QName -&gt; Arg Term) -&gt; Args
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Arg QName) -&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682005275"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Arg QName -&gt; Arg Term) -&gt; Args)
-&gt; (Arg QName -&gt; Arg Term) -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term)
-&gt; (QName -&gt; Term) -&gt; Arg QName -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005287"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005287"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005277"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005287"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-765"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.record.eta&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-766"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;eta expanding&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005277"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005270"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-767"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-768"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;tel' =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005278"><span class="hs-identifier hs-var">tel'</span></a></span><span>
</span><span id="line-769"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;args =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Args -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005286"><span class="hs-identifier hs-var">xs'</span></a></span><span>
</span><span id="line-770"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-771"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-772"></span><span>      </span><span class="annot"><span class="annottext">(Telescope, ConHead, ConInfo, Args)
-&gt; m (Telescope, ConHead, ConInfo, Args)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005278"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005274"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005286"><span class="hs-identifier hs-var">xs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandAtRecordType"><span class="hs-identifier hs-type">etaExpandAtRecordType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span id="etaExpandAtRecordType"><span class="annot"><span class="annottext">etaExpandAtRecordType :: Type -&gt; Term -&gt; TCM (Telescope, Term)
</span><a href="Agda.TypeChecking.Records.html#etaExpandAtRecordType"><span class="hs-identifier hs-var hs-var">etaExpandAtRecordType</span></a></span></span><span> </span><span id="local-6989586621682005289"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005289"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682005290"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005290"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682005291"><span class="annot"><a href="#local-6989586621682005291"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005292"><span class="annot"><a href="#local-6989586621682005292"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005293"><span class="annot"><a href="#local-6989586621682005293"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName, Args, RecordData)
-&gt; Maybe (QName, Args, RecordData) -&gt; (QName, Args, RecordData)
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">(QName, Args, RecordData)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, Args, RecordData) -&gt; (QName, Args, RecordData))
-&gt; TCMT IO (Maybe (QName, Args, RecordData))
-&gt; TCMT IO (QName, Args, RecordData)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe (QName, Args, RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var">isRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005289"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682005294"><span class="annot"><a href="#local-6989586621682005294"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005295"><span class="annot"><a href="#local-6989586621682005295"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005296"><span class="annot"><a href="#local-6989586621682005296"><span class="hs-identifier hs-var">ci</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005297"><span class="annot"><a href="#local-6989586621682005297"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#etaExpandRecord_"><span class="hs-identifier hs-type">etaExpandRecord_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005291"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005292"><span class="hs-identifier hs-type">pars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005293"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005290"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005294"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-type">mkCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005295"><span class="hs-identifier hs-type">con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005296"><span class="hs-identifier hs-type">ci</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005297"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="hs-comment">-- | The fields should be eta contracted already.</span><span>
</span><span id="line-781"></span><span class="hs-comment">--</span><span>
</span><span id="line-782"></span><span class="hs-comment">--   We can eta contract if all fields @f = ...@ are irrelevant</span><span>
</span><span id="line-783"></span><span class="hs-comment">--   or all fields @f@ are the projection @f v@ of the same value @v@,</span><span>
</span><span id="line-784"></span><span class="hs-comment">--   but we need at least one relevant field to find the value @v@.</span><span>
</span><span id="line-785"></span><span class="hs-comment">--</span><span>
</span><span id="line-786"></span><span class="hs-comment">--   If all fields are erased, we cannot eta-contract.</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="hs-comment">--   Andreas, 2019-11-06, issue #4168: eta-contraction all-erased record</span><span>
</span><span id="line-789"></span><span class="hs-comment">--   lead to compilation error.</span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span class="hs-comment">--   TODO: this can be moved out of TCM.</span><span>
</span><span id="line-792"></span><span class="hs-comment">--   Andreas, 2018-01-28: attempted just that, but Auto does not</span><span>
</span><span id="line-793"></span><span class="hs-comment">--   put the conFields there (it does not run in TCM).</span><span>
</span><span id="line-794"></span><span class="hs-comment">--   If we get rid of Auto, we can do this.  (Tests not involving Auto pass.)</span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#etaContractRecord"><span class="hs-pragma hs-type">etaContractRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-pragma hs-type">ConHead</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-pragma hs-type">ConInfo</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-pragma hs-type">Args</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-pragma hs-type">Term</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-797"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#etaContractRecord"><span class="hs-pragma hs-type">etaContractRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-pragma hs-type">ConHead</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-pragma hs-type">ConInfo</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-pragma hs-type">Args</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-pragma hs-type">ReduceM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-pragma hs-type">Term</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-798"></span><span id="local-6989586621682003718"><span class="annot"><a href="Agda.TypeChecking.Records.html#etaContractRecord"><span class="hs-identifier hs-type">etaContractRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span></span><span>
</span><span id="line-799"></span><span id="etaContractRecord"><span class="annot"><span class="annottext">etaContractRecord :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; ConHead -&gt; ConInfo -&gt; Args -&gt; m Term
</span><a href="Agda.TypeChecking.Records.html#etaContractRecord"><span class="hs-identifier hs-var hs-var">etaContractRecord</span></a></span></span><span> </span><span id="local-6989586621682005366"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005366"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682005367"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005367"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682005368"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682005368"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682005369"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005369"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Bool) -&gt; Args -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Arg Term -&gt; Bool) -&gt; Arg Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Bool
forall a. LensModality a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#usableModality"><span class="hs-identifier hs-var">usableModality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005369"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Term
</span><a href="#local-6989586621682005372"><span class="hs-identifier hs-var">fallBack</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682005373"><span class="annot"><a href="#local-6989586621682005373"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Maybe RecordData -&gt; RecordData
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">RecordData
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe RecordData -&gt; RecordData)
-&gt; m (Maybe RecordData) -&gt; m RecordData
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005366"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-801"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.record.eta.contract&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;eta contracting record&quot;</span></span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;record type r  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005366"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-805"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;constructor c  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005367"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;field names xs =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621682005373"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-807"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;fields    args =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005369"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-808"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682005369"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682005373"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Term
</span><a href="#local-6989586621682005372"><span class="hs-identifier hs-var">fallBack</span></a></span><span>       </span><span class="hs-comment">-- Not fully applied</span><span>
</span><span id="line-812"></span><span>    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-comment">-- Too many arguments. Impossible.</span><span>
</span><span id="line-813"></span><span>    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-814"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Dom' Term QName -&gt; Maybe (Maybe Term))
-&gt; Args -&gt; [Dom' Term QName] -&gt; Maybe [Maybe Term]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Dom' Term QName -&gt; Maybe (Maybe Term)
</span><a href="#local-6989586621682005376"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005369"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682005373"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682005377"><span class="annot"><span class="annottext">[Maybe Term]
</span><a href="#local-6989586621682005377"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe Term] -&gt; [Term]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Term]
</span><a href="#local-6989586621682005377"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-816"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682005378"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005378"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682005379"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682005379"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-817"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool) -&gt; [Term] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005378"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682005379"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-818"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005378"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-819"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m Term
</span><a href="#local-6989586621682005372"><span class="hs-identifier hs-var">fallBack</span></a></span><span>
</span><span id="line-820"></span><span>          </span><span class="annot"><span class="annottext">[Term]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Term
</span><a href="#local-6989586621682005372"><span class="hs-identifier hs-var">fallBack</span></a></span><span> </span><span class="hs-comment">-- just irrelevant terms</span><span>
</span><span id="line-821"></span><span>        </span><span class="annot"><span class="annottext">Maybe [Maybe Term]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Term
</span><a href="#local-6989586621682005372"><span class="hs-identifier hs-var">fallBack</span></a></span><span>  </span><span class="hs-comment">-- a Nothing</span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-823"></span><span>  </span><span id="local-6989586621682005372"><span class="annot"><span class="annottext">fallBack :: m Term
</span><a href="#local-6989586621682005372"><span class="hs-identifier hs-var hs-var">fallBack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Args -&gt; Term
</span><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-var">mkCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005367"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682005368"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005369"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>  </span><span class="annot"><a href="#local-6989586621682005376"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>  </span><span id="local-6989586621682005376"><span class="annot"><span class="annottext">check :: Arg Term -&gt; Dom' Term QName -&gt; Maybe (Maybe Term)
</span><a href="#local-6989586621682005376"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682005380"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682005380"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682005381"><span class="annot"><span class="annottext">Dom' Term QName
</span><a href="#local-6989586621682005381"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-comment">-- @a@ is the constructor argument, @ax@ the corr. record field name</span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-comment">-- skip irrelevant record fields by returning DontCare</span><span>
</span><span id="line-828"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Term -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682005380"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Maybe (Elims -&gt; Term, Elims)
</span><a href="Agda.Syntax.Internal.html#hasElims"><span class="hs-identifier hs-var">hasElims</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Maybe (Elims -&gt; Term, Elims))
-&gt; Term -&gt; Maybe (Elims -&gt; Term, Elims)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682005380"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Irrelevant"><span class="hs-identifier hs-type">Irrelevant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Elims -&gt; Term, Elims)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Maybe (Maybe Term)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-comment">-- if @a@ is the record field name applied to a single argument</span><span>
</span><span id="line-831"></span><span>      </span><span class="hs-comment">-- then it passes the check</span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relevance
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe Term)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-comment">-- not a projection</span><span>
</span><span id="line-833"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relevance
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005385"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682005385"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005386"><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682005386"><span class="hs-identifier hs-var">e0</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682005387"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005387"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682005388"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005388"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682005389"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682005389"><span class="hs-identifier hs-var">_o</span></a></span></span><span> </span><span id="local-6989586621682005390"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005390"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Elim -&gt; Elims -&gt; (Elims, Elim)
forall a. a -&gt; [a] -&gt; ([a], a)
</span><a href="Agda.Utils.List.html#initLast1"><span class="hs-identifier hs-var">initLast1</span></a></span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682005386"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005387"><span class="hs-identifier hs-var">es0</span></a></span><span>
</span><span id="line-835"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; QName
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName
</span><a href="#local-6989586621682005381"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005390"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Maybe (Maybe Term)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Term -&gt; Maybe (Maybe Term))
-&gt; Maybe Term -&gt; Maybe (Maybe Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Maybe Term
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Maybe Term) -&gt; Term -&gt; Maybe Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682005385"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005388"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-836"></span><span>      </span><span class="annot"><span class="annottext">(Relevance, Maybe (Elims -&gt; Term, Elims))
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe Term)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonRecord"><span class="hs-pragma hs-type">isSingletonRecord</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-pragma hs-type">Args</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Bool</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-839"></span><span class="hs-comment">-- | Is the type a hereditarily singleton record type? May return a</span><span>
</span><span id="line-840"></span><span class="hs-comment">-- blocking metavariable.</span><span>
</span><span id="line-841"></span><span class="hs-comment">--</span><span>
</span><span id="line-842"></span><span class="hs-comment">-- Precondition: The name should refer to a record type, and the</span><span>
</span><span id="line-843"></span><span class="hs-comment">-- arguments should be the parameters to the type.</span><span>
</span><span id="line-844"></span><span id="local-6989586621682003736"><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonRecord"><span class="hs-identifier hs-type">isSingletonRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003736"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003736"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Name of record type to check.</span></span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Parameters given to the record type.</span></span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003736"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-848"></span><span id="isSingletonRecord"><span class="annot"><span class="annottext">isSingletonRecord :: forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
QName -&gt; Args -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isSingletonRecord"><span class="hs-identifier hs-var hs-var">isSingletonRecord</span></a></span></span><span> </span><span id="local-6989586621682005404"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005404"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682005405"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005405"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Term -&gt; Bool) -&gt; m (Maybe Term) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QName -&gt; Args -&gt; Set QName -&gt; m (Maybe Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; QName -&gt; Args -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonRecord%27"><span class="hs-identifier hs-var">isSingletonRecord'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005404"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005405"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span id="local-6989586621682005407"><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonRecordModuloRelevance"><span class="hs-identifier hs-type">isSingletonRecordModuloRelevance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005407"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005407"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Name of record type to check.</span></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Parameters given to the record type.</span></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682005407"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-854"></span><span id="isSingletonRecordModuloRelevance"><span class="annot"><span class="annottext">isSingletonRecordModuloRelevance :: forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
QName -&gt; Args -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isSingletonRecordModuloRelevance"><span class="hs-identifier hs-var hs-var">isSingletonRecordModuloRelevance</span></a></span></span><span> </span><span id="local-6989586621682005418"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005418"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682005419"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005419"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Term -&gt; Bool) -&gt; m (Maybe Term) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QName -&gt; Args -&gt; Set QName -&gt; m (Maybe Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; QName -&gt; Args -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonRecord%27"><span class="hs-identifier hs-var">isSingletonRecord'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005418"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005419"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="hs-comment">-- | Return the unique (closed) inhabitant if exists.</span><span>
</span><span id="line-857"></span><span class="hs-comment">--   In case of counting irrelevance in, the returned inhabitant</span><span>
</span><span id="line-858"></span><span class="hs-comment">--   contains dummy terms.</span><span>
</span><span id="line-859"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonRecord%27"><span class="hs-identifier hs-type">isSingletonRecord'</span></a></span><span>
</span><span id="line-860"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003739"><span class="annot"><a href="#local-6989586621682003739"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Should disregard irrelevant fields?</span></span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Name of record type to check.</span></span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Parameters given to the record type.</span></span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="hs-comment">-- ^ Non-terminating record types we already encountered.</span><span>
</span><span id="line-865"></span><span>                     </span><span class="hs-comment">--   These are considered as non-singletons,</span><span>
</span><span id="line-866"></span><span>                     </span><span class="hs-comment">--   otherwise we would construct an infinite inhabitant (in an infinite time...).</span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The unique inhabitant, if any.  May contain dummy terms in irrelevant positions.</span></span><span>
</span><span id="line-868"></span><span id="isSingletonRecord%27"><span class="annot"><span class="annottext">isSingletonRecord' :: forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; QName -&gt; Args -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonRecord%27"><span class="hs-identifier hs-var hs-var">isSingletonRecord'</span></a></span></span><span> </span><span id="local-6989586621682005517"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005517"><span class="hs-identifier hs-var">regardIrrelevance</span></a></span></span><span> </span><span id="local-6989586621682005518"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682005519"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005519"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682005520"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005520"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-869"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.meta.eta&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Is&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005519"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;a singleton record type?&quot;</span></span><span>
</span><span id="line-871"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  already visited:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [TCMT IO Doc]) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005520"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-comment">-- Andreas, 2022-03-10, issue #5823</span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-comment">-- We need to make sure we are not infinitely unfolding records, so we only expand each once,</span><span>
</span><span id="line-875"></span><span>  </span><span class="hs-comment">-- and keep track of the recursive ones we have already seen.</span><span>
</span><span id="line-876"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005520"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m (Maybe Term)
forall {a}. m (Maybe a)
</span><a href="#local-6989586621682005524"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><span class="annottext">m (Maybe RecordData)
-&gt; m (Maybe Term)
-&gt; (RecordData -&gt; m (Maybe Term))
-&gt; m (Maybe Term)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; m (Maybe RecordData)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe Term)
forall {a}. m (Maybe a)
</span><a href="#local-6989586621682005524"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">((RecordData -&gt; m (Maybe Term)) -&gt; m (Maybe Term))
-&gt; (RecordData -&gt; m (Maybe Term)) -&gt; m (Maybe Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005525"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005525"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-878"></span><span>      </span><span class="hs-comment">-- We might not know yet whether a record type is recursive because the positivity checker hasn't run yet.</span><span>
</span><span id="line-879"></span><span>      </span><span class="hs-comment">-- In this case, we pessimistically consider the record type to be recursive (@True@).</span><span>
</span><span id="line-880"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005526"><span class="annot"><span class="annottext">recursive :: Bool
</span><a href="#local-6989586621682005526"><span class="hs-identifier hs-var hs-var hs-var">recursive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ([QName] -&gt; Bool) -&gt; Maybe [QName] -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ([QName] -&gt; Bool) -&gt; [QName] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe [QName] -&gt; Bool) -&gt; Maybe [QName] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Maybe [QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recMutual"><span class="hs-identifier hs-var">_recMutual</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005525"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-881"></span><span>      </span><span class="hs-comment">-- Andreas, 2022-03-23, issue #5823</span><span>
</span><span id="line-882"></span><span>      </span><span class="hs-comment">-- We may pass through terminating record types as often as we want.</span><span>
</span><span id="line-883"></span><span>      </span><span class="hs-comment">-- If the termination checker has not run yet, we pessimistically consider the record type</span><span>
</span><span id="line-884"></span><span>      </span><span class="hs-comment">-- to be non-terminating.</span><span>
</span><span id="line-885"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005529"><span class="annot"><span class="annottext">nonTerminating :: Bool
</span><a href="#local-6989586621682005529"><span class="hs-identifier hs-var hs-var hs-var">nonTerminating</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Maybe Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#_recTerminates"><span class="hs-identifier hs-var">_recTerminates</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005525"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-886"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.meta.eta&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-887"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;is recursive      :&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Bool -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005526"><span class="hs-identifier hs-var">recursive</span></a></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-888"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;is non-terminating:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Bool -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005529"><span class="hs-identifier hs-var">nonTerminating</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-890"></span><span>      </span><span class="annot"><span class="annottext">(Args -&gt; Term) -&gt; Maybe Args -&gt; Maybe Term
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Args -&gt; Term
</span><a href="Agda.TypeChecking.Records.html#mkCon"><span class="hs-identifier hs-var">mkCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005525"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Maybe Term) -&gt; m (Maybe Args) -&gt; m (Maybe Term)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-891"></span><span>        </span><span class="annot"><span class="annottext">Set QName -&gt; Telescope -&gt; m (Maybe Args)
</span><a href="#local-6989586621682005531"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; (Set QName -&gt; Set QName) -&gt; Set QName -&gt; Set QName
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005526"><span class="hs-identifier hs-var">recursive</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005529"><span class="hs-identifier hs-var">nonTerminating</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005518"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005520"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; m (Maybe Args)) -&gt; Telescope -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; Telescope
</span><a href="Agda.TypeChecking.Monad.Base.html#_recTel"><span class="hs-identifier hs-var">_recTel</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682005525"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Args -&gt; Telescope
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682005519"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-comment">-- Check that all entries of the constructor telescope are singletons.</span><span>
</span><span id="line-894"></span><span>  </span><span class="annot"><a href="#local-6989586621682005531"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>  </span><span id="local-6989586621682005531"><span class="annot"><span class="annottext">check :: Set QName -&gt; Telescope -&gt; m (Maybe Args)
</span><a href="#local-6989586621682005531"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682005534"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005534"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621682005535"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005535"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.meta.eta&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-897"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;isSingletonRecord' checking telescope &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005535"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-898"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682005535"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-899"></span><span>      </span><span class="annot"><span class="annottext">Telescope
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Maybe Args)
forall {a}. m (Maybe [a])
</span><a href="#local-6989586621682005537"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-900"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682005539"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682005540"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682005540"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m (Maybe Args) -&gt; m (Maybe Args) -&gt; m (Maybe Args)
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005517"><span class="hs-identifier hs-var">regardIrrelevance</span></a></span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m Bool -&gt; m Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#and2M"><span class="hs-operator hs-var">`and2M`</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type -&gt; m Bool
forall a (m :: * -&gt; *).
(LensRelevance a, LensSort a, PrettyTCM a, PureTCM m,
 MonadBlock m) =&gt;
a -&gt; m Bool
</span><a href="Agda.TypeChecking.Irrelevance.html#isIrrelevantOrPropM"><span class="hs-identifier hs-var">isIrrelevantOrPropM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-comment">{-then-}</span><span>
</span><span id="line-902"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type
-&gt; Abs Telescope -&gt; (Telescope -&gt; m (Maybe Args)) -&gt; m (Maybe Args)
forall a (m :: * -&gt; *) b.
(Subst a, MonadAddContext m) =&gt;
Dom' Term Type -&gt; Abs a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Context.html#underAbstraction"><span class="hs-identifier hs-var">underAbstraction</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682005540"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">((Telescope -&gt; m (Maybe Args)) -&gt; m (Maybe Args))
-&gt; (Telescope -&gt; m (Maybe Args)) -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Maybe Args) -&gt; m (Maybe Args) -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Args -&gt; Args) -&gt; Maybe Args -&gt; Maybe Args
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; ArgInfo
forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
HasCallStack =&gt; Term
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TERM__"><span class="hs-identifier hs-var">__DUMMY_TERM__</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Args -&gt; Args
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Maybe Args) -&gt; m (Maybe Args))
-&gt; (Telescope -&gt; m (Maybe Args)) -&gt; Telescope -&gt; m (Maybe Args)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Telescope -&gt; m (Maybe Args)
</span><a href="#local-6989586621682005531"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005534"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>        </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><span class="annottext">(m (Maybe Args) -&gt; m (Maybe Args))
-&gt; m (Maybe Args) -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-904"></span><span>          </span><span class="annot"><span class="annottext">m (Maybe Term)
-&gt; m (Maybe Args) -&gt; (Term -&gt; m (Maybe Args)) -&gt; m (Maybe Args)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonType%27"><span class="hs-identifier hs-var">isSingletonType'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005517"><span class="hs-identifier hs-var">regardIrrelevance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005534"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe Args)
forall {a}. m (Maybe a)
</span><a href="#local-6989586621682005524"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">((Term -&gt; m (Maybe Args)) -&gt; m (Maybe Args))
-&gt; (Term -&gt; m (Maybe Args)) -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682005546"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005546"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>            </span><span class="annot"><span class="annottext">Dom' Term Type
-&gt; Abs Telescope -&gt; (Telescope -&gt; m (Maybe Args)) -&gt; m (Maybe Args)
forall a (m :: * -&gt; *) b.
(Subst a, MonadAddContext m) =&gt;
Dom' Term Type -&gt; Abs a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Context.html#underAbstraction"><span class="hs-identifier hs-var">underAbstraction</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682005540"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">((Telescope -&gt; m (Maybe Args)) -&gt; m (Maybe Args))
-&gt; (Telescope -&gt; m (Maybe Args)) -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Maybe Args) -&gt; m (Maybe Args) -&gt; m (Maybe Args)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Args -&gt; Args) -&gt; Maybe Args -&gt; Maybe Args
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; ArgInfo
forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005539"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005546"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Args -&gt; Args
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Maybe Args) -&gt; m (Maybe Args))
-&gt; (Telescope -&gt; m (Maybe Args)) -&gt; Telescope -&gt; m (Maybe Args)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Telescope -&gt; m (Maybe Args)
</span><a href="#local-6989586621682005531"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005534"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-906"></span><span>  </span><span id="local-6989586621682005524"><span class="annot"><span class="annottext">no :: m (Maybe a)
</span><a href="#local-6989586621682005524"><span class="hs-identifier hs-var hs-var">no</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; m (Maybe a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-907"></span><span>  </span><span id="local-6989586621682005537"><span class="annot"><span class="annottext">yes :: m (Maybe [a])
</span><a href="#local-6989586621682005537"><span class="hs-identifier hs-var hs-var">yes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [a] -&gt; m (Maybe [a])
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [a] -&gt; m (Maybe [a])) -&gt; Maybe [a] -&gt; m (Maybe [a])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="hs-comment">-- | Check whether a type has a unique inhabitant and return it.</span><span>
</span><span id="line-910"></span><span class="hs-comment">--   Can be blocked by a metavar.</span><span>
</span><span id="line-911"></span><span id="local-6989586621682003764"><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonType"><span class="hs-identifier hs-type">isSingletonType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003764"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003764"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003764"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-912"></span><span id="isSingletonType"><span class="annot"><span class="annottext">isSingletonType :: forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Type -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonType"><span class="hs-identifier hs-var hs-var">isSingletonType</span></a></span></span><span> </span><span id="local-6989586621682005560"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005560"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonType%27"><span class="hs-identifier hs-var">isSingletonType'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005560"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span class="hs-comment">-- | Check whether a type has a unique inhabitant (irrelevant parts ignored).</span><span>
</span><span id="line-915"></span><span class="hs-comment">--   Can be blocked by a metavar.</span><span>
</span><span id="line-916"></span><span id="local-6989586621682003766"><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonTypeModuloRelevance"><span class="hs-identifier hs-type">isSingletonTypeModuloRelevance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003766"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003766"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003766"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-917"></span><span id="isSingletonTypeModuloRelevance"><span class="annot"><span class="annottext">isSingletonTypeModuloRelevance :: forall (m :: * -&gt; *). (PureTCM m, MonadBlock m) =&gt; Type -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isSingletonTypeModuloRelevance"><span class="hs-identifier hs-var hs-var">isSingletonTypeModuloRelevance</span></a></span></span><span> </span><span id="local-6989586621682005571"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005571"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Term -&gt; Bool) -&gt; m (Maybe Term) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonType%27"><span class="hs-identifier hs-var">isSingletonType'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005571"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonType%27"><span class="hs-identifier hs-type">isSingletonType'</span></a></span><span>
</span><span id="line-920"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003763"><span class="annot"><a href="#local-6989586621682003763"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003763"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003763"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Should disregard irrelevant fields?</span></span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Type to check.</span></span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="hs-comment">-- ^ Non-terminating record typess we already encountered.</span><span>
</span><span id="line-924"></span><span>                     </span><span class="hs-comment">--   These are considered as non-singletons,</span><span>
</span><span id="line-925"></span><span>                     </span><span class="hs-comment">--   otherwise we would construct an infinite inhabitant (in an infinite time...).</span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The unique inhabitant, if any.  May contain dummy terms in irrelevant positions.</span></span><span>
</span><span id="line-927"></span><span id="isSingletonType%27"><span class="annot"><span class="annottext">isSingletonType' :: forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m) =&gt;
Bool -&gt; Type -&gt; Set QName -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Records.html#isSingletonType%27"><span class="hs-identifier hs-var hs-var">isSingletonType'</span></a></span></span><span> </span><span id="local-6989586621682005628"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682005628"><span class="hs-identifier hs-var">regardIrrelevance</span></a></span></span><span> </span><span id="local-6989586621682005629"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005629"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682005630"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682005630"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-928"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682005631"><span class="annot"><a href="#local-6989586621682005631"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682005632"><span class="annot"><a href="#local-6989586621682005632"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005629"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-929"></span><span>    </span><span id="local-6989586621682005634"><span class="annot"><a href="#local-6989586621682005634"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#abortIfBlocked"><span class="hs-identifier hs-type">abortIfBlocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005632"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-930"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005631"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-931"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-932"></span><span>        </span><span class="hs-comment">-- Easy case: &#951; for records.</span><span>
</span><span id="line-933"></span><span>        </span><span class="annot"><a href="#local-6989586621682005636"><span class="hs-identifier hs-type">record</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682003763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>        </span><span id="local-6989586621682005636"><span class="annot"><a href="#local-6989586621682005636"><span class="hs-identifier hs-var hs-var">record</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m Term -&gt; m (Maybe Term)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT m Term -&gt; m (Maybe Term))
-&gt; MaybeT m Term -&gt; m (Maybe Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-935"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682005637"><span class="annot"><a href="#local-6989586621682005637"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005638"><span class="annot"><a href="#local-6989586621682005638"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005639"><span class="annot"><a href="#local-6989586621682005639"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (QName, Args, RecordData))
-&gt; MaybeT m (QName, Args, RecordData)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (QName, Args, RecordData))
 -&gt; MaybeT m (QName, Args, RecordData))
-&gt; m (Maybe (QName, Args, RecordData))
-&gt; MaybeT m (QName, Args, RecordData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (Maybe (QName, Args, RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var">isRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005634"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-936"></span><span>          </span><span class="annot"><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-type">guard</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaRecordDef"><span class="hs-identifier hs-type">isEtaRecordDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005639"><span class="hs-identifier hs-type">def</span></a></span><span>
</span><span id="line-937"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005631"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonRecord%27"><span class="hs-identifier hs-type">isSingletonRecord'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005628"><span class="hs-identifier hs-type">regardIrrelevance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005637"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005638"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005630"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>
</span><span id="line-939"></span><span>        </span><span class="hs-comment">-- Slightly harder case: &#951; for Sub {level} tA phi elt.</span><span>
</span><span id="line-940"></span><span>        </span><span class="hs-comment">-- tA : Type level, phi : I, elt : Partial phi tA.</span><span>
</span><span id="line-941"></span><span>        </span><span class="annot"><a href="#local-6989586621682005642"><span class="hs-identifier hs-type">subtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682003763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>        </span><span id="local-6989586621682005642"><span class="annot"><a href="#local-6989586621682005642"><span class="hs-identifier hs-var hs-var">subtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m Term -&gt; m (Maybe Term)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT m Term -&gt; m (Maybe Term))
-&gt; MaybeT m Term -&gt; m (Maybe Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-943"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682005643"><span class="annot"><a href="#local-6989586621682005643"><span class="hs-identifier hs-var">level</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005644"><span class="annot"><a href="#local-6989586621682005644"><span class="hs-identifier hs-var">tA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005645"><span class="annot"><a href="#local-6989586621682005645"><span class="hs-identifier hs-var">phi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005646"><span class="annot"><a href="#local-6989586621682005646"><span class="hs-identifier hs-var">elt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Term, Term, Term, Term))
-&gt; MaybeT m (Term, Term, Term, Term)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Term, Term, Term, Term))
 -&gt; MaybeT m (Term, Term, Term, Term))
-&gt; m (Maybe (Term, Term, Term, Term))
-&gt; MaybeT m (Term, Term, Term, Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (Maybe (Term, Term, Term, Term))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (Term, Term, Term, Term))
</span><a href="Agda.TypeChecking.Primitive.Cubical.Base.html#isCubicalSubtype"><span class="hs-identifier hs-var">isCubicalSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005634"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-944"></span><span>          </span><span id="local-6989586621682005647"><span class="annot"><a href="#local-6989586621682005647"><span class="hs-identifier hs-var">subin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-type">getBuiltinName'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinSubIn"><span class="hs-identifier hs-type">builtinSubIn</span></a></span><span>
</span><span id="line-945"></span><span>          </span><span id="local-6989586621682005650"><span class="annot"><a href="#local-6989586621682005650"><span class="hs-identifier hs-var">itIsOne</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-type">getBuiltinName'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinIsOne"><span class="hs-identifier hs-type">builtinIsOne</span></a></span><span>
</span><span id="line-946"></span><span>          </span><span id="local-6989586621682005652"><span class="annot"><a href="#local-6989586621682005652"><span class="hs-identifier hs-var">phiV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#intervalView"><span class="hs-identifier hs-type">intervalView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005645"><span class="hs-identifier hs-type">phi</span></a></span><span>
</span><span id="line-947"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682005652"><span class="hs-identifier hs-type">phiV</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-948"></span><span>            </span><span class="hs-comment">-- If phi = i1, then inS (elt 1=1) is the only inhabitant.</span><span>
</span><span id="line-949"></span><span>            </span><span class="annot"><span class="annottext">IntervalView
</span><a href="Agda.Syntax.Internal.html#IOne"><span class="hs-identifier hs-var">IOne</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-950"></span><span>              </span><span class="hs-keyword">let</span><span>
</span><span id="line-951"></span><span>                </span><span id="local-6989586621682005657"><span class="annot"><span class="annottext">argH :: e -&gt; Arg e
</span><a href="#local-6989586621682005657"><span class="hs-identifier hs-var hs-var">argH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; e -&gt; Arg e
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; e -&gt; Arg e) -&gt; ArgInfo -&gt; e -&gt; Arg e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; ArgInfo -&gt; ArgInfo
forall a. LensHiding a =&gt; Hiding -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setHiding"><span class="hs-identifier hs-var">setHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="Agda.Syntax.Common.html#Hidden"><span class="hs-identifier hs-var">Hidden</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span>
</span><span id="line-952"></span><span>                </span><span id="local-6989586621682005661"><span class="annot"><span class="annottext">it :: Term
</span><a href="#local-6989586621682005661"><span class="hs-identifier hs-var hs-var">it</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005646"><span class="hs-identifier hs-var">elt</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Args -&gt; Term
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005650"><span class="hs-identifier hs-var">itIsOne</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-953"></span><span>              </span><span class="annot"><span class="annottext">Term -&gt; MaybeT m Term
forall a. a -&gt; MaybeT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005647"><span class="hs-identifier hs-var">subin</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Args -&gt; Term
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="#local-6989586621682005657"><span class="hs-identifier hs-var">argH</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005643"><span class="hs-identifier hs-var">level</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="#local-6989586621682005657"><span class="hs-identifier hs-var">argH</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005644"><span class="hs-identifier hs-var">tA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="#local-6989586621682005657"><span class="hs-identifier hs-var">argH</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005645"><span class="hs-identifier hs-var">phi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005661"><span class="hs-identifier hs-var">it</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>            </span><span class="hs-comment">-- Otherwise we're blocked</span><span>
</span><span id="line-955"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Internal.html#OTerm"><span class="hs-identifier hs-type">OTerm</span></a></span><span> </span><span id="local-6989586621682005664"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005664"><span class="hs-identifier hs-var">phi'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; MaybeT m Term
forall a. Blocker -&gt; MaybeT m a
forall (m :: * -&gt; *) a. MonadBlock m =&gt; Blocker -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#patternViolation"><span class="hs-identifier hs-var">patternViolation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Blocker
forall t. AllMetas t =&gt; t -&gt; Blocker
</span><a href="Agda.Syntax.Internal.MetaVars.html#unblockOnAnyMetaIn"><span class="hs-identifier hs-var">unblockOnAnyMetaIn</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005664"><span class="hs-identifier hs-var">phi'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>            </span><span class="hs-comment">-- This fails the MaybeT: we're not looking at a</span><span>
</span><span id="line-957"></span><span>            </span><span class="hs-comment">-- definitional singleton.</span><span>
</span><span id="line-958"></span><span>            </span><span class="annot"><span class="annottext">IntervalView
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; MaybeT m Term
forall a. ArgName -&gt; MaybeT m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; ArgName -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">(&lt;|&gt;)</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682005636"><span class="hs-identifier hs-type">record</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;*&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682005642"><span class="hs-identifier hs-type">subtype</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaVar"><span class="hs-pragma hs-type">isEtaVar</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-pragma hs-type">Term</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-pragma hs-type">Type</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Int</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- | Checks whether the given term (of the given type) is beta-eta-equivalent</span><span>
</span><span id="line-964"></span><span class="hs-comment">--   to a variable. Returns just the de Bruijn-index of the variable if it is,</span><span>
</span><span id="line-965"></span><span class="hs-comment">--   or nothing otherwise.</span><span>
</span><span id="line-966"></span><span class="annot"><a href="Agda.TypeChecking.Records.html#isEtaVar"><span class="hs-identifier hs-type">isEtaVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682003810"><span class="annot"><a href="#local-6989586621682003810"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-967"></span><span id="isEtaVar"><span class="annot"><span class="annottext">isEtaVar :: forall (m :: * -&gt; *). PureTCM m =&gt; Term -&gt; Type -&gt; m (Maybe Int)
</span><a href="Agda.TypeChecking.Records.html#isEtaVar"><span class="hs-identifier hs-var hs-var">isEtaVar</span></a></span></span><span> </span><span id="local-6989586621682005809"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005809"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005810"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005810"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m Int -&gt; m (Maybe Int)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT m Int -&gt; m (Maybe Int)) -&gt; MaybeT m Int -&gt; m (Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type -&gt; Maybe Int -&gt; [Elim' Int] -&gt; MaybeT m Int
</span><a href="#local-6989586621682005811"><span class="hs-identifier hs-var">isEtaVarG</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005809"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005810"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-969"></span><span>    </span><span class="hs-comment">-- Checks whether the term u (of type a) is beta-eta-equivalent to</span><span>
</span><span id="line-970"></span><span>    </span><span class="hs-comment">-- `Var i es`, and returns i if it is. If the argument mi is `Just i'`,</span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-comment">-- then i and i' are also required to be equal (else Nothing is returned).</span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><a href="#local-6989586621682005811"><span class="hs-identifier hs-type">isEtaVarG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="#local-6989586621682003810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-973"></span><span>    </span><span id="local-6989586621682005811"><span class="annot"><span class="annottext">isEtaVarG :: Term -&gt; Type -&gt; Maybe Int -&gt; [Elim' Int] -&gt; MaybeT m Int
</span><a href="#local-6989586621682005811"><span class="hs-identifier hs-var hs-var">isEtaVarG</span></a></span></span><span> </span><span id="local-6989586621682005812"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005812"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005813"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005813"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682005814"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682005814"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span id="local-6989586621682005815"><span class="annot"><span class="annottext">[Elim' Int]
</span><a href="#local-6989586621682005815"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-974"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682005816"><span class="annot"><a href="#local-6989586621682005816"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005817"><span class="annot"><a href="#local-6989586621682005817"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Term, Type) -&gt; MaybeT m (Term, Type)
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005812"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005813"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;isEtaVarG&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-976"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;u  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005816"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-977"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;a  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005817"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-978"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;mi = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682005814"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;es = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-type">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682005815"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005816"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005817"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-982"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682005819"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005819"><span class="hs-identifier hs-var">i'</span></a></span></span><span> </span><span id="local-6989586621682005820"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005820"><span class="hs-identifier hs-var">es'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-983"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; MaybeT m ()
forall b (m :: * -&gt; *). (IsBool b, MonadPlus m) =&gt; b -&gt; m ()
</span><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; MaybeT m ()) -&gt; Bool -&gt; MaybeT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682005814"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Maybe Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005819"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Maybe Int
forall a b. a -&gt; Maybe b -&gt; Maybe a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682005814"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>          </span><span id="local-6989586621682005821"><span class="annot"><a href="#local-6989586621682005821"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MaybeT m Type
forall (m :: * -&gt; *). (MonadDebug m, MonadTCEnv m) =&gt; Int -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.Context.html#typeOfBV"><span class="hs-identifier hs-var">typeOfBV</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005819"><span class="hs-identifier hs-var">i'</span></a></span><span>
</span><span id="line-985"></span><span>          </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-type">areEtaVarElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005819"><span class="hs-identifier hs-type">i'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682005821"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005820"><span class="hs-identifier hs-type">es'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005815"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-986"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682005819"><span class="hs-identifier hs-type">i'</span></a></span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682005824"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005824"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682005825"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005825"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-988"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; MaybeT m ()
forall b (m :: * -&gt; *). (IsBool b, MonadPlus m) =&gt; b -&gt; m ()
</span><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; MaybeT m ()) -&gt; MaybeT m Bool -&gt; MaybeT m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">QName -&gt; MaybeT m Bool
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-identifier hs-var">isEtaRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005824"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-989"></span><span>          </span><span id="local-6989586621682005826"><span class="annot"><a href="#local-6989586621682005826"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; QName) -&gt; [Dom' Term QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; QName
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term QName] -&gt; [QName])
-&gt; (Definition -&gt; [Dom' Term QName]) -&gt; Definition -&gt; [QName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#recFields"><span class="hs-identifier hs-var">recFields</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; [Dom' Term QName])
-&gt; (Definition -&gt; Defn) -&gt; Definition -&gt; [Dom' Term QName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; [QName]) -&gt; MaybeT m Definition -&gt; MaybeT m [QName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MaybeT m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005824"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-990"></span><span>          </span><span id="local-6989586621682005827"><span class="annot"><a href="#local-6989586621682005827"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682005826"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682005829"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005829"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-991"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005830"><span class="annot"><span class="annottext">o :: ProjOrigin
</span><a href="#local-6989586621682005830"><span class="hs-identifier hs-var hs-var hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span>
</span><span id="line-992"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005831"><span class="annot"><a href="#local-6989586621682005831"><span class="hs-identifier hs-var">fa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Dom' Term Type, Term, Type))
-&gt; MaybeT m (Dom' Term Type, Term, Type)
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Dom' Term Type, Term, Type))
 -&gt; MaybeT m (Dom' Term Type, Term, Type))
-&gt; m (Maybe (Dom' Term Type, Term, Type))
-&gt; MaybeT m (Dom' Term Type, Term, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
-&gt; Type
-&gt; ProjOrigin
-&gt; QName
-&gt; m (Maybe (Dom' Term Type, Term, Type))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Term
-&gt; Type
-&gt; ProjOrigin
-&gt; QName
-&gt; m (Maybe (Dom' Term Type, Term, Type))
</span><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-var">projectTyped</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005816"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005817"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682005830"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005829"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-993"></span><span>            </span><span class="annot"><a href="#local-6989586621682005811"><span class="hs-identifier hs-type">isEtaVarG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005816"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-type">`applyE`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005830"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005829"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682005831"><span class="hs-identifier hs-type">fa</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005814"><span class="hs-identifier hs-type">mi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005815"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005830"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005829"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005814"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682005827"><span class="hs-identifier hs-type">is</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-995"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682005832"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005832"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MaybeT m Int
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005832"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-996"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m Int
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-997"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005834"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682005835"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682005835"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; MaybeT m ()
forall b (m :: * -&gt; *). (IsBool b, MonadPlus m) =&gt; b -&gt; m ()
</span><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005834"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682005835"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeT m () -&gt; MaybeT m Int -&gt; MaybeT m Int
forall a b. MaybeT m a -&gt; MaybeT m b -&gt; MaybeT m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; MaybeT m Int
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682005834"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682005836"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005836"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682005837"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682005837"><span class="hs-identifier hs-var">cod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Dom' Term Type -&gt; MaybeT m Int -&gt; MaybeT m Int
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Dom' Term Type -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005836"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT m Int -&gt; MaybeT m Int) -&gt; MaybeT m Int -&gt; MaybeT m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-999"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682005838"><span class="annot"><span class="annottext">u' :: Term
</span><a href="#local-6989586621682005838"><span class="hs-identifier hs-var hs-var">u'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; Term
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005816"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Args -&gt; Term
forall t. Apply t =&gt; t -&gt; Args -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; Arg Type
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005836"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Term -&gt; Arg Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-1000"></span><span>              </span><span id="local-6989586621682005839"><span class="annot"><span class="annottext">a' :: Type
</span><a href="#local-6989586621682005839"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-var">absBody</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682005837"><span class="hs-identifier hs-var">cod</span></a></span><span>
</span><span id="line-1001"></span><span>              </span><span id="local-6989586621682005841"><span class="annot"><span class="annottext">mi' :: Maybe Int
</span><a href="#local-6989586621682005841"><span class="hs-identifier hs-var hs-var">mi'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Maybe Int -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682005814"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-1002"></span><span>              </span><span id="local-6989586621682005842"><span class="annot"><span class="annottext">es' :: [Elim' Int]
</span><a href="#local-6989586621682005842"><span class="hs-identifier hs-var hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Elim' Int -&gt; Elim' Int) -&gt; [Elim' Int] -&gt; [Elim' Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Elim' Int -&gt; Elim' Int) -&gt; [Elim' Int] -&gt; [Elim' Int])
-&gt; ((Int -&gt; Int) -&gt; Elim' Int -&gt; Elim' Int)
-&gt; (Int -&gt; Int)
-&gt; [Elim' Int]
-&gt; [Elim' Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Elim' Int -&gt; Elim' Int
forall a b. (a -&gt; b) -&gt; Elim' a -&gt; Elim' b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><a href="#local-6989586621682005815"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' Int] -&gt; [Elim' Int] -&gt; [Elim' Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg Int -&gt; Elim' Int
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Int -&gt; Elim' Int) -&gt; Arg Int -&gt; Elim' Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type -&gt; Arg Type
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005836"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Int -&gt; Arg Int
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-1003"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; MaybeT m Int -&gt; MaybeT m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type -&gt; Maybe Int -&gt; [Elim' Int] -&gt; MaybeT m Int
</span><a href="#local-6989586621682005811"><span class="hs-identifier hs-var">isEtaVarG</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005838"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005839"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682005841"><span class="hs-identifier hs-var">mi'</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><a href="#local-6989586621682005842"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-1004"></span><span>        </span><span class="annot"><span class="annottext">(Term, Term)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m Int
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1005"></span><span>
</span><span id="line-1006"></span><span>    </span><span class="hs-comment">-- `areEtaVarElims u a es es'` checks whether the given elims es (as applied</span><span>
</span><span id="line-1007"></span><span>    </span><span class="hs-comment">-- to the term u of type a) are beta-eta-equal to either projections or</span><span>
</span><span id="line-1008"></span><span>    </span><span class="hs-comment">-- variables with de Bruijn indices given by es'.</span><span>
</span><span id="line-1009"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-type">areEtaVarElims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="#local-6989586621682003810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621682005823"><span class="annot"><span class="annottext">areEtaVarElims :: Term -&gt; Type -&gt; Elims -&gt; [Elim' Int] -&gt; MaybeT m ()
</span><a href="#local-6989586621682005823"><span class="hs-identifier hs-var hs-var">areEtaVarElims</span></a></span></span><span> </span><span id="local-6989586621682005843"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005843"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005844"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005844"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; MaybeT m ()
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005845"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005845"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005846"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005846"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim' Int
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1012"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005847"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005847"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005848"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005848"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1013"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005849"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005849"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005850"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005850"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682005851"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682005851"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682005852"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005852"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682005853"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005853"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682005854"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005854"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682005855"><span class="annot"><span class="annottext">[Elim' Int]
</span><a href="#local-6989586621682005855"><span class="hs-identifier hs-var">es'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1014"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; MaybeT m ()
forall b (m :: * -&gt; *). (IsBool b, MonadPlus m) =&gt; b -&gt; m ()
</span><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; MaybeT m ()) -&gt; Bool -&gt; MaybeT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005852"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005854"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-1015"></span><span>      </span><span id="local-6989586621682005856"><span class="annot"><a href="#local-6989586621682005856"><span class="hs-identifier hs-var">a</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; MaybeT m Type
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005850"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682005857"><span class="annot"><a href="#local-6989586621682005857"><span class="hs-identifier hs-var">fa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-type">projectTyped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005849"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005856"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005851"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005852"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-1017"></span><span>      </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-type">areEtaVarElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005849"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-type">`applyE`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005851"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005852"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682005857"><span class="hs-identifier hs-type">fa</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005853"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005855"><span class="hs-identifier hs-type">es'</span></a></span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-comment">-- These two cases can occur only when we're looking at two different</span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-comment">-- variables (i.e. one of function type and the other of record type) so</span><span>
</span><span id="line-1020"></span><span>    </span><span class="hs-comment">-- it's definitely not the variable we're looking for (or someone is playing</span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-comment">-- Jedi mind tricks on us)</span><span>
</span><span id="line-1022"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005858"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005858"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005859"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005859"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1023"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005860"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005860"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005861"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005861"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1024"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005862"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005862"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005863"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005863"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1025"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005864"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005864"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005865"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005865"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1026"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005866"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005866"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005867"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005867"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span>  </span><span class="annot"><span class="annottext">Arg Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1027"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005868"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005868"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005869"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005869"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span>  </span><span class="annot"><span class="annottext">Arg Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-1028"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005870"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005870"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005871"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005871"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Elim' Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-comment">-- TODO Andrea: not actually impossible, should be done like Apply</span><span>
</span><span id="line-1029"></span><span>    </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-var">areEtaVarElims</span></a></span><span> </span><span id="local-6989586621682005872"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682005872"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682005873"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005873"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682005874"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682005874"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682005875"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682005875"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682005876"><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682005876"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682005877"><span class="annot"><span class="annottext">[Elim' Int]
</span><a href="#local-6989586621682005877"><span class="hs-identifier hs-var">es'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1030"></span><span>      </span><span class="annot"><span class="annottext">Type
-&gt; (Type -&gt; MaybeT m ())
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; MaybeT m ())
-&gt; MaybeT m ()
forall (m :: * -&gt; *) a.
MonadReduce m =&gt;
Type -&gt; (Type -&gt; m a) -&gt; (Dom' Term Type -&gt; Abs Type -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Telescope.html#ifNotPiType"><span class="hs-identifier hs-var">ifNotPiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682005873"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeT m () -&gt; Type -&gt; MaybeT m ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">MaybeT m ()
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Dom' Term Type -&gt; Abs Type -&gt; MaybeT m ()) -&gt; MaybeT m ())
-&gt; (Dom' Term Type -&gt; Abs Type -&gt; MaybeT m ()) -&gt; MaybeT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682005878"><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005878"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682005879"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682005879"><span class="hs-identifier hs-var">cod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1031"></span><span>      </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type -&gt; Maybe Int -&gt; [Elim' Int] -&gt; MaybeT m Int
</span><a href="#local-6989586621682005811"><span class="hs-identifier hs-var">isEtaVarG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682005874"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom' Term Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Type
</span><a href="#local-6989586621682005878"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; Int -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Int -&gt; Int
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682005876"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1032"></span><span>      </span><span class="annot"><a href="#local-6989586621682005823"><span class="hs-identifier hs-type">areEtaVarElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005872"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-type">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005876"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682005879"><span class="hs-identifier hs-type">cod</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-operator hs-type">`absApp`</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005876"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682005875"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682005877"><span class="hs-identifier hs-type">es'</span></a></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span class="hs-comment">-- | Replace projection patterns by the original projections.</span><span>
</span><span id="line-1036"></span><span class="hs-comment">--</span><span>
</span><span id="line-1037"></span><span class="hs-keyword">class</span><span> </span><span id="NormaliseProjP"><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-var">NormaliseProjP</span></a></span></span><span> </span><span id="local-6989586621682003835"><span class="annot"><a href="#local-6989586621682003835"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1038"></span><span>  </span><span id="normaliseProjP"><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-type">normaliseProjP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682003832"><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003832"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682003832"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003835"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1041"></span><span>  </span><span id="local-6989586621682005898"><span class="annot"><span class="annottext">normaliseProjP :: forall (m :: * -&gt; *). HasConstInfo m =&gt; Clause -&gt; m Clause
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var hs-var hs-var">normaliseProjP</span></a></span></span><span> </span><span id="local-6989586621682005899"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682005899"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1042"></span><span>    </span><span id="local-6989586621682005900"><span class="annot"><a href="#local-6989586621682005900"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NAPs -&gt; m NAPs
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *). HasConstInfo m =&gt; NAPs -&gt; m NAPs
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="annot"><span class="annottext">(NAPs -&gt; m NAPs) -&gt; NAPs -&gt; m NAPs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; NAPs
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682005899"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1043"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682005899"><span class="hs-identifier hs-type">cl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682005900"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682003846"><span id="local-6989586621682003847"><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003846"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682003847"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682003846"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1046"></span><span>  </span><span id="local-6989586621682005912"><span class="annot"><span class="annottext">normaliseProjP :: forall (m :: * -&gt; *). HasConstInfo m =&gt; (x, a) -&gt; m (x, a)
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var hs-var hs-var">normaliseProjP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; (x, a) -&gt; m (x, a)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; (x, a) -&gt; f (x, b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *). HasConstInfo m =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682003843"><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003843"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682003843"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1049"></span><span>  </span><span id="local-6989586621682005922"><span class="annot"><span class="annottext">normaliseProjP :: forall (m :: * -&gt; *). HasConstInfo m =&gt; [a] -&gt; m [a]
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var hs-var hs-var">normaliseProjP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; [a] -&gt; m [a]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *). HasConstInfo m =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682003842"><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003842"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003842"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1052"></span><span>  </span><span id="local-6989586621682005932"><span class="annot"><span class="annottext">normaliseProjP :: forall (m :: * -&gt; *). HasConstInfo m =&gt; Arg a -&gt; m (Arg a)
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var hs-var hs-var">normaliseProjP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; Arg a -&gt; m (Arg a)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Arg a -&gt; f (Arg b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *). HasConstInfo m =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682003841"><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003841"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named_"><span class="hs-identifier hs-type">Named_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003841"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1055"></span><span>  </span><span id="local-6989586621682005942"><span class="annot"><span class="annottext">normaliseProjP :: forall (m :: * -&gt; *). HasConstInfo m =&gt; Named_ a -&gt; m (Named_ a)
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var hs-var hs-var">normaliseProjP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; Named_ a -&gt; m (Named_ a)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Named NamedName a -&gt; f (Named NamedName b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *). HasConstInfo m =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682003839"><span class="annot"><a href="Agda.TypeChecking.Records.html#NormaliseProjP"><span class="hs-identifier hs-type">NormaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern%27"><span class="hs-identifier hs-type">Pattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682003839"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1058"></span><span>  </span><span id="local-6989586621682005963"><span class="annot"><span class="annottext">normaliseProjP :: forall (m :: * -&gt; *).
HasConstInfo m =&gt;
Pattern' x -&gt; m (Pattern' x)
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var hs-var hs-var">normaliseProjP</span></a></span></span><span> </span><span id="local-6989586621682005964"><span class="annot"><span class="annottext">p :: Pattern' x
</span><a href="#local-6989586621682005964"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' x -&gt; m (Pattern' x)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><a href="#local-6989586621682005964"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1059"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span id="local-6989586621682005966"><span class="annot"><span class="annottext">p :: Pattern' x
</span><a href="#local-6989586621682005966"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' x -&gt; m (Pattern' x)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><a href="#local-6989586621682005966"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1060"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682005969"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005969"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682005970"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682005970"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span id="local-6989586621682005971"><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><a href="#local-6989586621682005971"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
forall x.
ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-var">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682005969"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682005970"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg (Pattern' x)] -&gt; Pattern' x)
-&gt; m [NamedArg (Pattern' x)] -&gt; m (Pattern' x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)] -&gt; m [NamedArg (Pattern' x)]
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
[NamedArg (Pattern' x)] -&gt; m [NamedArg (Pattern' x)]
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><a href="#local-6989586621682005971"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1061"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span> </span><span id="local-6989586621682005973"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682005973"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682005974"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005974"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682005975"><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><a href="#local-6989586621682005975"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; QName -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
forall x.
PatternInfo -&gt; QName -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-var">DefP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682005973"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005974"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg (Pattern' x)] -&gt; Pattern' x)
-&gt; m [NamedArg (Pattern' x)] -&gt; m (Pattern' x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)] -&gt; m [NamedArg (Pattern' x)]
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
[NamedArg (Pattern' x)] -&gt; m [NamedArg (Pattern' x)]
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><a href="#local-6989586621682005975"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1062"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span id="local-6989586621682005976"><span class="annot"><span class="annottext">p :: Pattern' x
</span><a href="#local-6989586621682005976"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' x -&gt; m (Pattern' x)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><a href="#local-6989586621682005976"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1063"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span> </span><span id="local-6989586621682005979"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682005979"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682005980"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005980"><span class="hs-identifier hs-var">d0</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Pattern' x
forall x. ProjOrigin -&gt; QName -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-var">ProjP</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682005979"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Pattern' x) -&gt; m QName -&gt; m (Pattern' x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; m QName
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m QName
</span><a href="Agda.TypeChecking.Monad.Signature.html#getOriginalProjection"><span class="hs-identifier hs-var">getOriginalProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682005980"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-1064"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span id="local-6989586621682005982"><span class="annot"><span class="annottext">p :: Pattern' x
</span><a href="#local-6989586621682005982"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' x -&gt; m (Pattern' x)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><a href="#local-6989586621682005982"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1065"></span></pre></body></html>