<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Lenses for 'TCState' and more.</span></span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html"><span class="hs-identifier">Agda.TypeChecking.Monad.State</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">rnf</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evaluate</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runMaybeT</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.EnumMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EnumMap</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html"><span class="hs-identifier">Agda.Compiler.Backend.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Backend"><span class="hs-identifier">Backend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#backendName"><span class="hs-identifier">backendName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#mayEraseType"><span class="hs-identifier">mayEraseType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Library.html"><span class="hs-identifier">Agda.Interaction.Library</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Library.html#classifyBuiltinModule_"><span class="hs-identifier">classifyBuiltinModule_</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InteractionOutputCallback"><span class="hs-identifier">InteractionOutputCallback</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier">Response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html"><span class="hs-identifier">Agda.Syntax.Concrete.Name</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefn"><span class="hs-identifier">PatternSynDefn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier">PatternSynDefns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.PatternSynonyms.html"><span class="hs-identifier">Agda.Syntax.Abstract.PatternSynonyms</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html"><span class="hs-identifier">Agda.Syntax.TopLevelModuleName</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Base</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier">reportS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier">reportSDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier">reportSLn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier">verboseS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.BiMap.html"><span class="hs-identifier">Agda.Utils.BiMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BiMap</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html"><span class="hs-identifier">Agda.Utils.FileId</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#File"><span class="hs-identifier">File</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#getIdFile"><span class="hs-identifier">getIdFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#registerFileId%27"><span class="hs-identifier">registerFileId'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Tuple.html"><span class="hs-identifier">Agda.Utils.Tuple</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- | Resets the non-persistent part of the type checking state.</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#resetState"><span class="hs-identifier hs-type">resetState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span id="resetState"><span class="annot"><span class="annottext">resetState :: TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#resetState"><span class="hs-identifier hs-var hs-var">resetState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(TCState -&gt; TCState) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-var">modifyTC</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681891410"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891410"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PersistentTCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#initStateFromPersistentState"><span class="hs-identifier hs-var">initStateFromPersistentState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891410"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState PersistentTCState -&gt; PersistentTCState
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Resets all of the type checking state.</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">--   Keep only the session state (backend information, 'Benchmark', file ids).</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#resetAllState"><span class="hs-identifier hs-type">resetAllState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span id="resetAllState"><span class="annot"><span class="annottext">resetAllState :: TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#resetAllState"><span class="hs-identifier hs-var hs-var">resetAllState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(TCState -&gt; TCState) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-var">modifyTC</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681891418"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891418"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SessionTCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#initStateFromSessionState"><span class="hs-identifier hs-var">initStateFromSessionState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891418"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState SessionTCState -&gt; SessionTCState
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(SessionTCState -&gt; f SessionTCState) -&gt; TCState -&gt; f TCState
Lens' TCState SessionTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensSessionState"><span class="hs-identifier hs-var">lensSessionState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><span class="hs-comment">-- | Overwrite the 'TCState', but not the 'SessionTCState' part.</span></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#putTCPreservingSession"><span class="hs-identifier hs-type">putTCPreservingSession</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span id="putTCPreservingSession"><span class="annot"><span class="annottext">putTCPreservingSession :: TCState -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#putTCPreservingSession"><span class="hs-identifier hs-var hs-var">putTCPreservingSession</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO (SessionTCState, Statistics)
-&gt; ((SessionTCState, Statistics) -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (SessionTCState, Statistics)
</span><a href="#local-6989586621681891426"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">(SessionTCState, Statistics) -&gt; TCM ()
forall {m :: * -&gt; *}.
MonadTCState m =&gt;
(SessionTCState, Statistics) -&gt; m ()
</span><a href="#local-6989586621681891427"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; (TCState -&gt; TCM ()) -&gt; TCState -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>  </span><span id="local-6989586621681891426"><span class="annot"><span class="annottext">get :: TCMT IO (SessionTCState, Statistics)
</span><a href="#local-6989586621681891426"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SessionTCState -&gt; Statistics -&gt; (SessionTCState, Statistics))
-&gt; TCMT IO SessionTCState
-&gt; TCMT IO (Statistics -&gt; (SessionTCState, Statistics))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState SessionTCState -&gt; TCMT IO SessionTCState
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(SessionTCState -&gt; f SessionTCState) -&gt; TCState -&gt; f TCState
Lens' TCState SessionTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensSessionState"><span class="hs-identifier hs-var">lensSessionState</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Statistics -&gt; (SessionTCState, Statistics))
-&gt; TCMT IO Statistics -&gt; TCMT IO (SessionTCState, Statistics)
forall a b. TCMT IO (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState Statistics -&gt; TCMT IO Statistics
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Statistics -&gt; f Statistics) -&gt; TCState -&gt; f TCState
Lens' TCState Statistics
</span><a href="Agda.TypeChecking.Monad.Base.html#stStatistics"><span class="hs-identifier hs-var">stStatistics</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621681891427"><span class="annot"><span class="annottext">put :: (SessionTCState, Statistics) -&gt; m ()
</span><a href="#local-6989586621681891427"><span class="hs-identifier hs-var hs-var">put</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681891460"><span class="annot"><span class="annottext">SessionTCState
</span><a href="#local-6989586621681891460"><span class="hs-identifier hs-var">sess</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681891461"><span class="annot"><span class="annottext">Statistics
</span><a href="#local-6989586621681891461"><span class="hs-identifier hs-var">stat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState SessionTCState -&gt; SessionTCState -&gt; m ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-identifier hs-var">setTCLens</span></a></span><span> </span><span class="annot"><span class="annottext">(SessionTCState -&gt; f SessionTCState) -&gt; TCState -&gt; f TCState
Lens' TCState SessionTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensSessionState"><span class="hs-identifier hs-var">lensSessionState</span></a></span><span> </span><span class="annot"><span class="annottext">SessionTCState
</span><a href="#local-6989586621681891460"><span class="hs-identifier hs-var">sess</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState Statistics -&gt; Statistics -&gt; m ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-identifier hs-var">setTCLens</span></a></span><span> </span><span class="annot"><span class="annottext">(Statistics -&gt; f Statistics) -&gt; TCState -&gt; f TCState
Lens' TCState Statistics
</span><a href="Agda.TypeChecking.Monad.Base.html#stStatistics"><span class="hs-identifier hs-var">stStatistics</span></a></span><span> </span><span class="annot"><span class="annottext">Statistics
</span><a href="#local-6989586621681891461"><span class="hs-identifier hs-var">stat</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | Restore 'TCState' after performing subcomputation.</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">--   In contrast to 'Agda.Utils.Monad.localState', the</span><span>
</span><span id="line-79"></span><span class="hs-comment">--   'SessionTCState' from the subcomputation is saved.</span><span>
</span><span id="line-80"></span><span id="local-6989586621681890877"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#localTCState"><span class="hs-identifier hs-type">localTCState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890877"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890877"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-81"></span><span id="localTCState"><span class="annot"><span class="annottext">localTCState :: forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localTCState"><span class="hs-identifier hs-var hs-var">localTCState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState -&gt; (TCState -&gt; TCM ()) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#putTCPreservingSession"><span class="hs-identifier hs-var">putTCPreservingSession</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Same as 'localTCState' but also returns the state in which we were just</span><span>
</span><span id="line-84"></span><span class="hs-comment">--   before reverting it.</span><span>
</span><span id="line-85"></span><span id="local-6989586621681890879"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#localTCStateSaving"><span class="hs-identifier hs-type">localTCStateSaving</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890879"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681890879"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-86"></span><span id="localTCStateSaving"><span class="annot"><span class="annottext">localTCStateSaving :: forall a. TCM a -&gt; TCM (a, TCState)
</span><a href="Agda.TypeChecking.Monad.State.html#localTCStateSaving"><span class="hs-identifier hs-var hs-var">localTCStateSaving</span></a></span></span><span> </span><span id="local-6989586621681891475"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891475"><span class="hs-identifier hs-var">compute</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM (a, TCState) -&gt; TCM (a, TCState)
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localTCState"><span class="hs-identifier hs-var">localTCState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (a, TCState) -&gt; TCM (a, TCState))
-&gt; TCM (a, TCState) -&gt; TCM (a, TCState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; TCState -&gt; (a, TCState))
-&gt; TCM a -&gt; TCMT IO TCState -&gt; TCM (a, TCState)
forall a b c. (a -&gt; b -&gt; c) -&gt; TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO c
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891475"><span class="hs-identifier hs-var">compute</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- | Same as 'localTCState' but keep all warnings.</span></span><span>
</span><span id="line-89"></span><span id="local-6989586621681891477"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#localTCStateSavingWarnings"><span class="hs-identifier hs-type">localTCStateSavingWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891477"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891477"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-90"></span><span id="localTCStateSavingWarnings"><span class="annot"><span class="annottext">localTCStateSavingWarnings :: forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localTCStateSavingWarnings"><span class="hs-identifier hs-var hs-var">localTCStateSavingWarnings</span></a></span></span><span> </span><span id="local-6989586621681891483"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891483"><span class="hs-identifier hs-var">compute</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681891484"><span class="annot"><a href="#local-6989586621681891484"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681891485"><span class="annot"><a href="#local-6989586621681891485"><span class="hs-identifier hs-var">newState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCM (a, TCState)
forall a. TCM a -&gt; TCM (a, TCState)
</span><a href="Agda.TypeChecking.Monad.State.html#localTCStateSaving"><span class="hs-identifier hs-var">localTCStateSaving</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891483"><span class="hs-identifier hs-var">compute</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-type">modifyTC</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-type">over</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-type">stTCWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621681891485"><span class="hs-identifier hs-type">newState</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-type">stTCWarnings</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681891484"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | A fresh TCM instance.</span><span>
</span><span id="line-96"></span><span class="hs-comment">--</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- The computation is run in a fresh state, with the exception that</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- the persistent state is preserved. If the computation changes the</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- state, then these changes are ignored, except for changes to the</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- persistent state. (Changes to the persistent state are also ignored</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- if errors other than type errors or IO exceptions are encountered.)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621681890899"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#freshTCM"><span class="hs-identifier hs-type">freshTCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890899"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890899"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-104"></span><span id="freshTCM"><span class="annot"><span class="annottext">freshTCM :: forall a. TCM a -&gt; TCM (Either TCErr a)
</span><a href="Agda.TypeChecking.Monad.State.html#freshTCM"><span class="hs-identifier hs-var hs-var">freshTCM</span></a></span></span><span> </span><span id="local-6989586621681891512"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891512"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-comment">-- Run m in fresh TCM that only kept the current persistent state.</span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621681891513"><span class="annot"><a href="#local-6989586621681891513"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PersistentTCState -&gt; TCMT IO PersistentTCState
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681891516"><span class="annot"><a href="#local-6989586621681891516"><span class="hs-identifier hs-var hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PersistentTCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#initStateFromPersistentState"><span class="hs-identifier hs-var">initStateFromPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">PersistentTCState
</span><a href="#local-6989586621681891513"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621681891517"><span class="annot"><a href="#local-6989586621681891517"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#runTCM"><span class="hs-identifier hs-type">runTCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#initEnv"><span class="hs-identifier hs-type">initEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891516"><span class="hs-identifier hs-type">s0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891512"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`E.catch`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- Keep m's changes to the persistent state, if possible.</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681891529"><span class="annot"><a href="#local-6989586621681891529"><span class="hs-identifier hs-var hs-var">keepPersistent</span></a></span></span><span> </span><span id="local-6989586621681891530"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891530"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PersistentTCState -&gt; PersistentTCState -&gt; m ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-identifier hs-var">setTCLens</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; m ()) -&gt; PersistentTCState -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891530"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState PersistentTCState -&gt; PersistentTCState
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621681891517"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681891535"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681891535"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681891536"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891536"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either TCErr a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681891535"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Either TCErr a -&gt; TCM () -&gt; TCMT IO (Either TCErr a)
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="#local-6989586621681891529"><span class="hs-identifier hs-var">keepPersistent</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891536"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621681891538"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681891538"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; Either TCErr a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681891538"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Either TCErr a -&gt; TCM () -&gt; TCMT IO (Either TCErr a)
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621681891538"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcErrState :: TCErr -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#tcErrState"><span class="hs-identifier hs-var">tcErrState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681891541"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891541"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="#local-6989586621681891529"><span class="hs-identifier hs-var">keepPersistent</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891541"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681891543"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891543"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="#local-6989586621681891529"><span class="hs-identifier hs-var">keepPersistent</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891543"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GenericException"><span class="hs-identifier hs-type">GenericException</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ParserError"><span class="hs-identifier hs-type">ParserError</span></a></span><span> </span><span class="annot"><span class="annottext">ParseError
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PatternErr"><span class="hs-identifier hs-type">PatternErr</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-125"></span><span class="annot"><span class="hs-comment">-- * Lens for persistent states and its fields</span></span><span>
</span><span id="line-126"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updatePersistentState"><span class="hs-identifier hs-type">updatePersistentState</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PersistentTCState"><span class="hs-identifier hs-type">PersistentTCState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PersistentTCState"><span class="hs-identifier hs-type">PersistentTCState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span id="updatePersistentState"><span class="annot"><span class="annottext">updatePersistentState :: (PersistentTCState -&gt; PersistentTCState) -&gt; TCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.State.html#updatePersistentState"><span class="hs-identifier hs-var hs-var">updatePersistentState</span></a></span></span><span> </span><span id="local-6989586621681891548"><span class="annot"><span class="annottext">PersistentTCState -&gt; PersistentTCState
</span><a href="#local-6989586621681891548"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891549"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891549"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621681891549"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891548"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891549"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyPersistentState"><span class="hs-identifier hs-type">modifyPersistentState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PersistentTCState"><span class="hs-identifier hs-type">PersistentTCState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PersistentTCState"><span class="hs-identifier hs-type">PersistentTCState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span id="modifyPersistentState"><span class="annot"><span class="annottext">modifyPersistentState :: (PersistentTCState -&gt; PersistentTCState) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyPersistentState"><span class="hs-identifier hs-var hs-var">modifyPersistentState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(TCState -&gt; TCState) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-var">modifyTC</span></a></span><span> </span><span class="annot"><span class="annottext">((TCState -&gt; TCState) -&gt; TCM ())
-&gt; ((PersistentTCState -&gt; PersistentTCState) -&gt; TCState -&gt; TCState)
-&gt; (PersistentTCState -&gt; PersistentTCState)
-&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; PersistentTCState) -&gt; TCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.State.html#updatePersistentState"><span class="hs-identifier hs-var">updatePersistentState</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><span class="hs-comment">-- | Lens for 'stAccumStatistics'.</span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatisticsP"><span class="hs-identifier hs-type">lensAccumStatisticsP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PersistentTCState"><span class="hs-identifier hs-type">PersistentTCState</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Statistics"><span class="hs-identifier hs-type">Statistics</span></a></span><span>
</span><span id="line-138"></span><span id="lensAccumStatisticsP"><span class="annot"><span class="annottext">lensAccumStatisticsP :: Lens' PersistentTCState Statistics
</span><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatisticsP"><span class="hs-identifier hs-var hs-var">lensAccumStatisticsP</span></a></span></span><span> </span><span id="local-6989586621681891556"><span class="annot"><span class="annottext">Statistics -&gt; f Statistics
</span><a href="#local-6989586621681891556"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891557"><span class="annot"><span class="annottext">PersistentTCState
</span><a href="#local-6989586621681891557"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Statistics -&gt; f Statistics
</span><a href="#local-6989586621681891556"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PersistentTCState -&gt; Statistics
</span><a href="Agda.TypeChecking.Monad.Base.html#stAccumStatistics"><span class="hs-identifier hs-var">stAccumStatistics</span></a></span><span> </span><span class="annot"><span class="annottext">PersistentTCState
</span><a href="#local-6989586621681891557"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f Statistics
-&gt; (Statistics -&gt; PersistentTCState) -&gt; f PersistentTCState
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681891559"><span class="annot"><span class="annottext">Statistics
</span><a href="#local-6989586621681891559"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">PersistentTCState
</span><a href="#local-6989586621681891557"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stAccumStatistics"><span class="hs-identifier hs-var">stAccumStatistics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891559"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatistics"><span class="hs-identifier hs-type">lensAccumStatistics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Statistics"><span class="hs-identifier hs-type">Statistics</span></a></span><span>
</span><span id="line-142"></span><span id="lensAccumStatistics"><span class="annot"><span class="annottext">lensAccumStatistics :: Lens' TCState Statistics
</span><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatistics"><span class="hs-identifier hs-var hs-var">lensAccumStatistics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">((PersistentTCState -&gt; f PersistentTCState)
 -&gt; TCState -&gt; f TCState)
-&gt; ((Statistics -&gt; f Statistics)
    -&gt; PersistentTCState -&gt; f PersistentTCState)
-&gt; (Statistics -&gt; f Statistics)
-&gt; TCState
-&gt; f TCState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Statistics -&gt; f Statistics)
-&gt; PersistentTCState -&gt; f PersistentTCState
Lens' PersistentTCState Statistics
</span><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatisticsP"><span class="hs-identifier hs-var">lensAccumStatisticsP</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">-- * Scope</span></span><span>
</span><span id="line-146"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-pragma hs-type">getScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- | Get the current scope.</span></span><span>
</span><span id="line-150"></span><span id="local-6989586621681890927"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-type">getScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890927"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890927"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span></span><span>
</span><span id="line-151"></span><span id="getScope"><span class="annot"><span class="annottext">getScope :: forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var hs-var">getScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState ScopeInfo -&gt; m ScopeInfo
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState
Lens' TCState ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stScope"><span class="hs-identifier hs-var">stScope</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-pragma hs-type">setScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-154"></span><span class="annot"><span class="hs-comment">-- | Set the current scope.</span></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-type">setScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span id="setScope"><span class="annot"><span class="annottext">setScope :: ScopeInfo -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-var hs-var">setScope</span></a></span></span><span> </span><span id="local-6989586621681891572"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681891572"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-var">modifyScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeInfo -&gt; ScopeInfo -&gt; ScopeInfo
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681891572"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-pragma hs-type">modifyScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">-- | Modify the current scope without updating the inverse maps.</span></span><span>
</span><span id="line-160"></span><span id="local-6989586621681890930"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-type">modifyScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-161"></span><span id="modifyScope"><span class="annot"><span class="annottext">modifyScope :: forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-var hs-var">modifyScope</span></a></span></span><span> </span><span id="local-6989586621681891576"><span class="annot"><span class="annottext">ScopeInfo -&gt; ScopeInfo
</span><a href="#local-6989586621681891576"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState
Lens' TCState ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stScope"><span class="hs-identifier hs-var">stScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState ScopeInfo -&gt; (ScopeInfo -&gt; ScopeInfo) -&gt; m ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; ScopeInfo
</span><a href="#local-6989586621681891576"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#recomputeInverseScope"><span class="hs-pragma hs-type">recomputeInverseScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-164"></span><span class="annot"><span class="hs-comment">-- | Recompute inverse names, inverse modules and InScopeSet-s.</span></span><span>
</span><span id="line-165"></span><span id="local-6989586621681890935"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#recomputeInverseScope"><span class="hs-identifier hs-type">recomputeInverseScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890935"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890935"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-166"></span><span id="recomputeInverseScope"><span class="annot"><span class="annottext">recomputeInverseScope :: forall (m :: * -&gt; *). MonadTCState m =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#recomputeInverseScope"><span class="hs-identifier hs-var hs-var">recomputeInverseScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-var">modifyScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#recomputeInverseScope%27"><span class="hs-identifier hs-var">recomputeInverseScope'</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-pragma hs-type">useScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-169"></span><span class="annot"><span class="hs-comment">-- | Get a part of the current scope.</span></span><span>
</span><span id="line-170"></span><span id="local-6989586621681890937"><span id="local-6989586621681890938"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-type">useScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890937"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890938"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890937"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890938"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-171"></span><span id="useScope"><span class="annot"><span class="annottext">useScope :: forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' ScopeInfo a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var hs-var">useScope</span></a></span></span><span> </span><span id="local-6989586621681891587"><span class="annot"><span class="annottext">Lens' ScopeInfo a
</span><a href="#local-6989586621681891587"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState a -&gt; m a
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(Lens' TCState a -&gt; m a) -&gt; Lens' TCState a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState
Lens' TCState ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stScope"><span class="hs-identifier hs-var">stScope</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState)
-&gt; ((a -&gt; f a) -&gt; ScopeInfo -&gt; f ScopeInfo)
-&gt; (a -&gt; f a)
-&gt; TCState
-&gt; f TCState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f a) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' ScopeInfo a
</span><a href="#local-6989586621681891587"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#locallyScope"><span class="hs-pragma hs-type">locallyScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-174"></span><span class="annot"><span class="hs-comment">-- | Run a computation in a modified scope.</span></span><span>
</span><span id="line-175"></span><span id="local-6989586621681890943"><span id="local-6989586621681890944"><span id="local-6989586621681890945"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#locallyScope"><span class="hs-identifier hs-type">locallyScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890943"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890944"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681890944"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890944"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890943"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890945"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890943"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890945"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-176"></span><span id="locallyScope"><span class="annot"><span class="annottext">locallyScope :: forall (m :: * -&gt; *) a b.
ReadTCState m =&gt;
Lens' ScopeInfo a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.State.html#locallyScope"><span class="hs-identifier hs-var hs-var">locallyScope</span></a></span></span><span> </span><span id="local-6989586621681891596"><span class="annot"><span class="annottext">Lens' ScopeInfo a
</span><a href="#local-6989586621681891596"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
forall a b. Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b.
ReadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTCState"><span class="hs-identifier hs-var">locallyTCState</span></a></span><span> </span><span class="annot"><span class="annottext">(Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b)
-&gt; Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState
Lens' TCState ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stScope"><span class="hs-identifier hs-var">stScope</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState)
-&gt; ((a -&gt; f a) -&gt; ScopeInfo -&gt; f ScopeInfo)
-&gt; (a -&gt; f a)
-&gt; TCState
-&gt; f TCState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f a) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' ScopeInfo a
</span><a href="#local-6989586621681891596"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#withScope"><span class="hs-pragma hs-type">withScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-179"></span><span class="annot"><span class="hs-comment">-- | Run a computation in a local scope.</span></span><span>
</span><span id="line-180"></span><span id="local-6989586621681890954"><span id="local-6989586621681890955"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#withScope"><span class="hs-identifier hs-type">withScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890955"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681890955"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-181"></span><span id="withScope"><span class="annot"><span class="annottext">withScope :: forall (m :: * -&gt; *) a.
ReadTCState m =&gt;
ScopeInfo -&gt; m a -&gt; m (a, ScopeInfo)
</span><a href="Agda.TypeChecking.Monad.State.html#withScope"><span class="hs-identifier hs-var hs-var">withScope</span></a></span></span><span> </span><span id="local-6989586621681891613"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681891613"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681891614"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681891614"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState ScopeInfo
-&gt; (ScopeInfo -&gt; ScopeInfo) -&gt; m (a, ScopeInfo) -&gt; m (a, ScopeInfo)
forall a b. Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b.
ReadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTCState"><span class="hs-identifier hs-var">locallyTCState</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState
Lens' TCState ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#stScope"><span class="hs-identifier hs-var">stScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeInfo -&gt; ScopeInfo -&gt; ScopeInfo
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681891613"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (a, ScopeInfo) -&gt; m (a, ScopeInfo))
-&gt; m (a, ScopeInfo) -&gt; m (a, ScopeInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; ScopeInfo -&gt; (a, ScopeInfo))
-&gt; m a -&gt; m (ScopeInfo -&gt; (a, ScopeInfo))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681891614"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (ScopeInfo -&gt; (a, ScopeInfo)) -&gt; m ScopeInfo -&gt; m (a, ScopeInfo)
forall a b. m (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">m ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#evalWithScope"><span class="hs-pragma hs-type">evalWithScope</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-184"></span><span class="annot"><span class="hs-comment">-- | Same as 'withScope', but discard the scope from the computation.</span></span><span>
</span><span id="line-185"></span><span id="local-6989586621681890959"><span id="local-6989586621681890960"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#evalWithScope"><span class="hs-identifier hs-type">evalWithScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890959"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890959"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890960"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890959"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890960"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-186"></span><span id="evalWithScope"><span class="annot"><span class="annottext">evalWithScope :: forall (m :: * -&gt; *) a. ReadTCState m =&gt; ScopeInfo -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#evalWithScope"><span class="hs-identifier hs-var hs-var">evalWithScope</span></a></span></span><span> </span><span id="local-6989586621681891624"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681891624"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681891625"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681891625"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, ScopeInfo) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, ScopeInfo) -&gt; a) -&gt; m (a, ScopeInfo) -&gt; m a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; m a -&gt; m (a, ScopeInfo)
forall (m :: * -&gt; *) a.
ReadTCState m =&gt;
ScopeInfo -&gt; m a -&gt; m (a, ScopeInfo)
</span><a href="Agda.TypeChecking.Monad.State.html#withScope"><span class="hs-identifier hs-var">withScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621681891624"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681891625"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><span class="hs-comment">-- | Discard any changes to the scope by a computation.</span></span><span>
</span><span id="line-189"></span><span id="local-6989586621681891627"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#localScope"><span class="hs-identifier hs-type">localScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891627"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891627"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-190"></span><span id="localScope"><span class="annot"><span class="annottext">localScope :: forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localScope"><span class="hs-identifier hs-var hs-var">localScope</span></a></span></span><span> </span><span id="local-6989586621681891634"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891634"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621681891635"><span class="annot"><a href="#local-6989586621681891635"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621681891636"><span class="annot"><a href="#local-6989586621681891636"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621681891634"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-type">setScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891635"><span class="hs-identifier hs-type">scope</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681891636"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><span class="hs-comment">-- | Scope error.</span></span><span>
</span><span id="line-197"></span><span id="local-6989586621681890967"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#notInScopeError"><span class="hs-identifier hs-type">notInScopeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890967"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-198"></span><span id="notInScopeError"><span class="annot"><span class="annottext">notInScopeError :: forall a. QName -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#notInScopeError"><span class="hs-identifier hs-var hs-var">notInScopeError</span></a></span></span><span> </span><span id="local-6989586621681891642"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891642"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#printScope"><span class="hs-identifier hs-var">printScope</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unbound&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO a) -&gt; TypeError -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NotInScope"><span class="hs-identifier hs-var">NotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891642"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#notInScopeWarning"><span class="hs-identifier hs-type">notInScopeWarning</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span id="notInScopeWarning"><span class="annot"><span class="annottext">notInScopeWarning :: QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#notInScopeWarning"><span class="hs-identifier hs-var hs-var">notInScopeWarning</span></a></span></span><span> </span><span id="local-6989586621681891647"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891647"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#printScope"><span class="hs-identifier hs-var">printScope</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unbound&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#NotInScopeW"><span class="hs-identifier hs-var">NotInScopeW</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891647"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><span class="hs-comment">-- | Debug print the scope.</span></span><span>
</span><span id="line-208"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#printScope"><span class="hs-identifier hs-type">printScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span id="printScope"><span class="annot"><span class="annottext">printScope :: [Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#printScope"><span class="hs-identifier hs-var hs-var">printScope</span></a></span></span><span> </span><span id="local-6989586621681891650"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681891650"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621681891651"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681891651"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681891652"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681891652"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;scope.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681891650"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681891651"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621681891653"><span class="annot"><a href="#local-6989586621681891653"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-type">reportS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;scope.&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621681891650"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681891651"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-identifier hs-type">text</span></span><span> </span><span class="annot"><a href="#local-6989586621681891652"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891653"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-214"></span><span class="annot"><span class="hs-comment">-- * Signature</span></span><span>
</span><span id="line-215"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><span class="hs-comment">-- ** Lens for 'stSignature' and 'stImports'</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-pragma hs-type">modifySignature</span></a></span><span>  </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-220"></span><span id="local-6989586621681890983"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-type">modifySignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890983"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890983"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-221"></span><span id="modifySignature"><span class="annot"><span class="annottext">modifySignature :: forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var hs-var">modifySignature</span></a></span></span><span> </span><span id="local-6989586621681891662"><span class="annot"><span class="annottext">Signature -&gt; Signature
</span><a href="#local-6989586621681891662"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stSignature"><span class="hs-identifier hs-var">stSignature</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState Signature -&gt; (Signature -&gt; Signature) -&gt; m ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Signature
</span><a href="#local-6989586621681891662"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyImportedSignature"><span class="hs-pragma hs-type">modifyImportedSignature</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-224"></span><span id="local-6989586621681891666"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyImportedSignature"><span class="hs-identifier hs-type">modifyImportedSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891666"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891666"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-225"></span><span id="modifyImportedSignature"><span class="annot"><span class="annottext">modifyImportedSignature :: forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyImportedSignature"><span class="hs-identifier hs-var hs-var">modifyImportedSignature</span></a></span></span><span> </span><span id="local-6989586621681891669"><span class="annot"><span class="annottext">Signature -&gt; Signature
</span><a href="#local-6989586621681891669"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-var">stImports</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState Signature -&gt; (Signature -&gt; Signature) -&gt; m ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Signature
</span><a href="#local-6989586621681891669"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-pragma hs-type">getSignature</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-228"></span><span id="local-6989586621681890989"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-identifier hs-type">getSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890989"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890989"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span></span><span>
</span><span id="line-229"></span><span id="getSignature"><span class="annot"><span class="annottext">getSignature :: forall (m :: * -&gt; *). ReadTCState m =&gt; m Signature
</span><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-identifier hs-var hs-var">getSignature</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState Signature -&gt; m Signature
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stSignature"><span class="hs-identifier hs-var">stSignature</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyGlobalDefinition"><span class="hs-pragma hs-type">modifyGlobalDefinition</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-pragma hs-type">QName</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-pragma hs-type">Definition</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-pragma hs-type">Definition</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- | Update a possibly imported definition. Warning: changes made to imported</span><span>
</span><span id="line-233"></span><span class="hs-comment">--   definitions (during type checking) will not persist outside the current</span><span>
</span><span id="line-234"></span><span class="hs-comment">--   module. This function is currently used to update the compiled</span><span>
</span><span id="line-235"></span><span class="hs-comment">--   representation of a function during compilation.</span><span>
</span><span id="line-236"></span><span id="local-6989586621681890992"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyGlobalDefinition"><span class="hs-identifier hs-type">modifyGlobalDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-237"></span><span id="modifyGlobalDefinition"><span class="annot"><span class="annottext">modifyGlobalDefinition :: forall (m :: * -&gt; *).
MonadTCState m =&gt;
QName -&gt; (Definition -&gt; Definition) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyGlobalDefinition"><span class="hs-identifier hs-var hs-var">modifyGlobalDefinition</span></a></span></span><span> </span><span id="local-6989586621681891683"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891683"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681891684"><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891684"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span>         </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; m ())
-&gt; (Signature -&gt; Signature) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891683"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891684"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyImportedSignature"><span class="hs-identifier hs-var">modifyImportedSignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; m ())
-&gt; (Signature -&gt; Signature) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891683"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891684"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setSignature"><span class="hs-pragma hs-type">setSignature</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-242"></span><span id="local-6989586621681890995"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setSignature"><span class="hs-identifier hs-type">setSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-243"></span><span id="setSignature"><span class="annot"><span class="annottext">setSignature :: forall (m :: * -&gt; *). MonadTCState m =&gt; Signature -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#setSignature"><span class="hs-identifier hs-var hs-var">setSignature</span></a></span></span><span> </span><span id="local-6989586621681891689"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681891689"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; m ())
-&gt; (Signature -&gt; Signature) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Signature -&gt; Signature
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681891689"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#withSignature"><span class="hs-pragma hs-type">withSignature</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span id="local-6989586621681891691"><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-pragma hs-type">Signature</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891691"><span class="hs-pragma hs-type">a</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891691"><span class="hs-pragma hs-type">a</span></a></span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-246"></span><span class="annot"><span class="hs-comment">-- | Run some computation in a different signature, restore original signature.</span></span><span>
</span><span id="line-247"></span><span id="local-6989586621681890997"><span id="local-6989586621681890998"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#withSignature"><span class="hs-identifier hs-type">withSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890997"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890997"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890997"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890998"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681890997"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681890998"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-248"></span><span id="withSignature"><span class="annot"><span class="annottext">withSignature :: forall (m :: * -&gt; *) a.
(ReadTCState m, MonadTCState m) =&gt;
Signature -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#withSignature"><span class="hs-identifier hs-var hs-var">withSignature</span></a></span></span><span> </span><span id="local-6989586621681891703"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681891703"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621681891704"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681891704"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621681891705"><span class="annot"><a href="#local-6989586621681891705"><span class="hs-identifier hs-var">sig0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Signature
forall (m :: * -&gt; *). ReadTCState m =&gt; m Signature
</span><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-identifier hs-var">getSignature</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setSignature"><span class="hs-identifier hs-type">setSignature</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891703"><span class="hs-identifier hs-type">sig</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621681891706"><span class="annot"><a href="#local-6989586621681891706"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621681891704"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setSignature"><span class="hs-identifier hs-type">setSignature</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891705"><span class="hs-identifier hs-type">sig0</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681891706"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="annot"><span class="hs-comment">-- ** Modifiers for rewrite rules</span></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#addRewriteRulesFor"><span class="hs-identifier hs-type">addRewriteRulesFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-257"></span><span id="addRewriteRulesFor"><span class="annot"><span class="annottext">addRewriteRulesFor :: QName -&gt; RewriteRules -&gt; [QName] -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#addRewriteRulesFor"><span class="hs-identifier hs-var hs-var">addRewriteRulesFor</span></a></span></span><span> </span><span id="local-6989586621681891708"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891708"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891709"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681891709"><span class="hs-identifier hs-var">rews</span></a></span></span><span> </span><span id="local-6989586621681891710"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681891710"><span class="hs-identifier hs-var">matchables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">Lens' Signature (HashMap QName RewriteRules)
-&gt; LensMap Signature (HashMap QName RewriteRules)
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName RewriteRules -&gt; f (HashMap QName RewriteRules))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName RewriteRules)
</span><a href="Agda.TypeChecking.Monad.Base.html#sigRewriteRules"><span class="hs-identifier hs-var">sigRewriteRules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RewriteRules -&gt; RewriteRules -&gt; RewriteRules)
-&gt; QName
-&gt; RewriteRules
-&gt; HashMap QName RewriteRules
-&gt; HashMap QName RewriteRules
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.insertWith</span></span><span> </span><span class="annot"><span class="annottext">RewriteRules -&gt; RewriteRules -&gt; RewriteRules
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891708"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681891709"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; Signature)
-&gt; (Signature -&gt; Signature) -&gt; Signature -&gt; Signature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891708"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Defn -&gt; Defn) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateTheDef"><span class="hs-identifier hs-var">updateTheDef</span></a></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Defn
</span><a href="#local-6989586621681891716"><span class="hs-identifier hs-var">setNotInjective</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Definition)
-&gt; (Definition -&gt; Definition) -&gt; Definition -&gt; Definition
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891717"><span class="hs-identifier hs-var">setCopatternLHS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; Signature)
-&gt; (Signature -&gt; Signature) -&gt; Signature -&gt; Signature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#setMatchableSymbols"><span class="hs-identifier hs-var">setMatchableSymbols</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891708"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681891710"><span class="hs-identifier hs-var">matchables</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>      </span><span id="local-6989586621681891716"><span class="annot"><span class="annottext">setNotInjective :: Defn -&gt; Defn
</span><a href="#local-6989586621681891716"><span class="hs-identifier hs-var hs-var">setNotInjective</span></a></span></span><span> </span><span id="local-6989586621681891719"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621681891719"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681891719"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funInv"><span class="hs-identifier hs-var">funInv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NotInjective"><span class="hs-identifier hs-type">NotInjective</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><a href="#local-6989586621681891716"><span class="hs-identifier hs-var">setNotInjective</span></a></span><span> </span><span id="local-6989586621681891723"><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681891723"><span class="hs-identifier hs-var">def</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681891723"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621681891717"><span class="annot"><span class="annottext">setCopatternLHS :: Definition -&gt; Definition
</span><a href="#local-6989586621681891717"><span class="hs-identifier hs-var hs-var">setCopatternLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefCopatternLHS"><span class="hs-identifier hs-var">updateDefCopatternLHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(RewriteRule -&gt; Bool) -&gt; RewriteRules -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; Bool
</span><a href="#local-6989586621681891727"><span class="hs-identifier hs-var">hasProjectionPattern</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621681891709"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>      </span><span id="local-6989586621681891727"><span class="annot"><span class="annottext">hasProjectionPattern :: RewriteRule -&gt; Bool
</span><a href="#local-6989586621681891727"><span class="hs-identifier hs-var hs-var">hasProjectionPattern</span></a></span></span><span> </span><span id="local-6989586621681891731"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681891731"><span class="hs-identifier hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Elim' NLPat -&gt; Bool) -&gt; [Elim' NLPat] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ProjOrigin, QName) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (ProjOrigin, QName) -&gt; Bool)
-&gt; (Elim' NLPat -&gt; Maybe (ProjOrigin, QName))
-&gt; Elim' NLPat
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Elim' NLPat -&gt; Maybe (ProjOrigin, QName)
forall e. IsProjElim e =&gt; e -&gt; Maybe (ProjOrigin, QName)
</span><a href="Agda.Syntax.Internal.Elim.html#isProjElim"><span class="hs-identifier hs-var">isProjElim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Elim' NLPat] -&gt; Bool) -&gt; [Elim' NLPat] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; [Elim' NLPat]
</span><a href="Agda.TypeChecking.Monad.Base.html#rewPats"><span class="hs-identifier hs-var">rewPats</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621681891731"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setMatchableSymbols"><span class="hs-identifier hs-type">setMatchableSymbols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-271"></span><span id="setMatchableSymbols"><span class="annot"><span class="annottext">setMatchableSymbols :: QName -&gt; [QName] -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#setMatchableSymbols"><span class="hs-identifier hs-var hs-var">setMatchableSymbols</span></a></span></span><span> </span><span id="local-6989586621681891735"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891735"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891736"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681891736"><span class="hs-identifier hs-var">matchables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">(QName -&gt; (Signature -&gt; Signature) -&gt; Signature -&gt; Signature)
-&gt; (Signature -&gt; Signature) -&gt; [QName] -&gt; Signature -&gt; Signature
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Signature -&gt; Signature)
-&gt; (Signature -&gt; Signature) -&gt; Signature -&gt; Signature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">(.)</span></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature)
 -&gt; (Signature -&gt; Signature) -&gt; Signature -&gt; Signature)
-&gt; (QName -&gt; Signature -&gt; Signature)
-&gt; QName
-&gt; (Signature -&gt; Signature)
-&gt; Signature
-&gt; Signature
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681891738"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891738"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891738"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891739"><span class="hs-identifier hs-var">setMatchable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Signature
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681891736"><span class="hs-identifier hs-var">matchables</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621681891739"><span class="annot"><span class="annottext">setMatchable :: Definition -&gt; Definition
</span><a href="#local-6989586621681891739"><span class="hs-identifier hs-var hs-var">setMatchable</span></a></span></span><span> </span><span id="local-6989586621681891741"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891741"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891741"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defMatchable"><span class="hs-identifier hs-var">defMatchable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621681891735"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defMatchable"><span class="hs-identifier hs-var">defMatchable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891741"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><span class="hs-comment">-- ** 'modify' methods for the signature</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span id="local-6989586621681891025"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyRecEta"><span class="hs-identifier hs-type">modifyRecEta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891025"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#EtaEquality"><span class="hs-identifier hs-type">EtaEquality</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#EtaEquality"><span class="hs-identifier hs-type">EtaEquality</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891025"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-279"></span><span id="modifyRecEta"><span class="annot"><span class="annottext">modifyRecEta :: forall (m :: * -&gt; *).
MonadTCState m =&gt;
QName -&gt; (EtaEquality -&gt; EtaEquality) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyRecEta"><span class="hs-identifier hs-var hs-var">modifyRecEta</span></a></span></span><span> </span><span id="local-6989586621681891747"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891747"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681891748"><span class="annot"><span class="annottext">EtaEquality -&gt; EtaEquality
</span><a href="#local-6989586621681891748"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; m ())
-&gt; (Signature -&gt; Signature) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891747"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; Definition) -&gt; Signature -&gt; Signature)
-&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' Definition EtaEquality -&gt; LensMap Definition EtaEquality
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Defn -&gt; f Defn) -&gt; Definition -&gt; f Definition
Lens' Definition Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#lensTheDef"><span class="hs-identifier hs-var">lensTheDef</span></a></span><span> </span><span class="annot"><span class="annottext">((Defn -&gt; f Defn) -&gt; Definition -&gt; f Definition)
-&gt; ((EtaEquality -&gt; f EtaEquality) -&gt; Defn -&gt; f Defn)
-&gt; (EtaEquality -&gt; f EtaEquality)
-&gt; Definition
-&gt; f Definition
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RecordData -&gt; f RecordData) -&gt; Defn -&gt; f Defn
Lens' Defn RecordData
</span><a href="Agda.TypeChecking.Monad.Base.html#lensRecord"><span class="hs-identifier hs-var">lensRecord</span></a></span><span> </span><span class="annot"><span class="annottext">((RecordData -&gt; f RecordData) -&gt; Defn -&gt; f Defn)
-&gt; ((EtaEquality -&gt; f EtaEquality) -&gt; RecordData -&gt; f RecordData)
-&gt; (EtaEquality -&gt; f EtaEquality)
-&gt; Defn
-&gt; f Defn
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EtaEquality -&gt; f EtaEquality) -&gt; RecordData -&gt; f RecordData
Lens' RecordData EtaEquality
</span><a href="Agda.TypeChecking.Monad.Base.html#lensRecEta"><span class="hs-identifier hs-var">lensRecEta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EtaEquality -&gt; EtaEquality
</span><a href="#local-6989586621681891748"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><span class="hs-comment">-- ** Modifiers for parts of the signature</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lookupDefinition"><span class="hs-identifier hs-type">lookupDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span>
</span><span id="line-285"></span><span id="lookupDefinition"><span class="annot"><span class="annottext">lookupDefinition :: QName -&gt; Signature -&gt; Maybe Definition
</span><a href="Agda.TypeChecking.Monad.State.html#lookupDefinition"><span class="hs-identifier hs-var hs-var">lookupDefinition</span></a></span></span><span> </span><span id="local-6989586621681891757"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891757"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681891758"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681891758"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; HashMap QName Definition -&gt; Maybe Definition
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891757"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; Maybe Definition)
-&gt; HashMap QName Definition -&gt; Maybe Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681891758"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
-&gt; Lens' Signature (HashMap QName Definition)
-&gt; HashMap QName Definition
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; f (HashMap QName Definition))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName Definition)
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefinitions"><span class="hs-identifier hs-type">updateDefinitions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-288"></span><span id="updateDefinitions"><span class="annot"><span class="annottext">updateDefinitions :: (HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinitions"><span class="hs-identifier hs-var hs-var">updateDefinitions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' Signature (HashMap QName Definition)
-&gt; (HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; Signature
-&gt; Signature
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; f (HashMap QName Definition))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName Definition)
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-type">updateDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-291"></span><span id="updateDefinition"><span class="annot"><span class="annottext">updateDefinition :: QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var hs-var">updateDefinition</span></a></span></span><span> </span><span id="local-6989586621681891767"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891767"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681891768"><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891768"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinitions"><span class="hs-identifier hs-var">updateDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap QName Definition -&gt; HashMap QName Definition)
 -&gt; Signature -&gt; Signature)
-&gt; (HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; Signature
-&gt; Signature
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Definition)
-&gt; QName -&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v) -&gt; k -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.adjust</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Definition
</span><a href="#local-6989586621681891768"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681891767"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateTheDef"><span class="hs-identifier hs-type">updateTheDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span id="updateTheDef"><span class="annot"><span class="annottext">updateTheDef :: (Defn -&gt; Defn) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateTheDef"><span class="hs-identifier hs-var hs-var">updateTheDef</span></a></span></span><span> </span><span id="local-6989586621681891770"><span class="annot"><span class="annottext">Defn -&gt; Defn
</span><a href="#local-6989586621681891770"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891771"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891771"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891771"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891770"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891771"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefType"><span class="hs-identifier hs-type">updateDefType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span id="updateDefType"><span class="annot"><span class="annottext">updateDefType :: (Type -&gt; Type) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefType"><span class="hs-identifier hs-var hs-var">updateDefType</span></a></span></span><span> </span><span id="local-6989586621681891774"><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621681891774"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891775"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891775"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891775"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891774"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891775"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefArgOccurrences"><span class="hs-identifier hs-type">updateDefArgOccurrences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span id="updateDefArgOccurrences"><span class="annot"><span class="annottext">updateDefArgOccurrences :: ([Occurrence] -&gt; [Occurrence]) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefArgOccurrences"><span class="hs-identifier hs-var hs-var">updateDefArgOccurrences</span></a></span></span><span> </span><span id="local-6989586621681891778"><span class="annot"><span class="annottext">[Occurrence] -&gt; [Occurrence]
</span><a href="#local-6989586621681891778"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891779"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891779"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891779"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891778"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891779"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefPolarity"><span class="hs-identifier hs-type">updateDefPolarity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Polarity"><span class="hs-identifier hs-type">Polarity</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span id="updateDefPolarity"><span class="annot"><span class="annottext">updateDefPolarity :: ([Polarity] -&gt; [Polarity]) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefPolarity"><span class="hs-identifier hs-var hs-var">updateDefPolarity</span></a></span></span><span> </span><span id="local-6989586621681891782"><span class="annot"><span class="annottext">[Polarity] -&gt; [Polarity]
</span><a href="#local-6989586621681891782"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891783"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891783"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891783"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defPolarity"><span class="hs-identifier hs-var">defPolarity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891782"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defPolarity"><span class="hs-identifier hs-var">defPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891783"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefCompiledRep"><span class="hs-identifier hs-type">updateDefCompiledRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CompiledRepresentation"><span class="hs-identifier hs-type">CompiledRepresentation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CompiledRepresentation"><span class="hs-identifier hs-type">CompiledRepresentation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span id="updateDefCompiledRep"><span class="annot"><span class="annottext">updateDefCompiledRep :: (CompiledRepresentation -&gt; CompiledRepresentation)
-&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefCompiledRep"><span class="hs-identifier hs-var hs-var">updateDefCompiledRep</span></a></span></span><span> </span><span id="local-6989586621681891786"><span class="annot"><span class="annottext">CompiledRepresentation -&gt; CompiledRepresentation
</span><a href="#local-6989586621681891786"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891787"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891787"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891787"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defCompiledRep"><span class="hs-identifier hs-var">defCompiledRep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891786"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defCompiledRep"><span class="hs-identifier hs-var">defCompiledRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891787"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#addCompilerPragma"><span class="hs-identifier hs-type">addCompilerPragma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#BackendName"><span class="hs-identifier hs-type">BackendName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CompilerPragma"><span class="hs-identifier hs-type">CompilerPragma</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span>
</span><span id="line-309"></span><span id="addCompilerPragma"><span class="annot"><span class="annottext">addCompilerPragma :: BackendName -&gt; CompilerPragma -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#addCompilerPragma"><span class="hs-identifier hs-var hs-var">addCompilerPragma</span></a></span></span><span> </span><span id="local-6989586621681891790"><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621681891790"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621681891791"><span class="annot"><span class="annottext">CompilerPragma
</span><a href="#local-6989586621681891791"><span class="hs-identifier hs-var">pragma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompiledRepresentation -&gt; CompiledRepresentation)
-&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefCompiledRep"><span class="hs-identifier hs-var">updateDefCompiledRep</span></a></span><span> </span><span class="annot"><span class="annottext">((CompiledRepresentation -&gt; CompiledRepresentation)
 -&gt; Definition -&gt; Definition)
-&gt; (CompiledRepresentation -&gt; CompiledRepresentation)
-&gt; Definition
-&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([CompilerPragma] -&gt; [CompilerPragma] -&gt; [CompilerPragma])
-&gt; BackendName
-&gt; [CompilerPragma]
-&gt; CompiledRepresentation
-&gt; CompiledRepresentation
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">[CompilerPragma] -&gt; [CompilerPragma] -&gt; [CompilerPragma]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621681891790"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompilerPragma
</span><a href="#local-6989586621681891791"><span class="hs-identifier hs-var">pragma</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateFunClauses"><span class="hs-identifier hs-type">updateFunClauses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span id="updateFunClauses"><span class="annot"><span class="annottext">updateFunClauses :: ([Clause] -&gt; [Clause]) -&gt; Defn -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.State.html#updateFunClauses"><span class="hs-identifier hs-var hs-var">updateFunClauses</span></a></span></span><span> </span><span id="local-6989586621681891794"><span class="annot"><span class="annottext">[Clause] -&gt; [Clause]
</span><a href="#local-6989586621681891794"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891795"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621681891795"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funClauses :: Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681891797"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621681891797"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681891795"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891794"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891797"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-313"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateFunClauses"><span class="hs-identifier hs-var">updateFunClauses</span></a></span><span> </span><span id="local-6989586621681891798"><span class="annot"><span class="annottext">[Clause] -&gt; [Clause]
</span><a href="#local-6989586621681891798"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateCovering"><span class="hs-identifier hs-type">updateCovering</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span id="updateCovering"><span class="annot"><span class="annottext">updateCovering :: ([Clause] -&gt; [Clause]) -&gt; Defn -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.State.html#updateCovering"><span class="hs-identifier hs-var hs-var">updateCovering</span></a></span></span><span> </span><span id="local-6989586621681891801"><span class="annot"><span class="annottext">[Clause] -&gt; [Clause]
</span><a href="#local-6989586621681891801"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891802"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621681891802"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funCovering :: Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funCovering"><span class="hs-identifier hs-var">funCovering</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681891804"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621681891804"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681891802"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funCovering"><span class="hs-identifier hs-var">funCovering</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891801"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891804"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-317"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateCovering"><span class="hs-identifier hs-var">updateCovering</span></a></span><span> </span><span id="local-6989586621681891805"><span class="annot"><span class="annottext">[Clause] -&gt; [Clause]
</span><a href="#local-6989586621681891805"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateCompiledClauses"><span class="hs-identifier hs-type">updateCompiledClauses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span id="updateCompiledClauses"><span class="annot"><span class="annottext">updateCompiledClauses :: (Maybe CompiledClauses -&gt; Maybe CompiledClauses) -&gt; Defn -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.State.html#updateCompiledClauses"><span class="hs-identifier hs-var hs-var">updateCompiledClauses</span></a></span></span><span> </span><span id="local-6989586621681891807"><span class="annot"><span class="annottext">Maybe CompiledClauses -&gt; Maybe CompiledClauses
</span><a href="#local-6989586621681891807"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891808"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621681891808"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funCompiled :: Defn -&gt; Maybe CompiledClauses
</span><a href="Agda.TypeChecking.Monad.Base.html#funCompiled"><span class="hs-identifier hs-var">funCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681891810"><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621681891810"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621681891808"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funCompiled"><span class="hs-identifier hs-var">funCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891807"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891810"><span class="hs-identifier hs-type">cc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-321"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateCompiledClauses"><span class="hs-identifier hs-var">updateCompiledClauses</span></a></span><span> </span><span id="local-6989586621681891811"><span class="annot"><span class="annottext">Maybe CompiledClauses -&gt; Maybe CompiledClauses
</span><a href="#local-6989586621681891811"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefCopatternLHS"><span class="hs-identifier hs-type">updateDefCopatternLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span>
</span><span id="line-324"></span><span id="updateDefCopatternLHS"><span class="annot"><span class="annottext">updateDefCopatternLHS :: (Bool -&gt; Bool) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefCopatternLHS"><span class="hs-identifier hs-var hs-var">updateDefCopatternLHS</span></a></span></span><span> </span><span id="local-6989586621681891812"><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="#local-6989586621681891812"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891813"><span class="annot"><span class="annottext">def :: Definition
</span><a href="#local-6989586621681891813"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">defCopatternLHS :: Definition -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#defCopatternLHS"><span class="hs-identifier hs-var">defCopatternLHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681891816"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681891816"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891813"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defCopatternLHS"><span class="hs-identifier hs-var">defCopatternLHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891812"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891816"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefBlocked"><span class="hs-identifier hs-type">updateDefBlocked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span>
</span><span id="line-327"></span><span id="updateDefBlocked"><span class="annot"><span class="annottext">updateDefBlocked :: (Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefBlocked"><span class="hs-identifier hs-var hs-var">updateDefBlocked</span></a></span></span><span> </span><span id="local-6989586621681891818"><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_
</span><a href="#local-6989586621681891818"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681891819"><span class="annot"><span class="annottext">def :: Definition
</span><a href="#local-6989586621681891819"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">defBlocked :: Definition -&gt; Blocked_
</span><a href="Agda.TypeChecking.Monad.Base.html#defBlocked"><span class="hs-identifier hs-var">defBlocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681891821"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621681891821"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681891819"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defBlocked"><span class="hs-identifier hs-var">defBlocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681891818"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891821"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-330"></span><span class="annot"><span class="hs-comment">-- * File identification</span></span><span>
</span><span id="line-331"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-comment">-- | Translate an absolute path to a file id, and register a new file id</span><span>
</span><span id="line-334"></span><span class="hs-comment">--   if the path has not seen before.</span><span>
</span><span id="line-335"></span><span class="hs-comment">--   Also register whether the path belongs to one of Agda's builtin modules.</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#registerFileIdWithBuiltin"><span class="hs-identifier hs-type">registerFileIdWithBuiltin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#File"><span class="hs-identifier hs-type">File</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#FileDictWithBuiltins"><span class="hs-identifier hs-type">FileDictWithBuiltins</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.FileId.html#FileId"><span class="hs-identifier hs-type">FileId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#FileDictWithBuiltins"><span class="hs-identifier hs-type">FileDictWithBuiltins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span id="registerFileIdWithBuiltin"><span class="annot"><span class="annottext">registerFileIdWithBuiltin :: File -&gt; FileDictWithBuiltins -&gt; (FileId, FileDictWithBuiltins)
</span><a href="Agda.TypeChecking.Monad.State.html#registerFileIdWithBuiltin"><span class="hs-identifier hs-var hs-var">registerFileIdWithBuiltin</span></a></span></span><span> </span><span id="local-6989586621681891823"><span class="annot"><span class="annottext">File
</span><a href="#local-6989586621681891823"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#FileDictWithBuiltins"><span class="hs-identifier hs-type">FileDictWithBuiltins</span></a></span><span> </span><span id="local-6989586621681891825"><span class="annot"><span class="annottext">FileDictBuilder
</span><a href="#local-6989586621681891825"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681891826"><span class="annot"><span class="annottext">BuiltinModuleIds
</span><a href="#local-6989586621681891826"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681891827"><span class="annot"><span class="annottext">File
</span><a href="#local-6989586621681891827"><span class="hs-identifier hs-var">primLibDir</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891828"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileDictBuilder -&gt; BuiltinModuleIds -&gt; File -&gt; FileDictWithBuiltins
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#FileDictWithBuiltins"><span class="hs-identifier hs-var">FileDictWithBuiltins</span></a></span><span> </span><span class="annot"><span class="annottext">FileDictBuilder
</span><a href="#local-6989586621681891829"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinModuleIds
</span><a href="#local-6989586621681891830"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">File
</span><a href="#local-6989586621681891827"><span class="hs-identifier hs-var">primLibDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681891828"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891828"><span class="hs-identifier hs-var">fi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681891831"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681891831"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681891829"><span class="annot"><span class="annottext">FileDictBuilder
</span><a href="#local-6989586621681891829"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">File -&gt; FileDictBuilder -&gt; ((FileId, Bool), FileDictBuilder)
</span><a href="Agda.Utils.FileId.html#registerFileId%27"><span class="hs-identifier hs-var">registerFileId'</span></a></span><span> </span><span class="annot"><span class="annottext">File
</span><a href="#local-6989586621681891823"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FileDictBuilder
</span><a href="#local-6989586621681891825"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span id="local-6989586621681891830"><span class="annot"><span class="annottext">b' :: BuiltinModuleIds
</span><a href="#local-6989586621681891830"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">File -&gt; File -&gt; Maybe IsBuiltinModule
</span><a href="Agda.Interaction.Library.html#classifyBuiltinModule_"><span class="hs-identifier hs-var">classifyBuiltinModule_</span></a></span><span> </span><span class="annot"><span class="annottext">File
</span><a href="#local-6989586621681891827"><span class="hs-identifier hs-var">primLibDir</span></a></span><span> </span><span class="annot"><span class="annottext">File
</span><a href="#local-6989586621681891823"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">Maybe IsBuiltinModule
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuiltinModuleIds
</span><a href="#local-6989586621681891826"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681891832"><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="#local-6989586621681891832"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FileId -&gt; IsBuiltinModule -&gt; BuiltinModuleIds -&gt; BuiltinModuleIds
forall k a. Enum k =&gt; k -&gt; a -&gt; EnumMap k a -&gt; EnumMap k a
</span><span class="hs-identifier hs-var">EnumMap.insert</span></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891828"><span class="hs-identifier hs-var">fi</span></a></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="#local-6989586621681891832"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinModuleIds
</span><a href="#local-6989586621681891826"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681891058"><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621681891058"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#MonadFileId"><span class="hs-identifier hs-type">MonadFileId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCMT"><span class="hs-identifier hs-type">TCMT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891058"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-347"></span><span>  </span><span id="local-6989586621681891849"><span class="annot"><span class="annottext">fileFromId :: FileId -&gt; TCMT m File
</span><a href="#local-6989586621681891849"><span class="hs-identifier hs-var hs-var hs-var">fileFromId</span></a></span></span><span> </span><span id="local-6989586621681891851"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891851"><span class="hs-identifier hs-var">fi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState FileDictWithBuiltins -&gt; TCMT m FileDictWithBuiltins
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(FileDictWithBuiltins -&gt; f FileDictWithBuiltins)
-&gt; TCState -&gt; f TCState
Lens' TCState FileDictWithBuiltins
</span><a href="Agda.TypeChecking.Monad.Base.html#stFileDict"><span class="hs-identifier hs-var">stFileDict</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT m FileDictWithBuiltins
-&gt; (FileDictWithBuiltins -&gt; File) -&gt; TCMT m File
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileDictWithBuiltins -&gt; FileId -&gt; File
forall a. GetIdFile a =&gt; a -&gt; FileId -&gt; File
</span><a href="Agda.Utils.FileId.html#getIdFile"><span class="hs-operator hs-var">`getIdFile`</span></a></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891851"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621681891857"><span class="annot"><span class="annottext">idFromFile :: File -&gt; TCMT m FileId
</span><a href="#local-6989586621681891857"><span class="hs-identifier hs-var hs-var hs-var">idFromFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState FileDictWithBuiltins
-&gt; (FileDictWithBuiltins -&gt; (FileId, FileDictWithBuiltins))
-&gt; TCMT m FileId
forall (m :: * -&gt; *) a r.
(MonadTCState m, ReadTCState m) =&gt;
Lens' TCState a -&gt; (a -&gt; (r, a)) -&gt; m r
</span><a href="Agda.TypeChecking.Monad.Base.html#stateTCLens"><span class="hs-identifier hs-var">stateTCLens</span></a></span><span> </span><span class="annot"><span class="annottext">(FileDictWithBuiltins -&gt; f FileDictWithBuiltins)
-&gt; TCState -&gt; f TCState
Lens' TCState FileDictWithBuiltins
</span><a href="Agda.TypeChecking.Monad.Base.html#stFileDict"><span class="hs-identifier hs-var">stFileDict</span></a></span><span> </span><span class="annot"><span class="annottext">((FileDictWithBuiltins -&gt; (FileId, FileDictWithBuiltins))
 -&gt; TCMT m FileId)
-&gt; (File -&gt; FileDictWithBuiltins -&gt; (FileId, FileDictWithBuiltins))
-&gt; File
-&gt; TCMT m FileId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">File -&gt; FileDictWithBuiltins -&gt; (FileId, FileDictWithBuiltins)
</span><a href="Agda.TypeChecking.Monad.State.html#registerFileIdWithBuiltin"><span class="hs-identifier hs-var">registerFileIdWithBuiltin</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#MonadFileId"><span class="hs-identifier hs-type">MonadFileId</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-351"></span><span>  </span><span id="local-6989586621681891872"><span class="annot"><span class="annottext">fileFromId :: FileId -&gt; ReduceM File
</span><a href="Agda.Utils.FileId.html#fileFromId"><span class="hs-identifier hs-var hs-var hs-var">fileFromId</span></a></span></span><span> </span><span id="local-6989586621681891873"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891873"><span class="hs-identifier hs-var">fi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState FileDictWithBuiltins -&gt; ReduceM FileDictWithBuiltins
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(FileDictWithBuiltins -&gt; f FileDictWithBuiltins)
-&gt; TCState -&gt; f TCState
Lens' TCState FileDictWithBuiltins
</span><a href="Agda.TypeChecking.Monad.Base.html#stFileDict"><span class="hs-identifier hs-var">stFileDict</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceM FileDictWithBuiltins
-&gt; (FileDictWithBuiltins -&gt; File) -&gt; ReduceM File
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileDictWithBuiltins -&gt; FileId -&gt; File
forall a. GetIdFile a =&gt; a -&gt; FileId -&gt; File
</span><a href="Agda.Utils.FileId.html#getIdFile"><span class="hs-operator hs-var">`getIdFile`</span></a></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891873"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621681891878"><span class="annot"><span class="annottext">idFromFile :: File -&gt; ReduceM FileId
</span><a href="Agda.Utils.FileId.html#idFromFile"><span class="hs-identifier hs-var hs-var hs-var">idFromFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">File -&gt; ReduceM FileId
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-comment">-- we cannot write to the state here, so we cannot do sth like</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-comment">-- stateTCLens stFileDict . registerFileIdWithBuiltin</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><span class="hs-comment">-- | Does the given 'FileId' belong to one of Agda's builtin modules?</span></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span id="local-6989586621681891067"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-type">isBuiltinModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891067"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#FileId"><span class="hs-identifier hs-type">FileId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891067"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#IsBuiltinModule"><span class="hs-identifier hs-type">IsBuiltinModule</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-359"></span><span id="isBuiltinModule"><span class="annot"><span class="annottext">isBuiltinModule :: forall (m :: * -&gt; *).
ReadTCState m =&gt;
FileId -&gt; m (Maybe IsBuiltinModule)
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-var hs-var">isBuiltinModule</span></a></span></span><span> </span><span id="local-6989586621681891887"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891887"><span class="hs-identifier hs-var">fi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileId -&gt; BuiltinModuleIds -&gt; Maybe IsBuiltinModule
forall k a. Enum k =&gt; k -&gt; EnumMap k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">EnumMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891887"><span class="hs-identifier hs-var">fi</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinModuleIds -&gt; Maybe IsBuiltinModule)
-&gt; m BuiltinModuleIds -&gt; m (Maybe IsBuiltinModule)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState BuiltinModuleIds -&gt; m BuiltinModuleIds
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinModuleIds -&gt; f BuiltinModuleIds) -&gt; TCState -&gt; f TCState
Lens' TCState BuiltinModuleIds
</span><a href="Agda.TypeChecking.Monad.Base.html#stBuiltinModuleIds"><span class="hs-identifier hs-var">stBuiltinModuleIds</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="hs-comment">-- | Does the given 'FileId' belong to one of Agda's builtin modules that only uses safe postulates?</span><span>
</span><span id="line-362"></span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- Implies @isJust . 'isBuiltinModule'@.</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span id="local-6989586621681891072"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModuleWithSafePostulates"><span class="hs-identifier hs-type">isBuiltinModuleWithSafePostulates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891072"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#FileId"><span class="hs-identifier hs-type">FileId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891072"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-366"></span><span id="isBuiltinModuleWithSafePostulates"><span class="annot"><span class="annottext">isBuiltinModuleWithSafePostulates :: forall (m :: * -&gt; *). ReadTCState m =&gt; FileId -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModuleWithSafePostulates"><span class="hs-identifier hs-var hs-var">isBuiltinModuleWithSafePostulates</span></a></span></span><span> </span><span id="local-6989586621681891899"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891899"><span class="hs-identifier hs-var">fi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><span class="annottext">FileId -&gt; m (Maybe IsBuiltinModule)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
FileId -&gt; m (Maybe IsBuiltinModule)
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-var">isBuiltinModule</span></a></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891899"><span class="hs-identifier hs-var">fi</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe IsBuiltinModule)
-&gt; (Maybe IsBuiltinModule -&gt; Bool) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">Maybe IsBuiltinModule
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#IsBuiltinModule"><span class="hs-identifier hs-var">IsBuiltinModule</span></a></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#IsBuiltinModuleWithSafePostulates"><span class="hs-identifier hs-var">IsBuiltinModuleWithSafePostulates</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#IsPrimitiveModule"><span class="hs-identifier hs-var">IsPrimitiveModule</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">-- | Does the given 'FileId' belong to one of Agda's magical primitive modules?</span><span>
</span><span id="line-374"></span><span class="hs-comment">--</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- Implies 'isBuiltinModuleWithSafePostulates'.</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span id="local-6989586621681891903"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#isPrimitiveModule"><span class="hs-identifier hs-type">isPrimitiveModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#FileId"><span class="hs-identifier hs-type">FileId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-378"></span><span id="isPrimitiveModule"><span class="annot"><span class="annottext">isPrimitiveModule :: forall (m :: * -&gt; *). ReadTCState m =&gt; FileId -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.State.html#isPrimitiveModule"><span class="hs-identifier hs-var hs-var">isPrimitiveModule</span></a></span></span><span>  </span><span id="local-6989586621681891911"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891911"><span class="hs-identifier hs-var">fi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><span class="annottext">FileId -&gt; m (Maybe IsBuiltinModule)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
FileId -&gt; m (Maybe IsBuiltinModule)
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-var">isBuiltinModule</span></a></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621681891911"><span class="hs-identifier hs-var">fi</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe IsBuiltinModule)
-&gt; (Maybe IsBuiltinModule -&gt; Bool) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="annottext">Maybe IsBuiltinModule
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#IsBuiltinModule"><span class="hs-identifier hs-var">IsBuiltinModule</span></a></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#IsBuiltinModuleWithSafePostulates"><span class="hs-identifier hs-var">IsBuiltinModuleWithSafePostulates</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">IsBuiltinModule
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#IsPrimitiveModule"><span class="hs-identifier hs-var">IsPrimitiveModule</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-386"></span><span class="annot"><span class="hs-comment">-- * Top level module</span></span><span>
</span><span id="line-387"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- | Tries to convert a raw top-level module name to a top-level</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- module name.</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#topLevelModuleName"><span class="hs-identifier hs-type">topLevelModuleName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#RawTopLevelModuleName"><span class="hs-identifier hs-type">RawTopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-393"></span><span id="topLevelModuleName"><span class="annot"><span class="annottext">topLevelModuleName :: RawTopLevelModuleName -&gt; TCM TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.State.html#topLevelModuleName"><span class="hs-identifier hs-var hs-var">topLevelModuleName</span></a></span></span><span> </span><span id="local-6989586621681891913"><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>  </span><span id="local-6989586621681891914"><span class="annot"><a href="#local-6989586621681891914"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
-&gt; BiMap RawTopLevelModuleName ModuleNameHash
-&gt; Maybe ModuleNameHash
forall k v. Ord k =&gt; k -&gt; BiMap k v -&gt; Maybe v
</span><a href="Agda.Utils.BiMap.html#lookup"><span class="hs-identifier hs-var">BiMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span> </span><span class="annot"><span class="annottext">(BiMap RawTopLevelModuleName ModuleNameHash
 -&gt; Maybe ModuleNameHash)
-&gt; TCMT IO (BiMap RawTopLevelModuleName ModuleNameHash)
-&gt; TCMT IO (Maybe ModuleNameHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (BiMap RawTopLevelModuleName ModuleNameHash)
-&gt; TCMT IO (BiMap RawTopLevelModuleName ModuleNameHash)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(BiMap RawTopLevelModuleName ModuleNameHash
 -&gt; f (BiMap RawTopLevelModuleName ModuleNameHash))
-&gt; TCState -&gt; f TCState
Lens' TCState (BiMap RawTopLevelModuleName ModuleNameHash)
</span><a href="Agda.TypeChecking.Monad.Base.html#stTopLevelModuleNames"><span class="hs-identifier hs-var">stTopLevelModuleNames</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621681891914"><span class="hs-identifier hs-type">hash</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681891919"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891919"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM TopLevelModuleName
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; ModuleNameHash -&gt; TopLevelModuleName
</span><a href="Agda.Syntax.TopLevelModuleName.html#unsafeTopLevelModuleName"><span class="hs-identifier hs-var">unsafeTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891919"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><span class="annottext">Maybe ModuleNameHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681891921"><span class="annot"><span class="annottext">hash :: ModuleNameHash
</span><a href="#local-6989586621681891921"><span class="hs-identifier hs-var hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.html#hashRawTopLevelModuleName"><span class="hs-identifier hs-var">hashRawTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891921"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#noModuleNameHash"><span class="hs-identifier hs-var">noModuleNameHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; Maybe RawTopLevelModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleNameHashCollision"><span class="hs-identifier hs-var">ModuleNameHashCollision</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawTopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-400"></span><span>      </span><span id="local-6989586621681891926"><span class="annot"><a href="#local-6989586621681891926"><span class="hs-identifier hs-var">raw'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tag ModuleNameHash
-&gt; BiMap RawTopLevelModuleName ModuleNameHash
-&gt; Maybe RawTopLevelModuleName
forall v k. Ord (Tag v) =&gt; Tag v -&gt; BiMap k v -&gt; Maybe k
</span><a href="Agda.Utils.BiMap.html#invLookup"><span class="hs-identifier hs-var">BiMap.invLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Tag ModuleNameHash
ModuleNameHash
</span><a href="#local-6989586621681891921"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">(BiMap RawTopLevelModuleName ModuleNameHash
 -&gt; Maybe RawTopLevelModuleName)
-&gt; TCMT IO (BiMap RawTopLevelModuleName ModuleNameHash)
-&gt; TCMT IO (Maybe RawTopLevelModuleName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (BiMap RawTopLevelModuleName ModuleNameHash)
-&gt; TCMT IO (BiMap RawTopLevelModuleName ModuleNameHash)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(BiMap RawTopLevelModuleName ModuleNameHash
 -&gt; f (BiMap RawTopLevelModuleName ModuleNameHash))
-&gt; TCState -&gt; f TCState
Lens' TCState (BiMap RawTopLevelModuleName ModuleNameHash)
</span><a href="Agda.TypeChecking.Monad.Base.html#stTopLevelModuleNames"><span class="hs-identifier hs-var">stTopLevelModuleNames</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621681891926"><span class="hs-identifier hs-type">raw'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681891930"><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891930"><span class="hs-identifier hs-var">raw'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM TopLevelModuleName
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM TopLevelModuleName)
-&gt; TypeError -&gt; TCM TopLevelModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; Maybe RawTopLevelModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleNameHashCollision"><span class="hs-identifier hs-var">ModuleNameHashCollision</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; Maybe RawTopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891930"><span class="hs-identifier hs-var">raw'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>        </span><span class="annot"><span class="annottext">Maybe RawTopLevelModuleName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>          </span><span class="annot"><span class="annottext">(BiMap RawTopLevelModuleName ModuleNameHash
 -&gt; f (BiMap RawTopLevelModuleName ModuleNameHash))
-&gt; TCState -&gt; f TCState
Lens' TCState (BiMap RawTopLevelModuleName ModuleNameHash)
</span><a href="Agda.TypeChecking.Monad.Base.html#stTopLevelModuleNames"><span class="hs-identifier hs-var">stTopLevelModuleNames</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (BiMap RawTopLevelModuleName ModuleNameHash)
-&gt; (BiMap RawTopLevelModuleName ModuleNameHash
    -&gt; BiMap RawTopLevelModuleName ModuleNameHash)
-&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens%27"><span class="hs-operator hs-var">`modifyTCLens'`</span></a></span><span>
</span><span id="line-405"></span><span>            </span><span class="annot"><span class="annottext">RawTopLevelModuleName
-&gt; ModuleNameHash
-&gt; BiMap RawTopLevelModuleName ModuleNameHash
-&gt; BiMap RawTopLevelModuleName ModuleNameHash
forall k v.
(Ord k, HasTag v, Ord (Tag v)) =&gt;
k -&gt; v -&gt; BiMap k v -&gt; BiMap k v
</span><a href="Agda.Utils.BiMap.html#insert"><span class="hs-identifier hs-var">BiMap.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillRangeT RawTopLevelModuleName
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891921"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-406"></span><span>          </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM TopLevelModuleName
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; ModuleNameHash -&gt; TopLevelModuleName
</span><a href="Agda.Syntax.TopLevelModuleName.html#unsafeTopLevelModuleName"><span class="hs-identifier hs-var">unsafeTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621681891913"><span class="hs-identifier hs-var">raw</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891921"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- | Set the top-level module. This affects the global module id of freshly</span><span>
</span><span id="line-409"></span><span class="hs-comment">--   generated names.</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setTopLevelModule"><span class="hs-identifier hs-type">setTopLevelModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span id="setTopLevelModule"><span class="annot"><span class="annottext">setTopLevelModule :: TopLevelModuleName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setTopLevelModule"><span class="hs-identifier hs-var hs-var">setTopLevelModule</span></a></span></span><span> </span><span id="local-6989586621681891937"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681891937"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681891938"><span class="annot"><span class="annottext">hash :: ModuleNameHash
</span><a href="#local-6989586621681891938"><span class="hs-identifier hs-var hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; ModuleNameHash
forall range. TopLevelModuleName' range -&gt; ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameId"><span class="hs-identifier hs-var">moduleNameId</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681891937"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="annottext">(NameId -&gt; f NameId) -&gt; TCState -&gt; f TCState
Lens' TCState NameId
</span><a href="Agda.TypeChecking.Monad.Base.html#stFreshNameId"><span class="hs-identifier hs-var">stFreshNameId</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState NameId -&gt; NameId -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens%27"><span class="hs-operator hs-var">`setTCLens'`</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; ModuleNameHash -&gt; NameId
</span><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-var">NameId</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891938"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><span class="annottext">(OpaqueId -&gt; f OpaqueId) -&gt; TCState -&gt; f TCState
Lens' TCState OpaqueId
</span><a href="Agda.TypeChecking.Monad.Base.html#stFreshOpaqueId"><span class="hs-identifier hs-var">stFreshOpaqueId</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState OpaqueId -&gt; OpaqueId -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens%27"><span class="hs-operator hs-var">`setTCLens'`</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; ModuleNameHash -&gt; OpaqueId
</span><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-var">OpaqueId</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891938"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="annottext">(MetaId -&gt; f MetaId) -&gt; TCState -&gt; f TCState
Lens' TCState MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#stFreshMetaId"><span class="hs-identifier hs-var">stFreshMetaId</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState MetaId -&gt; MetaId -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens%27"><span class="hs-operator hs-var">`setTCLens'`</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">metaId :: Word64
</span><a href="Agda.Syntax.Common.html#metaId"><span class="hs-identifier hs-var">metaId</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-418"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metaModule :: ModuleNameHash
</span><a href="Agda.Syntax.Common.html#metaModule"><span class="hs-identifier hs-var">metaModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621681891938"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-419"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="annot"><span class="hs-comment">-- | The name of the current top-level module, if any.</span></span><span>
</span><span id="line-422"></span><span class="hs-pragma">{-# SPECIALIZE</span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#currentTopLevelModule"><span class="hs-pragma hs-type">currentTopLevelModule</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-pragma hs-type">TopLevelModuleName</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-424"></span><span class="hs-pragma">{-# SPECIALIZE</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#currentTopLevelModule"><span class="hs-pragma hs-type">currentTopLevelModule</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-pragma hs-type">ReduceM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-pragma hs-type">TopLevelModuleName</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-426"></span><span id="local-6989586621681891100"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#currentTopLevelModule"><span class="hs-identifier hs-type">currentTopLevelModule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCEnv"><span class="hs-identifier hs-type">MonadTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891100"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891100"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891100"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-428"></span><span id="currentTopLevelModule"><span class="annot"><span class="annottext">currentTopLevelModule :: forall (m :: * -&gt; *).
(MonadTCEnv m, ReadTCState m) =&gt;
m (Maybe TopLevelModuleName)
</span><a href="Agda.TypeChecking.Monad.State.html#currentTopLevelModule"><span class="hs-identifier hs-var hs-var">currentTopLevelModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><span class="annottext">Lens' TCState (Maybe (ModuleName, TopLevelModuleName))
-&gt; m (Maybe (ModuleName, TopLevelModuleName))
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ModuleName, TopLevelModuleName)
 -&gt; f (Maybe (ModuleName, TopLevelModuleName)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Maybe (ModuleName, TopLevelModuleName))
</span><a href="Agda.TypeChecking.Monad.Base.html#stCurrentModule"><span class="hs-identifier hs-var">stCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe (ModuleName, TopLevelModuleName))
-&gt; (Maybe (ModuleName, TopLevelModuleName)
    -&gt; m (Maybe TopLevelModuleName))
-&gt; m (Maybe TopLevelModuleName)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681891970"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681891970"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName -&gt; m (Maybe TopLevelModuleName)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681891970"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ModuleName, TopLevelModuleName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TopLevelModuleName] -&gt; Maybe TopLevelModuleName
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; Maybe TopLevelModuleName)
-&gt; m [TopLevelModuleName] -&gt; m (Maybe TopLevelModuleName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; [TopLevelModuleName]) -&gt; m [TopLevelModuleName]
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#envImportStack"><span class="hs-identifier hs-var">envImportStack</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">-- | Use a different top-level module for a computation. Used when generating</span><span>
</span><span id="line-434"></span><span class="hs-comment">--   names for imported modules.</span><span>
</span><span id="line-435"></span><span id="local-6989586621681891110"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#withTopLevelModule"><span class="hs-identifier hs-type">withTopLevelModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891110"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891110"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-436"></span><span id="withTopLevelModule"><span class="annot"><span class="annottext">withTopLevelModule :: forall a. TopLevelModuleName -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#withTopLevelModule"><span class="hs-identifier hs-var hs-var">withTopLevelModule</span></a></span></span><span> </span><span id="local-6989586621681891990"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681891990"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681891991"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621681891991"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>  </span><span id="local-6989586621681891992"><span class="annot"><a href="#local-6989586621681891992"><span class="hs-identifier hs-var">nextN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState NameId -&gt; TCMT IO NameId
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(NameId -&gt; f NameId) -&gt; TCState -&gt; f TCState
Lens' TCState NameId
</span><a href="Agda.TypeChecking.Monad.Base.html#stFreshNameId"><span class="hs-identifier hs-var">stFreshNameId</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621681891995"><span class="annot"><a href="#local-6989586621681891995"><span class="hs-identifier hs-var">nextM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stFreshMetaId"><span class="hs-identifier hs-type">stFreshMetaId</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span id="local-6989586621681891998"><span class="annot"><a href="#local-6989586621681891998"><span class="hs-identifier hs-var">nextO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stFreshOpaqueId"><span class="hs-identifier hs-type">stFreshOpaqueId</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setTopLevelModule"><span class="hs-identifier hs-type">setTopLevelModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891990"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span id="local-6989586621681892001"><span class="annot"><a href="#local-6989586621681892001"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621681891991"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stFreshMetaId"><span class="hs-identifier hs-type">stFreshMetaId</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891995"><span class="hs-identifier hs-type">nextM</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stFreshNameId"><span class="hs-identifier hs-type">stFreshNameId</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891992"><span class="hs-identifier hs-type">nextN</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stFreshOpaqueId"><span class="hs-identifier hs-type">stFreshOpaqueId</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891998"><span class="hs-identifier hs-type">nextO</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681892001"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#currentModuleNameHash"><span class="hs-pragma hs-type">currentModuleNameHash</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.Boot.html#ModuleNameHash"><span class="hs-pragma hs-type">ModuleNameHash</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-448"></span><span id="local-6989586621681891118"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#currentModuleNameHash"><span class="hs-identifier hs-type">currentModuleNameHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891118"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891118"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.Boot.html#ModuleNameHash"><span class="hs-identifier hs-type">ModuleNameHash</span></a></span></span><span>
</span><span id="line-449"></span><span id="currentModuleNameHash"><span class="annot"><span class="annottext">currentModuleNameHash :: forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleNameHash
</span><a href="Agda.TypeChecking.Monad.State.html#currentModuleNameHash"><span class="hs-identifier hs-var hs-var">currentModuleNameHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-type">NameId</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681892014"><span class="annot"><a href="#local-6989586621681892014"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState NameId -&gt; m NameId
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(NameId -&gt; f NameId) -&gt; TCState -&gt; f TCState
Lens' TCState NameId
</span><a href="Agda.TypeChecking.Monad.Base.html#stFreshNameId"><span class="hs-identifier hs-var">stFreshNameId</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681892014"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="hs-comment">-- | Get a function that completes 'TopLevelModuleName's</span><span>
</span><span id="line-454"></span><span class="hs-comment">--   with their 'SourceFile' to 'TopLevelModuleNameWithSourceFile's.</span><span>
</span><span id="line-455"></span><span id="local-6989586621681891121"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#topLevelModuleNameWithSourceFileCompleter"><span class="hs-identifier hs-type">topLevelModuleNameWithSourceFileCompleter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891121"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891121"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#TopLevelModuleNameWithSourceFile"><span class="hs-identifier hs-type">TopLevelModuleNameWithSourceFile</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-457"></span><span id="topLevelModuleNameWithSourceFileCompleter"><span class="annot"><span class="annottext">topLevelModuleNameWithSourceFileCompleter :: forall (m :: * -&gt; *).
ReadTCState m =&gt;
m (TopLevelModuleName -&gt; TopLevelModuleNameWithSourceFile)
</span><a href="Agda.TypeChecking.Monad.State.html#topLevelModuleNameWithSourceFileCompleter"><span class="hs-identifier hs-var hs-var">topLevelModuleNameWithSourceFileCompleter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-458"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#ModuleToSource"><span class="hs-identifier hs-type">ModuleToSource</span></a></span><span> </span><span id="local-6989586621681892031"><span class="annot"><a href="#local-6989586621681892031"><span class="hs-identifier hs-var">_dict</span></a></span></span><span> </span><span id="local-6989586621681892032"><span class="annot"><a href="#local-6989586621681892032"><span class="hs-identifier hs-var">m2s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState ModuleToSource -&gt; m ModuleToSource
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleToSource -&gt; f ModuleToSource) -&gt; TCState -&gt; f TCState
Lens' TCState ModuleToSource
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681892036"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681892036"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; TopLevelModuleNameWithSourceFile
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#TopLevelModuleNameWithSourceFile"><span class="hs-identifier hs-var">TopLevelModuleNameWithSourceFile</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681892036"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceFile -&gt; TopLevelModuleNameWithSourceFile)
-&gt; SourceFile -&gt; TopLevelModuleNameWithSourceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TopLevelModuleName -&gt; ModuleToSourceId -&gt; SourceFile
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">SourceFile
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621681892036"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleToSourceId
</span><a href="#local-6989586621681892032"><span class="hs-identifier hs-var">m2s</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-462"></span><span class="annot"><span class="hs-comment">-- * Backends and foreign code</span></span><span>
</span><span id="line-463"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="annot"><span class="hs-comment">-- | Look for a backend of the given name.</span></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span id="local-6989586621681891131"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lookupBackend"><span class="hs-identifier hs-type">lookupBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891131"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#BackendName"><span class="hs-identifier hs-type">BackendName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891131"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-468"></span><span id="lookupBackend"><span class="annot"><span class="annottext">lookupBackend :: forall (m :: * -&gt; *).
ReadTCState m =&gt;
BackendName -&gt; m (Maybe Backend)
</span><a href="Agda.TypeChecking.Monad.State.html#lookupBackend"><span class="hs-identifier hs-var hs-var">lookupBackend</span></a></span></span><span> </span><span id="local-6989586621681892045"><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621681892045"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState [Backend] -&gt; m [Backend]
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">([Backend] -&gt; f [Backend]) -&gt; TCState -&gt; f TCState
Lens' TCState [Backend]
</span><a href="Agda.TypeChecking.Monad.Base.html#stBackends"><span class="hs-identifier hs-var">stBackends</span></a></span><span> </span><span class="annot"><span class="annottext">m [Backend] -&gt; ([Backend] -&gt; Maybe Backend) -&gt; m (Maybe Backend)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681892049"><span class="annot"><span class="annottext">[Backend]
</span><a href="#local-6989586621681892049"><span class="hs-identifier hs-var">backends</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="annottext">[Backend] -&gt; Maybe Backend
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Backend
</span><a href="#local-6989586621681892050"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681892050"><span class="annot"><span class="annottext">b :: Backend
</span><a href="#local-6989586621681892050"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span id="local-6989586621681892054"><span class="annot"><span class="annottext">Backend'_boot Definition (TCMT IO) opts env menv mod def
</span><a href="#local-6989586621681892054"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Backend]
</span><a href="#local-6989586621681892049"><span class="hs-identifier hs-var">backends</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Backend'_boot Definition (TCMT IO) opts env menv mod def
-&gt; BackendName
forall definition (tcm :: * -&gt; *) opts env menv mod def.
Backend'_boot definition tcm opts env menv mod def -&gt; BackendName
</span><a href="Agda.Compiler.Backend.Base.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span> </span><span class="annot"><span class="annottext">Backend'_boot Definition (TCMT IO) opts env menv mod def
</span><a href="#local-6989586621681892054"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">BackendName -&gt; BackendName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621681892045"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="annot"><span class="hs-comment">-- | Get the currently active backend (if any).</span></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#activeBackend"><span class="hs-identifier hs-type">activeBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span id="activeBackend"><span class="annot"><span class="annottext">activeBackend :: TCM (Maybe Backend)
</span><a href="Agda.TypeChecking.Monad.State.html#activeBackend"><span class="hs-identifier hs-var hs-var">activeBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Backend -&gt; TCM (Maybe Backend)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) Backend -&gt; TCM (Maybe Backend))
-&gt; MaybeT (TCMT IO) Backend -&gt; TCM (Maybe Backend)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>  </span><span id="local-6989586621681892056"><span class="annot"><a href="#local-6989586621681892056"><span class="hs-identifier hs-var">bname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe BackendName) -&gt; MaybeT (TCMT IO) BackendName
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe BackendName) -&gt; MaybeT (TCMT IO) BackendName)
-&gt; TCMT IO (Maybe BackendName) -&gt; MaybeT (TCMT IO) BackendName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Maybe BackendName) -&gt; TCMT IO (Maybe BackendName)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Maybe BackendName
</span><a href="Agda.TypeChecking.Monad.Base.html#envActiveBackendName"><span class="hs-identifier hs-var">envActiveBackendName</span></a></span><span>
</span><span id="line-476"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lookupBackend"><span class="hs-identifier hs-type">lookupBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892056"><span class="hs-identifier hs-type">bname</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- | Ask the active backend whether a type may be erased.</span><span>
</span><span id="line-479"></span><span class="hs-comment">--   See issue #3732.</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#activeBackendMayEraseType"><span class="hs-identifier hs-type">activeBackendMayEraseType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-482"></span><span id="activeBackendMayEraseType"><span class="annot"><span class="annottext">activeBackendMayEraseType :: QName -&gt; TCM Bool
</span><a href="Agda.TypeChecking.Monad.State.html#activeBackendMayEraseType"><span class="hs-identifier hs-var hs-var">activeBackendMayEraseType</span></a></span></span><span> </span><span id="local-6989586621681892061"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892061"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span id="local-6989586621681892063"><span class="annot"><a href="#local-6989586621681892063"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Maybe Backend -&gt; Backend
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Backend
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Backend -&gt; Backend)
-&gt; TCM (Maybe Backend) -&gt; TCMT IO Backend
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Backend)
</span><a href="Agda.TypeChecking.Monad.State.html#activeBackend"><span class="hs-identifier hs-var">activeBackend</span></a></span><span>
</span><span id="line-484"></span><span>  </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#mayEraseType"><span class="hs-identifier hs-var">mayEraseType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892063"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892061"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#addForeignCode"><span class="hs-identifier hs-type">addForeignCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#BackendName"><span class="hs-identifier hs-type">BackendName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span id="addForeignCode"><span class="annot"><span class="annottext">addForeignCode :: BackendName -&gt; [Char] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#addForeignCode"><span class="hs-identifier hs-var hs-var">addForeignCode</span></a></span></span><span> </span><span id="local-6989586621681892065"><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621681892065"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621681892066"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681892066"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>  </span><span id="local-6989586621681892067"><span class="annot"><a href="#local-6989586621681892067"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Range) -&gt; TCMT IO Range
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Range
</span><a href="Agda.TypeChecking.Monad.Base.html#envRange"><span class="hs-identifier hs-var">envRange</span></a></span><span>  </span><span class="hs-comment">-- can't use TypeChecking.Monad.Trace.getCurrentRange without cycle</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-identifier hs-type">modifyTCLens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stForeignCode"><span class="hs-identifier hs-type">stForeignCode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#key"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892065"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ForeignCodeStack"><span class="hs-identifier hs-type">ForeignCodeStack</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ForeignCode</span></span><span> </span><span class="annot"><span class="hs-identifier">r</span></span><span> </span><span class="annot"><span class="hs-identifier">code</span></span><span> </span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getForeignCodeStack"><span class="hs-identifier hs-var">getForeignCodeStack</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-493"></span><span class="annot"><span class="hs-comment">-- * Interaction output callback</span></span><span>
</span><span id="line-494"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getInteractionOutputCallback"><span class="hs-pragma hs-type">getInteractionOutputCallback</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-497"></span><span id="local-6989586621681891176"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getInteractionOutputCallback"><span class="hs-identifier hs-type">getInteractionOutputCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891176"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891176"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InteractionOutputCallback"><span class="hs-identifier hs-type">InteractionOutputCallback</span></a></span></span><span>
</span><span id="line-498"></span><span id="getInteractionOutputCallback"><span class="annot"><span class="annottext">getInteractionOutputCallback :: forall (m :: * -&gt; *). ReadTCState m =&gt; m InteractionOutputCallback
</span><a href="Agda.TypeChecking.Monad.State.html#getInteractionOutputCallback"><span class="hs-identifier hs-var hs-var">getInteractionOutputCallback</span></a></span></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState InteractionOutputCallback
-&gt; m InteractionOutputCallback
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(InteractionOutputCallback -&gt; f InteractionOutputCallback)
-&gt; TCState -&gt; f TCState
Lens' TCState InteractionOutputCallback
</span><a href="Agda.TypeChecking.Monad.Base.html#stInteractionOutputCallback"><span class="hs-identifier hs-var">stInteractionOutputCallback</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#appInteractionOutputCallback"><span class="hs-identifier hs-type">appInteractionOutputCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span id="appInteractionOutputCallback"><span class="annot"><span class="annottext">appInteractionOutputCallback :: InteractionOutputCallback
</span><a href="Agda.TypeChecking.Monad.State.html#appInteractionOutputCallback"><span class="hs-identifier hs-var hs-var">appInteractionOutputCallback</span></a></span></span><span> </span><span id="local-6989586621681892086"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621681892086"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO InteractionOutputCallback
forall (m :: * -&gt; *). ReadTCState m =&gt; m InteractionOutputCallback
</span><a href="Agda.TypeChecking.Monad.State.html#getInteractionOutputCallback"><span class="hs-identifier hs-var">getInteractionOutputCallback</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO InteractionOutputCallback
-&gt; (InteractionOutputCallback -&gt; TCM ()) -&gt; TCM ()
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681892087"><span class="annot"><span class="annottext">InteractionOutputCallback
</span><a href="#local-6989586621681892087"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractionOutputCallback
</span><a href="#local-6989586621681892087"><span class="hs-identifier hs-var">cb</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621681892086"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setInteractionOutputCallback"><span class="hs-identifier hs-type">setInteractionOutputCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InteractionOutputCallback"><span class="hs-identifier hs-type">InteractionOutputCallback</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span id="setInteractionOutputCallback"><span class="annot"><span class="annottext">setInteractionOutputCallback :: InteractionOutputCallback -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setInteractionOutputCallback"><span class="hs-identifier hs-var hs-var">setInteractionOutputCallback</span></a></span></span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState InteractionOutputCallback
-&gt; InteractionOutputCallback -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens%27"><span class="hs-identifier hs-var">setTCLens'</span></a></span><span> </span><span class="annot"><span class="annottext">(InteractionOutputCallback -&gt; f InteractionOutputCallback)
-&gt; TCState -&gt; f TCState
Lens' TCState InteractionOutputCallback
</span><a href="Agda.TypeChecking.Monad.Base.html#stInteractionOutputCallback"><span class="hs-identifier hs-var">stInteractionOutputCallback</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-510"></span><span class="annot"><span class="hs-comment">-- * Pattern synonyms</span></span><span>
</span><span id="line-511"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span id="local-6989586621681891182"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-type">getPatternSyns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681891182"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681891182"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">PatternSynDefns</span></a></span></span><span>
</span><span id="line-514"></span><span id="getPatternSyns"><span class="annot"><span class="annottext">getPatternSyns :: forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-var hs-var">getPatternSyns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PatternSynDefns -&gt; m PatternSynDefns
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; f PatternSynDefns) -&gt; TCState -&gt; f TCState
Lens' TCState PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#stPatternSyns"><span class="hs-identifier hs-var">stPatternSyns</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setPatternSyns"><span class="hs-identifier hs-type">setPatternSyns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">PatternSynDefns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span id="setPatternSyns"><span class="annot"><span class="annottext">setPatternSyns :: PatternSynDefns -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setPatternSyns"><span class="hs-identifier hs-var hs-var">setPatternSyns</span></a></span></span><span> </span><span id="local-6989586621681892098"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681892098"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; PatternSynDefns) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyPatternSyns"><span class="hs-identifier hs-var">modifyPatternSyns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns -&gt; PatternSynDefns
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681892098"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><span class="hs-comment">-- | Lens for 'stPatternSyns'.</span></span><span>
</span><span id="line-520"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyPatternSyns"><span class="hs-identifier hs-type">modifyPatternSyns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">PatternSynDefns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">PatternSynDefns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span id="modifyPatternSyns"><span class="annot"><span class="annottext">modifyPatternSyns :: (PatternSynDefns -&gt; PatternSynDefns) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyPatternSyns"><span class="hs-identifier hs-var hs-var">modifyPatternSyns</span></a></span></span><span> </span><span id="local-6989586621681892100"><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns
</span><a href="#local-6989586621681892100"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; f PatternSynDefns) -&gt; TCState -&gt; f TCState
Lens' TCState PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#stPatternSyns"><span class="hs-identifier hs-var">stPatternSyns</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PatternSynDefns
-&gt; (PatternSynDefns -&gt; PatternSynDefns) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns
</span><a href="#local-6989586621681892100"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span id="local-6989586621681892103"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getPatternSynImports"><span class="hs-identifier hs-type">getPatternSynImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892103"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681892103"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">PatternSynDefns</span></a></span></span><span>
</span><span id="line-524"></span><span id="getPatternSynImports"><span class="annot"><span class="annottext">getPatternSynImports :: forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSynImports"><span class="hs-identifier hs-var hs-var">getPatternSynImports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PatternSynDefns -&gt; m PatternSynDefns
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; f PatternSynDefns) -&gt; TCState -&gt; f TCState
Lens' TCState PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#stPatternSynImports"><span class="hs-identifier hs-var">stPatternSynImports</span></a></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="annot"><span class="hs-comment">-- | Get both local and imported pattern synonyms</span></span><span>
</span><span id="line-527"></span><span id="local-6989586621681892110"><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getAllPatternSyns"><span class="hs-identifier hs-type">getAllPatternSyns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892110"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681892110"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">PatternSynDefns</span></a></span></span><span>
</span><span id="line-528"></span><span id="getAllPatternSyns"><span class="annot"><span class="annottext">getAllPatternSyns :: forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getAllPatternSyns"><span class="hs-identifier hs-var hs-var">getAllPatternSyns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns -&gt; PatternSynDefns
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; PatternSynDefns -&gt; PatternSynDefns)
-&gt; m PatternSynDefns -&gt; m (PatternSynDefns -&gt; PatternSynDefns)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-var">getPatternSyns</span></a></span><span> </span><span class="annot"><span class="annottext">m (PatternSynDefns -&gt; PatternSynDefns)
-&gt; m PatternSynDefns -&gt; m PatternSynDefns
forall a b. m (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">m PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSynImports"><span class="hs-identifier hs-var">getPatternSynImports</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lookupPatternSyn"><span class="hs-identifier hs-type">lookupPatternSyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbiguousQName"><span class="hs-identifier hs-type">AmbiguousQName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefn"><span class="hs-identifier hs-type">PatternSynDefn</span></a></span><span>
</span><span id="line-531"></span><span id="lookupPatternSyn"><span class="annot"><span class="annottext">lookupPatternSyn :: AmbiguousQName -&gt; TCM PatternSynDefn
</span><a href="Agda.TypeChecking.Monad.State.html#lookupPatternSyn"><span class="hs-identifier hs-var hs-var">lookupPatternSyn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbQ"><span class="hs-identifier hs-type">AmbQ</span></a></span><span> </span><span id="local-6989586621681892124"><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621681892124"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621681892125"><span class="annot"><a href="#local-6989586621681892125"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCM PatternSynDefn)
-&gt; List1 QName -&gt; TCMT IO (NonEmpty PatternSynDefn)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; NonEmpty a -&gt; f (NonEmpty b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM PatternSynDefn
</span><a href="Agda.TypeChecking.Monad.State.html#lookupSinglePatternSyn"><span class="hs-identifier hs-var">lookupSinglePatternSyn</span></a></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621681892124"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.PatternSynonyms.html#mergePatternSynDefs"><span class="hs-identifier hs-type">mergePatternSynDefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892125"><span class="hs-identifier hs-type">defs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681892129"><span class="annot"><span class="annottext">PatternSynDefn
</span><a href="#local-6989586621681892129"><span class="hs-identifier hs-var">def</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatternSynDefn -&gt; TCM PatternSynDefn
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PatternSynDefn
</span><a href="#local-6989586621681892129"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><span class="annottext">Maybe PatternSynDefn
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM PatternSynDefn
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM PatternSynDefn)
-&gt; TypeError -&gt; TCM PatternSynDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (QName, PatternSynDefn) -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotResolveAmbiguousPatternSynonym"><span class="hs-identifier hs-var">CannotResolveAmbiguousPatternSynonym</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 (QName, PatternSynDefn) -&gt; TypeError)
-&gt; List1 (QName, PatternSynDefn) -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 QName
-&gt; NonEmpty PatternSynDefn -&gt; List1 (QName, PatternSynDefn)
forall a b. NonEmpty a -&gt; NonEmpty b -&gt; NonEmpty (a, b)
</span><span class="hs-identifier hs-var">List1.zip</span></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621681892124"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty PatternSynDefn
</span><a href="#local-6989586621681892125"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lookupSinglePatternSyn"><span class="hs-identifier hs-type">lookupSinglePatternSyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefn"><span class="hs-identifier hs-type">PatternSynDefn</span></a></span><span>
</span><span id="line-538"></span><span id="lookupSinglePatternSyn"><span class="annot"><span class="annottext">lookupSinglePatternSyn :: QName -&gt; TCM PatternSynDefn
</span><a href="Agda.TypeChecking.Monad.State.html#lookupSinglePatternSyn"><span class="hs-identifier hs-var hs-var">lookupSinglePatternSyn</span></a></span></span><span> </span><span id="local-6989586621681892132"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892132"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>    </span><span id="local-6989586621681892133"><span class="annot"><a href="#local-6989586621681892133"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-var">getPatternSyns</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621681892132"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892133"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-541"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681892135"><span class="annot"><span class="annottext">PatternSynDefn
</span><a href="#local-6989586621681892135"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatternSynDefn -&gt; TCM PatternSynDefn
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PatternSynDefn
</span><a href="#local-6989586621681892135"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-542"></span><span>        </span><span class="annot"><span class="annottext">Maybe PatternSynDefn
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>            </span><span id="local-6989586621681892136"><span class="annot"><a href="#local-6989586621681892136"><span class="hs-identifier hs-var">si</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSynImports"><span class="hs-identifier hs-var">getPatternSynImports</span></a></span><span>
</span><span id="line-544"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621681892132"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681892136"><span class="hs-identifier hs-type">si</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-545"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681892137"><span class="annot"><span class="annottext">PatternSynDefn
</span><a href="#local-6989586621681892137"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatternSynDefn -&gt; TCM PatternSynDefn
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PatternSynDefn
</span><a href="#local-6989586621681892137"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-546"></span><span>                </span><span class="annot"><span class="annottext">Maybe PatternSynDefn
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM PatternSynDefn
forall a. QName -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#notInScopeError"><span class="hs-identifier hs-var">notInScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCM PatternSynDefn) -&gt; QName -&gt; TCM PatternSynDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameToConcrete"><span class="hs-identifier hs-var">qnameToConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892132"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-549"></span><span class="annot"><span class="hs-comment">-- * Instance definitions</span></span><span>
</span><span id="line-550"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><span class="hs-comment">-- | Lens for 'stInstanceDefs'.</span></span><span>
</span><span id="line-553"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateInstanceDefs"><span class="hs-identifier hs-type">updateInstanceDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TempInstanceTable"><span class="hs-identifier hs-type">TempInstanceTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TempInstanceTable"><span class="hs-identifier hs-type">TempInstanceTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span id="updateInstanceDefs"><span class="annot"><span class="annottext">updateInstanceDefs :: (TempInstanceTable -&gt; TempInstanceTable) -&gt; TCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.State.html#updateInstanceDefs"><span class="hs-identifier hs-var hs-var">updateInstanceDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCState TempInstanceTable
-&gt; (TempInstanceTable -&gt; TempInstanceTable) -&gt; TCState -&gt; TCState
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">(TempInstanceTable -&gt; f TempInstanceTable) -&gt; TCState -&gt; f TCState
Lens' TCState TempInstanceTable
</span><a href="Agda.TypeChecking.Monad.Base.html#stInstanceDefs"><span class="hs-identifier hs-var">stInstanceDefs</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyInstanceDefs"><span class="hs-identifier hs-type">modifyInstanceDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TempInstanceTable"><span class="hs-identifier hs-type">TempInstanceTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TempInstanceTable"><span class="hs-identifier hs-type">TempInstanceTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span id="modifyInstanceDefs"><span class="annot"><span class="annottext">modifyInstanceDefs :: (TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyInstanceDefs"><span class="hs-identifier hs-var hs-var">modifyInstanceDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(TCState -&gt; TCState) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-var">modifyTC</span></a></span><span> </span><span class="annot"><span class="annottext">((TCState -&gt; TCState) -&gt; TCM ())
-&gt; ((TempInstanceTable -&gt; TempInstanceTable) -&gt; TCState -&gt; TCState)
-&gt; (TempInstanceTable -&gt; TempInstanceTable)
-&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TempInstanceTable -&gt; TempInstanceTable) -&gt; TCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.State.html#updateInstanceDefs"><span class="hs-identifier hs-var">updateInstanceDefs</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getAllInstanceDefs"><span class="hs-identifier hs-type">getAllInstanceDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TempInstanceTable"><span class="hs-identifier hs-type">TempInstanceTable</span></a></span><span>
</span><span id="line-560"></span><span id="getAllInstanceDefs"><span class="annot"><span class="annottext">getAllInstanceDefs :: TCM TempInstanceTable
</span><a href="Agda.TypeChecking.Monad.State.html#getAllInstanceDefs"><span class="hs-identifier hs-var hs-var">getAllInstanceDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681892145"><span class="annot"><a href="#local-6989586621681892145"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681892146"><span class="annot"><a href="#local-6989586621681892146"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState TempInstanceTable -&gt; TCM TempInstanceTable
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(TempInstanceTable -&gt; f TempInstanceTable) -&gt; TCState -&gt; f TCState
Lens' TCState TempInstanceTable
</span><a href="Agda.TypeChecking.Monad.Base.html#stInstanceDefs"><span class="hs-identifier hs-var">stInstanceDefs</span></a></span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621681892149"><span class="annot"><a href="#local-6989586621681892149"><span class="hs-identifier hs-var">itable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-type">stImports</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#sigInstances"><span class="hs-identifier hs-type">sigInstances</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681892154"><span class="annot"><a href="#local-6989586621681892154"><span class="hs-identifier hs-var hs-var">table'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceTable
</span><a href="#local-6989586621681892145"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceTable -&gt; InstanceTable -&gt; InstanceTable
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InstanceTable
</span><a href="#local-6989586621681892149"><span class="hs-identifier hs-var">itable</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">evaluate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">rnf</span></span><span> </span><span class="annot"><a href="#local-6989586621681892154"><span class="hs-identifier hs-type">table'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681892154"><span class="hs-identifier hs-type">table'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681892146"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getAnonInstanceDefs"><span class="hs-identifier hs-type">getAnonInstanceDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span id="getAnonInstanceDefs"><span class="annot"><span class="annottext">getAnonInstanceDefs :: TCM (Set QName)
</span><a href="Agda.TypeChecking.Monad.State.html#getAnonInstanceDefs"><span class="hs-identifier hs-var hs-var">getAnonInstanceDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TempInstanceTable -&gt; Set QName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(TempInstanceTable -&gt; Set QName)
-&gt; TCM TempInstanceTable -&gt; TCM (Set QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM TempInstanceTable
</span><a href="Agda.TypeChecking.Monad.State.html#getAllInstanceDefs"><span class="hs-identifier hs-var">getAllInstanceDefs</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="annot"><span class="hs-comment">-- | Remove an instance from the set of unresolved instances.</span></span><span>
</span><span id="line-571"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#clearUnknownInstance"><span class="hs-identifier hs-type">clearUnknownInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span id="clearUnknownInstance"><span class="annot"><span class="annottext">clearUnknownInstance :: QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#clearUnknownInstance"><span class="hs-identifier hs-var hs-var">clearUnknownInstance</span></a></span></span><span> </span><span id="local-6989586621681892158"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892158"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyInstanceDefs"><span class="hs-identifier hs-var">modifyInstanceDefs</span></a></span><span> </span><span class="annot"><span class="annottext">((TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ())
-&gt; (TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; Set QName) -&gt; TempInstanceTable -&gt; TempInstanceTable
forall b d a. (b -&gt; d) -&gt; (a, b) -&gt; (a, d)
</span><a href="Agda.Utils.Tuple.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Set QName -&gt; Set QName)
 -&gt; TempInstanceTable -&gt; TempInstanceTable)
-&gt; (Set QName -&gt; Set QName)
-&gt; TempInstanceTable
-&gt; TempInstanceTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892158"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><span class="hs-comment">-- | Add an instance whose type is still unresolved.</span></span><span>
</span><span id="line-575"></span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#addUnknownInstance"><span class="hs-identifier hs-type">addUnknownInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span id="addUnknownInstance"><span class="annot"><span class="annottext">addUnknownInstance :: QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#addUnknownInstance"><span class="hs-identifier hs-var hs-var">addUnknownInstance</span></a></span></span><span> </span><span id="local-6989586621681892162"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892162"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.decl.instance&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;adding definition &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892162"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; to the instance table (the type is not yet known)&quot;</span></span><span>
</span><span id="line-580"></span><span>  </span><span class="annot"><span class="annottext">(TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyInstanceDefs"><span class="hs-identifier hs-var">modifyInstanceDefs</span></a></span><span> </span><span class="annot"><span class="annottext">((TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ())
-&gt; (TempInstanceTable -&gt; TempInstanceTable) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; Set QName) -&gt; TempInstanceTable -&gt; TempInstanceTable
forall b d a. (b -&gt; d) -&gt; (a, b) -&gt; (a, d)
</span><a href="Agda.Utils.Tuple.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="annot"><span class="annottext">((Set QName -&gt; Set QName)
 -&gt; TempInstanceTable -&gt; TempInstanceTable)
-&gt; (Set QName -&gt; Set QName)
-&gt; TempInstanceTable
-&gt; TempInstanceTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681892162"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-581"></span></pre></body></html>