<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Strict #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-redundant-bang-patterns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Andreas, Makoto, Francesco 2014-10-15 AIM XX:</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- -O2 does not have any noticable effect on runtime</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- but sabotages cabal repl with -Werror</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- (due to a conflict with --interactive warning)</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- {-# OPTIONS_GHC -O2                      #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="annot"><span class="hs-comment">-- | Structure-sharing serialisation of Agda interface files.</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- -!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- NOTE: Every time the interface format is changed the interface</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- version number should be bumped _in the same patch_.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- See 'currentInterfaceVersion' below.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- -!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-!-</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html"><span class="hs-identifier">Agda.TypeChecking.Serialise</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#InterfacePrefix"><span class="hs-identifier">InterfacePrefix</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#Encoded"><span class="hs-identifier">Encoded</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#encode"><span class="hs-identifier">encode</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#encodeFile"><span class="hs-identifier">encodeFile</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier">decode</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decodeFile"><span class="hs-identifier">decodeFile</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier">decodeInterface</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#deserializeInterface"><span class="hs-identifier">deserializeInterface</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#deserializeHashes"><span class="hs-identifier">deserializeHashes</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">createDirectoryIfMissing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">takeDirectory</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LB</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.Compression.Zstd</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Z</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html"><span class="hs-identifier">Agda.Interaction.Options.ProfileOptions</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Profile</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html"><span class="hs-identifier">Agda.TypeChecking.Serialise.Base</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Instances.html"><span class="hs-identifier">Agda.TypeChecking.Serialise.Instances</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- instances only</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.CompactRegion.html"><span class="hs-identifier">Agda.Utils.CompactRegion</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Compact</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html"><span class="hs-identifier">Agda.Utils.Hash</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.HashTable.html"><span class="hs-identifier">Agda.Utils.HashTable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IORef.html"><span class="hs-identifier">Agda.Utils.IORef</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html"><span class="hs-identifier">Agda.Utils.MinimalArray.Lifted</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AL</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.MutableLifted.html"><span class="hs-identifier">Agda.Utils.MinimalArray.MutableLifted</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ML</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator">(&lt;*!&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Serialize.html"><span class="hs-identifier">Agda.Utils.Serialize</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Tuple.html"><span class="hs-identifier">Agda.Utils.Tuple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html"><span class="hs-identifier">Agda.Utils.VarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier">VarSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span class="hs-cpp">

#include &quot;MachDeps.h&quot;
</span><span>
</span><span id="line-80"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#currentInterfaceVersion"><span class="hs-identifier hs-type">currentInterfaceVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-81"></span><span id="currentInterfaceVersion"><span class="annot"><span class="annottext">currentInterfaceVersion :: Hash
</span><a href="Agda.TypeChecking.Serialise.html#currentInterfaceVersion"><span class="hs-identifier hs-var hs-var">currentInterfaceVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-number">20260227</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Hash
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Hash
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-number">0</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#ifaceVersionSize"><span class="hs-identifier hs-type">ifaceVersionSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-84"></span><span id="ifaceVersionSize"><span class="annot"><span class="annottext">ifaceVersionSize :: Int
</span><a href="Agda.TypeChecking.Serialise.html#ifaceVersionSize"><span class="hs-identifier hs-var hs-var">ifaceVersionSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SIZEOF_WORD64</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#ifacePrefixSize"><span class="hs-identifier hs-type">ifacePrefixSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-87"></span><span id="ifacePrefixSize"><span class="annot"><span class="annottext">ifacePrefixSize :: Int
</span><a href="Agda.TypeChecking.Serialise.html#ifacePrefixSize"><span class="hs-identifier hs-var hs-var">ifacePrefixSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Agda.Utils.Hash.html#hashSize"><span class="hs-identifier hs-var">hashSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Agda.TypeChecking.Serialise.html#ifaceVersionSize"><span class="hs-identifier hs-var">ifaceVersionSize</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">type</span><span> </span><span id="InterfacePrefix"><span class="annot"><a href="Agda.TypeChecking.Serialise.html#InterfacePrefix"><span class="hs-identifier hs-var">InterfacePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span>     </span><span class="hs-comment">-- sourceHash</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span>     </span><span class="hs-comment">-- fullHash</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>   </span><span class="hs-comment">-- interface version</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-comment">-- | Hash-consed encoding of a value.</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">type</span><span> </span><span id="Encoded"><span class="annot"><a href="Agda.TypeChecking.Serialise.html#Encoded"><span class="hs-identifier hs-var">Encoded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>             </span><span class="hs-comment">-- index of root Node</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Node.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TL.Text</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Encodes something as a hash-consed tuple of arrays. To ensure relocatability, file paths in</span><span>
</span><span id="line-108"></span><span class="hs-comment">--   positions are replaced with module names.</span><span>
</span><span id="line-109"></span><span id="local-6989586621682000803"><span class="annot"><a href="Agda.TypeChecking.Serialise.html#encode"><span class="hs-identifier hs-type">encode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#EmbPrj"><span class="hs-identifier hs-type">EmbPrj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000803"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682000803"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#Encoded"><span class="hs-identifier hs-type">Encoded</span></a></span></span><span>
</span><span id="line-110"></span><span id="encode"><span class="annot"><span class="annottext">encode :: forall a. EmbPrj a =&gt; a -&gt; TCM Encoded
</span><a href="Agda.TypeChecking.Serialise.html#encode"><span class="hs-identifier hs-var hs-var">encode</span></a></span></span><span> </span><span id="local-6989586621682001166"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682001166"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621682001167"><span class="annot"><a href="#local-6989586621682001167"><span class="hs-identifier hs-var">collectStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProfileOption -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadDebug m =&gt; ProfileOption -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Debug.html#hasProfileOption"><span class="hs-identifier hs-var">hasProfileOption</span></a></span><span> </span><span class="annot"><span class="annottext">ProfileOption
</span><a href="Agda.Interaction.Options.ProfileOptions.html#Serialize"><span class="hs-identifier hs-var">Profile.Serialize</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621682001170"><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-var">newD</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#emptyDict"><span class="hs-identifier hs-type">emptyDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001167"><span class="hs-identifier hs-type">collectStats</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621682001173"><span class="annot"><a href="#local-6989586621682001173"><span class="hs-identifier hs-var">root</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`runReaderT`</span></span><span> </span><span class="annot"><span class="hs-identifier">newD</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#icode"><span class="hs-identifier hs-type">icode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001166"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682001176"><span class="annot"><a href="#local-6989586621682001176"><span class="hs-identifier hs-var">nodeA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001177"><span class="annot"><a href="#local-6989586621682001177"><span class="hs-identifier hs-var">stringA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001178"><span class="annot"><a href="#local-6989586621682001178"><span class="hs-identifier hs-var">lTextA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001179"><span class="annot"><a href="#local-6989586621682001179"><span class="hs-identifier hs-var">sTextA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001180"><span class="annot"><a href="#local-6989586621682001180"><span class="hs-identifier hs-var">integerA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001181"><span class="annot"><a href="#local-6989586621682001181"><span class="hs-identifier hs-var">varSetA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001182"><span class="annot"><a href="#local-6989586621682001182"><span class="hs-identifier hs-var">doubleA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-type">Bench.Serialization</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html#Sort"><span class="hs-identifier hs-type">Bench.Sort</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$!&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#nodeD"><span class="hs-identifier hs-var">nodeD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>               </span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-type">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#stringD"><span class="hs-identifier hs-var">stringD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>               </span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-type">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#lTextD"><span class="hs-identifier hs-var">lTextD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>               </span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-type">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#sTextD"><span class="hs-identifier hs-var">sTextD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>               </span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-type">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#integerD"><span class="hs-identifier hs-var">integerD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>               </span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-type">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#varSetD"><span class="hs-identifier hs-var">varSetD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>               </span><span class="annot"><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-type">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#doubleD"><span class="hs-identifier hs-var">doubleD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-comment">-- Record reuse statistics.</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#whenProfile"><span class="hs-identifier hs-type">whenProfile</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html#Sharing"><span class="hs-identifier hs-type">Profile.Sharing</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;pointers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#termC"><span class="hs-identifier hs-var">termC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#whenProfile"><span class="hs-identifier hs-type">whenProfile</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html#Serialize"><span class="hs-identifier hs-type">Profile.Serialize</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Integer&quot;</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#integerC"><span class="hs-identifier hs-var">integerC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;VarSet&quot;</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#varSetC"><span class="hs-identifier hs-var">varSetC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Lazy Text&quot;</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#lTextC"><span class="hs-identifier hs-var">lTextC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Strict Text&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#sTextC"><span class="hs-identifier hs-var">sTextC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;String&quot;</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#stringC"><span class="hs-identifier hs-var">stringC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Double&quot;</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#doubleC"><span class="hs-identifier hs-var">doubleC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Node&quot;</span></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#nodeC"><span class="hs-identifier hs-var">nodeC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Shared Term&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#termC"><span class="hs-identifier hs-var">termC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;A.QName&quot;</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#qnameC"><span class="hs-identifier hs-var">qnameC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;A.Name&quot;</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#nameC"><span class="hs-identifier hs-var">nameC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682001167"><span class="hs-identifier hs-type">collectStats</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621682001209"><span class="annot"><a href="#local-6989586621682001209"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">second</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.sort</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Utils.HashTable.html#toList"><span class="hs-identifier hs-type">H.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#stats"><span class="hs-identifier hs-var">stats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001170"><span class="hs-identifier hs-type">newD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">uncurry</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Statistics.html#tickN"><span class="hs-identifier hs-type">tickN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682001209"><span class="hs-identifier hs-type">stats</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682001173"><span class="hs-identifier hs-type">root</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001176"><span class="hs-identifier hs-type">nodeA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001177"><span class="hs-identifier hs-type">stringA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001178"><span class="hs-identifier hs-type">lTextA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001179"><span class="hs-identifier hs-type">sTextA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001180"><span class="hs-identifier hs-type">integerA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001181"><span class="hs-identifier hs-type">varSetA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001182"><span class="hs-identifier hs-type">doubleA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621682000851"><span class="annot"><a href="#local-6989586621682001187"><span class="hs-identifier hs-type">toArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.HashTable.html#HashTableLU"><span class="hs-identifier hs-type">H.HashTableLU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000851"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000851"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621682001187"><span class="annot"><span class="annottext">toArray :: forall k. HashTableLU k Word32 -&gt; IO (Array k)
</span><a href="#local-6989586621682001187"><span class="hs-identifier hs-var hs-var">toArray</span></a></span></span><span> </span><span id="local-6989586621682001231"><span class="annot"><span class="annottext">HashTableLU k Word32
</span><a href="#local-6989586621682001231"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>      </span><span id="local-6989586621682001232"><span class="annot"><a href="#local-6989586621682001232"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTableLU k Word32 -&gt; IO Int
forall (ks :: * -&gt; * -&gt; *) k (vs :: * -&gt; * -&gt; *) v.
MVector ks k =&gt;
HashTable ks k vs v -&gt; IO Int
</span><a href="Agda.Utils.HashTable.html#size"><span class="hs-identifier hs-var">H.size</span></a></span><span> </span><span class="annot"><span class="annottext">HashTableLU k Word32
</span><a href="#local-6989586621682001231"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-149"></span><span>      </span><span id="local-6989586621682001234"><span class="annot"><a href="#local-6989586621682001234"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.MutableLifted.html#new"><span class="hs-identifier hs-type">ML.new</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001232"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">undefined</span></span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><a href="Agda.Utils.HashTable.html#forAssocs"><span class="hs-identifier hs-type">H.forAssocs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001231"><span class="hs-identifier hs-type">tbl</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682001238"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621682001238"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682001239"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682001239"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Array (PrimState IO) k -&gt; Int -&gt; k -&gt; IO ()
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Array (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Agda.Utils.MinimalArray.MutableLifted.html#write"><span class="hs-identifier hs-var">ML.write</span></a></span><span> </span><span class="annot"><span class="annottext">Array RealWorld k
Array (PrimState IO) k
</span><a href="#local-6989586621682001234"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682001239"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621682001238"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><a href="Agda.Utils.MinimalArray.MutableLifted.html#unsafeFreeze"><span class="hs-identifier hs-type">ML.unsafeFreeze</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001234"><span class="hs-identifier hs-type">arr</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621682001197"><span class="hs-identifier hs-type">statistics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#FreshAndReuse"><span class="hs-identifier hs-type">FreshAndReuse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621682001197"><span class="annot"><span class="annottext">statistics :: String -&gt; FreshAndReuse -&gt; TCMT IO ()
</span><a href="#local-6989586621682001197"><span class="hs-identifier hs-var hs-var">statistics</span></a></span></span><span> </span><span id="local-6989586621682001242"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001242"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621682001243"><span class="annot"><span class="annottext">FreshAndReuse
</span><a href="#local-6989586621682001243"><span class="hs-identifier hs-var">far</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>      </span><span id="local-6989586621682001244"><span class="annot"><a href="#local-6989586621682001244"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Word32 -&gt; TCMT IO Word32
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Word32 -&gt; TCMT IO Word32) -&gt; IO Word32 -&gt; TCMT IO Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FreshAndReuse -&gt; IO Word32
</span><a href="Agda.TypeChecking.Serialise.Base.html#getFresh"><span class="hs-identifier hs-var">getFresh</span></a></span><span> </span><span class="annot"><span class="annottext">FreshAndReuse
</span><a href="#local-6989586621682001243"><span class="hs-identifier hs-var">far</span></a></span><span class="hs-cpp">
#ifdef DEBUG_SERIALISATION
</span><span>      </span><span class="hs-identifier">reused</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">liftIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">getReuse</span><span> </span><span class="hs-identifier">far</span><span class="hs-cpp">
#endif
</span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Statistics.html#tickN"><span class="hs-identifier hs-type">tickN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682001242"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  (fresh)&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621682001244"><span class="hs-identifier hs-type">fresh</span></a></span><span class="hs-cpp">
#ifdef DEBUG_SERIALISATION
</span><span>      </span><span class="hs-identifier">tickN</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">kind</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot; (reused)&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">reused</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-164"></span><span class="annot"><span class="hs-comment">-- | Decode a hash-consed value. The result depends on the include path.</span></span><span>
</span><span id="line-165"></span><span id="local-6989586621682000907"><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier hs-type">decode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#EmbPrj"><span class="hs-identifier hs-type">EmbPrj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000907"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#Encoded"><span class="hs-identifier hs-type">Encoded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000907"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-166"></span><span id="decode"><span class="annot"><span class="annottext">decode :: forall a. EmbPrj a =&gt; Encoded -&gt; MaybeT (TCMT IO) a
</span><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier hs-var hs-var">decode</span></a></span></span><span> </span><span id="local-6989586621682001291"><span class="annot"><span class="annottext">Encoded
</span><a href="#local-6989586621682001291"><span class="hs-identifier hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' SessionState ModuleToSource
-&gt; (ModuleToSource -&gt; MaybeT (TCMT IO) (a, ModuleToSource))
-&gt; MaybeT (TCMT IO) a
forall a r.
Lens' SessionState a
-&gt; (a -&gt; MaybeT (TCMT IO) (r, a)) -&gt; MaybeT (TCMT IO) r
forall (m :: * -&gt; *) a r.
ModifySession m =&gt;
Lens' SessionState a -&gt; (a -&gt; m (r, a)) -&gt; m r
</span><a href="Agda.TypeChecking.Monad.Base.html#stateSessionLensM"><span class="hs-identifier hs-var">stateSessionLensM</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleToSource -&gt; f ModuleToSource)
-&gt; SessionState -&gt; f SessionState
Lens' SessionState ModuleToSource
</span><a href="Agda.TypeChecking.Monad.Base.html#lensModuleToSource"><span class="hs-identifier hs-var">lensModuleToSource</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682001296"><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621682001296"><span class="hs-identifier hs-var">mf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621682001297"><span class="annot"><a href="#local-6989586621682001297"><span class="hs-identifier hs-var">includes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (List1 AbsolutePath)
-&gt; MaybeT (TCMT IO) (List1 AbsolutePath)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (List1 AbsolutePath)
 -&gt; MaybeT (TCMT IO) (List1 AbsolutePath))
-&gt; TCMT IO (List1 AbsolutePath)
-&gt; MaybeT (TCMT IO) (List1 AbsolutePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (List1 AbsolutePath)
</span><a href="Agda.TypeChecking.Monad.Options.html#getIncludeDirs"><span class="hs-identifier hs-var">getIncludeDirs</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621682001300"><span class="annot"><a href="#local-6989586621682001300"><span class="hs-identifier hs-var">arena</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.CompactRegion.html#new"><span class="hs-identifier hs-type">Compact.new</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">^</span></span><span> </span><span class="annot"><span class="hs-number">12</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 4 KB blocks</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682000929"><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000929"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#Array"><span class="hs-identifier hs-type">AL.Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682000929"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-171"></span><span>      </span><span id="local-6989586621682001303"><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-var hs-var">compactElems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO a) -&gt; Array a -&gt; IO (Array a)
forall a b. (a -&gt; IO b) -&gt; Array a -&gt; IO (Array b)
</span><a href="Agda.Utils.MinimalArray.Lifted.html#traverseIO%27"><span class="hs-identifier hs-var">AL.traverseIO'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Compact -&gt; a -&gt; IO a
forall a. Compact -&gt; a -&gt; IO a
</span><a href="Agda.Utils.CompactRegion.html#add"><span class="hs-identifier hs-var">Compact.add</span></a></span><span> </span><span class="annot"><span class="annottext">Compact
</span><a href="#local-6989586621682001300"><span class="hs-identifier hs-var">arena</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#tryDecode"><span class="hs-identifier hs-type">tryDecode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682001307"><span class="annot"><a href="#local-6989586621682001307"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001308"><span class="annot"><a href="#local-6989586621682001308"><span class="hs-identifier hs-var">nodeA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001309"><span class="annot"><a href="#local-6989586621682001309"><span class="hs-identifier hs-var">stringA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001310"><span class="annot"><a href="#local-6989586621682001310"><span class="hs-identifier hs-var">lTextA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001311"><span class="annot"><a href="#local-6989586621682001311"><span class="hs-identifier hs-var">sTextA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001312"><span class="annot"><a href="#local-6989586621682001312"><span class="hs-identifier hs-var">integerA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001313"><span class="annot"><a href="#local-6989586621682001313"><span class="hs-identifier hs-var">varSetA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001314"><span class="annot"><a href="#local-6989586621682001314"><span class="hs-identifier hs-var">doubleA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682001291"><span class="hs-identifier hs-type">enc</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621682001315"><span class="annot"><a href="#local-6989586621682001315"><span class="hs-identifier hs-var">stringA</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001309"><span class="hs-identifier hs-type">stringA</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621682001316"><span class="annot"><a href="#local-6989586621682001316"><span class="hs-identifier hs-var">lTextA</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001310"><span class="hs-identifier hs-type">lTextA</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621682001317"><span class="annot"><a href="#local-6989586621682001317"><span class="hs-identifier hs-var">sTextA</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001311"><span class="hs-identifier hs-type">sTextA</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621682001318"><span class="annot"><a href="#local-6989586621682001318"><span class="hs-identifier hs-var">integerA</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001312"><span class="hs-identifier hs-type">integerA</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621682001319"><span class="annot"><a href="#local-6989586621682001319"><span class="hs-identifier hs-var">varSetA</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001313"><span class="hs-identifier hs-type">varSetA</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621682001320"><span class="annot"><a href="#local-6989586621682001320"><span class="hs-identifier hs-var">doubleA</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682001303"><span class="hs-identifier hs-type">compactElems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001314"><span class="hs-identifier hs-type">doubleA</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621682001321"><span class="annot"><a href="#local-6989586621682001321"><span class="hs-identifier hs-var">filePathMemo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.HashTable.html#empty"><span class="hs-identifier hs-type">H.empty</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621682001323"><span class="annot"><a href="#local-6989586621682001323"><span class="hs-identifier hs-var">nodeMemo</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.MinimalArray.MutableLifted.html#new"><span class="hs-identifier hs-type">ML.new</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.MinimalArray.Lifted.html#size"><span class="hs-identifier hs-type">AL.size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001308"><span class="hs-identifier hs-type">nodeA</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#MEEmpty"><span class="hs-identifier hs-type">MEEmpty</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621682001326"><span class="annot"><a href="#local-6989586621682001326"><span class="hs-identifier hs-var">modFile</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682001296"><span class="hs-identifier hs-type">mf</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682001328"><span class="annot"><a href="#local-6989586621682001328"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOArray MemoEntry
-&gt; Compact
-&gt; Array Node
-&gt; Array String
-&gt; Array Text
-&gt; Array Text
-&gt; Array Integer
-&gt; Array VarSet
-&gt; Array Double
-&gt; HashTable MVector AbsolutePath MVector AbsolutePath
-&gt; IORef ModuleToSource
-&gt; List1 AbsolutePath
-&gt; Decode
</span><a href="Agda.TypeChecking.Serialise.Base.html#Decode"><span class="hs-identifier hs-var">Decode</span></a></span><span> </span><span class="annot"><span class="annottext">IOArray MemoEntry
</span><a href="#local-6989586621682001323"><span class="hs-identifier hs-var">nodeMemo</span></a></span><span> </span><span class="annot"><span class="annottext">Compact
</span><a href="#local-6989586621682001300"><span class="hs-identifier hs-var">arena</span></a></span><span> </span><span class="annot"><span class="annottext">Array Node
</span><a href="#local-6989586621682001308"><span class="hs-identifier hs-var">nodeA</span></a></span><span> </span><span class="annot"><span class="annottext">Array String
</span><a href="#local-6989586621682001315"><span class="hs-identifier hs-var">stringA</span></a></span><span> </span><span class="annot"><span class="annottext">Array Text
</span><a href="#local-6989586621682001316"><span class="hs-identifier hs-var">lTextA</span></a></span><span> </span><span class="annot"><span class="annottext">Array Text
</span><a href="#local-6989586621682001317"><span class="hs-identifier hs-var">sTextA</span></a></span><span> </span><span class="annot"><span class="annottext">Array Integer
</span><a href="#local-6989586621682001318"><span class="hs-identifier hs-var">integerA</span></a></span><span> </span><span class="annot"><span class="annottext">Array VarSet
</span><a href="#local-6989586621682001319"><span class="hs-identifier hs-var">varSetA</span></a></span><span>
</span><span id="line-186"></span><span>                     </span><span class="annot"><span class="annottext">Array Double
</span><a href="#local-6989586621682001320"><span class="hs-identifier hs-var">doubleA</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable MVector AbsolutePath MVector AbsolutePath
</span><a href="#local-6989586621682001321"><span class="hs-identifier hs-var">filePathMemo</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ModuleToSource
</span><a href="#local-6989586621682001326"><span class="hs-identifier hs-var">modFile</span></a></span><span> </span><span class="annot"><span class="annottext">List1 AbsolutePath
</span><a href="#local-6989586621682001297"><span class="hs-identifier hs-var">includes</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621682001330"><span class="annot"><a href="#local-6989586621682001330"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.Base.html#value"><span class="hs-identifier hs-type">value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001307"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682001328"><span class="hs-identifier hs-type">dec</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621682001332"><span class="annot"><a href="#local-6989586621682001332"><span class="hs-identifier hs-var">mf</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682001326"><span class="hs-identifier hs-type">modFile</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682001330"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682001332"><span class="hs-identifier hs-type">mf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- -- &quot;Compact&quot; the interfaces (without breaking sharing) to</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- -- reduce the amount of memory that is traversed by the</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- -- garbage collector.</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-comment">-- lift $ Bench.billTo [Bench.Deserialization, Bench.Compaction] $</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-comment">--   liftIO $ C.getCompact &lt;$!&gt; C.compactWithSharing res</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#getInterfacePrefix"><span class="hs-identifier hs-type">getInterfacePrefix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#InterfacePrefix"><span class="hs-identifier hs-type">InterfacePrefix</span></a></span><span>
</span><span id="line-197"></span><span id="getInterfacePrefix"><span class="annot"><span class="annottext">getInterfacePrefix :: Interface -&gt; InterfacePrefix
</span><a href="Agda.TypeChecking.Serialise.html#getInterfacePrefix"><span class="hs-identifier hs-var hs-var">getInterfacePrefix</span></a></span></span><span> </span><span id="local-6989586621682001335"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682001335"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682001335"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-var">iFullHash</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682001335"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="Agda.TypeChecking.Serialise.html#currentInterfaceVersion"><span class="hs-identifier hs-var">currentInterfaceVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | Serialize an interface prefix + an encoded interface to a lazy bytestring.</span><span>
</span><span id="line-201"></span><span class="hs-comment">--   The result is lazy in order to avoid copying data when we prepend the</span><span>
</span><span id="line-202"></span><span class="hs-comment">--   prefix to the compressed interface bytestring.</span><span>
</span><span id="line-203"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#serializeEncodedInterface"><span class="hs-identifier hs-type">serializeEncodedInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#InterfacePrefix"><span class="hs-identifier hs-type">InterfacePrefix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#Encoded"><span class="hs-identifier hs-type">Encoded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LB.ByteString</span></span><span>
</span><span id="line-204"></span><span id="serializeEncodedInterface"><span class="annot"><span class="annottext">serializeEncodedInterface :: InterfacePrefix -&gt; Encoded -&gt; TCM ByteString
</span><a href="Agda.TypeChecking.Serialise.html#serializeEncodedInterface"><span class="hs-identifier hs-var hs-var">serializeEncodedInterface</span></a></span></span><span> </span><span id="local-6989586621682001339"><span class="annot"><span class="annottext">InterfacePrefix
</span><a href="#local-6989586621682001339"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621682001340"><span class="annot"><span class="annottext">Encoded
</span><a href="#local-6989586621682001340"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682001346"><span class="annot"><span class="annottext">doCompress :: ByteString -&gt; f ByteString
</span><a href="#local-6989586621682001346"><span class="hs-identifier hs-var hs-var hs-var">doCompress</span></a></span></span><span> </span><span id="local-6989586621682001347"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001347"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; f ByteString
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; f ByteString) -&gt; ByteString -&gt; f ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">Z.compress</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001347"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-comment">-- we outline this to prevent let-lifting by GHC</span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="#local-6989586621682001346"><span class="hs-pragma hs-type">doCompress</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>           </span><span class="hs-comment">-- which could ruin the benchmark timing.</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682001350"><span class="annot"><a href="#local-6989586621682001350"><span class="hs-identifier hs-var">prefix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001351"><span class="annot"><a href="#local-6989586621682001351"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO (ByteString, ByteString)
-&gt; TCMT IO (ByteString, ByteString)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-var">Bench.Serialization</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#BinaryEncode"><span class="hs-identifier hs-var">Bench.BinaryEncode</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO (ByteString, ByteString)
 -&gt; TCMT IO (ByteString, ByteString))
-&gt; TCMT IO (ByteString, ByteString)
-&gt; TCMT IO (ByteString, ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (ByteString, ByteString) -&gt; TCMT IO (ByteString, ByteString)
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (ByteString, ByteString) -&gt; TCMT IO (ByteString, ByteString))
-&gt; IO (ByteString, ByteString) -&gt; TCMT IO (ByteString, ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-208"></span><span>                   </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString -&gt; (ByteString, ByteString))
-&gt; IO ByteString -&gt; IO (ByteString -&gt; (ByteString, ByteString))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">InterfacePrefix -&gt; IO ByteString
forall a. Serialize a =&gt; a -&gt; IO ByteString
</span><a href="Agda.Utils.Serialize.html#serialize"><span class="hs-identifier hs-var">serialize</span></a></span><span> </span><span class="annot"><span class="annottext">InterfacePrefix
</span><a href="#local-6989586621682001339"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">IO (ByteString -&gt; (ByteString, ByteString))
-&gt; IO ByteString -&gt; IO (ByteString, ByteString)
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="Agda.Utils.Monad.html#%3C%2A%21%3E"><span class="hs-operator hs-var">&lt;*!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Encoded -&gt; IO ByteString
forall a. Serialize a =&gt; a -&gt; IO ByteString
</span><a href="Agda.Utils.Serialize.html#serialize"><span class="hs-identifier hs-var">serialize</span></a></span><span> </span><span class="annot"><span class="annottext">Encoded
</span><a href="#local-6989586621682001340"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621682001354"><span class="annot"><a href="#local-6989586621682001354"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-type">Bench.Serialization</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html#Compress"><span class="hs-identifier hs-type">Bench.Compress</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682001346"><span class="hs-identifier hs-type">doCompress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001351"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LB.fromStrict</span></span><span> </span><span class="annot"><a href="#local-6989586621682001350"><span class="hs-identifier hs-type">prefix</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LB.fromStrict</span></span><span> </span><span class="annot"><a href="#local-6989586621682001354"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | Convert ErrorCall-s (which are assumed to be deserialization errors) to</span><span>
</span><span id="line-213"></span><span class="hs-comment">--   MaybeT TCM.</span><span>
</span><span id="line-214"></span><span id="local-6989586621682001357"><span class="annot"><a href="Agda.TypeChecking.Serialise.html#tryDecode"><span class="hs-identifier hs-type">tryDecode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682001357"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001357"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-215"></span><span id="tryDecode"><span class="annot"><span class="annottext">tryDecode :: forall a. IO a -&gt; MaybeT (TCMT IO) a
</span><a href="Agda.TypeChecking.Serialise.html#tryDecode"><span class="hs-identifier hs-var hs-var">tryDecode</span></a></span></span><span> </span><span id="local-6989586621682001367"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682001367"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe a) -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621682001369"><span class="annot"><a href="#local-6989586621682001369"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either String a) -&gt; TCM (Either String a)
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either String a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either String a) -&gt; IO a -&gt; IO (Either String a)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682001367"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either String a)
-&gt; (ErrorCall -&gt; IO (Either String a)) -&gt; IO (Either String a)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">E.ErrorCall</span></span><span> </span><span id="local-6989586621682001372"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001372"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either String a -&gt; IO (Either String a)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001372"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682001369"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682001373"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001373"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO ()) -&gt; String -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error when decoding interface file: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001373"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="annottext">Maybe a -&gt; TCM (Maybe a)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682001375"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682001375"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; TCM (Maybe a)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; TCM (Maybe a)) -&gt; Maybe a -&gt; TCM (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682001375"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Decode an interface from a bytestring. We check the stored interface</span><span>
</span><span id="line-224"></span><span class="hs-comment">--   version against the current interface version, but we don't do anything</span><span>
</span><span id="line-225"></span><span class="hs-comment">--   with the hash prefix.</span><span>
</span><span id="line-226"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier hs-type">decodeInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-227"></span><span id="decodeInterface"><span class="annot"><span class="annottext">decodeInterface :: ByteString -&gt; MaybeT (TCMT IO) Interface
</span><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier hs-var hs-var">decodeInterface</span></a></span></span><span> </span><span id="local-6989586621682001376"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001376"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encoded -&gt; MaybeT (TCMT IO) Interface
forall a. EmbPrj a =&gt; Encoded -&gt; MaybeT (TCMT IO) a
</span><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encoded -&gt; MaybeT (TCMT IO) Interface)
-&gt; MaybeT (TCMT IO) Encoded -&gt; MaybeT (TCMT IO) Interface
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; MaybeT (TCMT IO) Encoded
</span><a href="Agda.TypeChecking.Serialise.html#deserializeInterface"><span class="hs-identifier hs-var">deserializeInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001376"><span class="hs-identifier hs-var">bstr</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#deserializeInterface"><span class="hs-identifier hs-type">deserializeInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#Encoded"><span class="hs-identifier hs-type">Encoded</span></a></span><span>
</span><span id="line-230"></span><span id="deserializeInterface"><span class="annot"><span class="annottext">deserializeInterface :: ByteString -&gt; MaybeT (TCMT IO) Encoded
</span><a href="Agda.TypeChecking.Serialise.html#deserializeInterface"><span class="hs-identifier hs-var hs-var">deserializeInterface</span></a></span></span><span> </span><span id="local-6989586621682001378"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001378"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682001382"><span class="annot"><span class="annottext">decompressionError :: MaybeT (TCMT IO) a
</span><a href="#local-6989586621682001382"><span class="hs-identifier hs-var hs-var hs-var">decompressionError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="annottext">IO a -&gt; MaybeT (TCMT IO) a
forall a. IO a -&gt; MaybeT (TCMT IO) a
</span><a href="Agda.TypeChecking.Serialise.html#tryDecode"><span class="hs-identifier hs-var">tryDecode</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; MaybeT (TCMT IO) a) -&gt; IO a -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; IO a
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ErrorCall -&gt; IO a) -&gt; ErrorCall -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><span class="hs-identifier hs-var">E.ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;decompression error&quot;</span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682001384"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001384"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001385"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001385"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Agda.TypeChecking.Serialise.html#ifacePrefixSize"><span class="hs-identifier hs-var">ifacePrefixSize</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001378"><span class="hs-identifier hs-var">bstr</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682001387"><span class="annot"><a href="#local-6989586621682001387"><span class="hs-identifier hs-var">ver</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">InterfacePrefix</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO InterfacePrefix -&gt; MaybeT (TCMT IO) InterfacePrefix
forall a. IO a -&gt; MaybeT (TCMT IO) a
</span><a href="Agda.TypeChecking.Serialise.html#tryDecode"><span class="hs-identifier hs-var">tryDecode</span></a></span><span> </span><span class="annot"><span class="annottext">(IO InterfacePrefix -&gt; MaybeT (TCMT IO) InterfacePrefix)
-&gt; IO InterfacePrefix -&gt; MaybeT (TCMT IO) InterfacePrefix
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO InterfacePrefix
forall a. Serialize a =&gt; ByteString -&gt; IO a
</span><a href="Agda.Utils.Serialize.html#deserialize"><span class="hs-identifier hs-var">deserialize</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001384"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682001387"><span class="hs-identifier hs-type">ver</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#currentInterfaceVersion"><span class="hs-identifier hs-type">currentInterfaceVersion</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621682001382"><span class="hs-identifier hs-type">decompressionError</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z.decompress</span></span><span> </span><span class="annot"><a href="#local-6989586621682001385"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">Decompress
</span><span class="hs-identifier hs-var">Z.Skip</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Encoded
forall {a}. MaybeT (TCMT IO) a
</span><a href="#local-6989586621682001382"><span class="hs-identifier hs-var">decompressionError</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Z.Error</span></span><span> </span><span id="local-6989586621682001393"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001393"><span class="hs-identifier hs-var">e</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Encoded
forall {a}. MaybeT (TCMT IO) a
</span><a href="#local-6989586621682001382"><span class="hs-identifier hs-var">decompressionError</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Z.Decompress</span></span><span> </span><span id="local-6989586621682001395"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001395"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Encoded -&gt; MaybeT (TCMT IO) Encoded
forall a. IO a -&gt; MaybeT (TCMT IO) a
</span><a href="Agda.TypeChecking.Serialise.html#tryDecode"><span class="hs-identifier hs-var">tryDecode</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Encoded -&gt; MaybeT (TCMT IO) Encoded)
-&gt; IO Encoded -&gt; MaybeT (TCMT IO) Encoded
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO Encoded
forall a. Serialize a =&gt; ByteString -&gt; IO a
</span><a href="Agda.Utils.Serialize.html#deserialize"><span class="hs-identifier hs-var">deserialize</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001395"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Encodes an interface. To ensure relocatability file paths in positions are</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- replaced with module names.</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- A hash-consed and compacted interface is returned.</span><span>
</span><span id="line-247"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#encodeFile"><span class="hs-identifier hs-type">encodeFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-248"></span><span id="encodeFile"><span class="annot"><span class="annottext">encodeFile :: String -&gt; Interface -&gt; TCM Interface
</span><a href="Agda.TypeChecking.Serialise.html#encodeFile"><span class="hs-identifier hs-var hs-var">encodeFile</span></a></span></span><span> </span><span id="local-6989586621682001397"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001397"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682001398"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682001398"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682001399"><span class="annot"><span class="annottext">prefix :: InterfacePrefix
</span><a href="#local-6989586621682001399"><span class="hs-identifier hs-var hs-var hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; InterfacePrefix
</span><a href="Agda.TypeChecking.Serialise.html#getInterfacePrefix"><span class="hs-identifier hs-var">getInterfacePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682001398"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621682001400"><span class="annot"><a href="#local-6989586621682001400"><span class="hs-identifier hs-var">iEncoded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TCM Encoded
forall a. EmbPrj a =&gt; a -&gt; TCM Encoded
</span><a href="Agda.TypeChecking.Serialise.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682001398"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621682001401"><span class="annot"><a href="#local-6989586621682001401"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#serializeEncodedInterface"><span class="hs-identifier hs-type">serializeEncodedInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001399"><span class="hs-identifier hs-type">prefix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001400"><span class="hs-identifier hs-type">iEncoded</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621682001402"><span class="annot"><a href="#local-6989586621682001402"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-type">Bench.Deserialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier hs-type">decode</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001400"><span class="hs-identifier hs-type">iEncoded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- reload interface from the bytestring instead</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-comment">-- i &lt;- Bench.billTo [Bench.Deserialization] $</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">--     maybe __IMPOSSIBLE__ pure =&lt;&lt;</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-comment">--       runMaybeT (decode =&lt;&lt; deserializeInterface (LB.toStrict bstr))</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">takeDirectory</span></span><span> </span><span class="annot"><a href="#local-6989586621682001397"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LB.writeFile</span></span><span> </span><span class="annot"><a href="#local-6989586621682001397"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682001401"><span class="hs-identifier hs-type">bstr</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682001402"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decodeFile"><span class="hs-identifier hs-type">decodeFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span id="decodeFile"><span class="annot"><span class="annottext">decodeFile :: String -&gt; TCMT IO (Maybe Interface)
</span><a href="Agda.TypeChecking.Serialise.html#decodeFile"><span class="hs-identifier hs-var hs-var">decodeFile</span></a></span></span><span> </span><span id="local-6989586621682001408"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001408"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Interface -&gt; TCMT IO (Maybe Interface)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; MaybeT (TCMT IO) Interface
</span><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier hs-var">decodeInterface</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; MaybeT (TCMT IO) Interface)
-&gt; MaybeT (TCMT IO) ByteString -&gt; MaybeT (TCMT IO) Interface
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; MaybeT (TCMT IO) ByteString
forall a. IO a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682001408"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#deserializeHashes"><span class="hs-identifier hs-type">deserializeHashes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span id="deserializeHashes"><span class="annot"><span class="annottext">deserializeHashes :: ByteString -&gt; IO (Maybe (Hash, Hash))
</span><a href="Agda.TypeChecking.Serialise.html#deserializeHashes"><span class="hs-identifier hs-var hs-var">deserializeHashes</span></a></span></span><span> </span><span id="local-6989586621682001410"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001410"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Hash, Hash) -&gt; Maybe (Hash, Hash)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((Hash, Hash) -&gt; Maybe (Hash, Hash))
-&gt; IO (Hash, Hash) -&gt; IO (Maybe (Hash, Hash))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (Hash, Hash)
forall a. Serialize a =&gt; ByteString -&gt; IO a
</span><a href="Agda.Utils.Serialize.html#deserialize"><span class="hs-identifier hs-var">deserialize</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682001410"><span class="hs-identifier hs-var">bstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="annottext">IO (Maybe (Hash, Hash))
-&gt; (ErrorCall -&gt; IO (Maybe (Hash, Hash)))
-&gt; IO (Maybe (Hash, Hash))
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">E.ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash, Hash) -&gt; IO (Maybe (Hash, Hash))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Hash, Hash)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-271"></span></pre></body></html>