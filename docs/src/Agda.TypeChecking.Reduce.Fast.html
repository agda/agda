<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE PatternGuards #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">{-|

This module implements the Agda Abstract Machine used for compile-time reduction. It's a
call-by-need environment machine with an implicit heap maintained using 'STRef's. See the 'AM' type
below for a description of the machine.

Some other tricks that improves performance:

- Memoise getConstInfo.

  A big chunk of the time during reduction is spent looking up definitions in the signature. Any
  long-running reduction will use only a handful definitions though, so memoising getConstInfo is a
  big win.

- Optimised case trees.

  Since we memoise getConstInfo we can do some preprocessing of the definitions, returning a
  'CompactDef' instead of a 'Definition'. In particular we streamline the case trees used for
  matching in a few ways:

    - Drop constructor arity information.
    - Use NameId instead of QName as map keys.
    - Special branch for natural number successor.

  None of these changes would make sense to incorporate into the actual case trees. The first two
  loses information that we need in other places and the third would complicate a lot of code
  working with case trees.

  'CompactDef' also has a special representation for built-in/primitive
  functions that can be implemented as pure functions from 'Literal's.

-}</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html"><span class="hs-identifier">Agda.TypeChecking.Reduce.Fast</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce"><span class="hs-identifier">fastReduce</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastNormalise"><span class="hs-identifier">fastNormalise</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!!)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeSTToIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeInterleaveST</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MapS</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html"><span class="hs-identifier">Agda.Syntax.Literal</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Closure"><span class="hs-identifier">Closure</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewrite"><span class="hs-identifier">rewrite</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.html"><span class="hs-identifier">Agda.Utils.CallStack</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.Base.html#withCurrentCallStack"><span class="hs-identifier">withCurrentCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Char.html"><span class="hs-identifier">Agda.Utils.Char</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Float.html"><span class="hs-identifier">Agda.Utils.Float</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier">empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier">null</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Zipper.html"><span class="hs-identifier">Agda.Utils.Zipper</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.SmallSet.html"><span class="hs-identifier">Agda.Utils.SmallSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SmallSet</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html"><span class="hs-identifier">Agda.Utils.VarSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VarSet</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><span class="hs-comment">-- * Compact definitions</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- This is what the memoised getConstInfo returns. We essentially pick out only the</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- information needed for fast reduction from the definition.</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">data</span><span> </span><span id="CompactDef"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDef"><span class="hs-identifier hs-var">CompactDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>  </span><span id="CompactDef"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDef"><span class="hs-identifier hs-var">CompactDef</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="cdefUnconfirmed"><span class="annot"><span class="annottext">CompactDef -&gt; Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefUnconfirmed"><span class="hs-identifier hs-var hs-var">cdefUnconfirmed</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-96"></span><span>             </span><span class="hs-special">,</span><span> </span><span id="cdefDef"><span class="annot"><span class="annottext">CompactDef -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var hs-var">cdefDef</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDefn"><span class="hs-identifier hs-type">CompactDefn</span></a></span><span>
</span><span id="line-97"></span><span>             </span><span class="hs-special">,</span><span> </span><span id="cdefRewriteRules"><span class="annot"><span class="annottext">CompactDef -&gt; RewriteRules
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefRewriteRules"><span class="hs-identifier hs-var hs-var">cdefRewriteRules</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span>
</span><span id="line-98"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="CompactDefn"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDefn"><span class="hs-identifier hs-var">CompactDefn</span></a></span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CFun"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CFun"><span class="hs-identifier hs-var">CFun</span></a></span></span><span>  </span><span class="hs-special">{</span><span> </span><span id="cfunCompiled"><span class="annot"><span class="annottext">CompactDefn -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cfunCompiled"><span class="hs-identifier hs-var hs-var">cfunCompiled</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span class="hs-special">,</span><span> </span><span id="cfunProjection"><span class="annot"><span class="annottext">CompactDefn -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cfunProjection"><span class="hs-identifier hs-var hs-var">cfunProjection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CCon"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CCon"><span class="hs-identifier hs-var">CCon</span></a></span></span><span>  </span><span class="hs-special">{</span><span> </span><span id="cconSrcCon"><span class="annot"><span class="annottext">CompactDefn -&gt; ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconSrcCon"><span class="hs-identifier hs-var hs-var">cconSrcCon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span id="cconArity"><span class="annot"><span class="annottext">CompactDefn -&gt; Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconArity"><span class="hs-identifier hs-var hs-var">cconArity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CForce"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CForce"><span class="hs-identifier hs-var">CForce</span></a></span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ primForce</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CErase"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CErase"><span class="hs-identifier hs-var">CErase</span></a></span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ primErase</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CTyCon"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CTyCon"><span class="hs-identifier hs-var">CTyCon</span></a></span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Datatype or record type. Need to know this for primForce.</span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CAxiom"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Axiom or abstract defn</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CPrimOp"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CPrimOp"><span class="hs-identifier hs-var">CPrimOp</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Literals in reverse argument order</span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="COther"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ In this case we fall back to slow reduction</span></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">data</span><span> </span><span id="BuiltinEnv"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-var">BuiltinEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BuiltinEnv"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-var">BuiltinEnv</span></a></span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="bZero"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bZero"><span class="hs-identifier hs-var hs-var">bZero</span></a></span></span><span class="hs-special">,</span><span> </span><span id="bSuc"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bSuc"><span class="hs-identifier hs-var hs-var">bSuc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="bTrue"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bTrue"><span class="hs-identifier hs-var hs-var">bTrue</span></a></span></span><span class="hs-special">,</span><span> </span><span id="bFalse"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bFalse"><span class="hs-identifier hs-var hs-var">bFalse</span></a></span></span><span class="hs-special">,</span><span> </span><span id="bRefl"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bRefl"><span class="hs-identifier hs-var hs-var">bRefl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bPrimForce"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bPrimForce"><span class="hs-identifier hs-var hs-var">bPrimForce</span></a></span></span><span class="hs-special">,</span><span> </span><span id="bPrimErase"><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bPrimErase"><span class="hs-identifier hs-var hs-var">bPrimErase</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><span class="hs-comment">-- | Compute a 'CompactDef' from a regular definition.</span></span><span>
</span><span id="line-116"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#compactDef"><span class="hs-identifier hs-type">compactDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-type">BuiltinEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDef"><span class="hs-identifier hs-type">CompactDef</span></a></span><span>
</span><span id="line-117"></span><span id="compactDef"><span class="annot"><span class="annottext">compactDef :: BuiltinEnv -&gt; Definition -&gt; RewriteRules -&gt; ReduceM CompactDef
</span><a href="Agda.TypeChecking.Reduce.Fast.html#compactDef"><span class="hs-identifier hs-var hs-var">compactDef</span></a></span></span><span> </span><span id="local-6989586621682089922"><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span></span><span> </span><span id="local-6989586621682089923"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621682089924"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682089924"><span class="hs-identifier hs-var">rewr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-comment">-- WARNING: don't use isPropM here because it relies on reduction,</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- which causes an infinite loop.</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089925"><span class="annot"><span class="annottext">isPrp :: Bool
</span><a href="#local-6989586621682089925"><span class="hs-identifier hs-var hs-var hs-var">isPrp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Bool
forall t. Sort' t -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#isProp"><span class="hs-identifier hs-var">isProp</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort' Term -&gt; Bool) -&gt; Sort' Term -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Sort' Term) -&gt; Type -&gt; Sort' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>  </span><span id="local-6989586621682089929"><span class="annot"><a href="#local-6989586621682089929"><span class="hs-identifier hs-var">shouldReduce</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ReduceM Bool
forall (m :: * -&gt; *). MonadTCEnv m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#shouldReduceDef"><span class="hs-identifier hs-var">shouldReduceDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621682089932"><span class="annot"><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envAllowedReductions"><span class="hs-identifier hs-var">envAllowedReductions</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089935"><span class="annot"><a href="#local-6989586621682089935"><span class="hs-identifier hs-var hs-var">isConOrProj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funProjection :: Defn -&gt; Either ProjectionLikenessMissing Projection
</span><a href="Agda.TypeChecking.Monad.Base.html#funProjection"><span class="hs-identifier hs-var">funProjection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089940"><span class="annot"><a href="#local-6989586621682089940"><span class="hs-identifier hs-var hs-var">allowReduce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682089929"><span class="hs-identifier hs-var">shouldReduce</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span>
</span><span id="line-133"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#RecursiveReductions"><span class="hs-identifier hs-var">RecursiveReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-operator hs-var">`SmallSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-134"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682089935"><span class="hs-identifier hs-var">isConOrProj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#ProjectionReductions"><span class="hs-identifier hs-var">ProjectionReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-operator hs-var">`SmallSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-135"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Signature.html#isInlineFun"><span class="hs-identifier hs-var">isInlineFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#InlineReductions"><span class="hs-identifier hs-var">InlineReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-operator hs-var">`SmallSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-136"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Signature.html#definitelyNonRecursive_"><span class="hs-identifier hs-var">definitelyNonRecursive_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#defCopatternLHS"><span class="hs-identifier hs-var">defCopatternLHS</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#CopatternReductions"><span class="hs-identifier hs-var">CopatternReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-operator hs-var">`SmallSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#FunctionReductions"><span class="hs-identifier hs-var">FunctionReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-operator hs-var">`SmallSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#defNonterminating"><span class="hs-identifier hs-var">defNonterminating</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-identifier hs-var">SmallSet.member</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#NonTerminatingReductions"><span class="hs-identifier hs-var">NonTerminatingReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-comment">-- , not (defTerminationUnconfirmed def) || SmallSet.member UnconfirmedReductions allowed</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682089925"><span class="hs-identifier hs-var">isPrp</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621682089958"><span class="annot"><a href="#local-6989586621682089958"><span class="hs-identifier hs-var">cdefn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089923"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682089940"><span class="hs-identifier hs-var">allowReduce</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bPrimForce"><span class="hs-identifier hs-var">bPrimForce</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CForce"><span class="hs-identifier hs-var">CForce</span></a></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bPrimErase"><span class="hs-identifier hs-var">bPrimErase</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TelView
</span><a href="Agda.TypeChecking.Substitute.html#telView%27"><span class="hs-identifier hs-var">telView'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682089961"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682089961"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Peano
forall a. Sized a =&gt; a -&gt; Peano
</span><a href="Agda.Utils.Size.html#natSize"><span class="hs-identifier hs-var">natSize</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682089961"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Peano -&gt; Peano -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Peano
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CErase"><span class="hs-identifier hs-var">CErase</span></a></span><span>
</span><span id="line-154"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span>
</span><span id="line-155"></span><span>                          </span><span class="hs-comment">-- Non-standard equality. Fall back to slow reduce.</span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Blocked_
</span><a href="Agda.TypeChecking.Monad.Base.html#defBlocked"><span class="hs-identifier hs-var">defBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089923"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
forall t. Blocked' t ()
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked_"><span class="hs-identifier hs-var">notBlocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span> </span><span class="hs-comment">-- Blocked definition</span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">conSrcCon :: Defn -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#conSrcCon"><span class="hs-identifier hs-var">conSrcCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682089967"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682089967"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conArity :: Defn -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#conArity"><span class="hs-identifier hs-var">conArity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682089969"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089969"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CCon"><span class="hs-identifier hs-type">CCon</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">cconSrcCon :: ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconSrcCon"><span class="hs-identifier hs-var">cconSrcCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682089967"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cconArity :: Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconArity"><span class="hs-identifier hs-var">cconArity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089969"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funCompiled :: Defn -&gt; Maybe CompiledClauses
</span><a href="Agda.TypeChecking.Monad.Base.html#funCompiled"><span class="hs-identifier hs-var">funCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682089971"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682089971"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funClauses :: Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Clause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funProjection :: Defn -&gt; Either ProjectionLikenessMissing Projection
</span><a href="Agda.TypeChecking.Monad.Base.html#funProjection"><span class="hs-identifier hs-var">funProjection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682089973"><span class="annot"><span class="annottext">Either ProjectionLikenessMissing Projection
</span><a href="#local-6989586621682089973"><span class="hs-identifier hs-var">proj</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CFun"><span class="hs-identifier hs-type">CFun</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cfunCompiled :: FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cfunCompiled"><span class="hs-identifier hs-var">cfunCompiled</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682089971"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-160"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cfunProjection :: Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cfunProjection"><span class="hs-identifier hs-var">cfunProjection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projOrig"><span class="hs-identifier hs-var">projOrig</span></a></span><span> </span><span class="annot"><span class="annottext">(Projection -&gt; QName) -&gt; Maybe Projection -&gt; Maybe QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ProjectionLikenessMissing -&gt; Maybe Projection)
-&gt; (Projection -&gt; Maybe Projection)
-&gt; Either ProjectionLikenessMissing Projection
-&gt; Maybe Projection
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Projection -&gt; ProjectionLikenessMissing -&gt; Maybe Projection
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe Projection
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; Maybe Projection
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Either ProjectionLikenessMissing Projection
</span><a href="#local-6989586621682089973"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funClauses :: Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span> </span><span class="hs-comment">-- Incomplete definition</span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataClause :: Defn -&gt; Maybe Clause
</span><a href="Agda.TypeChecking.Monad.Base.html#dataClause"><span class="hs-identifier hs-var">dataClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Clause
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CTyCon"><span class="hs-identifier hs-var">CTyCon</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">recClause :: Defn -&gt; Maybe Clause
</span><a href="Agda.TypeChecking.Monad.Base.html#recClause"><span class="hs-identifier hs-var">recClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Clause
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CTyCon"><span class="hs-identifier hs-var">CTyCon</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span> </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-166"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span> </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceM CompactDefn
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span> </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#FunctionReductions"><span class="hs-identifier hs-var">FunctionReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#member"><span class="hs-operator hs-var">`SmallSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682089932"><span class="hs-identifier hs-var">allowed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">primName :: Defn -&gt; PrimitiveId
</span><a href="Agda.TypeChecking.Monad.Base.html#primName"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682089991"><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682089991"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">primCompiled :: Defn -&gt; Maybe CompiledClauses
</span><a href="Agda.TypeChecking.Monad.Base.html#primCompiled"><span class="hs-identifier hs-var">primCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682089993"><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682089993"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682089991"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-comment">-- &quot;primShowInteger&quot;            -- integers are not literals</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>          </span><span class="hs-comment">-- Natural numbers</span><span>
</span><span id="line-180"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatPlus"><span class="hs-identifier hs-var">PrimNatPlus</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682089996"><span class="hs-identifier hs-var">natOp</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span>
</span><span id="line-181"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatMinus"><span class="hs-identifier hs-var">PrimNatMinus</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682089996"><span class="hs-identifier hs-var">natOp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682089999"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682089999"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090000"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090000"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682089999"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090000"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatTimes"><span class="hs-identifier hs-var">PrimNatTimes</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682089996"><span class="hs-identifier hs-var">natOp</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span>
</span><span id="line-183"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatDivSucAux"><span class="hs-identifier hs-var">PrimNatDivSucAux</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer)
-&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090005"><span class="hs-identifier hs-var">natOp4</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer
forall {a}. Integral a =&gt; a -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621682090006"><span class="hs-identifier hs-var">divAux</span></a></span><span>
</span><span id="line-184"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatModSucAux"><span class="hs-identifier hs-var">PrimNatModSucAux</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer)
-&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090005"><span class="hs-identifier hs-var">natOp4</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer
forall {a}. Integral a =&gt; a -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621682090008"><span class="hs-identifier hs-var">modAux</span></a></span><span>
</span><span id="line-185"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatLess"><span class="hs-identifier hs-var">PrimNatLess</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090010"><span class="hs-identifier hs-var">natRel</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;)</span></span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatEquality"><span class="hs-identifier hs-var">PrimNatEquality</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090010"><span class="hs-identifier hs-var">natRel</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-comment">-- Word64</span><span>
</span><span id="line-189"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimWord64ToNat"><span class="hs-identifier hs-var">PrimWord64ToNat</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitWord64"><span class="hs-identifier hs-type">LitWord64</span></a></span><span> </span><span id="local-6989586621682090015"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682090015"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Term
</span><a href="#local-6989586621682090016"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682090015"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimWord64FromNat"><span class="hs-identifier hs-var">PrimWord64FromNat</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090019"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090019"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Term
</span><a href="#local-6989586621682090020"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090019"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-comment">-- Levels</span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-comment">-- &quot;primLevelZero&quot;              -- levels are not literals</span><span>
</span><span id="line-194"></span><span>          </span><span class="hs-comment">-- &quot;primLevelSuc&quot;               -- levels are not literals</span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-comment">-- &quot;primLevelMax&quot;               -- levels are not literals</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>          </span><span class="hs-comment">-- Floats</span><span>
</span><span id="line-198"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatInequality"><span class="hs-identifier hs-var">PrimFloatInequality</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090022"><span class="hs-identifier hs-var">floatRel</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;=)</span></span><span>
</span><span id="line-199"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatEquality"><span class="hs-identifier hs-var">PrimFloatEquality</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090022"><span class="hs-identifier hs-var">floatRel</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-200"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatLess"><span class="hs-identifier hs-var">PrimFloatLess</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090022"><span class="hs-identifier hs-var">floatRel</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;)</span></span><span>
</span><span id="line-201"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsInfinite"><span class="hs-identifier hs-var">PrimFloatIsInfinite</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090027"><span class="hs-identifier hs-var">floatPred</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span>
</span><span id="line-202"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsNaN"><span class="hs-identifier hs-var">PrimFloatIsNaN</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090027"><span class="hs-identifier hs-var">floatPred</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span>
</span><span id="line-203"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsNegativeZero"><span class="hs-identifier hs-var">PrimFloatIsNegativeZero</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090027"><span class="hs-identifier hs-var">floatPred</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNegativeZero</span></span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsSafeInteger"><span class="hs-identifier hs-var">PrimFloatIsSafeInteger</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090027"><span class="hs-identifier hs-var">floatPred</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
</span><a href="Agda.Utils.Float.html#isSafeInteger"><span class="hs-identifier hs-var">isSafeInteger</span></a></span><span>
</span><span id="line-205"></span><span>          </span><span class="hs-comment">-- &quot;primFloatToWord64&quot;          -- returns a maybe</span><span>
</span><span id="line-206"></span><span>          </span><span class="hs-comment">-- &quot;primFloatToWord64Injective&quot; -- identities are not literals</span><span>
</span><span id="line-207"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatToFloat"><span class="hs-identifier hs-var">PrimNatToFloat</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090036"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090036"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Term
</span><a href="#local-6989586621682090037"><span class="hs-identifier hs-var">float</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090036"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>          </span><span class="hs-comment">-- &quot;primIntToFloat&quot;             -- integers are not literals</span><span>
</span><span id="line-209"></span><span>          </span><span class="hs-comment">-- &quot;primFloatRound&quot;             -- integers and maybe are not literals</span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-comment">-- &quot;primFloatFloor&quot;             -- integers and maybe are not literals</span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-comment">-- &quot;primFloatCeiling&quot;           -- integers and maybe are not literals</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-comment">-- &quot;primFloatToRatio&quot;           -- integers and sigma are not literals</span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-comment">-- &quot;primRatioToFloat&quot;           -- integers are not literals</span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-comment">-- &quot;primFloatDecode&quot;            -- integers and sigma are not literals</span><span>
</span><span id="line-215"></span><span>          </span><span class="hs-comment">-- &quot;primFloatEncode&quot;            -- integers are not literals</span><span>
</span><span id="line-216"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatPlus"><span class="hs-identifier hs-var">PrimFloatPlus</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span>
</span><span id="line-217"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatMinus"><span class="hs-identifier hs-var">PrimFloatMinus</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatTimes"><span class="hs-identifier hs-var">PrimFloatTimes</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span>
</span><span id="line-219"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatNegate"><span class="hs-identifier hs-var">PrimFloatNegate</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span>
</span><span id="line-220"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatDiv"><span class="hs-identifier hs-var">PrimFloatDiv</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(/)</span></span><span>
</span><span id="line-221"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatSqrt"><span class="hs-identifier hs-var">PrimFloatSqrt</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span>
</span><span id="line-222"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatExp"><span class="hs-identifier hs-var">PrimFloatExp</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatLog"><span class="hs-identifier hs-var">PrimFloatLog</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatSin"><span class="hs-identifier hs-var">PrimFloatSin</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sin</span></span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatCos"><span class="hs-identifier hs-var">PrimFloatCos</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cos</span></span><span>
</span><span id="line-226"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatTan"><span class="hs-identifier hs-var">PrimFloatTan</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">tan</span></span><span>
</span><span id="line-227"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatASin"><span class="hs-identifier hs-var">PrimFloatASin</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">asin</span></span><span>
</span><span id="line-228"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatACos"><span class="hs-identifier hs-var">PrimFloatACos</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">acos</span></span><span>
</span><span id="line-229"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatATan"><span class="hs-identifier hs-var">PrimFloatATan</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">atan</span></span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatATan2"><span class="hs-identifier hs-var">PrimFloatATan2</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. RealFloat a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">atan2</span></span><span>
</span><span id="line-231"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatSinh"><span class="hs-identifier hs-var">PrimFloatSinh</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sinh</span></span><span>
</span><span id="line-232"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatCosh"><span class="hs-identifier hs-var">PrimFloatCosh</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cosh</span></span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatTanh"><span class="hs-identifier hs-var">PrimFloatTanh</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">tanh</span></span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatASinh"><span class="hs-identifier hs-var">PrimFloatASinh</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">asinh</span></span><span>
</span><span id="line-235"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatACosh"><span class="hs-identifier hs-var">PrimFloatACosh</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">acosh</span></span><span>
</span><span id="line-236"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatATanh"><span class="hs-identifier hs-var">PrimFloatATanh</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">atanh</span></span><span>
</span><span id="line-237"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatPow"><span class="hs-identifier hs-var">PrimFloatPow</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(**)</span></span><span>
</span><span id="line-238"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowFloat"><span class="hs-identifier hs-var">PrimShowFloat</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090082"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090082"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Term
</span><a href="#local-6989586621682090083"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090082"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>          </span><span class="hs-comment">-- Characters</span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimCharEquality"><span class="hs-identifier hs-var">PrimCharEquality</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090086"><span class="hs-identifier hs-var">charRel</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsLower"><span class="hs-identifier hs-var">PrimIsLower</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isLower</span></span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsDigit"><span class="hs-identifier hs-var">PrimIsDigit</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsAlpha"><span class="hs-identifier hs-var">PrimIsAlpha</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlpha</span></span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsSpace"><span class="hs-identifier hs-var">PrimIsSpace</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span>
</span><span id="line-246"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsAscii"><span class="hs-identifier hs-var">PrimIsAscii</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAscii</span></span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsLatin1"><span class="hs-identifier hs-var">PrimIsLatin1</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isLatin1</span></span><span>
</span><span id="line-248"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsPrint"><span class="hs-identifier hs-var">PrimIsPrint</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isPrint</span></span><span>
</span><span id="line-249"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIsHexDigit"><span class="hs-identifier hs-var">PrimIsHexDigit</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isHexDigit</span></span><span>
</span><span id="line-250"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimToUpper"><span class="hs-identifier hs-var">PrimToUpper</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090105"><span class="hs-identifier hs-var">charFun</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toUpper</span></span><span>
</span><span id="line-251"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimToLower"><span class="hs-identifier hs-var">PrimToLower</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090105"><span class="hs-identifier hs-var">charFun</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimCharToNat"><span class="hs-identifier hs-var">PrimCharToNat</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621682090111"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090111"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Term
</span><a href="#local-6989586621682090016"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090111"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatToChar"><span class="hs-identifier hs-var">PrimNatToChar</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090114"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090114"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Term
</span><a href="#local-6989586621682090115"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Char
</span><a href="Agda.Utils.Char.html#integerToChar"><span class="hs-identifier hs-var">integerToChar</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090114"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowChar"><span class="hs-identifier hs-var">PrimShowChar</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682090118"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682090118"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Term
</span><a href="#local-6989586621682090083"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; VerboseKey
forall a. Pretty a =&gt; a -&gt; VerboseKey
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682090118"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-comment">-- Strings</span><span>
</span><span id="line-257"></span><span>          </span><span class="hs-comment">-- &quot;primStringToList&quot;           -- lists are not literals (TODO)</span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-comment">-- &quot;primStringFromList&quot;         -- lists are not literals (TODO)</span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimStringAppend"><span class="hs-identifier hs-var">PrimStringAppend</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682090122"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090122"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682090123"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090123"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Term
</span><a href="#local-6989586621682090124"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090123"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090122"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimStringEquality"><span class="hs-identifier hs-var">PrimStringEquality</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682090126"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090126"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682090127"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090127"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090127"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090126"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowString"><span class="hs-identifier hs-var">PrimShowString</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682090130"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682090130"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Term
</span><a href="#local-6989586621682090083"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; VerboseKey
forall a. Pretty a =&gt; a -&gt; VerboseKey
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682090130"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>          </span><span class="hs-comment">-- &quot;primErase&quot;</span><span>
</span><span id="line-264"></span><span>          </span><span class="hs-comment">-- &quot;primForce&quot;</span><span>
</span><span id="line-265"></span><span>          </span><span class="hs-comment">-- &quot;primForceLemma&quot;</span><span>
</span><span id="line-266"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimQNameEquality"><span class="hs-identifier hs-var">PrimQNameEquality</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitQName"><span class="hs-identifier hs-type">LitQName</span></a></span><span> </span><span id="local-6989586621682090133"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090133"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitQName"><span class="hs-identifier hs-type">LitQName</span></a></span><span> </span><span id="local-6989586621682090134"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090134"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090134"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090133"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimQNameLess"><span class="hs-identifier hs-var">PrimQNameLess</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitQName"><span class="hs-identifier hs-type">LitQName</span></a></span><span> </span><span id="local-6989586621682090136"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090136"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitQName"><span class="hs-identifier hs-type">LitQName</span></a></span><span> </span><span id="local-6989586621682090137"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090137"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090137"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090136"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowQName"><span class="hs-identifier hs-var">PrimShowQName</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitQName"><span class="hs-identifier hs-type">LitQName</span></a></span><span> </span><span id="local-6989586621682090139"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090139"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Term
</span><a href="#local-6989586621682090083"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; VerboseKey
forall a. Pretty a =&gt; a -&gt; VerboseKey
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090139"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>          </span><span class="hs-comment">-- &quot;primQNameFixity&quot;            -- fixities are not literals (TODO)</span><span>
</span><span id="line-270"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimMetaEquality"><span class="hs-identifier hs-var">PrimMetaEquality</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitMeta"><span class="hs-identifier hs-type">LitMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName' Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090142"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090142"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitMeta"><span class="hs-identifier hs-type">LitMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName' Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090143"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090143"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090143"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; MetaId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090142"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimMetaLess"><span class="hs-identifier hs-var">PrimMetaLess</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitMeta"><span class="hs-identifier hs-type">LitMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName' Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090145"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090145"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitMeta"><span class="hs-identifier hs-type">LitMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName' Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090146"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090146"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090146"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; MetaId -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090145"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowMeta"><span class="hs-identifier hs-var">PrimShowMeta</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var">mkPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(([Literal] -&gt; Term) -&gt; ReduceM CompactDefn)
-&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitMeta"><span class="hs-identifier hs-type">LitMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName' Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090148"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090148"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Term
</span><a href="#local-6989586621682090083"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; VerboseKey
forall a. Pretty a =&gt; a -&gt; VerboseKey
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090148"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><span class="annottext">PrimitiveId
</span><span class="hs-identifier">_</span></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-276"></span><span>          </span><span id="local-6989586621682090149"><span class="annot"><span class="annottext">fcc :: Maybe FastCompiledClauses
</span><a href="#local-6989586621682090149"><span class="hs-identifier hs-var hs-var">fcc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; Maybe CompiledClauses -&gt; Maybe FastCompiledClauses
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682089993"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-277"></span><span>          </span><span id="local-6989586621682089995"><span class="annot"><span class="annottext">mkPrim :: Int -&gt; ([Literal] -&gt; Term) -&gt; ReduceM CompactDefn
</span><a href="#local-6989586621682089995"><span class="hs-identifier hs-var hs-var">mkPrim</span></a></span></span><span> </span><span id="local-6989586621682090150"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090150"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682090151"><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682090151"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; ReduceM CompactDefn
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CompactDefn -&gt; ReduceM CompactDefn)
-&gt; CompactDefn -&gt; ReduceM CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ([Literal] -&gt; Term) -&gt; Maybe FastCompiledClauses -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CPrimOp"><span class="hs-identifier hs-var">CPrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090150"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682090151"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682090149"><span class="hs-identifier hs-var">fcc</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>          </span><span id="local-6989586621682090006"><span class="annot"><span class="annottext">divAux :: a -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621682090006"><span class="hs-identifier hs-var hs-var">divAux</span></a></span></span><span> </span><span id="local-6989586621682090177"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090177"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682090178"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090178"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682090179"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090179"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682090180"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090180"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090177"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">div</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090179"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090178"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090180"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090178"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>          </span><span id="local-6989586621682090008"><span class="annot"><span class="annottext">modAux :: a -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621682090008"><span class="hs-identifier hs-var hs-var">modAux</span></a></span></span><span> </span><span id="local-6989586621682090202"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090202"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682090203"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090203"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682090204"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090204"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682090205"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090205"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090204"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090205"><span class="hs-identifier hs-var">j</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090204"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090205"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090203"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090202"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090204"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>          </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090208"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090208"><span class="hs-identifier hs-var">true</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bTrue"><span class="hs-identifier hs-var">bTrue</span></a></span><span>  </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead -&gt; (ConHead -&gt; Term) -&gt; Maybe Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682090210"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090210"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090210"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>          </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090213"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090213"><span class="hs-identifier hs-var">false</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bFalse"><span class="hs-identifier hs-var">bFalse</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682089922"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead -&gt; (ConHead -&gt; Term) -&gt; Maybe Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682090214"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090214"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090214"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>          </span><span id="local-6989586621682090128"><span class="annot"><span class="annottext">bool :: Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var hs-var">bool</span></a></span></span><span>   </span><span id="local-6989586621682090215"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090215"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090215"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090208"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090213"><span class="hs-identifier hs-var">false</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span id="local-6989586621682090016"><span class="annot"><span class="annottext">nat :: Integer -&gt; Term
</span><a href="#local-6989586621682090016"><span class="hs-identifier hs-var hs-var">nat</span></a></span></span><span>    </span><span id="local-6989586621682090216"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090216"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; (Integer -&gt; Literal) -&gt; Integer -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-var">LitNat</span></a></span><span>    </span><span class="annot"><span class="annottext">(Integer -&gt; Term) -&gt; Integer -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090216"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-288"></span><span>          </span><span id="local-6989586621682090020"><span class="annot"><span class="annottext">word :: Word64 -&gt; Term
</span><a href="#local-6989586621682090020"><span class="hs-identifier hs-var hs-var">word</span></a></span></span><span>   </span><span id="local-6989586621682090220"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682090220"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; (Word64 -&gt; Literal) -&gt; Word64 -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitWord64"><span class="hs-identifier hs-var">LitWord64</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Term) -&gt; Word64 -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682090220"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span id="local-6989586621682090037"><span class="annot"><span class="annottext">float :: Double -&gt; Term
</span><a href="#local-6989586621682090037"><span class="hs-identifier hs-var hs-var">float</span></a></span></span><span>  </span><span id="local-6989586621682090221"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090221"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; (Double -&gt; Literal) -&gt; Double -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a></span><span>  </span><span class="annot"><span class="annottext">(Double -&gt; Term) -&gt; Double -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090221"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-290"></span><span>          </span><span id="local-6989586621682090124"><span class="annot"><span class="annottext">text :: Text -&gt; Term
</span><a href="#local-6989586621682090124"><span class="hs-identifier hs-var hs-var">text</span></a></span></span><span>   </span><span id="local-6989586621682090222"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090222"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; (Text -&gt; Literal) -&gt; Text -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Term) -&gt; Text -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682090222"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span id="local-6989586621682090083"><span class="annot"><span class="annottext">string :: VerboseKey -&gt; Term
</span><a href="#local-6989586621682090083"><span class="hs-identifier hs-var hs-var">string</span></a></span></span><span> </span><span id="local-6989586621682090223"><span class="annot"><span class="annottext">VerboseKey
</span><a href="#local-6989586621682090223"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Term
</span><a href="#local-6989586621682090124"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><a href="#local-6989586621682090223"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>          </span><span id="local-6989586621682090115"><span class="annot"><span class="annottext">char :: Char -&gt; Term
</span><a href="#local-6989586621682090115"><span class="hs-identifier hs-var hs-var">char</span></a></span></span><span>   </span><span id="local-6989586621682090225"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090225"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; (Char -&gt; Literal) -&gt; Char -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-var">LitChar</span></a></span><span>   </span><span class="annot"><span class="annottext">(Char -&gt; Term) -&gt; Char -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090225"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>          </span><span class="hs-comment">-- Remember reverse order!</span><span>
</span><span id="line-295"></span><span>          </span><span id="local-6989586621682089996"><span class="annot"><span class="annottext">natOp :: (Integer -&gt; Integer -&gt; Integer) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682089996"><span class="hs-identifier hs-var hs-var">natOp</span></a></span></span><span> </span><span id="local-6989586621682090228"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621682090228"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090229"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090229"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090230"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090230"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Term
</span><a href="#local-6989586621682090016"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621682090228"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090230"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090229"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>          </span><span class="annot"><a href="#local-6989586621682089996"><span class="hs-identifier hs-var">natOp</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>          </span><span id="local-6989586621682090005"><span class="annot"><span class="annottext">natOp4 :: (Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer)
-&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090005"><span class="hs-identifier hs-var hs-var">natOp4</span></a></span></span><span> </span><span id="local-6989586621682090233"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621682090233"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090234"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090234"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090235"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090235"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090236"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090236"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090237"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090237"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Term
</span><a href="#local-6989586621682090016"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621682090233"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090237"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090236"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090235"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090234"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>          </span><span class="annot"><a href="#local-6989586621682090005"><span class="hs-identifier hs-var">natOp4</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>          </span><span id="local-6989586621682090010"><span class="annot"><span class="annottext">natRel :: (Integer -&gt; Integer -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090010"><span class="hs-identifier hs-var hs-var">natRel</span></a></span></span><span> </span><span id="local-6989586621682090238"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621682090238"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090239"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090239"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682090240"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090240"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621682090238"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090240"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682090239"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><a href="#local-6989586621682090010"><span class="hs-identifier hs-var">natRel</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>          </span><span id="local-6989586621682090043"><span class="annot"><span class="annottext">floatFun :: (Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090043"><span class="hs-identifier hs-var hs-var">floatFun</span></a></span></span><span> </span><span id="local-6989586621682090243"><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="#local-6989586621682090243"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090244"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090244"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Term
</span><a href="#local-6989586621682090037"><span class="hs-identifier hs-var">float</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="#local-6989586621682090243"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090244"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>          </span><span class="annot"><a href="#local-6989586621682090043"><span class="hs-identifier hs-var">floatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>          </span><span id="local-6989586621682090039"><span class="annot"><span class="annottext">floatOp :: (Double -&gt; Double -&gt; Double) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090039"><span class="hs-identifier hs-var hs-var">floatOp</span></a></span></span><span> </span><span id="local-6989586621682090247"><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
</span><a href="#local-6989586621682090247"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090248"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090248"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090249"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090249"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Term
</span><a href="#local-6989586621682090037"><span class="hs-identifier hs-var">float</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
</span><a href="#local-6989586621682090247"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090249"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090248"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>          </span><span class="annot"><a href="#local-6989586621682090039"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>          </span><span id="local-6989586621682090027"><span class="annot"><span class="annottext">floatPred :: (Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090027"><span class="hs-identifier hs-var hs-var">floatPred</span></a></span></span><span> </span><span id="local-6989586621682090250"><span class="annot"><span class="annottext">Double -&gt; Bool
</span><a href="#local-6989586621682090250"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090251"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090251"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Bool
</span><a href="#local-6989586621682090250"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090251"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>          </span><span class="annot"><a href="#local-6989586621682090027"><span class="hs-identifier hs-var">floatPred</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>          </span><span id="local-6989586621682090022"><span class="annot"><span class="annottext">floatRel :: (Double -&gt; Double -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090022"><span class="hs-identifier hs-var hs-var">floatRel</span></a></span></span><span> </span><span id="local-6989586621682090252"><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
</span><a href="#local-6989586621682090252"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090253"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090253"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682090254"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090254"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
</span><a href="#local-6989586621682090252"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090254"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682090253"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><a href="#local-6989586621682090022"><span class="hs-identifier hs-var">floatRel</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>          </span><span id="local-6989586621682090105"><span class="annot"><span class="annottext">charFun :: (Char -&gt; Char) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090105"><span class="hs-identifier hs-var hs-var">charFun</span></a></span></span><span> </span><span id="local-6989586621682090257"><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="#local-6989586621682090257"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621682090258"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090258"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Term
</span><a href="#local-6989586621682090115"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="#local-6989586621682090257"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090258"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>          </span><span class="annot"><a href="#local-6989586621682090105"><span class="hs-identifier hs-var">charFun</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>          </span><span id="local-6989586621682090088"><span class="annot"><span class="annottext">charPred :: (Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090088"><span class="hs-identifier hs-var hs-var">charPred</span></a></span></span><span> </span><span id="local-6989586621682090259"><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621682090259"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621682090260"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090260"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621682090259"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090260"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>          </span><span class="annot"><a href="#local-6989586621682090088"><span class="hs-identifier hs-var">charPred</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>          </span><span id="local-6989586621682090086"><span class="annot"><span class="annottext">charRel :: (Char -&gt; Char -&gt; Bool) -&gt; [Literal] -&gt; Term
</span><a href="#local-6989586621682090086"><span class="hs-identifier hs-var hs-var">charRel</span></a></span></span><span> </span><span id="local-6989586621682090261"><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
</span><a href="#local-6989586621682090261"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621682090262"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090262"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621682090263"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090263"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term
</span><a href="#local-6989586621682090128"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
</span><a href="#local-6989586621682090261"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090263"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682090262"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>          </span><span class="annot"><a href="#local-6989586621682090086"><span class="hs-identifier hs-var">charRel</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDef"><span class="hs-identifier hs-type">CompactDef</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#cdefUnconfirmed"><span class="hs-identifier hs-var">cdefUnconfirmed</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defTerminationUnconfirmed"><span class="hs-identifier hs-type">defTerminationUnconfirmed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089923"><span class="hs-identifier hs-type">def</span></a></span><span>
</span><span id="line-327"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var">cdefDef</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682089958"><span class="hs-identifier hs-type">cdefn</span></a></span><span>
</span><span id="line-328"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#cdefRewriteRules"><span class="hs-identifier hs-var">cdefRewriteRules</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682089940"><span class="hs-identifier hs-type">allowReduce</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682089924"><span class="hs-identifier hs-type">rewr</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- Faster case trees ------------------------------------------------------</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-keyword">data</span><span> </span><span id="FastCase"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCase"><span class="hs-identifier hs-var">FastCase</span></a></span></span><span> </span><span id="local-6989586621682089258"><span class="annot"><a href="#local-6989586621682089258"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FBranches"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FBranches"><span class="hs-identifier hs-var">FBranches</span></a></span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="fprojPatterns"><span class="annot"><span class="annottext">forall c. FastCase c -&gt; Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fprojPatterns"><span class="hs-identifier hs-var hs-var">fprojPatterns</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">-- ^ We are constructing a record here (copatterns).</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-comment">--   'conBranches' lists projections.</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fconBranches"><span class="annot"><span class="annottext">forall c. FastCase c -&gt; Map NameId c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fconBranches"><span class="hs-identifier hs-var hs-var">fconBranches</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-type">NameId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089258"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- ^ Map from constructor (or projection) names to their arity</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">--   and the case subtree.  (Projections have arity 0.)</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fsucBranch"><span class="annot"><span class="annottext">forall c. FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fsucBranch"><span class="hs-identifier hs-var hs-var">fsucBranch</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682089258"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="flitBranches"><span class="annot"><span class="annottext">forall c. FastCase c -&gt; Map Literal c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#flitBranches"><span class="hs-identifier hs-var hs-var">flitBranches</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089258"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Map from literal to case subtree.</span></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fcatchallBranch"><span class="annot"><span class="annottext">forall c. FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fcatchallBranch"><span class="hs-identifier hs-var hs-var">fcatchallBranch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682089258"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ (Possibly additional) catch-all clause.</span></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ffallThrough"><span class="annot"><span class="annottext">forall c. FastCase c -&gt; Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ffallThrough"><span class="hs-identifier hs-var hs-var">ffallThrough</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ (if True) In case of non-canonical argument use catchallBranch.</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">--UNUSED Liang-Ting Chen 2019-07-16</span><span>
</span><span id="line-350"></span><span class="hs-comment">--noBranches :: FastCase a</span><span>
</span><span id="line-351"></span><span class="hs-comment">--noBranches = FBranches{ fprojPatterns   = False</span><span>
</span><span id="line-352"></span><span class="hs-comment">--                      , fconBranches    = Map.empty</span><span>
</span><span id="line-353"></span><span class="hs-comment">--                      , fsucBranch      = Nothing</span><span>
</span><span id="line-354"></span><span class="hs-comment">--                      , flitBranches    = Map.empty</span><span>
</span><span id="line-355"></span><span class="hs-comment">--                      , fcatchallBranch = Nothing</span><span>
</span><span id="line-356"></span><span class="hs-comment">--                      , ffallThrough    = False }</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><span class="hs-comment">-- | Case tree with bodies.</span></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-keyword">data</span><span> </span><span id="FastCompiledClauses"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-var">FastCompiledClauses</span></a></span></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="FCase"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FCase"><span class="hs-identifier hs-var">FCase</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCase"><span class="hs-identifier hs-type">FastCase</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- ^ @Case n bs@ stands for a match on the @n@-th argument</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- (counting from zero) with @bs@ as the case branches.</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-comment">-- If the @n@-th argument is a projection, we have only 'conBranches'</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-comment">-- with arity 0.</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FEta"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FEta"><span class="hs-identifier hs-var">FEta</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-comment">-- ^ Match on record constructor. Can still have a catch-all though. Just</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">--   contains the fields, not the actual constructor.</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FDone"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FDone"><span class="hs-identifier hs-var">FDone</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CCDone"><span class="hs-identifier hs-type">CCDone</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-comment">-- ^ See 'Done'.</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-comment">--   @FDone (CCDone _ mr xs b)@ stands for the body @b@ where the @xs@ contains hiding</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-comment">--   and name suggestions for the free variables. This is needed to build</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">--   lambdas on the right hand side for partial applications which can</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-comment">--   still reduce.</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">--   @mr@ indicates whether this leaf containts recursive mutually recursive calls.</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FFail"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FFail"><span class="hs-identifier hs-var">FFail</span></a></span></span><span>
</span><span id="line-377"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Absurd case.</span></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-type">fastCompiledClauses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-type">BuiltinEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span>
</span><span id="line-380"></span><span id="fastCompiledClauses"><span class="annot"><span class="annottext">fastCompiledClauses :: BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var hs-var">fastCompiledClauses</span></a></span></span><span> </span><span id="local-6989586621682090278"><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090278"><span class="hs-identifier hs-var">bEnv</span></a></span></span><span> </span><span id="local-6989586621682090279"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682090279"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682090279"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Fail"><span class="hs-identifier hs-type">Fail</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#FFail"><span class="hs-identifier hs-var">FFail</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Done_"><span class="hs-identifier hs-type">Done_</span></a></span><span> </span><span id="local-6989586621682090282"><span class="annot"><span class="annottext">CCDone Term
</span><a href="#local-6989586621682090282"><span class="hs-identifier hs-var">done</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CCDone Term -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#FDone"><span class="hs-identifier hs-var">FDone</span></a></span><span> </span><span class="annot"><span class="annottext">CCDone Term
</span><a href="#local-6989586621682090282"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090285"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090285"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Branches"><span class="hs-identifier hs-type">Branches</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">etaBranch :: forall c. Case c -&gt; Maybe (ConHead, WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#etaBranch"><span class="hs-identifier hs-var">etaBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682090288"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090288"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682090289"><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682090289"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">catchallBranch :: forall c. Case c -&gt; Maybe c
</span><a href="Agda.TypeChecking.CompiledClause.html#catchallBranch"><span class="hs-identifier hs-var">catchallBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682090291"><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682090291"><span class="hs-identifier hs-var">ca</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-385"></span><span>      </span><span class="annot"><span class="annottext">Int
-&gt; [Arg QName]
-&gt; FastCompiledClauses
-&gt; Maybe FastCompiledClauses
-&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#FEta"><span class="hs-identifier hs-var">FEta</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090285"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; [Arg QName]
</span><a href="Agda.Syntax.Internal.html#conFields"><span class="hs-identifier hs-var">conFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090288"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090278"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; CompiledClauses -&gt; FastCompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses -&gt; CompiledClauses
forall c. WithArity c -&gt; c
</span><a href="Agda.TypeChecking.CompiledClause.html#content"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682090289"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090278"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; Maybe CompiledClauses -&gt; Maybe FastCompiledClauses
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682090291"><span class="hs-identifier hs-var">ca</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090294"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090294"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682090295"><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682090295"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; FastCase FastCompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#FCase"><span class="hs-identifier hs-var">FCase</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090294"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Case CompiledClauses -&gt; FastCase FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCase"><span class="hs-identifier hs-var">fastCase</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090278"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682090295"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastCase"><span class="hs-identifier hs-type">fastCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-type">BuiltinEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCase"><span class="hs-identifier hs-type">FastCase</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span>
</span><span id="line-389"></span><span id="fastCase"><span class="annot"><span class="annottext">fastCase :: BuiltinEnv -&gt; Case CompiledClauses -&gt; FastCase FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCase"><span class="hs-identifier hs-var hs-var">fastCase</span></a></span></span><span> </span><span id="local-6989586621682090297"><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Branches"><span class="hs-identifier hs-type">Branches</span></a></span><span> </span><span id="local-6989586621682090298"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090298"><span class="hs-identifier hs-var">proj</span></a></span></span><span> </span><span id="local-6989586621682090299"><span class="annot"><span class="annottext">Map QName (WithArity CompiledClauses)
</span><a href="#local-6989586621682090299"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ConHead, WithArity CompiledClauses)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090300"><span class="annot"><span class="annottext">Map Literal CompiledClauses
</span><a href="#local-6989586621682090300"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span id="local-6989586621682090301"><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682090301"><span class="hs-identifier hs-var">wild</span></a></span></span><span> </span><span id="local-6989586621682090302"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682090302"><span class="hs-identifier hs-var">fT</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FBranches"><span class="hs-identifier hs-type">FBranches</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fprojPatterns :: Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fprojPatterns"><span class="hs-identifier hs-var">fprojPatterns</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090298"><span class="hs-identifier hs-var">proj</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fconBranches :: Map NameId FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fconBranches"><span class="hs-identifier hs-var">fconBranches</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; NameId)
-&gt; Map QName FastCompiledClauses -&gt; Map NameId FastCompiledClauses
forall k1 k2 a. (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeysMonotonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NameId) -&gt; (QName -&gt; Name) -&gt; QName -&gt; NameId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map QName FastCompiledClauses -&gt; Map NameId FastCompiledClauses)
-&gt; Map QName FastCompiledClauses -&gt; Map NameId FastCompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WithArity CompiledClauses -&gt; FastCompiledClauses)
-&gt; Map QName (WithArity CompiledClauses)
-&gt; Map QName FastCompiledClauses
forall a b. (a -&gt; b) -&gt; Map QName a -&gt; Map QName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; (WithArity CompiledClauses -&gt; CompiledClauses)
-&gt; WithArity CompiledClauses
-&gt; FastCompiledClauses
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses -&gt; CompiledClauses
forall c. WithArity c -&gt; c
</span><a href="Agda.TypeChecking.CompiledClause.html#content"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map QName (WithArity CompiledClauses)
-&gt; Map QName (WithArity CompiledClauses)
</span><a href="#local-6989586621682090306"><span class="hs-identifier hs-var">stripSuc</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName (WithArity CompiledClauses)
</span><a href="#local-6989586621682090299"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fsucBranch :: Maybe FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fsucBranch"><span class="hs-identifier hs-var">fsucBranch</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithArity CompiledClauses -&gt; FastCompiledClauses)
-&gt; Maybe (WithArity CompiledClauses) -&gt; Maybe FastCompiledClauses
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; (WithArity CompiledClauses -&gt; CompiledClauses)
-&gt; WithArity CompiledClauses
-&gt; FastCompiledClauses
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses -&gt; CompiledClauses
forall c. WithArity c -&gt; c
</span><a href="Agda.TypeChecking.CompiledClause.html#content"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (WithArity CompiledClauses) -&gt; Maybe FastCompiledClauses)
-&gt; Maybe (WithArity CompiledClauses) -&gt; Maybe FastCompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName
 -&gt; Map QName (WithArity CompiledClauses)
 -&gt; Maybe (WithArity CompiledClauses))
-&gt; Map QName (WithArity CompiledClauses)
-&gt; QName
-&gt; Maybe (WithArity CompiledClauses)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Map QName (WithArity CompiledClauses)
-&gt; Maybe (WithArity CompiledClauses)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Map QName (WithArity CompiledClauses)
</span><a href="#local-6989586621682090299"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Maybe (WithArity CompiledClauses))
-&gt; (ConHead -&gt; QName)
-&gt; ConHead
-&gt; Maybe (WithArity CompiledClauses)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">(ConHead -&gt; Maybe (WithArity CompiledClauses))
-&gt; Maybe ConHead -&gt; Maybe (WithArity CompiledClauses)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bSuc"><span class="hs-identifier hs-var">bSuc</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">flitBranches :: Map Literal FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#flitBranches"><span class="hs-identifier hs-var">flitBranches</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; Map Literal CompiledClauses -&gt; Map Literal FastCompiledClauses
forall a b. (a -&gt; b) -&gt; Map Literal a -&gt; Map Literal b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Literal CompiledClauses
</span><a href="#local-6989586621682090300"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ffallThrough :: Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ffallThrough"><span class="hs-identifier hs-var">ffallThrough</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682090302"><span class="hs-identifier hs-var">fT</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fcatchallBranch :: Maybe FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fcatchallBranch"><span class="hs-identifier hs-var">fcatchallBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; FastCompiledClauses)
-&gt; Maybe CompiledClauses -&gt; Maybe FastCompiledClauses
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinEnv -&gt; CompiledClauses -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastCompiledClauses"><span class="hs-identifier hs-var">fastCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682090301"><span class="hs-identifier hs-var">wild</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621682090306"><span class="annot"><span class="annottext">stripSuc :: Map QName (WithArity CompiledClauses)
-&gt; Map QName (WithArity CompiledClauses)
</span><a href="#local-6989586621682090306"><span class="hs-identifier hs-var hs-var">stripSuc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090311"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090311"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bSuc"><span class="hs-identifier hs-var">bSuc</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090297"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Map QName (WithArity CompiledClauses)
-&gt; Map QName (WithArity CompiledClauses)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090311"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map QName (WithArity CompiledClauses)
-&gt; Map QName (WithArity CompiledClauses)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-pragma hs-type">lookupCon</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-403"></span><span id="local-6989586621682089293"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-identifier hs-type">lookupCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCase"><span class="hs-identifier hs-type">FastCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089293"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682089293"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-404"></span><span id="lookupCon"><span class="annot"><span class="annottext">lookupCon :: forall c. QName -&gt; FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-identifier hs-var hs-var">lookupCon</span></a></span></span><span> </span><span id="local-6989586621682090317"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090317"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FBranches"><span class="hs-identifier hs-type">FBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090318"><span class="annot"><span class="annottext">Map NameId c
</span><a href="#local-6989586621682090318"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe c
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Literal c
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe c
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameId -&gt; Map NameId c -&gt; Maybe c
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NameId) -&gt; Name -&gt; NameId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090317"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NameId c
</span><a href="#local-6989586621682090318"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- QName memo -------------------------------------------------------------</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#memoQName"><span class="hs-pragma hs-type">memoQName</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-409"></span><span id="local-6989586621682089295"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#memoQName"><span class="hs-identifier hs-type">memoQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682089295"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682089295"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-410"></span><span id="memoQName"><span class="annot"><span class="annottext">memoQName :: forall a. (QName -&gt; a) -&gt; QName -&gt; a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#memoQName"><span class="hs-identifier hs-var hs-var">memoQName</span></a></span></span><span> </span><span id="local-6989586621682090329"><span class="annot"><span class="annottext">QName -&gt; a
</span><a href="#local-6989586621682090329"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (QName -&gt; a) -&gt; QName -&gt; a
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (QName -&gt; a) -&gt; QName -&gt; a) -&gt; IO (QName -&gt; a) -&gt; QName -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>  </span><span id="local-6989586621682090330"><span class="annot"><a href="#local-6989586621682090330"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameId a -&gt; IO (IORef (Map NameId a))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Map NameId a
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">unsafePerformIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621682090333"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090330"><span class="hs-identifier hs-type">tbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621682090333"><span class="annot"><span class="annottext">f' :: IORef (Map NameId a) -&gt; QName -&gt; IO a
</span><a href="#local-6989586621682090333"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span id="local-6989586621682090334"><span class="annot"><span class="annottext">IORef (Map NameId a)
</span><a href="#local-6989586621682090334"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span id="local-6989586621682090335"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090335"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682090336"><span class="annot"><span class="annottext">i :: NameId
</span><a href="#local-6989586621682090336"><span class="hs-identifier hs-var hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090335"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>      </span><span id="local-6989586621682090337"><span class="annot"><a href="#local-6989586621682090337"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Map NameId a) -&gt; IO (Map NameId a)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Map NameId a)
</span><a href="#local-6989586621682090334"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621682090336"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090337"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090339"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090339"><span class="hs-identifier hs-var">y</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090339"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682090340"><span class="annot"><span class="annottext">y :: a
</span><a href="#local-6989586621682090340"><span class="hs-identifier hs-var hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; a
</span><a href="#local-6989586621682090329"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090335"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-421"></span><span>          </span><span class="annot"><span class="annottext">IORef (Map NameId a) -&gt; Map NameId a -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Map NameId a)
</span><a href="#local-6989586621682090334"><span class="hs-identifier hs-var">tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameId -&gt; a -&gt; Map NameId a -&gt; Map NameId a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">NameId
</span><a href="#local-6989586621682090336"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090340"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameId a
</span><a href="#local-6989586621682090337"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>          </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090340"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><span class="hs-comment">-- * Fast reduction</span></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="hs-keyword">data</span><span> </span><span id="Normalisation"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Normalisation"><span class="hs-identifier hs-var">Normalisation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WHNF"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#WHNF"><span class="hs-identifier hs-var">WHNF</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="NF"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NF"><span class="hs-identifier hs-var">NF</span></a></span></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682090346"><span id="local-6989586621682090351"><span class="annot"><span class="annottext">Normalisation -&gt; Normalisation -&gt; Bool
(Normalisation -&gt; Normalisation -&gt; Bool)
-&gt; (Normalisation -&gt; Normalisation -&gt; Bool) -&gt; Eq Normalisation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Normalisation -&gt; Normalisation -&gt; Bool
== :: Normalisation -&gt; Normalisation -&gt; Bool
$c/= :: Normalisation -&gt; Normalisation -&gt; Bool
/= :: Normalisation -&gt; Normalisation -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><span class="hs-comment">-- | The entry point to the reduction machine.</span></span><span>
</span><span id="line-430"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce"><span class="hs-identifier hs-type">fastReduce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span id="fastReduce"><span class="annot"><span class="annottext">fastReduce :: Term -&gt; ReduceM (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce"><span class="hs-identifier hs-var hs-var">fastReduce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Normalisation -&gt; Term -&gt; ReduceM (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce%27"><span class="hs-identifier hs-var">fastReduce'</span></a></span><span> </span><span class="annot"><span class="annottext">Normalisation
</span><a href="Agda.TypeChecking.Reduce.Fast.html#WHNF"><span class="hs-identifier hs-var">WHNF</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastNormalise"><span class="hs-identifier hs-type">fastNormalise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-434"></span><span id="fastNormalise"><span class="annot"><span class="annottext">fastNormalise :: Term -&gt; ReduceM Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastNormalise"><span class="hs-identifier hs-var hs-var">fastNormalise</span></a></span></span><span> </span><span id="local-6989586621682090356"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090356"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Term
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Term) -&gt; ReduceM (Blocked Term) -&gt; ReduceM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Normalisation -&gt; Term -&gt; ReduceM (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce%27"><span class="hs-identifier hs-var">fastReduce'</span></a></span><span> </span><span class="annot"><span class="annottext">Normalisation
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NF"><span class="hs-identifier hs-var">NF</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090356"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce%27"><span class="hs-identifier hs-type">fastReduce'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Normalisation"><span class="hs-identifier hs-type">Normalisation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span id="fastReduce%27"><span class="annot"><span class="annottext">fastReduce' :: Normalisation -&gt; Term -&gt; ReduceM (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fastReduce%27"><span class="hs-identifier hs-var hs-var">fastReduce'</span></a></span></span><span> </span><span id="local-6989586621682090358"><span class="annot"><span class="annottext">Normalisation
</span><a href="#local-6989586621682090358"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682090359"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090359"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621682090360"><span class="annot"><a href="#local-6989586621682090360"><span class="hs-identifier hs-var">tcState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReduceM TCState
forall (m :: * -&gt; *). ReadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTCState"><span class="hs-identifier hs-var">getTCState</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682090364"><span class="annot"><a href="#local-6989586621682090364"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682090365"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090365"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090365"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><a href="#local-6989586621682090364"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-comment">-- Gather builtins using 'BuiltinAccess' rather than with the default</span><span>
</span><span id="line-443"></span><span>      </span><span class="hs-comment">-- 'HasBuiltins ReduceM' instance. This increases laziness, allowing us to</span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-comment">-- avoid costly builtin lookups unless needed.</span><span>
</span><span id="line-445"></span><span>      </span><span id="local-6989586621682090366"><span class="annot"><a href="#local-6989586621682090366"><span class="hs-identifier hs-var hs-var">builtinName</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; ConHead) -&gt; Maybe Term -&gt; Maybe ConHead
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ConHead
</span><a href="#local-6989586621682090364"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Term -&gt; Maybe ConHead)
-&gt; (BuiltinId -&gt; Maybe Term) -&gt; BuiltinId -&gt; Maybe ConHead
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; BuiltinAccess (Maybe Term) -&gt; Maybe Term
forall a. TCState -&gt; BuiltinAccess a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Builtin.html#runBuiltinAccess"><span class="hs-identifier hs-var">runBuiltinAccess</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682090360"><span class="hs-identifier hs-var">tcState</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinAccess (Maybe Term) -&gt; Maybe Term)
-&gt; (BuiltinId -&gt; BuiltinAccess (Maybe Term))
-&gt; BuiltinId
-&gt; Maybe Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; BuiltinAccess (Maybe Term)
forall (m :: * -&gt; *). HasBuiltins m =&gt; BuiltinId -&gt; m (Maybe Term)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltin%27"><span class="hs-identifier hs-var">getBuiltin'</span></a></span><span>
</span><span id="line-446"></span><span>      </span><span id="local-6989586621682090369"><span class="annot"><a href="#local-6989586621682090369"><span class="hs-identifier hs-var hs-var">primitiveName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrimFun -&gt; QName) -&gt; Maybe PrimFun -&gt; Maybe QName
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PrimFun -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#primFunName"><span class="hs-identifier hs-var">primFunName</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe PrimFun -&gt; Maybe QName)
-&gt; (PrimitiveId -&gt; Maybe PrimFun) -&gt; PrimitiveId -&gt; Maybe QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; BuiltinAccess (Maybe PrimFun) -&gt; Maybe PrimFun
forall a. TCState -&gt; BuiltinAccess a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Builtin.html#runBuiltinAccess"><span class="hs-identifier hs-var">runBuiltinAccess</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682090360"><span class="hs-identifier hs-var">tcState</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinAccess (Maybe PrimFun) -&gt; Maybe PrimFun)
-&gt; (PrimitiveId -&gt; BuiltinAccess (Maybe PrimFun))
-&gt; PrimitiveId
-&gt; Maybe PrimFun
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; BuiltinAccess (Maybe PrimFun)
forall (m :: * -&gt; *).
HasBuiltins m =&gt;
PrimitiveId -&gt; m (Maybe PrimFun)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getPrimitive%27"><span class="hs-identifier hs-var">getPrimitive'</span></a></span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span>      </span><span id="local-6989586621682090372"><span class="annot"><a href="#local-6989586621682090372"><span class="hs-identifier hs-var hs-var">zero</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Maybe ConHead
</span><a href="#local-6989586621682090366"><span class="hs-identifier hs-var">builtinName</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinZero"><span class="hs-identifier hs-var">builtinZero</span></a></span><span>
</span><span id="line-449"></span><span>      </span><span id="local-6989586621682090374"><span class="annot"><a href="#local-6989586621682090374"><span class="hs-identifier hs-var hs-var">suc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Maybe ConHead
</span><a href="#local-6989586621682090366"><span class="hs-identifier hs-var">builtinName</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinSuc"><span class="hs-identifier hs-var">builtinSuc</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span id="local-6989586621682090376"><span class="annot"><a href="#local-6989586621682090376"><span class="hs-identifier hs-var hs-var">true</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Maybe ConHead
</span><a href="#local-6989586621682090366"><span class="hs-identifier hs-var">builtinName</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinTrue"><span class="hs-identifier hs-var">builtinTrue</span></a></span><span>
</span><span id="line-451"></span><span>      </span><span id="local-6989586621682090378"><span class="annot"><a href="#local-6989586621682090378"><span class="hs-identifier hs-var hs-var">false</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Maybe ConHead
</span><a href="#local-6989586621682090366"><span class="hs-identifier hs-var">builtinName</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinFalse"><span class="hs-identifier hs-var">builtinFalse</span></a></span><span>
</span><span id="line-452"></span><span>      </span><span id="local-6989586621682090380"><span class="annot"><a href="#local-6989586621682090380"><span class="hs-identifier hs-var hs-var">refl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Maybe ConHead
</span><a href="#local-6989586621682090366"><span class="hs-identifier hs-var">builtinName</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinRefl"><span class="hs-identifier hs-var">builtinRefl</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>      </span><span id="local-6989586621682090382"><span class="annot"><a href="#local-6989586621682090382"><span class="hs-identifier hs-var hs-var">force</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; Maybe QName
</span><a href="#local-6989586621682090369"><span class="hs-identifier hs-var">primitiveName</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimForce"><span class="hs-identifier hs-var">PrimForce</span></a></span><span>
</span><span id="line-455"></span><span>      </span><span id="local-6989586621682090384"><span class="annot"><a href="#local-6989586621682090384"><span class="hs-identifier hs-var hs-var">erase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; Maybe QName
</span><a href="#local-6989586621682090369"><span class="hs-identifier hs-var">primitiveName</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimErase"><span class="hs-identifier hs-var">PrimErase</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>      </span><span id="local-6989586621682090386"><span class="annot"><a href="#local-6989586621682090386"><span class="hs-identifier hs-var hs-var">bEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-type">BuiltinEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bZero :: Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bZero"><span class="hs-identifier hs-var">bZero</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090372"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bSuc :: Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bSuc"><span class="hs-identifier hs-var">bSuc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090374"><span class="hs-identifier hs-var">suc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bTrue :: Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bTrue"><span class="hs-identifier hs-var">bTrue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090376"><span class="hs-identifier hs-var">true</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bFalse :: Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bFalse"><span class="hs-identifier hs-var">bFalse</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090378"><span class="hs-identifier hs-var">false</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bRefl :: Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bRefl"><span class="hs-identifier hs-var">bRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090380"><span class="hs-identifier hs-var">refl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-458"></span><span>                          </span><span class="annot"><span class="annottext">bPrimForce :: Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bPrimForce"><span class="hs-identifier hs-var">bPrimForce</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682090382"><span class="hs-identifier hs-var">force</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bPrimErase :: Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bPrimErase"><span class="hs-identifier hs-var">bPrimErase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682090384"><span class="hs-identifier hs-var">erase</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621682090387"><span class="annot"><a href="#local-6989586621682090387"><span class="hs-identifier hs-var">rwr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier hs-type">optRewriting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span id="local-6989586621682090390"><span class="annot"><a href="#local-6989586621682090390"><span class="hs-identifier hs-var">constInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#unKleisli"><span class="hs-identifier hs-type">unKleisli</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682090392"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090392"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621682090393"><span class="annot"><a href="#local-6989586621682090393"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ReduceM Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090392"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621682090395"><span class="annot"><a href="#local-6989586621682090395"><span class="hs-identifier hs-var">rewr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682090387"><span class="hs-identifier hs-type">rwr</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#instantiateRewriteRules"><span class="hs-identifier hs-type">instantiateRewriteRules</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getRewriteRulesFor"><span class="hs-identifier hs-type">getRewriteRulesFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090392"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-463"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#compactDef"><span class="hs-identifier hs-type">compactDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090386"><span class="hs-identifier hs-type">bEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090393"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090395"><span class="hs-identifier hs-type">rewr</span></a></span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682090399"><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090399"><span class="hs-identifier hs-var">redEnv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceEnv
-&gt; BuiltinEnv
-&gt; (QName -&gt; CompactDef)
-&gt; Normalisation
-&gt; Term
-&gt; Blocked Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#reduceTm"><span class="hs-identifier hs-var">reduceTm</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090399"><span class="hs-identifier hs-var">redEnv</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090386"><span class="hs-identifier hs-var">bEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; CompactDef) -&gt; QName -&gt; CompactDef
forall a. (QName -&gt; a) -&gt; QName -&gt; a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#memoQName"><span class="hs-identifier hs-var">memoQName</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090390"><span class="hs-identifier hs-var">constInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalisation
</span><a href="#local-6989586621682090358"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090359"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><span class="hs-comment">-- * Closures</span></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-comment">-- | The abstract machine represents terms as closures containing a 'Term', an environment, and a</span><span>
</span><span id="line-470"></span><span class="hs-comment">--   spine of eliminations. Note that the environment doesn't necessarily bind all variables in the</span><span>
</span><span id="line-471"></span><span class="hs-comment">--   term. The variables in the context in which the abstract machine is started are free in</span><span>
</span><span id="line-472"></span><span class="hs-comment">--   closures. The 'IsValue' argument tracks whether the closure is in weak-head normal form.</span><span>
</span><span id="line-473"></span><span class="hs-keyword">data</span><span> </span><span id="Closure"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span></span><span> </span><span id="local-6989586621682089334"><span class="annot"><a href="#local-6989586621682089334"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Closure"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IsValue"><span class="hs-identifier hs-type">IsValue</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089334"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089334"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>                 </span><span class="hs-comment">-- ^ The environment applies to the 'Term' argument. The spine contains closures</span><span>
</span><span id="line-475"></span><span>                 </span><span class="hs-comment">--   with their own environments.</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">-- | Used to track if a closure is @Unevaluated@ or a @Value@ (in weak-head normal form), and if so</span><span>
</span><span id="line-478"></span><span class="hs-comment">--   why it cannot reduce further.</span><span>
</span><span id="line-479"></span><span class="hs-keyword">data</span><span> </span><span id="IsValue"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IsValue"><span class="hs-identifier hs-var">IsValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Value"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Unevaled"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><span class="hs-comment">-- | The spine is a list of eliminations. Application eliminations contain pointers.</span></span><span>
</span><span id="line-482"></span><span class="hs-keyword">type</span><span> </span><span id="Spine"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-var">Spine</span></a></span></span><span> </span><span id="local-6989586621682090404"><span class="annot"><a href="#local-6989586621682090404"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090404"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span id="local-6989586621682089326"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#isValue"><span class="hs-identifier hs-type">isValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089326"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IsValue"><span class="hs-identifier hs-type">IsValue</span></a></span></span><span>
</span><span id="line-485"></span><span id="isValue"><span class="annot"><span class="annottext">isValue :: forall s. Closure s -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#isValue"><span class="hs-identifier hs-var hs-var">isValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621682090406"><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090406"><span class="hs-identifier hs-var">isV</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090406"><span class="hs-identifier hs-var">isV</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span id="local-6989586621682089332"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#setIsValue"><span class="hs-identifier hs-type">setIsValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IsValue"><span class="hs-identifier hs-type">IsValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089332"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089332"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-488"></span><span id="setIsValue"><span class="annot"><span class="annottext">setIsValue :: forall s. IsValue -&gt; Closure s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#setIsValue"><span class="hs-identifier hs-var hs-var">setIsValue</span></a></span></span><span> </span><span id="local-6989586621682090408"><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090408"><span class="hs-identifier hs-var">isV</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090409"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090409"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682090410"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090410"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682090411"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090411"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090408"><span class="hs-identifier hs-var">isV</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090409"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090410"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090411"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-comment">-- | Apply a closure to a spine of eliminations. Note that this does not preserve the 'IsValue'</span><span>
</span><span id="line-491"></span><span class="hs-comment">--   field.</span><span>
</span><span id="line-492"></span><span id="local-6989586621682089335"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#clApply"><span class="hs-identifier hs-type">clApply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089335"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089335"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089335"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-493"></span><span id="clApply"><span class="annot"><span class="annottext">clApply :: forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply"><span class="hs-identifier hs-var hs-var">clApply</span></a></span></span><span> </span><span id="local-6989586621682090415"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090415"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090415"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-494"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#clApply"><span class="hs-identifier hs-var">clApply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090416"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090416"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682090417"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090417"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682090418"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090418"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682090419"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090419"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090416"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090417"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090418"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090419"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">-- | Apply a closure to a spine, preserving the 'IsValue' field. Use with care, since usually</span><span>
</span><span id="line-497"></span><span class="hs-comment">--   eliminations do not preserve the value status.</span><span>
</span><span id="line-498"></span><span id="local-6989586621682090420"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#clApply_"><span class="hs-identifier hs-type">clApply_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090420"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090420"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090420"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-499"></span><span id="clApply_"><span class="annot"><span class="annottext">clApply_ :: forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply_"><span class="hs-identifier hs-var hs-var">clApply_</span></a></span></span><span> </span><span id="local-6989586621682090423"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090423"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090423"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-500"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#clApply_"><span class="hs-identifier hs-var">clApply_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621682090424"><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090424"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682090425"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090425"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682090426"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090426"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682090427"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090427"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682090428"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090428"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090424"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090425"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090426"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090427"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090428"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><span class="hs-comment">-- * Pointers and thunks</span></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><span class="hs-comment">-- | Spines and environments contain pointers to closures to enable call-by-need evaluation.</span></span><span>
</span><span id="line-505"></span><span class="hs-keyword">data</span><span> </span><span id="Pointer"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-var">Pointer</span></a></span></span><span> </span><span id="local-6989586621682089373"><span class="annot"><a href="#local-6989586621682089373"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Pure"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089373"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>                 </span><span class="hs-comment">-- ^ Not a pointer. Used for closures that do not need to be shared to avoid</span><span>
</span><span id="line-507"></span><span>                 </span><span class="hs-comment">--   unnecessary updates.</span><span>
</span><span id="line-508"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="Pointer"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-var">Pointer</span></a></span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-type">STPointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089373"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>                 </span><span class="hs-comment">-- ^ An actual pointer is an 'STRef' to a 'Thunk'. The thunk is set to 'BlackHole'</span><span>
</span><span id="line-510"></span><span>                 </span><span class="hs-comment">--   during the evaluation of its contents to make debugging loops easier.</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-keyword">type</span><span> </span><span id="STPointer"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-var">STPointer</span></a></span></span><span> </span><span id="local-6989586621682090433"><span class="annot"><a href="#local-6989586621682090433"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621682090433"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090433"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><span class="hs-comment">-- | A thunk is either a black hole or contains a value.</span></span><span>
</span><span id="line-515"></span><span class="hs-keyword">data</span><span> </span><span id="Thunk"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span></span><span> </span><span id="local-6989586621682089347"><span class="annot"><a href="#local-6989586621682089347"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BlackHole"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Thunk"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621682089347"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682090435"><span id="local-6989586621682090437"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Thunk a -&gt; Thunk b)
-&gt; (forall a b. a -&gt; Thunk b -&gt; Thunk a) -&gt; Functor Thunk
forall a b. a -&gt; Thunk b -&gt; Thunk a
forall a b. (a -&gt; b) -&gt; Thunk a -&gt; Thunk b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Thunk a -&gt; Thunk b
fmap :: forall a b. (a -&gt; b) -&gt; Thunk a -&gt; Thunk b
$c&lt;$ :: forall a b. a -&gt; Thunk b -&gt; Thunk a
&lt;$ :: forall a b. a -&gt; Thunk b -&gt; Thunk a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span id="local-6989586621682089342"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer"><span class="hs-identifier hs-type">derefPointer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089342"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089342"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089342"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-519"></span><span id="derefPointer"><span class="annot"><span class="annottext">derefPointer :: forall s. Pointer s -&gt; ST s (Thunk (Closure s))
</span><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer"><span class="hs-identifier hs-var hs-var">derefPointer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621682090444"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090444"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Thunk (Closure s) -&gt; ST s (Thunk (Closure s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Thunk (Closure s)
forall a. a -&gt; Thunk a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090444"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer"><span class="hs-identifier hs-var">derefPointer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span id="local-6989586621682090445"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090445"><span class="hs-identifier hs-var">ptr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; ST s (Thunk (Closure s))
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090445"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><span class="hs-comment">-- | In most cases pointers that we dereference do not contain black holes.</span></span><span>
</span><span id="line-523"></span><span id="local-6989586621682089352"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer_"><span class="hs-identifier hs-type">derefPointer_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089352"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089352"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089352"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-524"></span><span id="derefPointer_"><span class="annot"><span class="annottext">derefPointer_ :: forall s. Pointer s -&gt; ST s (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer_"><span class="hs-identifier hs-var hs-var">derefPointer_</span></a></span></span><span> </span><span id="local-6989586621682090452"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090452"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><span class="annottext">Pointer s -&gt; ST s (Thunk (Closure s))
forall s. Pointer s -&gt; ST s (Thunk (Closure s))
</span><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer"><span class="hs-identifier hs-var">derefPointer</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090452"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (Thunk (Closure s))
-&gt; (Thunk (Closure s) -&gt; Closure s) -&gt; ST s (Closure s)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span id="local-6989586621682090453"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090453"><span class="hs-identifier hs-var">cl</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090453"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">Thunk (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="annot"><span class="hs-comment">-- | Only use for debug printing!</span></span><span>
</span><span id="line-531"></span><span id="local-6989586621682089355"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#unsafeDerefPointer"><span class="hs-identifier hs-type">unsafeDerefPointer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089355"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089355"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-532"></span><span id="unsafeDerefPointer"><span class="annot"><span class="annottext">unsafeDerefPointer :: forall s. Pointer s -&gt; Thunk (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unsafeDerefPointer"><span class="hs-identifier hs-var hs-var">unsafeDerefPointer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621682090455"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090455"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Thunk (Closure s)
forall a. a -&gt; Thunk a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090455"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-533"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#unsafeDerefPointer"><span class="hs-identifier hs-var">unsafeDerefPointer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span id="local-6989586621682090456"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090456"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Thunk (Closure s)) -&gt; Thunk (Closure s)
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ST s (Thunk (Closure s)) -&gt; IO (Thunk (Closure s))
forall s a. ST s a -&gt; IO a
</span><span class="hs-identifier hs-var">unsafeSTToIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STPointer s -&gt; ST s (Thunk (Closure s))
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090456"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span id="local-6989586621682089359"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#readPointer"><span class="hs-identifier hs-type">readPointer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-type">STPointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089359"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089359"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089359"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-536"></span><span id="readPointer"><span class="annot"><span class="annottext">readPointer :: forall s. STPointer s -&gt; ST s (Thunk (Closure s))
</span><a href="Agda.TypeChecking.Reduce.Fast.html#readPointer"><span class="hs-identifier hs-var hs-var">readPointer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRef s (Thunk (Closure s)) -&gt; ST s (Thunk (Closure s))
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span id="local-6989586621682089361"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#storePointer"><span class="hs-identifier hs-type">storePointer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-type">STPointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089361"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089361"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089361"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-539"></span><span id="storePointer"><span class="annot"><span class="annottext">storePointer :: forall s. STPointer s -&gt; Closure s -&gt; ST s ()
</span><a href="Agda.TypeChecking.Reduce.Fast.html#storePointer"><span class="hs-identifier hs-var hs-var">storePointer</span></a></span></span><span> </span><span id="local-6989586621682090459"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090459"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682090460"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090460"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; Thunk (Closure s) -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090459"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Thunk (Closure s)
forall a. a -&gt; Thunk a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090460"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-comment">-- Note the strict match. To prevent leaking memory in case of unnecessary updates.</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span id="local-6989586621682089365"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#blackHole"><span class="hs-identifier hs-type">blackHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-type">STPointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089365"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089365"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-543"></span><span id="blackHole"><span class="annot"><span class="annottext">blackHole :: forall s. STPointer s -&gt; ST s ()
</span><a href="Agda.TypeChecking.Reduce.Fast.html#blackHole"><span class="hs-identifier hs-var hs-var">blackHole</span></a></span></span><span> </span><span id="local-6989586621682090463"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090463"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; Thunk (Closure s) -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682090463"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Thunk (Closure s)
forall a. Thunk a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-comment">-- | Create a thunk. If the closure is a naked variable we can reuse the pointer from the</span><span>
</span><span id="line-546"></span><span class="hs-comment">--   environment to avoid creating long pointer chains.</span><span>
</span><span id="line-547"></span><span id="local-6989586621682089367"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#createThunk"><span class="hs-identifier hs-type">createThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089367"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089367"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089367"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-548"></span><span id="createThunk"><span class="annot"><span class="annottext">createThunk :: forall s. Closure s -&gt; ST s (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#createThunk"><span class="hs-identifier hs-var hs-var">createThunk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682090470"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090470"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682090471"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090471"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682090472"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090472"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090472"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090473"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090473"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Env s -&gt; Maybe (Pointer s)
forall s. Int -&gt; Env s -&gt; Maybe (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv"><span class="hs-identifier hs-var">lookupEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090470"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090471"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; ST s (Pointer s)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090473"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-550"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#createThunk"><span class="hs-identifier hs-var">createThunk</span></a></span><span> </span><span id="local-6989586621682090475"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090475"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; Pointer s
forall s. STPointer s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-var">Pointer</span></a></span><span> </span><span class="annot"><span class="annottext">(STPointer s -&gt; Pointer s)
-&gt; ST s (STPointer s) -&gt; ST s (Pointer s)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Thunk (Closure s) -&gt; ST s (STPointer s)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Thunk (Closure s)
forall a. a -&gt; Thunk a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090475"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><span class="hs-comment">-- | Create a thunk that is not shared or updated.</span></span><span>
</span><span id="line-553"></span><span id="local-6989586621682089376"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-type">pureThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089376"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089376"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-554"></span><span id="pureThunk"><span class="annot"><span class="annottext">pureThunk :: forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var hs-var">pureThunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><span class="hs-comment">-- * Environments</span></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><span class="hs-comment">-- | The environment of a closure binds pointers to deBruijn indicies.</span></span><span>
</span><span id="line-559"></span><span class="hs-keyword">newtype</span><span> </span><span id="Env"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span id="local-6989586621682089380"><span class="annot"><a href="#local-6989586621682089380"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089380"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span id="local-6989586621682089378"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-type">emptyEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089378"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-562"></span><span id="emptyEnv"><span class="annot"><span class="annottext">emptyEnv :: forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var hs-var">emptyEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pointer s] -&gt; Env s
forall s. [Pointer s] -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-563"></span><span class="hs-comment">--UNUSED Liang-Ting Chen 2019-07-16</span><span>
</span><span id="line-564"></span><span class="hs-comment">--isEmptyEnv :: Env s -&gt; Bool</span><span>
</span><span id="line-565"></span><span class="hs-comment">--isEmptyEnv (Env xs) = null xs</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span id="local-6989586621682089381"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#envSize"><span class="hs-identifier hs-type">envSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089381"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-568"></span><span id="envSize"><span class="annot"><span class="annottext">envSize :: forall s. Env s -&gt; Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#envSize"><span class="hs-identifier hs-var hs-var">envSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span id="local-6989586621682090482"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090482"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pointer s] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090482"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span id="local-6989586621682089385"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#envToList"><span class="hs-identifier hs-type">envToList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089385"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-571"></span><span id="envToList"><span class="annot"><span class="annottext">envToList :: forall s. Env s -&gt; [Pointer s]
</span><a href="Agda.TypeChecking.Reduce.Fast.html#envToList"><span class="hs-identifier hs-var hs-var">envToList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span id="local-6989586621682090485"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090485"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090485"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span id="local-6989586621682089387"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-identifier hs-type">extendEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089387"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089387"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089387"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-574"></span><span id="extendEnv"><span class="annot"><span class="annottext">extendEnv :: forall s. Pointer s -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-identifier hs-var hs-var">extendEnv</span></a></span></span><span> </span><span id="local-6989586621682090487"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090487"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span id="local-6989586621682090488"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090488"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pointer s] -&gt; Env s
forall s. [Pointer s] -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090487"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; [Pointer s] -&gt; [Pointer s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090488"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><span class="hs-comment">-- | Unsafe.</span></span><span>
</span><span id="line-577"></span><span id="local-6989586621682089389"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv_"><span class="hs-identifier hs-type">lookupEnv_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089389"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089389"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-578"></span><span id="lookupEnv_"><span class="annot"><span class="annottext">lookupEnv_ :: forall s. Int -&gt; Env s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv_"><span class="hs-identifier hs-var hs-var">lookupEnv_</span></a></span></span><span> </span><span id="local-6989586621682090492"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090492"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span id="local-6989586621682090493"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090493"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; [Pointer s] -&gt; Int -&gt; Pointer s
forall a. a -&gt; [a] -&gt; Int -&gt; a
</span><a href="Agda.Utils.List.html#indexWithDefault"><span class="hs-identifier hs-var">indexWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682090493"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090492"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="hs-comment">-- Andreas, 2018-11-12, which isn't this just Agda.Utils.List.!!! ?</span><span>
</span><span id="line-581"></span><span id="local-6989586621682089372"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv"><span class="hs-identifier hs-type">lookupEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089372"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089372"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-582"></span><span id="lookupEnv"><span class="annot"><span class="annottext">lookupEnv :: forall s. Int -&gt; Env s -&gt; Maybe (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv"><span class="hs-identifier hs-var hs-var">lookupEnv</span></a></span></span><span> </span><span id="local-6989586621682090497"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090497"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682090498"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090498"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090497"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090499"><span class="hs-identifier hs-var">n</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Maybe (Pointer s)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Env s -&gt; Pointer s
forall s. Int -&gt; Env s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv_"><span class="hs-identifier hs-var">lookupEnv_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090497"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090498"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Pointer s)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682090499"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682090499"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Int
forall s. Env s -&gt; Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#envSize"><span class="hs-identifier hs-var">envSize</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090498"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span class="annot"><span class="hs-comment">-- * The Agda Abstract Machine</span></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">-- | The abstract machine state has two states 'Eval' and 'Match' that determine what the machine is</span><span>
</span><span id="line-589"></span><span class="hs-comment">--   currently working on: evaluating a closure in the Eval state and matching a spine against a</span><span>
</span><span id="line-590"></span><span class="hs-comment">--   case tree in the Match state. Both states contain a 'ControlStack' of continuations for what to</span><span>
</span><span id="line-591"></span><span class="hs-comment">--   do next. The heap is maintained implicitly using 'STRef's, hence the @s@ parameter.</span><span>
</span><span id="line-592"></span><span class="hs-keyword">data</span><span> </span><span id="AM"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-var">AM</span></a></span></span><span> </span><span id="local-6989586621682089460"><span class="annot"><a href="#local-6989586621682089460"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Eval"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>            </span><span class="hs-comment">-- ^ Evaluate the given closure (the focus) to weak-head normal form. If the 'IsValue'</span><span>
</span><span id="line-594"></span><span>            </span><span class="hs-comment">--   field of the closure is 'Value' we look at the control stack for what to do. Being</span><span>
</span><span id="line-595"></span><span>            </span><span class="hs-comment">--   strict in the control stack is important! We can spend a lot of steps with</span><span>
</span><span id="line-596"></span><span>            </span><span class="hs-comment">--   unevaluated closures (where we update, but don't look at the control stack). For</span><span>
</span><span id="line-597"></span><span>            </span><span class="hs-comment">--   instance, long chains of 'suc' constructors.</span><span>
</span><span id="line-598"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="Match"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>            </span><span class="hs-comment">-- ^ @Match f cc spine stack ctrl@ Match the arguments @spine@ against the case tree</span><span>
</span><span id="line-600"></span><span>            </span><span class="hs-comment">--   @cc@. The match stack contains a (possibly empty) list of 'Catchall' frames and a</span><span>
</span><span id="line-601"></span><span>            </span><span class="hs-comment">--   closure to return in case of a stuck match.</span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="hs-comment">-- | The control stack contains a list of continuations, i.e. what to do with</span><span>
</span><span id="line-604"></span><span class="hs-comment">--   the result of the current focus.</span><span>
</span><span id="line-605"></span><span class="hs-keyword">type</span><span> </span><span id="ControlStack"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-var">ControlStack</span></a></span></span><span> </span><span id="local-6989586621682090504"><span class="annot"><a href="#local-6989586621682090504"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlFrame"><span class="hs-identifier hs-type">ControlFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090504"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="hs-comment">-- | The control stack for matching. Contains a list of CatchallFrame's and the closure to return in</span><span>
</span><span id="line-608"></span><span class="hs-comment">--   case of a stuck match.</span><span>
</span><span id="line-609"></span><span class="hs-keyword">data</span><span> </span><span id="MatchStack"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-var">MatchStack</span></a></span></span><span> </span><span id="local-6989586621682089397"><span class="annot"><a href="#local-6989586621682089397"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CatchallFrame"><span class="hs-identifier hs-type">CatchallFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089397"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span> </span><span id="%3A%3E"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-var">:&gt;</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089397"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-610"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">2</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3E%3A"><span class="hs-operator hs-type">&gt;:</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span id="local-6989586621682089393"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3E%3A"><span class="hs-operator hs-type">(&gt;:)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CatchallFrame"><span class="hs-identifier hs-type">CatchallFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089393"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089393"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089393"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-613"></span><span id="%3E%3A"><span class="annot"><span class="annottext">&gt;: :: forall s. CatchallFrame s -&gt; MatchStack s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3E%3A"><span class="hs-operator hs-var hs-var">(&gt;:)</span></a></span></span><span> </span><span id="local-6989586621682090507"><span class="annot"><span class="annottext">CatchallFrame s
</span><a href="#local-6989586621682090507"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682090508"><span class="annot"><span class="annottext">[CatchallFrame s]
</span><a href="#local-6989586621682090508"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span> </span><span id="local-6989586621682090509"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090509"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CatchallFrame s
</span><a href="#local-6989586621682090507"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CatchallFrame s -&gt; [CatchallFrame s] -&gt; [CatchallFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s]
</span><a href="#local-6989586621682090508"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
forall s. [CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-var">:&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682090509"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-614"></span><span class="hs-comment">-- Previously written as:</span><span>
</span><span id="line-615"></span><span class="hs-comment">--   c &gt;: cs :&gt; cl = c : cs :&gt; cl</span><span>
</span><span id="line-616"></span><span class="hs-comment">--</span><span>
</span><span id="line-617"></span><span class="hs-comment">-- However, some versions/tools fail to parse infix data constructors properly.</span><span>
</span><span id="line-618"></span><span class="hs-comment">-- For example, stylish-haskell@0.9.2.1 fails with the following error:</span><span>
</span><span id="line-619"></span><span class="hs-comment">--   Language.Haskell.Stylish.Parse.parseModule: could not parse</span><span>
</span><span id="line-620"></span><span class="hs-comment">--   src/full/Agda/TypeChecking/Reduce/Fast.hs: ParseFailed (SrcLoc</span><span>
</span><span id="line-621"></span><span class="hs-comment">--   &quot;&lt;unknown&gt;.hs&quot; 625 1) &quot;Parse error in pattern: &quot;</span><span>
</span><span id="line-622"></span><span class="hs-comment">--</span><span>
</span><span id="line-623"></span><span class="hs-comment">-- See https://ghc.haskell.org/trac/ghc/ticket/10018 which may be related.</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="hs-keyword">data</span><span> </span><span id="CatchallFrame"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CatchallFrame"><span class="hs-identifier hs-var">CatchallFrame</span></a></span></span><span> </span><span id="local-6989586621682089596"><span class="annot"><a href="#local-6989586621682089596"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Catchall"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Catchall"><span class="hs-identifier hs-var">Catchall</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089596"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>                        </span><span class="hs-comment">-- ^ @Catchall cc spine@. Case trees are not fully expanded, that is,</span><span>
</span><span id="line-627"></span><span>                        </span><span class="hs-comment">--   inner matches can be partial and covered by a catch-all at a higher</span><span>
</span><span id="line-628"></span><span>                        </span><span class="hs-comment">--   level. This catch-all is represented on the match stack as a</span><span>
</span><span id="line-629"></span><span>                        </span><span class="hs-comment">--   @Catchall@. @cc@ is the case tree in the catch-all case and @spine@ is</span><span>
</span><span id="line-630"></span><span>                        </span><span class="hs-comment">--   the value of the pattern variables at the point of the catch-all.</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="hs-comment">-- An Elim' with a hole.</span><span>
</span><span id="line-633"></span><span class="hs-keyword">data</span><span> </span><span id="ElimZipper"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ElimZipper"><span class="hs-identifier hs-var">ElimZipper</span></a></span></span><span> </span><span id="local-6989586621682089450"><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ApplyCxt"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyCxt"><span class="hs-identifier hs-var">ApplyCxt</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span>
</span><span id="line-634"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="IApplyType"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyType"><span class="hs-identifier hs-var">IApplyType</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="IApplyFst"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyFst"><span class="hs-identifier hs-var">IApplyFst</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="IApplySnd"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplySnd"><span class="hs-identifier hs-var">IApplySnd</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089450"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682090516"><span id="local-6989586621682090528"><span class="annot"><span class="annottext">ElimZipper a -&gt; ElimZipper a -&gt; Bool
(ElimZipper a -&gt; ElimZipper a -&gt; Bool)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; Bool) -&gt; Eq (ElimZipper a)
forall a. Eq a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
== :: ElimZipper a -&gt; ElimZipper a -&gt; Bool
$c/= :: forall a. Eq a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
/= :: ElimZipper a -&gt; ElimZipper a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682090536"><span id="local-6989586621682090546"><span id="local-6989586621682090550"><span id="local-6989586621682090553"><span id="local-6989586621682090556"><span id="local-6989586621682090559"><span id="local-6989586621682090562"><span class="annot"><span class="annottext">Eq (ElimZipper a)
Eq (ElimZipper a) =&gt;
(ElimZipper a -&gt; ElimZipper a -&gt; Ordering)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; Bool)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; Bool)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; Bool)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; Bool)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a)
-&gt; (ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a)
-&gt; Ord (ElimZipper a)
ElimZipper a -&gt; ElimZipper a -&gt; Bool
ElimZipper a -&gt; ElimZipper a -&gt; Ordering
ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (ElimZipper a)
forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Ordering
forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a
$ccompare :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Ordering
compare :: ElimZipper a -&gt; ElimZipper a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
&lt; :: ElimZipper a -&gt; ElimZipper a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
&lt;= :: ElimZipper a -&gt; ElimZipper a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
&gt; :: ElimZipper a -&gt; ElimZipper a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; Bool
&gt;= :: ElimZipper a -&gt; ElimZipper a -&gt; Bool
$cmax :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a
max :: ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a
$cmin :: forall a. Ord a =&gt; ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a
min :: ElimZipper a -&gt; ElimZipper a -&gt; ElimZipper a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682090568"><span id="local-6989586621682090582"><span id="local-6989586621682090586"><span class="annot"><span class="annottext">Int -&gt; ElimZipper a -&gt; ShowS
[ElimZipper a] -&gt; ShowS
ElimZipper a -&gt; VerboseKey
(Int -&gt; ElimZipper a -&gt; ShowS)
-&gt; (ElimZipper a -&gt; VerboseKey)
-&gt; ([ElimZipper a] -&gt; ShowS)
-&gt; Show (ElimZipper a)
forall a. Show a =&gt; Int -&gt; ElimZipper a -&gt; ShowS
forall a. Show a =&gt; [ElimZipper a] -&gt; ShowS
forall a. Show a =&gt; ElimZipper a -&gt; VerboseKey
forall a.
(Int -&gt; a -&gt; ShowS)
-&gt; (a -&gt; VerboseKey) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; ElimZipper a -&gt; ShowS
showsPrec :: Int -&gt; ElimZipper a -&gt; ShowS
$cshow :: forall a. Show a =&gt; ElimZipper a -&gt; VerboseKey
show :: ElimZipper a -&gt; VerboseKey
$cshowList :: forall a. Show a =&gt; [ElimZipper a] -&gt; ShowS
showList :: [ElimZipper a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682090591"><span id="local-6989586621682090593"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; ElimZipper a -&gt; ElimZipper b)
-&gt; (forall a b. a -&gt; ElimZipper b -&gt; ElimZipper a)
-&gt; Functor ElimZipper
forall a b. a -&gt; ElimZipper b -&gt; ElimZipper a
forall a b. (a -&gt; b) -&gt; ElimZipper a -&gt; ElimZipper b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; ElimZipper a -&gt; ElimZipper b
fmap :: forall a b. (a -&gt; b) -&gt; ElimZipper a -&gt; ElimZipper b
$c&lt;$ :: forall a b. a -&gt; ElimZipper b -&gt; ElimZipper a
&lt;$ :: forall a b. a -&gt; ElimZipper b -&gt; ElimZipper a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682090596"><span id="local-6989586621682090602"><span id="local-6989586621682090609"><span id="local-6989586621682090614"><span id="local-6989586621682090616"><span id="local-6989586621682090619"><span id="local-6989586621682090622"><span id="local-6989586621682090625"><span id="local-6989586621682090628"><span id="local-6989586621682090631"><span id="local-6989586621682090634"><span id="local-6989586621682090636"><span id="local-6989586621682090639"><span id="local-6989586621682090644"><span id="local-6989586621682090649"><span id="local-6989586621682090654"><span id="local-6989586621682090659"><span class="annot"><span class="annottext">(forall m. Monoid m =&gt; ElimZipper m -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a)
-&gt; (forall a. ElimZipper a -&gt; [a])
-&gt; (forall a. ElimZipper a -&gt; Bool)
-&gt; (forall a. ElimZipper a -&gt; Int)
-&gt; (forall a. Eq a =&gt; a -&gt; ElimZipper a -&gt; Bool)
-&gt; (forall a. Ord a =&gt; ElimZipper a -&gt; a)
-&gt; (forall a. Ord a =&gt; ElimZipper a -&gt; a)
-&gt; (forall a. Num a =&gt; ElimZipper a -&gt; a)
-&gt; (forall a. Num a =&gt; ElimZipper a -&gt; a)
-&gt; Foldable ElimZipper
forall a. Eq a =&gt; a -&gt; ElimZipper a -&gt; Bool
forall a. Num a =&gt; ElimZipper a -&gt; a
forall a. Ord a =&gt; ElimZipper a -&gt; a
forall m. Monoid m =&gt; ElimZipper m -&gt; m
forall a. ElimZipper a -&gt; Bool
forall a. ElimZipper a -&gt; Int
forall a. ElimZipper a -&gt; [a]
forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
forall (t :: * -&gt; *).
(forall m. Monoid m =&gt; t m -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a)
-&gt; (forall a. t a -&gt; [a])
-&gt; (forall a. t a -&gt; Bool)
-&gt; (forall a. t a -&gt; Int)
-&gt; (forall a. Eq a =&gt; a -&gt; t a -&gt; Bool)
-&gt; (forall a. Ord a =&gt; t a -&gt; a)
-&gt; (forall a. Ord a =&gt; t a -&gt; a)
-&gt; (forall a. Num a =&gt; t a -&gt; a)
-&gt; (forall a. Num a =&gt; t a -&gt; a)
-&gt; Foldable t
$cfold :: forall m. Monoid m =&gt; ElimZipper m -&gt; m
fold :: forall m. Monoid m =&gt; ElimZipper m -&gt; m
$cfoldMap :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m
foldMap :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m
$cfoldMap' :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m
foldMap' :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ElimZipper a -&gt; m
$cfoldr :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
foldr :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
$cfoldr' :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
foldr' :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
$cfoldl :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
foldl :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
$cfoldl' :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
foldl' :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ElimZipper a -&gt; b
$cfoldr1 :: forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a
foldr1 :: forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a
$cfoldl1 :: forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a
foldl1 :: forall a. (a -&gt; a -&gt; a) -&gt; ElimZipper a -&gt; a
$ctoList :: forall a. ElimZipper a -&gt; [a]
toList :: forall a. ElimZipper a -&gt; [a]
$cnull :: forall a. ElimZipper a -&gt; Bool
null :: forall a. ElimZipper a -&gt; Bool
$clength :: forall a. ElimZipper a -&gt; Int
length :: forall a. ElimZipper a -&gt; Int
$celem :: forall a. Eq a =&gt; a -&gt; ElimZipper a -&gt; Bool
elem :: forall a. Eq a =&gt; a -&gt; ElimZipper a -&gt; Bool
$cmaximum :: forall a. Ord a =&gt; ElimZipper a -&gt; a
maximum :: forall a. Ord a =&gt; ElimZipper a -&gt; a
$cminimum :: forall a. Ord a =&gt; ElimZipper a -&gt; a
minimum :: forall a. Ord a =&gt; ElimZipper a -&gt; a
$csum :: forall a. Num a =&gt; ElimZipper a -&gt; a
sum :: forall a. Num a =&gt; ElimZipper a -&gt; a
$cproduct :: forall a. Num a =&gt; ElimZipper a -&gt; a
product :: forall a. Num a =&gt; ElimZipper a -&gt; a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Foldable</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682090671"><span id="local-6989586621682090678"><span id="local-6989586621682090684"><span id="local-6989586621682090689"><span class="annot"><span class="annottext">Functor ElimZipper
Foldable ElimZipper
(Functor ElimZipper, Foldable ElimZipper) =&gt;
(forall (f :: * -&gt; *) a b.
 Applicative f =&gt;
 (a -&gt; f b) -&gt; ElimZipper a -&gt; f (ElimZipper b))
-&gt; (forall (f :: * -&gt; *) a.
    Applicative f =&gt;
    ElimZipper (f a) -&gt; f (ElimZipper a))
-&gt; (forall (m :: * -&gt; *) a b.
    Monad m =&gt;
    (a -&gt; m b) -&gt; ElimZipper a -&gt; m (ElimZipper b))
-&gt; (forall (m :: * -&gt; *) a.
    Monad m =&gt;
    ElimZipper (m a) -&gt; m (ElimZipper a))
-&gt; Traversable ElimZipper
forall (t :: * -&gt; *).
(Functor t, Foldable t) =&gt;
(forall (f :: * -&gt; *) a b.
 Applicative f =&gt;
 (a -&gt; f b) -&gt; t a -&gt; f (t b))
-&gt; (forall (f :: * -&gt; *) a. Applicative f =&gt; t (f a) -&gt; f (t a))
-&gt; (forall (m :: * -&gt; *) a b.
    Monad m =&gt;
    (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; (forall (m :: * -&gt; *) a. Monad m =&gt; t (m a) -&gt; m (t a))
-&gt; Traversable t
forall (m :: * -&gt; *) a.
Monad m =&gt;
ElimZipper (m a) -&gt; m (ElimZipper a)
forall (f :: * -&gt; *) a.
Applicative f =&gt;
ElimZipper (f a) -&gt; f (ElimZipper a)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ElimZipper a -&gt; m (ElimZipper b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; ElimZipper a -&gt; f (ElimZipper b)
$ctraverse :: forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; ElimZipper a -&gt; f (ElimZipper b)
traverse :: forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; ElimZipper a -&gt; f (ElimZipper b)
$csequenceA :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
ElimZipper (f a) -&gt; f (ElimZipper a)
sequenceA :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
ElimZipper (f a) -&gt; f (ElimZipper a)
$cmapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ElimZipper a -&gt; m (ElimZipper b)
mapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ElimZipper a -&gt; m (ElimZipper b)
$csequence :: forall (m :: * -&gt; *) a.
Monad m =&gt;
ElimZipper (m a) -&gt; m (ElimZipper a)
sequence :: forall (m :: * -&gt; *) a.
Monad m =&gt;
ElimZipper (m a) -&gt; m (ElimZipper a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Traversable</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089447"><span class="annot"><a href="Agda.Utils.Zipper.html#Zipper"><span class="hs-identifier hs-type">Zipper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ElimZipper"><span class="hs-identifier hs-type">ElimZipper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089447"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Carrier"><span class="annot"><a href="Agda.Utils.Zipper.html#Carrier"><span class="hs-identifier hs-var">Carrier</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ElimZipper"><span class="hs-identifier hs-type">ElimZipper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089447"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089447"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Element"><span class="annot"><a href="Agda.Utils.Zipper.html#Element"><span class="hs-identifier hs-var">Element</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ElimZipper"><span class="hs-identifier hs-type">ElimZipper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089447"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682089447"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>  </span><span id="local-6989586621682090700"><span class="annot"><span class="annottext">firstHole :: Carrier (ElimZipper a)
-&gt; Maybe (Element (ElimZipper a), ElimZipper a)
</span><a href="#local-6989586621682090700"><span class="hs-identifier hs-var hs-var hs-var">firstHole</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682090703"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682090703"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, ElimZipper a) -&gt; Maybe (a, ElimZipper a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg a -&gt; a
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682090703"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; ElimZipper a
forall a. ArgInfo -&gt; ElimZipper a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyCxt"><span class="hs-identifier hs-var">ApplyCxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg a -&gt; ArgInfo
forall e. Arg e -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#argInfo"><span class="hs-identifier hs-var">argInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682090703"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#firstHole"><span class="hs-identifier hs-var">firstHole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682090707"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090707"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682090708"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090708"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090709"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090709"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, ElimZipper a) -&gt; Maybe (a, ElimZipper a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090707"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; ElimZipper a
forall a. a -&gt; a -&gt; ElimZipper a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyType"><span class="hs-identifier hs-var">IApplyType</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090708"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090709"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#firstHole"><span class="hs-identifier hs-var">firstHole</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (a, ElimZipper a)
Maybe (Element (ElimZipper a), ElimZipper a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>  </span><span id="local-6989586621682090711"><span class="annot"><span class="annottext">plugHole :: Element (ElimZipper a) -&gt; ElimZipper a -&gt; Carrier (ElimZipper a)
</span><a href="#local-6989586621682090711"><span class="hs-identifier hs-var hs-var hs-var">plugHole</span></a></span></span><span> </span><span id="local-6989586621682090713"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090713"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyCxt"><span class="hs-identifier hs-type">ApplyCxt</span></a></span><span> </span><span id="local-6989586621682090714"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682090714"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; Elim' a
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; a -&gt; Arg a
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682090714"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090713"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#plugHole"><span class="hs-identifier hs-var">plugHole</span></a></span><span> </span><span id="local-6989586621682090715"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090715"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyType"><span class="hs-identifier hs-type">IApplyType</span></a></span><span> </span><span id="local-6989586621682090716"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090716"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090717"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090717"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a -&gt; Elim' a
forall a. a -&gt; a -&gt; a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-var">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090715"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090716"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090717"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#plugHole"><span class="hs-identifier hs-var">plugHole</span></a></span><span> </span><span id="local-6989586621682090718"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090718"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyFst"><span class="hs-identifier hs-type">IApplyFst</span></a></span><span> </span><span id="local-6989586621682090719"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090719"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682090720"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090720"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a -&gt; Elim' a
forall a. a -&gt; a -&gt; a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-var">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090719"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090720"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-648"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#plugHole"><span class="hs-identifier hs-var">plugHole</span></a></span><span> </span><span id="local-6989586621682090721"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090721"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplySnd"><span class="hs-identifier hs-type">IApplySnd</span></a></span><span> </span><span id="local-6989586621682090722"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090722"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682090723"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090723"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a -&gt; Elim' a
forall a. a -&gt; a -&gt; a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-var">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090722"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090723"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090721"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span>  </span><span id="local-6989586621682090725"><span class="annot"><span class="annottext">nextHole :: Element (ElimZipper a)
-&gt; ElimZipper a
-&gt; Either
     (Carrier (ElimZipper a)) (Element (ElimZipper a), ElimZipper a)
</span><a href="#local-6989586621682090725"><span class="hs-identifier hs-var hs-var hs-var">nextHole</span></a></span></span><span> </span><span id="local-6989586621682090727"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090727"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyType"><span class="hs-identifier hs-type">IApplyType</span></a></span><span> </span><span id="local-6989586621682090728"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090728"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090729"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090729"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, ElimZipper a) -&gt; Either (Elim' a) (a, ElimZipper a)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090728"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; ElimZipper a
forall a. a -&gt; a -&gt; ElimZipper a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyFst"><span class="hs-identifier hs-var">IApplyFst</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090727"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090729"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#nextHole"><span class="hs-identifier hs-var">nextHole</span></a></span><span> </span><span id="local-6989586621682090730"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090730"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplyFst"><span class="hs-identifier hs-type">IApplyFst</span></a></span><span> </span><span id="local-6989586621682090731"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090731"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682090732"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090732"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, ElimZipper a) -&gt; Either (Elim' a) (a, ElimZipper a)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090732"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; ElimZipper a
forall a. a -&gt; a -&gt; ElimZipper a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#IApplySnd"><span class="hs-identifier hs-var">IApplySnd</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090731"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090730"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#nextHole"><span class="hs-identifier hs-var">nextHole</span></a></span><span> </span><span id="local-6989586621682090733"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090733"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#IApplySnd"><span class="hs-identifier hs-type">IApplySnd</span></a></span><span> </span><span id="local-6989586621682090734"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090734"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682090735"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090735"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elim' a -&gt; Either (Elim' a) (a, ElimZipper a)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; a -&gt; Elim' a
forall a. a -&gt; a -&gt; a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-var">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090734"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090735"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
Element (ElimZipper a)
</span><a href="#local-6989586621682090733"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><a href="Agda.Utils.Zipper.html#nextHole"><span class="hs-identifier hs-var">nextHole</span></a></span><span> </span><span id="local-6989586621682090736"><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090736"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090737"><span class="annot"><span class="annottext">c :: ElimZipper a
</span><a href="#local-6989586621682090737"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyCxt"><span class="hs-identifier hs-type">ApplyCxt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elim' a -&gt; Either (Elim' a) (a, ElimZipper a)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Element (ElimZipper a) -&gt; ElimZipper a -&gt; Carrier (ElimZipper a)
forall z. Zipper z =&gt; Element z -&gt; z -&gt; Carrier z
</span><a href="Agda.Utils.Zipper.html#plugHole"><span class="hs-identifier hs-var">plugHole</span></a></span><span> </span><span class="annot"><span class="annottext">Element (ElimZipper a)
</span><a href="#local-6989586621682090736"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ElimZipper a
</span><a href="#local-6989586621682090737"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><span class="hs-comment">-- | A spine with a single hole for a pointer.</span></span><span>
</span><span id="line-656"></span><span class="hs-keyword">type</span><span> </span><span id="SpineContext"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#SpineContext"><span class="hs-identifier hs-var">SpineContext</span></a></span></span><span> </span><span id="local-6989586621682090738"><span class="annot"><a href="#local-6989586621682090738"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Zipper.html#ComposeZipper"><span class="hs-identifier hs-type">ComposeZipper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Zipper.html#ListZipper"><span class="hs-identifier hs-type">ListZipper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090738"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ElimZipper"><span class="hs-identifier hs-type">ElimZipper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090738"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><span class="hs-comment">-- | Control frames are continuations that act on value closures.</span></span><span>
</span><span id="line-660"></span><span class="hs-keyword">data</span><span> </span><span id="ControlFrame"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlFrame"><span class="hs-identifier hs-var">ControlFrame</span></a></span></span><span> </span><span id="local-6989586621682089462"><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CaseK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CaseK"><span class="hs-identifier hs-var">CaseK</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCase"><span class="hs-identifier hs-type">FastCase</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>                        </span><span class="hs-comment">-- ^ @CaseK f i bs spine0 spine1 stack@. Pattern match on the focus (with</span><span>
</span><span id="line-662"></span><span>                        </span><span class="hs-comment">--   arg info @i@) using the @bs@ case tree. @f@ is the name of the function</span><span>
</span><span id="line-663"></span><span>                        </span><span class="hs-comment">--   doing the matching, and @spine0@ and @spine1@ are the values bound to</span><span>
</span><span id="line-664"></span><span>                        </span><span class="hs-comment">--   the pattern variables to the left and right (respectively) of the</span><span>
</span><span id="line-665"></span><span>                        </span><span class="hs-comment">--   focus. The match stack contains catch-all cases we need to consider if</span><span>
</span><span id="line-666"></span><span>                        </span><span class="hs-comment">--   this match fails.</span><span>
</span><span id="line-667"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="ArgK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ArgK"><span class="hs-identifier hs-var">ArgK</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#SpineContext"><span class="hs-identifier hs-type">SpineContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>                        </span><span class="hs-comment">-- ^ @ArgK cl cxt@. Used when computing full normal forms. The closure is</span><span>
</span><span id="line-669"></span><span>                        </span><span class="hs-comment">--   the head and the context is the spine with the current focus removed.</span><span>
</span><span id="line-670"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="NormaliseK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span></span><span>
</span><span id="line-671"></span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ Indicates that the focus should be evaluated to full normal form.</span></span><span>
</span><span id="line-672"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="ForceK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ForceK"><span class="hs-identifier hs-var">ForceK</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>                        </span><span class="hs-comment">-- ^ @ForceK f spine0 spine1@. Evaluating @primForce@ of the focus. @f@ is</span><span>
</span><span id="line-674"></span><span>                        </span><span class="hs-comment">--   the name of @primForce@ and is used to build the result if evaluation</span><span>
</span><span id="line-675"></span><span>                        </span><span class="hs-comment">--   gets stuck. @spine0@ are the level and type arguments and @spine1@</span><span>
</span><span id="line-676"></span><span>                        </span><span class="hs-comment">--   contains (if not empty) the continuation and any additional</span><span>
</span><span id="line-677"></span><span>                        </span><span class="hs-comment">--   eliminations.</span><span>
</span><span id="line-678"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="EraseK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-var">EraseK</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>                        </span><span class="hs-comment">-- ^ @EraseK f spine0 spine1 spine2 spine3@. Evaluating @primErase@. The</span><span>
</span><span id="line-680"></span><span>                        </span><span class="hs-comment">--   first contains the level and type arguments. @spine1@ and @spine2@</span><span>
</span><span id="line-681"></span><span>                        </span><span class="hs-comment">--   contain at most one argument between them. If in @spine1@ it's the</span><span>
</span><span id="line-682"></span><span>                        </span><span class="hs-comment">--   value closure of the first argument to be compared and if in @spine2@</span><span>
</span><span id="line-683"></span><span>                        </span><span class="hs-comment">--   it's the unevaluated closure of the second argument.</span><span>
</span><span id="line-684"></span><span>                        </span><span class="hs-comment">--   @spine3@ contains the proof of equality we are erasing. It is passed</span><span>
</span><span id="line-685"></span><span>                        </span><span class="hs-comment">--   around but never actually inspected.</span><span>
</span><span id="line-686"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="NatSucK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-var">NatSucK</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-687"></span><span>                        </span><span class="hs-comment">-- ^ @NatSucK n@. Add @n@ to the focus. If the focus computes to a natural</span><span>
</span><span id="line-688"></span><span>                        </span><span class="hs-comment">--   number literal this returns a new literal, otherwise it constructs @n@</span><span>
</span><span id="line-689"></span><span>                        </span><span class="hs-comment">--   calls to @suc@.</span><span>
</span><span id="line-690"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="PrimOpK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#PrimOpK"><span class="hs-identifier hs-var">PrimOpK</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>                        </span><span class="hs-comment">-- ^ @PrimOpK f op lits es cc@. Evaluate the primitive function @f@ using</span><span>
</span><span id="line-692"></span><span>                        </span><span class="hs-comment">--   the Haskell function @op@. @op@ gets a list of literal values in</span><span>
</span><span id="line-693"></span><span>                        </span><span class="hs-comment">--   reverse order for the arguments of @f@ and computes the result as a</span><span>
</span><span id="line-694"></span><span>                        </span><span class="hs-comment">--   term. The already computed arguments (in reverse order) are @lits@ and</span><span>
</span><span id="line-695"></span><span>                        </span><span class="hs-comment">--   @es@ are the arguments that should be computed after the current focus.</span><span>
</span><span id="line-696"></span><span>                        </span><span class="hs-comment">--   In case of built-in functions with corresponding Agda implementations,</span><span>
</span><span id="line-697"></span><span>                        </span><span class="hs-comment">--   @cc@ contains the case tree.</span><span>
</span><span id="line-698"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="UpdateThunk"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#UpdateThunk"><span class="hs-identifier hs-var">UpdateThunk</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-type">STPointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-699"></span><span>                        </span><span class="hs-comment">-- ^ @UpdateThunk ps@. Update the pointers @ps@ with the value of the</span><span>
</span><span id="line-700"></span><span>                        </span><span class="hs-comment">--   current focus.</span><span>
</span><span id="line-701"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="ApplyK"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyK"><span class="hs-identifier hs-var">ApplyK</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089462"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>                        </span><span class="hs-comment">-- ^ @ApplyK spine@. Apply the current focus to the eliminations in @spine@.</span><span>
</span><span id="line-703"></span><span>                        </span><span class="hs-comment">--   This is used when a thunk needs to be updated with a partial</span><span>
</span><span id="line-704"></span><span>                        </span><span class="hs-comment">--   application of a function.</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="annot"><span class="hs-comment">-- * Compilation and decoding</span></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-comment">-- | The initial abstract machine state. Wrap the term to be evaluated in an empty closure. Note</span><span>
</span><span id="line-709"></span><span class="hs-comment">--   that free variables of the term are treated as constants by the abstract machine. If computing</span><span>
</span><span id="line-710"></span><span class="hs-comment">--   full normal form we start off the control stack with a 'NormaliseK' continuation.</span><span>
</span><span id="line-711"></span><span id="local-6989586621682089456"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#compile"><span class="hs-identifier hs-type">compile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Normalisation"><span class="hs-identifier hs-type">Normalisation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-type">AM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089456"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-712"></span><span id="compile"><span class="annot"><span class="annottext">compile :: forall s. Normalisation -&gt; Term -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#compile"><span class="hs-identifier hs-var hs-var">compile</span></a></span></span><span> </span><span id="local-6989586621682090750"><span class="annot"><span class="annottext">Normalisation
</span><a href="#local-6989586621682090750"><span class="hs-identifier hs-var">nf</span></a></span></span><span> </span><span id="local-6989586621682090751"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090751"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090751"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ControlFrame s
forall s. ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Normalisation
</span><a href="#local-6989586621682090750"><span class="hs-identifier hs-var">nf</span></a></span><span> </span><span class="annot"><span class="annottext">Normalisation -&gt; Normalisation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Normalisation
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NF"><span class="hs-identifier hs-var">NF</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span id="local-6989586621682089463"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodePointer"><span class="hs-identifier hs-type">decodePointer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089463"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089463"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span></span><span>
</span><span id="line-715"></span><span id="decodePointer"><span class="annot"><span class="annottext">decodePointer :: forall s. Pointer s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodePointer"><span class="hs-identifier hs-var hs-var">decodePointer</span></a></span></span><span> </span><span id="local-6989586621682090754"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090754"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s Term
forall s. Closure s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure_"><span class="hs-identifier hs-var">decodeClosure_</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; ST s Term) -&gt; ST s (Closure s) -&gt; ST s Term
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; ST s (Closure s)
forall s. Pointer s -&gt; ST s (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer_"><span class="hs-identifier hs-var">derefPointer_</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090754"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="hs-comment">-- | Note: it's important to be lazy in the spine and environment when decoding. Hence the</span><span>
</span><span id="line-718"></span><span class="hs-comment">--   'unsafeInterleaveST' here and in 'decodeEnv', and the special version of 'parallelS' in</span><span>
</span><span id="line-719"></span><span class="hs-comment">--   'decodeClosure'.</span><span>
</span><span id="line-720"></span><span id="local-6989586621682089466"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodeSpine"><span class="hs-identifier hs-type">decodeSpine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089466"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089466"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span></span><span>
</span><span id="line-721"></span><span id="decodeSpine"><span class="annot"><span class="annottext">decodeSpine :: forall s. Spine s -&gt; ST s Elims
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeSpine"><span class="hs-identifier hs-var hs-var">decodeSpine</span></a></span></span><span> </span><span id="local-6989586621682090767"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090767"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s Elims -&gt; ST s Elims
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">unsafeInterleaveST</span></span><span> </span><span class="annot"><span class="annottext">(ST s Elims -&gt; ST s Elims) -&gt; ST s Elims -&gt; ST s Elims
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Elim' (Pointer s) -&gt; ST s Elim) -&gt; Spine s -&gt; ST s Elims
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((Elim' (Pointer s) -&gt; ST s Elim) -&gt; Spine s -&gt; ST s Elims)
-&gt; ((Pointer s -&gt; ST s Term) -&gt; Elim' (Pointer s) -&gt; ST s Elim)
-&gt; (Pointer s -&gt; ST s Term)
-&gt; Spine s
-&gt; ST s Elims
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; ST s Term) -&gt; Elim' (Pointer s) -&gt; ST s Elim
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Elim' a -&gt; f (Elim' b)
</span><span class="hs-identifier hs-var">traverse</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; ST s Term
forall s. Pointer s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodePointer"><span class="hs-identifier hs-var">decodePointer</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090767"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span id="local-6989586621682089472"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodeEnv"><span class="hs-identifier hs-type">decodeEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089472"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089472"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-724"></span><span id="decodeEnv"><span class="annot"><span class="annottext">decodeEnv :: forall s. Env s -&gt; ST s [Term]
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeEnv"><span class="hs-identifier hs-var hs-var">decodeEnv</span></a></span></span><span> </span><span id="local-6989586621682090770"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090770"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s [Term] -&gt; ST s [Term]
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">unsafeInterleaveST</span></span><span> </span><span class="annot"><span class="annottext">(ST s [Term] -&gt; ST s [Term]) -&gt; ST s [Term] -&gt; ST s [Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; ST s Term) -&gt; [Pointer s] -&gt; ST s [Term]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; ST s Term
forall s. Pointer s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodePointer"><span class="hs-identifier hs-var">decodePointer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env s -&gt; [Pointer s]
forall s. Env s -&gt; [Pointer s]
</span><a href="Agda.TypeChecking.Reduce.Fast.html#envToList"><span class="hs-identifier hs-var">envToList</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090770"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span id="local-6989586621682089465"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure_"><span class="hs-identifier hs-type">decodeClosure_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089465"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089465"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span></span><span>
</span><span id="line-727"></span><span id="decodeClosure_"><span class="annot"><span class="annottext">decodeClosure_ :: forall s. Closure s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure_"><span class="hs-identifier hs-var hs-var">decodeClosure_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Term
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Term)
-&gt; (Closure s -&gt; ST s (Blocked Term)) -&gt; Closure s -&gt; ST s Term
forall (m :: * -&gt; *) b c a.
Functor m =&gt;
(b -&gt; c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="Agda.Utils.Functor.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s (Blocked Term)
forall s. Closure s -&gt; ST s (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure"><span class="hs-identifier hs-var">decodeClosure</span></a></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span class="hs-comment">-- | Turning an abstract machine closure back into a term. This happens in three cases:</span><span>
</span><span id="line-730"></span><span class="hs-comment">--    * when reduction is finished and we return the weak-head normal term to the outside world.</span><span>
</span><span id="line-731"></span><span class="hs-comment">--    * when the abstract machine encounters something it cannot handle and falls back to the slow</span><span>
</span><span id="line-732"></span><span class="hs-comment">--      reduction engine</span><span>
</span><span id="line-733"></span><span class="hs-comment">--    * when there are rewrite rules to apply</span><span>
</span><span id="line-734"></span><span id="local-6989586621682089479"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure"><span class="hs-identifier hs-type">decodeClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089479"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089479"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-735"></span><span id="decodeClosure"><span class="annot"><span class="annottext">decodeClosure :: forall s. Closure s -&gt; ST s (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure"><span class="hs-identifier hs-var hs-var">decodeClosure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621682090782"><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090782"><span class="hs-identifier hs-var">isV</span></a></span></span><span> </span><span id="local-6989586621682090783"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090783"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682090784"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090784"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682090785"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090785"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>    </span><span id="local-6989586621682090786"><span class="annot"><a href="#local-6989586621682090786"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; ST s [Term]
forall s. Env s -&gt; ST s [Term]
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeEnv"><span class="hs-identifier hs-var">decodeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090784"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-737"></span><span>    </span><span id="local-6989586621682090787"><span class="annot"><a href="#local-6989586621682090787"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodeSpine"><span class="hs-identifier hs-type">decodeSpine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090785"><span class="hs-identifier hs-type">spine</span></a></span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-identifier hs-type">applyE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682090790"><span class="hs-identifier hs-type">parS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090786"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682090783"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682090787"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$</span></span><span> </span><span class="annot"><a href="#local-6989586621682090791"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-740"></span><span>    </span><span id="local-6989586621682090790"><span class="annot"><span class="annottext">parS :: [a] -&gt; Substitution' a
</span><a href="#local-6989586621682090790"><span class="hs-identifier hs-var hs-var">parS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Substitution' a -&gt; Substitution' a)
-&gt; Substitution' a -&gt; [a] -&gt; Substitution' a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Substitution' a -&gt; Substitution' a
forall a. a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.Syntax.Internal.html#%3A%23"><span class="hs-operator hs-var">(:#)</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' a
forall a. Substitution' a
</span><a href="Agda.Syntax.Internal.html#IdS"><span class="hs-identifier hs-var">IdS</span></a></span><span>  </span><span class="hs-comment">-- parallelS is too strict</span><span>
</span><span id="line-741"></span><span>    </span><span id="local-6989586621682090791"><span class="annot"><span class="annottext">b :: Blocked_
</span><a href="#local-6989586621682090791"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682090782"><span class="hs-identifier hs-var">isV</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-742"></span><span>             </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621682090795"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682090795"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682090795"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-743"></span><span>             </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- only when falling back to slow reduce in which case the</span><span>
</span><span id="line-744"></span><span>                                        </span><span class="hs-comment">-- blocking tag is immediately discarded</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="hs-comment">-- | Turn a list of internal syntax eliminations into a spine. This builds closures and allocates</span><span>
</span><span id="line-747"></span><span class="hs-comment">--   thunks for all the 'Apply' elims.</span><span>
</span><span id="line-748"></span><span id="local-6989586621682089492"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-type">elimsToSpine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089492"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089492"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089492"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-749"></span><span id="elimsToSpine"><span class="annot"><span class="annottext">elimsToSpine :: forall s. Env s -&gt; Elims -&gt; ST s (Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-var hs-var">elimsToSpine</span></a></span></span><span> </span><span id="local-6989586621682090809"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090809"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682090810"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682090810"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-750"></span><span>    </span><span id="local-6989586621682090811"><span class="annot"><a href="#local-6989586621682090811"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Elim -&gt; ST s (Elim' (Pointer s)))
-&gt; Elims -&gt; ST s [Elim' (Pointer s)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; ST s (Elim' (Pointer s))
</span><a href="#local-6989586621682090813"><span class="hs-identifier hs-var">thunk</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682090810"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><a href="#local-6989586621682090814"><span class="hs-identifier hs-type">forceSpine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090811"><span class="hs-identifier hs-type">spine</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682090811"><span class="hs-identifier hs-type">spine</span></a></span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-753"></span><span>    </span><span class="hs-comment">-- Need to be strict in mkClosure to avoid memory leak</span><span>
</span><span id="line-754"></span><span>    </span><span id="local-6989586621682090814"><span class="annot"><span class="annottext">forceSpine :: [Elim' (Pointer s)] -&gt; ()
</span><a href="#local-6989586621682090814"><span class="hs-identifier hs-var hs-var">forceSpine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; Elim' (Pointer s) -&gt; ()) -&gt; () -&gt; [Elim' (Pointer s)] -&gt; ()
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elim' (Pointer s) -&gt; ()
forall {s}. Elim' (Pointer s) -&gt; ()
</span><a href="#local-6989586621682090817"><span class="hs-identifier hs-var">forceEl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621682090817"><span class="annot"><span class="annottext">forceEl :: Elim' (Pointer s) -&gt; ()
</span><a href="#local-6989586621682090817"><span class="hs-identifier hs-var hs-var">forceEl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><a href="#local-6989586621682090817"><span class="hs-identifier hs-var">forceEl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><a href="#local-6989586621682090817"><span class="hs-identifier hs-var">forceEl</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-comment">-- We don't preserve free variables of closures (in the sense of their</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-comment">-- decoding), since we freely add things to the spines.</span><span>
</span><span id="line-761"></span><span>    </span><span id="local-6989586621682090819"><span class="annot"><span class="annottext">unknownFVs :: ArgInfo -&gt; ArgInfo
</span><a href="#local-6989586621682090819"><span class="hs-identifier hs-var hs-var">unknownFVs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVariables -&gt; ArgInfo -&gt; ArgInfo
forall a. LensFreeVariables a =&gt; FreeVariables -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setFreeVariables"><span class="hs-identifier hs-var">setFreeVariables</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVariables
</span><a href="Agda.Syntax.Common.html#unknownFreeVariables"><span class="hs-identifier hs-var">unknownFreeVariables</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>    </span><span id="local-6989586621682090813"><span class="annot"><span class="annottext">thunk :: Elim -&gt; ST s (Elim' (Pointer s))
</span><a href="#local-6989586621682090813"><span class="hs-identifier hs-var hs-var">thunk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682090822"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682090822"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682090823"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090823"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; (Pointer s -&gt; Arg (Pointer s)) -&gt; Pointer s -&gt; Elim' (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Pointer s -&gt; Arg (Pointer s)
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgInfo
</span><a href="#local-6989586621682090819"><span class="hs-identifier hs-var">unknownFVs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682090822"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; Elim' (Pointer s))
-&gt; ST s (Pointer s) -&gt; ST s (Elim' (Pointer s))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s (Pointer s)
forall s. Closure s -&gt; ST s (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#createThunk"><span class="hs-identifier hs-var">createThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeVariables -&gt; Term -&gt; Closure s
</span><a href="#local-6989586621682090824"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; FreeVariables
forall a. LensFreeVariables a =&gt; a -&gt; FreeVariables
</span><a href="Agda.Syntax.Common.html#getFreeVariables"><span class="hs-identifier hs-var">getFreeVariables</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682090822"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090823"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>    </span><span class="annot"><a href="#local-6989586621682090813"><span class="hs-identifier hs-var">thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682090826"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682090826"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682090827"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090827"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elim' (Pointer s) -&gt; ST s (Elim' (Pointer s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' (Pointer s)
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682090826"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090827"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>    </span><span class="annot"><a href="#local-6989586621682090813"><span class="hs-identifier hs-var">thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682090828"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090828"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682090829"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090829"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090830"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090830"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Pointer s -&gt; Pointer s -&gt; Elim' (Pointer s)
forall a. a -&gt; a -&gt; a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-var">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; Pointer s -&gt; Pointer s -&gt; Elim' (Pointer s))
-&gt; ST s (Pointer s)
-&gt; ST s (Pointer s -&gt; Pointer s -&gt; Elim' (Pointer s))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ST s (Pointer s)
</span><a href="#local-6989586621682090831"><span class="hs-identifier hs-var">mkThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090828"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (Pointer s -&gt; Pointer s -&gt; Elim' (Pointer s))
-&gt; ST s (Pointer s) -&gt; ST s (Pointer s -&gt; Elim' (Pointer s))
forall a b. ST s (a -&gt; b) -&gt; ST s a -&gt; ST s b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ST s (Pointer s)
</span><a href="#local-6989586621682090831"><span class="hs-identifier hs-var">mkThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090829"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (Pointer s -&gt; Elim' (Pointer s))
-&gt; ST s (Pointer s) -&gt; ST s (Elim' (Pointer s))
forall a b. ST s (a -&gt; b) -&gt; ST s a -&gt; ST s b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ST s (Pointer s)
</span><a href="#local-6989586621682090831"><span class="hs-identifier hs-var">mkThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090830"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-766"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682090831"><span class="annot"><span class="annottext">mkThunk :: Term -&gt; ST s (Pointer s)
</span><a href="#local-6989586621682090831"><span class="hs-identifier hs-var hs-var">mkThunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s (Pointer s)
forall s. Closure s -&gt; ST s (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#createThunk"><span class="hs-identifier hs-var">createThunk</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; ST s (Pointer s))
-&gt; (Term -&gt; Closure s) -&gt; Term -&gt; ST s (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FreeVariables -&gt; Term -&gt; Closure s
</span><a href="#local-6989586621682090824"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVariables
</span><a href="Agda.Syntax.Common.html#UnknownFVs"><span class="hs-identifier hs-var">UnknownFVs</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-comment">-- Going straight for a value for literals is mostly to make debug traces</span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-comment">-- less verbose and doesn't really buy anything performance-wise.</span><span>
</span><span id="line-770"></span><span>    </span><span id="local-6989586621682090824"><span class="annot"><span class="annottext">closure :: FreeVariables -&gt; Term -&gt; Closure s
</span><a href="#local-6989586621682090824"><span class="hs-identifier hs-var hs-var">closure</span></a></span></span><span> </span><span class="annot"><span class="annottext">FreeVariables
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682090833"><span class="annot"><span class="annottext">t :: Term
</span><a href="#local-6989586621682090833"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; [Elim' (Pointer s)] -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; IsValue) -&gt; Blocked_ -&gt; IsValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090833"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="#local-6989586621682090824"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span id="local-6989586621682090834"><span class="annot"><span class="annottext">FreeVariables
</span><a href="#local-6989586621682090834"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621682090835"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090835"><span class="hs-identifier hs-var">t</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090836"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Closure s -&gt; Closure s
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; [Elim' (Pointer s)] -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090835"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090836"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682090836"><span class="annot"><span class="annottext">env' :: Env s
</span><a href="#local-6989586621682090836"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeVariables -&gt; Env s -&gt; Env s
forall s. FreeVariables -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#trimEnvironment"><span class="hs-identifier hs-var">trimEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVariables
</span><a href="#local-6989586621682090834"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090809"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="hs-comment">-- | Trim unused entries from an environment. Currently only trims closed terms for performance</span><span>
</span><span id="line-775"></span><span class="hs-comment">--   reasons.</span><span>
</span><span id="line-776"></span><span id="local-6989586621682089503"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#trimEnvironment"><span class="hs-identifier hs-type">trimEnvironment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#FreeVariables"><span class="hs-identifier hs-type">FreeVariables</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089503"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089503"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-777"></span><span id="trimEnvironment"><span class="annot"><span class="annottext">trimEnvironment :: forall s. FreeVariables -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#trimEnvironment"><span class="hs-identifier hs-var hs-var">trimEnvironment</span></a></span></span><span> </span><span class="annot"><span class="annottext">FreeVariables
</span><a href="Agda.Syntax.Common.html#UnknownFVs"><span class="hs-identifier hs-var">UnknownFVs</span></a></span><span> </span><span id="local-6989586621682090844"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090844"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090844"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-778"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#trimEnvironment"><span class="hs-identifier hs-var">trimEnvironment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#KnownFVs"><span class="hs-identifier hs-type">KnownFVs</span></a></span><span> </span><span id="local-6989586621682090846"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682090846"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682090847"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090847"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682090846"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-comment">-- Environment trimming is too expensive (costs 50% on some benchmarks), and while it does make</span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-comment">-- some cases run in constant instead of linear space you need quite contrived examples to</span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-comment">-- notice the effect.</span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090847"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-comment">-- Env $ trim 0 $ envToList env</span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-comment">-- Important: strict enough that the trimming actually happens</span><span>
</span><span id="line-786"></span><span>    </span><span id="local-6989586621682090848"><span class="annot"><span class="annottext">trim :: Int -&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
</span><a href="#local-6989586621682090848"><span class="hs-identifier hs-var hs-var">trim</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="#local-6989586621682090848"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span id="local-6989586621682090849"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090849"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682090850"><span class="annot"><span class="annottext">Pointer (ZonkAny 0)
</span><a href="#local-6989586621682090850"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682090851"><span class="annot"><span class="annottext">[Pointer (ZonkAny 0)]
</span><a href="#local-6989586621682090851"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; VarSet -&gt; Bool
</span><a href="Agda.Utils.VarSet.html#member"><span class="hs-identifier hs-var">VarSet.member</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090849"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682090846"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer (ZonkAny 0)
</span><a href="#local-6989586621682090850"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer (ZonkAny 0)
-&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>             </span><span class="annot"><span class="annottext">([Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)])
-&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
</span><a href="#local-6989586621682090848"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090849"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pointer (ZonkAny 0)]
</span><a href="#local-6989586621682090851"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-789"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer (ZonkAny 0)
forall s. Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointer"><span class="hs-identifier hs-var">unusedPointer</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer (ZonkAny 0)
-&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)])
-&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Pointer (ZonkAny 0)] -&gt; [Pointer (ZonkAny 0)]
</span><a href="#local-6989586621682090848"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090849"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pointer (ZonkAny 0)]
</span><a href="#local-6989586621682090851"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span class="hs-comment">-- | Build an environment for a body with some given free variables from a spine of arguments.</span><span>
</span><span id="line-792"></span><span class="hs-comment">--   Returns a triple containing</span><span>
</span><span id="line-793"></span><span class="hs-comment">--    * the left-over variable names (in case of partial application)</span><span>
</span><span id="line-794"></span><span class="hs-comment">--    * the environment</span><span>
</span><span id="line-795"></span><span class="hs-comment">--    * the remaining spine (in case of over-application)</span><span>
</span><span id="line-796"></span><span id="local-6989586621682089507"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#buildEnv"><span class="hs-identifier hs-type">buildEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089507"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089507"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089507"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-797"></span><span id="buildEnv"><span class="annot"><span class="annottext">buildEnv :: forall s.
[Arg VerboseKey] -&gt; Spine s -&gt; ([Arg VerboseKey], Env s, Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#buildEnv"><span class="hs-identifier hs-var hs-var">buildEnv</span></a></span></span><span> </span><span id="local-6989586621682090855"><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682090855"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682090856"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090856"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg VerboseKey]
-&gt; Spine s -&gt; Env s -&gt; ([Arg VerboseKey], Env s, Spine s)
forall {a} {s}.
[a]
-&gt; [Elim' (Pointer s)]
-&gt; Env s
-&gt; ([a], Env s, [Elim' (Pointer s)])
</span><a href="#local-6989586621682090857"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682090855"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682090856"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-799"></span><span>    </span><span id="local-6989586621682090857"><span class="annot"><span class="annottext">go :: [a]
-&gt; [Elim' (Pointer s)]
-&gt; Env s
-&gt; ([a], Env s, [Elim' (Pointer s)])
</span><a href="#local-6989586621682090857"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682090860"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090860"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621682090861"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090861"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090861"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090860"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>    </span><span class="annot"><a href="#local-6989586621682090857"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682090862"><span class="annot"><span class="annottext">xs0 :: [a]
</span><a href="#local-6989586621682090862"><span class="hs-identifier hs-var">xs0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682090863"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682090863"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682090864"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682090864"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682090865"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090865"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621682090866"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090866"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090865"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682090862"><span class="hs-identifier hs-var">xs0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090866"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090865"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682090867"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682090867"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682090868"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090868"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a]
-&gt; [Elim' (Pointer s)]
-&gt; Env s
-&gt; ([a], Env s, [Elim' (Pointer s)])
</span><a href="#local-6989586621682090857"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682090864"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090868"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682090867"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Env s -&gt; Env s
forall s. Pointer s -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-operator hs-var">`extendEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090866"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682090869"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090869"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682090870"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090870"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682090871"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090871"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682090872"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090872"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a]
-&gt; [Elim' (Pointer s)]
-&gt; Env s
-&gt; ([a], Env s, [Elim' (Pointer s)])
</span><a href="#local-6989586621682090857"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682090864"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682090872"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682090871"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Env s -&gt; Env s
forall s. Pointer s -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-operator hs-var">`extendEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682090866"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>        </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([a], Env s, [Elim' (Pointer s)])
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointerString"><span class="hs-identifier hs-type">unusedPointerString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-808"></span><span id="unusedPointerString"><span class="annot"><span class="annottext">unusedPointerString :: Text
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointerString"><span class="hs-identifier hs-var hs-var">unusedPointerString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Impossible -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CallStack -&gt; Impossible) -&gt; Impossible
forall b. HasCallStack =&gt; (CallStack -&gt; b) -&gt; b
</span><a href="Agda.Utils.CallStack.Base.html#withCurrentCallStack"><span class="hs-identifier hs-var">withCurrentCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span id="local-6989586621682089506"><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointer"><span class="hs-identifier hs-type">unusedPointer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089506"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-811"></span><span id="unusedPointer"><span class="annot"><span class="annottext">unusedPointer :: forall s. Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointer"><span class="hs-identifier hs-var hs-var">unusedPointer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; IsValue) -&gt; Blocked_ -&gt; IsValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointerString"><span class="hs-identifier hs-var">unusedPointerString</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><span class="hs-comment">-- * Running the abstract machine</span></span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span class="hs-comment">-- | Evaluating a term in the abstract machine. It gets the type checking state and environment in</span><span>
</span><span id="line-817"></span><span class="hs-comment">--   the 'ReduceEnv' argument, some precomputed built-in mappings in 'BuiltinEnv', the memoised</span><span>
</span><span id="line-818"></span><span class="hs-comment">--   'getConstInfo' function, a couple of flags (allow non-terminating function unfolding, and</span><span>
</span><span id="line-819"></span><span class="hs-comment">--   whether rewriting is enabled), and a term to reduce. The result is the weak-head normal form of</span><span>
</span><span id="line-820"></span><span class="hs-comment">--   the term with an attached blocking tag.</span><span>
</span><span id="line-821"></span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#reduceTm"><span class="hs-identifier hs-type">reduceTm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceEnv"><span class="hs-identifier hs-type">ReduceEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-type">BuiltinEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CompactDef"><span class="hs-identifier hs-type">CompactDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Normalisation"><span class="hs-identifier hs-type">Normalisation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-822"></span><span id="reduceTm"><span class="annot"><span class="annottext">reduceTm :: ReduceEnv
-&gt; BuiltinEnv
-&gt; (QName -&gt; CompactDef)
-&gt; Normalisation
-&gt; Term
-&gt; Blocked Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#reduceTm"><span class="hs-identifier hs-var hs-var">reduceTm</span></a></span></span><span> </span><span id="local-6989586621682090876"><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span></span><span> </span><span id="local-6989586621682090877"><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090877"><span class="hs-identifier hs-var">bEnv</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682090878"><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span></span><span> </span><span id="local-6989586621682090879"><span class="annot"><span class="annottext">Normalisation
</span><a href="#local-6989586621682090879"><span class="hs-identifier hs-var">normalisation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="annottext">Term -&gt; Blocked Term
</span><a href="#local-6989586621682090880"><span class="hs-identifier hs-var">compileAndRun</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Blocked Term) -&gt; (Term -&gt; Term) -&gt; Term -&gt; Blocked Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Term -&gt; Term
forall a. Doc -&gt; a -&gt; a
</span><a href="#local-6989586621682090881"><span class="hs-identifier hs-var">traceDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;-- fast reduce --&quot;</span></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-825"></span><span>    </span><span class="hs-comment">-- Helpers to get information from the ReduceEnv.</span><span>
</span><span id="line-826"></span><span>    </span><span id="local-6989586621682090882"><span class="annot"><span class="annottext">localMetas :: Map MetaId MetaVariable
</span><a href="#local-6989586621682090882"><span class="hs-identifier hs-var hs-var">localMetas</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceEnv -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#redSt"><span class="hs-identifier hs-var">redSt</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
-&gt; Lens' TCState (Map MetaId MetaVariable)
-&gt; Map MetaId MetaVariable
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MetaId MetaVariable -&gt; f (Map MetaId MetaVariable))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map MetaId MetaVariable)
</span><a href="Agda.TypeChecking.Monad.Base.html#stSolvedMetaStore"><span class="hs-identifier hs-var">stSolvedMetaStore</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span id="local-6989586621682090888"><span class="annot"><span class="annottext">remoteMetas :: HashMap MetaId RemoteMetaVariable
</span><a href="#local-6989586621682090888"><span class="hs-identifier hs-var hs-var">remoteMetas</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceEnv -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#redSt"><span class="hs-identifier hs-var">redSt</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
-&gt; Lens' TCState (HashMap MetaId RemoteMetaVariable)
-&gt; HashMap MetaId RemoteMetaVariable
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap MetaId RemoteMetaVariable
 -&gt; f (HashMap MetaId RemoteMetaVariable))
-&gt; TCState -&gt; f TCState
Lens' TCState (HashMap MetaId RemoteMetaVariable)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedMetaStore"><span class="hs-identifier hs-var">stImportedMetaStore</span></a></span><span>
</span><span id="line-828"></span><span>    </span><span class="hs-comment">-- Are we currently instance searching. In that case we don't fail hard on missing clauses. This</span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-comment">-- is a (very unsatisfactory) work-around for #3870.</span><span>
</span><span id="line-830"></span><span>    </span><span id="local-6989586621682090892"><span class="annot"><span class="annottext">speculative :: Bool
</span><a href="#local-6989586621682090892"><span class="hs-identifier hs-var hs-var">speculative</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceEnv -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#redSt"><span class="hs-identifier hs-var">redSt</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState Bool -&gt; Bool
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; TCState -&gt; f TCState
Lens' TCState Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#stConsideringInstance"><span class="hs-identifier hs-var">stConsideringInstance</span></a></span><span>
</span><span id="line-831"></span><span>    </span><span id="local-6989586621682090896"><span class="annot"><span class="annottext">getMetaInst :: MetaId -&gt; Maybe MetaInstantiation
</span><a href="#local-6989586621682090896"><span class="hs-identifier hs-var hs-var">getMetaInst</span></a></span></span><span> </span><span id="local-6989586621682090897"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090897"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Map MetaId MetaVariable -&gt; Maybe MetaVariable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">MapS.lookup</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090897"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Map MetaId MetaVariable
</span><a href="#local-6989586621682090882"><span class="hs-identifier hs-var">localMetas</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-832"></span><span>                       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090898"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682090898"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaInstantiation -&gt; Maybe MetaInstantiation
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682090898"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>                       </span><span class="annot"><span class="annottext">Maybe MetaVariable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instantiation -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#InstV"><span class="hs-identifier hs-var">InstV</span></a></span><span> </span><span class="annot"><span class="annottext">(Instantiation -&gt; MetaInstantiation)
-&gt; (RemoteMetaVariable -&gt; Instantiation)
-&gt; RemoteMetaVariable
-&gt; MetaInstantiation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaVariable -&gt; Instantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#rmvInstantiation"><span class="hs-identifier hs-var">rmvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteMetaVariable -&gt; MetaInstantiation)
-&gt; Maybe RemoteMetaVariable -&gt; Maybe MetaInstantiation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-834"></span><span>                                    </span><span class="annot"><span class="annottext">MetaId
-&gt; HashMap MetaId RemoteMetaVariable -&gt; Maybe RemoteMetaVariable
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682090897"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap MetaId RemoteMetaVariable
</span><a href="#local-6989586621682090888"><span class="hs-identifier hs-var">remoteMetas</span></a></span><span>
</span><span id="line-835"></span><span>    </span><span id="local-6989586621682090904"><span class="annot"><span class="annottext">partialDefs :: Set QName
</span><a href="#local-6989586621682090904"><span class="hs-identifier hs-var hs-var">partialDefs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceM (Set QName) -&gt; Set QName
forall a. ReduceM a -&gt; a
</span><a href="#local-6989586621682090905"><span class="hs-identifier hs-var">runReduce</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceM (Set QName)
forall (m :: * -&gt; *). ReadTCState m =&gt; m (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#getPartialDefs"><span class="hs-identifier hs-var">getPartialDefs</span></a></span><span>
</span><span id="line-836"></span><span>    </span><span id="local-6989586621682090907"><span class="annot"><span class="annottext">rewriteRules :: QName -&gt; RewriteRules
</span><a href="#local-6989586621682090907"><span class="hs-identifier hs-var hs-var">rewriteRules</span></a></span></span><span> </span><span id="local-6989586621682090908"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090908"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactDef -&gt; RewriteRules
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefRewriteRules"><span class="hs-identifier hs-var">cdefRewriteRules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682090908"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>    </span><span id="local-6989586621682090909"><span class="annot"><span class="annottext">callByNeed :: Bool
</span><a href="#local-6989586621682090909"><span class="hs-identifier hs-var hs-var">callByNeed</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#envCallByNeed"><span class="hs-identifier hs-var">envCallByNeed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReduceEnv -&gt; TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#redEnv"><span class="hs-identifier hs-var">redEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optCallByName"><span class="hs-identifier hs-var">optCallByName</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; PragmaOptions -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReduceEnv -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#redSt"><span class="hs-identifier hs-var">redSt</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState PragmaOptions -&gt; PragmaOptions
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span>    </span><span id="local-6989586621682090918"><span class="annot"><span class="annottext">iview :: Term -&gt; IntervalView
</span><a href="#local-6989586621682090918"><span class="hs-identifier hs-var hs-var">iview</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceM (Term -&gt; IntervalView) -&gt; Term -&gt; IntervalView
forall a. ReduceM a -&gt; a
</span><a href="#local-6989586621682090905"><span class="hs-identifier hs-var">runReduce</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceM (Term -&gt; IntervalView)
forall (m :: * -&gt; *). HasBuiltins m =&gt; m (Term -&gt; IntervalView)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#intervalView%27"><span class="hs-identifier hs-var">intervalView'</span></a></span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span>    </span><span id="local-6989586621682089529"><span class="annot"><a href="#local-6989586621682090905"><span class="hs-identifier hs-type">runReduce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089529"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682089529"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-841"></span><span>    </span><span id="local-6989586621682090905"><span class="annot"><span class="annottext">runReduce :: forall a. ReduceM a -&gt; a
</span><a href="#local-6989586621682090905"><span class="hs-identifier hs-var hs-var">runReduce</span></a></span></span><span> </span><span id="local-6989586621682090920"><span class="annot"><span class="annottext">ReduceM a
</span><a href="#local-6989586621682090920"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceM a -&gt; ReduceEnv -&gt; a
forall a. ReduceM a -&gt; ReduceEnv -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#unReduceM"><span class="hs-identifier hs-var">unReduceM</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceM a
</span><a href="#local-6989586621682090920"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>    </span><span class="hs-comment">-- Debug output. Taking care that we only look at the verbosity level once.</span><span>
</span><span id="line-844"></span><span>    </span><span id="local-6989586621682090922"><span class="annot"><span class="annottext">hasVerb :: VerboseKey -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682090922"><span class="hs-identifier hs-var hs-var">hasVerb</span></a></span></span><span> </span><span id="local-6989586621682090923"><span class="annot"><span class="annottext">VerboseKey
</span><a href="#local-6989586621682090923"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621682090924"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090924"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReduceM Bool -&gt; ReduceEnv -&gt; Bool
forall a. ReduceM a -&gt; ReduceEnv -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#unReduceM"><span class="hs-identifier hs-var">unReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey -&gt; Int -&gt; ReduceM Bool
forall (m :: * -&gt; *). MonadDebug m =&gt; VerboseKey -&gt; Int -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Debug.html#hasVerbosity"><span class="hs-identifier hs-var">hasVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><a href="#local-6989586621682090923"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682090924"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span>
</span><span id="line-845"></span><span>    </span><span id="local-6989586621682090926"><span class="annot"><span class="annottext">doDebug :: Bool
</span><a href="#local-6989586621682090926"><span class="hs-identifier hs-var hs-var">doDebug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682090922"><span class="hs-identifier hs-var">hasVerb</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;tc.reduce.fast&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">110</span></span><span>
</span><span id="line-846"></span><span>    </span><span id="local-6989586621682089513"><span class="annot"><a href="#local-6989586621682090881"><span class="hs-identifier hs-type">traceDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682089513"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682089513"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-847"></span><span>    </span><span id="local-6989586621682090881"><span class="annot"><span class="annottext">traceDoc :: forall a. Doc -&gt; a -&gt; a
</span><a href="#local-6989586621682090881"><span class="hs-identifier hs-var hs-var">traceDoc</span></a></span></span><span>
</span><span id="line-848"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090926"><span class="hs-identifier hs-var">doDebug</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; a -&gt; a
forall a. VerboseKey -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="annot"><span class="annottext">(VerboseKey -&gt; a -&gt; a) -&gt; (Doc -&gt; VerboseKey) -&gt; Doc -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-849"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; Doc -&gt; a -&gt; a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-comment">-- Checking for built-in zero and suc</span><span>
</span><span id="line-852"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#BuiltinEnv"><span class="hs-identifier hs-type">BuiltinEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bZero :: BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bZero"><span class="hs-identifier hs-var">bZero</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682090929"><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090929"><span class="hs-identifier hs-var">zero</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bSuc :: BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bSuc"><span class="hs-identifier hs-var">bSuc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682090930"><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090930"><span class="hs-identifier hs-var">suc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bRefl :: BuiltinEnv -&gt; Maybe ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#bRefl"><span class="hs-identifier hs-var">bRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682090931"><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090931"><span class="hs-identifier hs-var">refl0</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinEnv
</span><a href="#local-6989586621682090877"><span class="hs-identifier hs-var">bEnv</span></a></span><span>
</span><span id="line-853"></span><span>    </span><span id="local-6989586621682090932"><span class="annot"><span class="annottext">conNameId :: ConHead -&gt; NameId
</span><a href="#local-6989586621682090932"><span class="hs-identifier hs-var hs-var">conNameId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NameId) -&gt; (ConHead -&gt; Name) -&gt; ConHead -&gt; NameId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; (ConHead -&gt; QName) -&gt; ConHead -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span>
</span><span id="line-854"></span><span>    </span><span id="local-6989586621682090933"><span class="annot"><span class="annottext">isZero :: ConHead -&gt; Bool
</span><a href="#local-6989586621682090933"><span class="hs-identifier hs-var hs-var">isZero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090929"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-855"></span><span>               </span><span class="annot"><span class="annottext">Maybe ConHead
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ConHead -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-856"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090934"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090934"><span class="hs-identifier hs-var">z</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; NameId
</span><a href="#local-6989586621682090932"><span class="hs-identifier hs-var">conNameId</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090934"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">NameId -&gt; NameId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NameId -&gt; Bool) -&gt; (ConHead -&gt; NameId) -&gt; ConHead -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; NameId
</span><a href="#local-6989586621682090932"><span class="hs-identifier hs-var">conNameId</span></a></span><span>
</span><span id="line-857"></span><span>    </span><span id="local-6989586621682090935"><span class="annot"><span class="annottext">isSuc :: ConHead -&gt; Bool
</span><a href="#local-6989586621682090935"><span class="hs-identifier hs-var hs-var">isSuc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090930"><span class="hs-identifier hs-var">suc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-858"></span><span>               </span><span class="annot"><span class="annottext">Maybe ConHead
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ConHead -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-859"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682090936"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090936"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; NameId
</span><a href="#local-6989586621682090932"><span class="hs-identifier hs-var">conNameId</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090936"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">NameId -&gt; NameId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NameId -&gt; Bool) -&gt; (ConHead -&gt; NameId) -&gt; ConHead -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; NameId
</span><a href="#local-6989586621682090932"><span class="hs-identifier hs-var">conNameId</span></a></span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-comment">-- If there's a non-standard equality (for instance doubly-indexed) we fall back to slow reduce</span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-comment">-- for primErase and &quot;unbind&quot; refl.</span><span>
</span><span id="line-863"></span><span>    </span><span id="local-6989586621682090937"><span class="annot"><span class="annottext">refl :: Maybe ConHead
</span><a href="#local-6989586621682090937"><span class="hs-identifier hs-var hs-var">refl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090931"><span class="hs-identifier hs-var">refl0</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead -&gt; (ConHead -&gt; Maybe ConHead) -&gt; Maybe ConHead
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682090938"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090938"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CompactDefn -&gt; Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconArity"><span class="hs-identifier hs-var">cconArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactDef -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var">cdefDef</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactDef -&gt; CompactDefn) -&gt; CompactDef -&gt; CompactDefn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; CompactDef) -&gt; QName -&gt; CompactDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090938"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-864"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; Maybe ConHead
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682090938"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span>    </span><span class="hs-comment">-- The entry point of the machine.</span><span>
</span><span id="line-867"></span><span>    </span><span class="annot"><a href="#local-6989586621682090880"><span class="hs-identifier hs-type">compileAndRun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span id="local-6989586621682090880"><span class="annot"><span class="annottext">compileAndRun :: Term -&gt; Blocked Term
</span><a href="#local-6989586621682090880"><span class="hs-identifier hs-var hs-var">compileAndRun</span></a></span></span><span> </span><span id="local-6989586621682090939"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090939"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s (Blocked Term)) -&gt; Blocked Term
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Normalisation -&gt; Term -&gt; AM s
forall s. Normalisation -&gt; Term -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">Normalisation
</span><a href="#local-6989586621682090879"><span class="hs-identifier hs-var">normalisation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682090939"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-comment">-- Run the machine in a given state. Prints the state if the right verbosity level is active.</span><span>
</span><span id="line-871"></span><span>    </span><span id="local-6989586621682089545"><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-type">AM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089545"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089545"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-872"></span><span>    </span><span id="local-6989586621682090941"><span class="annot"><span class="annottext">runAM :: forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var hs-var">runAM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090926"><span class="hs-identifier hs-var">doDebug</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682090944"><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682090944"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a. VerboseKey -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AM s -&gt; VerboseKey
forall a. Pretty a =&gt; a -&gt; VerboseKey
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682090944"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682090944"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-873"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span>    </span><span class="hs-comment">-- The main function. This is where the stuff happens!</span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621682090946"><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-type">runAM'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-type">AM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682090946"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682090946"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span>    </span><span class="hs-comment">-- Base case: The focus is a value closure and the control stack is empty. Decode and return.</span><span>
</span><span id="line-879"></span><span>    </span><span id="local-6989586621682090945"><span class="annot"><span class="annottext">runAM' :: forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090945"><span class="hs-identifier hs-var hs-var">runAM'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091049"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091049"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s (Blocked Term)
forall s. Closure s -&gt; ST s (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure"><span class="hs-identifier hs-var">decodeClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091049"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>    </span><span class="hs-comment">-- Unevaluated closure: inspect the term and take the appropriate action. For instance,</span><span>
</span><span id="line-882"></span><span>    </span><span class="hs-comment">--  - Change to the 'Match' state if a definition</span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-comment">--  - Look up in the environment if variable</span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-comment">--  - Perform a beta step if lambda and application elimination in the spine</span><span>
</span><span id="line-885"></span><span>    </span><span class="hs-comment">--  - Perform a record beta step if record constructor and projection elimination in the spine</span><span>
</span><span id="line-886"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span id="local-6989586621682091050"><span class="annot"><span class="annottext">s :: AM s
</span><a href="#local-6989586621682091050"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091051"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091051"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span id="local-6989586621682091052"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091052"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091053"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091054"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091055"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;runAM.Eval&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-887"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091052"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-comment">-- Case: definition. Enter 'Match' state if defined function or shift to evaluating an</span><span>
</span><span id="line-890"></span><span>        </span><span class="hs-comment">-- argument and pushing the appropriate control frame for primitive functions. Fall back to</span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-comment">-- slow reduce for unsupported definitions.</span><span>
</span><span id="line-892"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091057"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091057"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-893"></span><span>          </span><span class="annot"><span class="annottext">Spine s
-&gt; [ControlFrame s] -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall s.
Spine s
-&gt; ControlStack s -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091058"><span class="hs-identifier hs-var">evalIApplyAM</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-894"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompactDef -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var">cdefDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091057"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-895"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CFun"><span class="hs-identifier hs-type">CFun</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cfunCompiled :: CompactDefn -&gt; FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cfunCompiled"><span class="hs-identifier hs-var">cfunCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682091059"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091059"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091057"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091059"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
forall s. [CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-var">:&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091051"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CAxiom"><span class="hs-identifier hs-var">CAxiom</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-897"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CTyCon"><span class="hs-identifier hs-var">CTyCon</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-898"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CCon"><span class="hs-identifier hs-type">CCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>   </span><span class="hs-comment">-- Only happens for builtinSharp (which is a Def when you bind it)</span><span>
</span><span id="line-899"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CForce"><span class="hs-identifier hs-var">CForce</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091062"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091062"><span class="hs-identifier hs-var">spine0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091063"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091063"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091064"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091064"><span class="hs-identifier hs-var">spine1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Spine s -&gt; (Spine s, Spine s)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-900"></span><span>              </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091063"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Spine s -&gt; Spine s -&gt; ControlFrame s
forall s. QName -&gt; Spine s -&gt; Spine s -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ForceK"><span class="hs-identifier hs-var">ForceK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091057"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091062"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091064"><span class="hs-identifier hs-var">spine1</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CForce"><span class="hs-identifier hs-var">CForce</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-comment">-- partially applied</span><span>
</span><span id="line-902"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CErase"><span class="hs-identifier hs-var">CErase</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091067"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091067"><span class="hs-identifier hs-var">spine0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091068"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091068"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091069"><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091069"><span class="hs-identifier hs-var">spine1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091070"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091070"><span class="hs-identifier hs-var">spine2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Spine s -&gt; (Spine s, Spine s)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-903"></span><span>              </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091068"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; ControlFrame s
forall s.
QName -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-var">EraseK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091057"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091067"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091069"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091070"><span class="hs-identifier hs-var">spine2</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CErase"><span class="hs-identifier hs-var">CErase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-comment">-- partially applied</span><span>
</span><span id="line-905"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CPrimOp"><span class="hs-identifier hs-type">CPrimOp</span></a></span><span> </span><span id="local-6989586621682091071"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091071"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682091072"><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682091072"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682091073"><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091073"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091071"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span>                      </span><span class="hs-comment">-- PrimOps can't be over-applied. They don't</span><span>
</span><span id="line-906"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091074"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091074"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091075"><span class="annot"><span class="annottext">[Arg (Pointer s)]
</span><a href="#local-6989586621682091075"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Maybe [Arg (Pointer s)]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- return functions or records.</span><span>
</span><span id="line-907"></span><span>              </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091074"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; ([Literal] -&gt; Term)
-&gt; [Literal]
-&gt; [Pointer s]
-&gt; Maybe FastCompiledClauses
-&gt; ControlFrame s
forall s.
QName
-&gt; ([Literal] -&gt; Term)
-&gt; [Literal]
-&gt; [Pointer s]
-&gt; Maybe FastCompiledClauses
-&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#PrimOpK"><span class="hs-identifier hs-var">PrimOpK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091057"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682091072"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Pointer s) -&gt; [Arg (Pointer s)] -&gt; [Pointer s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pointer s)]
</span><a href="#local-6989586621682091075"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091073"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CPrimOp"><span class="hs-identifier hs-type">CPrimOp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>  </span><span class="hs-comment">-- partially applied</span><span>
</span><span id="line-909"></span><span>            </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#COther"><span class="hs-identifier hs-var">COther</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091050"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>        </span><span class="hs-comment">-- Case: zero. Return value closure with literal 0.</span><span>
</span><span id="line-912"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091078"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091078"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091079"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091079"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; Bool
</span><a href="#local-6989586621682090933"><span class="hs-identifier hs-var">isZero</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091078"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-913"></span><span>          </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-var">LitNat</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-comment">-- Case: suc. Suc is strict in its argument to make sure we return a literal whenever</span><span>
</span><span id="line-916"></span><span>        </span><span class="hs-comment">-- possible. Push a 'NatSucK' frame on the control stack and evaluate the argument.</span><span>
</span><span id="line-917"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091081"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091081"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091082"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091082"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; Bool
</span><a href="#local-6989586621682090935"><span class="hs-identifier hs-var">isSuc</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091081"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091083"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091083"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-918"></span><span>          </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091083"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ControlFrame s] -&gt; [ControlFrame s]
forall s. ControlStack s -&gt; ControlStack s
</span><a href="#local-6989586621682091084"><span class="hs-identifier hs-var">sucCtrl</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>        </span><span class="hs-comment">-- Case: constructor. Perform beta reduction if projected from, otherwise return a value.</span><span>
</span><span id="line-921"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091085"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091085"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091086"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091086"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-922"></span><span>          </span><span class="hs-comment">-- Constructors of types in Prop are not representex as</span><span>
</span><span id="line-923"></span><span>          </span><span class="hs-comment">-- CCon, so this match might fail!</span><span>
</span><span id="line-924"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CCon"><span class="hs-identifier hs-type">CCon</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">cconSrcCon :: CompactDefn -&gt; ConHead
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconSrcCon"><span class="hs-identifier hs-var">cconSrcCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682091087"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091087"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cconArity :: CompactDefn -&gt; Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cconArity"><span class="hs-identifier hs-var">cconArity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682091088"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091088"><span class="hs-identifier hs-var">ar</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompactDef -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var">cdefDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091085"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-925"></span><span>            </span><span class="annot"><span class="annottext">Spine s
-&gt; [ControlFrame s] -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall s.
Spine s
-&gt; ControlStack s -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091058"><span class="hs-identifier hs-var">evalIApplyAM</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-926"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Spine s -&gt; (Spine s, Spine s)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091088"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-927"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682091089"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091089"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091090"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091090"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091091"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091091"><span class="hs-identifier hs-var">spine'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091092"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091091"><span class="hs-identifier hs-var">spine'</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span>  </span><span class="hs-comment">-- Andreas #2170: fit argToDontCare here?!</span><span>
</span><span id="line-929"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-930"></span><span>                  </span><span id="local-6989586621682091093"><span class="annot"><span class="annottext">fields :: [QName]
</span><a href="#local-6989586621682091093"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; QName) -&gt; [Arg QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg QName -&gt; QName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg QName] -&gt; [QName]) -&gt; [Arg QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [Arg QName]
</span><a href="Agda.Syntax.Internal.html#conFields"><span class="hs-identifier hs-var">conFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091085"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-931"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091094"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091094"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-identifier hs-var">List.elemIndex</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091090"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682091093"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-932"></span><span>                  </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091092"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091092"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091089"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Int -&gt; Elim' (Pointer s)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="Agda.Utils.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091094"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-933"></span><span>              </span><span class="annot"><span class="annottext">(Spine s, Spine s)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091087"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091086"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-comment">-- Case: variable. Look up the variable in the environment and evaluate the resulting</span><span>
</span><span id="line-937"></span><span>        </span><span class="hs-comment">-- pointer. If the variable is not in the environment it's a free variable and we adjust the</span><span>
</span><span id="line-938"></span><span>        </span><span class="hs-comment">-- deBruijn index appropriately.</span><span>
</span><span id="line-939"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682091097"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091097"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-940"></span><span>          </span><span class="annot"><span class="annottext">Spine s
-&gt; [ControlFrame s] -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall s.
Spine s
-&gt; ControlStack s -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091058"><span class="hs-identifier hs-var">evalIApplyAM</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-941"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Env s -&gt; Maybe (Pointer s)
forall s. Int -&gt; Env s -&gt; Maybe (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupEnv"><span class="hs-identifier hs-var">lookupEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091097"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-942"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Pointer s)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}.
Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091098"><span class="hs-identifier hs-var">evalValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091097"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Int
forall s. Env s -&gt; Int
</span><a href="Agda.TypeChecking.Reduce.Fast.html#envSize"><span class="hs-identifier hs-var">envSize</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091099"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091099"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091099"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span>        </span><span class="hs-comment">-- Case: lambda. Perform the beta reduction if applied. Otherwise it's a value.</span><span>
</span><span id="line-946"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682091101"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682091101"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682091102"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682091102"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-947"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-948"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-949"></span><span>            </span><span id="local-6989586621682091103"><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091103"><span class="hs-identifier hs-var">elim</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091104"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091104"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-950"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682091102"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-951"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span>   </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091106"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091106"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091107"><span class="hs-identifier hs-var">evalClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091106"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim' (Pointer s) -&gt; Pointer s
forall {e}. Elim' e -&gt; e
</span><a href="#local-6989586621682091108"><span class="hs-identifier hs-var">getArg</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091103"><span class="hs-identifier hs-var">elim</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Env s -&gt; Env s
forall s. Pointer s -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-operator hs-var">`extendEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091104"><span class="hs-identifier hs-var">spine'</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091110"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091110"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091107"><span class="hs-identifier hs-var">evalClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091110"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091104"><span class="hs-identifier hs-var">spine'</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-954"></span><span>            </span><span id="local-6989586621682091108"><span class="annot"><span class="annottext">getArg :: Elim' e -&gt; e
</span><a href="#local-6989586621682091108"><span class="hs-identifier hs-var hs-var">getArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091113"><span class="annot"><span class="annottext">Arg e
</span><a href="#local-6989586621682091113"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg e -&gt; e
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg e
</span><a href="#local-6989586621682091113"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-955"></span><span>            </span><span class="annot"><a href="#local-6989586621682091108"><span class="hs-identifier hs-var">getArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091114"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682091114"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682091114"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-956"></span><span>            </span><span class="annot"><a href="#local-6989586621682091108"><span class="hs-identifier hs-var">getArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>        </span><span class="hs-comment">-- Case: values. Literals and function types are already in weak-head normal form.</span><span>
</span><span id="line-959"></span><span>        </span><span class="hs-comment">-- We throw away the environment for literals mostly to make debug printing less verbose.</span><span>
</span><span id="line-960"></span><span>        </span><span class="hs-comment">-- And we know the spine is empty since literals cannot be applied or projected.</span><span>
</span><span id="line-961"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091052"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-963"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-comment">-- Case: non-empty spine. If the focused term has a non-empty spine, we shift the</span><span>
</span><span id="line-966"></span><span>        </span><span class="hs-comment">-- eliminations onto the spine.</span><span>
</span><span id="line-967"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091117"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091117"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span id="local-6989586621682091118"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091118"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091119"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091117"><span class="hs-identifier hs-var">f</span></a></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091118"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-968"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091120"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091120"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091121"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091121"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682091122"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091122"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091119"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091120"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091121"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091122"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-969"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682091123"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091123"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span id="local-6989586621682091124"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091124"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091119"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091123"><span class="hs-identifier hs-var">x</span></a></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span>      </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091124"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>        </span><span class="hs-comment">-- Case: metavariable. If it's instantiated evaluate the value. Meta instantiations are open</span><span>
</span><span id="line-972"></span><span>        </span><span class="hs-comment">-- terms with a specified list of free variables. buildEnv constructs the appropriate</span><span>
</span><span id="line-973"></span><span>        </span><span class="hs-comment">-- environment for the closure. Avoiding shifting spines for open metas</span><span>
</span><span id="line-974"></span><span>        </span><span class="hs-comment">-- save a bit of performance.</span><span>
</span><span id="line-975"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621682091126"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682091126"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682091127"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091127"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Spine s
-&gt; [ControlFrame s] -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall s.
Spine s
-&gt; ControlStack s -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091058"><span class="hs-identifier hs-var">evalIApplyAM</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091054"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-976"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Maybe MetaInstantiation
</span><a href="#local-6989586621682090896"><span class="hs-identifier hs-var">getMetaInst</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682091126"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-977"></span><span>            </span><span class="annot"><span class="annottext">Maybe MetaInstantiation
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-978"></span><span>              </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; () -&gt; Blocked_
forall a t. MetaId -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#blocked"><span class="hs-identifier hs-var">blocked</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682091126"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091051"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InstV"><span class="hs-identifier hs-type">InstV</span></a></span><span> </span><span id="local-6989586621682091130"><span class="annot"><span class="annottext">Instantiation
</span><a href="#local-6989586621682091130"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-980"></span><span>              </span><span id="local-6989586621682091131"><span class="annot"><a href="#local-6989586621682091131"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Elims -&gt; ST s (Spine s)
forall s. Env s -&gt; Elims -&gt; ST s (Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-var">elimsToSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091053"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091127"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-981"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091132"><span class="annot"><a href="#local-6989586621682091132"><span class="hs-identifier hs-var">zs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682091133"><span class="annot"><a href="#local-6989586621682091133"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682091134"><span class="annot"><a href="#local-6989586621682091134"><span class="hs-identifier hs-var">spine''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#buildEnv"><span class="hs-identifier hs-type">buildEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#instTel"><span class="hs-identifier hs-var">instTel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091130"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091131"><span class="hs-identifier hs-type">spine'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682091054"><span class="hs-identifier hs-type">spine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span>              </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091107"><span class="hs-identifier hs-type">evalClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091136"><span class="hs-identifier hs-type">lams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091132"><span class="hs-identifier hs-type">zs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#instBody"><span class="hs-identifier hs-var">instBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091130"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682091133"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091134"><span class="hs-identifier hs-type">spine''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091055"><span class="hs-identifier hs-type">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OpenMeta"><span class="hs-identifier hs-type">OpenMeta</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-984"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BlockedConst"><span class="hs-identifier hs-type">BlockedConst</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-985"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PostponedTypeCheckingProblem"><span class="hs-identifier hs-type">PostponedTypeCheckingProblem</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-comment">-- Case: unsupported. These terms are not handled by the abstract machine, so we fall back</span><span>
</span><span id="line-988"></span><span>        </span><span class="hs-comment">-- to slowReduceTerm for these.</span><span>
</span><span id="line-989"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091050"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-990"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091050"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-991"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091050"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091061"><span class="annot"><span class="annottext">done :: AM s
</span><a href="#local-6989586621682091061"><span class="hs-identifier hs-var hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091051"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091055"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-994"></span><span>            </span><span id="local-6989586621682091119"><span class="annot"><span class="annottext">shiftElims :: Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091119"><span class="hs-identifier hs-var hs-var">shiftElims</span></a></span></span><span> </span><span id="local-6989586621682091144"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091144"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091145"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091145"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span id="local-6989586621682091146"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091146"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091147"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091147"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-995"></span><span>              </span><span id="local-6989586621682091148"><span class="annot"><a href="#local-6989586621682091148"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Elims -&gt; ST s (Spine s)
forall s. Env s -&gt; Elims -&gt; ST s (Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-var">elimsToSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091146"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091147"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-996"></span><span>              </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091107"><span class="hs-identifier hs-type">evalClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091144"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091145"><span class="hs-identifier hs-type">env0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091148"><span class="hs-identifier hs-type">spine'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682091054"><span class="hs-identifier hs-type">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682091055"><span class="hs-identifier hs-type">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span>    </span><span class="hs-comment">-- If the current focus is a value closure, we look at the control stack.</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>    </span><span class="hs-comment">-- Case NormaliseK: The focus is a weak-head value that should be fully normalised.</span><span>
</span><span id="line-1001"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span id="local-6989586621682091149"><span class="annot"><span class="annottext">s :: AM s
</span><a href="#local-6989586621682091149"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091150"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091150"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621682091151"><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091151"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682091152"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091152"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091153"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091153"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091154"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091154"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091155"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091155"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1002"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091152"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1003"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Closure s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091156"><span class="hs-identifier hs-var">normaliseArgsAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091151"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091152"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091154"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091155"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1004"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Closure s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091156"><span class="hs-identifier hs-var">normaliseArgsAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091151"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091152"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091154"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091155"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1005"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Closure s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091156"><span class="hs-identifier hs-var">normaliseArgsAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091151"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091152"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091154"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091155"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1006"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Closure s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091156"><span class="hs-identifier hs-var">normaliseArgsAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091151"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091152"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091154"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091155"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091157"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>        </span><span class="hs-comment">-- We might get these from fallbackAM</span><span>
</span><span id="line-1011"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091158"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091158"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span id="local-6989586621682091159"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091159"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091160"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091158"><span class="hs-identifier hs-var">f</span></a></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091153"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091159"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1012"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091161"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091161"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091162"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091162"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682091163"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091163"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091160"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091161"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091162"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091153"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091163"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1013"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682091164"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091164"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span id="local-6989586621682091165"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091165"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091160"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091164"><span class="hs-identifier hs-var">x</span></a></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091153"><span class="hs-identifier hs-var">env</span></a></span><span>      </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091153"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091165"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1014"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621682091166"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682091166"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682091167"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091167"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091160"><span class="hs-identifier hs-var">shiftElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682091166"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091153"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091167"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091149"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-comment">-- fallbackAM knows about NormaliseK</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091157"><span class="annot"><span class="annottext">done :: AM s
</span><a href="#local-6989586621682091157"><span class="hs-identifier hs-var hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091150"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091155"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1019"></span><span>            </span><span id="local-6989586621682091160"><span class="annot"><span class="annottext">shiftElims :: Term -&gt; Env s -&gt; Env s -&gt; Elims -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091160"><span class="hs-identifier hs-var hs-var">shiftElims</span></a></span></span><span> </span><span id="local-6989586621682091168"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091168"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091169"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091169"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span id="local-6989586621682091170"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091170"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091171"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091171"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>              </span><span id="local-6989586621682091172"><span class="annot"><a href="#local-6989586621682091172"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Elims -&gt; ST s (Spine s)
forall s. Env s -&gt; Elims -&gt; ST s (Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-var">elimsToSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091170"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091171"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1021"></span><span>              </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091151"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091168"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091169"><span class="hs-identifier hs-type">env0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091172"><span class="hs-identifier hs-type">spine'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682091154"><span class="hs-identifier hs-type">spine</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-type">NormaliseK</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682091155"><span class="hs-identifier hs-type">ctrl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span>    </span><span class="hs-comment">-- Case: ArgK: We successfully normalised an argument. Start on the next argument, or if there</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-comment">-- isn't one we're done.</span><span>
</span><span id="line-1025"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091173"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091173"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ArgK"><span class="hs-identifier hs-type">ArgK</span></a></span><span> </span><span id="local-6989586621682091174"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091174"><span class="hs-identifier hs-var">cl0</span></a></span></span><span> </span><span id="local-6989586621682091175"><span class="annot"><span class="annottext">SpineContext s
</span><a href="#local-6989586621682091175"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091176"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091176"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1026"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Element (SpineContext s)
-&gt; SpineContext s
-&gt; Either
     (Carrier (SpineContext s))
     (Element (SpineContext s), SpineContext s)
forall z.
Zipper z =&gt;
Element z -&gt; z -&gt; Either (Carrier z) (Element z, z)
</span><a href="Agda.Utils.Zipper.html#nextHole"><span class="hs-identifier hs-var">nextHole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091173"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpineContext s
</span><a href="#local-6989586621682091175"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1027"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682091177"><span class="annot"><span class="annottext">Carrier (SpineContext s)
</span><a href="#local-6989586621682091177"><span class="hs-identifier hs-var">spine</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; Closure s
forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply_"><span class="hs-identifier hs-var">clApply_</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091174"><span class="hs-identifier hs-var">cl0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
Carrier (SpineContext s)
</span><a href="#local-6989586621682091177"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091176"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091178"><span class="annot"><span class="annottext">Element (SpineContext s)
</span><a href="#local-6989586621682091178"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682091179"><span class="annot"><span class="annottext">SpineContext s
</span><a href="#local-6989586621682091179"><span class="hs-identifier hs-var">cxt'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Element (SpineContext s)
Pointer s
</span><a href="#local-6989586621682091178"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ControlFrame s
forall s. ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; SpineContext s -&gt; ControlFrame s
forall s. Closure s -&gt; SpineContext s -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ArgK"><span class="hs-identifier hs-var">ArgK</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091174"><span class="hs-identifier hs-var">cl0</span></a></span><span> </span><span class="annot"><span class="annottext">SpineContext s
</span><a href="#local-6989586621682091179"><span class="hs-identifier hs-var">cxt'</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091176"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>    </span><span class="hs-comment">-- Case: NatSucK m</span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>    </span><span class="hs-comment">-- If literal add m to the literal,</span><span>
</span><span id="line-1033"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091180"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091180"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682091181"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091181"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-type">NatSucK</span></a></span><span> </span><span id="local-6989586621682091182"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091182"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091183"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091183"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1034"></span><span>      </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; Literal -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-var">LitNat</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Literal) -&gt; Integer -&gt; Literal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091182"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091181"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091183"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span>    </span><span class="hs-comment">-- otherwise apply 'suc' m times.</span><span>
</span><span id="line-1037"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091184"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091184"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-type">NatSucK</span></a></span><span> </span><span id="local-6989586621682091185"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091185"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091186"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091186"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1038"></span><span>        </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; Closure s) -&gt; Closure s -&gt; Closure s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091187"><span class="hs-identifier hs-var">plus</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091185"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091184"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091186"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1039"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1040"></span><span>        </span><span id="local-6989586621682091187"><span class="annot"><span class="annottext">plus :: Integer -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091187"><span class="hs-identifier hs-var hs-var">plus</span></a></span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621682091188"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091188"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091188"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1041"></span><span>        </span><span class="annot"><a href="#local-6989586621682091187"><span class="hs-identifier hs-var">plus</span></a></span><span> </span><span id="local-6989586621682091189"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091189"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682091190"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091190"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1042"></span><span>          </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="#local-6989586621682091191"><span class="hs-identifier hs-var">trueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; Maybe ConHead -&gt; ConHead
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">ConHead
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090930"><span class="hs-identifier hs-var">suc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Spine s -&gt; Closure s) -&gt; Spine s -&gt; Closure s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1043"></span><span>                     </span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091194"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elim' (Pointer s) -&gt; Spine s -&gt; Spine s
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1044"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091194"><span class="annot"><span class="annottext">arg :: Pointer s
</span><a href="#local-6989586621682091194"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091187"><span class="hs-identifier hs-var">plus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091189"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091190"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span>    </span><span class="hs-comment">-- Case: PrimOpK</span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-comment">-- If literal apply the primitive function if no more arguments, otherwise</span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-comment">-- store the literal in the continuation and evaluate the next argument.</span><span>
</span><span id="line-1050"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682091195"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091195"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#PrimOpK"><span class="hs-identifier hs-type">PrimOpK</span></a></span><span> </span><span id="local-6989586621682091196"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091196"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682091197"><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682091197"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682091198"><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091198"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682091199"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091199"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682091200"><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091200"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091201"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091201"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1051"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091199"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1052"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682091197"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091195"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; [Literal] -&gt; [Literal]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091198"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091201"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1053"></span><span>        </span><span id="local-6989586621682091202"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091202"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091203"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091203"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091202"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; ([Literal] -&gt; Term)
-&gt; [Literal]
-&gt; [Pointer s]
-&gt; Maybe FastCompiledClauses
-&gt; ControlFrame s
forall s.
QName
-&gt; ([Literal] -&gt; Term)
-&gt; [Literal]
-&gt; [Pointer s]
-&gt; Maybe FastCompiledClauses
-&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#PrimOpK"><span class="hs-identifier hs-var">PrimOpK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091196"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><a href="#local-6989586621682091197"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091195"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; [Literal] -&gt; [Literal]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091198"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091203"><span class="hs-identifier hs-var">es'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091200"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091201"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span>
</span><span id="line-1055"></span><span>    </span><span class="hs-comment">-- If not a literal we use the case tree if there is one, otherwise we are stuck.</span><span>
</span><span id="line-1056"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091204"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091204"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621682091205"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091205"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#PrimOpK"><span class="hs-identifier hs-type">PrimOpK</span></a></span><span> </span><span id="local-6989586621682091206"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091206"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091207"><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091207"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682091208"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091208"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682091209"><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091209"><span class="hs-identifier hs-var">mcc</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091210"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091210"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1057"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091209"><span class="hs-identifier hs-var">mcc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1058"></span><span>        </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091211"><span class="hs-identifier hs-var">stuck</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091210"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091212"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091212"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091206"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091212"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091213"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
forall s. [CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-var">:&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091214"><span class="hs-identifier hs-var">notstuck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091210"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1061"></span><span>        </span><span id="local-6989586621682091215"><span class="annot"><span class="annottext">p :: Pointer s
</span><a href="#local-6989586621682091215"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091204"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1062"></span><span>        </span><span id="local-6989586621682091216"><span class="annot"><span class="annottext">lits :: [Pointer s]
</span><a href="#local-6989586621682091216"><span class="hs-identifier hs-var hs-var">lits</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Pointer s) -&gt; [Literal] -&gt; [Pointer s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; Pointer s)
-&gt; (Literal -&gt; Closure s) -&gt; Literal -&gt; Pointer s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Closure s
forall {s}. Literal -&gt; Closure s
</span><a href="#local-6989586621682091217"><span class="hs-identifier hs-var">litClos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Literal] -&gt; [Literal]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091207"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>        </span><span id="local-6989586621682091213"><span class="annot"><span class="annottext">spine :: Spine s
</span><a href="#local-6989586621682091213"><span class="hs-identifier hs-var hs-var">spine</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; Elim' (Pointer s)) -&gt; [Pointer s] -&gt; Spine s
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; (Pointer s -&gt; Arg (Pointer s)) -&gt; Pointer s -&gt; Elim' (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Pointer s] -&gt; Spine s) -&gt; [Pointer s] -&gt; Spine s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091216"><span class="hs-identifier hs-var">lits</span></a></span><span> </span><span class="annot"><span class="annottext">[Pointer s] -&gt; [Pointer s] -&gt; [Pointer s]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091215"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Pointer s] -&gt; [Pointer s] -&gt; [Pointer s]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091208"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1064"></span><span>        </span><span id="local-6989586621682091211"><span class="annot"><span class="annottext">stuck :: Closure s
</span><a href="#local-6989586621682091211"><span class="hs-identifier hs-var hs-var">stuck</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091205"><span class="hs-identifier hs-var">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091206"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091213"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-1065"></span><span>        </span><span id="local-6989586621682091214"><span class="annot"><span class="annottext">notstuck :: Closure s
</span><a href="#local-6989586621682091214"><span class="hs-identifier hs-var hs-var">notstuck</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091206"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091213"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-1066"></span><span>        </span><span id="local-6989586621682091217"><span class="annot"><span class="annottext">litClos :: Literal -&gt; Closure s
</span><a href="#local-6989586621682091217"><span class="hs-identifier hs-var hs-var">litClos</span></a></span></span><span> </span><span id="local-6989586621682091219"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091219"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="#local-6989586621682091191"><span class="hs-identifier hs-var">trueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091219"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span>    </span><span class="hs-comment">-- Case: ForceK. Here we need to check if the argument is a canonical form (i.e. not a variable</span><span>
</span><span id="line-1069"></span><span>    </span><span class="hs-comment">-- or stuck function call) and if so apply the function argument to the value. If it's not</span><span>
</span><span id="line-1070"></span><span>    </span><span class="hs-comment">-- canonical we are stuck.</span><span>
</span><span id="line-1071"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091220"><span class="annot"><span class="annottext">arg :: Closure s
</span><a href="#local-6989586621682091220"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621682091221"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091221"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091222"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091222"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ForceK"><span class="hs-identifier hs-type">ForceK</span></a></span><span> </span><span id="local-6989586621682091223"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091223"><span class="hs-identifier hs-var">pf</span></a></span></span><span> </span><span id="local-6989586621682091224"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091224"><span class="hs-identifier hs-var">spine0</span></a></span></span><span> </span><span id="local-6989586621682091225"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091225"><span class="hs-identifier hs-var">spine1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091226"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091226"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="#local-6989586621682091227"><span class="hs-identifier hs-var">isCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091222"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1073"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091225"><span class="hs-identifier hs-var">spine1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1074"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091228"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091228"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091229"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091229"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1075"></span><span>            </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091228"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091230"><span class="hs-identifier hs-var">elim</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' (Pointer s) -&gt; Spine s -&gt; Spine s
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091229"><span class="hs-identifier hs-var">spine'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091226"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1076"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Partial application of primForce to canonical argument, return &#955; k &#8594; k arg.</span><span>
</span><span id="line-1077"></span><span>            </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg VerboseKey -&gt; Term -&gt; Term
</span><a href="#local-6989586621682091231"><span class="hs-identifier hs-var">lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey -&gt; Arg VerboseKey
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;k&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; Arg Term -&gt; Elim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; Term -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091232"><span class="hs-identifier hs-var">argPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Env s -&gt; Env s
forall s. Pointer s -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-operator hs-var">`extendEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091226"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>          </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1080"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091233"><span class="hs-identifier hs-var">stuck</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091226"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1082"></span><span>        </span><span id="local-6989586621682091232"><span class="annot"><span class="annottext">argPtr :: Pointer s
</span><a href="#local-6989586621682091232"><span class="hs-identifier hs-var hs-var">argPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091220"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1083"></span><span>        </span><span id="local-6989586621682091230"><span class="annot"><span class="annottext">elim :: Elim' (Pointer s)
</span><a href="#local-6989586621682091230"><span class="hs-identifier hs-var hs-var">elim</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091232"><span class="hs-identifier hs-var">argPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>        </span><span id="local-6989586621682091234"><span class="annot"><span class="annottext">spine' :: Spine s
</span><a href="#local-6989586621682091234"><span class="hs-identifier hs-var hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091224"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091230"><span class="hs-identifier hs-var">elim</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091225"><span class="hs-identifier hs-var">spine1</span></a></span><span>
</span><span id="line-1085"></span><span>        </span><span id="local-6989586621682091233"><span class="annot"><span class="annottext">stuck :: Closure s
</span><a href="#local-6989586621682091233"><span class="hs-identifier hs-var hs-var">stuck</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091221"><span class="hs-identifier hs-var">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091223"><span class="hs-identifier hs-var">pf</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091234"><span class="hs-identifier hs-var">spine'</span></a></span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>        </span><span id="local-6989586621682091227"><span class="annot"><span class="annottext">isCanonical :: Term -&gt; Bool
</span><a href="#local-6989586621682091227"><span class="hs-identifier hs-var hs-var">isCanonical</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1088"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1089"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1090"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1091"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1092"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1093"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1094"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1095"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1096"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1097"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1098"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091235"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091235"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-comment">-- Type constructors (data/record) are considered canonical for 'primForce'.</span><span>
</span><span id="line-1099"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CTyCon"><span class="hs-identifier hs-var">CTyCon</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompactDef -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var">cdefDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091235"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1100"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-comment">-- Case: EraseK. We evaluate both arguments to values, then do a simple check for the easy</span><span>
</span><span id="line-1103"></span><span>    </span><span class="hs-comment">-- cases and otherwise fall back to slow reduce.</span><span>
</span><span id="line-1104"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091236"><span class="annot"><span class="annottext">cl2 :: Closure s
</span><a href="#local-6989586621682091236"><span class="hs-identifier hs-var">cl2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621682091237"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091237"><span class="hs-identifier hs-var">arg2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-type">EraseK</span></a></span><span> </span><span id="local-6989586621682091238"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091238"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682091239"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091239"><span class="hs-identifier hs-var">spine0</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091240"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091240"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091241"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091241"><span class="hs-identifier hs-var">spine3</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091242"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091242"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1105"></span><span>      </span><span id="local-6989586621682091243"><span class="annot"><a href="#local-6989586621682091243"><span class="hs-identifier hs-var">cl1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091244"><span class="annot"><a href="#local-6989586621682091244"><span class="hs-identifier hs-var">arg1</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091245"><span class="annot"><a href="#local-6989586621682091245"><span class="hs-identifier hs-var">sp1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; ST s (Closure s)
forall s. Pointer s -&gt; ST s (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#derefPointer_"><span class="hs-identifier hs-var">derefPointer_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091240"><span class="hs-identifier hs-var">p1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091244"><span class="hs-identifier hs-type">arg1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682091237"><span class="hs-identifier hs-type">arg2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1107"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682091246"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091246"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682091247"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091247"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091246"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091247"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ConHead -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090937"><span class="hs-identifier hs-var">refl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1108"></span><span>          </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var">evalTrueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ConHead -&gt; ConHead
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090937"><span class="hs-identifier hs-var">refl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091242"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1109"></span><span>        </span><span class="annot"><span class="annottext">(Term, Term)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1110"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682091250"><span class="annot"><span class="annottext">spine :: Spine s
</span><a href="#local-6989586621682091250"><span class="hs-identifier hs-var hs-var">spine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091239"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; Elim' (Pointer s)) -&gt; [Closure s] -&gt; Spine s
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; (Closure s -&gt; Arg (Pointer s)) -&gt; Closure s -&gt; Elim' (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Arg (Pointer s)
forall a. LensHiding a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#hide"><span class="hs-identifier hs-var">hide</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Arg (Pointer s))
-&gt; (Closure s -&gt; Arg (Pointer s)) -&gt; Closure s -&gt; Arg (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; Arg (Pointer s))
-&gt; (Closure s -&gt; Pointer s) -&gt; Closure s -&gt; Arg (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091243"><span class="hs-identifier hs-var">cl1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091236"><span class="hs-identifier hs-var">cl2</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091241"><span class="hs-identifier hs-var">spine3</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1111"></span><span>          </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; [ControlFrame s] -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091107"><span class="hs-identifier hs-var">evalClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091238"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091250"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091242"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091252"><span class="annot"><span class="annottext">cl1 :: Closure s
</span><a href="#local-6989586621682091252"><span class="hs-identifier hs-var">cl1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-type">EraseK</span></a></span><span> </span><span id="local-6989586621682091253"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091253"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682091254"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091254"><span class="hs-identifier hs-var">spine0</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091255"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091255"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621682091256"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091256"><span class="hs-identifier hs-var">spine3</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091257"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091257"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1113"></span><span>      </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091255"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; ControlFrame s
forall s.
QName -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; Spine s -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-var">EraseK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091253"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091254"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Arg (Pointer s)
forall a. LensHiding a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#hide"><span class="hs-identifier hs-var">hide</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Arg (Pointer s))
-&gt; Arg (Pointer s) -&gt; Arg (Pointer s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; Arg (Pointer s)) -&gt; Pointer s -&gt; Arg (Pointer s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091252"><span class="hs-identifier hs-var">cl1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091256"><span class="hs-identifier hs-var">spine3</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091257"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-type">EraseK</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1115"></span><span>      </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1116"></span><span>
</span><span id="line-1117"></span><span>    </span><span class="hs-comment">-- Case: UpdateThunk. Write the value to the pointers in the UpdateThunk frame.</span><span>
</span><span id="line-1118"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091258"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091258"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#UpdateThunk"><span class="hs-identifier hs-type">UpdateThunk</span></a></span><span> </span><span id="local-6989586621682091259"><span class="annot"><span class="annottext">[STPointer s]
</span><a href="#local-6989586621682091259"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091260"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091260"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1119"></span><span>      </span><span class="annot"><span class="annottext">(STPointer s -&gt; ST s ()) -&gt; [STPointer s] -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STPointer s -&gt; Closure s -&gt; ST s ()
forall s. STPointer s -&gt; Closure s -&gt; ST s ()
</span><a href="Agda.TypeChecking.Reduce.Fast.html#storePointer"><span class="hs-operator hs-var">`storePointer`</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091258"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[STPointer s]
</span><a href="#local-6989586621682091259"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">ST s () -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. ST s a -&gt; ST s b -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091258"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091260"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span>    </span><span class="hs-comment">-- Case: ApplyK. Application after thunk update. Add the spine from the control frame to the</span><span>
</span><span id="line-1122"></span><span>    </span><span class="hs-comment">-- closure.</span><span>
</span><span id="line-1123"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091262"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091262"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyK"><span class="hs-identifier hs-type">ApplyK</span></a></span><span> </span><span id="local-6989586621682091263"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091263"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091264"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091264"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1124"></span><span>      </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; Closure s
forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply"><span class="hs-identifier hs-var">clApply</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091262"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091263"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091264"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>    </span><span class="hs-comment">-- Case: CaseK. Pattern matching against a value. If it's a stuck value the pattern match is</span><span>
</span><span id="line-1127"></span><span>    </span><span class="hs-comment">-- stuck and we return the closure from the match stack (see stuckMatch). Otherwise we need to</span><span>
</span><span id="line-1128"></span><span>    </span><span class="hs-comment">-- find a matching branch switch to the Match state. If there is no matching branch we look for</span><span>
</span><span id="line-1129"></span><span>    </span><span class="hs-comment">-- a Catchall in the match stack, or fail if there isn't one (see failedMatch). If the current</span><span>
</span><span id="line-1130"></span><span>    </span><span class="hs-comment">-- branches contain a catch-all case we need to push a Catchall on the match stack if picking</span><span>
</span><span id="line-1131"></span><span>    </span><span class="hs-comment">-- one of the other branches.</span><span>
</span><span id="line-1132"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091265"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091265"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621682091266"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091266"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091267"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091267"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091268"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091268"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091269"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091269"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091270"><span class="annot"><span class="annottext">ctrl0 :: [ControlFrame s]
</span><a href="#local-6989586621682091270"><span class="hs-identifier hs-var">ctrl0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CaseK"><span class="hs-identifier hs-type">CaseK</span></a></span><span> </span><span id="local-6989586621682091271"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682091272"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682091272"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682091273"><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621682091274"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091274"><span class="hs-identifier hs-var">spine0</span></a></span></span><span> </span><span id="local-6989586621682091275"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091275"><span class="hs-identifier hs-var">spine1</span></a></span></span><span> </span><span id="local-6989586621682091276"><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091277"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1133"></span><span>      </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;runAM.CaseK&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1134"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091266"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1135"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[()] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-glyph">|</span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091267"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091279"><span class="hs-identifier hs-var">stuck</span></a></span><span> </span><span class="hs-comment">-- we might as well check the blocking tag first</span><span>
</span><span id="line-1136"></span><span>        </span><span class="annot"><span class="annottext">Blocked_
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091267"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1137"></span><span>          </span><span class="hs-comment">-- Case: suc constructor</span><span>
</span><span id="line-1138"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091280"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091280"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091281"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091281"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; Bool
</span><a href="#local-6989586621682090935"><span class="hs-identifier hs-var">isSuc</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091280"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091282"><span class="hs-identifier hs-var">matchSuc</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>          </span><span class="hs-comment">-- Case: constructor</span><span>
</span><span id="line-1141"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091285"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091285"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091286"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091286"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; ConInfo -&gt; Int -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091287"><span class="hs-identifier hs-var">matchCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091285"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091286"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091269"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>          </span><span class="hs-comment">-- Case: non-empty elims. We can get here from a fallback (which builds a value without</span><span>
</span><span id="line-1144"></span><span>          </span><span class="hs-comment">-- shifting arguments onto spine)</span><span>
</span><span id="line-1145"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091288"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091288"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091289"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091289"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682091290"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091290"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1146"></span><span>            </span><span id="local-6989586621682091291"><span class="annot"><a href="#local-6989586621682091291"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Elims -&gt; ST s (Spine s)
forall s. Env s -&gt; Elims -&gt; ST s (Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-var">elimsToSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091268"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091290"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1147"></span><span>            </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091098"><span class="hs-identifier hs-type">evalValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091266"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091288"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091289"><span class="hs-identifier hs-type">ci</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-type">emptyEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091291"><span class="hs-identifier hs-type">spine'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682091269"><span class="hs-identifier hs-type">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682091270"><span class="hs-identifier hs-type">ctrl0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1148"></span><span>          </span><span class="hs-comment">-- Case: natural number literals. Literal natural number patterns are translated to</span><span>
</span><span id="line-1149"></span><span>          </span><span class="hs-comment">-- suc-matches, so there is no need to try matchLit.</span><span>
</span><span id="line-1150"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091292"><span class="hs-identifier hs-var">matchLitZero</span></a></span><span>  </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1151"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span> </span><span id="local-6989586621682091293"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091293"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091294"><span class="hs-identifier hs-var">matchLitSuc</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091293"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span>          </span><span class="hs-comment">-- Case: literal</span><span>
</span><span id="line-1154"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682091295"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091295"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091296"><span class="hs-identifier hs-var">matchLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091295"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span>          </span><span class="hs-comment">-- Case: hcomp</span><span>
</span><span id="line-1157"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091297"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091297"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe FastCompiledClauses -&gt; Bool)
-&gt; Maybe FastCompiledClauses -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. QName -&gt; FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-identifier hs-var">lookupCon</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091297"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Int -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091298"><span class="hs-identifier hs-var">matchCon'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091297"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091269"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1158"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091299"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091299"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682091300"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091300"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe FastCompiledClauses -&gt; Bool)
-&gt; Maybe FastCompiledClauses -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. QName -&gt; FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-identifier hs-var">lookupCon</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091299"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1159"></span><span>            </span><span id="local-6989586621682091301"><span class="annot"><a href="#local-6989586621682091301"><span class="hs-identifier hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Elims -&gt; ST s (Spine s)
forall s. Env s -&gt; Elims -&gt; ST s (Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#elimsToSpine"><span class="hs-identifier hs-var">elimsToSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091268"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682091300"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1160"></span><span>            </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091098"><span class="hs-identifier hs-type">evalValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091266"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091299"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-type">emptyEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091301"><span class="hs-identifier hs-type">spine'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682091269"><span class="hs-identifier hs-type">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682091270"><span class="hs-identifier hs-type">ctrl0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>          </span><span class="hs-comment">-- Case: not constructor or literal. In this case we are stuck.</span><span>
</span><span id="line-1163"></span><span>          </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091279"><span class="hs-identifier hs-var">stuck</span></a></span><span>
</span><span id="line-1164"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1165"></span><span>        </span><span class="hs-comment">-- If ffallThrough is set we take the catch-all (if any) rather than being stuck. I think</span><span>
</span><span id="line-1166"></span><span>        </span><span class="hs-comment">-- this happens for partial functions with --cubical (@saizan: is this true?).</span><span>
</span><span id="line-1167"></span><span>        </span><span id="local-6989586621682091279"><span class="annot"><span class="annottext">stuck :: ST s (Blocked Term)
</span><a href="#local-6989586621682091279"><span class="hs-identifier hs-var hs-var">stuck</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Bool
forall c. FastCase c -&gt; Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ffallThrough"><span class="hs-identifier hs-var">ffallThrough</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var">matchCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091302"><span class="hs-identifier hs-var">reallyStuck</span></a></span><span>
</span><span id="line-1168"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091302"><span class="hs-identifier hs-var">reallyStuck</span></a></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>        </span><span id="local-6989586621682091302"><span class="annot"><span class="annottext">reallyStuck :: ST s (Blocked Term)
</span><a href="#local-6989586621682091302"><span class="hs-identifier hs-var hs-var">reallyStuck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1171"></span><span>            </span><span class="hs-comment">-- Compute new reason for being stuck. See Agda.Syntax.Internal.stuckOn for the logic.</span><span>
</span><span id="line-1172"></span><span>            </span><span id="local-6989586621682091303"><span class="annot"><a href="#local-6989586621682091303"><span class="hs-identifier hs-var">blk'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091266"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1173"></span><span>                      </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; ST s Blocked_
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091266"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-1174"></span><span>                      </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span id="local-6989586621682091305"><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="#local-6989586621682091305"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s Term
forall s. Closure s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure_"><span class="hs-identifier hs-var">decodeClosure_</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091265"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">ST s Term -&gt; (Term -&gt; Blocked_) -&gt; ST s Blocked_
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091306"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091306"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim -&gt; NotBlocked' Term -&gt; NotBlocked' Term
forall t. Elim' t -&gt; NotBlocked' t -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#stuckOn"><span class="hs-identifier hs-var">stuckOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; Arg Term -&gt; Elim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682091272"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091306"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="#local-6989586621682091305"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>            </span><span class="annot"><a href="#local-6989586621682091308"><span class="hs-identifier hs-type">stuckMatch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091303"><span class="hs-identifier hs-type">blk'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091276"><span class="hs-identifier hs-type">stack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091277"><span class="hs-identifier hs-type">ctrl</span></a></span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span>        </span><span class="hs-comment">-- This the spine at this point in the matching. A catch-all match doesn't change the spine.</span><span>
</span><span id="line-1178"></span><span>        </span><span id="local-6989586621682091309"><span class="annot"><span class="annottext">catchallSpine :: Spine s
</span><a href="#local-6989586621682091309"><span class="hs-identifier hs-var hs-var">catchallSpine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091274"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Pointer s -&gt; Arg (Pointer s)
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682091272"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091310"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091275"><span class="hs-identifier hs-var">spine1</span></a></span><span>
</span><span id="line-1179"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091310"><span class="annot"><span class="annottext">p :: Pointer s
</span><a href="#local-6989586621682091310"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091265"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-comment">-- cl is already a value so no need to thunk it.</span><span>
</span><span id="line-1180"></span><span>
</span><span id="line-1181"></span><span>        </span><span class="hs-comment">-- Push catch-all frame on the match stack if there is a catch-all (and we're not taking it</span><span>
</span><span id="line-1182"></span><span>        </span><span class="hs-comment">-- right now).</span><span>
</span><span id="line-1183"></span><span>        </span><span id="local-6989586621682091311"><span class="annot"><span class="annottext">catchallStack :: MatchStack s
</span><a href="#local-6989586621682091311"><span class="hs-identifier hs-var hs-var">catchallStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fcatchallBranch"><span class="hs-identifier hs-var">fcatchallBranch</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1184"></span><span>          </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-1185"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091312"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091312"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses -&gt; Spine s -&gt; CatchallFrame s
forall s. FastCompiledClauses -&gt; Spine s -&gt; CatchallFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Catchall"><span class="hs-identifier hs-var">Catchall</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091312"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091309"><span class="hs-identifier hs-var">catchallSpine</span></a></span><span> </span><span class="annot"><span class="annottext">CatchallFrame s -&gt; MatchStack s -&gt; MatchStack s
forall s. CatchallFrame s -&gt; MatchStack s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3E%3A"><span class="hs-operator hs-var">&gt;:</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>        </span><span class="hs-comment">-- The matchX functions below all take an extra argument which is what to do if there is no</span><span>
</span><span id="line-1188"></span><span>        </span><span class="hs-comment">-- appropriate branch in the case tree. ifJust is maybe with a different argument order</span><span>
</span><span id="line-1189"></span><span>        </span><span class="hs-comment">-- letting you chain a bunch if maybe matches in if-then-elseif fashion.</span><span>
</span><span id="line-1190"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682091313"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682091313"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682091314"><span class="annot"><span class="annottext">ifJust :: Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621682091314"><span class="hs-operator hs-var hs-var">`ifJust`</span></a></span></span><span> </span><span id="local-6989586621682091315"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682091315"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091316"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682091316"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682091316"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682091315"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682091313"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span>        </span><span class="hs-comment">-- Matching constructor: Switch to the Match state, inserting the constructor arguments in</span><span>
</span><span id="line-1193"></span><span>        </span><span class="hs-comment">-- the spine between spine0 and spine1.</span><span>
</span><span id="line-1194"></span><span>        </span><span id="local-6989586621682091287"><span class="annot"><span class="annottext">matchCon :: ConHead
-&gt; ConInfo -&gt; Int -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091287"><span class="hs-identifier hs-var hs-var">matchCon</span></a></span></span><span> </span><span id="local-6989586621682091318"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091318"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091319"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682091319"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682091320"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091320"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Int -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091298"><span class="hs-identifier hs-var">matchCon'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091318"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091320"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-1195"></span><span>        </span><span id="local-6989586621682091298"><span class="annot"><span class="annottext">matchCon' :: QName -&gt; Int -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091298"><span class="hs-identifier hs-var hs-var">matchCon'</span></a></span></span><span> </span><span id="local-6989586621682091321"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091321"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682091322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091322"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. QName -&gt; FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-identifier hs-var">lookupCon</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091321"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; (FastCompiledClauses -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term)
-&gt; ST s (Blocked Term)
forall {a} {b}. Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621682091314"><span class="hs-operator hs-var">`ifJust`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091323"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091323"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1196"></span><span>          </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091323"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091274"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091269"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091275"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091311"><span class="hs-identifier hs-var">catchallStack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>        </span><span class="hs-comment">-- Catch-all: Don't add a Catchall to the match stack since this _is_ the catch-all.</span><span>
</span><span id="line-1199"></span><span>        </span><span id="local-6989586621682091283"><span class="annot"><span class="annottext">matchCatchall :: ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091283"><span class="hs-identifier hs-var hs-var">matchCatchall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fcatchallBranch"><span class="hs-identifier hs-var">fcatchallBranch</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; (FastCompiledClauses -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term)
-&gt; ST s (Blocked Term)
forall {a} {b}. Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621682091314"><span class="hs-operator hs-var">`ifJust`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091324"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091324"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1200"></span><span>          </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091324"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091309"><span class="hs-identifier hs-var">catchallSpine</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091276"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>        </span><span class="hs-comment">-- Matching literal: Switch to the Match state. There are no arguments to add to the spine.</span><span>
</span><span id="line-1203"></span><span>        </span><span id="local-6989586621682091296"><span class="annot"><span class="annottext">matchLit :: Literal -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091296"><span class="hs-identifier hs-var hs-var">matchLit</span></a></span></span><span> </span><span id="local-6989586621682091325"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091325"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal
-&gt; Map Literal FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682091325"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Map Literal FastCompiledClauses
forall c. FastCase c -&gt; Map Literal c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#flitBranches"><span class="hs-identifier hs-var">flitBranches</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; (FastCompiledClauses -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term)
-&gt; ST s (Blocked Term)
forall {a} {b}. Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621682091314"><span class="hs-operator hs-var">`ifJust`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091326"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091326"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1204"></span><span>          </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091326"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091274"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091275"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091311"><span class="hs-identifier hs-var">catchallStack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span>        </span><span class="hs-comment">-- Matching a 'suc' constructor: Insert the argument in the spine.</span><span>
</span><span id="line-1207"></span><span>        </span><span id="local-6989586621682091282"><span class="annot"><span class="annottext">matchSuc :: ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091282"><span class="hs-identifier hs-var hs-var">matchSuc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fsucBranch"><span class="hs-identifier hs-var">fsucBranch</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; (FastCompiledClauses -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term)
-&gt; ST s (Blocked Term)
forall {a} {b}. Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621682091314"><span class="hs-operator hs-var">`ifJust`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091327"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091327"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1208"></span><span>            </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091327"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091274"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091269"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091275"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091311"><span class="hs-identifier hs-var">catchallStack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>        </span><span class="hs-comment">-- Matching a non-zero natural number literal: Subtract one from the literal and</span><span>
</span><span id="line-1211"></span><span>        </span><span class="hs-comment">-- insert it in the spine for the Match state.</span><span>
</span><span id="line-1212"></span><span>        </span><span id="local-6989586621682091294"><span class="annot"><span class="annottext">matchLitSuc :: Integer -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091294"><span class="hs-identifier hs-var hs-var">matchLitSuc</span></a></span></span><span> </span><span id="local-6989586621682091328"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091328"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fsucBranch"><span class="hs-identifier hs-var">fsucBranch</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091273"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; (FastCompiledClauses -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term)
-&gt; ST s (Blocked Term)
forall {a} {b}. Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621682091314"><span class="hs-operator hs-var">`ifJust`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091329"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091329"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1213"></span><span>            </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091329"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091274"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091330"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091275"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091311"><span class="hs-identifier hs-var">catchallStack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091277"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091331"><span class="annot"><span class="annottext">n' :: Integer
</span><a href="#local-6989586621682091331"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091328"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1215"></span><span>                </span><span id="local-6989586621682091330"><span class="annot"><span class="annottext">arg :: Pointer s
</span><a href="#local-6989586621682091330"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; Pointer s
forall s. Closure s -&gt; Pointer s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#pureThunk"><span class="hs-identifier hs-var">pureThunk</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; Pointer s) -&gt; Closure s -&gt; Pointer s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="#local-6989586621682091191"><span class="hs-identifier hs-var">trueValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Term) -&gt; Literal -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-var">LitNat</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091331"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span>        </span><span class="hs-comment">-- Matching a literal 0. Simply calls matchCon with the zero constructor.</span><span>
</span><span id="line-1218"></span><span>        </span><span id="local-6989586621682091292"><span class="annot"><span class="annottext">matchLitZero :: ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091292"><span class="hs-identifier hs-var hs-var">matchLitZero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; ConInfo -&gt; Int -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091287"><span class="hs-identifier hs-var">matchCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; Maybe ConHead -&gt; ConHead
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">ConHead
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ConHead
</span><a href="#local-6989586621682090929"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1219"></span><span>                            </span><span class="hs-comment">-- If we have a nat literal we have builtin zero.</span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span>    </span><span class="hs-comment">-- Case: Match state. Here we look at the case tree and take the appropriate action:</span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-comment">--   - FFail: stuck</span><span>
</span><span id="line-1223"></span><span>    </span><span class="hs-comment">--   - FDone: evaluate body</span><span>
</span><span id="line-1224"></span><span>    </span><span class="hs-comment">--   - FEta: eta expand argument</span><span>
</span><span id="line-1225"></span><span>    </span><span class="hs-comment">--   - FCase on projection: pick corresponding branch and keep matching</span><span>
</span><span id="line-1226"></span><span>    </span><span class="hs-comment">--   - FCase on argument: push CaseK frame on control stack and evaluate argument</span><span>
</span><span id="line-1227"></span><span>    </span><span class="annot"><a href="#local-6989586621682090945"><span class="hs-identifier hs-var">runAM'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span id="local-6989586621682091332"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091332"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682091333"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091333"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682091334"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091334"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span id="local-6989586621682091335"><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span id="local-6989586621682091336"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;runAM.Match&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1228"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091333"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1229"></span><span>        </span><span class="hs-comment">-- Absurd match. You can get here for open terms.</span><span>
</span><span id="line-1230"></span><span>        </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#FFail"><span class="hs-identifier hs-var">FFail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Blocked_ -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091308"><span class="hs-identifier hs-var">stuckMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#AbsurdMatch"><span class="hs-identifier hs-var">AbsurdMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span>        </span><span class="hs-comment">-- Matching complete. Compute the environment for the body and switch to the Eval state.</span><span>
</span><span id="line-1233"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FDone"><span class="hs-identifier hs-type">FDone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CCDone"><span class="hs-identifier hs-type">CCDone</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091339"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682091339"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682091340"><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682091340"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682091341"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091341"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1234"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682091342"><span class="annot"><span class="annottext">allowedReductions :: AllowedReductions
</span><a href="#local-6989586621682091342"><span class="hs-identifier hs-var hs-var hs-var">allowedReductions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; AllowedReductions
</span><a href="Agda.TypeChecking.Monad.Base.html#envAllowedReductions"><span class="hs-identifier hs-var">envAllowedReductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReduceEnv -&gt; TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#redEnv"><span class="hs-identifier hs-var">redEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ReduceEnv
</span><a href="#local-6989586621682090876"><span class="hs-identifier hs-var">rEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682091343"><span class="annot"><span class="annottext">undo :: ST s (Blocked Term)
</span><a href="#local-6989586621682091343"><span class="hs-identifier hs-var hs-var hs-var">undo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Blocked_ -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091308"><span class="hs-identifier hs-var">stuckMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-var">ReallyNotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1236"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682091345"><span class="annot"><span class="annottext">abort :: Bool
</span><a href="#local-6989586621682091345"><span class="hs-identifier hs-var hs-var">abort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span>
</span><span id="line-1237"></span><span>               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ClauseRecursive -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#couldBeRecursive"><span class="hs-identifier hs-var">couldBeRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682091339"><span class="hs-identifier hs-var">mr</span></a></span><span>
</span><span id="line-1238"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompactDef -&gt; Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefUnconfirmed"><span class="hs-identifier hs-var">cdefUnconfirmed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091332"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#UnconfirmedReductions"><span class="hs-identifier hs-var">UnconfirmedReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#notMember"><span class="hs-operator hs-var">`SmallSet.notMember`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682091342"><span class="hs-identifier hs-var">allowedReductions</span></a></span><span>
</span><span id="line-1240"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-1241"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682091345"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091343"><span class="hs-identifier hs-var">undo</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1242"></span><span>            </span><span class="hs-comment">-- Don't ask me why, but not being strict in the spine causes a memory leak.</span><span>
</span><span id="line-1243"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091349"><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682091349"><span class="hs-identifier hs-var">zs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682091350"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091350"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682091351"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091351"><span class="hs-identifier hs-var">spine'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg VerboseKey] -&gt; Spine s -&gt; ([Arg VerboseKey], Env s, Spine s)
forall s.
[Arg VerboseKey] -&gt; Spine s -&gt; ([Arg VerboseKey], Env s, Spine s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#buildEnv"><span class="hs-identifier hs-var">buildEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682091340"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091334"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-1244"></span><span>            </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [ControlFrame s] -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg VerboseKey] -&gt; Term -&gt; Term
</span><a href="#local-6989586621682091136"><span class="hs-identifier hs-var">lams</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682091349"><span class="hs-identifier hs-var">zs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091341"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091350"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091351"><span class="hs-identifier hs-var">spine'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>        </span><span class="hs-comment">-- A record pattern match. This does not block evaluation (since that would violate eta</span><span>
</span><span id="line-1247"></span><span>        </span><span class="hs-comment">-- equality), so in this case we replace the argument with its projections in the spine and</span><span>
</span><span id="line-1248"></span><span>        </span><span class="hs-comment">-- keep matching.</span><span>
</span><span id="line-1249"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FEta"><span class="hs-identifier hs-type">FEta</span></a></span><span> </span><span id="local-6989586621682091352"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091352"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682091353"><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682091353"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682091354"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091354"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682091355"><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091355"><span class="hs-identifier hs-var">ca</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1250"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Spine s -&gt; (Spine s, Spine s)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091352"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091334"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-keyword">of</span><span>                           </span><span class="hs-comment">-- Question: add lambda here? doesn't</span><span>
</span><span id="line-1251"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091356"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span> </span><span class="hs-comment">-- matter for equality, but might for</span><span>
</span><span id="line-1252"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682091358"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091358"><span class="hs-identifier hs-var">spine0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091359"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091359"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091360"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091360"><span class="hs-identifier hs-var">spine1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>                </span><span class="hs-comment">-- rewriting or 'with'.</span><span>
</span><span id="line-1253"></span><span>              </span><span class="hs-comment">-- Replace e by its projections in the spine. And don't forget a</span><span>
</span><span id="line-1254"></span><span>              </span><span class="hs-comment">-- Catchall frame if there's a catch-all.</span><span>
</span><span id="line-1255"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682091361"><span class="annot"><span class="annottext">projClosure :: Arg QName -&gt; Closure s
</span><a href="#local-6989586621682091361"><span class="hs-identifier hs-var hs-var hs-var">projClosure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682091362"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682091362"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682091363"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091363"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pointer s -&gt; Env s -&gt; Env s
forall s. Pointer s -&gt; Env s -&gt; Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#extendEnv"><span class="hs-identifier hs-var">extendEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091359"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' (Pointer s)
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091363"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1256"></span><span>              </span><span id="local-6989586621682091365"><span class="annot"><a href="#local-6989586621682091365"><span class="hs-identifier hs-var">projs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; ST s (Pointer s)) -&gt; [Arg QName] -&gt; ST s [Pointer s]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ST s (Pointer s)
forall s. Closure s -&gt; ST s (Pointer s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#createThunk"><span class="hs-identifier hs-var">createThunk</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure s -&gt; ST s (Pointer s))
-&gt; (Arg QName -&gt; Closure s) -&gt; Arg QName -&gt; ST s (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg QName -&gt; Closure s
</span><a href="#local-6989586621682091361"><span class="hs-identifier hs-var">projClosure</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682091353"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1257"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682091366"><span class="annot"><a href="#local-6989586621682091366"><span class="hs-identifier hs-var hs-var">spine'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091358"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Pointer s -&gt; Elim' (Pointer s)) -&gt; [Pointer s] -&gt; Spine s
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Elim' (Pointer s)
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pointer s) -&gt; Elim' (Pointer s))
-&gt; (Pointer s -&gt; Arg (Pointer s)) -&gt; Pointer s -&gt; Elim' (Pointer s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Arg (Pointer s)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091365"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091360"><span class="hs-identifier hs-var">spine1</span></a></span><span>
</span><span id="line-1258"></span><span>                  </span><span id="local-6989586621682091367"><span class="annot"><a href="#local-6989586621682091367"><span class="hs-identifier hs-var hs-var">stack'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; MatchStack s
-&gt; (FastCompiledClauses -&gt; MatchStack s)
-&gt; MatchStack s
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091355"><span class="hs-identifier hs-var">ca</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">((FastCompiledClauses -&gt; MatchStack s) -&gt; MatchStack s)
-&gt; (FastCompiledClauses -&gt; MatchStack s) -&gt; MatchStack s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682091369"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091369"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses -&gt; Spine s -&gt; CatchallFrame s
forall s. FastCompiledClauses -&gt; Spine s -&gt; CatchallFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Catchall"><span class="hs-identifier hs-var">Catchall</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091369"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091334"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="annot"><span class="annottext">CatchallFrame s -&gt; MatchStack s -&gt; MatchStack s
forall s. CatchallFrame s -&gt; MatchStack s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3E%3A"><span class="hs-operator hs-var">&gt;:</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-1259"></span><span>              </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091332"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091354"><span class="hs-identifier hs-type">cc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091366"><span class="hs-identifier hs-type">spine'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091367"><span class="hs-identifier hs-type">stack'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091336"><span class="hs-identifier hs-type">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>            </span><span class="annot"><span class="annottext">(Spine s, Spine s)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span>        </span><span class="hs-comment">-- Split on nth elimination in the spine. Can be either a regular split or a copattern</span><span>
</span><span id="line-1263"></span><span>        </span><span class="hs-comment">-- split.</span><span>
</span><span id="line-1264"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FCase"><span class="hs-identifier hs-type">FCase</span></a></span><span> </span><span id="local-6989586621682091370"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091370"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682091371"><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091371"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1265"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Spine s -&gt; (Spine s, Spine s)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091370"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091334"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1266"></span><span>            </span><span class="hs-comment">-- If the nth elimination is not given, we're stuck.</span><span>
</span><span id="line-1267"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091356"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span>
</span><span id="line-1268"></span><span>            </span><span class="hs-comment">-- Apply elim: push the current match on the control stack and evaluate the argument</span><span>
</span><span id="line-1269"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682091372"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091372"><span class="hs-identifier hs-var">spine0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682091373"><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091373"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091374"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091374"><span class="hs-identifier hs-var">spine1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1270"></span><span>              </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; Pointer s
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091373"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([ControlFrame s] -&gt; ST s (Blocked Term))
-&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName
-&gt; ArgInfo
-&gt; FastCase FastCompiledClauses
-&gt; Spine s
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlFrame s
forall s.
QName
-&gt; ArgInfo
-&gt; FastCase FastCompiledClauses
-&gt; Spine s
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#CaseK"><span class="hs-identifier hs-var">CaseK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091332"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg (Pointer s) -&gt; ArgInfo
forall e. Arg e -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#argInfo"><span class="hs-identifier hs-var">argInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pointer s)
</span><a href="#local-6989586621682091373"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091371"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091372"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091374"><span class="hs-identifier hs-var">spine1</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1271"></span><span>            </span><span class="hs-comment">-- Projection elim: in this case we must be in a copattern split and find the projection</span><span>
</span><span id="line-1272"></span><span>            </span><span class="hs-comment">-- in the case tree and keep going. If it's not there it might be because it's not the</span><span>
</span><span id="line-1273"></span><span>            </span><span class="hs-comment">-- original projection (issue #2265). If so look up the original projection instead.</span><span>
</span><span id="line-1274"></span><span>            </span><span class="hs-comment">-- That _really_ should be there since copattern splits cannot be partial. Except of</span><span>
</span><span id="line-1275"></span><span>            </span><span class="hs-comment">-- course, the user might still have written a partial function so we should check</span><span>
</span><span id="line-1276"></span><span>            </span><span class="hs-comment">-- partialDefs before throwing an impossible (#3012).</span><span>
</span><span id="line-1277"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682091375"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091375"><span class="hs-identifier hs-var">spine0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682091376"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682091376"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682091377"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091377"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091378"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091378"><span class="hs-identifier hs-var">spine1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1278"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QName -&gt; FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. QName -&gt; FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-identifier hs-var">lookupCon</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091377"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091371"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
-&gt; Maybe FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; FastCase FastCompiledClauses -&gt; Maybe FastCompiledClauses
forall c. QName -&gt; FastCase c -&gt; Maybe c
</span><a href="Agda.TypeChecking.Reduce.Fast.html#lookupCon"><span class="hs-operator hs-var">`lookupCon`</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091371"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Maybe FastCompiledClauses)
-&gt; Maybe QName -&gt; Maybe FastCompiledClauses
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682091380"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1279"></span><span>                </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1280"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091332"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; Set a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682090904"><span class="hs-identifier hs-var">partialDefs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Blocked_ -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091308"><span class="hs-identifier hs-var">stuckMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; NotBlocked' Term
forall t. QName -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-var">MissingClauses</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091332"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1281"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1282"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091383"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091383"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; [ControlFrame s]
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091332"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091383"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091375"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Spine s -&gt; Spine s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091378"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CFun"><span class="hs-identifier hs-type">CFun</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cfunProjection :: CompactDefn -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cfunProjection"><span class="hs-identifier hs-var">cfunProjection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682091380"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682091380"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactDef -&gt; CompactDefn
</span><a href="Agda.TypeChecking.Reduce.Fast.html#cdefDef"><span class="hs-identifier hs-var">cdefDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; CompactDef
</span><a href="#local-6989586621682090878"><span class="hs-identifier hs-var">constInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091377"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1284"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-comment">-- Paths cannot be defined by pattern matching</span><span>
</span><span id="line-1285"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091356"><span class="annot"><span class="annottext">done :: NotBlocked' Term -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091356"><span class="hs-identifier hs-var hs-var">done</span></a></span></span><span> </span><span id="local-6989586621682091384"><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="#local-6989586621682091384"><span class="hs-identifier hs-var">why</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; MatchStack s -&gt; [ControlFrame s] -&gt; ST s (Blocked Term)
forall s.
Blocked_ -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091308"><span class="hs-identifier hs-var">stuckMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="#local-6989586621682091384"><span class="hs-identifier hs-var">why</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091335"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091336"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span>    </span><span class="hs-comment">-- 'evalPointerAM p spine ctrl'. Evaluate the closure pointed to by 'p' applied to 'spine' with</span><span>
</span><span id="line-1288"></span><span>    </span><span class="hs-comment">-- the control stack 'ctrl'. If 'p' points to an unevaluated thunk, a 'BlackHole' is written to</span><span>
</span><span id="line-1289"></span><span>    </span><span class="hs-comment">-- the pointer and an 'UpdateThunk' frame is pushed to the control stack. In this case the</span><span>
</span><span id="line-1290"></span><span>    </span><span class="hs-comment">-- application to the spine has to be deferred until after the update through an 'ApplyK' frame.</span><span>
</span><span id="line-1291"></span><span>    </span><span id="local-6989586621682089560"><span class="annot"><a href="#local-6989586621682091066"><span class="hs-identifier hs-type">evalPointerAM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089560"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089560"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089560"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089560"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1292"></span><span>    </span><span id="local-6989586621682091066"><span class="annot"><span class="annottext">evalPointerAM :: forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var hs-var">evalPointerAM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621682091390"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091390"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621682091391"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091391"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span id="local-6989586621682091392"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091392"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; Closure s
forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply"><span class="hs-identifier hs-var">clApply</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091390"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091391"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091392"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>    </span><span class="annot"><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span id="local-6989586621682091393"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091393"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091394"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091394"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span id="local-6989586621682091395"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091395"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; ST s (Thunk (Closure s))
forall s. STPointer s -&gt; ST s (Thunk (Closure s))
</span><a href="Agda.TypeChecking.Reduce.Fast.html#readPointer"><span class="hs-identifier hs-var">readPointer</span></a></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091393"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (Thunk (Closure s))
-&gt; (Thunk (Closure s) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term)
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">case</span><span>
</span><span id="line-1294"></span><span>      </span><span class="annot"><span class="annottext">Thunk (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1295"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span id="local-6989586621682091396"><span class="annot"><span class="annottext">cl :: Closure s
</span><a href="#local-6989586621682091396"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090909"><span class="hs-identifier hs-var">callByNeed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1296"></span><span>        </span><span class="annot"><span class="annottext">STPointer s -&gt; ST s ()
forall s. STPointer s -&gt; ST s ()
</span><a href="Agda.TypeChecking.Reduce.Fast.html#blackHole"><span class="hs-identifier hs-var">blackHole</span></a></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091393"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1297"></span><span>        </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091396"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">(ControlStack s -&gt; AM s) -&gt; ControlStack s -&gt; AM s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; ControlStack s -&gt; ControlStack s
forall s. STPointer s -&gt; ControlStack s -&gt; ControlStack s
</span><a href="#local-6989586621682091397"><span class="hs-identifier hs-var">updateThunkCtrl</span></a></span><span> </span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091393"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(ControlStack s -&gt; ControlStack s)
-&gt; ControlStack s -&gt; ControlStack s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Spine s -&gt; ControlFrame s
forall s. Spine s -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyK"><span class="hs-identifier hs-var">ApplyK</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091394"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spine s -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091394"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ControlStack s -&gt; ControlStack s -&gt; ControlStack s
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091395"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span id="local-6989586621682091398"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091398"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; Spine s -&gt; Closure s
forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply"><span class="hs-identifier hs-var">clApply</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091398"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091394"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091395"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>
</span><span id="line-1300"></span><span>    </span><span class="hs-comment">-- 'evalIApplyAM spine ctrl fallback' checks if any 'IApply x y r' has a canonical 'r' (i.e. 0 or 1),</span><span>
</span><span id="line-1301"></span><span>    </span><span class="hs-comment">-- in that case continues evaluating 'x' or 'y' with the rest of 'spine' and same 'ctrl'.</span><span>
</span><span id="line-1302"></span><span>    </span><span class="hs-comment">-- If no such 'IApply' is found we continue with 'fallback'.</span><span>
</span><span id="line-1303"></span><span>    </span><span id="local-6989586621682089558"><span class="annot"><a href="#local-6989586621682091058"><span class="hs-identifier hs-type">evalIApplyAM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089558"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089558"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089558"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089558"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1304"></span><span>    </span><span id="local-6989586621682091058"><span class="annot"><span class="annottext">evalIApplyAM :: forall s.
Spine s
-&gt; ControlStack s -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091058"><span class="hs-identifier hs-var hs-var">evalIApplyAM</span></a></span></span><span> </span><span id="local-6989586621682091403"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091403"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682091404"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091404"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span id="local-6989586621682091405"><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091405"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091403"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1305"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1306"></span><span>        </span><span class="hs-comment">-- written as a worker/wrapper to possibly trigger some</span><span>
</span><span id="line-1307"></span><span>        </span><span class="hs-comment">-- specialization wrt fallback</span><span>
</span><span id="line-1308"></span><span>        </span><span id="local-6989586621682091406"><span class="annot"><span class="annottext">go :: Spine s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091406"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
</span><a href="#local-6989586621682091405"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-1309"></span><span>        </span><span class="annot"><a href="#local-6989586621682091406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682091407"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091407"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682091408"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091408"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682091409"><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091409"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091410"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091410"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1310"></span><span>          </span><span id="local-6989586621682091411"><span class="annot"><a href="#local-6989586621682091411"><span class="hs-identifier hs-var">br</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091409"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1311"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682090918"><span class="hs-identifier hs-type">iview</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091411"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1312"></span><span>            </span><span class="annot"><span class="annottext">IntervalView
</span><a href="Agda.Syntax.Internal.html#IZero"><span class="hs-identifier hs-var">IZero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091407"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091410"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091404"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1313"></span><span>            </span><span class="annot"><span class="annottext">IntervalView
</span><a href="Agda.Syntax.Internal.html#IOne"><span class="hs-identifier hs-var">IOne</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Pointer s
</span><a href="#local-6989586621682091408"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091410"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091404"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1314"></span><span>            </span><span class="annot"><span class="annottext">IntervalView
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked Term -&gt; Blocked Term -&gt; Blocked Term
forall a b. Blocked' Term a -&gt; Blocked' Term b -&gt; Blocked' Term a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091411"><span class="hs-identifier hs-var">br</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Blocked Term)
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091410"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1315"></span><span>        </span><span class="annot"><a href="#local-6989586621682091406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091415"><span class="annot"><span class="annottext">Elim' (Pointer s)
</span><a href="#local-6989586621682091415"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091416"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091416"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091416"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span>    </span><span class="hs-comment">-- Normalise the spine and apply the closure to the result. The closure must be a value closure.</span><span>
</span><span id="line-1318"></span><span>    </span><span id="local-6989586621682089574"><span class="annot"><a href="#local-6989586621682091156"><span class="hs-identifier hs-type">normaliseArgsAM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Spine"><span class="hs-identifier hs-type">Spine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1319"></span><span>    </span><span id="local-6989586621682091156"><span class="annot"><span class="annottext">normaliseArgsAM :: forall s.
Closure s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091156"><span class="hs-identifier hs-var hs-var">normaliseArgsAM</span></a></span></span><span> </span><span id="local-6989586621682091422"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091422"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span id="local-6989586621682091423"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091423"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091422"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091423"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- nothing to do</span><span>
</span><span id="line-1320"></span><span>    </span><span class="annot"><a href="#local-6989586621682091156"><span class="hs-identifier hs-var">normaliseArgsAM</span></a></span><span> </span><span id="local-6989586621682091424"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091424"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621682091425"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091425"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span id="local-6989586621682091426"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091426"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1321"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Carrier (SpineContext s)
-&gt; Maybe (Element (SpineContext s), SpineContext s)
forall z. Zipper z =&gt; Carrier z -&gt; Maybe (Element z, z)
</span><a href="Agda.Utils.Zipper.html#firstHole"><span class="hs-identifier hs-var">firstHole</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
Carrier (SpineContext s)
</span><a href="#local-6989586621682091425"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- v Only projections, nothing to do. Note clApply_ and not clApply (or we'd loop)</span><span>
</span><span id="line-1322"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Element (SpineContext s), SpineContext s)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; [Elim' (Pointer s)] -&gt; Closure s
forall s. Closure s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#clApply_"><span class="hs-identifier hs-var">clApply_</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091424"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091425"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091426"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091427"><span class="annot"><span class="annottext">Element (SpineContext s)
</span><a href="#local-6989586621682091427"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682091428"><span class="annot"><span class="annottext">SpineContext s
</span><a href="#local-6989586621682091428"><span class="hs-identifier hs-var">cxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pointer s
-&gt; [Elim' (Pointer s)] -&gt; ControlStack s -&gt; ST s (Blocked Term)
forall s.
Pointer s -&gt; Spine s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091066"><span class="hs-identifier hs-var">evalPointerAM</span></a></span><span> </span><span class="annot"><span class="annottext">Element (SpineContext s)
Pointer s
</span><a href="#local-6989586621682091427"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ControlFrame s
forall s. ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; ControlStack s -&gt; ControlStack s
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; SpineContext s -&gt; ControlFrame s
forall s. Closure s -&gt; SpineContext s -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#ArgK"><span class="hs-identifier hs-var">ArgK</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091424"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">SpineContext s
</span><a href="#local-6989586621682091428"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; ControlStack s -&gt; ControlStack s
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091426"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1324"></span><span>
</span><span id="line-1325"></span><span>    </span><span class="hs-comment">-- Fall back to slow reduction. This happens if we encounter a definition that's not supported</span><span>
</span><span id="line-1326"></span><span>    </span><span class="hs-comment">-- by the machine (like a primitive function that does not work on literals), or a term that is</span><span>
</span><span id="line-1327"></span><span>    </span><span class="hs-comment">-- not supported (Level and Sort at the moment). In this case we decode the current</span><span>
</span><span id="line-1328"></span><span>    </span><span class="hs-comment">-- focus to a 'Term', call slow reduction and pack up the result in a value closure. If the top</span><span>
</span><span id="line-1329"></span><span>    </span><span class="hs-comment">-- of the control stack is a 'NormaliseK' and the focus is a value closure (i.e. already in</span><span>
</span><span id="line-1330"></span><span>    </span><span class="hs-comment">-- weak-head normal form) we call 'slowNormaliseArgs' and pop the 'NormaliseK' frame. Otherwise</span><span>
</span><span id="line-1331"></span><span>    </span><span class="hs-comment">-- we use 'slowReduceTerm' to compute a weak-head normal form.</span><span>
</span><span id="line-1332"></span><span>    </span><span id="local-6989586621682091429"><span class="annot"><a href="#local-6989586621682091077"><span class="hs-identifier hs-type">fallbackAM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-type">AM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091429"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682091429"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1333"></span><span>    </span><span id="local-6989586621682091077"><span class="annot"><span class="annottext">fallbackAM :: forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091077"><span class="hs-identifier hs-var hs-var">fallbackAM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091435"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091435"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682091436"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091436"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1334"></span><span>        </span><span id="local-6989586621682091437"><span class="annot"><a href="#local-6989586621682091437"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s Term
forall s. Closure s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure_"><span class="hs-identifier hs-var">decodeClosure_</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091435"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1335"></span><span>        </span><span class="annot"><a href="#local-6989586621682090941"><span class="hs-identifier hs-type">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682091438"><span class="hs-identifier hs-type">mkValue</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682090905"><span class="hs-identifier hs-type">runReduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682091439"><span class="hs-identifier hs-type">slow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091437"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1336"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091438"><span class="annot"><span class="annottext">mkValue :: Blocked Term -&gt; AM s
</span><a href="#local-6989586621682091438"><span class="hs-identifier hs-var hs-var">mkValue</span></a></span></span><span> </span><span id="local-6989586621682091440"><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091440"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
forall {s}.
Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091098"><span class="hs-identifier hs-var">evalValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked Term -&gt; Blocked_
forall a b. a -&gt; Blocked' Term b -&gt; Blocked' Term a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091440"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked Term -&gt; Term
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091440"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091441"><span class="hs-identifier hs-var">ctrl'</span></a></span><span>
</span><span id="line-1337"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682091439"><span class="annot"><span class="annottext">Term -&gt; ReduceM (Blocked Term)
</span><a href="#local-6989586621682091439"><span class="hs-identifier hs-var">slow</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682091441"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091441"><span class="hs-identifier hs-var">ctrl'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091436"><span class="hs-identifier hs-var">ctrl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1338"></span><span>              </span><span class="annot"><span class="annottext">ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091442"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091442"><span class="hs-identifier hs-var">ctrl'</span></a></span></span><span>
</span><span id="line-1339"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; IsValue
forall s. Closure s -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#isValue"><span class="hs-identifier hs-var">isValue</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091435"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Blocked Term
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Blocked Term)
-&gt; (Term -&gt; ReduceM Term) -&gt; Term -&gt; ReduceM (Blocked Term)
forall (m :: * -&gt; *) b c a.
Functor m =&gt;
(b -&gt; c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="Agda.Utils.Functor.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReduceM Term
</span><a href="Agda.TypeChecking.Reduce.html#slowNormaliseArgs"><span class="hs-identifier hs-var">slowNormaliseArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091442"><span class="hs-identifier hs-var">ctrl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>              </span><span class="annot"><span class="annottext">ControlStack s
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; ReduceM (Blocked Term)
</span><a href="Agda.TypeChecking.Reduce.html#slowReduceTerm"><span class="hs-identifier hs-var">slowReduceTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091436"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>    </span><span class="annot"><a href="#local-6989586621682091077"><span class="hs-identifier hs-var">fallbackAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1342"></span><span>
</span><span id="line-1343"></span><span>    </span><span class="hs-comment">-- Applying rewrite rules to the current focus. This needs to decode the current focus, call</span><span>
</span><span id="line-1344"></span><span>    </span><span class="hs-comment">-- rewriting and pack the result back up in a closure. In case some rewrite rules actually fired</span><span>
</span><span id="line-1345"></span><span>    </span><span class="hs-comment">-- the next state is an unevaluated closure, otherwise it's a value closure.</span><span>
</span><span id="line-1346"></span><span>    </span><span id="local-6989586621682091445"><span class="annot"><a href="#local-6989586621682091060"><span class="hs-identifier hs-type">rewriteAM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-type">AM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091445"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682091445"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1347"></span><span>    </span><span id="local-6989586621682091060"><span class="annot"><span class="annottext">rewriteAM :: forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var hs-var">rewriteAM</span></a></span></span><span> </span><span id="local-6989586621682091457"><span class="annot"><span class="annottext">s :: AM s
</span><a href="#local-6989586621682091457"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621682091458"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091458"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091459"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091459"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091460"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091460"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091461"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091461"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091462"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091462"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1348"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RewriteRules -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682091463"><span class="hs-identifier hs-var">rewr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091457"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1349"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a. Doc -&gt; a -&gt; a
</span><a href="#local-6989586621682090881"><span class="hs-identifier hs-var">traceDoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;R&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">AM s -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><a href="#local-6989586621682091457"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s (Blocked Term) -&gt; ST s (Blocked Term))
-&gt; ST s (Blocked Term) -&gt; ST s (Blocked Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1350"></span><span>        </span><span id="local-6989586621682091466"><span class="annot"><a href="#local-6989586621682091466"><span class="hs-identifier hs-var">v0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ST s Term
forall s. Closure s -&gt; ST s Term
</span><a href="Agda.TypeChecking.Reduce.Fast.html#decodeClosure_"><span class="hs-identifier hs-var">decodeClosure_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091459"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091460"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span>        </span><span id="local-6989586621682091467"><span class="annot"><a href="#local-6989586621682091467"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#decodeSpine"><span class="hs-identifier hs-type">decodeSpine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091461"><span class="hs-identifier hs-type">spine</span></a></span><span>
</span><span id="line-1352"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682090905"><span class="hs-identifier hs-type">runReduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewrite"><span class="hs-identifier hs-type">rewrite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091458"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-identifier hs-type">applyE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091466"><span class="hs-identifier hs-type">v0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682091463"><span class="hs-identifier hs-type">rewr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682091467"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1353"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-type">NoReduction</span></a></span><span> </span><span id="local-6989586621682091469"><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091469"><span class="hs-identifier hs-var">b</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
forall {s}.
Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091098"><span class="hs-identifier hs-var">evalValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked Term -&gt; Blocked_
forall a b. a -&gt; Blocked' Term b -&gt; Blocked' Term a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091469"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked Term -&gt; Term
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682091469"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091462"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-type">YesReduction</span></a></span><span> </span><span class="annot"><span class="annottext">Simplification
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091471"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091471"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
forall {s}. Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091107"><span class="hs-identifier hs-var">evalClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091471"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
forall s. Env s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091462"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1355"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091463"><span class="annot"><span class="annottext">rewr :: RewriteRules
</span><a href="#local-6989586621682091463"><span class="hs-identifier hs-var hs-var">rewr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091459"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1356"></span><span>                     </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682091472"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091472"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; RewriteRules
</span><a href="#local-6989586621682090907"><span class="hs-identifier hs-var">rewriteRules</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091472"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1357"></span><span>                     </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682091473"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091473"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; RewriteRules
</span><a href="#local-6989586621682090907"><span class="hs-identifier hs-var">rewriteRules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682091473"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1358"></span><span>                     </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewriteRules
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1359"></span><span>    </span><span class="annot"><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="annot"><span class="annottext">AM s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1360"></span><span>      </span><span class="annot"><span class="annottext">ST s (Blocked Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span>    </span><span class="hs-comment">-- Add a NatSucK frame to the control stack. Pack consecutive suc's into a single frame.</span><span>
</span><span id="line-1363"></span><span>    </span><span id="local-6989586621682089565"><span class="annot"><a href="#local-6989586621682091084"><span class="hs-identifier hs-type">sucCtrl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089565"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089565"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-1364"></span><span>    </span><span id="local-6989586621682091084"><span class="annot"><span class="annottext">sucCtrl :: forall s. ControlStack s -&gt; ControlStack s
</span><a href="#local-6989586621682091084"><span class="hs-identifier hs-var hs-var">sucCtrl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-type">NatSucK</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682091476"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091476"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091477"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091477"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ControlFrame s
forall s. Integer -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-var">NatSucK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091476"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091477"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1365"></span><span>    </span><span class="annot"><a href="#local-6989586621682091084"><span class="hs-identifier hs-var">sucCtrl</span></a></span><span>               </span><span id="local-6989586621682091478"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091478"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ControlFrame s
forall s. Integer -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-var">NatSucK</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091478"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span>    </span><span class="hs-comment">-- Add a UpdateThunk frame to the control stack. Pack consecutive updates into a single frame.</span><span>
</span><span id="line-1368"></span><span>    </span><span id="local-6989586621682089608"><span class="annot"><a href="#local-6989586621682091397"><span class="hs-identifier hs-type">updateThunkCtrl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#STPointer"><span class="hs-identifier hs-type">STPointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089608"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-1369"></span><span>    </span><span id="local-6989586621682091397"><span class="annot"><span class="annottext">updateThunkCtrl :: forall s. STPointer s -&gt; ControlStack s -&gt; ControlStack s
</span><a href="#local-6989586621682091397"><span class="hs-identifier hs-var hs-var">updateThunkCtrl</span></a></span></span><span> </span><span id="local-6989586621682091479"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091479"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#UpdateThunk"><span class="hs-identifier hs-type">UpdateThunk</span></a></span><span> </span><span id="local-6989586621682091480"><span class="annot"><span class="annottext">[STPointer s]
</span><a href="#local-6989586621682091480"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091481"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091481"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[STPointer s] -&gt; ControlFrame s
forall s. [STPointer s] -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#UpdateThunk"><span class="hs-identifier hs-var">UpdateThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091479"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">STPointer s -&gt; [STPointer s] -&gt; [STPointer s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[STPointer s]
</span><a href="#local-6989586621682091480"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091481"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1370"></span><span>    </span><span class="annot"><a href="#local-6989586621682091397"><span class="hs-identifier hs-var">updateThunkCtrl</span></a></span><span> </span><span id="local-6989586621682091482"><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091482"><span class="hs-identifier hs-var">p</span></a></span></span><span>                   </span><span id="local-6989586621682091483"><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091483"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[STPointer s] -&gt; ControlFrame s
forall s. [STPointer s] -&gt; ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#UpdateThunk"><span class="hs-identifier hs-var">UpdateThunk</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">STPointer s
</span><a href="#local-6989586621682091482"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ControlFrame s -&gt; [ControlFrame s] -&gt; [ControlFrame s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ControlFrame s]
</span><a href="#local-6989586621682091483"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1371"></span><span>
</span><span id="line-1372"></span><span>    </span><span class="hs-comment">-- When matching is stuck we return the closure from the 'MatchStack' with the appropriate</span><span>
</span><span id="line-1373"></span><span>    </span><span class="hs-comment">-- 'IsValue' set.</span><span>
</span><span id="line-1374"></span><span>    </span><span id="local-6989586621682089595"><span class="annot"><a href="#local-6989586621682091308"><span class="hs-identifier hs-type">stuckMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089595"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089595"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089595"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1375"></span><span>    </span><span id="local-6989586621682091308"><span class="annot"><span class="annottext">stuckMatch :: forall s.
Blocked_ -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091308"><span class="hs-identifier hs-var hs-var">stuckMatch</span></a></span></span><span> </span><span id="local-6989586621682091484"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091484"><span class="hs-identifier hs-var">blk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CatchallFrame s]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span> </span><span id="local-6989586621682091485"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091485"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091486"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091486"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091484"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091485"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091486"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span>    </span><span class="hs-comment">-- On a mismatch we find the next 'Catchall' on the control stack and</span><span>
</span><span id="line-1378"></span><span>    </span><span class="hs-comment">-- continue matching from there. If there isn't one we get an incomplete</span><span>
</span><span id="line-1379"></span><span>    </span><span class="hs-comment">-- matching error (or get stuck if the function is marked partial).</span><span>
</span><span id="line-1380"></span><span>    </span><span id="local-6989586621682089590"><span class="annot"><a href="#local-6989586621682091284"><span class="hs-identifier hs-type">failedMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089590"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlStack"><span class="hs-identifier hs-type">ControlStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089590"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621682089590"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1381"></span><span>    </span><span id="local-6989586621682091284"><span class="annot"><span class="annottext">failedMatch :: forall s.
QName -&gt; MatchStack s -&gt; ControlStack s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091284"><span class="hs-identifier hs-var hs-var">failedMatch</span></a></span></span><span> </span><span id="local-6989586621682091489"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091489"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Catchall"><span class="hs-identifier hs-type">Catchall</span></a></span><span> </span><span id="local-6989586621682091490"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091490"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682091491"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091491"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682091492"><span class="annot"><span class="annottext">[CatchallFrame s]
</span><a href="#local-6989586621682091492"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span> </span><span id="local-6989586621682091493"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091493"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091494"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091494"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682090941"><span class="hs-identifier hs-var">runAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
forall s.
QName
-&gt; FastCompiledClauses
-&gt; Spine s
-&gt; MatchStack s
-&gt; ControlStack s
-&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091489"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091490"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091491"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CatchallFrame s]
</span><a href="#local-6989586621682091492"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
forall s. [CatchallFrame s] -&gt; Closure s -&gt; MatchStack s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-var">:&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091493"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091494"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>    </span><span class="annot"><a href="#local-6989586621682091284"><span class="hs-identifier hs-var">failedMatch</span></a></span><span> </span><span id="local-6989586621682091495"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091495"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span> </span><span id="local-6989586621682091496"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091496"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682091497"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091497"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span>
</span><span id="line-1383"></span><span>        </span><span class="hs-comment">-- Bad work-around for #3870: don't fail hard during instance search.</span><span>
</span><span id="line-1384"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682090892"><span class="hs-identifier hs-var">speculative</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; NotBlocked' Term
forall t. QName -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-var">MissingClauses</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091495"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091496"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091497"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091495"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; Set a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682090904"><span class="hs-identifier hs-var">partialDefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; NotBlocked' Term
forall t. QName -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-var">MissingClauses</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091495"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091496"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091497"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AM s -&gt; ST s (Blocked Term)
forall s. AM s -&gt; ST s (Blocked Term)
</span><a href="#local-6989586621682091060"><span class="hs-identifier hs-var">rewriteAM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; Closure s -&gt; Closure s
forall {s}. Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var">mkValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-var">ReallyNotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091496"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091497"><span class="hs-identifier hs-var">ctrl</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See #5396</span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span>    </span><span class="hs-comment">-- Some helper functions to build machine states and closures.</span><span>
</span><span id="line-1389"></span><span>    </span><span id="local-6989586621682091107"><span class="annot"><span class="annottext">evalClosure :: Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091107"><span class="hs-identifier hs-var hs-var">evalClosure</span></a></span></span><span> </span><span id="local-6989586621682091498"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091498"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091499"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091499"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091500"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091500"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091498"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091499"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091500"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1390"></span><span>    </span><span id="local-6989586621682091098"><span class="annot"><span class="annottext">evalValue :: Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091098"><span class="hs-identifier hs-var hs-var">evalValue</span></a></span></span><span> </span><span id="local-6989586621682091501"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091501"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682091502"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091502"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091503"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091503"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091504"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091504"><span class="hs-identifier hs-var">spine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure s -&gt; ControlStack s -&gt; AM s
forall s. Closure s -&gt; ControlStack s -&gt; AM s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091501"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091502"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091503"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091504"><span class="hs-identifier hs-var">spine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1391"></span><span>    </span><span id="local-6989586621682091080"><span class="annot"><span class="annottext">evalTrueValue :: Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091080"><span class="hs-identifier hs-var hs-var">evalTrueValue</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
forall {s}.
Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
</span><a href="#local-6989586621682091098"><span class="hs-identifier hs-var">evalValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s)
-&gt; Blocked_ -&gt; Term -&gt; Env s -&gt; Spine s -&gt; ControlStack s -&gt; AM s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span>    </span><span id="local-6989586621682091191"><span class="annot"><span class="annottext">trueValue :: Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="#local-6989586621682091191"><span class="hs-identifier hs-var hs-var">trueValue</span></a></span></span><span> </span><span id="local-6989586621682091505"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091505"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091506"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091506"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091507"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091507"><span class="hs-identifier hs-var">spine</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
forall s. IsValue -&gt; Term -&gt; Env s -&gt; Spine s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; IsValue) -&gt; Blocked_ -&gt; IsValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked_
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091505"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091506"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091507"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-1393"></span><span>    </span><span id="local-6989586621682091128"><span class="annot"><span class="annottext">mkValue :: Blocked_ -&gt; Closure s -&gt; Closure s
</span><a href="#local-6989586621682091128"><span class="hs-identifier hs-var hs-var">mkValue</span></a></span></span><span> </span><span id="local-6989586621682091508"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091508"><span class="hs-identifier hs-var">b</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsValue -&gt; Closure s -&gt; Closure s
forall s. IsValue -&gt; Closure s -&gt; Closure s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#setIsValue"><span class="hs-identifier hs-var">setIsValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682091508"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>
</span><span id="line-1395"></span><span>    </span><span class="hs-comment">-- Building lambdas</span><span>
</span><span id="line-1396"></span><span>    </span><span class="annot"><a href="#local-6989586621682091136"><span class="hs-identifier hs-type">lams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1397"></span><span>    </span><span id="local-6989586621682091136"><span class="annot"><span class="annottext">lams :: [Arg VerboseKey] -&gt; Term -&gt; Term
</span><a href="#local-6989586621682091136"><span class="hs-identifier hs-var hs-var">lams</span></a></span></span><span> </span><span id="local-6989586621682091509"><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682091509"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682091510"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091510"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg VerboseKey -&gt; Term -&gt; Term)
-&gt; Term -&gt; [Arg VerboseKey] -&gt; Term
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Arg VerboseKey -&gt; Term -&gt; Term
</span><a href="#local-6989586621682091231"><span class="hs-identifier hs-var">lam</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091510"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg VerboseKey]
</span><a href="#local-6989586621682091509"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span>    </span><span class="annot"><a href="#local-6989586621682091231"><span class="hs-identifier hs-type">lam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1400"></span><span>    </span><span id="local-6989586621682091231"><span class="annot"><span class="annottext">lam :: Arg VerboseKey -&gt; Term -&gt; Term
</span><a href="#local-6989586621682091231"><span class="hs-identifier hs-var hs-var">lam</span></a></span></span><span> </span><span id="local-6989586621682091511"><span class="annot"><span class="annottext">Arg VerboseKey
</span><a href="#local-6989586621682091511"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682091512"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091512"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Abs Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg VerboseKey -&gt; ArgInfo
forall e. Arg e -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#argInfo"><span class="hs-identifier hs-var">argInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Arg VerboseKey
</span><a href="#local-6989586621682091511"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey -&gt; Term -&gt; Abs Term
forall a. VerboseKey -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg VerboseKey -&gt; VerboseKey
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg VerboseKey
</span><a href="#local-6989586621682091511"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091512"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- Pretty printing --------------------------------------------------------</span><span>
</span><span id="line-1403"></span><span>
</span><span id="line-1404"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089627"><span id="local-6989586621682091515"><span id="local-6989586621682091520"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089627"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCase"><span class="hs-identifier hs-type">FastCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089627"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1405"></span><span>  </span><span id="local-6989586621682091533"><span class="annot"><span class="annottext">prettyPrec :: Int -&gt; FastCase a -&gt; Doc
</span><a href="#local-6989586621682091533"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span id="local-6989586621682091535"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091535"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FBranches"><span class="hs-identifier hs-type">FBranches</span></a></span><span> </span><span id="local-6989586621682091536"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682091536"><span class="hs-identifier hs-var">_cop</span></a></span></span><span> </span><span id="local-6989586621682091537"><span class="annot"><span class="annottext">Map NameId a
</span><a href="#local-6989586621682091537"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682091538"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682091538"><span class="hs-identifier hs-var">suc</span></a></span></span><span> </span><span id="local-6989586621682091539"><span class="annot"><span class="annottext">Map Literal a
</span><a href="#local-6989586621682091539"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621682091540"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682091540"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1406"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091535"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameId a -&gt; [Doc]
forall k v. (Pretty k, Pretty v) =&gt; Map k v -&gt; [Doc]
</span><a href="Agda.TypeChecking.CompiledClause.html#prettyMap_"><span class="hs-identifier hs-var">prettyMap_</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameId a
</span><a href="#local-6989586621682091537"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; [Doc] -&gt; [Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Map Literal a -&gt; [Doc]
forall k v. (Pretty k, Pretty v) =&gt; Map k v -&gt; [Doc]
</span><a href="Agda.TypeChecking.CompiledClause.html#prettyMap_"><span class="hs-identifier hs-var">prettyMap_</span></a></span><span> </span><span class="annot"><span class="annottext">Map Literal a
</span><a href="#local-6989586621682091539"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; [Doc] -&gt; [Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; [Doc]
forall {a}. Pretty a =&gt; Maybe a -&gt; [Doc]
</span><a href="#local-6989586621682091544"><span class="hs-identifier hs-var">prSuc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682091538"><span class="hs-identifier hs-var">suc</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; [Doc] -&gt; [Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; [Doc]
forall {a}. Pretty a =&gt; Maybe a -&gt; [Doc]
</span><a href="#local-6989586621682091545"><span class="hs-identifier hs-var">prC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682091540"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1407"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1408"></span><span>      </span><span id="local-6989586621682091545"><span class="annot"><span class="annottext">prC :: Maybe a -&gt; [Doc]
</span><a href="#local-6989586621682091545"><span class="hs-identifier hs-var hs-var">prC</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1409"></span><span>      </span><span class="annot"><a href="#local-6989586621682091545"><span class="hs-identifier hs-var">prC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091549"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091549"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;_ -&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091549"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1410"></span><span>
</span><span id="line-1411"></span><span>      </span><span id="local-6989586621682091544"><span class="annot"><span class="annottext">prSuc :: Maybe a -&gt; [Doc]
</span><a href="#local-6989586621682091544"><span class="hs-identifier hs-var hs-var">prSuc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1412"></span><span>      </span><span class="annot"><a href="#local-6989586621682091544"><span class="hs-identifier hs-var">prSuc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091554"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091554"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;suc -&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091554"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682091557"><span id="local-6989586621682091561"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FastCompiledClauses"><span class="hs-identifier hs-type">FastCompiledClauses</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1415"></span><span>  </span><span id="local-6989586621682091584"><span class="annot"><span class="annottext">pretty :: FastCompiledClauses -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FDone"><span class="hs-identifier hs-type">FDone</span></a></span><span> </span><span id="local-6989586621682091585"><span class="annot"><span class="annottext">CCDone Term
</span><a href="#local-6989586621682091585"><span class="hs-identifier hs-var">done</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCDone Term -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CCDone Term
</span><a href="#local-6989586621682091585"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-1416"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="Agda.TypeChecking.Reduce.Fast.html#FFail"><span class="hs-identifier hs-var">FFail</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;fail&quot;</span></span><span>
</span><span id="line-1417"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FEta"><span class="hs-identifier hs-type">FEta</span></a></span><span> </span><span id="local-6989586621682091586"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091586"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091587"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091587"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682091588"><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091588"><span class="hs-identifier hs-var">ca</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1418"></span><span>    </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;eta &quot;</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091586"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot; of&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span>
</span><span id="line-1419"></span><span>      </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;{} -&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091587"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Doc] -&gt; [Doc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-1420"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;_ -&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091590"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682091590"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091590"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><a href="#local-6989586621682091588"><span class="hs-identifier hs-var">ca</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FCase"><span class="hs-identifier hs-type">FCase</span></a></span><span> </span><span id="local-6989586621682091591"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091591"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682091592"><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091592"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Bool
forall c. FastCase c -&gt; Bool
</span><a href="Agda.TypeChecking.Reduce.Fast.html#fprojPatterns"><span class="hs-identifier hs-var">fprojPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091592"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1422"></span><span>    </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">(VerboseKey -&gt; Doc) -&gt; VerboseKey -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;project &quot;</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091591"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1423"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091592"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-1424"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1425"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#FCase"><span class="hs-identifier hs-type">FCase</span></a></span><span> </span><span id="local-6989586621682091595"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091595"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682091596"><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091596"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1426"></span><span>    </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;case &quot;</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091595"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot; of&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><a href="#local-6989586621682091596"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089637"><span id="local-6989586621682091599"><span id="local-6989586621682091604"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089637"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089637"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1429"></span><span>  </span><span id="local-6989586621682091608"><span class="annot"><span class="annottext">prettyPrec :: Int -&gt; Thunk a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Thunk a
</span><a href="Agda.TypeChecking.Reduce.Fast.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&lt;BLACKHOLE&gt;&quot;</span></span><span>
</span><span id="line-1430"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091609"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091609"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span id="local-6989586621682091610"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091610"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; Doc
forall a. Pretty a =&gt; Int -&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091609"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091610"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089639"><span id="local-6989586621682091612"><span id="local-6989586621682091617"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Pointer"><span class="hs-identifier hs-type">Pointer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089639"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1433"></span><span>  </span><span id="local-6989586621682091622"><span class="annot"><span class="annottext">prettyPrec :: Int -&gt; Pointer s -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span id="local-6989586621682091623"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091623"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Thunk (Closure s) -&gt; Doc
forall a. Pretty a =&gt; Int -&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091623"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Thunk (Closure s) -&gt; Doc)
-&gt; (Pointer s -&gt; Thunk (Closure s)) -&gt; Pointer s -&gt; Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pointer s -&gt; Thunk (Closure s)
forall s. Pointer s -&gt; Thunk (Closure s)
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unsafeDerefPointer"><span class="hs-identifier hs-var">unsafeDerefPointer</span></a></span><span>
</span><span id="line-1434"></span><span>
</span><span id="line-1435"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089640"><span id="local-6989586621682091625"><span id="local-6989586621682091629"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089640"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1436"></span><span>  </span><span id="local-6989586621682091650"><span class="annot"><span class="annottext">prettyPrec :: Int -&gt; Closure s -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682091651"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682091651"><span class="hs-identifier hs-var">unused</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1437"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682091651"><span class="hs-identifier hs-var">unused</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Agda.TypeChecking.Reduce.Fast.html#unusedPointerString"><span class="hs-identifier hs-var">unusedPointerString</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-1438"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091652"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091652"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621682091653"><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091653"><span class="hs-identifier hs-var">isV</span></a></span></span><span> </span><span id="local-6989586621682091654"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091654"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682091655"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091655"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682091656"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091656"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1439"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091652"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><a href="#local-6989586621682091658"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-1440"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; Doc
forall a. Pretty a =&gt; Int -&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682091654"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1441"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">([Doc] -&gt; Doc) -&gt; [Doc] -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Pointer s -&gt; Doc) -&gt; [Integer] -&gt; [Pointer s] -&gt; [Doc]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Pointer s -&gt; Doc
forall {a} {a}. (Show a, Pretty a) =&gt; a -&gt; a -&gt; Doc
</span><a href="#local-6989586621682091661"><span class="hs-identifier hs-var">envEntry</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env s -&gt; [Pointer s]
forall s. Env s -&gt; [Pointer s]
</span><a href="Agda.TypeChecking.Reduce.Fast.html#envToList"><span class="hs-identifier hs-var">envToList</span></a></span><span> </span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621682091655"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091656"><span class="hs-identifier hs-var">spine</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1443"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682091661"><span class="annot"><span class="annottext">envEntry :: a -&gt; a -&gt; Doc
</span><a href="#local-6989586621682091661"><span class="hs-identifier hs-var hs-var">envEntry</span></a></span></span><span> </span><span id="local-6989586621682091669"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091669"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682091670"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091670"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;@&quot;</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091669"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot; =&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682091670"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1444"></span><span>            </span><span id="local-6989586621682091658"><span class="annot"><span class="annottext">tag :: VerboseKey
</span><a href="#local-6989586621682091658"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="#local-6989586621682091653"><span class="hs-identifier hs-var">isV</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;V&quot;</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IsValue
</span><a href="Agda.TypeChecking.Reduce.Fast.html#Unevaled"><span class="hs-identifier hs-var">Unevaled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;E&quot;</span></span><span>
</span><span id="line-1445"></span><span>
</span><span id="line-1446"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089547"><span id="local-6989586621682091672"><span id="local-6989586621682091676"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#AM"><span class="hs-identifier hs-type">AM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089547"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1447"></span><span>  </span><span id="local-6989586621682091692"><span class="annot"><span class="annottext">prettyPrec :: Int -&gt; AM s -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span id="local-6989586621682091693"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091693"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621682091694"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091694"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621682091695"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091695"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Closure s -&gt; Doc
forall a. Pretty a =&gt; Int -&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091693"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091694"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ControlStack s -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091695"><span class="hs-identifier hs-var">ctrl</span></a></span><span>
</span><span id="line-1448"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091696"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091696"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span id="local-6989586621682091697"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091697"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682091698"><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091698"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682091699"><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091699"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621682091700"><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091700"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span id="local-6989586621682091701"><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091701"><span class="hs-identifier hs-var">ctrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1449"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091696"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;M&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091697"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1450"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Spine s -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">Spine s
</span><a href="#local-6989586621682091699"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-1451"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; FastCompiledClauses -&gt; Doc
forall a. Pretty a =&gt; Int -&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">FastCompiledClauses
</span><a href="#local-6989586621682091698"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-1452"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MatchStack s -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091700"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-1453"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ControlStack s -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">ControlStack s
</span><a href="#local-6989586621682091701"><span class="hs-identifier hs-var">ctrl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1454"></span><span>
</span><span id="line-1455"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089654"><span id="local-6989586621682091704"><span id="local-6989586621682091708"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CatchallFrame"><span class="hs-identifier hs-type">CatchallFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089654"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1456"></span><span>  </span><span id="local-6989586621682091711"><span class="annot"><span class="annottext">pretty :: CatchallFrame s -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#Catchall"><span class="hs-identifier hs-type">Catchall</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Catchall&quot;</span></span><span>
</span><span id="line-1457"></span><span>
</span><span id="line-1458"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089651"><span id="local-6989586621682091714"><span id="local-6989586621682091717"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#MatchStack"><span class="hs-identifier hs-type">MatchStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089651"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1459"></span><span>  </span><span id="local-6989586621682091722"><span class="annot"><span class="annottext">pretty :: MatchStack s -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1460"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682091723"><span class="annot"><span class="annottext">[CatchallFrame s]
</span><a href="#local-6989586621682091723"><span class="hs-identifier hs-var">ca</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[CatchallFrame s]
</span><a href="#local-6989586621682091723"><span class="hs-identifier hs-var">ca</span></a></span><span>
</span><span id="line-1461"></span><span>
</span><span id="line-1462"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682089652"><span id="local-6989586621682091725"><span id="local-6989586621682091729"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ControlFrame"><span class="hs-identifier hs-type">ControlFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089652"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1463"></span><span>  </span><span id="local-6989586621682091775"><span class="annot"><span class="annottext">prettyPrec :: Int -&gt; ControlFrame s -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span id="local-6989586621682091776"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091776"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#CaseK"><span class="hs-identifier hs-type">CaseK</span></a></span><span> </span><span id="local-6989586621682091777"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091777"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastCase FastCompiledClauses
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091778"><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091778"><span class="hs-identifier hs-var">mc</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091776"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;CaseK&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091777"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchStack s
</span><a href="#local-6989586621682091778"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-1464"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091779"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091779"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ForceK"><span class="hs-identifier hs-type">ForceK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091780"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091780"><span class="hs-identifier hs-var">spine0</span></a></span></span><span> </span><span id="local-6989586621682091781"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091781"><span class="hs-identifier hs-var">spine1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091779"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ForceK&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091780"><span class="hs-identifier hs-var">spine0</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; [Elim' (Pointer s)] -&gt; [Elim' (Pointer s)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091781"><span class="hs-identifier hs-var">spine1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091782"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091782"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#EraseK"><span class="hs-identifier hs-type">EraseK</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091783"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091783"><span class="hs-identifier hs-var">sp0</span></a></span></span><span> </span><span id="local-6989586621682091784"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091784"><span class="hs-identifier hs-var">sp1</span></a></span></span><span> </span><span id="local-6989586621682091785"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091785"><span class="hs-identifier hs-var">sp2</span></a></span></span><span> </span><span id="local-6989586621682091786"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091786"><span class="hs-identifier hs-var">sp3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091782"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;EraseK&quot;</span></span><span>
</span><span id="line-1466"></span><span>                                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091783"><span class="hs-identifier hs-var">sp0</span></a></span><span>
</span><span id="line-1467"></span><span>                                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091784"><span class="hs-identifier hs-var">sp1</span></a></span><span>
</span><span id="line-1468"></span><span>                                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091785"><span class="hs-identifier hs-var">sp2</span></a></span><span>
</span><span id="line-1469"></span><span>                                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091786"><span class="hs-identifier hs-var">sp3</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1470"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#NatSucK"><span class="hs-identifier hs-type">NatSucK</span></a></span><span> </span><span id="local-6989586621682091787"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091787"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerboseKey
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682091787"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1471"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091788"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091788"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#PrimOpK"><span class="hs-identifier hs-type">PrimOpK</span></a></span><span> </span><span id="local-6989586621682091789"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091789"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Literal] -&gt; Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682091790"><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091790"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682091791"><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091791"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe FastCompiledClauses
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091788"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;PrimOpK&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682091789"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1472"></span><span>                                                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Literal] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Literal]
</span><a href="#local-6989586621682091790"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1473"></span><span>                                                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
forall a. Int -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">nest</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pointer s] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Pointer s]
</span><a href="#local-6989586621682091791"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1474"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091792"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091792"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#UpdateThunk"><span class="hs-identifier hs-type">UpdateThunk</span></a></span><span> </span><span id="local-6989586621682091793"><span class="annot"><span class="annottext">[STPointer s]
</span><a href="#local-6989586621682091793"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091792"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;UpdateThunk&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">VerboseKey -&gt; Doc
forall a. VerboseKey -&gt; Doc a
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; VerboseKey
forall a. Show a =&gt; a -&gt; VerboseKey
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[STPointer s] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[STPointer s]
</span><a href="#local-6989586621682091793"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1475"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091794"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091794"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ApplyK"><span class="hs-identifier hs-type">ApplyK</span></a></span><span> </span><span id="local-6989586621682091795"><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091795"><span class="hs-identifier hs-var">spine</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091794"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ApplyK&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' (Pointer s)]
</span><a href="#local-6989586621682091795"><span class="hs-identifier hs-var">spine</span></a></span><span>
</span><span id="line-1476"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091796"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091796"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">ControlFrame s
</span><a href="Agda.TypeChecking.Reduce.Fast.html#NormaliseK"><span class="hs-identifier hs-var">NormaliseK</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;NormaliseK&quot;</span></span><span>
</span><span id="line-1477"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682091797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091797"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.Fast.html#ArgK"><span class="hs-identifier hs-type">ArgK</span></a></span><span> </span><span id="local-6989586621682091798"><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091798"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SpineContext s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682091797"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ArgK&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Closure s -&gt; Doc
forall a. Pretty a =&gt; Int -&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Closure s
</span><a href="#local-6989586621682091798"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1478"></span></pre></body></html>