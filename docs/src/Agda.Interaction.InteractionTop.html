<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-cse #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html"><span class="hs-identifier">Agda.Interaction.InteractionTop</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html"><span class="hs-identifier">Agda.Interaction.InteractionTop</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM.TChan</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runStateT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.STM</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>     </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Char</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>     </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>      </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>      </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TCM</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TCP</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Errors.html"><span class="hs-identifier">Agda.TypeChecking.Errors</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Opacity.html"><span class="hs-identifier">Agda.TypeChecking.Opacity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Opacity.html#saturateOpaqueBlocks"><span class="hs-identifier">saturateOpaqueBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier">checkExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier">isType_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Fixity.html"><span class="hs-identifier">Agda.Syntax.Fixity</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html"><span class="hs-identifier">Agda.Syntax.Parser</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Mode</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Glyph.html"><span class="hs-identifier">Agda.Syntax.Concrete.Glyph</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Pretty.html"><span class="hs-identifier">Agda.Syntax.Abstract.Pretty</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#mkDefInfo"><span class="hs-identifier">mkDefInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html"><span class="hs-identifier">Agda.Syntax.Translation.ConcreteToAbstract</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.AbstractToConcrete.html"><span class="hs-identifier">Agda.Syntax.Translation.AbstractToConcrete</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.InternalToAbstract.html"><span class="hs-identifier">Agda.Syntax.Translation.InternalToAbstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Translation.InternalToAbstract.html#reify"><span class="hs-identifier">reify</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html"><span class="hs-identifier">Agda.Syntax.TopLevelModuleName</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html"><span class="hs-identifier">Agda.Interaction.Base</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.ExitCode.html"><span class="hs-identifier">Agda.Interaction.ExitCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.ExitCode.html#TCMError"><span class="hs-identifier">TCMError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.ExitCode.html#exitAgdaWith"><span class="hs-identifier">exitAgdaWith</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html"><span class="hs-identifier">Agda.Interaction.FindFile</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html"><span class="hs-identifier">Agda.Interaction.Options.Lenses</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lenses</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html"><span class="hs-identifier">Agda.Interaction.Options.ProfileOptions</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Profile</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html"><span class="hs-identifier">Agda.Interaction.MakeCase</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.SearchAbout.html"><span class="hs-identifier">Agda.Interaction.SearchAbout</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Function"><span class="hs-identifier">Function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#ExtendedLambda"><span class="hs-identifier">ExtendedLambda</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html"><span class="hs-identifier">Agda.Interaction.BasicOps</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Precise</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Aspect.html#Error"><span class="hs-identifier">Error</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Aspect.html#Postulate"><span class="hs-identifier">Postulate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html"><span class="hs-identifier">Agda.Interaction.Imports</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier">Mode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier">ScopeCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier">TypeCheck</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html"><span class="hs-identifier">Agda.Interaction.Imports</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Imp</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html"><span class="hs-identifier">Agda.Interaction.Command</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier">CommandM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier">liftLocalState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#revLift"><span class="hs-identifier">revLift</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#revLiftTC"><span class="hs-identifier">revLiftTC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#localStateCommandM"><span class="hs-identifier">localStateCommandM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Generate</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.html"><span class="hs-identifier">Agda.Compiler.Backend</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Mimer.Mimer.html"><span class="hs-identifier">Agda.Mimer.Mimer</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mimer</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html"><span class="hs-identifier">Agda.Utils.Either</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html"><span class="hs-identifier">Agda.Utils.FileName</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html"><span class="hs-identifier">Agda.Utils.Hash</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IO.html"><span class="hs-identifier">Agda.Utils.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.IO.html#showIOException"><span class="hs-identifier">showIOException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.Strict.html"><span class="hs-identifier">Agda.Utils.Maybe.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier">whenJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.String.html"><span class="hs-identifier">Agda.Utils.String</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Time.html"><span class="hs-identifier">Agda.Utils.Time</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Tuple.html"><span class="hs-identifier">Agda.Utils.Tuple</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html"><span class="hs-identifier">Agda.Utils.WithDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensCollapseDefault"><span class="hs-identifier">lensCollapseDefault</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier">lensKeepDefault</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Opposite of 'liftIO' for 'CommandM'.</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- This function should only be applied to computations that are</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- guaranteed not to raise any errors (except for 'IOException's).</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621682194659"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#commandMToIO"><span class="hs-identifier hs-type">commandMToIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682194661"><span class="annot"><a href="#local-6989586621682194661"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194659"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682194661"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682194661"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194659"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-104"></span><span id="commandMToIO"><span class="annot"><span class="annottext">commandMToIO :: forall a. (forall x. (CommandM a -&gt; IO x) -&gt; IO x) -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#commandMToIO"><span class="hs-identifier hs-var hs-var">commandMToIO</span></a></span></span><span> </span><span id="local-6989586621682195955"><span class="annot"><span class="annottext">forall x. (CommandM a -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621682195955"><span class="hs-identifier hs-var">ci_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall c.
 StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState))
-&gt; (forall b. TCM b -&gt; StateT CommandState TCM b)
-&gt; (forall x. (CommandM a -&gt; TCM x) -&gt; TCM x)
-&gt; CommandM a
forall st (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadState st m =&gt;
(forall c. m c -&gt; st -&gt; k (c, st))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.Command.html#revLift"><span class="hs-identifier hs-var">revLift</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall c.
StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">TCM b -&gt; StateT CommandState TCM b
forall b. TCM b -&gt; StateT CommandState TCM b
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">((forall x. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a)
-&gt; (forall x. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682195960"><span class="annot"><span class="annottext">CommandM a -&gt; TCM x
</span><a href="#local-6989586621682195960"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall c. TCM c -&gt; TCState -&gt; IO (c, TCState))
-&gt; (forall b. IO b -&gt; TCM b)
-&gt; (forall x. (TCM x -&gt; IO x) -&gt; IO x)
-&gt; TCM x
forall (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadTCState m =&gt;
(forall c. m c -&gt; TCState -&gt; k (c, TCState))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.Command.html#revLiftTC"><span class="hs-identifier hs-var">revLiftTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCM c -&gt; TCState -&gt; IO (c, TCState)
forall c. TCM c -&gt; TCState -&gt; IO (c, TCState)
</span><a href="Agda.TypeChecking.Monad.Base.html#runSafeTCM"><span class="hs-identifier hs-var">runSafeTCM</span></a></span><span> </span><span class="annot"><span class="annottext">IO b -&gt; TCM b
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">((forall x. (TCM x -&gt; IO x) -&gt; IO x) -&gt; TCM x)
-&gt; (forall x. (TCM x -&gt; IO x) -&gt; IO x) -&gt; TCM x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CommandM a -&gt; IO x) -&gt; IO x
forall x. (CommandM a -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621682195955"><span class="hs-identifier hs-var">ci_i</span></a></span><span> </span><span class="annot"><span class="annottext">((CommandM a -&gt; IO x) -&gt; IO x)
-&gt; ((TCM x -&gt; IO x) -&gt; CommandM a -&gt; IO x)
-&gt; (TCM x -&gt; IO x)
-&gt; IO x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCM x -&gt; IO x) -&gt; (CommandM a -&gt; TCM x) -&gt; CommandM a -&gt; IO x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; TCM x
</span><a href="#local-6989586621682195960"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><span class="hs-comment">-- | Lift a TCM action transformer to a CommandM action transformer.</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span id="local-6989586621682194698"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-type">liftCommandMT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682194697"><span class="annot"><a href="#local-6989586621682194697"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194697"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194697"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194698"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194698"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-109"></span><span id="liftCommandMT"><span class="annot"><span class="annottext">liftCommandMT :: forall a. (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var hs-var">liftCommandMT</span></a></span></span><span> </span><span id="local-6989586621682195966"><span class="annot"><span class="annottext">forall x. TCM x -&gt; TCM x
</span><a href="#local-6989586621682195966"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682195967"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682195967"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall c.
 StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState))
-&gt; (forall b. TCM b -&gt; StateT CommandState TCM b)
-&gt; (forall x. (CommandM a -&gt; TCM x) -&gt; TCM x)
-&gt; CommandM a
forall st (m :: * -&gt; *) (k :: * -&gt; *) a.
MonadState st m =&gt;
(forall c. m c -&gt; st -&gt; k (c, st))
-&gt; (forall b. k b -&gt; m b) -&gt; (forall x. (m a -&gt; k x) -&gt; k x) -&gt; m a
</span><a href="Agda.Interaction.Command.html#revLift"><span class="hs-identifier hs-var">revLift</span></a></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall c.
StateT CommandState TCM c -&gt; CommandState -&gt; TCM (c, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO b -&gt; StateT CommandState TCM b
forall b. TCM b -&gt; StateT CommandState TCM b
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">((forall x. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a)
-&gt; (forall x. (CommandM a -&gt; TCM x) -&gt; TCM x) -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM x -&gt; TCM x
forall x. TCM x -&gt; TCM x
</span><a href="#local-6989586621682195966"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM x -&gt; TCM x)
-&gt; ((CommandM a -&gt; TCM x) -&gt; TCM x)
-&gt; (CommandM a -&gt; TCM x)
-&gt; TCM x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CommandM a -&gt; TCM x) -&gt; CommandM a -&gt; TCM x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682195967"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><span class="hs-comment">-- | Ditto, but restore state.</span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span id="local-6989586621682195970"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMTLocalState"><span class="hs-identifier hs-type">liftCommandMTLocalState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682195972"><span class="annot"><a href="#local-6989586621682195972"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195972"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195972"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195970"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195970"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-114"></span><span id="liftCommandMTLocalState"><span class="annot"><span class="annottext">liftCommandMTLocalState :: forall a. (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMTLocalState"><span class="hs-identifier hs-var hs-var">liftCommandMTLocalState</span></a></span></span><span> </span><span id="local-6989586621682195973"><span class="annot"><span class="annottext">forall x. TCM x -&gt; TCM x
</span><a href="#local-6989586621682195973"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
forall a. (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="annot"><span class="annottext">TCM x -&gt; TCM x
forall x. TCM x -&gt; TCM x
</span><a href="#local-6989586621682195973"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM a -&gt; CommandM a)
-&gt; (CommandM a -&gt; CommandM a) -&gt; CommandM a -&gt; CommandM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.Command.html#localStateCommandM"><span class="hs-identifier hs-var">localStateCommandM</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><span class="hs-comment">-- | Put a response by the callback function given by 'stInteractionOutputCallback'.</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span id="putResponse"><span class="annot"><span class="annottext">putResponse :: Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var hs-var">putResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ())
-&gt; (Response -&gt; TCM ()) -&gt; Response -&gt; CommandM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#appInteractionOutputCallback"><span class="hs-identifier hs-var">appInteractionOutputCallback</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><span class="hs-comment">-- | A Lens for 'theInteractionPoints'.</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-type">modifyTheInteractionPoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span id="modifyTheInteractionPoints"><span class="annot"><span class="annottext">modifyTheInteractionPoints :: ([InteractionId] -&gt; [InteractionId]) -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-var hs-var">modifyTheInteractionPoints</span></a></span></span><span> </span><span id="local-6989586621682195979"><span class="annot"><span class="annottext">[InteractionId] -&gt; [InteractionId]
</span><a href="#local-6989586621682195979"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; CommandM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; CommandM ())
-&gt; (CommandState -&gt; CommandState) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682195980"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682195980"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682195980"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682195979"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195980"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><span class="hs-comment">-- * Operations for manipulating 'oldInteractionScopes'.</span></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><span class="hs-comment">-- | A Lens for 'oldInteractionScopes'.</span></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-type">modifyOldInteractionScopes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#OldInteractionScopes"><span class="hs-identifier hs-type">OldInteractionScopes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#OldInteractionScopes"><span class="hs-identifier hs-type">OldInteractionScopes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span id="modifyOldInteractionScopes"><span class="annot"><span class="annottext">modifyOldInteractionScopes :: (OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-var hs-var">modifyOldInteractionScopes</span></a></span></span><span> </span><span id="local-6989586621682195983"><span class="annot"><span class="annottext">OldInteractionScopes -&gt; OldInteractionScopes
</span><a href="#local-6989586621682195983"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; CommandM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; CommandM ())
-&gt; (CommandState -&gt; CommandState) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682195984"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682195984"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682195984"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#oldInteractionScopes"><span class="hs-identifier hs-var">oldInteractionScopes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682195983"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#oldInteractionScopes"><span class="hs-identifier hs-var">oldInteractionScopes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195984"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-type">insertOldInteractionScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span id="insertOldInteractionScope"><span class="annot"><span class="annottext">insertOldInteractionScope :: InteractionId -&gt; ScopeInfo -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-var hs-var">insertOldInteractionScope</span></a></span></span><span> </span><span id="local-6989586621682195986"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195986"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682195987"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682195987"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inserting old interaction scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195986"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">(OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-var">modifyOldInteractionScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ())
-&gt; (OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; ScopeInfo -&gt; OldInteractionScopes -&gt; OldInteractionScopes
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195986"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682195987"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#removeOldInteractionScope"><span class="hs-identifier hs-type">removeOldInteractionScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span id="removeOldInteractionScope"><span class="annot"><span class="annottext">removeOldInteractionScope :: InteractionId -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#removeOldInteractionScope"><span class="hs-identifier hs-var hs-var">removeOldInteractionScope</span></a></span></span><span> </span><span id="local-6989586621682195992"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195992"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removing old interaction scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195992"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="annottext">(OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyOldInteractionScopes"><span class="hs-identifier hs-var">modifyOldInteractionScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ())
-&gt; (OldInteractionScopes -&gt; OldInteractionScopes) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; OldInteractionScopes -&gt; OldInteractionScopes
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195992"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#getOldInteractionScope"><span class="hs-identifier hs-type">getOldInteractionScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ScopeInfo"><span class="hs-identifier hs-type">ScopeInfo</span></a></span><span>
</span><span id="line-147"></span><span id="getOldInteractionScope"><span class="annot"><span class="annottext">getOldInteractionScope :: InteractionId -&gt; CommandM ScopeInfo
</span><a href="Agda.Interaction.InteractionTop.html#getOldInteractionScope"><span class="hs-identifier hs-var hs-var">getOldInteractionScope</span></a></span></span><span> </span><span id="local-6989586621682195995"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195995"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621682195996"><span class="annot"><a href="#local-6989586621682195996"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe ScopeInfo)
-&gt; StateT CommandState TCM (Maybe ScopeInfo)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; Maybe ScopeInfo)
 -&gt; StateT CommandState TCM (Maybe ScopeInfo))
-&gt; (CommandState -&gt; Maybe ScopeInfo)
-&gt; StateT CommandState TCM (Maybe ScopeInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; OldInteractionScopes -&gt; Maybe ScopeInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195995"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(OldInteractionScopes -&gt; Maybe ScopeInfo)
-&gt; (CommandState -&gt; OldInteractionScopes)
-&gt; CommandState
-&gt; Maybe ScopeInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; OldInteractionScopes
</span><a href="Agda.Interaction.Base.html#oldInteractionScopes"><span class="hs-identifier hs-var">oldInteractionScopes</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682195996"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">Maybe ScopeInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; CommandM ScopeInfo
forall (m :: * -&gt; *) a.
(HasCallStack, MonadDebug m) =&gt;
String -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#__IMPOSSIBLE_VERBOSE__"><span class="hs-identifier hs-var">__IMPOSSIBLE_VERBOSE__</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; CommandM ScopeInfo) -&gt; String -&gt; CommandM ScopeInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not an old interaction point: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682195995"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682195999"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682195999"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; CommandM ScopeInfo
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682195999"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><span class="hs-comment">-- | Do setup and error handling for a command.</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#handleCommand_"><span class="hs-identifier hs-type">handleCommand_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span id="handleCommand_"><span class="annot"><span class="annottext">handleCommand_ :: CommandM () -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand_"><span class="hs-identifier hs-var hs-var">handleCommand_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. CommandM a -&gt; CommandM a)
-&gt; CommandM () -&gt; CommandM () -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-var">handleCommand</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. a -&gt; a
forall a. CommandM a -&gt; CommandM a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-type">handleCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682196003"><span class="annot"><a href="#local-6989586621682196003"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196003"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196003"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span id="handleCommand"><span class="annot"><span class="annottext">handleCommand :: (forall a. CommandM a -&gt; CommandM a)
-&gt; CommandM () -&gt; CommandM () -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-var hs-var">handleCommand</span></a></span></span><span> </span><span id="local-6989586621682196004"><span class="annot"><span class="annottext">forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621682196004"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621682196005"><span class="annot"><span class="annottext">CommandM ()
</span><a href="#local-6989586621682196005"><span class="hs-identifier hs-var">onFail</span></a></span></span><span> </span><span id="local-6989586621682196006"><span class="annot"><span class="annottext">CommandM ()
</span><a href="#local-6989586621682196006"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandM () -&gt; CommandM ()
</span><a href="#local-6989586621682196007"><span class="hs-identifier hs-var">handleNastyErrors</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandM () -&gt; CommandM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621682196004"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621682196008"><span class="annot"><a href="#local-6989586621682196008"><span class="hs-identifier hs-var">oldState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- -- Andreas, 2016-11-18 OLD CODE:</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- -- onFail and handleErr are executed in &quot;new&quot; command state (not TCState).</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- -- But it seems that if an exception is raised, it is identical to the old state,</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- -- see code for catchErr.</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- res &lt;- (`catchErr` (return . Just)) $ Nothing &lt;$ cmd</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- maybe (return ()) (\ e -&gt; onFail &gt;&gt; handleErr e) res</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-11-18 NEW CODE: execute onFail and handleErr in handler</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- which means (looking at catchErr) they run in state s rathern than s'.</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- Yet, it looks like s == s' in case the command failed.</span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="#local-6989586621682196006"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196010"><span class="hs-operator hs-type">`catchErr`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196011"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682196011"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="#local-6989586621682196005"><span class="hs-identifier hs-var">onFail</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">Maybe HighlightingMethod -&gt; TCErr -&gt; CommandM ()
</span><a href="#local-6989586621682196012"><span class="hs-identifier hs-var">handleErr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingMethod
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682196011"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-comment">-- Andreas, 2016-11-18, issue #2174</span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-comment">-- Reset TCState after error is handled, to get rid of metas created during failed command</span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621682196013"><span class="annot"><a href="#local-6989586621682196013"><span class="hs-identifier hs-var">newPersistentState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PersistentTCState -&gt; TCMT IO PersistentTCState
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; f PersistentTCState) -&gt; TCState -&gt; f TCState
Lens' TCState PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-var">lensPersistentState</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-type">putTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196008"><span class="hs-identifier hs-type">oldState</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#lensPersistentState"><span class="hs-identifier hs-type">lensPersistentState</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196013"><span class="hs-identifier hs-type">newPersistentState</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- Preserves state so we can do unsolved meta highlighting</span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621682194731"><span class="annot"><a href="#local-6989586621682196010"><span class="hs-identifier hs-type">catchErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194731"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194731"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194731"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621682196010"><span class="annot"><span class="annottext">catchErr :: forall a. CommandM a -&gt; (TCErr -&gt; CommandM a) -&gt; CommandM a
</span><a href="#local-6989586621682196010"><span class="hs-identifier hs-var hs-var">catchErr</span></a></span></span><span> </span><span id="local-6989586621682196030"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682196030"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682196031"><span class="annot"><span class="annottext">TCErr -&gt; CommandM a
</span><a href="#local-6989586621682196031"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>      </span><span id="local-6989586621682196032"><span class="annot"><a href="#local-6989586621682196032"><span class="hs-identifier hs-var">s</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682196034"><span class="annot"><a href="#local-6989586621682196034"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196035"><span class="annot"><a href="#local-6989586621682196035"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><a href="#local-6989586621682196030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196032"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-188"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#catchError_"><span class="hs-operator hs-type">`catchError_`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196037"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682196037"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>           </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandState -&gt; TCM (a, CommandState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCErr -&gt; CommandM a
</span><a href="#local-6989586621682196031"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682196037"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196032"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-190"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">put</span></span><span> </span><span class="annot"><a href="#local-6989586621682196035"><span class="hs-identifier hs-type">s'</span></a></span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682196034"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- Handle every possible kind of error (#637), except for</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- AsyncCancelled, which is used to abort Agda.</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="#local-6989586621682196007"><span class="hs-identifier hs-type">handleNastyErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621682196007"><span class="annot"><span class="annottext">handleNastyErrors :: CommandM () -&gt; CommandM ()
</span><a href="#local-6989586621682196007"><span class="hs-identifier hs-var hs-var">handleNastyErrors</span></a></span></span><span> </span><span id="local-6989586621682196039"><span class="annot"><span class="annottext">CommandM ()
</span><a href="#local-6989586621682196039"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. (CommandM () -&gt; IO x) -&gt; IO x) -&gt; CommandM ()
forall a. (forall x. (CommandM a -&gt; IO x) -&gt; IO x) -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#commandMToIO"><span class="hs-identifier hs-var">commandMToIO</span></a></span><span> </span><span class="annot"><span class="annottext">((forall x. (CommandM () -&gt; IO x) -&gt; IO x) -&gt; CommandM ())
-&gt; (forall x. (CommandM () -&gt; IO x) -&gt; IO x) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196056"><span class="annot"><span class="annottext">CommandM () -&gt; IO x
</span><a href="#local-6989586621682196056"><span class="hs-identifier hs-var">toIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196065"><span class="annot"><span class="annottext">asyncHandler :: AsyncCancelled -&gt; m (Either AsyncCancelled b)
</span><a href="#local-6989586621682196065"><span class="hs-identifier hs-var hs-var hs-var">asyncHandler</span></a></span></span><span> </span><span id="local-6989586621682196066"><span class="annot"><span class="annottext">e :: AsyncCancelled
</span><a href="#local-6989586621682196066"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">AsyncCancelled
</span><span class="hs-identifier hs-var">AsyncCancelled</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either AsyncCancelled b -&gt; m (Either AsyncCancelled b)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsyncCancelled -&gt; Either AsyncCancelled b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">AsyncCancelled
</span><a href="#local-6989586621682196066"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>          </span><span id="local-6989586621682196068"><span class="annot"><span class="annottext">ioHandler :: IOException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621682196068"><span class="hs-identifier hs-var hs-var hs-var">ioHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682196069"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682196069"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.IOException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Either AsyncCancelled x
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(x -&gt; Either AsyncCancelled x)
-&gt; IO x -&gt; IO (Either AsyncCancelled x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="annottext">CommandM () -&gt; IO x
</span><a href="#local-6989586621682196056"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; IO x) -&gt; CommandM () -&gt; IO x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingMethod -&gt; TCErr -&gt; CommandM ()
</span><a href="#local-6989586621682196012"><span class="hs-identifier hs-var">handleErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingMethod -&gt; Maybe HighlightingMethod
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#Direct"><span class="hs-identifier hs-var">Direct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCErr -&gt; CommandM ()) -&gt; TCErr -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe TCState -&gt; Range -&gt; IOException -&gt; TCErr
</span><a href="Agda.TypeChecking.Monad.Base.html#IOException"><span class="hs-identifier hs-var">IOException</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCState
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682196069"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>          </span><span id="local-6989586621682196073"><span class="annot"><span class="annottext">generalHandler :: SomeException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621682196073"><span class="hs-identifier hs-var hs-var hs-var">generalHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682196074"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682196074"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Either AsyncCancelled x
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(x -&gt; Either AsyncCancelled x)
-&gt; IO x -&gt; IO (Either AsyncCancelled x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>            </span><span class="annot"><span class="annottext">CommandM () -&gt; IO x
</span><a href="#local-6989586621682196056"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; IO x) -&gt; CommandM () -&gt; IO x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingMethod -&gt; TCErr -&gt; CommandM ()
</span><a href="#local-6989586621682196012"><span class="hs-identifier hs-var">handleErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingMethod -&gt; Maybe HighlightingMethod
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#Direct"><span class="hs-identifier hs-var">Direct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCErr -&gt; CommandM ()) -&gt; TCErr -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCErr
</span><a href="Agda.TypeChecking.Monad.Base.html#GenericException"><span class="hs-identifier hs-var">GenericException</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCErr) -&gt; String -&gt; TCErr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall e. Exception e =&gt; e -&gt; String
</span><a href="Agda.Utils.IO.html#showIOException"><span class="hs-identifier hs-var">showIOException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682196074"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>      </span><span id="local-6989586621682196076"><span class="annot"><a href="#local-6989586621682196076"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x -&gt; Either AsyncCancelled x
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(x -&gt; Either AsyncCancelled x)
-&gt; IO x -&gt; IO (Either AsyncCancelled x)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CommandM () -&gt; IO x
</span><a href="#local-6989586621682196056"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="#local-6989586621682196039"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>             </span><span class="annot"><span class="annottext">IO (Either AsyncCancelled x)
-&gt; (AsyncCancelled -&gt; IO (Either AsyncCancelled x))
-&gt; IO (Either AsyncCancelled x)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="annot"><span class="annottext">AsyncCancelled -&gt; IO (Either AsyncCancelled x)
forall {m :: * -&gt; *} {b}.
Monad m =&gt;
AsyncCancelled -&gt; m (Either AsyncCancelled b)
</span><a href="#local-6989586621682196065"><span class="hs-identifier hs-var">asyncHandler</span></a></span><span>
</span><span id="line-208"></span><span>             </span><span class="annot"><span class="annottext">IO (Either AsyncCancelled x)
-&gt; (IOException -&gt; IO (Either AsyncCancelled x))
-&gt; IO (Either AsyncCancelled x)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621682196068"><span class="hs-identifier hs-var">ioHandler</span></a></span><span>
</span><span id="line-209"></span><span>             </span><span class="annot"><span class="annottext">IO (Either AsyncCancelled x)
-&gt; (SomeException -&gt; IO (Either AsyncCancelled x))
-&gt; IO (Either AsyncCancelled x)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO (Either AsyncCancelled x)
</span><a href="#local-6989586621682196073"><span class="hs-identifier hs-var">generalHandler</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196076"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682196078"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621682196078"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; IO x
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621682196078"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682196079"><span class="annot"><span class="annottext">AsyncCancelled
</span><a href="#local-6989586621682196079"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AsyncCancelled -&gt; IO x
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">AsyncCancelled
</span><a href="#local-6989586621682196079"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- Displays an error and instructs Emacs to jump to the site of the</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">-- error. Because this function may switch the focus to another file</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">-- the status information is also updated.</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621682196012"><span class="annot"><span class="annottext">handleErr :: Maybe HighlightingMethod -&gt; TCErr -&gt; CommandM ()
</span><a href="#local-6989586621682196012"><span class="hs-identifier hs-var hs-var">handleErr</span></a></span></span><span> </span><span id="local-6989586621682196133"><span class="annot"><span class="annottext">Maybe HighlightingMethod
</span><a href="#local-6989586621682196133"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621682196134"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682196134"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-comment">-- TODO: make a better predicate for this</span><span>
</span><span id="line-220"></span><span>      </span><span id="local-6989586621682196135"><span class="annot"><a href="#local-6989586621682196135"><span class="hs-identifier hs-var">noError</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; TCMT IO String -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO String
forall (tcm :: * -&gt; *). MonadTCM tcm =&gt; TCErr -&gt; tcm String
</span><a href="Agda.TypeChecking.Errors.html#renderError"><span class="hs-identifier hs-var">renderError</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682196134"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196135"><span class="hs-identifier hs-type">noError</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621682196139"><span class="annot"><a href="#local-6989586621682196139"><span class="hs-identifier hs-var">unsolved</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#computeUnsolvedInfo"><span class="hs-identifier hs-type">computeUnsolvedInfo</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span id="local-6989586621682196141"><span class="annot"><a href="#local-6989586621682196141"><span class="hs-identifier hs-var">err</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#errorHighlighting"><span class="hs-identifier hs-type">errorHighlighting</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196134"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-225"></span><span>        </span><span id="local-6989586621682196143"><span class="annot"><a href="#local-6989586621682196143"><span class="hs-identifier hs-var">modFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-type">stModuleToSource</span></a></span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621682196147"><span class="annot"><a href="#local-6989586621682196147"><span class="hs-identifier hs-var">method</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196133"><span class="hs-identifier hs-type">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-227"></span><span>          </span><span class="annot"><span class="annottext">Maybe HighlightingMethod
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO HighlightingMethod
-&gt; StateT CommandState TCM HighlightingMethod
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO HighlightingMethod
 -&gt; StateT CommandState TCM HighlightingMethod)
-&gt; TCMT IO HighlightingMethod
-&gt; StateT CommandState TCM HighlightingMethod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv HighlightingMethod -&gt; TCMT IO HighlightingMethod
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingMethod -&gt; f HighlightingMethod) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv HighlightingMethod
</span><a href="Agda.TypeChecking.Monad.Base.html#eHighlightingMethod"><span class="hs-identifier hs-var">eHighlightingMethod</span></a></span><span>
</span><span id="line-228"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682196152"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621682196152"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HighlightingMethod -&gt; StateT CommandState TCM HighlightingMethod
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621682196152"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196153"><span class="annot"><a href="#local-6989586621682196153"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. Convert a b =&gt; a -&gt; b
</span><a href="Agda.Interaction.Highlighting.Precise.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfoBuilder -&gt; HighlightingInfo)
-&gt; HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder
</span><a href="#local-6989586621682196141"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder
-&gt; HighlightingInfoBuilder -&gt; HighlightingInfoBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfoBuilder
</span><a href="#local-6989586621682196139"><span class="hs-identifier hs-var">unsolved</span></a></span><span>
</span><span id="line-230"></span><span>                     </span><span class="hs-comment">-- Errors take precedence over unsolved things.</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621682196155"><span class="annot"><a href="#local-6989586621682196155"><span class="hs-identifier hs-var">showImpl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optShowImplicit"><span class="hs-identifier hs-type">optShowImplicit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-type">stPragmaOptions</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span id="local-6989586621682196160"><span class="annot"><a href="#local-6989586621682196160"><span class="hs-identifier hs-var">showIrr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optShowIrrelevant"><span class="hs-identifier hs-type">optShowIrrelevant</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-type">stPragmaOptions</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_DisplayInfo"><span class="hs-identifier hs-type">Resp_DisplayInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_GenericError"><span class="hs-identifier hs-type">Info_GenericError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196134"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellEmacsToJumpToError"><span class="hs-identifier hs-type">tellEmacsToJumpToError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196134"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-238"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_HighlightingInfo"><span class="hs-identifier hs-type">Resp_HighlightingInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196153"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-type">KeepHighlighting</span></a></span><span>
</span><span id="line-239"></span><span>                                    </span><span class="annot"><a href="#local-6989586621682196147"><span class="hs-identifier hs-type">method</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196143"><span class="hs-identifier hs-type">modFile</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_Status"><span class="hs-identifier hs-type">Resp_Status</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#sChecked"><span class="hs-identifier hs-var">sChecked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-241"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#sShowImplicitArguments"><span class="hs-identifier hs-var">sShowImplicitArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682196155"><span class="hs-identifier hs-type">showImpl</span></a></span><span>
</span><span id="line-242"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#sShowIrrelevantArguments"><span class="hs-identifier hs-var">sShowIrrelevantArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682196160"><span class="hs-identifier hs-type">showIrr</span></a></span><span>
</span><span id="line-243"></span><span>                                   </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Types.html#optExitOnError"><span class="hs-identifier hs-var">optExitOnError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-type">commandLineOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.ExitCode.html#exitAgdaWith"><span class="hs-identifier hs-type">exitAgdaWith</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.ExitCode.html#TCMError"><span class="hs-identifier hs-type">TCMError</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Run an 'IOTCM' value, catch the exceptions, emit output</span><span>
</span><span id="line-248"></span><span class="hs-comment">--</span><span>
</span><span id="line-249"></span><span class="hs-comment">--   If an error happens the state of 'CommandM' does not change,</span><span>
</span><span id="line-250"></span><span class="hs-comment">--   but stPersistent may change (which contains successfully</span><span>
</span><span id="line-251"></span><span class="hs-comment">--   loaded interfaces for example).</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#runInteraction"><span class="hs-identifier hs-type">runInteraction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span id="runInteraction"><span class="annot"><span class="annottext">runInteraction :: IOTCM -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#runInteraction"><span class="hs-identifier hs-var hs-var">runInteraction</span></a></span></span><span> </span><span id="local-6989586621682196182"><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621682196182"><span class="hs-identifier hs-var">iotcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="annottext">(forall a. CommandM a -&gt; CommandM a)
-&gt; CommandM () -&gt; CommandM () -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#handleCommand"><span class="hs-identifier hs-var">handleCommand</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a -&gt; CommandM a
forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621682196183"><span class="hs-identifier hs-var">inEmacs</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="#local-6989586621682196184"><span class="hs-identifier hs-var">onFail</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621682196185"><span class="annot"><a href="#local-6989586621682196185"><span class="hs-identifier hs-var">currentAbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath)
-&gt; IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO AbsolutePath
</span><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-var">absolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196187"><span class="hs-identifier hs-var">current</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621682196188"><span class="annot"><a href="#local-6989586621682196188"><span class="hs-identifier hs-var">cf</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621682196190"><span class="annot"><a href="#local-6989586621682196190"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-type">independent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196192"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682196192"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682196185"><span class="hs-identifier hs-type">currentAbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682196188"><span class="hs-identifier hs-type">cf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196196"><span class="annot"><a href="#local-6989586621682196196"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-type">cmd_load'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196187"><span class="hs-identifier hs-type">current</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621682196196"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CheckResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>      </span><span id="local-6989586621682196198"><span class="annot"><a href="#local-6989586621682196198"><span class="hs-identifier hs-var">cf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196182"><span class="hs-identifier hs-type">iotcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileModule"><span class="hs-identifier hs-var">currentFileModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196198"><span class="hs-identifier hs-type">cf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682196202"><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621682196202"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621682196202"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#withCurrentFile"><span class="hs-identifier hs-type">withCurrentFile</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-type">interpret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196190"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621682196205"><span class="annot"><a href="#local-6989586621682196205"><span class="hs-identifier hs-var">cf'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-type">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196190"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682196185"><span class="hs-identifier hs-type">currentAbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682196205"><span class="hs-identifier hs-type">cf'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_InteractionPoints"><span class="hs-identifier hs-type">Resp_InteractionPoints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- The ranges in cmd might be incorrect because of the use of</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- Nothing here. That is taken care of above.</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span id="local-6989586621682196187"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196187"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span id="local-6989586621682196210"><span class="annot"><span class="annottext">HighlightingLevel
</span><a href="#local-6989586621682196210"><span class="hs-identifier hs-var">highlighting</span></a></span></span><span> </span><span id="local-6989586621682196211"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621682196211"><span class="hs-identifier hs-var">highlightingMethod</span></a></span></span><span> </span><span id="local-6989586621682196192"><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621682196192"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621682196182"><span class="hs-identifier hs-var">iotcm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><a href="#local-6989586621682196183"><span class="hs-identifier hs-type">inEmacs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682196212"><span class="annot"><a href="#local-6989586621682196212"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196212"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196212"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621682196183"><span class="annot"><span class="annottext">inEmacs :: forall a. CommandM a -&gt; CommandM a
</span><a href="#local-6989586621682196183"><span class="hs-identifier hs-var hs-var">inEmacs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
forall a. (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="annot"><span class="annottext">((forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a)
-&gt; (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; TCEnv -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCMT IO x -&gt; TCMT IO x)
-&gt; TCEnv -&gt; TCMT IO x -&gt; TCMT IO x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#initEnv"><span class="hs-identifier hs-var">initEnv</span></a></span><span>
</span><span id="line-281"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682196210"><span class="hs-identifier hs-type">highlighting</span></a></span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingMethod"><span class="hs-identifier hs-var">envHighlightingMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682196211"><span class="hs-identifier hs-type">highlightingMethod</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- If an independent command fails we should reset theCurrentFile (Issue853).</span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621682196184"><span class="annot"><span class="annottext">onFail :: CommandM ()
</span><a href="#local-6989586621682196184"><span class="hs-identifier hs-var hs-var">onFail</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="#local-6989586621682196192"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; CommandM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; CommandM ())
-&gt; (CommandState -&gt; CommandState) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196218"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196218"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196218"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-287"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- Command queues</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | If the next command from the command queue is anything but an</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- actual command, then the command is returned.</span><span>
</span><span id="line-294"></span><span class="hs-comment">--</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- If the command is an 'IOTCM' command, then the following happens:</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- The given computation is applied to the command and executed. If an</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- abort command is encountered (and acted upon), then the computation</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- is interrupted, the persistent state and all options are restored,</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- and some commands are sent to the frontend. If the computation was</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- not interrupted, then its result is returned.</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- TODO: It might be nice if some of the changes to the persistent</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- state inflicted by the interrupted computation were preserved.</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span id="local-6989586621682194828"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeAbort"><span class="hs-identifier hs-type">maybeAbort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194828"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Command%27"><span class="hs-identifier hs-type">Command'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682194828"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-306"></span><span id="maybeAbort"><span class="annot"><span class="annottext">maybeAbort :: forall a. (IOTCM -&gt; CommandM a) -&gt; CommandM (Command' (Maybe a))
</span><a href="Agda.Interaction.InteractionTop.html#maybeAbort"><span class="hs-identifier hs-var hs-var">maybeAbort</span></a></span></span><span> </span><span id="local-6989586621682196263"><span class="annot"><span class="annottext">IOTCM -&gt; CommandM a
</span><a href="#local-6989586621682196263"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621682196264"><span class="annot"><a href="#local-6989586621682196264"><span class="hs-identifier hs-var">commandState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM CommandState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196265"><span class="annot"><a href="#local-6989586621682196265"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; CommandQueue
</span><a href="Agda.Interaction.Base.html#commandQueue"><span class="hs-identifier hs-var">commandQueue</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196264"><span class="hs-identifier hs-var">commandState</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682196267"><span class="annot"><a href="#local-6989586621682196267"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196268"><span class="annot"><a href="#local-6989586621682196268"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readTChan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#commands"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196265"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196268"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><span class="annottext">Command
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; StateT CommandState TCM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a)
forall a. Command' a
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Base.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621682196274"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196274"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; StateT CommandState TCM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Command' (Maybe a)
forall a. String -&gt; Command' a
</span><a href="Agda.Interaction.Base.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196274"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span id="local-6989586621682196276"><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621682196276"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>      </span><span id="local-6989586621682196277"><span class="annot"><a href="#local-6989586621682196277"><span class="hs-identifier hs-var">tcState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-315"></span><span>      </span><span id="local-6989586621682196278"><span class="annot"><a href="#local-6989586621682196278"><span class="hs-identifier hs-var">tcEnv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#askTC"><span class="hs-identifier hs-type">askTC</span></a></span><span>
</span><span id="line-316"></span><span>      </span><span id="local-6989586621682196280"><span class="annot"><a href="#local-6989586621682196280"><span class="hs-identifier hs-var">result</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">race</span></span><span>
</span><span id="line-317"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#runTCM"><span class="hs-identifier hs-type">runTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196278"><span class="hs-identifier hs-type">tcEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196277"><span class="hs-identifier hs-type">tcState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-318"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682196263"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196276"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196264"><span class="hs-identifier hs-type">commandState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682196283"><span class="hs-identifier hs-type">waitForAbort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196267"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196265"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196280"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682196284"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682196284"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196285"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196285"><span class="hs-identifier hs-var">commandState'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196286"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682196286"><span class="hs-identifier hs-var">tcState'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>          </span><span class="annot"><span class="annottext">TCState -&gt; CommandM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682196286"><span class="hs-identifier hs-var">tcState'</span></a></span><span>
</span><span id="line-323"></span><span>          </span><span class="annot"><span class="annottext">CommandState -&gt; CommandM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196285"><span class="hs-identifier hs-var">commandState'</span></a></span><span>
</span><span id="line-324"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621682196276"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>            </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_exit"><span class="hs-identifier hs-var">Cmd_exit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>              </span><span class="annot"><span class="annottext">Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DoneExiting"><span class="hs-identifier hs-var">Resp_DoneExiting</span></a></span><span>
</span><span id="line-327"></span><span>              </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; StateT CommandState TCM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a)
forall a. Command' a
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-328"></span><span>            </span><span class="annot"><span class="annottext">IOTCM' Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; StateT CommandState TCM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; Command' (Maybe a)
forall a. a -&gt; Command' a
</span><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-var">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682196284"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682196289"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196289"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; CommandM ()
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CommandM ()) -&gt; IO () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandQueue -&gt; Integer -&gt; IO ()
</span><a href="#local-6989586621682196290"><span class="hs-identifier hs-var">popAbortedCommands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621682196265"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196289"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-331"></span><span>          </span><span class="annot"><span class="annottext">TCState -&gt; CommandM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; CommandM ()) -&gt; TCState -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; LensSet TCState PragmaOptions
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
forall a. LensPragmaOptions a =&gt; Lens' a PragmaOptions
Lens' TCState PragmaOptions
</span><a href="Agda.Interaction.Options.Types.html#lensPragmaOptions"><span class="hs-identifier hs-var">lensPragmaOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682196277"><span class="hs-identifier hs-var">tcState</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState PragmaOptions -&gt; PragmaOptions
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
forall a. LensPragmaOptions a =&gt; Lens' a PragmaOptions
Lens' TCState PragmaOptions
</span><a href="Agda.Interaction.Options.Types.html#lensPragmaOptions"><span class="hs-identifier hs-var">lensPragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCState -&gt; TCState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="annottext">PersistentTCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#initStateFromPersistentState"><span class="hs-identifier hs-var">initStateFromPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; TCState) -&gt; PersistentTCState -&gt; TCState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682196277"><span class="hs-identifier hs-var">tcState</span></a></span><span>
</span><span id="line-333"></span><span>          </span><span class="annot"><span class="annottext">CommandState -&gt; CommandM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandM ()) -&gt; CommandState -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; CommandState
</span><a href="Agda.Interaction.Base.html#initCommandState"><span class="hs-identifier hs-var">initCommandState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandState -&gt; CommandQueue
</span><a href="Agda.Interaction.Base.html#commandQueue"><span class="hs-identifier hs-var">commandQueue</span></a></span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682196264"><span class="hs-identifier hs-var">commandState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#optionsOnReload"><span class="hs-identifier hs-var">optionsOnReload</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#optionsOnReload"><span class="hs-identifier hs-var">optionsOnReload</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196264"><span class="hs-identifier hs-type">commandState</span></a></span><span>
</span><span id="line-335"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-336"></span><span>          </span><span class="annot"><span class="annottext">Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DoneAborting"><span class="hs-identifier hs-var">Resp_DoneAborting</span></a></span><span>
</span><span id="line-337"></span><span>          </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-338"></span><span>          </span><span class="annot"><span class="annottext">Command' (Maybe a) -&gt; StateT CommandState TCM (Command' (Maybe a))
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; Command' (Maybe a)
forall a. a -&gt; Command' a
</span><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-var">Command</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-comment">-- Returns if the currently executing command should be aborted.</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-comment">-- The &quot;abort number&quot; is returned.</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><a href="#local-6989586621682196283"><span class="hs-identifier hs-type">waitForAbort</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>       </span><span class="hs-comment">-- The number of the currently executing command.</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span>  </span><span class="hs-comment">-- The command queue.</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621682196283"><span class="annot"><span class="annottext">waitForAbort :: Integer -&gt; CommandQueue -&gt; IO Integer
</span><a href="#local-6989586621682196283"><span class="hs-identifier hs-var hs-var">waitForAbort</span></a></span></span><span> </span><span id="local-6989586621682196306"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196306"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682196307"><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621682196307"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><span class="annottext">STM Integer -&gt; IO Integer
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM Integer -&gt; IO Integer) -&gt; STM Integer -&gt; IO Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>      </span><span id="local-6989586621682196308"><span class="annot"><a href="#local-6989586621682196308"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer) -&gt; STM (Maybe Integer)
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TVar (Maybe Integer)
</span><a href="Agda.Interaction.Base.html#abort"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621682196307"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196308"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682196311"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196311"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196306"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196311"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; STM Integer
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196311"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">Maybe Integer
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM Integer
forall a. STM a
</span><span class="hs-identifier hs-var">retry</span></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-comment">-- Removes every command for which the command number is at most</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-comment">-- the given number (the &quot;abort number&quot;) from the command queue.</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-comment">-- New commands could be added to the end of the queue while this</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-comment">-- computation is running. This does not lead to a race condition,</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- because those commands have higher command numbers, so they will</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- not be removed.</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><a href="#local-6989586621682196290"><span class="hs-identifier hs-type">popAbortedCommands</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>  </span><span id="local-6989586621682196290"><span class="annot"><span class="annottext">popAbortedCommands :: CommandQueue -&gt; Integer -&gt; IO ()
</span><a href="#local-6989586621682196290"><span class="hs-identifier hs-var hs-var">popAbortedCommands</span></a></span></span><span> </span><span id="local-6989586621682196314"><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621682196314"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682196315"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196315"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621682196316"><span class="annot"><a href="#local-6989586621682196316"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM Bool -&gt; IO Bool
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM Bool -&gt; IO Bool) -&gt; STM Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span id="local-6989586621682196317"><span class="annot"><a href="#local-6989586621682196317"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; STM (Maybe (Integer, Command))
forall a. TChan a -&gt; STM (Maybe a)
</span><span class="hs-identifier hs-var">tryReadTChan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TChan (Integer, Command)
</span><a href="Agda.Interaction.Base.html#commands"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621682196314"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196317"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Integer, Command)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-369"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682196319"><span class="annot"><span class="annottext">(Integer, Command)
</span><a href="#local-6989586621682196319"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-370"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Integer, Command) -&gt; Integer
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Integer, Command)
</span><a href="#local-6989586621682196319"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196315"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-371"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-372"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; (Integer, Command) -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">unGetTChan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandQueue -&gt; TChan (Integer, Command)
</span><a href="Agda.Interaction.Base.html#commands"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="annot"><span class="annottext">CommandQueue
</span><a href="#local-6989586621682196314"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer, Command)
</span><a href="#local-6989586621682196319"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196316"><span class="hs-identifier hs-type">done</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><a href="#local-6989586621682196290"><span class="hs-identifier hs-type">popAbortedCommands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196314"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196315"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Creates a command queue, and forks a thread that writes commands</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- to the queue. The queue is returned.</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#initialiseCommandQueue"><span class="hs-identifier hs-type">initialiseCommandQueue</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-383"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Returns the next command.</span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span>
</span><span id="line-385"></span><span id="initialiseCommandQueue"><span class="annot"><span class="annottext">initialiseCommandQueue :: IO Command -&gt; IO CommandQueue
</span><a href="Agda.Interaction.InteractionTop.html#initialiseCommandQueue"><span class="hs-identifier hs-var hs-var">initialiseCommandQueue</span></a></span></span><span> </span><span id="local-6989586621682196323"><span class="annot"><span class="annottext">IO Command
</span><a href="#local-6989586621682196323"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>  </span><span id="local-6989586621682196324"><span class="annot"><a href="#local-6989586621682196324"><span class="hs-identifier hs-var">commands</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan (Integer, Command))
forall a. IO (TChan a)
</span><span class="hs-identifier hs-var">newTChanIO</span></span><span>
</span><span id="line-387"></span><span>  </span><span id="local-6989586621682196326"><span class="annot"><a href="#local-6989586621682196326"><span class="hs-identifier hs-var">abort</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newTVarIO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Read commands. The argument is the number of the previous</span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-comment">-- command (other than abort commands) that was read, if any.</span><span>
</span><span id="line-391"></span><span>      </span><span id="local-6989586621682196328"><span class="annot"><a href="#local-6989586621682196328"><span class="hs-identifier hs-var hs-var">readCommands</span></a></span></span><span> </span><span id="local-6989586621682196329"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196329"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>        </span><span id="local-6989586621682196330"><span class="annot"><a href="#local-6989586621682196330"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Command
</span><a href="#local-6989586621682196323"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196330"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Base.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span id="local-6989586621682196331"><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621682196331"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#IOTCM"><span class="hs-identifier hs-type">IOTCM</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_abort"><span class="hs-identifier hs-var">Cmd_abort</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOTCM
</span><a href="#local-6989586621682196331"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>            </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer) -&gt; Maybe Integer -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe Integer)
</span><a href="#local-6989586621682196326"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196329"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; IO ()
</span><a href="#local-6989586621682196328"><span class="hs-identifier hs-var">readCommands</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196329"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-397"></span><span>          </span><span class="annot"><span class="annottext">Command
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196334"><span class="annot"><span class="annottext">n' :: Integer
</span><a href="#local-6989586621682196334"><span class="hs-identifier hs-var hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196329"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>            </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command) -&gt; (Integer, Command) -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Integer, Command)
</span><a href="#local-6989586621682196324"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196334"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621682196330"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621682196330"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-401"></span><span>              </span><span class="annot"><span class="annottext">Command
</span><a href="Agda.Interaction.Base.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>              </span><span class="annot"><span class="annottext">Command
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; IO ()
</span><a href="#local-6989586621682196328"><span class="hs-identifier hs-var">readCommands</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682196334"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forkIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682196328"><span class="hs-identifier hs-type">readCommands</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#CommandQueue"><span class="hs-identifier hs-type">CommandQueue</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#commands"><span class="hs-glyph hs-var hs-var hs-type hs-type">..</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">---------------------------------------------------------</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | Can the command run even if the relevant file has not been loaded</span><span>
</span><span id="line-411"></span><span class="hs-comment">--   into the state?</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-type">independent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-414"></span><span id="independent"><span class="annot"><span class="annottext">independent :: Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var hs-var">independent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load"><span class="hs-identifier hs-type">Cmd_load</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-415"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_no_metas"><span class="hs-identifier hs-type">Cmd_load_no_metas</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-416"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compile"><span class="hs-identifier hs-type">Cmd_compile</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-417"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_highlighting_info"><span class="hs-identifier hs-type">Cmd_load_highlighting_info</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-418"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_tokenHighlighting"><span class="hs-identifier hs-type">Cmd_tokenHighlighting</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-419"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_show_version"><span class="hs-identifier hs-var">Cmd_show_version</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-420"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#independent"><span class="hs-identifier hs-var">independent</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><span class="hs-identifier">_</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- | Should 'Resp_InteractionPoints' be issued after the command has</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- run?</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-type">updateInteractionPointsAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-426"></span><span id="updateInteractionPointsAfter"><span class="annot"><span class="annottext">updateInteractionPointsAfter :: Interaction' Range -&gt; Bool
</span><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var hs-var">updateInteractionPointsAfter</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load"><span class="hs-identifier hs-type">Cmd_load</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-427"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compile"><span class="hs-identifier hs-type">Cmd_compile</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-428"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_backend_top"><span class="hs-identifier hs-type">Cmd_backend_top</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-429"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_backend_hole"><span class="hs-identifier hs-type">Cmd_backend_hole</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-430"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_constraints"><span class="hs-identifier hs-type">Cmd_constraints</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-431"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-type">Cmd_metas</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-432"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_no_metas"><span class="hs-identifier hs-type">Cmd_load_no_metas</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents_toplevel"><span class="hs-identifier hs-type">Cmd_show_module_contents_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-434"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_search_about_toplevel"><span class="hs-identifier hs-type">Cmd_search_about_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-435"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveAll"><span class="hs-identifier hs-type">Cmd_solveAll</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-436"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveOne"><span class="hs-identifier hs-type">Cmd_solveOne</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-437"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer_toplevel"><span class="hs-identifier hs-type">Cmd_infer_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute_toplevel"><span class="hs-identifier hs-type">Cmd_compute_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-439"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_highlighting_info"><span class="hs-identifier hs-type">Cmd_load_highlighting_info</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-440"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_tokenHighlighting"><span class="hs-identifier hs-type">Cmd_tokenHighlighting</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-441"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_highlight"><span class="hs-identifier hs-type">Cmd_highlight</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-442"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ShowImplicitArgs"><span class="hs-identifier hs-type">ShowImplicitArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-443"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ToggleImplicitArgs"><span class="hs-identifier hs-type">ToggleImplicitArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-444"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ShowIrrelevantArgs"><span class="hs-identifier hs-type">ShowIrrelevantArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-445"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#ToggleIrrelevantArgs"><span class="hs-identifier hs-type">ToggleIrrelevantArgs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-446"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_give"><span class="hs-identifier hs-type">Cmd_give</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-447"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine"><span class="hs-identifier hs-type">Cmd_refine</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-448"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_intro"><span class="hs-identifier hs-type">Cmd_intro</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-449"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine_or_intro"><span class="hs-identifier hs-type">Cmd_refine_or_intro</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-450"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoOne"><span class="hs-identifier hs-type">Cmd_autoOne</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-451"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoAll"><span class="hs-identifier hs-type">Cmd_autoAll</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-452"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_context"><span class="hs-identifier hs-type">Cmd_context</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-453"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_helper_function"><span class="hs-identifier hs-type">Cmd_helper_function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-454"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer"><span class="hs-identifier hs-type">Cmd_infer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-455"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type"><span class="hs-identifier hs-type">Cmd_goal_type</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-456"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_elaborate_give"><span class="hs-identifier hs-type">Cmd_elaborate_give</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-457"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context"><span class="hs-identifier hs-type">Cmd_goal_type_context</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-458"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_infer"><span class="hs-identifier hs-type">Cmd_goal_type_context_infer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-459"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_check"><span class="hs-identifier hs-type">Cmd_goal_type_context_check</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-460"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents"><span class="hs-identifier hs-type">Cmd_show_module_contents</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-461"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_make_case"><span class="hs-identifier hs-type">Cmd_make_case</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-462"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute"><span class="hs-identifier hs-type">Cmd_compute</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-463"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope"><span class="hs-identifier hs-type">Cmd_why_in_scope</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope_toplevel"><span class="hs-identifier hs-type">Cmd_why_in_scope_toplevel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-465"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_version"><span class="hs-identifier hs-type">Cmd_show_version</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-466"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_abort"><span class="hs-identifier hs-type">Cmd_abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-467"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#updateInteractionPointsAfter"><span class="hs-identifier hs-var">updateInteractionPointsAfter</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_exit"><span class="hs-identifier hs-type">Cmd_exit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#getBackendName"><span class="hs-identifier hs-type">getBackendName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CompilerBackend"><span class="hs-identifier hs-type">CompilerBackend</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#BackendName"><span class="hs-identifier hs-type">BackendName</span></a></span><span>
</span><span id="line-470"></span><span id="getBackendName"><span class="annot"><span class="annottext">getBackendName :: CompilerBackend -&gt; BackendName
</span><a href="Agda.Interaction.InteractionTop.html#getBackendName"><span class="hs-identifier hs-var hs-var">getBackendName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#LaTeX"><span class="hs-identifier hs-var">LaTeX</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendName
</span><span class="hs-string">&quot;LaTeX&quot;</span></span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#QuickLaTeX"><span class="hs-identifier hs-var">QuickLaTeX</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendName
</span><span class="hs-string">&quot;LaTeX&quot;</span></span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><a href="Agda.Interaction.Base.html#OtherBackend"><span class="hs-identifier hs-type">OtherBackend</span></a></span><span> </span><span class="annot"><span class="annottext">BackendName
</span><span class="hs-string">&quot;GHCNoMain&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendName
</span><span class="hs-string">&quot;GHC&quot;</span></span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><a href="Agda.Interaction.Base.html#OtherBackend"><span class="hs-identifier hs-type">OtherBackend</span></a></span><span> </span><span id="local-6989586621682196384"><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621682196384"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendName
</span><a href="#local-6989586621682196384"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">-- | Interpret an interaction.</span><span>
</span><span id="line-477"></span><span class="hs-comment">--</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- For each goal command specific to an 'InteractionPoint'</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- that comes with a 'Range' for this interaction point</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- we first synchronize this 'Range' with the 'Range'</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- Agda has stored for the interaction meta.</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- In general, we consider the 'Range' sent with the command</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- as more up-to-date than the  the 'Range' Agda has stored.</span><span>
</span><span id="line-484"></span><span class="hs-comment">-- This is because the editor keeps track of changes</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- (that usually modify the position of interaction points),</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- but Agda does not.</span><span>
</span><span id="line-487"></span><span class="hs-comment">--</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- Some goal commands carry a 'Range' for reasons of uniformity but do not use it.</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- For those, we do not synchronize the range.</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-type">interpret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span id="interpret"><span class="annot"><span class="annottext">interpret :: Interaction' Range -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var hs-var">interpret</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load"><span class="hs-identifier hs-type">Cmd_load</span></a></span><span> </span><span id="local-6989586621682196388"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196388"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682196389"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196389"><span class="hs-identifier hs-var">argv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM ())
-&gt; CommandM ()
forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var">cmd_load'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196388"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196389"><span class="hs-identifier hs-var">argv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621682196390"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">((CheckResult -&gt; CommandM ()) -&gt; CommandM ())
-&gt; (CheckResult -&gt; CommandM ()) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CheckResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">(Interaction' Range -&gt; CommandM ())
-&gt; Interaction' Range -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Interaction' Range
forall range. Rewrite -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-var">Cmd_metas</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-var">AsIs</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-496"></span><span>  </span><span id="local-6989586621682196390"><span class="annot"><span class="annottext">mode :: Mode
</span><a href="#local-6989586621682196390"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compile"><span class="hs-identifier hs-type">Cmd_compile</span></a></span><span> </span><span id="local-6989586621682196392"><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196392"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621682196393"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196393"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621682196394"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196394"><span class="hs-identifier hs-var">argv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM ())
-&gt; CommandM ()
forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var">cmd_load'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196393"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196394"><span class="hs-identifier hs-var">argv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196395"><span class="hs-identifier hs-var">allowUnsolved</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621682196396"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">((CheckResult -&gt; CommandM ()) -&gt; CommandM ())
-&gt; (CheckResult -&gt; CommandM ()) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196397"><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682196397"><span class="hs-identifier hs-var">checkResult</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-500"></span><span>    </span><span id="local-6989586621682196398"><span class="annot"><a href="#local-6989586621682196398"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Set TCWarning) -&gt; StateT CommandState TCM (Set TCWarning)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Set TCWarning) -&gt; StateT CommandState TCM (Set TCWarning))
-&gt; TCM (Set TCWarning) -&gt; StateT CommandState TCM (Set TCWarning)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; TCM (Set TCWarning)
forall (m :: * -&gt; *).
HasOptions m =&gt;
Set TCWarning -&gt; m (Set TCWarning)
</span><a href="Agda.TypeChecking.Pretty.Warning.html#applyFlagsToTCWarnings"><span class="hs-identifier hs-var">applyFlagsToTCWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TCWarning -&gt; TCM (Set TCWarning))
-&gt; Set TCWarning -&gt; TCM (Set TCWarning)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CheckResult -&gt; Set TCWarning
</span><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier hs-var">crWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682196397"><span class="hs-identifier hs-var">checkResult</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196398"><span class="hs-identifier hs-type">ws</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-502"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-503"></span><span>        </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BackendName -&gt; IsMain -&gt; CheckResult -&gt; TCM ()
</span><a href="Agda.Compiler.Backend.html#callBackend"><span class="hs-identifier hs-var">callBackend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilerBackend -&gt; BackendName
</span><a href="Agda.Interaction.InteractionTop.html#getBackendName"><span class="hs-identifier hs-var">getBackendName</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196392"><span class="hs-identifier hs-var">backend</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="#local-6989586621682196402"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682196397"><span class="hs-identifier hs-var">checkResult</span></a></span><span>
</span><span id="line-504"></span><span>        </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; (WarningsAndNonFatalErrors
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; WarningsAndNonFatalErrors
-&gt; CommandM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerBackend
-&gt; WarningsAndNonFatalErrors
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
CompilerBackend
-&gt; warningsAndNonFatalErrors
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_CompilationOk"><span class="hs-identifier hs-var">Info_CompilationOk</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196392"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningsAndNonFatalErrors -&gt; CommandM ())
-&gt; StateT CommandState TCM WarningsAndNonFatalErrors -&gt; CommandM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM WarningsAndNonFatalErrors
-&gt; StateT CommandState TCM WarningsAndNonFatalErrors
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM WarningsAndNonFatalErrors
</span><a href="Agda.Interaction.BasicOps.html#getWarningsAndNonFatalErrors"><span class="hs-identifier hs-var">B.getWarningsAndNonFatalErrors</span></a></span><span>
</span><span id="line-505"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
Info_Error_boot tcErr tcWarning
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Error"><span class="hs-identifier hs-var">Info_Error</span></a></span><span> </span><span class="annot"><span class="annottext">(Info_Error
 -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; Info_Error
forall tcErr tcWarning.
Set tcWarning -&gt; Info_Error_boot tcErr tcWarning
</span><a href="Agda.Interaction.Response.Base.html#Info_CompilationError"><span class="hs-identifier hs-var">Info_CompilationError</span></a></span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682196398"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>  </span><span id="local-6989586621682196395"><span class="annot"><span class="annottext">allowUnsolved :: Bool
</span><a href="#local-6989586621682196395"><span class="hs-identifier hs-var hs-var">allowUnsolved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196392"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBackend -&gt; [CompilerBackend] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#LaTeX"><span class="hs-identifier hs-var">LaTeX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#QuickLaTeX"><span class="hs-identifier hs-var">QuickLaTeX</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-508"></span><span>  </span><span id="local-6989586621682196396"><span class="annot"><span class="annottext">mode :: Mode
</span><a href="#local-6989586621682196396"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="Agda.Interaction.Base.html#QuickLaTeX"><span class="hs-identifier hs-var">QuickLaTeX</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196392"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span>
</span><span id="line-509"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>
</span><span id="line-510"></span><span>  </span><span id="local-6989586621682196402"><span class="annot"><span class="annottext">isMain :: IsMain
</span><a href="#local-6989586621682196402"><span class="hs-identifier hs-var hs-var">isMain</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#OtherBackend"><span class="hs-identifier hs-type">OtherBackend</span></a></span><span> </span><span class="annot"><span class="annottext">BackendName
</span><span class="hs-string">&quot;GHCNoMain&quot;</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196392"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#NotMain"><span class="hs-identifier hs-var">NotMain</span></a></span><span>
</span><span id="line-511"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-var">IsMain</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_backend_top"><span class="hs-identifier hs-type">Cmd_backend_top</span></a></span><span> </span><span id="local-6989586621682196410"><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196410"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621682196411"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196411"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>  </span><span class="annot"><span class="annottext">BackendName -&gt; String -&gt; CommandM ()
</span><a href="Agda.Compiler.Backend.html#callBackendInteractTop"><span class="hs-identifier hs-var">callBackendInteractTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilerBackend -&gt; BackendName
</span><a href="Agda.Interaction.InteractionTop.html#getBackendName"><span class="hs-identifier hs-var">getBackendName</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196410"><span class="hs-identifier hs-var">backend</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196411"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_backend_hole"><span class="hs-identifier hs-type">Cmd_backend_hole</span></a></span><span> </span><span id="local-6989586621682196413"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196413"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196414"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196414"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196415"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196415"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682196416"><span class="annot"><span class="annottext">CompilerBackend
</span><a href="#local-6989586621682196416"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621682196417"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196417"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-517"></span><span>  </span><span id="local-6989586621682196418"><span class="annot"><a href="#local-6989586621682196418"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196413"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196414"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-518"></span><span>  </span><span class="annot"><a href="Agda.Compiler.Backend.html#callBackendInteractHole"><span class="hs-identifier hs-type">callBackendInteractHole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#getBackendName"><span class="hs-identifier hs-type">getBackendName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196416"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196417"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196413"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196418"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196415"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_constraints"><span class="hs-identifier hs-type">Cmd_constraints</span></a></span><span> </span><span id="local-6989586621682196421"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196421"><span class="hs-identifier hs-var">norm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; ([OutputForm_boot TCErr Expr Expr]
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; [OutputForm_boot TCErr Expr Expr]
-&gt; CommandM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[OutputForm_boot TCErr Expr Expr]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
[OutputForm_boot tcErr Expr Expr]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Constraints"><span class="hs-identifier hs-var">Info_Constraints</span></a></span><span> </span><span class="annot"><span class="annottext">([OutputForm_boot TCErr Expr Expr] -&gt; CommandM ())
-&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr]
-&gt; CommandM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM [OutputForm_boot TCErr Expr Expr]
-&gt; StateT CommandState TCM [OutputForm_boot TCErr Expr Expr]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; TCM [OutputForm_boot TCErr Expr Expr]
</span><a href="Agda.Interaction.BasicOps.html#getConstraints"><span class="hs-identifier hs-var">B.getConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196421"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-type">Cmd_metas</span></a></span><span> </span><span id="local-6989586621682196424"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196424"><span class="hs-identifier hs-var">norm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-524"></span><span>  </span><span id="local-6989586621682196425"><span class="annot"><a href="#local-6989586621682196425"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Goals -&gt; StateT CommandState TCM Goals
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Goals -&gt; StateT CommandState TCM Goals)
-&gt; TCMT IO Goals -&gt; StateT CommandState TCM Goals
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Rewrite -&gt; TCMT IO Goals
</span><a href="Agda.Interaction.BasicOps.html#getGoals%27"><span class="hs-identifier hs-var">B.getGoals'</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196424"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; Rewrite -&gt; Rewrite
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196424"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_AllGoalsWarnings"><span class="hs-identifier hs-type">Info_AllGoalsWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196425"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#getWarningsAndNonFatalErrors"><span class="hs-identifier hs-type">B.getWarningsAndNonFatalErrors</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_no_metas"><span class="hs-identifier hs-type">Cmd_load_no_metas</span></a></span><span> </span><span id="local-6989586621682196430"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196430"><span class="hs-identifier hs-var">file</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-comment">-- Fail if there are open metas.</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196431"><span class="annot"><span class="annottext">allowMetas :: Bool
</span><a href="#local-6989586621682196431"><span class="hs-identifier hs-var hs-var">allowMetas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM ())
-&gt; CommandM ()
forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var">cmd_load'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196430"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196431"><span class="hs-identifier hs-var">allowMetas</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">((CheckResult -&gt; CommandM ()) -&gt; CommandM ())
-&gt; (CheckResult -&gt; CommandM ()) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196432"><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682196432"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><span class="annottext">CheckResult -&gt; CommandM ()
forall (m :: * -&gt; *).
(HasOptions m, MonadTCError m) =&gt;
CheckResult -&gt; m ()
</span><a href="Agda.Interaction.Imports.html#raiseNonFatalErrors"><span class="hs-identifier hs-var">Imp.raiseNonFatalErrors</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682196432"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="annottext">StateT CommandState TCM Bool -&gt; CommandM () -&gt; CommandM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([MetaId] -&gt; Bool)
-&gt; StateT CommandState TCM [MetaId] -&gt; StateT CommandState TCM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [MetaId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [MetaId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getOpenMetas"><span class="hs-identifier hs-var">getOpenMetas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents_toplevel"><span class="hs-identifier hs-type">Cmd_show_module_contents_toplevel</span></a></span><span> </span><span id="local-6989586621682196436"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196436"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196437"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196437"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><span class="annottext">CommandM () -&gt; CommandM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-var">showModuleContents</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196436"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196437"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_search_about_toplevel"><span class="hs-identifier hs-type">Cmd_search_about_toplevel</span></a></span><span> </span><span id="local-6989586621682196440"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196440"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196441"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196441"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="annottext">CommandM () -&gt; CommandM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#searchAbout"><span class="hs-identifier hs-var">searchAbout</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196440"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196441"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveAll"><span class="hs-identifier hs-type">Cmd_solveAll</span></a></span><span> </span><span id="local-6989586621682196443"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196443"><span class="hs-identifier hs-var">norm</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Maybe InteractionId -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-var">solveInstantiatedGoals</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196443"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe InteractionId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-541"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_solveOne"><span class="hs-identifier hs-type">Cmd_solveOne</span></a></span><span> </span><span id="local-6989586621682196445"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196445"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196446"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196446"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Maybe InteractionId -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-var">solveInstantiatedGoals</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196447"><span class="hs-identifier hs-var">norm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; Maybe InteractionId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196446"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-comment">-- `solveOne` is called via `agda2-maybe-normalised` which does not use</span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-comment">-- AsIs &lt; Simplified &lt; Normalised but rather Simplified &lt; Instantiated &lt; Normalised</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-comment">-- So we remap the Rewrite modifiers to match solveAll's behaviour.</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-comment">-- NB: instantiate is called in getSolvedInteractionPoints no matter what.</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682196447"><span class="annot"><span class="annottext">norm' :: Rewrite
</span><a href="#local-6989586621682196447"><span class="hs-identifier hs-var hs-var">norm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196445"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-547"></span><span>                  </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-var">AsIs</span></a></span><span>
</span><span id="line-548"></span><span>                  </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Instantiated"><span class="hs-identifier hs-var">Instantiated</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="Agda.Interaction.Base.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span>
</span><span id="line-549"></span><span>                  </span><span class="annot"><span class="annottext">Rewrite
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196445"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer_toplevel"><span class="hs-identifier hs-type">Cmd_infer_toplevel</span></a></span><span> </span><span id="local-6989586621682196449"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196449"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196450"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196450"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682196451"><span class="annot"><a href="#local-6989586621682196451"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196452"><span class="annot"><a href="#local-6989586621682196452"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM Expr) -&gt; String -&gt; CommandM (Maybe CPUTime, Expr)
forall a. (Expr -&gt; TCM a) -&gt; String -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-var">parseAndDoAtToplevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#typeInCurrent"><span class="hs-identifier hs-var">B.typeInCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196449"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196450"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621682196455"><span class="annot"><a href="#local-6989586621682196455"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">get</span></span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_InferredType"><span class="hs-identifier hs-type">Info_InferredType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196455"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196451"><span class="hs-identifier hs-type">time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196452"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#ShowImplicitArgs"><span class="hs-identifier hs-type">ShowImplicitArgs</span></a></span><span> </span><span id="local-6989586621682196457"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196457"><span class="hs-identifier hs-var">showImpl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>  </span><span id="local-6989586621682196458"><span class="annot"><a href="#local-6989586621682196458"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Types.html#lensPragmaOptions"><span class="hs-identifier hs-type">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#lensOptShowImplicit"><span class="hs-identifier hs-type">lensOptShowImplicit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier hs-type">lensKeepDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196457"><span class="hs-identifier hs-type">showImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196458"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#ToggleImplicitArgs"><span class="hs-identifier hs-var">ToggleImplicitArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621682196473"><span class="annot"><a href="#local-6989586621682196473"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-type">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Types.html#lensPragmaOptions"><span class="hs-identifier hs-type">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#lensOptShowImplicit"><span class="hs-identifier hs-type">lensOptShowImplicit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensCollapseDefault"><span class="hs-identifier hs-type">lensCollapseDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682196473"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#ShowIrrelevantArgs"><span class="hs-identifier hs-type">ShowIrrelevantArgs</span></a></span><span> </span><span id="local-6989586621682196483"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196483"><span class="hs-identifier hs-var">showIrr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-567"></span><span>  </span><span id="local-6989586621682196484"><span class="annot"><a href="#local-6989586621682196484"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-569"></span><span>    </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Types.html#lensPragmaOptions"><span class="hs-identifier hs-type">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#lensOptShowIrrelevant"><span class="hs-identifier hs-type">lensOptShowIrrelevant</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier hs-type">lensKeepDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196483"><span class="hs-identifier hs-type">showIrr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196484"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#ToggleIrrelevantArgs"><span class="hs-identifier hs-var">ToggleIrrelevantArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621682196494"><span class="annot"><a href="#local-6989586621682196494"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-type">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Types.html#lensPragmaOptions"><span class="hs-identifier hs-type">lensPragmaOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#lensOptShowIrrelevant"><span class="hs-identifier hs-type">lensOptShowIrrelevant</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html#lensCollapseDefault"><span class="hs-identifier hs-type">lensCollapseDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682196494"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_load_highlighting_info"><span class="hs-identifier hs-type">Cmd_load_highlighting_info</span></a></span><span> </span><span id="local-6989586621682196502"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196502"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>  </span><span id="local-6989586621682196503"><span class="annot"><a href="#local-6989586621682196503"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel)
-&gt; StateT CommandState TCM HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682196503"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#None"><span class="hs-identifier hs-type">None</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-comment">-- Make sure that the include directories have</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-comment">-- been set.</span><span>
</span><span id="line-581"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-type">commandLineOptions</span></a></span><span>
</span><span id="line-582"></span><span>    </span><span id="local-6989586621682196506"><span class="annot"><a href="#local-6989586621682196506"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-type">tellToUpdateHighlighting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>      </span><span id="local-6989586621682196508"><span class="annot"><a href="#local-6989586621682196508"><span class="hs-identifier hs-var">ex</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">doesFileExist</span></span><span> </span><span class="annot"><a href="#local-6989586621682196502"><span class="hs-identifier hs-type">source</span></a></span><span>
</span><span id="line-584"></span><span>      </span><span id="local-6989586621682196510"><span class="annot"><a href="#local-6989586621682196510"><span class="hs-identifier hs-var">absSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#srcFromPath"><span class="hs-identifier hs-type">srcFromPath</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-type">absolute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196502"><span class="hs-identifier hs-type">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682196508"><span class="hs-identifier hs-type">ex</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-587"></span><span>           </span><span class="hs-keyword">do</span><span>
</span><span id="line-588"></span><span>              </span><span id="local-6989586621682196512"><span class="annot"><a href="#local-6989586621682196512"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">Imp.parseSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196510"><span class="hs-identifier hs-type">absSource</span></a></span><span>
</span><span id="line-589"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196514"><span class="annot"><a href="#local-6989586621682196514"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">Imp.srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682196512"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-590"></span><span>              </span><span class="annot"><a href="Agda.Interaction.FindFile.html#checkModuleName"><span class="hs-identifier hs-type">checkModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196514"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196510"><span class="hs-identifier hs-type">absSource</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-591"></span><span>              </span><span id="local-6989586621682196517"><span class="annot"><a href="#local-6989586621682196517"><span class="hs-identifier hs-var">mmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModule"><span class="hs-identifier hs-type">getVisitedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196514"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-592"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196517"><span class="hs-identifier hs-type">mmi</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-593"></span><span>                </span><span class="annot"><span class="annottext">Maybe ModuleInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-594"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682196519"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682196519"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-595"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Hash
</span><a href="Agda.Utils.Hash.html#hashText"><span class="hs-identifier hs-var">hashText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">Imp.srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682196512"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Hash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682196519"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-597"></span><span>                      </span><span id="local-6989586621682196524"><span class="annot"><a href="#local-6989586621682196524"><span class="hs-identifier hs-var">modFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState ModuleToSource -&gt; TCMT IO ModuleToSource
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleToSource -&gt; f ModuleToSource) -&gt; TCState -&gt; f TCState
Lens' TCState ModuleToSource
</span><a href="Agda.TypeChecking.Monad.Base.html#stModuleToSource"><span class="hs-identifier hs-var">stModuleToSource</span></a></span><span>
</span><span id="line-598"></span><span>                      </span><span id="local-6989586621682196527"><span class="annot"><a href="#local-6989586621682196527"><span class="hs-identifier hs-var">method</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eHighlightingMethod"><span class="hs-identifier hs-type">eHighlightingMethod</span></a></span><span>
</span><span id="line-599"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iHighlighting"><span class="hs-identifier hs-var">iHighlighting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196519"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682196527"><span class="hs-identifier hs-type">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682196524"><span class="hs-identifier hs-type">modFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-601"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-602"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; TCMT
     IO (Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-604"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196506"><span class="hs-identifier hs-type">resp</span></a></span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_tokenHighlighting"><span class="hs-identifier hs-type">Cmd_tokenHighlighting</span></a></span><span> </span><span id="local-6989586621682196532"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196532"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621682196533"><span class="annot"><span class="annottext">Remove
</span><a href="#local-6989586621682196533"><span class="hs-identifier hs-var">remove</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>  </span><span id="local-6989586621682196534"><span class="annot"><a href="#local-6989586621682196534"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682196535"><span class="annot"><a href="#local-6989586621682196535"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; HighlightingLevel)
-&gt; StateT CommandState TCM HighlightingLevel
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; HighlightingLevel
</span><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-609"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682196535"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#None"><span class="hs-identifier hs-type">None</span></a></span><span>
</span><span id="line-610"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-611"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>                 </span><span id="local-6989586621682196536"><span class="annot"><a href="#local-6989586621682196536"><span class="hs-identifier hs-var">source'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-type">absolute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196532"><span class="hs-identifier hs-type">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfo"><span class="hs-identifier hs-type">generateTokenInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196536"><span class="hs-identifier hs-type">source'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>                           </span><span class="annot"><span class="hs-operator hs-type">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>                        </span><span class="annot"><span class="annottext">Maybe HighlightingInfo -&gt; TCM (Maybe HighlightingInfo)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><span class="annottext">StateT CommandState TCM (Maybe HighlightingInfo)
-&gt; CommandM () -&gt; StateT CommandState TCM (Maybe HighlightingInfo)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m a -&gt; m () -&gt; m a
</span><a href="Agda.Utils.Monad.html#finally"><span class="hs-operator hs-var">`finally`</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Remove
</span><a href="#local-6989586621682196533"><span class="hs-identifier hs-var">remove</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><span class="annottext">Remove
</span><a href="Agda.Interaction.Base.html#Remove"><span class="hs-identifier hs-var">Remove</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; CommandM ()
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CommandM ()) -&gt; IO () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">removeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196532"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-619"></span><span>      </span><span class="annot"><span class="annottext">Remove
</span><a href="Agda.Interaction.Base.html#Keep"><span class="hs-identifier hs-var">Keep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196534"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682196542"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682196542"><span class="hs-identifier hs-var">info'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#RemoveHighlighting"><span class="hs-identifier hs-var">RemoveHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682196542"><span class="hs-identifier hs-var">info'</span></a></span><span>
</span><span id="line-622"></span><span>    </span><span class="annot"><span class="annottext">Maybe HighlightingInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_highlight"><span class="hs-identifier hs-type">Cmd_highlight</span></a></span><span> </span><span id="local-6989586621682196545"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196545"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196546"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196546"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196547"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196547"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>  </span><span id="local-6989586621682196548"><span class="annot"><a href="#local-6989586621682196548"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196545"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196546"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-626"></span><span>  </span><span id="local-6989586621682196549"><span class="annot"><a href="#local-6989586621682196549"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682196549"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#None"><span class="hs-identifier hs-type">None</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-628"></span><span>    </span><span id="local-6989586621682196550"><span class="annot"><a href="#local-6989586621682196550"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#getOldInteractionScope"><span class="hs-identifier hs-type">getOldInteractionScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196545"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-629"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#removeOldInteractionScope"><span class="hs-identifier hs-type">removeOldInteractionScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196545"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span class="annot"><a href="#local-6989586621682196551"><span class="hs-identifier hs-type">handle</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-631"></span><span>      </span><span id="local-6989586621682196552"><span class="annot"><a href="#local-6989586621682196552"><span class="hs-identifier hs-var">parsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682196553"><span class="hs-identifier hs-type">try</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_HighlightingParseError"><span class="hs-identifier hs-type">Info_HighlightingParseError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196545"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-632"></span><span>             </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#parseExpr"><span class="hs-identifier hs-type">B.parseExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196548"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196547"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-633"></span><span>      </span><span id="local-6989586621682196556"><span class="annot"><a href="#local-6989586621682196556"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682196553"><span class="hs-identifier hs-type">try</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_HighlightingScopeCheckError"><span class="hs-identifier hs-type">Info_HighlightingScopeCheckError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196545"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-634"></span><span>             </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract"><span class="hs-identifier hs-type">concreteToAbstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196550"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196552"><span class="hs-identifier hs-type">parsed</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-type">printHighlightingInfo</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-type">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span>
</span><span id="line-636"></span><span>               </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfoFromString"><span class="hs-identifier hs-type">generateTokenInfoFromString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196548"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196547"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-637"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-type">highlightExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196556"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><a href="#local-6989586621682196551"><span class="hs-identifier hs-type">handle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>    </span><span id="local-6989586621682196551"><span class="annot"><span class="annottext">handle :: ExceptT Info_Error TCM () -&gt; CommandM ()
</span><a href="#local-6989586621682196551"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621682196561"><span class="annot"><span class="annottext">ExceptT Info_Error TCM ()
</span><a href="#local-6989586621682196561"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>      </span><span id="local-6989586621682196562"><span class="annot"><a href="#local-6989586621682196562"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Either Info_Error ())
-&gt; StateT CommandState TCM (Either Info_Error ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Either Info_Error ())
 -&gt; StateT CommandState TCM (Either Info_Error ()))
-&gt; TCM (Either Info_Error ())
-&gt; StateT CommandState TCM (Either Info_Error ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT Info_Error TCM () -&gt; TCM (Either Info_Error ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">ExceptT Info_Error TCM ()
</span><a href="#local-6989586621682196561"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-642"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196562"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682196563"><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621682196563"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
Info_Error_boot tcErr tcWarning
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Error"><span class="hs-identifier hs-var">Info_Error</span></a></span><span> </span><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621682196563"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-644"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>    </span><span id="local-6989586621682194914"><span class="annot"><a href="#local-6989586621682196553"><span class="hs-identifier hs-type">try</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194914"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#Info_Error"><span class="hs-identifier hs-type">Info_Error</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194914"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-646"></span><span>    </span><span id="local-6989586621682196553"><span class="annot"><span class="annottext">try :: forall a. Info_Error -&gt; TCM a -&gt; ExceptT Info_Error TCM a
</span><a href="#local-6989586621682196553"><span class="hs-identifier hs-var hs-var">try</span></a></span></span><span> </span><span id="local-6989586621682196567"><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621682196567"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621682196568"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682196568"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM (Either Info_Error a) -&gt; ExceptT Info_Error TCM a
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">ExceptT</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Either Info_Error a) -&gt; ExceptT Info_Error TCM a)
-&gt; TCM (Either Info_Error a) -&gt; ExceptT Info_Error TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-647"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCErr -&gt; Info_Error) -&gt; Either TCErr a -&gt; Either Info_Error a
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><a href="Agda.Utils.Either.html#mapLeft"><span class="hs-identifier hs-var">mapLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info_Error -&gt; TCErr -&gt; Info_Error
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621682196567"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either TCErr a -&gt; Either Info_Error a)
-&gt; TCMT IO (Either TCErr a) -&gt; TCM (Either Info_Error a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCMT IO (Either TCErr a)
forall a. TCM a -&gt; TCM (Either TCErr a)
</span><a href="Agda.TypeChecking.Monad.State.html#freshTCM"><span class="hs-identifier hs-var">freshTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682196568"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM (Either Info_Error a)
-&gt; (TCErr -&gt; TCM (Either Info_Error a))
-&gt; TCM (Either Info_Error a)
forall a. TCM a -&gt; (TCErr -&gt; TCM a) -&gt; TCM a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Info_Error a -&gt; TCM (Either Info_Error a)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info_Error -&gt; Either Info_Error a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Info_Error
</span><a href="#local-6989586621682196567"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-comment">-- freshTCM to avoid scope checking creating new interaction points</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_give"><span class="hs-identifier hs-type">Cmd_give</span></a></span><span>   </span><span id="local-6989586621682196573"><span class="annot"><span class="annottext">UseForce
</span><a href="#local-6989586621682196573"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span id="local-6989586621682196574"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196574"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196575"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196575"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196576"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196576"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span>  </span><span id="local-6989586621682196577"><span class="annot"><a href="#local-6989586621682196577"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196574"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196575"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-type">give_gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196573"><span class="hs-identifier hs-type">force</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196574"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196577"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196576"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-type">Give</span></a></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine"><span class="hs-identifier hs-type">Cmd_refine</span></a></span><span> </span><span id="local-6989586621682196580"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196580"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196581"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196581"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196582"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196582"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621682196583"><span class="annot"><a href="#local-6989586621682196583"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196580"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196581"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-type">give_gen</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-type">WithoutForce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196580"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196583"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196582"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-type">Refine</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_intro"><span class="hs-identifier hs-type">Cmd_intro</span></a></span><span> </span><span id="local-6989586621682196586"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196586"><span class="hs-identifier hs-var">pmLambda</span></a></span></span><span> </span><span id="local-6989586621682196587"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196587"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196588"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196588"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-659"></span><span>  </span><span id="local-6989586621682196589"><span class="annot"><a href="#local-6989586621682196589"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196587"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196588"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-660"></span><span>  </span><span id="local-6989586621682196590"><span class="annot"><a href="#local-6989586621682196590"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#introTactic"><span class="hs-identifier hs-type">B.introTactic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196586"><span class="hs-identifier hs-type">pmLambda</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196587"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-661"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-type">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196587"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196590"><span class="hs-identifier hs-type">ss</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-662"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Intro_NotFound"><span class="hs-identifier hs-var">Info_Intro_NotFound</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621682196599"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196599"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce
-&gt; InteractionId -&gt; Range -&gt; String -&gt; GiveRefine -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var">give_gen</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-var">WithoutForce</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196587"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196589"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196599"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Intro"><span class="hs-identifier hs-var">Intro</span></a></span><span>
</span><span id="line-665"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-666"></span><span>      </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
[String]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Intro_ConstructorUnknown"><span class="hs-identifier hs-var">Info_Intro_ConstructorUnknown</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196590"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_refine_or_intro"><span class="hs-identifier hs-type">Cmd_refine_or_intro</span></a></span><span> </span><span id="local-6989586621682196602"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196602"><span class="hs-identifier hs-var">pmLambda</span></a></span></span><span> </span><span id="local-6989586621682196603"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196603"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196604"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196604"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682196605"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196605"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interaction' Range -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">(Interaction' Range -&gt; CommandM ())
-&gt; Interaction' Range -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196606"><span class="annot"><span class="annottext">s' :: String
</span><a href="#local-6989586621682196606"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Utils.String.html#trim"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196605"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196606"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; InteractionId -&gt; Range -&gt; String -&gt; Interaction' Range
forall range.
Bool -&gt; InteractionId -&gt; range -&gt; String -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_intro"><span class="hs-identifier hs-var">Cmd_intro</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682196602"><span class="hs-identifier hs-var">pmLambda</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; String -&gt; Interaction' Range
forall range.
InteractionId -&gt; range -&gt; String -&gt; Interaction' range
</span><a href="Agda.Interaction.Base.html#Cmd_refine"><span class="hs-identifier hs-var">Cmd_refine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196603"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196604"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196606"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoOne"><span class="hs-identifier hs-type">Cmd_autoOne</span></a></span><span> </span><span id="local-6989586621682196608"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196608"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196609"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196609"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196610"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196610"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196611"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196611"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>  </span><span id="local-6989586621682196612"><span class="annot"><a href="#local-6989586621682196612"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196609"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196610"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-674"></span><span>  </span><span id="local-6989586621682196613"><span class="annot"><a href="#local-6989586621682196613"><span class="hs-identifier hs-var">iscope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionScope"><span class="hs-identifier hs-type">getInteractionScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196609"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682196615"><span class="annot"><a href="#local-6989586621682196615"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196616"><span class="annot"><a href="#local-6989586621682196616"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-type">maybeTimed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Mimer.Mimer.html#mimer"><span class="hs-identifier hs-type">Mimer.mimer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196608"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196609"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196612"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196611"><span class="hs-identifier hs-type">str</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196616"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><span class="annottext">MimerResult
</span><a href="Agda.Mimer.Types.html#MimerNoResult"><span class="hs-identifier hs-var">MimerNoResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Auto"><span class="hs-identifier hs-var">Info_Auto</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No solution found&quot;</span></span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><a href="Agda.Mimer.Types.html#MimerExpr"><span class="hs-identifier hs-type">MimerExpr</span></a></span><span> </span><span id="local-6989586621682196622"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196622"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-679"></span><span>      </span><span id="local-6989586621682196623"><span class="annot"><a href="#local-6989586621682196623"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; Range
-&gt; String
-&gt; (Expr -&gt; CommandM ())
-&gt; CommandM (Either String ())
forall a.
InteractionId
-&gt; Range
-&gt; String
-&gt; (Expr -&gt; CommandM a)
-&gt; CommandM (Either String a)
</span><a href="Agda.Interaction.InteractionTop.html#parseExprFromAuto"><span class="hs-identifier hs-var">parseExprFromAuto</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196609"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196612"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196622"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196625"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196625"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-680"></span><span>        </span><span class="annot"><span class="annottext">InteractionId -&gt; ScopeInfo -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-var">insertOldInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196609"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682196613"><span class="hs-identifier hs-var">iscope</span></a></span><span>
</span><span id="line-681"></span><span>        </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; StateT CommandState TCM Expr
forall b. TCM b -&gt; StateT CommandState TCM b
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; StateT CommandState TCM Expr)
-&gt; TCM Expr -&gt; StateT CommandState TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#give"><span class="hs-identifier hs-var">B.give</span></a></span><span> </span><span class="annot"><span class="annottext">UseForce
</span><a href="Agda.Interaction.Base.html#WithForce"><span class="hs-identifier hs-var">WithForce</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196609"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196625"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_GiveAction"><span class="hs-identifier hs-type">Resp_GiveAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196609"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Give_String"><span class="hs-identifier hs-type">Give_String</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196622"><span class="hs-identifier hs-type">str</span></a></span><span>
</span><span id="line-683"></span><span>        </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-type">modifyTheInteractionPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">List.delete</span></span><span> </span><span class="annot"><a href="#local-6989586621682196609"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>        </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-type">whenJust</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196615"><span class="hs-identifier hs-type">time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_Time"><span class="hs-identifier hs-type">Info_Time</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196623"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682196633"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196633"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Auto"><span class="hs-identifier hs-var">Info_Auto</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196633"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-687"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>    </span><span class="annot"><a href="Agda.Mimer.Types.html#MimerList"><span class="hs-identifier hs-type">MimerList</span></a></span><span> </span><span id="local-6989586621682196635"><span class="annot"><span class="annottext">[(Int, String)]
</span><a href="#local-6989586621682196635"><span class="hs-identifier hs-var">sols</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-689"></span><span>      </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Auto"><span class="hs-identifier hs-var">Info_Auto</span></a></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; String
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Solutions:&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-691"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682196637"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;. &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196638"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682196637"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682196637"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196638"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196638"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Int, String)]
</span><a href="#local-6989586621682196635"><span class="hs-identifier hs-var">sols</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_autoAll"><span class="hs-identifier hs-type">Cmd_autoAll</span></a></span><span> </span><span id="local-6989586621682196639"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196639"><span class="hs-identifier hs-var">norm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>  </span><span id="local-6989586621682196640"><span class="annot"><a href="#local-6989586621682196640"><span class="hs-identifier hs-var">iis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT CommandState TCM [InteractionId]
forall (m :: * -&gt; *). ReadTCState m =&gt; m [InteractionId]
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-var">getInteractionPoints</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span id="local-6989586621682196642"><span class="annot"><a href="#local-6989586621682196642"><span class="hs-identifier hs-var">getOldScope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>    </span><span id="local-6989586621682196643"><span class="annot"><a href="#local-6989586621682196643"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-type">getTC</span></a></span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196644"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196644"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ScopeInfo -&gt; CommandM ScopeInfo
forall b. TCM b -&gt; StateT CommandState TCM b
</span><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ScopeInfo -&gt; CommandM ScopeInfo)
-&gt; TCM ScopeInfo -&gt; CommandM ScopeInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682196643"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ScopeInfo -&gt; TCM ScopeInfo
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCM ScopeInfo
forall (m :: * -&gt; *).
(MonadDebug m, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
InteractionId -&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionScope"><span class="hs-identifier hs-var">getInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196644"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196640"><span class="hs-identifier hs-type">iis</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-699"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196645"><span class="annot"><a href="#local-6989586621682196645"><span class="hs-identifier hs-var hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621682196640"><span class="hs-identifier hs-var">iis</span></a></span><span>
</span><span id="line-700"></span><span>    </span><span id="local-6989586621682196648"><span class="annot"><a href="#local-6989586621682196648"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-type">getTC</span></a></span><span>
</span><span id="line-701"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682196649"><span class="annot"><a href="#local-6989586621682196649"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196650"><span class="annot"><a href="#local-6989586621682196650"><span class="hs-identifier hs-var">solveds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">partitionEithers</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682196640"><span class="hs-identifier hs-type">iis</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196652"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196652"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-702"></span><span>      </span><span id="local-6989586621682196653"><span class="annot"><a href="#local-6989586621682196653"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; m Range
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionRange"><span class="hs-identifier hs-var">getInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196652"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-703"></span><span>      </span><span id="local-6989586621682196655"><span class="annot"><a href="#local-6989586621682196655"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Mimer.Mimer.html#mimer"><span class="hs-identifier hs-type">Mimer.mimer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196639"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196652"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196653"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;-t &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682196645"><span class="hs-identifier hs-type">time</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ms&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196655"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-705"></span><span>        </span><span class="annot"><span class="annottext">MimerResult
</span><a href="Agda.Mimer.Types.html#MimerNoResult"><span class="hs-identifier hs-var">MimerNoResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either String [InteractionId]
-&gt; StateT CommandState TCM (Either String [InteractionId])
forall a. a -&gt; StateT CommandState TCM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either String [InteractionId]
 -&gt; StateT CommandState TCM (Either String [InteractionId]))
-&gt; Either String [InteractionId]
-&gt; StateT CommandState TCM (Either String [InteractionId])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; Either String [InteractionId]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><a href="Agda.Mimer.Types.html#MimerExpr"><span class="hs-identifier hs-type">MimerExpr</span></a></span><span> </span><span id="local-6989586621682196656"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196656"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; Range
-&gt; String
-&gt; (Expr -&gt; StateT CommandState TCM [InteractionId])
-&gt; StateT CommandState TCM (Either String [InteractionId])
forall a.
InteractionId
-&gt; Range
-&gt; String
-&gt; (Expr -&gt; CommandM a)
-&gt; CommandM (Either String a)
</span><a href="Agda.Interaction.InteractionTop.html#parseExprFromAuto"><span class="hs-identifier hs-var">parseExprFromAuto</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196652"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196653"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196656"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196657"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196657"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-707"></span><span>          </span><span id="local-6989586621682196658"><span class="annot"><a href="#local-6989586621682196658"><span class="hs-identifier hs-var">iscope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
</span><a href="#local-6989586621682196642"><span class="hs-identifier hs-var">getOldScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196652"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-708"></span><span>          </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-type">insertOldInteractionScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196652"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196658"><span class="hs-identifier hs-type">iscope</span></a></span><span>
</span><span id="line-709"></span><span>          </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#give"><span class="hs-identifier hs-type">B.give</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-type">WithoutForce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196652"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196657"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-710"></span><span>          </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_GiveAction"><span class="hs-identifier hs-type">Resp_GiveAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196652"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Give_String"><span class="hs-identifier hs-type">Give_String</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196656"><span class="hs-identifier hs-type">str</span></a></span><span>
</span><span id="line-711"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682196652"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-712"></span><span>        </span><span class="annot"><a href="Agda.Mimer.Types.html#MimerList"><span class="hs-identifier hs-type">MimerList</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either String [InteractionId]
-&gt; StateT CommandState TCM (Either String [InteractionId])
forall a. a -&gt; StateT CommandState TCM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either String [InteractionId]
 -&gt; StateT CommandState TCM (Either String [InteractionId]))
-&gt; Either String [InteractionId]
-&gt; StateT CommandState TCM (Either String [InteractionId])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId] -&gt; Either String [InteractionId]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Don't list solutions in autoAll</span><span>
</span><span id="line-713"></span><span>    </span><span class="annot"><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-type">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621682196650"><span class="hs-identifier hs-type">solveds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196661"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621682196661"><span class="hs-identifier hs-var">solved</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([InteractionId] -&gt; [InteractionId]) -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-var">modifyTheInteractionPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InteractionId] -&gt; [InteractionId] -&gt; [InteractionId]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">List.\\</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621682196661"><span class="hs-identifier hs-var">solved</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-type">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621682196649"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_Auto"><span class="hs-identifier hs-type">Info_Auto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_context"><span class="hs-identifier hs-type">Cmd_context</span></a></span><span> </span><span id="local-6989586621682196663"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196663"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196664"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196664"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; ([ResponseContextEntry]
    -&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors)
-&gt; [ResponseContextEntry]
-&gt; CommandM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; [ResponseContextEntry]
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; [ResponseContextEntry]
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Context"><span class="hs-identifier hs-var">Info_Context</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196664"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">([ResponseContextEntry] -&gt; CommandM ())
-&gt; StateT CommandState TCM [ResponseContextEntry] -&gt; CommandM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM [ResponseContextEntry]
forall b. TCM b -&gt; StateT CommandState TCM b
</span><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-var">liftLocalState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; InteractionId -&gt; TCM [ResponseContextEntry]
</span><a href="Agda.Interaction.BasicOps.html#getResponseContext"><span class="hs-identifier hs-var">B.getResponseContext</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196663"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196664"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_helper_function"><span class="hs-identifier hs-type">Cmd_helper_function</span></a></span><span> </span><span id="local-6989586621682196667"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196667"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196668"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196668"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196669"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196669"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196670"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196670"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621682196671"><span class="annot"><a href="#local-6989586621682196671"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196668"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196669"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-comment">-- Create type of application of new helper function that would solve the goal.</span><span>
</span><span id="line-722"></span><span>  </span><span id="local-6989586621682196672"><span class="annot"><a href="#local-6989586621682196672"><span class="hs-identifier hs-var">helperType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#metaHelperType"><span class="hs-identifier hs-type">B.metaHelperType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196667"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196668"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196671"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196670"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-723"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-type">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196668"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Goal_HelperFunction"><span class="hs-identifier hs-type">Goal_HelperFunction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196672"><span class="hs-identifier hs-type">helperType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_infer"><span class="hs-identifier hs-type">Cmd_infer</span></a></span><span> </span><span id="local-6989586621682196676"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196676"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196677"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196677"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196678"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196678"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196679"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196679"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>  </span><span id="local-6989586621682196680"><span class="annot"><a href="#local-6989586621682196680"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196677"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196678"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-727"></span><span>  </span><span id="local-6989586621682196681"><span class="annot"><a href="#local-6989586621682196681"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196677"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#typeInMeta"><span class="hs-identifier hs-type">B.typeInMeta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196677"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196676"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-type">B.parseExprIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196677"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196680"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196679"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-type">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196677"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Goal_InferredType"><span class="hs-identifier hs-type">Goal_InferredType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196681"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type"><span class="hs-identifier hs-type">Cmd_goal_type</span></a></span><span> </span><span id="local-6989586621682196685"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196685"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196686"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196686"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
 -&gt; CommandM ())
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; GoalDisplayInfo_boot TCErr
-&gt; DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
InteractionId
-&gt; GoalDisplayInfo_boot tcErr
-&gt; DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-var">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196686"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rewrite -&gt; GoalDisplayInfo_boot TCErr
forall tcErr. Rewrite -&gt; GoalDisplayInfo_boot tcErr
</span><a href="Agda.Interaction.Response.Base.html#Goal_CurrentGoal"><span class="hs-identifier hs-var">Goal_CurrentGoal</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196685"><span class="hs-identifier hs-var">norm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_elaborate_give"><span class="hs-identifier hs-type">Cmd_elaborate_give</span></a></span><span> </span><span id="local-6989586621682196688"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196688"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196689"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196689"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196690"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196690"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196691"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196691"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-734"></span><span>  </span><span id="local-6989586621682196692"><span class="annot"><a href="#local-6989586621682196692"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196689"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196690"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-type">give_gen</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#WithoutForce"><span class="hs-identifier hs-type">WithoutForce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196689"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196692"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196691"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#ElaborateGive"><span class="hs-identifier hs-type">ElaborateGive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196688"><span class="hs-identifier hs-type">norm</span></a></span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context"><span class="hs-identifier hs-type">Cmd_goal_type_context</span></a></span><span> </span><span id="local-6989586621682196694"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196694"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196695"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196695"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196696"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196696"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196697"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196697"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>  </span><span id="local-6989586621682196698"><span class="annot"><a href="#local-6989586621682196698"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196695"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196696"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-739"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-type">cmd_goal_type_context_and</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#GoalOnly"><span class="hs-identifier hs-type">GoalOnly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196694"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196695"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196698"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196697"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_infer"><span class="hs-identifier hs-type">Cmd_goal_type_context_infer</span></a></span><span> </span><span id="local-6989586621682196701"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196701"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196702"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196702"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196703"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196703"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196704"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196704"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-742"></span><span>  </span><span id="local-6989586621682196705"><span class="annot"><a href="#local-6989586621682196705"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196702"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196703"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-comment">-- In case of the empty expression to type, don't fail with</span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-comment">-- a stupid parse error, but just fall back to</span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-comment">-- Cmd_goal_type_context.</span><span>
</span><span id="line-746"></span><span>  </span><span id="local-6989586621682196706"><span class="annot"><a href="#local-6989586621682196706"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">all</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char.isSpace</span></span><span> </span><span class="annot"><a href="#local-6989586621682196704"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-747"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#GoalOnly"><span class="hs-identifier hs-type">GoalOnly</span></a></span><span>
</span><span id="line-748"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>              </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196702"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-750"></span><span>                </span><span id="local-6989586621682196709"><span class="annot"><a href="#local-6989586621682196709"><span class="hs-identifier hs-var">parsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-type">B.parseExprIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196702"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196705"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196704"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-751"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682196710"><span class="annot"><a href="#local-6989586621682196710"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196711"><span class="annot"><a href="#local-6989586621682196711"><span class="hs-identifier hs-var">faces</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#typeAndFacesInMeta"><span class="hs-identifier hs-type">B.typeAndFacesInMeta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196702"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196701"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196709"><span class="hs-identifier hs-type">parsed</span></a></span><span>
</span><span id="line-752"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#GoalAndHave"><span class="hs-identifier hs-type">GoalAndHave</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196710"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196711"><span class="hs-identifier hs-type">faces</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-type">cmd_goal_type_context_and</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196706"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196701"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196702"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196705"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196704"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_goal_type_context_check"><span class="hs-identifier hs-type">Cmd_goal_type_context_check</span></a></span><span> </span><span id="local-6989586621682196714"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196714"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196715"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196715"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196716"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196716"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196717"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196717"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-756"></span><span>  </span><span id="local-6989586621682196718"><span class="annot"><a href="#local-6989586621682196718"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196715"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196716"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-757"></span><span>  </span><span id="local-6989586621682196719"><span class="annot"><a href="#local-6989586621682196719"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196715"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-758"></span><span>    </span><span id="local-6989586621682196720"><span class="annot"><a href="#local-6989586621682196720"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-type">B.parseExprIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196715"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196718"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196717"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-759"></span><span>    </span><span id="local-6989586621682196721"><span class="annot"><a href="#local-6989586621682196721"><span class="hs-identifier hs-var">goal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#typeOfMeta"><span class="hs-identifier hs-type">B.typeOfMeta</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-type">AsIs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196715"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-760"></span><span>    </span><span id="local-6989586621682196723"><span class="annot"><a href="#local-6989586621682196723"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682196721"><span class="hs-identifier hs-type">goal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-761"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Base.html#OfType"><span class="hs-identifier hs-type">OfType</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682196725"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196725"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCMT IO Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196720"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO Term) -&gt; TCMT IO Type -&gt; TCMT IO Term
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196725"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-762"></span><span>      </span><span class="annot"><span class="annottext">OutputConstraint Expr InteractionId
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-763"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Translation.InternalToAbstract.html#reify"><span class="hs-identifier hs-type">reify</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#normalForm"><span class="hs-identifier hs-type">B.normalForm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196714"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196723"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-764"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-type">cmd_goal_type_context_and</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#GoalAndElaboration"><span class="hs-identifier hs-type">GoalAndElaboration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196719"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196714"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196715"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196718"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196717"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_show_module_contents"><span class="hs-identifier hs-type">Cmd_show_module_contents</span></a></span><span> </span><span id="local-6989586621682196728"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196728"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196729"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196729"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196730"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196730"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196731"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196731"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-767"></span><span>  </span><span id="local-6989586621682196732"><span class="annot"><a href="#local-6989586621682196732"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196729"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196730"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-type">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196729"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-type">showModuleContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196728"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196732"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196731"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope_toplevel"><span class="hs-identifier hs-type">Cmd_why_in_scope_toplevel</span></a></span><span> </span><span id="local-6989586621682196738"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196738"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-771"></span><span>  </span><span class="annot"><span class="annottext">CommandM () -&gt; CommandM ()
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-var">whyInScope</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196738"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_why_in_scope"><span class="hs-identifier hs-type">Cmd_why_in_scope</span></a></span><span> </span><span id="local-6989586621682196740"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196740"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196741"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196741"><span class="hs-identifier hs-var">_range</span></a></span></span><span> </span><span id="local-6989586621682196742"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196742"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-774"></span><span>  </span><span class="annot"><span class="annottext">(forall x. TCM x -&gt; TCM x) -&gt; CommandM () -&gt; CommandM ()
forall a. (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO x -&gt; TCMT IO x
forall (m :: * -&gt; *) a.
(MonadDebug m, ReadTCState m, MonadError TCErr m, MonadTCEnv m,
 MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196740"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-var">whyInScope</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196742"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_make_case"><span class="hs-identifier hs-type">Cmd_make_case</span></a></span><span> </span><span id="local-6989586621682196748"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196748"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196749"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196749"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196750"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196750"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-777"></span><span>  </span><span id="local-6989586621682196751"><span class="annot"><a href="#local-6989586621682196751"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196748"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196749"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682196752"><span class="annot"><a href="#local-6989586621682196752"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196753"><span class="annot"><a href="#local-6989586621682196753"><span class="hs-identifier hs-var">casectxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196754"><span class="annot"><a href="#local-6989586621682196754"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html#makeCase"><span class="hs-identifier hs-type">makeCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196748"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196751"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196750"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-type">liftCommandMT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196748"><span class="hs-identifier hs-type">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-780"></span><span>    </span><span id="local-6989586621682196761"><span class="annot"><a href="#local-6989586621682196761"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#lookupSection"><span class="hs-identifier hs-type">lookupSection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier hs-var">qnameModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196752"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- don't shadow the names in this telescope</span><span>
</span><span id="line-781"></span><span>    </span><span id="local-6989586621682196764"><span class="annot"><a href="#local-6989586621682196764"><span class="hs-identifier hs-var">unicode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-type">getsTC</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optUseUnicode"><span class="hs-identifier hs-type">optUseUnicode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#getPragmaOptions"><span class="hs-identifier hs-type">getPragmaOptions</span></a></span><span>
</span><span id="line-782"></span><span>    </span><span id="local-6989586621682196768"><span class="annot"><a href="#local-6989586621682196768"><span class="hs-identifier hs-var">pcs</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier">Doc</span></span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196761"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Pretty.html#prettyAUnqualify"><span class="hs-identifier hs-type">prettyAUnqualify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196754"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196773"><span class="annot"><a href="#local-6989586621682196773"><span class="hs-identifier hs-var">pcs'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier">String</span></span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-type">extlam_dropName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196764"><span class="hs-identifier hs-type">unicode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196753"><span class="hs-identifier hs-type">casectxt</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#decorate"><span class="hs-identifier hs-type">decorate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196768"><span class="hs-identifier hs-type">pcs</span></a></span><span>
</span><span id="line-784"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.case&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span>
</span><span id="line-785"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;InteractionTop.Cmd_make_case&quot;</span></span><span>
</span><span id="line-786"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">TCP.nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;cs   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196754"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;pcs  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682196768"><span class="hs-identifier hs-type">pcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;pcs' = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">TCP.text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196773"><span class="hs-identifier hs-type">pcs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-791"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-792"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.case&quot;</span></span><span> </span><span class="annot"><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span>
</span><span id="line-793"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;InteractionTop.Cmd_make_case&quot;</span></span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">TCP.nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">TCP.vcat</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;cs   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">TCP.text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682196754"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-797"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-798"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_MakeCase"><span class="hs-identifier hs-type">Resp_MakeCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196748"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-type">makeCaseVariant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196753"><span class="hs-identifier hs-type">casectxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682196773"><span class="hs-identifier hs-type">pcs'</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute_toplevel"><span class="hs-identifier hs-type">Cmd_compute_toplevel</span></a></span><span> </span><span id="local-6989586621682196784"><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621682196784"><span class="hs-identifier hs-var">cmode</span></a></span></span><span> </span><span id="local-6989586621682196785"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196785"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682196786"><span class="annot"><a href="#local-6989586621682196786"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196787"><span class="annot"><a href="#local-6989586621682196787"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM Expr) -&gt; String -&gt; CommandM (Maybe CPUTime, Expr)
forall a. (Expr -&gt; TCM a) -&gt; String -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-var">parseAndDoAtToplevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeMode -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#computeInCurrent"><span class="hs-identifier hs-var">B.computeInCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621682196784"><span class="hs-identifier hs-var">cmode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputeMode -&gt; String -&gt; String
</span><a href="Agda.Interaction.BasicOps.html#computeWrapInput"><span class="hs-identifier hs-var">B.computeWrapInput</span></a></span><span> </span><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621682196784"><span class="hs-identifier hs-var">cmode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196785"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>  </span><span id="local-6989586621682196790"><span class="annot"><a href="#local-6989586621682196790"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">get</span></span><span>
</span><span id="line-803"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_NormalForm"><span class="hs-identifier hs-type">Info_NormalForm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196790"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196784"><span class="hs-identifier hs-type">cmode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196786"><span class="hs-identifier hs-type">time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196787"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_compute"><span class="hs-identifier hs-type">Cmd_compute</span></a></span><span> </span><span id="local-6989586621682196792"><span class="annot"><span class="annottext">ComputeMode
</span><a href="#local-6989586621682196792"><span class="hs-identifier hs-var">cmode</span></a></span></span><span> </span><span id="local-6989586621682196793"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196793"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196794"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196794"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196795"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196795"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-806"></span><span>  </span><span id="local-6989586621682196796"><span class="annot"><a href="#local-6989586621682196796"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; Range -&gt; StateT CommandState TCM Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var">syncInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196793"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196794"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span id="local-6989586621682196797"><span class="annot"><a href="#local-6989586621682196797"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>    </span><span id="local-6989586621682196798"><span class="annot"><a href="#local-6989586621682196798"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-type">B.parseExprIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196793"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196796"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#computeWrapInput"><span class="hs-identifier hs-type">B.computeWrapInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196792"><span class="hs-identifier hs-type">cmode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196795"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-809"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-type">withInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196793"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#computeInCurrent"><span class="hs-identifier hs-type">B.computeInCurrent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196792"><span class="hs-identifier hs-type">cmode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196798"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-810"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-type">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196793"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Goal_NormalForm"><span class="hs-identifier hs-type">Goal_NormalForm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196792"><span class="hs-identifier hs-type">cmode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196797"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_show_version"><span class="hs-identifier hs-var">Cmd_show_version</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var">display_info</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Info_Version"><span class="hs-identifier hs-var">Info_Version</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_abort"><span class="hs-identifier hs-var">Cmd_abort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Interaction' Range
</span><a href="Agda.Interaction.Base.html#Cmd_exit"><span class="hs-identifier hs-var">Cmd_exit</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CommandM ()
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="hs-comment">-- | Try to parse an expression generated by Auto and feed it to the continuation if successful.</span><span>
</span><span id="line-818"></span><span class="hs-comment">--   If unsuccessful, just report the solution via 'Info_Auto'.</span><span>
</span><span id="line-819"></span><span id="local-6989586621682194939"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#parseExprFromAuto"><span class="hs-identifier hs-type">parseExprFromAuto</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194939"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621682194939"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-820"></span><span id="parseExprFromAuto"><span class="annot"><span class="annottext">parseExprFromAuto :: forall a.
InteractionId
-&gt; Range
-&gt; String
-&gt; (Expr -&gt; CommandM a)
-&gt; CommandM (Either String a)
</span><a href="Agda.Interaction.InteractionTop.html#parseExprFromAuto"><span class="hs-identifier hs-var hs-var">parseExprFromAuto</span></a></span></span><span> </span><span id="local-6989586621682196820"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196820"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196821"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196821"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682196822"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196822"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621682196823"><span class="annot"><span class="annottext">Expr -&gt; CommandM a
</span><a href="#local-6989586621682196823"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-821"></span><span>  </span><span class="annot"><span class="annottext">TCM (Either ParseError (ExprWhere, Attributes), [ParseWarning])
-&gt; StateT
     CommandState
     TCM
     (Either ParseError (ExprWhere, Attributes), [ParseWarning])
forall b. TCM b -&gt; StateT CommandState TCM b
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PM (ExprWhere, Attributes)
-&gt; TCM (Either ParseError (ExprWhere, Attributes), [ParseWarning])
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
PM a -&gt; m (Either ParseError a, [ParseWarning])
</span><a href="Agda.Syntax.Parser.html#runPMIO"><span class="hs-identifier hs-var">runPMIO</span></a></span><span> </span><span class="annot"><span class="annottext">(PM (ExprWhere, Attributes)
 -&gt; TCM (Either ParseError (ExprWhere, Attributes), [ParseWarning]))
-&gt; PM (ExprWhere, Attributes)
-&gt; TCM (Either ParseError (ExprWhere, Attributes), [ParseWarning])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser ExprWhere -&gt; Range -&gt; String -&gt; PM (ExprWhere, Attributes)
forall a. Parser a -&gt; Range -&gt; String -&gt; PM (a, Attributes)
</span><a href="Agda.Syntax.Parser.html#parseRangeString"><span class="hs-identifier hs-var">parseRangeString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ExprWhere
</span><a href="Agda.Syntax.Parser.html#exprWhereParser"><span class="hs-identifier hs-var">exprWhereParser</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196821"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196822"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateT
  CommandState
  TCM
  (Either ParseError (ExprWhere, Attributes), [ParseWarning])
-&gt; ((Either ParseError (ExprWhere, Attributes), [ParseWarning])
    -&gt; StateT CommandState TCM (Either String a))
-&gt; StateT CommandState TCM (Either String a)
forall a b.
StateT CommandState TCM a
-&gt; (a -&gt; StateT CommandState TCM b) -&gt; StateT CommandState TCM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-822"></span><span>    </span><span class="hs-comment">-- Since the String comes from the Agda printer, we can ignore parse warnings.</span><span>
</span><span id="line-823"></span><span>    </span><span class="hs-comment">-- Also, no @where@ clause will be attached to the expression.</span><span>
</span><span id="line-824"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#ExprWhere"><span class="hs-identifier hs-type">C.ExprWhere</span></a></span><span> </span><span id="local-6989586621682196828"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196828"><span class="hs-identifier hs-var">ce</span></a></span></span><span> </span><span id="local-6989586621682196829"><span class="annot"><span class="annottext">WhereClause
</span><a href="#local-6989586621682196829"><span class="hs-identifier hs-var">_wh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196830"><span class="annot"><span class="annottext">Attributes
</span><a href="#local-6989586621682196830"><span class="hs-identifier hs-var">_attrs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196831"><span class="annot"><span class="annottext">[ParseWarning]
</span><a href="#local-6989586621682196831"><span class="hs-identifier hs-var">_warns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-825"></span><span>      </span><span id="local-6989586621682196832"><span class="annot"><a href="#local-6989586621682196832"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId
-&gt; StateT CommandState TCM Expr -&gt; StateT CommandState TCM Expr
forall (m :: * -&gt; *) a.
(MonadDebug m, ReadTCState m, MonadError TCErr m, MonadTCEnv m,
 MonadTrace m) =&gt;
InteractionId -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withInteractionId"><span class="hs-identifier hs-var">withInteractionId</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196820"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT CommandState TCM Expr -&gt; StateT CommandState TCM Expr)
-&gt; StateT CommandState TCM Expr -&gt; StateT CommandState TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; StateT CommandState TCM Expr
forall b. TCM b -&gt; StateT CommandState TCM b
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Expr -&gt; StateT CommandState TCM Expr)
-&gt; TCM Expr -&gt; StateT CommandState TCM Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ScopeM (AbsOfCon Expr)
forall c. ToAbstract c =&gt; c -&gt; ScopeM (AbsOfCon c)
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract_"><span class="hs-identifier hs-var">concreteToAbstract_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682196828"><span class="hs-identifier hs-var">ce</span></a></span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682196823"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196832"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682196834"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621682196834"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682196835"><span class="annot"><span class="annottext">[ParseWarning]
</span><a href="#local-6989586621682196835"><span class="hs-identifier hs-var">_warns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either String a -&gt; StateT CommandState TCM (Either String a)
forall a. a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either String a -&gt; StateT CommandState TCM (Either String a))
-&gt; Either String a -&gt; StateT CommandState TCM (Either String a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String a) -&gt; String -&gt; Either String a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-828"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196820"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196822"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; (fails to parse)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-829"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ParseError -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(ParseError -&gt; String) -&gt; ParseError -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KillRangeT ParseError
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621682196834"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-830"></span><span>            </span><span class="hs-comment">-- The range makes no sense since the string came from within Agda.</span><span>
</span><span id="line-831"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="hs-comment">-- | If given range is empty, get the range of the interaction point.</span><span>
</span><span id="line-834"></span><span class="hs-comment">--   Otherwise, set the range of the interaction point to the given range.</span><span>
</span><span id="line-835"></span><span class="hs-comment">--</span><span>
</span><span id="line-836"></span><span class="hs-comment">--   The idea is that the interaction frontend may have a more recent range for an interaction point</span><span>
</span><span id="line-837"></span><span class="hs-comment">--   (for example, if the user has edited the file since the last command was sent).</span><span>
</span><span id="line-838"></span><span class="hs-comment">--</span><span>
</span><span id="line-839"></span><span class="hs-comment">--   There may be frontends that do not send ranges (like the interaction test suite),</span><span>
</span><span id="line-840"></span><span class="hs-comment">--   so in that case get the range from the interaction point.</span><span>
</span><span id="line-841"></span><span id="local-6989586621682194871"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-type">syncInteractionRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadInteractionPoints"><span class="hs-identifier hs-type">MonadInteractionPoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194871"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194871"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194871"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682194871"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span></span><span>
</span><span id="line-843"></span><span id="syncInteractionRange"><span class="annot"><span class="annottext">syncInteractionRange :: forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; Range -&gt; m Range
</span><a href="Agda.Interaction.InteractionTop.html#syncInteractionRange"><span class="hs-identifier hs-var hs-var">syncInteractionRange</span></a></span></span><span> </span><span id="local-6989586621682196853"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196853"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682196854"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196854"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196854"><span class="hs-identifier hs-var">r</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; m Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; m Range
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionRange"><span class="hs-identifier hs-var">getInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196853"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196854"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Range -&gt; m () -&gt; m Range
forall a b. a -&gt; m b -&gt; m a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; InteractionId -&gt; m ()
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
Range -&gt; InteractionId -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#setInteractionRange"><span class="hs-identifier hs-var">setInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682196854"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196853"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#decorate"><span class="hs-identifier hs-type">decorate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-849"></span><span id="decorate"><span class="annot"><span class="annottext">decorate :: Doc -&gt; String
</span><a href="Agda.Interaction.InteractionTop.html#decorate"><span class="hs-identifier hs-var hs-var">decorate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Style -&gt; Doc -&gt; String
forall a. Style -&gt; Doc a -&gt; String
</span><span class="hs-identifier hs-var">renderStyle</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Style
</span><span class="hs-identifier hs-var">style</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">mode</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OneLineMode</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-type">makeCaseVariant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html#CaseContext"><span class="hs-identifier hs-type">CaseContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#MakeCaseVariant"><span class="hs-identifier hs-type">MakeCaseVariant</span></a></span><span>
</span><span id="line-852"></span><span id="makeCaseVariant"><span class="annot"><span class="annottext">makeCaseVariant :: CaseContext -&gt; MakeCaseVariant
</span><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-var hs-var">makeCaseVariant</span></a></span></span><span> </span><span class="annot"><span class="annottext">CaseContext
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MakeCaseVariant
</span><a href="Agda.Interaction.Response.Base.html#Function"><span class="hs-identifier hs-var">R.Function</span></a></span><span>
</span><span id="line-853"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#makeCaseVariant"><span class="hs-identifier hs-var">makeCaseVariant</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MakeCaseVariant
</span><a href="Agda.Interaction.Response.Base.html#ExtendedLambda"><span class="hs-identifier hs-var">R.ExtendedLambda</span></a></span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span class="hs-comment">-- very dirty hack, string manipulation by dropping the function name</span><span>
</span><span id="line-856"></span><span class="hs-comment">-- and replacing the last &quot; = &quot; with &quot; -&gt; &quot;. It's important not to replace</span><span>
</span><span id="line-857"></span><span class="hs-comment">-- the equal sign in named implicit with an arrow!</span><span>
</span><span id="line-858"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-type">extlam_dropName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Glyph.html#UnicodeOrAscii"><span class="hs-identifier hs-type">UnicodeOrAscii</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.MakeCase.html#CaseContext"><span class="hs-identifier hs-type">CaseContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-859"></span><span id="extlam_dropName"><span class="annot"><span class="annottext">extlam_dropName :: UnicodeOrAscii -&gt; CaseContext -&gt; String -&gt; String
</span><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-var hs-var">extlam_dropName</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CaseContext
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621682196861"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196861"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196861"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-860"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#extlam_dropName"><span class="hs-identifier hs-var">extlam_dropName</span></a></span><span> </span><span id="local-6989586621682196862"><span class="annot"><span class="annottext">UnicodeOrAscii
</span><a href="#local-6989586621682196862"><span class="hs-identifier hs-var">glyphMode</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span id="local-6989586621682196863"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196863"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="#local-6989586621682196865"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [String] -&gt; [String]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196863"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-863"></span><span>    </span><span id="local-6989586621682196868"><span class="annot"><span class="annottext">arrow :: String
</span><a href="#local-6989586621682196868"><span class="hs-identifier hs-var hs-var">arrow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
forall a. Doc a -&gt; String
</span><span class="hs-identifier hs-var">render</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; String) -&gt; Doc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SpecialCharacters -&gt; Doc
</span><a href="Agda.Syntax.Concrete.Glyph.html#_arrow"><span class="hs-identifier hs-var">_arrow</span></a></span><span> </span><span class="annot"><span class="annottext">(SpecialCharacters -&gt; Doc) -&gt; SpecialCharacters -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii -&gt; SpecialCharacters
</span><a href="Agda.Syntax.Concrete.Glyph.html#specialCharactersForGlyphs"><span class="hs-identifier hs-var">specialCharactersForGlyphs</span></a></span><span> </span><span class="annot"><span class="annottext">UnicodeOrAscii
</span><a href="#local-6989586621682196862"><span class="hs-identifier hs-var">glyphMode</span></a></span><span>
</span><span id="line-864"></span><span>    </span><span id="local-6989586621682196865"><span class="annot"><span class="annottext">replEquals :: [String] -&gt; [String]
</span><a href="#local-6989586621682196865"><span class="hs-identifier hs-var hs-var">replEquals</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682196872"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196872"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196868"><span class="hs-identifier hs-var">arrow</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196872"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-865"></span><span>    </span><span class="annot"><a href="#local-6989586621682196865"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682196873"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196873"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682196874"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196874"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682196873"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="#local-6989586621682196865"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682196874"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-866"></span><span>    </span><span class="annot"><a href="#local-6989586621682196865"><span class="hs-identifier hs-var">replEquals</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span class="hs-comment">-- | Solved goals already instantiated internally</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- The second argument potentially limits it to one specific goal.</span><span>
</span><span id="line-870"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-type">solveInstantiatedGoals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span id="solveInstantiatedGoals"><span class="annot"><span class="annottext">solveInstantiatedGoals :: Rewrite -&gt; Maybe InteractionId -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#solveInstantiatedGoals"><span class="hs-identifier hs-var hs-var">solveInstantiatedGoals</span></a></span></span><span> </span><span id="local-6989586621682196875"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196875"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682196876"><span class="annot"><span class="annottext">Maybe InteractionId
</span><a href="#local-6989586621682196876"><span class="hs-identifier hs-var">mii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-comment">-- Andreas, 2016-10-23 issue #2280: throw away meta elims.</span><span>
</span><span id="line-873"></span><span>  </span><span id="local-6989586621682196877"><span class="annot"><a href="#local-6989586621682196877"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [(InteractionId, Expr)]
-&gt; StateT CommandState TCM [(InteractionId, Expr)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [(InteractionId, Expr)]
 -&gt; StateT CommandState TCM [(InteractionId, Expr)])
-&gt; TCM [(InteractionId, Expr)]
-&gt; StateT CommandState TCM [(InteractionId, Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv)
-&gt; TCM [(InteractionId, Expr)] -&gt; TCM [(InteractionId, Expr)]
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196879"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682196879"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682196879"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envPrintMetasBare"><span class="hs-identifier hs-var">envPrintMetasBare</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM [(InteractionId, Expr)] -&gt; TCM [(InteractionId, Expr)])
-&gt; TCM [(InteractionId, Expr)] -&gt; TCM [(InteractionId, Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-874"></span><span>    </span><span id="local-6989586621682196881"><span class="annot"><a href="#local-6989586621682196881"><span class="hs-identifier hs-var">sip</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Rewrite -&gt; TCM [(InteractionId, MetaId, Expr)]
</span><a href="Agda.Interaction.BasicOps.html#getSolvedInteractionPoints"><span class="hs-identifier hs-var">B.getSolvedInteractionPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682196875"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-875"></span><span>           </span><span class="hs-comment">-- only solve metas which have a proper instantiation, i.e., not another meta</span><span>
</span><span id="line-876"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682196883"><span class="annot"><a href="#local-6989586621682196883"><span class="hs-identifier hs-var hs-var">sip'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(InteractionId, MetaId, Expr)]
 -&gt; [(InteractionId, MetaId, Expr)])
-&gt; (InteractionId
    -&gt; [(InteractionId, MetaId, Expr)]
    -&gt; [(InteractionId, MetaId, Expr)])
-&gt; Maybe InteractionId
-&gt; [(InteractionId, MetaId, Expr)]
-&gt; [(InteractionId, MetaId, Expr)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, MetaId, Expr)] -&gt; [(InteractionId, MetaId, Expr)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682196885"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196885"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((InteractionId, MetaId, Expr) -&gt; Bool)
-&gt; [(InteractionId, MetaId, Expr)]
-&gt; [(InteractionId, MetaId, Expr)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682196885"><span class="hs-identifier hs-var">ii</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; InteractionId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InteractionId -&gt; Bool)
-&gt; ((InteractionId, MetaId, Expr) -&gt; InteractionId)
-&gt; (InteractionId, MetaId, Expr)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, MetaId, Expr) -&gt; InteractionId
forall a b c. (a, b, c) -&gt; a
</span><a href="Agda.Utils.Tuple.html#fst3"><span class="hs-identifier hs-var">fst3</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe InteractionId
</span><a href="#local-6989586621682196876"><span class="hs-identifier hs-var">mii</span></a></span><span> </span><span class="annot"><span class="annottext">[(InteractionId, MetaId, Expr)]
</span><a href="#local-6989586621682196881"><span class="hs-identifier hs-var">sip</span></a></span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621682196887"><span class="hs-identifier hs-type">prt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196883"><span class="hs-identifier hs-type">sip'</span></a></span><span>
</span><span id="line-878"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_SolveAll"><span class="hs-identifier hs-type">Resp_SolveAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682196877"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-880"></span><span>      </span><span id="local-6989586621682196887"><span class="annot"><span class="annottext">prt :: (a, MetaId, a) -&gt; m (a, ConOfAbs a)
</span><a href="#local-6989586621682196887"><span class="hs-identifier hs-var hs-var">prt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682197059"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682197059"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197060"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682197060"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197061"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682197061"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-881"></span><span>        </span><span id="local-6989586621682197062"><span class="annot"><a href="#local-6989586621682197062"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Closure Range
</span><a href="Agda.TypeChecking.Monad.Base.html#getMetaInfo"><span class="hs-identifier hs-var">getMetaInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; Closure Range)
-&gt; m MetaVariable -&gt; m (Closure Range)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; m MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682197060"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-882"></span><span>        </span><span id="local-6989586621682197065"><span class="annot"><a href="#local-6989586621682197065"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#withMetaInfo"><span class="hs-identifier hs-type">withMetaInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197062"><span class="hs-identifier hs-type">mi</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.AbstractToConcrete.html#abstractToConcreteCtx"><span class="hs-identifier hs-type">abstractToConcreteCtx</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Fixity.html#TopCtx"><span class="hs-identifier hs-type">TopCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197061"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-883"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682197059"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682197065"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span class="hs-comment">-- | @cmd_load' file argv unsolvedOk cmd@</span><span>
</span><span id="line-886"></span><span class="hs-comment">--   loads the module in file @file@,</span><span>
</span><span id="line-887"></span><span class="hs-comment">--   using @argv@ as the command-line options.</span><span>
</span><span id="line-888"></span><span class="hs-comment">--</span><span>
</span><span id="line-889"></span><span class="hs-comment">-- If type checking completes without any exceptions having been</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- encountered then the command @cmd r@ is executed, where @r@ is the</span><span>
</span><span id="line-891"></span><span class="hs-comment">-- result of 'Imp.typeCheckMain'.</span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span id="local-6989586621682194816"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-type">cmd_load'</span></a></span><span>
</span><span id="line-894"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ File to load into interaction.</span></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Arguments to Agda for loading this file</span></span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Allow unsolved meta-variables?</span></span><span>
</span><span id="line-897"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Full type-checking, or only scope-checking?</span></span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194816"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-899"></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Continuation after successful loading.</span></span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194816"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-901"></span><span id="cmd_load%27"><span class="annot"><span class="annottext">cmd_load' :: forall a.
String
-&gt; [String]
-&gt; Bool
-&gt; Mode
-&gt; (CheckResult -&gt; CommandM a)
-&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#cmd_load%27"><span class="hs-identifier hs-var hs-var">cmd_load'</span></a></span></span><span> </span><span id="local-6989586621682197137"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197137"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621682197138"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682197138"><span class="hs-identifier hs-var">argv</span></a></span></span><span> </span><span id="local-6989586621682197139"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682197139"><span class="hs-identifier hs-var">unsolvedOK</span></a></span></span><span> </span><span id="local-6989586621682197140"><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621682197140"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621682197141"><span class="annot"><span class="annottext">CheckResult -&gt; CommandM a
</span><a href="#local-6989586621682197141"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>    </span><span class="hs-comment">-- Forget the previous &quot;current file&quot; and interaction points.</span><span>
</span><span id="line-904"></span><span>    </span><span class="annot"><span class="annottext">(CommandState -&gt; CommandState) -&gt; CommandM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; CommandState) -&gt; CommandM ())
-&gt; (CommandState -&gt; CommandState) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682197142"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682197142"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682197142"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-905"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-906"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-comment">-- Update the status. Because the &quot;current file&quot; is not set the</span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-comment">-- status is not &quot;Checked&quot;.</span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>    </span><span class="hs-comment">-- Reset the state, preserving options and decoded modules. Note</span><span>
</span><span id="line-913"></span><span>    </span><span class="hs-comment">-- that if the include directories have changed, then the decoded</span><span>
</span><span id="line-914"></span><span>    </span><span class="hs-comment">-- modules are reset by TCM.setCommandLineOptions' below.</span><span>
</span><span id="line-915"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#resetState"><span class="hs-identifier hs-var">resetState</span></a></span><span>
</span><span id="line-916"></span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-comment">-- Clear the info buffer to make room for information about which</span><span>
</span><span id="line-918"></span><span>    </span><span class="hs-comment">-- module is currently being type-checked.</span><span>
</span><span id="line-919"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_ClearRunningInfo"><span class="hs-identifier hs-var">Resp_ClearRunningInfo</span></a></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span>    </span><span class="hs-comment">-- Remove any prior syntax highlighting.</span><span>
</span><span id="line-922"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBased -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
TokenBased
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_ClearHighlighting"><span class="hs-identifier hs-var">Resp_ClearHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBased
</span><a href="Agda.Syntax.Common.Aspect.html#NotOnlyTokenBased"><span class="hs-identifier hs-var">NotOnlyTokenBased</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>    </span><span class="hs-comment">-- Parse the file.</span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-926"></span><span>    </span><span class="hs-comment">-- Note that options are set below.</span><span>
</span><span id="line-927"></span><span>    </span><span id="local-6989586621682197147"><span class="annot"><a href="#local-6989586621682197147"><span class="hs-identifier hs-var">fp</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a. IO a -&gt; StateT CommandState TCM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath)
-&gt; IO AbsolutePath -&gt; StateT CommandState TCM AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO AbsolutePath
</span><a href="Agda.Utils.FileName.html#absolute"><span class="hs-identifier hs-var">absolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197137"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-928"></span><span>    </span><span id="local-6989586621682197148"><span class="annot"><a href="#local-6989586621682197148"><span class="hs-identifier hs-var">sf</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#srcFromPath"><span class="hs-identifier hs-type">srcFromPath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197147"><span class="hs-identifier hs-type">fp</span></a></span><span>
</span><span id="line-929"></span><span>    </span><span id="local-6989586621682197149"><span class="annot"><a href="#local-6989586621682197149"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">Imp.parseSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197148"><span class="hs-identifier hs-type">sf</span></a></span><span>
</span><span id="line-930"></span><span>    </span><span class="hs-comment">-- Andreas, 2024-08-03, see test/interaction/FileNotFound:</span><span>
</span><span id="line-931"></span><span>    </span><span class="hs-comment">-- Run 'getModificationTime' after 'parseSource',</span><span>
</span><span id="line-932"></span><span>    </span><span class="hs-comment">-- otherwise the user gets a weird error for non-existing files.</span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-comment">-- (We assume that parsing is fast in comparison to type-checking,</span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-comment">-- so it should not matter much whether we get the time stamp</span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-comment">-- before or after parsing.)</span><span>
</span><span id="line-936"></span><span>    </span><span id="local-6989586621682197150"><span class="annot"><a href="#local-6989586621682197150"><span class="hs-identifier hs-var">t</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">getModificationTime</span></span><span> </span><span class="annot"><a href="#local-6989586621682197137"><span class="hs-identifier hs-type">file</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>    </span><span class="hs-comment">-- Store the warnings.</span><span>
</span><span id="line-939"></span><span>    </span><span id="local-6989586621682197152"><span class="annot"><a href="#local-6989586621682197152"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-type">stTCWarnings</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-comment">-- All options are reset when a file is reloaded, including the</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">-- choice of whether or not to display implicit arguments.</span><span>
</span><span id="line-943"></span><span>    </span><span id="local-6989586621682197156"><span class="annot"><a href="#local-6989586621682197156"><span class="hs-identifier hs-var">opts0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#optionsOnReload"><span class="hs-identifier hs-var">optionsOnReload</span></a></span><span>
</span><span id="line-944"></span><span>    </span><span id="local-6989586621682197157"><span class="annot"><a href="#local-6989586621682197157"><span class="hs-identifier hs-var">backends</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stBackends"><span class="hs-identifier hs-type">stBackends</span></a></span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682197161"><span class="annot"><a href="#local-6989586621682197161"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197162"><span class="annot"><a href="#local-6989586621682197162"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#runOptM"><span class="hs-identifier hs-type">runOptM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.html#parseBackendOptions"><span class="hs-identifier hs-type">parseBackendOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197157"><span class="hs-identifier hs-type">backends</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197138"><span class="hs-identifier hs-type">argv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197156"><span class="hs-identifier hs-type">opts0</span></a></span><span>
</span><span id="line-946"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-type">warning</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OptionWarning"><span class="hs-identifier hs-type">OptionWarning</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682197162"><span class="hs-identifier hs-type">warns</span></a></span><span>
</span><span id="line-947"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682197161"><span class="hs-identifier hs-type">z</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-948"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682197166"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197166"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#OptionError"><span class="hs-identifier hs-var">OptionError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197166"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-949"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Backend]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197169"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621682197169"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-950"></span><span>        </span><span id="local-6989586621682197170"><span class="annot"><a href="#local-6989586621682197170"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM CommandLineOptions
 -&gt; StateT CommandState TCM CommandLineOptions)
-&gt; TCM CommandLineOptions
-&gt; StateT CommandState TCM CommandLineOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM CommandLineOptions
</span><a href="Agda.TypeChecking.Monad.Options.html#addTrustedExecutables"><span class="hs-identifier hs-var">addTrustedExecutables</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621682197169"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-951"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682197172"><span class="annot"><a href="#local-6989586621682197172"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' PragmaOptions Bool -&gt; LensMap PragmaOptions Bool
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
forall (f :: * -&gt; *).
Functor f =&gt;
(WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
</span><a href="Agda.Interaction.Options.Base.html#lensOptAllowUnsolved"><span class="hs-identifier hs-var">lensOptAllowUnsolved</span></a></span><span> </span><span class="annot"><span class="annottext">((WithDefault 'False -&gt; f (WithDefault 'False))
 -&gt; PragmaOptions -&gt; f PragmaOptions)
-&gt; ((Bool -&gt; f Bool)
    -&gt; WithDefault 'False -&gt; f (WithDefault 'False))
-&gt; (Bool -&gt; f Bool)
-&gt; PragmaOptions
-&gt; f PragmaOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; WithDefault 'False -&gt; f (WithDefault 'False)
forall a (b :: Bool).
(Boolean a, Eq a, KnownBool b) =&gt;
Lens' (WithDefault' a b) a
Lens' (WithDefault 'False) Bool
</span><a href="Agda.Utils.WithDefault.html#lensKeepDefault"><span class="hs-identifier hs-var">lensKeepDefault</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682197139"><span class="hs-identifier hs-var">unsolvedOK</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>            </span><span id="local-6989586621682197180"><span class="annot"><a href="#local-6989586621682197180"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; TopLevelModuleName -&gt; AbsolutePath
</span><a href="Agda.Syntax.TopLevelModuleName.html#projectRoot"><span class="hs-identifier hs-var">projectRoot</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682197147"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; AbsolutePath)
-&gt; TopLevelModuleName -&gt; AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">Imp.srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682197149"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-953"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions%27"><span class="hs-identifier hs-type">TCM.setCommandLineOptions'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197180"><span class="hs-identifier hs-type">root</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#mapPragmaOptions"><span class="hs-identifier hs-type">mapPragmaOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197172"><span class="hs-identifier hs-type">update</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197170"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>    </span><span class="hs-comment">-- Restore the warnings that were saved above.</span><span>
</span><span id="line-956"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-identifier hs-type">modifyTCLens</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-type">stTCWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.union</span></span><span> </span><span class="annot"><a href="#local-6989586621682197152"><span class="hs-identifier hs-type">warnings</span></a></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>    </span><span id="local-6989586621682197188"><span class="annot"><a href="#local-6989586621682197188"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier hs-type">Imp.typeCheckMain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197140"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197149"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>    </span><span class="hs-comment">-- The module type checked. If the file was not changed while the</span><span>
</span><span id="line-961"></span><span>    </span><span class="hs-comment">-- type checker was running then the interaction points and the</span><span>
</span><span id="line-962"></span><span>    </span><span class="hs-comment">-- &quot;current file&quot; are stored.</span><span>
</span><span id="line-963"></span><span>    </span><span id="local-6989586621682197189"><span class="annot"><a href="#local-6989586621682197189"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">getModificationTime</span></span><span> </span><span class="annot"><a href="#local-6989586621682197137"><span class="hs-identifier hs-type">file</span></a></span><span>
</span><span id="line-964"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682197150"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682197189"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>      </span><span id="local-6989586621682197190"><span class="annot"><a href="#local-6989586621682197190"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-type">sortInteractionPoints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-type">getInteractionPoints</span></a></span><span>
</span><span id="line-966"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">modify</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682197192"><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682197192"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandState
</span><a href="#local-6989586621682197192"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theInteractionPoints"><span class="hs-identifier hs-var">theInteractionPoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197190"><span class="hs-identifier hs-type">is</span></a></span><span>
</span><span id="line-967"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#CurrentFile"><span class="hs-identifier hs-type">CurrentFile</span></a></span><span>
</span><span id="line-968"></span><span>                             </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197147"><span class="hs-identifier hs-type">fp</span></a></span><span>
</span><span id="line-969"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileModule"><span class="hs-identifier hs-var">currentFileModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">Imp.srcModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197149"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-970"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileArgs"><span class="hs-identifier hs-var">currentFileArgs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197138"><span class="hs-identifier hs-type">argv</span></a></span><span>
</span><span id="line-971"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileStamp"><span class="hs-identifier hs-var">currentFileStamp</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197150"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-972"></span><span>                             </span><span class="hs-special">}</span><span>
</span><span id="line-973"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span>    </span><span class="annot"><a href="#local-6989586621682197141"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197188"><span class="hs-identifier hs-type">ok</span></a></span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="annot"><span class="hs-comment">-- | Set 'envCurrentPath' to 'theCurrentFile', if any.</span></span><span>
</span><span id="line-978"></span><span id="local-6989586621682197197"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#withCurrentFile"><span class="hs-identifier hs-type">withCurrentFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197197"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197197"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-979"></span><span id="withCurrentFile"><span class="annot"><span class="annottext">withCurrentFile :: forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#withCurrentFile"><span class="hs-identifier hs-var hs-var">withCurrentFile</span></a></span></span><span> </span><span id="local-6989586621682197207"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682197207"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-980"></span><span>  </span><span id="local-6989586621682197208"><span class="annot"><a href="#local-6989586621682197208"><span class="hs-identifier hs-var">mfile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe AbsolutePath)
-&gt; StateT CommandState TCM (Maybe AbsolutePath)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((CommandState -&gt; Maybe AbsolutePath)
 -&gt; StateT CommandState TCM (Maybe AbsolutePath))
-&gt; (CommandState -&gt; Maybe AbsolutePath)
-&gt; StateT CommandState TCM (Maybe AbsolutePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CurrentFile -&gt; AbsolutePath)
-&gt; Maybe CurrentFile -&gt; Maybe AbsolutePath
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CurrentFile -&gt; Maybe AbsolutePath)
-&gt; (CommandState -&gt; Maybe CurrentFile)
-&gt; CommandState
-&gt; Maybe AbsolutePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-981"></span><span>  </span><span id="local-6989586621682197209"><span class="annot"><a href="#local-6989586621682197209"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="Agda.Utils.FileId.html#idFromFile"><span class="hs-identifier hs-type">idFromFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197208"><span class="hs-identifier hs-type">mfile</span></a></span><span>
</span><span id="line-982"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-type">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682197212"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682197212"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682197212"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCurrentPath"><span class="hs-identifier hs-var">envCurrentPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197209"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682197207"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span id="local-6989586621682197213"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-type">atTopLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197213"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197213"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-985"></span><span id="atTopLevel"><span class="annot"><span class="annottext">atTopLevel :: forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-var hs-var">atTopLevel</span></a></span></span><span> </span><span id="local-6989586621682197214"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682197214"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
forall a. (forall x. TCM x -&gt; TCM x) -&gt; CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.InteractionTop.html#liftCommandMT"><span class="hs-identifier hs-var">liftCommandMT</span></a></span><span> </span><span class="annot"><span class="annottext">TCM x -&gt; TCM x
forall x. TCM x -&gt; TCM x
</span><a href="Agda.Interaction.BasicOps.html#atTopLevel"><span class="hs-identifier hs-var">B.atTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682197214"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- Giving, refining.</span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="hs-keyword">data</span><span> </span><span id="GiveRefine"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#GiveRefine"><span class="hs-identifier hs-var">GiveRefine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Give"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Refine"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Intro"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#Intro"><span class="hs-identifier hs-var">Intro</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ElaborateGive"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#ElaborateGive"><span class="hs-identifier hs-var">ElaborateGive</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682197217"><span id="local-6989586621682197224"><span class="annot"><span class="annottext">GiveRefine -&gt; GiveRefine -&gt; Bool
(GiveRefine -&gt; GiveRefine -&gt; Bool)
-&gt; (GiveRefine -&gt; GiveRefine -&gt; Bool) -&gt; Eq GiveRefine
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: GiveRefine -&gt; GiveRefine -&gt; Bool
== :: GiveRefine -&gt; GiveRefine -&gt; Bool
$c/= :: GiveRefine -&gt; GiveRefine -&gt; Bool
/= :: GiveRefine -&gt; GiveRefine -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197228"><span id="local-6989586621682197234"><span id="local-6989586621682197238"><span class="annot"><span class="annottext">Int -&gt; GiveRefine -&gt; String -&gt; String
[GiveRefine] -&gt; String -&gt; String
GiveRefine -&gt; String
(Int -&gt; GiveRefine -&gt; String -&gt; String)
-&gt; (GiveRefine -&gt; String)
-&gt; ([GiveRefine] -&gt; String -&gt; String)
-&gt; Show GiveRefine
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; GiveRefine -&gt; String -&gt; String
showsPrec :: Int -&gt; GiveRefine -&gt; String -&gt; String
$cshow :: GiveRefine -&gt; String
show :: GiveRefine -&gt; String
$cshowList :: [GiveRefine] -&gt; String -&gt; String
showList :: [GiveRefine] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span class="hs-comment">-- | A &quot;give&quot;-like action (give, refine, etc).</span><span>
</span><span id="line-994"></span><span class="hs-comment">--</span><span>
</span><span id="line-995"></span><span class="hs-comment">--   @give_gen force ii rng s give_ref mk_newtxt@</span><span>
</span><span id="line-996"></span><span class="hs-comment">--   acts on interaction point @ii@</span><span>
</span><span id="line-997"></span><span class="hs-comment">--   occupying range @rng@,</span><span>
</span><span id="line-998"></span><span class="hs-comment">--   placing the new content given by string @s@,</span><span>
</span><span id="line-999"></span><span class="hs-comment">--   and replacing @ii@ by the newly created interaction points</span><span>
</span><span id="line-1000"></span><span class="hs-comment">--   in the state if safety checks pass (unless @force@ is applied).</span><span>
</span><span id="line-1001"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-type">give_gen</span></a></span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#UseForce"><span class="hs-identifier hs-type">UseForce</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Should safety checks be skipped?</span></span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span>
</span><span id="line-1004"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>
</span><span id="line-1005"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1006"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#GiveRefine"><span class="hs-identifier hs-type">GiveRefine</span></a></span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span id="give_gen"><span class="annot"><span class="annottext">give_gen :: UseForce
-&gt; InteractionId -&gt; Range -&gt; String -&gt; GiveRefine -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#give_gen"><span class="hs-identifier hs-var hs-var">give_gen</span></a></span></span><span> </span><span id="local-6989586621682197242"><span class="annot"><span class="annottext">UseForce
</span><a href="#local-6989586621682197242"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span id="local-6989586621682197243"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197243"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span id="local-6989586621682197244"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197244"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682197245"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197245"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621682197246"><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621682197246"><span class="hs-identifier hs-var">giveRefine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1009"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682197247"><span class="annot"><span class="annottext">s :: String
</span><a href="#local-6989586621682197247"><span class="hs-identifier hs-var hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Utils.String.html#trim"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197245"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-1010"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; CommandM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; CommandM ()) -&gt; TCMT IO Doc -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">TCP.text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;give_gen  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197247"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">TCP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Range -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">TCP.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197244"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-1011"></span><span>  </span><span class="hs-comment">-- Andreas, 2015-02-26 if string is empty do nothing rather</span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-comment">-- than giving a parse error.</span><span>
</span><span id="line-1013"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; CommandM () -&gt; CommandM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197247"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CommandM () -&gt; CommandM ()) -&gt; CommandM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1014"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682197249"><span class="annot"><span class="annottext">give_ref :: UseForce -&gt; InteractionId -&gt; Expr -&gt; TCM Expr
</span><a href="#local-6989586621682197249"><span class="hs-identifier hs-var hs-var hs-var">give_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1015"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621682197246"><span class="hs-identifier hs-var">giveRefine</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1016"></span><span>            </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#give"><span class="hs-identifier hs-var">B.give</span></a></span><span>
</span><span id="line-1017"></span><span>            </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#refine"><span class="hs-identifier hs-var">B.refine</span></a></span><span>
</span><span id="line-1018"></span><span>            </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Intro"><span class="hs-identifier hs-var">Intro</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UseForce -&gt; InteractionId -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#refine"><span class="hs-identifier hs-var">B.refine</span></a></span><span>
</span><span id="line-1019"></span><span>            </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#ElaborateGive"><span class="hs-identifier hs-type">ElaborateGive</span></a></span><span> </span><span id="local-6989586621682197251"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197251"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; UseForce -&gt; InteractionId -&gt; Expr -&gt; TCM Expr
</span><a href="Agda.Interaction.BasicOps.html#elaborate_give"><span class="hs-identifier hs-var">B.elaborate_give</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197251"><span class="hs-identifier hs-var">norm</span></a></span><span>
</span><span id="line-1020"></span><span>    </span><span class="hs-comment">-- save scope of the interaction point (for printing the given expr. later)</span><span>
</span><span id="line-1021"></span><span>    </span><span id="local-6989586621682197253"><span class="annot"><a href="#local-6989586621682197253"><span class="hs-identifier hs-var">scope</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; CommandM ScopeInfo
forall (m :: * -&gt; *).
(MonadDebug m, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
InteractionId -&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionScope"><span class="hs-identifier hs-var">getInteractionScope</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197243"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1022"></span><span>    </span><span class="hs-comment">-- parse string and &quot;give&quot;, obtaining an abstract expression</span><span>
</span><span id="line-1023"></span><span>    </span><span class="hs-comment">-- and newly created interaction points</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682197254"><span class="annot"><a href="#local-6989586621682197254"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682197255"><span class="annot"><a href="#local-6989586621682197255"><span class="hs-identifier hs-var">ae</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197256"><span class="annot"><a href="#local-6989586621682197256"><span class="hs-identifier hs-var">ae0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197257"><span class="annot"><a href="#local-6989586621682197257"><span class="hs-identifier hs-var">iis</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-type">maybeTimed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1025"></span><span>        </span><span class="hs-comment">-- Issue 3000: mark the current hole as solved before giving, to avoid confusing it with potential</span><span>
</span><span id="line-1026"></span><span>        </span><span class="hs-comment">-- new interaction points introduced by the give.</span><span>
</span><span id="line-1027"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#removeInteractionPoint"><span class="hs-identifier hs-type">removeInteractionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197243"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-1028"></span><span>        </span><span id="local-6989586621682197259"><span class="annot"><a href="#local-6989586621682197259"><span class="hs-identifier hs-var">mis</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-type">getInteractionPoints</span></a></span><span>
</span><span id="line-1029"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction points before = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682197259"><span class="hs-identifier hs-type">mis</span></a></span><span>
</span><span id="line-1030"></span><span>        </span><span id="local-6989586621682197260"><span class="annot"><a href="#local-6989586621682197260"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#parseExprIn"><span class="hs-identifier hs-type">B.parseExprIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197243"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197244"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197247"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1031"></span><span>        </span><span id="local-6989586621682197261"><span class="annot"><a href="#local-6989586621682197261"><span class="hs-identifier hs-var">ae</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682197249"><span class="hs-identifier hs-type">give_ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197242"><span class="hs-identifier hs-type">force</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197243"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197260"><span class="hs-identifier hs-type">given</span></a></span><span>
</span><span id="line-1032"></span><span>        </span><span id="local-6989586621682197262"><span class="annot"><a href="#local-6989586621682197262"><span class="hs-identifier hs-var">mis'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionPoints"><span class="hs-identifier hs-type">getInteractionPoints</span></a></span><span>
</span><span id="line-1033"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction points after = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682197262"><span class="hs-identifier hs-type">mis'</span></a></span><span>
</span><span id="line-1034"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682197261"><span class="hs-identifier hs-type">ae</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682197260"><span class="hs-identifier hs-type">given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682197262"><span class="hs-identifier hs-type">mis'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">List.\\</span></span><span> </span><span class="annot"><a href="#local-6989586621682197259"><span class="hs-identifier hs-type">mis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>    </span><span class="hs-comment">-- favonia: backup the old scope for highlighting</span><span>
</span><span id="line-1036"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#insertOldInteractionScope"><span class="hs-identifier hs-type">insertOldInteractionScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197243"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197253"><span class="hs-identifier hs-type">scope</span></a></span><span>
</span><span id="line-1037"></span><span>    </span><span class="hs-comment">-- sort the new interaction points and put them into the state</span><span>
</span><span id="line-1038"></span><span>    </span><span class="hs-comment">-- in replacement of the old interaction point</span><span>
</span><span id="line-1039"></span><span>    </span><span id="local-6989586621682197263"><span class="annot"><a href="#local-6989586621682197263"><span class="hs-identifier hs-var">iis'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-type">sortInteractionPoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197257"><span class="hs-identifier hs-type">iis</span></a></span><span>
</span><span id="line-1040"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#modifyTheInteractionPoints"><span class="hs-identifier hs-type">modifyTheInteractionPoints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682197264"><span class="hs-identifier hs-type">replace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197243"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197263"><span class="hs-identifier hs-type">iis'</span></a></span><span>
</span><span id="line-1041"></span><span>    </span><span class="hs-comment">-- print abstract expr</span><span>
</span><span id="line-1042"></span><span>    </span><span id="local-6989586621682197265"><span class="annot"><a href="#local-6989586621682197265"><span class="hs-identifier hs-var">ce</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.AbstractToConcrete.html#abstractToConcreteScope"><span class="hs-identifier hs-type">abstractToConcreteScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197253"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197255"><span class="hs-identifier hs-type">ae</span></a></span><span>
</span><span id="line-1043"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-type">reportS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span>
</span><span id="line-1044"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;ce = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197265"><span class="hs-identifier hs-type">ce</span></a></span><span>
</span><span id="line-1045"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;scopePrecedence = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682197253"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#scopePrecedence"><span class="hs-identifier hs-type">scopePrecedence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-comment">-- Issue 7218: if the give/refine command creates an extended</span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-comment">-- lambda, it also needs to be added to the relevant unfolding sets.</span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-comment">-- The easiest way to make sure this is consistent is to just re-run</span><span>
</span><span id="line-1051"></span><span>    </span><span class="hs-comment">-- the saturation procedures.</span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Opacity.html#saturateOpaqueBlocks"><span class="hs-identifier hs-type">saturateOpaqueBlocks</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span>    </span><span class="hs-comment">-- if the command was @Give@, use the literal user input;</span><span>
</span><span id="line-1055"></span><span>    </span><span class="hs-comment">-- Andreas, 2014-01-15, see issue 1020:</span><span>
</span><span id="line-1056"></span><span>    </span><span class="hs-comment">-- Refine could solve a goal by introducing the sole constructor</span><span>
</span><span id="line-1057"></span><span>    </span><span class="hs-comment">-- without arguments.  Then there are no interaction metas, but</span><span>
</span><span id="line-1058"></span><span>    </span><span class="hs-comment">-- we still cannot just `give' the user string (which may be empty).</span><span>
</span><span id="line-1059"></span><span>    </span><span class="hs-comment">-- WRONG: also, if no interaction metas were created by @Refine@</span><span>
</span><span id="line-1060"></span><span>    </span><span class="hs-comment">-- WRONG: let literally = (giveRefine == Give || null iis) &amp;&amp; rng /= noRange</span><span>
</span><span id="line-1061"></span><span>    </span><span class="hs-comment">-- Ulf, 2015-03-30, if we're doing intro we can't do literal give since</span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-comment">-- there is nothing in the hole (issue 1892).</span><span>
</span><span id="line-1063"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682197271"><span class="annot"><a href="#local-6989586621682197271"><span class="hs-identifier hs-var hs-var">literally</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621682197246"><span class="hs-identifier hs-var">giveRefine</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine -&gt; GiveRefine -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Give"><span class="hs-identifier hs-var">Give</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="#local-6989586621682197246"><span class="hs-identifier hs-var">giveRefine</span></a></span><span> </span><span class="annot"><span class="annottext">GiveRefine -&gt; GiveRefine -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GiveRefine
</span><a href="Agda.Interaction.InteractionTop.html#Refine"><span class="hs-identifier hs-var">Refine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197255"><span class="hs-identifier hs-var">ae</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197256"><span class="hs-identifier hs-var">ae0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197244"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">Range -&gt; Range -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-comment">-- Ulf, 2014-01-24: This works for give since we're highlighting the string</span><span>
</span><span id="line-1065"></span><span>    </span><span class="hs-comment">-- that's already in the buffer. Doing it before the give action means that</span><span>
</span><span id="line-1066"></span><span>    </span><span class="hs-comment">-- the highlighting is moved together with the text when the hole goes away.</span><span>
</span><span id="line-1067"></span><span>    </span><span class="hs-comment">-- To make it work for refine we'd have to adjust the ranges.</span><span>
</span><span id="line-1068"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197271"><span class="hs-identifier hs-type">literally</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1069"></span><span>      </span><span id="local-6989586621682197273"><span class="annot"><a href="#local-6989586621682197273"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-1070"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682197273"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#None"><span class="hs-identifier hs-type">None</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1071"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-type">printHighlightingInfo</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-type">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span>
</span><span id="line-1072"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfoFromString"><span class="hs-identifier hs-type">generateTokenInfoFromString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197244"><span class="hs-identifier hs-type">rng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197247"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1073"></span><span>        </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-type">highlightExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197255"><span class="hs-identifier hs-type">ae</span></a></span><span>
</span><span id="line-1074"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-type">putResponse</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Resp_GiveAction"><span class="hs-identifier hs-type">Resp_GiveAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197243"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682197274"><span class="hs-identifier hs-type">mkNewTxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197271"><span class="hs-identifier hs-type">literally</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197265"><span class="hs-identifier hs-type">ce</span></a></span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;putResponse GiveAction passed&quot;</span></span><span>
</span><span id="line-1076"></span><span>    </span><span class="hs-comment">-- display new goal set (if not measuring time)</span><span>
</span><span id="line-1077"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#interpret"><span class="hs-identifier hs-type">interpret</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Cmd_metas"><span class="hs-identifier hs-type">Cmd_metas</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#AsIs"><span class="hs-identifier hs-type">AsIs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_Time"><span class="hs-identifier hs-type">Info_Time</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682197254"><span class="hs-identifier hs-type">time</span></a></span><span>
</span><span id="line-1078"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;interaction.give&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;interpret Cmd_metas passed&quot;</span></span><span>
</span><span id="line-1079"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1080"></span><span>    </span><span class="hs-comment">-- Substitutes xs for x in ys.</span><span>
</span><span id="line-1081"></span><span>    </span><span id="local-6989586621682197264"><span class="annot"><span class="annottext">replace :: b -&gt; [b] -&gt; t b -&gt; [b]
</span><a href="#local-6989586621682197264"><span class="hs-identifier hs-var hs-var">replace</span></a></span></span><span> </span><span id="local-6989586621682197279"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682197279"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682197280"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682197280"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682197281"><span class="annot"><span class="annottext">t b
</span><a href="#local-6989586621682197281"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; [b]) -&gt; t b -&gt; [b]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682197283"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682197283"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682197283"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682197279"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682197280"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682197283"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t b
</span><a href="#local-6989586621682197281"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-1082"></span><span>    </span><span class="hs-comment">-- For @Give@ we can replace the ii by the user given input.</span><span>
</span><span id="line-1083"></span><span>    </span><span id="local-6989586621682197274"><span class="annot"><span class="annottext">mkNewTxt :: Bool -&gt; Expr -&gt; GiveResult
</span><a href="#local-6989586621682197274"><span class="hs-identifier hs-var hs-var">mkNewTxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Paren"><span class="hs-identifier hs-type">C.Paren</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_Paren"><span class="hs-identifier hs-var">Give_Paren</span></a></span><span>
</span><span id="line-1084"></span><span>    </span><span class="annot"><a href="#local-6989586621682197274"><span class="hs-identifier hs-var">mkNewTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_NoParen"><span class="hs-identifier hs-var">Give_NoParen</span></a></span><span>
</span><span id="line-1085"></span><span>    </span><span class="hs-comment">-- Otherwise, we replace it by the reified value Agda computed.</span><span>
</span><span id="line-1086"></span><span>    </span><span class="annot"><a href="#local-6989586621682197274"><span class="hs-identifier hs-var">mkNewTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621682197288"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197288"><span class="hs-identifier hs-var">ce</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; GiveResult
</span><a href="Agda.Interaction.Response.Base.html#Give_String"><span class="hs-identifier hs-var">Give_String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; GiveResult) -&gt; String -&gt; GiveResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197288"><span class="hs-identifier hs-var">ce</span></a></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-type">highlightExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span id="highlightExpr"><span class="annot"><span class="annottext">highlightExpr :: Expr -&gt; TCM ()
</span><a href="Agda.Interaction.InteractionTop.html#highlightExpr"><span class="hs-identifier hs-var hs-var">highlightExpr</span></a></span></span><span> </span><span id="local-6989586621682197289"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197289"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1090"></span><span>  </span><span class="annot"><span class="annottext">(TCEnv -&gt; TCEnv) -&gt; TCM () -&gt; TCM ()
forall a. (TCEnv -&gt; TCEnv) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(TCEnv -&gt; TCEnv) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-var">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682197290"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682197290"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682197290"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envImportStack"><span class="hs-identifier hs-var">envImportStack</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1091"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span>
</span><span id="line-1092"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingMethod"><span class="hs-identifier hs-var">envHighlightingMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Direct"><span class="hs-identifier hs-type">Direct</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1093"></span><span>    </span><span class="annot"><span class="annottext">Declaration -&gt; Level -&gt; Bool -&gt; TCM ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateAndPrintSyntaxInfo"><span class="hs-identifier hs-var">generateAndPrintSyntaxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration
</span><a href="#local-6989586621682197294"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="Agda.Interaction.Highlighting.Generate.html#Full"><span class="hs-identifier hs-var">Full</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1094"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1095"></span><span>    </span><span id="local-6989586621682197300"><span class="annot"><span class="annottext">dummy :: Name
</span><a href="#local-6989586621682197300"><span class="hs-identifier hs-var hs-var">dummy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameId -&gt; String -&gt; Name
forall a. MkName a =&gt; NameId -&gt; a -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#mkName_"><span class="hs-identifier hs-var">mkName_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ModuleNameHash -&gt; NameId
</span><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-var">NameId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#noModuleNameHash"><span class="hs-identifier hs-var">noModuleNameHash</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dummy&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>    </span><span id="local-6989586621682197304"><span class="annot"><span class="annottext">info :: DefInfo' Expr
</span><a href="#local-6989586621682197304"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity' -&gt; Access -&gt; IsAbstract -&gt; Range -&gt; DefInfo' Expr
forall t.
Name -&gt; Fixity' -&gt; Access -&gt; IsAbstract -&gt; Range -&gt; DefInfo' t
</span><a href="Agda.Syntax.Info.html#mkDefInfo"><span class="hs-identifier hs-var">mkDefInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682197300"><span class="hs-identifier hs-var">dummy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="Agda.Syntax.Common.html#noFixity%27"><span class="hs-identifier hs-var">noFixity'</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="Agda.Syntax.Common.html#PublicAccess"><span class="hs-identifier hs-var">PublicAccess</span></a></span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197289"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span>    </span><span id="local-6989586621682197294"><span class="annot"><span class="annottext">decl :: Declaration
</span><a href="#local-6989586621682197294"><span class="hs-identifier hs-var hs-var">decl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindOfName
-&gt; DefInfo' Expr
-&gt; ArgInfo
-&gt; Maybe PragmaPolarities
-&gt; QName
-&gt; Expr
-&gt; Declaration
</span><a href="Agda.Syntax.Abstract.html#Axiom"><span class="hs-identifier hs-var">A.Axiom</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#OtherDefName"><span class="hs-identifier hs-var">OtherDefName</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo' Expr
</span><a href="#local-6989586621682197304"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PragmaPolarities
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameFromList"><span class="hs-identifier hs-var">qnameFromList</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 Name -&gt; QName) -&gt; List1 Name -&gt; QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; List1 Name
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682197300"><span class="hs-identifier hs-var">dummy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682197289"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span class="annot"><span class="hs-comment">-- | Sorts interaction points based on their ranges.</span></span><span>
</span><span id="line-1100"></span><span>
</span><span id="line-1101"></span><span id="local-6989586621682195086"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-type">sortInteractionPoints</span></a></span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadInteractionPoints"><span class="hs-identifier hs-type">MonadInteractionPoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195086"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195086"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682195086"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682195086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1104"></span><span id="sortInteractionPoints"><span class="annot"><span class="annottext">sortInteractionPoints :: forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadError TCErr m, MonadDebug m) =&gt;
[InteractionId] -&gt; m [InteractionId]
</span><a href="Agda.Interaction.InteractionTop.html#sortInteractionPoints"><span class="hs-identifier hs-var hs-var">sortInteractionPoints</span></a></span></span><span> </span><span id="local-6989586621682197333"><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621682197333"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1105"></span><span>  </span><span class="annot"><span class="annottext">((InteractionId, Range) -&gt; InteractionId)
-&gt; [(InteractionId, Range)] -&gt; [InteractionId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, Range) -&gt; InteractionId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(InteractionId, Range)] -&gt; [InteractionId])
-&gt; ([(InteractionId, Range)] -&gt; [(InteractionId, Range)])
-&gt; [(InteractionId, Range)]
-&gt; [InteractionId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((InteractionId, Range) -&gt; (InteractionId, Range) -&gt; Ordering)
-&gt; [(InteractionId, Range)] -&gt; [(InteractionId, Range)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Range -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Range -&gt; Ordering)
-&gt; ((InteractionId, Range) -&gt; Range)
-&gt; (InteractionId, Range)
-&gt; (InteractionId, Range)
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, Range) -&gt; Range
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(InteractionId, Range)] -&gt; [InteractionId])
-&gt; m [(InteractionId, Range)] -&gt; m [InteractionId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1106"></span><span>    </span><span class="annot"><span class="annottext">[InteractionId]
-&gt; (InteractionId -&gt; m (InteractionId, Range))
-&gt; m [(InteractionId, Range)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[InteractionId]
</span><a href="#local-6989586621682197333"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">((InteractionId -&gt; m (InteractionId, Range))
 -&gt; m [(InteractionId, Range)])
-&gt; (InteractionId -&gt; m (InteractionId, Range))
-&gt; m [(InteractionId, Range)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682197337"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197337"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1107"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197337"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Range -&gt; (InteractionId, Range))
-&gt; m Range -&gt; m (InteractionId, Range)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; m Range
forall (m :: * -&gt; *).
(MonadInteractionPoints m, MonadDebug m, MonadError TCErr m) =&gt;
InteractionId -&gt; m Range
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getInteractionRange"><span class="hs-identifier hs-var">getInteractionRange</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197337"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span class="hs-comment">-- | Displays the current goal, the given document, and the current</span><span>
</span><span id="line-1110"></span><span class="hs-comment">--   context.</span><span>
</span><span id="line-1111"></span><span class="hs-comment">--</span><span>
</span><span id="line-1112"></span><span class="hs-comment">--   Should not modify the state.</span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-type">cmd_goal_type_context_and</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#GoalTypeAux"><span class="hs-identifier hs-type">GoalTypeAux</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1115"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span id="cmd_goal_type_context_and"><span class="annot"><span class="annottext">cmd_goal_type_context_and :: GoalTypeAux
-&gt; Rewrite -&gt; InteractionId -&gt; Range -&gt; String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#cmd_goal_type_context_and"><span class="hs-identifier hs-var hs-var">cmd_goal_type_context_and</span></a></span></span><span> </span><span id="local-6989586621682197338"><span class="annot"><span class="annottext">GoalTypeAux
</span><a href="#local-6989586621682197338"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682197339"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197339"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682197340"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197340"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1117"></span><span>  </span><span id="local-6989586621682197341"><span class="annot"><a href="#local-6989586621682197341"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM [ResponseContextEntry]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM [ResponseContextEntry]
 -&gt; StateT CommandState TCM [ResponseContextEntry])
-&gt; TCM [ResponseContextEntry]
-&gt; StateT CommandState TCM [ResponseContextEntry]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; InteractionId -&gt; TCM [ResponseContextEntry]
</span><a href="Agda.Interaction.BasicOps.html#getResponseContext"><span class="hs-identifier hs-var">B.getResponseContext</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197339"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682197340"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1118"></span><span>  </span><span id="local-6989586621682197342"><span class="annot"><a href="#local-6989586621682197342"><span class="hs-identifier hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupInteractionId"><span class="hs-identifier hs-type">lookupInteractionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197340"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#getConstraintsMentioning"><span class="hs-identifier hs-type">B.getConstraintsMentioning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197339"><span class="hs-identifier hs-type">norm</span></a></span><span>
</span><span id="line-1119"></span><span>  </span><span id="local-6989586621682197345"><span class="annot"><a href="#local-6989586621682197345"><span class="hs-identifier hs-var">boundary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#getIPBoundary"><span class="hs-identifier hs-type">B.getIPBoundary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197339"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197340"><span class="hs-identifier hs-type">ii</span></a></span><span>
</span><span id="line-1120"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_GoalSpecific"><span class="hs-identifier hs-type">Info_GoalSpecific</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197340"><span class="hs-identifier hs-type">ii</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Goal_GoalType"><span class="hs-identifier hs-type">Goal_GoalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197339"><span class="hs-identifier hs-type">norm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197338"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197341"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197345"><span class="hs-identifier hs-type">boundary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197342"><span class="hs-identifier hs-type">constr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span class="hs-comment">-- | Shows all the top-level names in the given module, along with</span><span>
</span><span id="line-1123"></span><span class="hs-comment">-- their types.</span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-type">showModuleContents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span id="showModuleContents"><span class="annot"><span class="annottext">showModuleContents :: Rewrite -&gt; Range -&gt; String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#showModuleContents"><span class="hs-identifier hs-var hs-var">showModuleContents</span></a></span></span><span> </span><span id="local-6989586621682197348"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197348"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682197349"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197349"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621682197350"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197350"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682197351"><span class="annot"><a href="#local-6989586621682197351"><span class="hs-identifier hs-var">modules</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197352"><span class="annot"><a href="#local-6989586621682197352"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197353"><span class="annot"><a href="#local-6989586621682197353"><span class="hs-identifier hs-var">types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ([Name], Telescope, [(Name, Type)])
-&gt; StateT CommandState TCM ([Name], Telescope, [(Name, Type)])
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO ([Name], Telescope, [(Name, Type)])
 -&gt; StateT CommandState TCM ([Name], Telescope, [(Name, Type)]))
-&gt; TCMT IO ([Name], Telescope, [(Name, Type)])
-&gt; StateT CommandState TCM ([Name], Telescope, [(Name, Type)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite
-&gt; Range -&gt; String -&gt; TCMT IO ([Name], Telescope, [(Name, Type)])
</span><a href="Agda.Interaction.BasicOps.html#moduleContents"><span class="hs-identifier hs-var">B.moduleContents</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197348"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197349"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197350"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1128"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_ModuleContents"><span class="hs-identifier hs-type">Info_ModuleContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197351"><span class="hs-identifier hs-type">modules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197352"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197353"><span class="hs-identifier hs-type">types</span></a></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="hs-comment">-- | Shows all the top-level names in scope which mention all the given</span><span>
</span><span id="line-1131"></span><span class="hs-comment">-- identifiers in their type.</span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#searchAbout"><span class="hs-identifier hs-type">searchAbout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span id="searchAbout"><span class="annot"><span class="annottext">searchAbout :: Rewrite -&gt; Range -&gt; String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#searchAbout"><span class="hs-identifier hs-var hs-var">searchAbout</span></a></span></span><span> </span><span id="local-6989586621682197356"><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197356"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621682197357"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197357"><span class="hs-identifier hs-var">rg</span></a></span></span><span> </span><span id="local-6989586621682197358"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197358"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1135"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; CommandM ()) -&gt; CommandM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Utils.String.html#trim"><span class="hs-identifier hs-var">trim</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197358"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((String -&gt; CommandM ()) -&gt; CommandM ())
-&gt; (String -&gt; CommandM ()) -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682197359"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197359"><span class="hs-identifier hs-var">trimmedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1136"></span><span>    </span><span id="local-6989586621682197360"><span class="annot"><a href="#local-6989586621682197360"><span class="hs-identifier hs-var">hits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [(Name, Type)] -&gt; StateT CommandState TCM [(Name, Type)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [(Name, Type)] -&gt; StateT CommandState TCM [(Name, Type)])
-&gt; TCMT IO [(Name, Type)] -&gt; StateT CommandState TCM [(Name, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rewrite -&gt; Range -&gt; String -&gt; TCMT IO [(Name, Type)]
</span><a href="Agda.Interaction.SearchAbout.html#findMentions"><span class="hs-identifier hs-var">findMentions</span></a></span><span> </span><span class="annot"><span class="annottext">Rewrite
</span><a href="#local-6989586621682197356"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197357"><span class="hs-identifier hs-var">rg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197359"><span class="hs-identifier hs-var">trimmedNames</span></a></span><span>
</span><span id="line-1137"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_SearchAbout"><span class="hs-identifier hs-type">Info_SearchAbout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197360"><span class="hs-identifier hs-type">hits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197359"><span class="hs-identifier hs-type">trimmedNames</span></a></span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span class="annot"><span class="hs-comment">-- | Explain why something is in scope.</span></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-type">whyInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span id="whyInScope"><span class="annot"><span class="annottext">whyInScope :: String -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#whyInScope"><span class="hs-identifier hs-var hs-var">whyInScope</span></a></span></span><span> </span><span id="local-6989586621682197363"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197363"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1143"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682197364"><span class="annot"><a href="#local-6989586621682197364"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-1144"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682197365"><span class="annot"><a href="#local-6989586621682197365"><span class="hs-identifier hs-var hs-var">cwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; String) -&gt; AbsolutePath -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621682197364"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>  </span><span id="local-6989586621682197368"><span class="annot"><a href="#local-6989586621682197368"><span class="hs-identifier hs-var">why</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#liftLocalState"><span class="hs-identifier hs-type">liftLocalState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#whyInScope"><span class="hs-identifier hs-type">B.whyInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197365"><span class="hs-identifier hs-type">cwd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197363"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1146"></span><span>  </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Info_WhyInScope"><span class="hs-identifier hs-type">Info_WhyInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197368"><span class="hs-identifier hs-type">why</span></a></span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span class="annot"><span class="hs-comment">-- | Sets the command line options and updates the status information.</span></span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-type">setCommandLineOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#CommandLineOptions"><span class="hs-identifier hs-type">CommandLineOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span id="setCommandLineOpts"><span class="annot"><span class="annottext">setCommandLineOpts :: CommandLineOptions -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#setCommandLineOpts"><span class="hs-identifier hs-var hs-var">setCommandLineOpts</span></a></span></span><span> </span><span id="local-6989586621682197371"><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621682197371"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1152"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; CommandM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; CommandM ()) -&gt; TCM () -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-var">TCM.setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions
</span><a href="#local-6989586621682197371"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-1153"></span><span>    </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span class="hs-comment">-- | Computes some status information.</span><span>
</span><span id="line-1157"></span><span class="hs-comment">--</span><span>
</span><span id="line-1158"></span><span class="hs-comment">--   Does not change the state.</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#status"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span>
</span><span id="line-1161"></span><span id="status"><span class="annot"><span class="annottext">status :: CommandM Status
</span><a href="Agda.Interaction.InteractionTop.html#status"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>  </span><span id="local-6989586621682197374"><span class="annot"><a href="#local-6989586621682197374"><span class="hs-identifier hs-var">cf</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CommandState -&gt; Maybe CurrentFile)
-&gt; StateT CommandState TCM (Maybe CurrentFile)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CommandState -&gt; Maybe CurrentFile
</span><a href="Agda.Interaction.Base.html#theCurrentFile"><span class="hs-identifier hs-var">theCurrentFile</span></a></span><span>
</span><span id="line-1163"></span><span>  </span><span id="local-6989586621682197375"><span class="annot"><a href="#local-6989586621682197375"><span class="hs-identifier hs-var">showImpl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#showImplicitArguments"><span class="hs-identifier hs-type">showImplicitArguments</span></a></span><span>
</span><span id="line-1164"></span><span>  </span><span id="local-6989586621682197377"><span class="annot"><a href="#local-6989586621682197377"><span class="hs-identifier hs-var">showIrr</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#showIrrelevantArguments"><span class="hs-identifier hs-type">showIrrelevantArguments</span></a></span><span>
</span><span id="line-1165"></span><span>
</span><span id="line-1166"></span><span>  </span><span class="hs-comment">-- Check if the file was successfully type checked, and has not</span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-comment">-- changed since. Note: This code does not check if any dependencies</span><span>
</span><span id="line-1168"></span><span>  </span><span class="hs-comment">-- have changed, and uses a time stamp to check for changes.</span><span>
</span><span id="line-1169"></span><span>  </span><span id="local-6989586621682197379"><span class="annot"><a href="#local-6989586621682197379"><span class="hs-identifier hs-var">checked</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682197374"><span class="hs-identifier hs-type">cf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1170"></span><span>    </span><span class="annot"><span class="annottext">Maybe CurrentFile
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1171"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682197380"><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621682197380"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1172"></span><span>      </span><span id="local-6989586621682197381"><span class="annot"><a href="#local-6989586621682197381"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ClockTime -&gt; TCMT IO ClockTime
forall b. IO b -&gt; TCM b
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ClockTime -&gt; TCMT IO ClockTime)
-&gt; IO ClockTime -&gt; TCMT IO ClockTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ClockTime
</span><span class="hs-identifier hs-var">getModificationTime</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ClockTime) -&gt; String -&gt; IO ClockTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.Base.html#currentFilePath"><span class="hs-identifier hs-var">currentFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentFile
</span><a href="#local-6989586621682197380"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileStamp"><span class="hs-identifier hs-var">currentFileStamp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197380"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682197381"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1174"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-1175"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span>
</span><span id="line-1176"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModule"><span class="hs-identifier hs-type">getVisitedModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Base.html#currentFileModule"><span class="hs-identifier hs-var">currentFileModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197380"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1178"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-1179"></span><span>
</span><span id="line-1180"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#sShowImplicitArguments"><span class="hs-identifier hs-var">sShowImplicitArguments</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197375"><span class="hs-identifier hs-type">showImpl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1181"></span><span>                    </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#sShowIrrelevantArguments"><span class="hs-identifier hs-var">sShowIrrelevantArguments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197377"><span class="hs-identifier hs-type">showIrr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1182"></span><span>                    </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#sChecked"><span class="hs-identifier hs-var">sChecked</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682197379"><span class="hs-identifier hs-type">checked</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span class="hs-comment">-- | Displays or updates status information.</span><span>
</span><span id="line-1185"></span><span class="hs-comment">--</span><span>
</span><span id="line-1186"></span><span class="hs-comment">--   Does not change the state.</span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-type">displayStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1189"></span><span id="displayStatus"><span class="annot"><span class="annottext">displayStatus :: CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var hs-var">displayStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1190"></span><span>  </span><span class="annot"><span class="annottext">Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; CommandM ())
-&gt; (Status -&gt; Response) -&gt; Status -&gt; CommandM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
Status -&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_Status"><span class="hs-identifier hs-var">Resp_Status</span></a></span><span>  </span><span class="annot"><span class="annottext">(Status -&gt; CommandM ()) -&gt; CommandM Status -&gt; CommandM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">CommandM Status
</span><a href="Agda.Interaction.InteractionTop.html#status"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- | @display_info@ does what @'displayInfo' False@ does, but</span><span>
</span><span id="line-1193"></span><span class="hs-comment">--   additionally displays some status information (see 'status' and</span><span>
</span><span id="line-1194"></span><span class="hs-comment">--   'displayStatus').</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-type">display_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html#DisplayInfo"><span class="hs-identifier hs-type">DisplayInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span id="display_info"><span class="annot"><span class="annottext">display_info :: DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#display_info"><span class="hs-identifier hs-var hs-var">display_info</span></a></span></span><span> </span><span id="local-6989586621682197384"><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
</span><a href="#local-6989586621682197384"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1198"></span><span>  </span><span class="annot"><span class="annottext">CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#displayStatus"><span class="hs-identifier hs-var">displayStatus</span></a></span><span>
</span><span id="line-1199"></span><span>  </span><span class="annot"><span class="annottext">Response -&gt; CommandM ()
</span><a href="Agda.Interaction.InteractionTop.html#putResponse"><span class="hs-identifier hs-var">putResponse</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; CommandM ()) -&gt; Response -&gt; CommandM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
-&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
DisplayInfo_boot tcErr tcWarning warningsAndNonFatalErrors
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_DisplayInfo"><span class="hs-identifier hs-var">Resp_DisplayInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayInfo_boot TCErr TCWarning WarningsAndNonFatalErrors
</span><a href="#local-6989586621682197384"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span class="hs-comment">-- | Parses and scope checks an expression (using the \&quot;inside scope\&quot;</span><span>
</span><span id="line-1202"></span><span class="hs-comment">-- as the scope), performs the given command with the expression as</span><span>
</span><span id="line-1203"></span><span class="hs-comment">-- input, and returns the result and the time it takes.</span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span id="local-6989586621682194878"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-type">parseAndDoAtToplevel</span></a></span><span>
</span><span id="line-1206"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194878"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The command to perform.</span></span><span>
</span><span id="line-1208"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1209"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The expression to parse.</span></span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Time.html#CPUTime"><span class="hs-identifier hs-type">CPUTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682194878"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1211"></span><span id="parseAndDoAtToplevel"><span class="annot"><span class="annottext">parseAndDoAtToplevel :: forall a. (Expr -&gt; TCM a) -&gt; String -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#parseAndDoAtToplevel"><span class="hs-identifier hs-var hs-var">parseAndDoAtToplevel</span></a></span></span><span> </span><span id="local-6989586621682197395"><span class="annot"><span class="annottext">Expr -&gt; TCM a
</span><a href="#local-6989586621682197395"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621682197396"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197396"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1212"></span><span>  </span><span class="annot"><span class="annottext">CommandM (Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a)
forall a. CommandM a -&gt; CommandM a
</span><a href="Agda.Interaction.Command.html#localStateCommandM"><span class="hs-identifier hs-var">localStateCommandM</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandM (Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a))
-&gt; CommandM (Maybe CPUTime, a) -&gt; CommandM (Maybe CPUTime, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1213"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682197397"><span class="annot"><a href="#local-6989586621682197397"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197398"><span class="annot"><a href="#local-6989586621682197398"><span class="hs-identifier hs-var">attrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Expr, Attributes)
-&gt; StateT CommandState TCM (Expr, Attributes)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Expr, Attributes)
 -&gt; StateT CommandState TCM (Expr, Attributes))
-&gt; TCM (Expr, Attributes)
-&gt; StateT CommandState TCM (Expr, Attributes)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PM (Expr, Attributes) -&gt; TCM (Expr, Attributes)
forall a. PM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Trace.html#runPM"><span class="hs-identifier hs-var">runPM</span></a></span><span> </span><span class="annot"><span class="annottext">(PM (Expr, Attributes) -&gt; TCM (Expr, Attributes))
-&gt; PM (Expr, Attributes) -&gt; TCM (Expr, Attributes)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser Expr -&gt; String -&gt; PM (Expr, Attributes)
forall a. Parser a -&gt; String -&gt; PM (a, Attributes)
</span><a href="Agda.Syntax.Parser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Expr
</span><a href="Agda.Syntax.Parser.html#exprParser"><span class="hs-identifier hs-var">exprParser</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682197396"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1214"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#checkAttributes"><span class="hs-identifier hs-type">checkAttributes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197398"><span class="hs-identifier hs-type">attrs</span></a></span><span>
</span><span id="line-1215"></span><span>    </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-type">maybeTimed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#atTopLevel"><span class="hs-identifier hs-type">atTopLevel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1216"></span><span>      </span><span class="annot"><a href="#local-6989586621682197395"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract_"><span class="hs-identifier hs-type">concreteToAbstract_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197397"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span id="local-6989586621682194937"><span class="annot"><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-type">maybeTimed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682194937"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Command.html#CommandM"><span class="hs-identifier hs-type">CommandM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Time.html#CPUTime"><span class="hs-identifier hs-type">CPUTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682194937"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1219"></span><span id="maybeTimed"><span class="annot"><span class="annottext">maybeTimed :: forall a. CommandM a -&gt; CommandM (Maybe CPUTime, a)
</span><a href="Agda.Interaction.InteractionTop.html#maybeTimed"><span class="hs-identifier hs-var hs-var">maybeTimed</span></a></span></span><span> </span><span id="local-6989586621682197411"><span class="annot"><span class="annottext">CommandM a
</span><a href="#local-6989586621682197411"><span class="hs-identifier hs-var">work</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1220"></span><span>  </span><span id="local-6989586621682197412"><span class="annot"><a href="#local-6989586621682197412"><span class="hs-identifier hs-var">doTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT CommandState m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; StateT CommandState TCM Bool)
-&gt; TCMT IO Bool -&gt; StateT CommandState TCM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProfileOption -&gt; TCMT IO Bool
forall (m :: * -&gt; *). MonadDebug m =&gt; ProfileOption -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Debug.html#hasProfileOption"><span class="hs-identifier hs-var">hasProfileOption</span></a></span><span> </span><span class="annot"><span class="annottext">ProfileOption
</span><a href="Agda.Interaction.Options.ProfileOptions.html#Interactive"><span class="hs-identifier hs-var">Profile.Interactive</span></a></span><span>
</span><span id="line-1221"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682197412"><span class="hs-identifier hs-type">doTime</span></a></span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682197411"><span class="hs-identifier hs-type">work</span></a></span><span>
</span><span id="line-1223"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1224"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682197415"><span class="annot"><a href="#local-6989586621682197415"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197416"><span class="annot"><a href="#local-6989586621682197416"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Time.html#measureTime"><span class="hs-identifier hs-type">measureTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682197411"><span class="hs-identifier hs-type">work</span></a></span><span>
</span><span id="line-1225"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682197416"><span class="hs-identifier hs-type">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682197415"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span class="hs-comment">-- | Tell to highlight the code using the given highlighting</span><span>
</span><span id="line-1228"></span><span class="hs-comment">-- info (unless it is @Nothing@).</span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-type">tellToUpdateHighlighting</span></a></span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html#HighlightingInfo"><span class="hs-identifier hs-type">HighlightingInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#HighlightingMethod"><span class="hs-identifier hs-type">HighlightingMethod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#ModuleToSource"><span class="hs-identifier hs-type">ModuleToSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1232"></span><span id="tellToUpdateHighlighting"><span class="annot"><span class="annottext">tellToUpdateHighlighting :: Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
-&gt; IO [Response]
</span><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-var hs-var">tellToUpdateHighlighting</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (HighlightingInfo, HighlightingMethod, ModuleToSource)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Response] -&gt; IO [Response]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1233"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellToUpdateHighlighting"><span class="hs-identifier hs-var">tellToUpdateHighlighting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682197418"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682197418"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197419"><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621682197419"><span class="hs-identifier hs-var">method</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682197420"><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621682197420"><span class="hs-identifier hs-var">modFile</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1234"></span><span>  </span><span class="annot"><span class="annottext">[Response] -&gt; IO [Response]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HighlightingInfo
-&gt; RemoveTokenBasedHighlighting
-&gt; HighlightingMethod
-&gt; ModuleToSource
-&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
HighlightingInfo
-&gt; RemoveTokenBasedHighlighting
-&gt; HighlightingMethod
-&gt; ModuleToSource
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_HighlightingInfo"><span class="hs-identifier hs-var">Resp_HighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682197418"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingMethod
</span><a href="#local-6989586621682197419"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleToSource
</span><a href="#local-6989586621682197420"><span class="hs-identifier hs-var">modFile</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span class="annot"><span class="hs-comment">-- | Tells the Emacs mode to go to the first error position (if any).</span></span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span class="annot"><a href="Agda.Interaction.InteractionTop.html#tellEmacsToJumpToError"><span class="hs-identifier hs-type">tellEmacsToJumpToError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Response.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1239"></span><span id="tellEmacsToJumpToError"><span class="annot"><span class="annottext">tellEmacsToJumpToError :: Range -&gt; [Response]
</span><a href="Agda.Interaction.InteractionTop.html#tellEmacsToJumpToError"><span class="hs-identifier hs-var hs-var">tellEmacsToJumpToError</span></a></span></span><span> </span><span id="local-6989586621682197421"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197421"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1240"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Maybe (Position' (Maybe RangeFile))
forall a. Range' a -&gt; Maybe (Position' a)
</span><a href="Agda.Syntax.Position.html#rStart"><span class="hs-identifier hs-var">rStart</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682197421"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1241"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Position' (Maybe RangeFile))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1242"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#Pn%27"><span class="hs-identifier hs-type">Pn'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RangeFile
</span><span class="hs-identifier hs-var">Strict.Nothing</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1243"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#Pn%27"><span class="hs-identifier hs-type">Pn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Strict.Just</span></span><span> </span><span id="local-6989586621682197426"><span class="annot"><span class="annottext">RangeFile
</span><a href="#local-6989586621682197426"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682197427"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682197427"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Word32 -&gt; Response
forall tcErr tcWarning warningsAndNonFatalErrors.
String
-&gt; Word32
-&gt; Response_boot tcErr tcWarning warningsAndNonFatalErrors
</span><a href="Agda.Interaction.Response.Base.html#Resp_JumpToError"><span class="hs-identifier hs-var">Resp_JumpToError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; String
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RangeFile -&gt; AbsolutePath
</span><a href="Agda.Syntax.Position.html#rangeFilePath"><span class="hs-identifier hs-var">rangeFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">RangeFile
</span><a href="#local-6989586621682197426"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682197427"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1244"></span></pre></body></html>