<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause.Match</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier">optRewriting</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.SmallSet.html"><span class="hs-identifier">Agda.Utils.SmallSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SmallSet</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#matchCompiled"><span class="hs-identifier hs-type">matchCompiled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MaybeReducedArgs"><span class="hs-identifier hs-type">MaybeReducedArgs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span id="matchCompiled"><span class="annot"><span class="annottext">matchCompiled :: CompiledClauses
-&gt; MaybeReducedArgs -&gt; ReduceM (Reduced (Blocked Args) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#matchCompiled"><span class="hs-identifier hs-var hs-var">matchCompiled</span></a></span></span><span> </span><span id="local-6989586621682022934"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682022934"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682022935"><span class="annot"><span class="annottext">MaybeReducedArgs
</span><a href="#local-6989586621682022935"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-26"></span><span>  </span><span id="local-6989586621682022936"><span class="annot"><a href="#local-6989586621682022936"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompiledClauses
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#matchCompiledE"><span class="hs-identifier hs-var">matchCompiledE</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682022934"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MaybeReduced (Arg Term) -&gt; MaybeReduced Elim)
-&gt; MaybeReducedArgs -&gt; MaybeReducedElims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; MaybeReduced (Arg Term) -&gt; MaybeReduced Elim
forall a b. (a -&gt; b) -&gt; MaybeReduced a -&gt; MaybeReduced b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedArgs
</span><a href="#local-6989586621682022935"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682022936"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-type">YesReduction</span></a></span><span> </span><span id="local-6989586621682022940"><span class="annot"><span class="annottext">Simplification
</span><a href="#local-6989586621682022940"><span class="hs-identifier hs-var">simpl</span></a></span></span><span> </span><span id="local-6989586621682022941"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682022941"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reduced (Blocked Args) Term
-&gt; ReduceM (Reduced (Blocked Args) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Args) Term
 -&gt; ReduceM (Reduced (Blocked Args) Term))
-&gt; Reduced (Blocked Args) Term
-&gt; ReduceM (Reduced (Blocked Args) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Simplification -&gt; Term -&gt; Reduced (Blocked Args) Term
forall no yes. Simplification -&gt; yes -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-var">YesReduction</span></a></span><span> </span><span class="annot"><span class="annottext">Simplification
</span><a href="#local-6989586621682022940"><span class="hs-identifier hs-var">simpl</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682022941"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-type">NoReduction</span></a></span><span> </span><span id="local-6989586621682022943"><span class="annot"><span class="annottext">Blocked Elims
</span><a href="#local-6989586621682022943"><span class="hs-identifier hs-var">bes</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reduced (Blocked Args) Term
-&gt; ReduceM (Reduced (Blocked Args) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Args) Term
 -&gt; ReduceM (Reduced (Blocked Args) Term))
-&gt; Reduced (Blocked Args) Term
-&gt; ReduceM (Reduced (Blocked Args) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Args -&gt; Reduced (Blocked Args) Term
forall no yes. no -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-var">NoReduction</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked Args -&gt; Reduced (Blocked Args) Term)
-&gt; Blocked Args -&gt; Reduced (Blocked Args) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Args) -&gt; Blocked Elims -&gt; Blocked Args
forall a b. (a -&gt; b) -&gt; Blocked' Term a -&gt; Blocked' Term b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Elim -&gt; Arg Term) -&gt; Elims -&gt; Args
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Term -&gt; Maybe (Arg Term) -&gt; Arg Term
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Arg Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Arg Term) -&gt; Arg Term)
-&gt; (Elim -&gt; Maybe (Arg Term)) -&gt; Elim -&gt; Arg Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; Maybe (Arg Term)
forall a. Elim' a -&gt; Maybe (Arg a)
</span><a href="Agda.Syntax.Internal.Elim.html#isApplyElim"><span class="hs-identifier hs-var">isApplyElim</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocked Elims
</span><a href="#local-6989586621682022943"><span class="hs-identifier hs-var">bes</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | @matchCompiledE c es@ takes a function given by case tree @c@ and</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   and a spine @es@ and tries to apply the function to @es@.</span><span>
</span><span id="line-33"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#matchCompiledE"><span class="hs-identifier hs-type">matchCompiledE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MaybeReducedElims"><span class="hs-identifier hs-type">MaybeReducedElims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span id="matchCompiledE"><span class="annot"><span class="annottext">matchCompiledE :: CompiledClauses
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#matchCompiledE"><span class="hs-identifier hs-var hs-var">matchCompiledE</span></a></span></span><span> </span><span id="local-6989586621682022948"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682022948"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682022949"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022949"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682022948"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022949"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | A stack entry is a triple consisting of</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   1. the part of the case tree to continue matching,</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   2. the current argument vector, and</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   3. a patch function taking the current argument vector back</span><span>
</span><span id="line-40"></span><span class="hs-comment">--      to the original argument vector.</span><span>
</span><span id="line-41"></span><span class="hs-keyword">type</span><span> </span><span id="Frame"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#Frame"><span class="hs-identifier hs-var">Frame</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MaybeReducedElims"><span class="hs-identifier hs-type">MaybeReducedElims</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">type</span><span> </span><span id="Stack"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#Frame"><span class="hs-identifier hs-type">Frame</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | @match'@ tries to solve the matching problems on the @Stack@.</span><span>
</span><span id="line-46"></span><span class="hs-comment">--   In each iteration, the top problem is removed and handled.</span><span>
</span><span id="line-47"></span><span class="hs-comment">--</span><span>
</span><span id="line-48"></span><span class="hs-comment">--   If the top problem was a @Done@, we succeed.</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">--   If the top problem was a @Case n@ and the @n@th argument of the problem</span><span>
</span><span id="line-51"></span><span class="hs-comment">--   is not a constructor or literal, we are stuck, thus, fail.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">--   If we have a branch for the constructor/literal, we put it on the stack</span><span>
</span><span id="line-54"></span><span class="hs-comment">--   to continue.</span><span>
</span><span id="line-55"></span><span class="hs-comment">--   If we do not have a branch, we fall through to the next problem, which</span><span>
</span><span id="line-56"></span><span class="hs-comment">--   should be the corresponding catch-all branch.</span><span>
</span><span id="line-57"></span><span class="hs-comment">--</span><span>
</span><span id="line-58"></span><span class="hs-comment">--   An empty stack is an exception that can come only from an incomplete</span><span>
</span><span id="line-59"></span><span class="hs-comment">--   function definition.</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- TODO: literal/constructor pattern conflict (for Nat)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-type">match'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span id="match%27"><span class="annot"><span class="annottext">match' :: Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var hs-var">match'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682022953"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682022953"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022954"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022955"><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682022956"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682022956"><span class="hs-identifier hs-var">stack</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022957"><span class="annot"><span class="annottext">no :: (Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var hs-var hs-var">no</span></a></span></span><span> </span><span id="local-6989586621682022958"><span class="annot"><span class="annottext">Elims -&gt; Blocked Elims
</span><a href="#local-6989586621682022958"><span class="hs-identifier hs-var">blocking</span></a></span></span><span> </span><span id="local-6989586621682022959"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022959"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduced (Blocked Elims) Term
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Elims) Term
 -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Reduced (Blocked Elims) Term
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Elims -&gt; Reduced (Blocked Elims) Term
forall no yes. no -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-var">NoReduction</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked Elims -&gt; Reduced (Blocked Elims) Term)
-&gt; Blocked Elims -&gt; Reduced (Blocked Elims) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Blocked Elims
</span><a href="#local-6989586621682022958"><span class="hs-identifier hs-var">blocking</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims) -&gt; Elims -&gt; Blocked Elims
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Elims) -&gt; Elims -&gt; Elims
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MaybeReduced Elim -&gt; Elim) -&gt; MaybeReducedElims -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MaybeReduced Elim -&gt; Elim
forall a. MaybeReduced a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#ignoreReduced"><span class="hs-identifier hs-var">ignoreReduced</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022959"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span id="local-6989586621682022973"><span class="annot"><span class="annottext">yes :: b -&gt; f (Reduced no b)
</span><a href="#local-6989586621682022973"><span class="hs-identifier hs-var hs-var hs-var">yes</span></a></span></span><span> </span><span id="local-6989586621682022974"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682022974"><span class="hs-identifier hs-var">t</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Simplification -&gt; b -&gt; Reduced no b)
-&gt; b -&gt; Simplification -&gt; Reduced no b
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Simplification -&gt; b -&gt; Reduced no b
forall no yes. Simplification -&gt; yes -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-var">YesReduction</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682022974"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Simplification -&gt; Reduced no b)
-&gt; f Simplification -&gt; f (Reduced no b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Simplification) -&gt; f Simplification
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Simplification
</span><a href="Agda.TypeChecking.Monad.Base.html#envSimplification"><span class="hs-identifier hs-var">envSimplification</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-comment">-- TODO: make this local to Done</span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621682022979"><span class="annot"><a href="#local-6989586621682022979"><span class="hs-identifier hs-var">allowedReductions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; AllowedReductions) -&gt; ReduceM AllowedReductions
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; AllowedReductions
</span><a href="Agda.TypeChecking.Monad.Base.html#envAllowedReductions"><span class="hs-identifier hs-var">envAllowedReductions</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span id="local-6989586621682022981"><span class="annot"><a href="#local-6989586621682022981"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envAppDef"><span class="hs-identifier hs-var">envAppDef</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621682022983"><span class="annot"><a href="#local-6989586621682022983"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022981"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682022953"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-comment">-- impossible case</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Fail"><span class="hs-identifier hs-type">Fail</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Elims -&gt; Blocked Elims
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#AbsurdMatch"><span class="hs-identifier hs-var">AbsurdMatch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-comment">-- done matching</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621682022989"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022989"><span class="hs-identifier hs-var">_no</span></a></span></span><span> </span><span id="local-6989586621682022990"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682022990"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682022991"><span class="annot"><span class="annottext">[Arg String]
</span><a href="#local-6989586621682022991"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682022992"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682022992"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-82"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ClauseRecursive -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#couldBeRecursive"><span class="hs-identifier hs-var">couldBeRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682022990"><span class="hs-identifier hs-var">mr</span></a></span><span>
</span><span id="line-83"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#defTerminationUnconfirmed"><span class="hs-identifier hs-var">defTerminationUnconfirmed</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682022983"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#UnconfirmedReductions"><span class="hs-identifier hs-var">UnconfirmedReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReduction -&gt; AllowedReductions -&gt; Bool
forall a. SmallSetElement a =&gt; a -&gt; SmallSet a -&gt; Bool
</span><a href="Agda.Utils.SmallSet.html#notMember"><span class="hs-operator hs-var">`SmallSet.notMember`</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="#local-6989586621682022979"><span class="hs-identifier hs-var">allowedReductions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ReduceM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.reduce.recursive&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ReduceM ()) -&gt; String -&gt; ReduceM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Aborting reduction of &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682022981"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Elims -&gt; Blocked Elims
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-var">ReallyNotBlocked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-comment">-- if the function was partially applied, return a lambda</span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022999"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023001"><span class="hs-identifier hs-var">n</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall {f :: * -&gt; *} {b} {no}.
MonadTCEnv f =&gt;
b -&gt; f (Reduced no b)
</span><a href="#local-6989586621682022973"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Term -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; Substitution' Term
</span><a href="#local-6989586621682023003"><span class="hs-identifier hs-var">toSubst</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg String -&gt; Term -&gt; Term) -&gt; Term -&gt; [Arg String] -&gt; Term
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Arg String -&gt; Term -&gt; Term
</span><a href="#local-6989586621682023005"><span class="hs-identifier hs-var">lam</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682022992"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Arg String] -&gt; [Arg String]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022999"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg String]
</span><a href="#local-6989586621682022991"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-comment">-- otherwise, just apply instantiation to body</span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-comment">-- apply the result to any extra arguments</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall {f :: * -&gt; *} {b} {no}.
MonadTCEnv f =&gt;
b -&gt; f (Reduced no b)
</span><a href="#local-6989586621682022973"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Term -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; Substitution' Term
</span><a href="#local-6989586621682023003"><span class="hs-identifier hs-var">toSubst</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023007"><span class="hs-identifier hs-var">es0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682022992"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeReduced Elim -&gt; Elim) -&gt; MaybeReducedElims -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MaybeReduced Elim -&gt; Elim
forall a. MaybeReduced a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#ignoreReduced"><span class="hs-identifier hs-var">ignoreReduced</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023009"><span class="hs-identifier hs-var">es1</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>          </span><span id="local-6989586621682023001"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682023001"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg String] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Arg String]
</span><a href="#local-6989586621682022991"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-94"></span><span>          </span><span id="local-6989586621682022999"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621682022999"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-95"></span><span>          </span><span class="hs-comment">-- at least the first @n@ elims must be @Apply@s, so we can</span><span>
</span><span id="line-96"></span><span>          </span><span class="hs-comment">-- turn them into a subsitution</span><span>
</span><span id="line-97"></span><span>          </span><span id="local-6989586621682023003"><span class="annot"><span class="annottext">toSubst :: MaybeReducedElims -&gt; Substitution' Term
</span><a href="#local-6989586621682023003"><span class="hs-identifier hs-var hs-var">toSubst</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution' Term
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-var">parallelS</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; Substitution' Term)
-&gt; (MaybeReducedElims -&gt; [Term])
-&gt; MaybeReducedElims
-&gt; Substitution' Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; [Term])
-&gt; (MaybeReducedElims -&gt; [Term]) -&gt; MaybeReducedElims -&gt; [Term]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MaybeReduced Elim -&gt; Term) -&gt; MaybeReducedElims -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Term)
-&gt; (MaybeReduced Elim -&gt; Arg Term) -&gt; MaybeReduced Elim -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Maybe (Arg Term) -&gt; Arg Term
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Arg Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Arg Term) -&gt; Arg Term)
-&gt; (MaybeReduced Elim -&gt; Maybe (Arg Term))
-&gt; MaybeReduced Elim
-&gt; Arg Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; Maybe (Arg Term)
forall a. Elim' a -&gt; Maybe (Arg a)
</span><a href="Agda.Syntax.Internal.Elim.html#isApplyElim"><span class="hs-identifier hs-var">isApplyElim</span></a></span><span> </span><span class="annot"><span class="annottext">(Elim -&gt; Maybe (Arg Term))
-&gt; (MaybeReduced Elim -&gt; Elim)
-&gt; MaybeReduced Elim
-&gt; Maybe (Arg Term)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MaybeReduced Elim -&gt; Elim
forall a. MaybeReduced a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#ignoreReduced"><span class="hs-identifier hs-var">ignoreReduced</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682023007"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023007"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023009"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023009"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MaybeReducedElims -&gt; (MaybeReducedElims, MaybeReducedElims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023001"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-99"></span><span>          </span><span id="local-6989586621682023005"><span class="annot"><span class="annottext">lam :: Arg String -&gt; Term -&gt; Term
</span><a href="#local-6989586621682023005"><span class="hs-identifier hs-var hs-var">lam</span></a></span></span><span> </span><span id="local-6989586621682023019"><span class="annot"><span class="annottext">Arg String
</span><a href="#local-6989586621682023019"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682023020"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023020"><span class="hs-identifier hs-var">t</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Abs Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg String -&gt; ArgInfo
forall e. Arg e -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#argInfo"><span class="hs-identifier hs-var">argInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Arg String
</span><a href="#local-6989586621682023019"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Term -&gt; Abs Term
forall a. String -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg String -&gt; String
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg String
</span><a href="#local-6989586621682023019"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023020"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-comment">-- splitting on an eta-record constructor</span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682023026"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023026"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Branches"><span class="hs-identifier hs-type">Branches</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">etaBranch :: forall c. Case c -&gt; Maybe (ConHead, WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#etaBranch"><span class="hs-identifier hs-var">etaBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682023029"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023029"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023030"><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682023030"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">catchallBranch :: forall c. Case c -&gt; Maybe c
</span><a href="Agda.TypeChecking.CompiledClause.html#catchallBranch"><span class="hs-identifier hs-var">catchallBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682023032"><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682023032"><span class="hs-identifier hs-var">ca</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MaybeReducedElims -&gt; (MaybeReducedElims, MaybeReducedElims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023026"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-104"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeReducedElims
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Elims -&gt; Blocked Elims
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-105"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682023034"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023034"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MaybeRed"><span class="hs-identifier hs-type">MaybeRed</span></a></span><span> </span><span class="annot"><span class="annottext">IsReduced
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682023036"><span class="annot"><span class="annottext">e :: Elim
</span><a href="#local-6989586621682023036"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682023037"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023037"><span class="hs-identifier hs-var">v0</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682023038"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023038"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682023039"><span class="annot"><span class="annottext">projs :: MaybeReducedElims
</span><a href="#local-6989586621682023039"><span class="hs-identifier hs-var hs-var">projs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">IsReduced -&gt; Elim -&gt; MaybeReduced Elim
forall a. IsReduced -&gt; a -&gt; MaybeReduced a
</span><a href="Agda.TypeChecking.Monad.Base.html#MaybeRed"><span class="hs-identifier hs-var">MaybeRed</span></a></span><span> </span><span class="annot"><span class="annottext">IsReduced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotReduced"><span class="hs-identifier hs-var">NotReduced</span></a></span><span> </span><span class="annot"><span class="annottext">(Elim -&gt; MaybeReduced Elim) -&gt; Elim -&gt; MaybeReduced Elim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; Arg Term -&gt; Elim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682023041"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; Term -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Term
forall a. LensRelevance a =&gt; a -&gt; Term -&gt; Term
</span><a href="Agda.TypeChecking.Substitute.html#relToDontCare"><span class="hs-identifier hs-var">relToDontCare</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682023041"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023037"><span class="hs-identifier hs-var">v0</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023045"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682023041"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682023041"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682023045"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023045"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682023046"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span>                  </span><span id="local-6989586621682023047"><span class="annot"><span class="annottext">catchallFrame :: Stack -&gt; Stack
</span><a href="#local-6989586621682023047"><span class="hs-identifier hs-var hs-var">catchallFrame</span></a></span></span><span> </span><span id="local-6989586621682023048"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023048"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack
-&gt; (CompiledClauses -&gt; Stack) -&gt; Maybe CompiledClauses -&gt; Stack
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023048"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682023050"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682023050"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682023050"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses, MaybeReducedElims, Elims -&gt; Elims)
-&gt; Stack -&gt; Stack
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023048"><span class="hs-identifier hs-var">stack</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><a href="#local-6989586621682023032"><span class="hs-identifier hs-var">ca</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-108"></span><span>              </span><span class="annot"><span class="annottext">Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WithArity CompiledClauses -&gt; CompiledClauses
forall c. WithArity c -&gt; c
</span><a href="Agda.TypeChecking.CompiledClause.html#content"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682023030"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023034"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023039"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023038"><span class="hs-identifier hs-var">es1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682023052"><span class="hs-identifier hs-var">patchEta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses, MaybeReducedElims, Elims -&gt; Elims)
-&gt; Stack -&gt; Stack
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Stack -&gt; Stack
</span><a href="#local-6989586621682023047"><span class="hs-identifier hs-var">catchallFrame</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682022956"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>              </span><span id="local-6989586621682023046"><span class="annot"><span class="annottext">fs :: [Arg QName]
</span><a href="#local-6989586621682023046"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [Arg QName]
</span><a href="Agda.Syntax.Internal.html#conFields"><span class="hs-identifier hs-var">conFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023029"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-111"></span><span>              </span><span id="local-6989586621682023052"><span class="annot"><span class="annottext">patchEta :: Elims -&gt; Elims
</span><a href="#local-6989586621682023052"><span class="hs-identifier hs-var hs-var">patchEta</span></a></span></span><span> </span><span id="local-6989586621682023054"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023054"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023055"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims -&gt; Elims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023036"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims -&gt; Elims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023056"><span class="hs-identifier hs-var">es1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>                </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682023055"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023055"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023057"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023057"><span class="hs-identifier hs-var">es'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023026"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023054"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-113"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023056"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023056"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg QName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682023046"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023057"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-114"></span><span>          </span><span class="annot"><span class="annottext">(MaybeReducedElims, MaybeReducedElims)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceM (Reduced (Blocked Elims) Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">-- splitting on the @n@th elimination</span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682023058"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023058"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682023059"><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682023059"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MaybeReducedElims -&gt; (MaybeReducedElims, MaybeReducedElims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023058"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>          </span><span class="hs-comment">-- if the @n@th elimination is not supplied, no match</span><span>
</span><span id="line-120"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeReducedElims
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Elims -&gt; Blocked Elims
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682022954"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-comment">-- if the @n@th elimination is @e0@</span><span>
</span><span id="line-122"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682023060"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023060"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MaybeRed"><span class="hs-identifier hs-type">MaybeRed</span></a></span><span> </span><span id="local-6989586621682023061"><span class="annot"><span class="annottext">IsReduced
</span><a href="#local-6989586621682023061"><span class="hs-identifier hs-var">red</span></a></span></span><span> </span><span id="local-6989586621682023062"><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023062"><span class="hs-identifier hs-var">e0</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682023063"><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023063"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-comment">-- get the reduced form of @e0@</span><span>
</span><span id="line-124"></span><span>            </span><span id="local-6989586621682023064"><span class="annot"><a href="#local-6989586621682023064"><span class="hs-identifier hs-var">eb</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">Blocked</span></span><span> </span><span class="annot"><span class="hs-identifier">Elim</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsReduced
</span><a href="#local-6989586621682023061"><span class="hs-identifier hs-var">red</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>                    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span id="local-6989586621682023066"><span class="annot"><span class="annottext">Blocked ()
</span><a href="#local-6989586621682023066"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked Elim -&gt; ReduceM (Blocked Elim)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Elim -&gt; ReduceM (Blocked Elim))
-&gt; Blocked Elim -&gt; ReduceM (Blocked Elim)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023062"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; Blocked () -&gt; Blocked Elim
forall a b. a -&gt; Blocked' Term b -&gt; Blocked' Term a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Blocked ()
</span><a href="#local-6989586621682023066"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-127"></span><span>                    </span><span class="annot"><span class="annottext">IsReduced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotReduced"><span class="hs-identifier hs-var">NotReduced</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elim -&gt; ReduceM (Blocked Elim)
</span><a href="Agda.TypeChecking.Reduce.html#unfoldCorecursionE"><span class="hs-identifier hs-var">unfoldCorecursionE</span></a></span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023062"><span class="hs-identifier hs-var">e0</span></a></span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682023069"><span class="annot"><a href="#local-6989586621682023069"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked Elim -&gt; Elim
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Elim
</span><a href="#local-6989586621682023064"><span class="hs-identifier hs-var">eb</span></a></span><span>
</span><span id="line-129"></span><span>                </span><span class="hs-comment">-- replace the @n@th argument by its reduced form</span><span>
</span><span id="line-130"></span><span>                </span><span id="local-6989586621682023071"><span class="annot"><a href="#local-6989586621682023071"><span class="hs-identifier hs-var hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023060"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IsReduced -&gt; Elim -&gt; MaybeReduced Elim
forall a. IsReduced -&gt; a -&gt; MaybeReduced a
</span><a href="Agda.TypeChecking.Monad.Base.html#MaybeRed"><span class="hs-identifier hs-var">MaybeRed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked () -&gt; IsReduced
</span><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-var">Reduced</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked () -&gt; IsReduced) -&gt; Blocked () -&gt; IsReduced
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; Blocked Elim -&gt; Blocked ()
forall a b. a -&gt; Blocked' Term b -&gt; Blocked' Term a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Elim
</span><a href="#local-6989586621682023064"><span class="hs-identifier hs-var">eb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023069"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023063"><span class="hs-identifier hs-var">es1</span></a></span><span>
</span><span id="line-131"></span><span>                </span><span class="hs-comment">-- if a catch-all clause exists, put it on the stack</span><span>
</span><span id="line-132"></span><span>                </span><span id="local-6989586621682023072"><span class="annot"><a href="#local-6989586621682023072"><span class="hs-identifier hs-var hs-var">catchallFrame</span></a></span></span><span> </span><span id="local-6989586621682023073"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023073"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack
-&gt; (CompiledClauses -&gt; Stack) -&gt; Maybe CompiledClauses -&gt; Stack
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023073"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682023074"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682023074"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682023074"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023071"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses, MaybeReducedElims, Elims -&gt; Elims)
-&gt; Stack -&gt; Stack
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023073"><span class="hs-identifier hs-var">stack</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Case CompiledClauses -&gt; Maybe CompiledClauses
forall c. Case c -&gt; Maybe c
</span><a href="Agda.TypeChecking.CompiledClause.html#catchallBranch"><span class="hs-identifier hs-var">catchallBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682023059"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>                </span><span class="hs-comment">-- If our argument is @Lit l@, we push @litFrame l@ onto the stack.</span><span>
</span><span id="line-134"></span><span>                </span><span id="local-6989586621682023075"><span class="annot"><a href="#local-6989586621682023075"><span class="hs-identifier hs-var hs-var">litFrame</span></a></span></span><span> </span><span id="local-6989586621682023076"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682023076"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682023077"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023077"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Map Literal CompiledClauses -&gt; Maybe CompiledClauses
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682023076"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Case CompiledClauses -&gt; Map Literal CompiledClauses
forall c. Case c -&gt; Map Literal c
</span><a href="Agda.TypeChecking.CompiledClause.html#litBranches"><span class="hs-identifier hs-var">litBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682023059"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>                    </span><span class="annot"><span class="annottext">Maybe CompiledClauses
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023077"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-137"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682023080"><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682023080"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompiledClauses
</span><a href="#local-6989586621682023080"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023060"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023063"><span class="hs-identifier hs-var">es1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682023081"><span class="hs-identifier hs-var">patchLit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses, MaybeReducedElims, Elims -&gt; Elims)
-&gt; Stack -&gt; Stack
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023077"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-138"></span><span>                </span><span class="hs-comment">-- If our argument (or its constructor form) is @Con c ci vs@</span><span>
</span><span id="line-139"></span><span>                </span><span class="hs-comment">-- we push @conFrame c vs@ onto the stack.</span><span>
</span><span id="line-140"></span><span>                </span><span id="local-6989586621682023082"><span class="annot"><a href="#local-6989586621682023082"><span class="hs-identifier hs-var hs-var">conFrame</span></a></span></span><span> </span><span id="local-6989586621682023083"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023083"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682023084"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682023084"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682023085"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023085"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682023086"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023086"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Elims -&gt; Term) -&gt; Elims -&gt; Stack -&gt; Stack
</span><a href="#local-6989586621682023087"><span class="hs-identifier hs-var">conFrame'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023083"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023083"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682023084"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023085"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023086"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-141"></span><span>                </span><span id="local-6989586621682023087"><span class="annot"><a href="#local-6989586621682023087"><span class="hs-identifier hs-var hs-var">conFrame'</span></a></span></span><span> </span><span id="local-6989586621682023090"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023090"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682023091"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682023091"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682023092"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023092"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682023093"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023093"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Map QName (WithArity CompiledClauses)
-&gt; Maybe (WithArity CompiledClauses)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023090"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Case CompiledClauses -&gt; Map QName (WithArity CompiledClauses)
forall c. Case c -&gt; Map QName (WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#conBranches"><span class="hs-identifier hs-var">conBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682023059"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (WithArity CompiledClauses)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023093"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-144"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682023095"><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682023095"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses -&gt; CompiledClauses
forall c. WithArity c -&gt; c
</span><a href="Agda.TypeChecking.CompiledClause.html#content"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682023095"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-145"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023060"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Elim -&gt; MaybeReduced Elim) -&gt; Elims -&gt; MaybeReducedElims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsReduced -&gt; Elim -&gt; MaybeReduced Elim
forall a. IsReduced -&gt; a -&gt; MaybeReduced a
</span><a href="Agda.TypeChecking.Monad.Base.html#MaybeRed"><span class="hs-identifier hs-var">MaybeRed</span></a></span><span> </span><span class="annot"><span class="annottext">IsReduced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotReduced"><span class="hs-identifier hs-var">NotReduced</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023092"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023063"><span class="hs-identifier hs-var">es1</span></a></span><span>
</span><span id="line-146"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Int -&gt; Elims -&gt; Elims
</span><a href="#local-6989586621682023096"><span class="hs-identifier hs-var">patchCon</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682023091"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023092"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>                               </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses, MaybeReducedElims, Elims -&gt; Elims)
-&gt; Stack -&gt; Stack
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023093"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-148"></span><span>                </span><span class="hs-comment">-- If our argument is @Proj p@, we push @projFrame p@ onto the stack.</span><span>
</span><span id="line-149"></span><span>                </span><span id="local-6989586621682023097"><span class="annot"><a href="#local-6989586621682023097"><span class="hs-identifier hs-var hs-var">projFrame</span></a></span></span><span> </span><span id="local-6989586621682023098"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023098"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682023099"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023099"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Map QName (WithArity CompiledClauses)
-&gt; Maybe (WithArity CompiledClauses)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023098"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Case CompiledClauses -&gt; Map QName (WithArity CompiledClauses)
forall c. Case c -&gt; Map QName (WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#conBranches"><span class="hs-identifier hs-var">conBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682023059"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-151"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (WithArity CompiledClauses)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023099"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-152"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682023100"><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682023100"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WithArity CompiledClauses -&gt; CompiledClauses
forall c. WithArity c -&gt; c
</span><a href="Agda.TypeChecking.CompiledClause.html#content"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">WithArity CompiledClauses
</span><a href="#local-6989586621682023100"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023060"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims -&gt; MaybeReducedElims -&gt; MaybeReducedElims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023063"><span class="hs-identifier hs-var">es1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682023081"><span class="hs-identifier hs-var">patchLit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses, MaybeReducedElims, Elims -&gt; Elims)
-&gt; Stack -&gt; Stack
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023099"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-153"></span><span>                </span><span class="hs-comment">-- The new patch function restores the @n@th argument to @v@:</span><span>
</span><span id="line-154"></span><span>                </span><span class="hs-comment">-- In case we matched a literal, just put @v@ back.</span><span>
</span><span id="line-155"></span><span>                </span><span id="local-6989586621682023081"><span class="annot"><a href="#local-6989586621682023081"><span class="hs-identifier hs-var hs-var">patchLit</span></a></span></span><span> </span><span id="local-6989586621682023101"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023101"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023102"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims -&gt; Elims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023069"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims -&gt; Elims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023103"><span class="hs-identifier hs-var">es1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682023102"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023102"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023103"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023103"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023058"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023101"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-157"></span><span>                </span><span class="hs-comment">-- In case we matched constructor @c@ with @m@ arguments,</span><span>
</span><span id="line-158"></span><span>                </span><span class="hs-comment">-- contract these @m@ arguments @vs@ to @Con c ci vs@.</span><span>
</span><span id="line-159"></span><span class="hs-comment">--                patchCon c ci m es = patch (es0 ++ [Con c ci vs &lt;$ e] ++ es2)</span><span>
</span><span id="line-160"></span><span>                </span><span id="local-6989586621682023096"><span class="annot"><a href="#local-6989586621682023096"><span class="hs-identifier hs-var hs-var">patchCon</span></a></span></span><span> </span><span id="local-6989586621682023104"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682023104"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682023105"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023105"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682023106"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023106"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims
</span><a href="#local-6989586621682022955"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023107"><span class="hs-identifier hs-var">es0</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims -&gt; Elims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682023104"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023108"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elim -&gt; Elim
forall a b. a -&gt; Elim' b -&gt; Elim' a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023069"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Elims -&gt; Elims
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023109"><span class="hs-identifier hs-var">es2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682023107"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023107"><span class="hs-identifier hs-var">es0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023110"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023110"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023058"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023106"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-162"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621682023111"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023111"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682023109"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023109"><span class="hs-identifier hs-var">es2</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682023105"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023110"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-163"></span><span>                        </span><span id="local-6989586621682023108"><span class="annot"><span class="annottext">vs :: Elims
</span><a href="#local-6989586621682023108"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023111"><span class="hs-identifier hs-var">es1</span></a></span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-comment">-- zo &lt;- do</span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-comment">--    mi &lt;- getBuiltinName' builtinIZero</span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-comment">--    mo &lt;- getBuiltinName' builtinIOne</span><span>
</span><span id="line-167"></span><span>            </span><span class="hs-comment">--    return $ Set.fromList $ catMaybes [mi,mo]</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>            </span><span id="local-6989586621682023112"><span class="annot"><a href="#local-6989586621682023112"><span class="hs-identifier hs-var">fallThrough</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#fallThrough"><span class="hs-identifier hs-var">fallThrough</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023059"><span class="hs-identifier hs-type">bs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#catchallBranch"><span class="hs-identifier hs-var">catchallBranch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023059"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-172"></span><span>              </span><span id="local-6989586621682023116"><span class="annot"><a href="#local-6989586621682023116"><span class="hs-identifier hs-var hs-var">isCon</span></a></span></span><span> </span><span id="local-6989586621682023117"><span class="annot"><span class="annottext">Blocked' t Elim
</span><a href="#local-6989586621682023117"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocked' t Elim -&gt; Elim
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked' t Elim
</span><a href="#local-6989586621682023117"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-174"></span><span>                 </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682023118"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682023118"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682023119"><span class="annot"><span class="annottext">c :: Term
</span><a href="#local-6989586621682023119"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682023118"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Maybe Term
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023119"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-175"></span><span>                 </span><span class="annot"><span class="annottext">Elim
</span><span class="hs-identifier">_</span></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-comment">-- Now do the matching on the @n@ths argument:</span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682023064"><span class="hs-identifier hs-type">eb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>              </span><span class="hs-comment">-- In case of a literal, try also its constructor form</span><span>
</span><span id="line-179"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682023120"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682023120"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682023121"><span class="annot"><span class="annottext">v :: Term
</span><a href="#local-6989586621682023121"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682023123"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682023123"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#performedSimplification"><span class="hs-identifier hs-var">performedSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">(ReduceM (Reduced (Blocked Elims) Term)
 -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>                </span><span id="local-6989586621682023125"><span class="annot"><a href="#local-6989586621682023125"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReduceM Term
forall (m :: * -&gt; *). HasBuiltins m =&gt; Term -&gt; m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#constructorForm"><span class="hs-identifier hs-var">constructorForm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023121"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-181"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682023127"><span class="annot"><a href="#local-6989586621682023127"><span class="hs-identifier hs-var hs-var">cFrame</span></a></span></span><span> </span><span id="local-6989586621682023128"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023128"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682023125"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>                      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682023129"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023129"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682023130"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682023130"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682023131"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023131"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Stack -&gt; Stack
</span><a href="#local-6989586621682023082"><span class="hs-identifier hs-var">conFrame</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023129"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682023130"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023131"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023128"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-183"></span><span>                      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682023128"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-184"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-type">match'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682023075"><span class="hs-identifier hs-type">litFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023123"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682023127"><span class="hs-identifier hs-type">cFrame</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682023072"><span class="hs-identifier hs-type">catchallFrame</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022956"><span class="hs-identifier hs-type">stack</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682023132"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682023132"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682023133"><span class="annot"><span class="annottext">v :: Term
</span><a href="#local-6989586621682023133"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682023135"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023135"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682023136"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023136"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Map QName (WithArity CompiledClauses)
-&gt; Maybe (WithArity CompiledClauses)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023135"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Case CompiledClauses -&gt; Map QName (WithArity CompiledClauses)
forall c. Case c -&gt; Map QName (WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#conBranches"><span class="hs-identifier hs-var">conBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
</span><a href="#local-6989586621682023059"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#performedSimplification"><span class="hs-identifier hs-var">performedSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">(ReduceM (Reduced (Blocked Elims) Term)
 -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>                </span><span class="annot"><span class="annottext">Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Elims -&gt; Term) -&gt; Elims -&gt; Stack -&gt; Stack
</span><a href="#local-6989586621682023087"><span class="hs-identifier hs-var">conFrame'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023135"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023135"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023136"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; Stack) -&gt; Stack -&gt; Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack -&gt; Stack
</span><a href="#local-6989586621682023072"><span class="hs-identifier hs-var">catchallFrame</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; Stack) -&gt; Stack -&gt; Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682022956"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>              </span><span class="hs-comment">-- In case of a constructor, push the conFrame</span><span>
</span><span id="line-190"></span><span>              </span><span id="local-6989586621682023137"><span class="annot"><span class="annottext">Blocked Elim
</span><a href="#local-6989586621682023137"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682023138"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023138"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682023139"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682023139"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682023140"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023140"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocked Elim -&gt; Maybe Term
forall {t}. Blocked' t Elim -&gt; Maybe Term
</span><a href="#local-6989586621682023116"><span class="hs-identifier hs-var">isCon</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Elim
</span><a href="#local-6989586621682023137"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#performedSimplification"><span class="hs-identifier hs-var">performedSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">(ReduceM (Reduced (Blocked Elims) Term)
 -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-191"></span><span>                </span><span class="annot"><span class="annottext">Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Stack -&gt; Stack
</span><a href="#local-6989586621682023082"><span class="hs-identifier hs-var">conFrame</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682023138"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682023139"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682023140"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; Stack) -&gt; Stack -&gt; Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack -&gt; Stack
</span><a href="#local-6989586621682023072"><span class="hs-identifier hs-var">catchallFrame</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; Stack) -&gt; Stack -&gt; Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682022956"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>              </span><span class="hs-comment">-- In case of a projection, push the projFrame</span><span>
</span><span id="line-194"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682023141"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023141"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#performedSimplification"><span class="hs-identifier hs-var">performedSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">(ReduceM (Reduced (Blocked Elims) Term)
 -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; ReduceM (Reduced (Blocked Elims) Term)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>                </span><span class="annot"><span class="annottext">Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Stack -&gt; Stack
</span><a href="#local-6989586621682023097"><span class="hs-identifier hs-var">projFrame</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023141"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; Stack) -&gt; Stack -&gt; Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682022956"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-comment">-- catchallFrame $ stack</span><span>
</span><span id="line-196"></span><span>                </span><span class="hs-comment">-- Issue #1986: no catch-all for copattern matching!</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>              </span><span class="annot"><span class="annottext">Blocked Elim
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682023112"><span class="hs-identifier hs-var">fallThrough</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; Stack -&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack -&gt; Stack
</span><a href="#local-6989586621682023072"><span class="hs-identifier hs-var">catchallFrame</span></a></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; Stack) -&gt; Stack -&gt; Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621682022956"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621682023143"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682023143"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elim
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; Elims -&gt; Blocked Elims
forall t a. Blocker -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682023143"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023071"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>              </span><span class="hs-comment">-- Otherwise, we are stuck.  If we were stuck before,</span><span>
</span><span id="line-203"></span><span>              </span><span class="hs-comment">-- we keep the old reason, otherwise we give reason StuckOn here.</span><span>
</span><span id="line-204"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span id="local-6989586621682023144"><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="#local-6989586621682023144"><span class="hs-identifier hs-var">blocked</span></a></span></span><span> </span><span id="local-6989586621682023145"><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023145"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Blocked Elims)
-&gt; MaybeReducedElims -&gt; ReduceM (Reduced (Blocked Elims) Term)
</span><a href="#local-6989586621682022957"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Elims -&gt; Blocked Elims
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">(NotBlocked' Term -&gt; Elims -&gt; Blocked Elims)
-&gt; NotBlocked' Term -&gt; Elims -&gt; Blocked Elims
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; NotBlocked' Term -&gt; NotBlocked' Term
forall t. Elim' t -&gt; NotBlocked' t -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#stuckOn"><span class="hs-identifier hs-var">stuckOn</span></a></span><span> </span><span class="annot"><span class="annottext">Elim
</span><a href="#local-6989586621682023145"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="#local-6989586621682023144"><span class="hs-identifier hs-var">blocked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaybeReducedElims
</span><a href="#local-6989586621682023071"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- If we reach the empty stack, then pattern matching was incomplete</span><span>
</span><span id="line-208"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Match.html#match%27"><span class="hs-identifier hs-var">match'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{- new line here since __IMPOSSIBLE__ does not like the ' in match' -}</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><span class="annottext">ReduceM (Maybe QName)
-&gt; ReduceM (Reduced (Blocked Elims) Term)
-&gt; (QName -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCEnv -&gt; Maybe QName) -&gt; ReduceM (Maybe QName)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#envAppDef"><span class="hs-identifier hs-var">envAppDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReduceM (Reduced (Blocked Elims) Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; ReduceM (Reduced (Blocked Elims) Term))
 -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; (QName -&gt; ReduceM (Reduced (Blocked Elims) Term))
-&gt; ReduceM (Reduced (Blocked Elims) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682023148"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682023148"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621682023149"><span class="annot"><a href="#local-6989586621682023149"><span class="hs-identifier hs-var">pds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReduceM (Set QName)
forall (m :: * -&gt; *). ReadTCState m =&gt; m (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#getPartialDefs"><span class="hs-identifier hs-var">getPartialDefs</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682023148"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`elem`</span></span><span> </span><span class="annot"><a href="#local-6989586621682023149"><span class="hs-identifier hs-type">pds</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-type">NoReduction</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-type">MissingClauses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023148"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier hs-type">optRewriting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-type">NoReduction</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-type">ReallyNotBlocked</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See #5396</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#traceSLn"><span class="hs-identifier hs-type">traceSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;impossible&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Incomplete pattern matching when applying &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023148"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-219"></span></pre></body></html>