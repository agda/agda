<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.With.html"><span class="hs-identifier">Agda.TypeChecking.With</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WriterT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runWriterT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tell</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">foldrM</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">sconcat</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Pattern.html"><span class="hs-identifier">Agda.Syntax.Abstract.Pattern</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html"><span class="hs-identifier">Agda.Syntax.Abstract.Views</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Abstract.html"><span class="hs-identifier">Agda.TypeChecking.Abstract</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.EtaContract.html"><span class="hs-identifier">Agda.TypeChecking.EtaContract</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html"><span class="hs-identifier">Agda.TypeChecking.Patterns.Abstract</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html"><span class="hs-identifier">Agda.TypeChecking.Primitive</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html#getRefl"><span class="hs-identifier">getRefl</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html"><span class="hs-identifier">Agda.TypeChecking.Records</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS.Implicit</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS.Problem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier">ProblemEq</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.Path.html"><span class="hs-identifier">Agda.TypeChecking.Telescope.Path</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html"><span class="hs-identifier">Agda.Utils.Permutation</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><span class="hs-comment">-- | Split pattern variables according to with-expressions.</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">--   Input:</span><span>
</span><span id="line-59"></span><span class="hs-comment">--</span><span>
</span><span id="line-60"></span><span class="hs-comment">--   [@&#916;@]         context of types and with-arguments.</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">--   [@&#916; &#8866; t@]     type of rhs.</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">--   [@&#916; &#8866; vs : as@]    with arguments and their types</span><span>
</span><span id="line-65"></span><span class="hs-comment">--</span><span>
</span><span id="line-66"></span><span class="hs-comment">--   Output:</span><span>
</span><span id="line-67"></span><span class="hs-comment">--</span><span>
</span><span id="line-68"></span><span class="hs-comment">--   [@&#916;&#8321;@]              part of context needed for with arguments and their types.</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">--   [@&#916;&#8322;@]              part of context not needed for with arguments and their types.</span><span>
</span><span id="line-71"></span><span class="hs-comment">--</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   [@&#960;@]               permutation from &#916; to &#916;&#8321;&#916;&#8322; as returned by 'splitTelescope'.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">--   [@&#916;&#8321;&#916;&#8322; &#8866; t'@]       type of rhs under @&#960;@</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">--   [@&#916;&#8321; &#8866; vs' : as'@]  with-arguments and their types depending only on @&#916;&#8321;@.</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><a href="Agda.TypeChecking.With.html#splitTelForWith"><span class="hs-identifier hs-type">splitTelForWith</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-comment">-- Input:</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                         </span><span class="annot"><span class="hs-comment">-- ^ __@&#916;@__             context of types and with-arguments.</span></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                              </span><span class="annot"><span class="hs-comment">-- ^ __@&#916; &#8866; t@__         type of rhs.</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ __@&#916; &#8866; vs : as@__   with arguments and their types.</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-comment">-- Output:</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                         </span><span class="hs-comment">-- @&#916;&#8321;@             part of context needed for with arguments and their types.</span><span>
</span><span id="line-85"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                         </span><span class="hs-comment">-- @&#916;&#8322;@             part of context not needed for with arguments and their types.</span><span>
</span><span id="line-86"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>                       </span><span class="hs-comment">-- @&#960;@              permutation from &#916; to &#916;&#8321;&#916;&#8322; as returned by 'splitTelescope'.</span><span>
</span><span id="line-87"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                              </span><span class="hs-comment">-- @&#916;&#8321;&#916;&#8322; &#8866; t'@      type of rhs under @&#960;@</span><span>
</span><span id="line-88"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- @&#916;&#8321; &#8866; vs' : as'@ with- and rewrite-arguments and types under @&#960;@.</span><span>
</span><span id="line-89"></span><span>     </span><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ (__@&#916;&#8321;@__,__@&#916;&#8322;@__,__@&#960;@__,__@t'@__,__@vtys'@__) where</span><span>
</span><span id="line-90"></span><span class="hs-comment">--</span><span>
</span><span id="line-91"></span><span class="hs-comment">--   [@&#916;&#8321;@]        part of context needed for with arguments and their types.</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">--   [@&#916;&#8322;@]        part of context not needed for with arguments and their types.</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">--   [@&#960;@]         permutation from &#916; to &#916;&#8321;&#916;&#8322; as returned by 'splitTelescope'.</span><span>
</span><span id="line-96"></span><span class="hs-comment">--</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   [@&#916;&#8321;&#916;&#8322; &#8866; t'@] type of rhs under @&#960;@</span><span>
</span><span id="line-98"></span><span class="hs-comment">--</span><span>
</span><span id="line-99"></span><span class="hs-comment">--   [@&#916;&#8321; &#8866; vtys'@]  with-arguments and their types under @&#960;@.</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span id="splitTelForWith"><span class="annot"><span class="annottext">splitTelForWith :: Telescope
-&gt; Type
-&gt; List1 (Arg (Term, EqualityView))
-&gt; (Telescope, Telescope, Permutation, Type,
    List1 (Arg (Term, EqualityView)))
</span><a href="Agda.TypeChecking.With.html#splitTelForWith"><span class="hs-identifier hs-var hs-var">splitTelForWith</span></a></span></span><span> </span><span id="local-6989586621682165604"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165604"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682165605"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165605"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682165606"><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165606"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- Split the telescope into the part needed to type the with arguments</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- and all the other stuff.</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621682165607"><span class="annot"><span class="annottext">fv :: VarSet
</span><a href="#local-6989586621682165607"><span class="hs-identifier hs-var hs-var">fv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView)) -&gt; VarSet
forall t. Free t =&gt; t -&gt; VarSet
</span><a href="Agda.TypeChecking.Free.html#freeVarSet"><span class="hs-identifier hs-var">freeVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165606"><span class="hs-identifier hs-var">vtys</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#SplitTel"><span class="hs-identifier hs-type">SplitTel</span></a></span><span> </span><span id="local-6989586621682165610"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165610"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682165611"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165611"><span class="hs-identifier hs-var">delta2</span></a></span></span><span> </span><span id="local-6989586621682165612"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165612"><span class="hs-identifier hs-var">perm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Telescope -&gt; SplitTel
</span><a href="Agda.TypeChecking.Telescope.html#splitTelescope"><span class="hs-identifier hs-var">splitTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682165607"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165604"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- &#916;&#8321;&#916;&#8322; &#8866; &#960; : &#916;</span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621682165613"><span class="annot"><span class="annottext">pi :: Substitution' Term
</span><a href="#local-6989586621682165613"><span class="hs-identifier hs-var hs-var">pi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Impossible -&gt; Permutation -&gt; Substitution' Term
forall a.
DeBruijn a =&gt;
Impossible -&gt; Permutation -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.html#renaming"><span class="hs-identifier hs-var">renaming</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible
HasCallStack =&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#reverseP"><span class="hs-identifier hs-var">reverseP</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165612"><span class="hs-identifier hs-var">perm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- &#916;&#8321; &#8866; &#961; : &#916;&#8321;&#916;&#8322;  (We know that as does not depend on &#916;&#8322;.)</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621682165617"><span class="annot"><span class="annottext">rho :: Substitution' Term
</span><a href="#local-6989586621682165617"><span class="hs-identifier hs-var hs-var">rho</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Impossible -&gt; Int -&gt; Substitution' Term
forall a. Impossible -&gt; Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#strengthenS"><span class="hs-identifier hs-var">strengthenS</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible
HasCallStack =&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Substitution' Term) -&gt; Int -&gt; Substitution' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165611"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- &#916;&#8321; &#8866; &#961; &#8728; &#960; : &#916;</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621682165620"><span class="annot"><span class="annottext">rhopi :: Substitution' Term
</span><a href="#local-6989586621682165620"><span class="hs-identifier hs-var hs-var">rhopi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' Term -&gt; Substitution' Term -&gt; Substitution' Term
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-identifier hs-var">composeS</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
</span><a href="#local-6989586621682165617"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
</span><a href="#local-6989586621682165613"><span class="hs-identifier hs-var">pi</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- We need &#916;&#8321;&#916;&#8322; &#8866; t'</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621682165622"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621682165622"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Type) -&gt; Type -&gt; Type
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg Type)
</span><a href="#local-6989586621682165613"><span class="hs-identifier hs-var">pi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165605"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">-- and &#916;&#8321; &#8866; vtys'</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621682165624"><span class="annot"><span class="annottext">vtys' :: List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165624"><span class="hs-identifier hs-var hs-var">vtys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg (List1 (Arg (Term, EqualityView))))
-&gt; List1 (Arg (Term, EqualityView))
-&gt; List1 (Arg (Term, EqualityView))
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg (List1 (Arg (Term, EqualityView))))
</span><a href="#local-6989586621682165620"><span class="hs-identifier hs-var">rhopi</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165606"><span class="hs-identifier hs-var">vtys</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165610"><span class="hs-identifier hs-var">delta1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165611"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165612"><span class="hs-identifier hs-var">perm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165622"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165624"><span class="hs-identifier hs-var">vtys'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Abstract with-expressions @vs@ to generate type for with-helper function.</span><span>
</span><span id="line-123"></span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Each @EqualityType@, coming from a @rewrite@, will turn into 2 abstractions.</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Agda.TypeChecking.With.html#withFunctionType"><span class="hs-identifier hs-type">withFunctionType</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ @&#916;&#8321;@                        context for types of with-expressions.</span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @&#916;&#8321;,&#916;&#8322; &#8866; vs : raise &#916;&#8322; as@  with and rewrite-expressions and their type.</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ @&#916;&#8321; &#8866; &#916;&#8322;@                   context extension to type with-expressions.</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                               </span><span class="annot"><span class="hs-comment">-- ^ @&#916;&#8321;,&#916;&#8322; &#8866; b@                 type of rhs.</span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a></span><span>                           </span><span class="annot"><span class="hs-comment">-- ^ @&#916;&#8321;,&#916;&#8322; &#8866; [(i,(u0,u1))] : b@ boundary of rhs.</span></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat1"><span class="hs-identifier hs-type">Nat1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- ^ @&#916;&#8321; &#8594; wtel &#8594; &#916;&#8322;&#8242; &#8594; b&#8242;@ such that</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">--     @[vs/wtel]wtel = as@ and</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">--     @[vs/wtel]&#916;&#8322;&#8242; = &#916;&#8322;@ and</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">--     @[vs/wtel]b&#8242; = b@.</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- Plus the final number of with-arguments and the number of visible ones.</span><span>
</span><span id="line-138"></span><span id="withFunctionType"><span class="annot"><span class="annottext">withFunctionType :: Telescope
-&gt; List1 (Arg (Term, EqualityView))
-&gt; Telescope
-&gt; Type
-&gt; Boundary
-&gt; TCM (Type, (Int, Int))
</span><a href="Agda.TypeChecking.With.html#withFunctionType"><span class="hs-identifier hs-var hs-var">withFunctionType</span></a></span></span><span> </span><span id="local-6989586621682165628"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165628"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682165629"><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165629"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span id="local-6989586621682165630"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165630"><span class="hs-identifier hs-var">delta2</span></a></span></span><span> </span><span id="local-6989586621682165631"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165631"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682165632"><span class="annot"><span class="annottext">Boundary
</span><a href="#local-6989586621682165632"><span class="hs-identifier hs-var">bndry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM (Type, (Int, Int)) -&gt; TCM (Type, (Int, Int))
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165628"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Type, (Int, Int)) -&gt; TCM (Type, (Int, Int)))
-&gt; TCM (Type, (Int, Int)) -&gt; TCM (Type, (Int, Int))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.abstract&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO ()) -&gt; [Char] -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;preparing for with-abstraction&quot;</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-comment">-- Normalize and &#951;-contract the type @b@ of the rhs and the types @delta2@</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-comment">-- of the pattern variables not mentioned in @vs : as@.</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165672"><span class="annot"><span class="annottext">dbg :: Int -&gt; [Char] -&gt; a -&gt; m ()
</span><a href="#local-6989586621682165672"><span class="hs-identifier hs-var hs-var hs-var">dbg</span></a></span></span><span> </span><span id="local-6989586621682165673"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165673"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682165674"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682165674"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682165675"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682165675"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.abstract&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165673"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682165674"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; =&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682165675"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span id="local-6989586621682165681"><span class="annot"><a href="#local-6989586621682165681"><span class="hs-identifier hs-var">d2b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Boundary -&gt; TCM Type
</span><a href="Agda.TypeChecking.Telescope.Path.html#telePiPath_"><span class="hs-identifier hs-var">telePiPath_</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165630"><span class="hs-identifier hs-var">delta2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165631"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Boundary
</span><a href="#local-6989586621682165632"><span class="hs-identifier hs-var">bndry</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="#local-6989586621682165672"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&#916;&#8322; &#8594; B&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682165681"><span class="hs-identifier hs-type">d2b</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621682165683"><span class="annot"><a href="#local-6989586621682165683"><span class="hs-identifier hs-var">d2b</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#normalise"><span class="hs-identifier hs-type">normalise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165681"><span class="hs-identifier hs-type">d2b</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="#local-6989586621682165672"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-string">&quot;normal &#916;&#8322; &#8594; B&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682165683"><span class="hs-identifier hs-type">d2b</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621682165685"><span class="annot"><a href="#local-6989586621682165685"><span class="hs-identifier hs-var">d2b</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.EtaContract.html#etaContract"><span class="hs-identifier hs-type">etaContract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165683"><span class="hs-identifier hs-type">d2b</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="#local-6989586621682165672"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-string">&quot;eta-contracted &#916;&#8322; &#8594; B&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682165685"><span class="hs-identifier hs-type">d2b</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621682165687"><span class="annot"><a href="#local-6989586621682165687"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.EtaContract.html#etaContract"><span class="hs-identifier hs-type">etaContract</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#normalise"><span class="hs-identifier hs-type">normalise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165629"><span class="hs-identifier hs-type">vtys</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">-- wd2b = wtel &#8594; [vs : as] (&#916;&#8322; &#8594; B)</span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621682165689"><span class="annot"><a href="#local-6989586621682165689"><span class="hs-identifier hs-var">wd2b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldrM</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Abstract.html#piAbstract"><span class="hs-identifier hs-type">piAbstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165685"><span class="hs-identifier hs-type">d2b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165687"><span class="hs-identifier hs-type">vtys</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="#local-6989586621682165672"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-string">&quot;w&#915; &#8594; &#916;&#8322; &#8594; B&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682165689"><span class="hs-identifier hs-type">wd2b</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165691"><span class="annot"><a href="#local-6989586621682165691"><span class="hs-identifier hs-var hs-var">nwithargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty EqualityView -&gt; Int
forall (f :: * -&gt; *).
(Functor f, Foldable f) =&gt;
f EqualityView -&gt; Int
</span><a href="Agda.TypeChecking.With.html#countWithArgs"><span class="hs-identifier hs-var">countWithArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty EqualityView -&gt; Int) -&gt; NonEmpty EqualityView -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg (Term, EqualityView) -&gt; EqualityView)
-&gt; List1 (Arg (Term, EqualityView)) -&gt; NonEmpty EqualityView
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term, EqualityView) -&gt; EqualityView
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Term, EqualityView) -&gt; EqualityView)
-&gt; (Arg (Term, EqualityView) -&gt; (Term, EqualityView))
-&gt; Arg (Term, EqualityView)
-&gt; EqualityView
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg (Term, EqualityView) -&gt; (Term, EqualityView)
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165687"><span class="hs-identifier hs-var">vtys</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165696"><span class="annot"><a href="#local-6989586621682165696"><span class="hs-identifier hs-var hs-var">nwithpats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView)) -&gt; Int
forall (f :: * -&gt; *).
(Functor f, Foldable f) =&gt;
f (Arg (Term, EqualityView)) -&gt; Int
</span><a href="Agda.TypeChecking.With.html#countWithPats"><span class="hs-identifier hs-var">countWithPats</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165687"><span class="hs-identifier hs-var">vtys</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682165699"><span class="annot"><a href="#local-6989586621682165699"><span class="hs-identifier hs-var">wtel</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewUpTo"><span class="hs-identifier hs-type">telViewUpTo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165691"><span class="hs-identifier hs-type">nwithargs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165689"><span class="hs-identifier hs-type">wd2b</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">-- select the boundary for &quot;&#916;&#8321;&quot; abstracting over &quot;w&#915;.&#916;&#8322;&quot;</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165701"><span class="annot"><a href="#local-6989586621682165701"><span class="hs-identifier hs-var hs-var">bndry'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, (Term, Term))] -&gt; Boundary
forall x a. [(x, (a, a))] -&gt; Boundary' x a
</span><a href="Agda.TypeChecking.Telescope.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165703"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165704"><span class="hs-identifier hs-var">sd2</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="#local-6989586621682165705"><span class="hs-identifier hs-var">lams</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165706"><span class="hs-identifier hs-var">u0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="#local-6989586621682165705"><span class="hs-identifier hs-var">lams</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165707"><span class="hs-identifier hs-var">u1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682165703"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165703"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621682165706"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165706"><span class="hs-identifier hs-var">u0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682165707"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165707"><span class="hs-identifier hs-var">u1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Boundary -&gt; [(Int, (Term, Term))]
forall x a. Boundary' x a -&gt; [(x, (a, a))]
</span><a href="Agda.TypeChecking.Telescope.html#theBoundary"><span class="hs-identifier hs-var">theBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Boundary
</span><a href="#local-6989586621682165632"><span class="hs-identifier hs-var">bndry</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165703"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165704"><span class="hs-identifier hs-var">sd2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682165704"><span class="annot"><span class="annottext">sd2 :: Int
</span><a href="#local-6989586621682165704"><span class="hs-identifier hs-var hs-var">sd2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165630"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-167"></span><span>              </span><span id="local-6989586621682165705"><span class="annot"><span class="annottext">lams :: Term -&gt; Term
</span><a href="#local-6989586621682165705"><span class="hs-identifier hs-var hs-var">lams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
forall a. TeleNoAbs a =&gt; a -&gt; Term -&gt; Term
</span><a href="Agda.TypeChecking.Substitute.html#teleNoAbs"><span class="hs-identifier hs-var">teleNoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165699"><span class="hs-identifier hs-var">wtel</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; (Term -&gt; Term) -&gt; Term -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165630"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621682165711"><span class="annot"><a href="#local-6989586621682165711"><span class="hs-identifier hs-var">d1wd2b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.Path.html#telePiPath_"><span class="hs-identifier hs-type">telePiPath_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165628"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165689"><span class="hs-identifier hs-type">wd2b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165701"><span class="hs-identifier hs-type">bndry'</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="#local-6989586621682165672"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&#916;&#8321; &#8594; w&#915; &#8594; &#916;&#8322; &#8594; B&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682165711"><span class="hs-identifier hs-type">d1wd2b</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682165711"><span class="hs-identifier hs-type">d1wd2b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682165691"><span class="hs-identifier hs-type">nwithargs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682165696"><span class="hs-identifier hs-type">nwithpats</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><span class="hs-comment">-- | Count the number of arguments introduced into the type of the with-function.</span></span><span>
</span><span id="line-176"></span><span id="local-6989586621682164311"><span class="annot"><a href="Agda.TypeChecking.With.html#countWithArgs"><span class="hs-identifier hs-type">countWithArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621682164311"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682164311"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682164311"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat1"><span class="hs-identifier hs-type">Nat1</span></a></span></span><span>
</span><span id="line-177"></span><span id="countWithArgs"><span class="annot"><span class="annottext">countWithArgs :: forall (f :: * -&gt; *).
(Functor f, Foldable f) =&gt;
f EqualityView -&gt; Int
</span><a href="Agda.TypeChecking.With.html#countWithArgs"><span class="hs-identifier hs-var hs-var">countWithArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f Int -&gt; Int
forall a. Num a =&gt; f a -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">(f Int -&gt; Int)
-&gt; (f EqualityView -&gt; f Int) -&gt; f EqualityView -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EqualityView -&gt; Int) -&gt; f EqualityView -&gt; f Int
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">EqualityView -&gt; Int
forall {a}. Num a =&gt; EqualityView -&gt; a
</span><a href="#local-6989586621682165719"><span class="hs-identifier hs-var">countArgs</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621682165719"><span class="annot"><span class="annottext">countArgs :: EqualityView -&gt; a
</span><a href="#local-6989586621682165719"><span class="hs-identifier hs-var hs-var">countArgs</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-type">OtherType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="#local-6989586621682165719"><span class="hs-identifier hs-var">countArgs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IdiomType"><span class="hs-identifier hs-type">IdiomType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="#local-6989586621682165719"><span class="hs-identifier hs-var">countArgs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityType"><span class="hs-identifier hs-type">EqualityType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Count the number of with-patterns in the with-clause</span><span>
</span><span id="line-184"></span><span class="hs-comment">--   that need to be transformed to regular patterns</span><span>
</span><span id="line-185"></span><span class="hs-comment">--   in the **current round** of with-abstraction</span><span>
</span><span id="line-186"></span><span class="hs-comment">--   (important for nested with).</span><span>
</span><span id="line-187"></span><span id="local-6989586621682164321"><span class="annot"><a href="Agda.TypeChecking.With.html#countWithPats"><span class="hs-identifier hs-type">countWithPats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621682164321"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682164321"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682164321"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat1"><span class="hs-identifier hs-type">Nat1</span></a></span></span><span>
</span><span id="line-188"></span><span id="countWithPats"><span class="annot"><span class="annottext">countWithPats :: forall (f :: * -&gt; *).
(Functor f, Foldable f) =&gt;
f (Arg (Term, EqualityView)) -&gt; Int
</span><a href="Agda.TypeChecking.With.html#countWithPats"><span class="hs-identifier hs-var hs-var">countWithPats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f Int -&gt; Int
forall a. Num a =&gt; f a -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">(f Int -&gt; Int)
-&gt; (f (Arg (Term, EqualityView)) -&gt; f Int)
-&gt; f (Arg (Term, EqualityView))
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg (Term, EqualityView) -&gt; Int)
-&gt; f (Arg (Term, EqualityView)) -&gt; f Int
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- Andreas, 2025-04-08, see issue #7788.</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682165744"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165744"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-type">OtherType</span></a></span><span>   </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165744"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-comment">-- A hidden @with@ (issue #500) does not have a with-pattern in the abstract syntax.</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682165746"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165746"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IdiomType"><span class="hs-identifier hs-type">IdiomType</span></a></span><span>   </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165746"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-comment">-- The hidden version of the inspect idiom has just one with-pattern in the abstract syntax.</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682165747"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165747"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityType"><span class="hs-identifier hs-type">EqualityType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165747"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-comment">-- The desugaring of @rewrite@ produces two new with-patterns in the abstract syntax.</span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-comment">-- They are always @NotHidden@.</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | From a list of @with@ and @rewrite@ expressions and their types,</span><span>
</span><span id="line-200"></span><span class="hs-comment">--   compute the list of final @with@ expressions (after expanding the @rewrite@s).</span><span>
</span><span id="line-201"></span><span class="annot"><a href="Agda.TypeChecking.With.html#withArguments"><span class="hs-identifier hs-type">withArguments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>                 </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span id="withArguments"><span class="annot"><span class="annottext">withArguments :: List1 (Arg (Term, EqualityView)) -&gt; TCM (List1 (Arg Term))
</span><a href="Agda.TypeChecking.With.html#withArguments"><span class="hs-identifier hs-var hs-var">withArguments</span></a></span></span><span> </span><span id="local-6989586621682165750"><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165750"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="annottext">NonEmpty (List1 (Arg Term)) -&gt; List1 (Arg Term)
forall a. Semigroup a =&gt; NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">sconcat</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (List1 (Arg Term)) -&gt; List1 (Arg Term))
-&gt; TCMT IO (NonEmpty (List1 (Arg Term))) -&gt; TCM (List1 (Arg Term))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
-&gt; (Arg (Term, EqualityView) -&gt; TCM (List1 (Arg Term)))
-&gt; TCMT IO (NonEmpty (List1 (Arg Term)))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682165750"><span class="hs-identifier hs-var">vtys</span></a></span><span> </span><span class="annot"><span class="annottext">((Arg (Term, EqualityView) -&gt; TCM (List1 (Arg Term)))
 -&gt; TCMT IO (NonEmpty (List1 (Arg Term))))
-&gt; (Arg (Term, EqualityView) -&gt; TCM (List1 (Arg Term)))
-&gt; TCMT IO (NonEmpty (List1 (Arg Term)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682165753"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165753"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682165754"><span class="annot"><span class="annottext">(Term, EqualityView)
</span><a href="#local-6989586621682165754"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; NonEmpty Term -&gt; List1 (Arg Term)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682165753"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty Term -&gt; List1 (Arg Term))
-&gt; TCMT IO (NonEmpty Term) -&gt; TCM (List1 (Arg Term))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Term, EqualityView)
</span><a href="#local-6989586621682165754"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-208"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682165755"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165755"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-type">OtherType</span></a></span><span> </span><span id="local-6989586621682165756"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165756"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>            </span><span class="annot"><span class="annottext">NonEmpty Term -&gt; TCMT IO (NonEmpty Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Term -&gt; TCMT IO (NonEmpty Term))
-&gt; NonEmpty Term -&gt; TCMT IO (NonEmpty Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; NonEmpty Term
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165755"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682165758"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165758"><span class="hs-identifier hs-var">prf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165759"><span class="annot"><span class="annottext">eqt :: EqualityView
</span><a href="#local-6989586621682165759"><span class="hs-identifier hs-var">eqt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityType"><span class="hs-identifier hs-type">EqualityType</span></a></span><span> </span><span id="local-6989586621682165760"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682165760"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span id="local-6989586621682165761"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682165761"><span class="hs-identifier hs-var">_s</span></a></span></span><span> </span><span id="local-6989586621682165762"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165762"><span class="hs-identifier hs-var">_eq</span></a></span></span><span> </span><span id="local-6989586621682165763"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682165763"><span class="hs-identifier hs-var">_pars</span></a></span></span><span> </span><span id="local-6989586621682165764"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682165764"><span class="hs-identifier hs-var">_t</span></a></span></span><span> </span><span id="local-6989586621682165765"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682165765"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682165766"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682165766"><span class="hs-identifier hs-var">_v'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="annottext">NonEmpty Term -&gt; TCMT IO (NonEmpty Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Term -&gt; TCMT IO (NonEmpty Term))
-&gt; NonEmpty Term -&gt; TCMT IO (NonEmpty Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682165765"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term] -&gt; NonEmpty Term
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165758"><span class="hs-identifier hs-var">prf</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term] -&gt; [Term]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682165767"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165767"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IdiomType"><span class="hs-identifier hs-type">IdiomType</span></a></span><span> </span><span id="local-6989586621682165768"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165768"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>            </span><span id="local-6989586621682165769"><span class="annot"><a href="#local-6989586621682165769"><span class="hs-identifier hs-var">mkRefl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Arg Term -&gt; Term)
</span><a href="Agda.TypeChecking.Primitive.html#getRefl"><span class="hs-identifier hs-var">getRefl</span></a></span><span>
</span><span id="line-214"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682165767"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><a href="#local-6989586621682165769"><span class="hs-identifier hs-type">mkRefl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-type">defaultArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165767"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="annot"><span class="hs-comment">-- | Compute the clauses for the with-function given the original patterns.</span></span><span>
</span><span id="line-217"></span><span class="annot"><a href="Agda.TypeChecking.With.html#buildWithFunction"><span class="hs-identifier hs-type">buildWithFunction</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Names of the module parameters of the parent function.</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Name of the parent function.</span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Name of the with-function.</span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Types of the parent function.</span></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Context of parent patterns.</span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Parent patterns.</span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ Number of module parameters in parent patterns</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Substitution from parent lhs to with function lhs</span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Final permutation.</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ Number of needed vars.</span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ Number of with expressions.</span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ With-clauses.</span></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ With-clauses flattened wrt. parent patterns.</span></span><span>
</span><span id="line-231"></span><span id="buildWithFunction"><span class="annot"><span class="annottext">buildWithFunction :: [Name]
-&gt; QName
-&gt; QName
-&gt; Type
-&gt; Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Int
-&gt; Substitution' Term
-&gt; Permutation
-&gt; Int
-&gt; Int
-&gt; List1 (Clause' SpineLHS)
-&gt; TCM (List1 (Clause' SpineLHS))
</span><a href="Agda.TypeChecking.With.html#buildWithFunction"><span class="hs-identifier hs-var hs-var">buildWithFunction</span></a></span></span><span> </span><span id="local-6989586621682165774"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682165774"><span class="hs-identifier hs-var">cxtNames</span></a></span></span><span> </span><span id="local-6989586621682165775"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165775"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682165776"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165776"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682165777"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165777"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682165778"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165778"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682165779"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165779"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621682165780"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165780"><span class="hs-identifier hs-var">npars</span></a></span></span><span> </span><span id="local-6989586621682165781"><span class="annot"><span class="annottext">Substitution' Term
</span><a href="#local-6989586621682165781"><span class="hs-identifier hs-var">withSub</span></a></span></span><span> </span><span id="local-6989586621682165782"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165782"><span class="hs-identifier hs-var">perm</span></a></span></span><span> </span><span id="local-6989586621682165783"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165783"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621682165784"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165784"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682165785"><span class="annot"><span class="annottext">List1 (Clause' SpineLHS)
</span><a href="#local-6989586621682165785"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Clause' SpineLHS -&gt; TCMT IO (Clause' SpineLHS))
-&gt; List1 (Clause' SpineLHS) -&gt; TCM (List1 (Clause' SpineLHS))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; NonEmpty a -&gt; m (NonEmpty b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Clause' SpineLHS -&gt; TCMT IO (Clause' SpineLHS)
</span><a href="#local-6989586621682165787"><span class="hs-identifier hs-var">buildWithClause</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Clause' SpineLHS)
</span><a href="#local-6989586621682165785"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">-- Nested with-functions will iterate this function once for each parent clause.</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621682165787"><span class="annot"><span class="annottext">buildWithClause :: Clause' SpineLHS -&gt; TCMT IO (Clause' SpineLHS)
</span><a href="#local-6989586621682165787"><span class="hs-identifier hs-var hs-var">buildWithClause</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span id="local-6989586621682165789"><span class="annot"><span class="annottext">lhs :: SpineLHS
</span><a href="#local-6989586621682165789"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineLHS"><span class="hs-identifier hs-type">A.SpineLHS</span></a></span><span> </span><span id="local-6989586621682165791"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682165791"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165792"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165792"><span class="hs-identifier hs-var">allPs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682165793"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165793"><span class="hs-identifier hs-var">inheritedPats</span></a></span></span><span> </span><span id="local-6989586621682165794"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165794"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682165795"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682165795"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span id="local-6989586621682165796"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682165796"><span class="hs-identifier hs-var">catchall</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682165797"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165797"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165798"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165798"><span class="hs-identifier hs-var hs-var">wps</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; ([NamedArg Pattern], [NamedArg Pattern])
</span><a href="Agda.Syntax.Abstract.Pattern.html#splitOffTrailingWithPatterns"><span class="hs-identifier hs-var">splitOffTrailingWithPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165792"><span class="hs-identifier hs-var">allPs</span></a></span><span>
</span><span id="line-236"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682165800"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165800"><span class="hs-identifier hs-var hs-var">wps0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165801"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165801"><span class="hs-identifier hs-var hs-var">wps1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [NamedArg Pattern] -&gt; ([NamedArg Pattern], [NamedArg Pattern])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165784"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165798"><span class="hs-identifier hs-var">wps</span></a></span><span>
</span><span id="line-237"></span><span>          </span><span id="local-6989586621682165803"><span class="annot"><span class="annottext">ps0 :: [NamedArg Pattern]
</span><a href="#local-6989586621682165803"><span class="hs-identifier hs-var hs-var hs-var">ps0</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg Pattern -&gt; NamedArg Pattern)
-&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pattern -&gt; Pattern) -&gt; NamedArg Pattern -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; NamedArg a -&gt; NamedArg b
</span><a href="Agda.Syntax.Common.html#updateNamedArg"><span class="hs-identifier hs-var">updateNamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Pattern
forall {e}. Pattern' e -&gt; Pattern' e
</span><a href="#local-6989586621682165805"><span class="hs-identifier hs-var">fromWithP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165800"><span class="hs-identifier hs-var">wps0</span></a></span><span>
</span><span id="line-238"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>            </span><span id="local-6989586621682165805"><span class="annot"><span class="annottext">fromWithP :: Pattern' e -&gt; Pattern' e
</span><a href="#local-6989586621682165805"><span class="hs-identifier hs-var hs-var">fromWithP</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165809"><span class="annot"><span class="annottext">Pattern' e
</span><a href="#local-6989586621682165809"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' e
</span><a href="#local-6989586621682165809"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-240"></span><span>            </span><span class="annot"><a href="#local-6989586621682165805"><span class="hs-identifier hs-var">fromWithP</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' e
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' e
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;buildWithClause&quot;</span></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;n    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Int -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165784"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;wps  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165798"><span class="hs-identifier hs-var">wps</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;wps0 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165800"><span class="hs-identifier hs-var">wps0</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;wps1 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165801"><span class="hs-identifier hs-var">wps1</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-comment">-- Andreas, 2025-04-07, issue #7759</span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-comment">-- Usually the following is impossible because the with-clause collection</span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-comment">-- already looks for the correct number of with-patterns.</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-comment">-- However, if the lhs is just an ellipsis, we can slip through the cracks.</span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-comment">-- Thus, we install another check here to enforce the correct number of with-patterns.</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165800"><span class="hs-identifier hs-var">wps0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165784"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">SpineLHS -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">SpineLHS
</span><a href="#local-6989586621682165789"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#TooFewPatternsInWithClause"><span class="hs-identifier hs-var">TooFewPatternsInWithClause</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;inheritedPats:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682165818"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165819"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Dom Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682165820"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">A.ProblemEq</span></a></span><span> </span><span id="local-6989586621682165818"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682165818"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682165819"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165819"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682165820"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682165820"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165793"><span class="hs-identifier hs-var">inheritedPats</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682165822"><span class="annot"><a href="#local-6989586621682165822"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165823"><span class="annot"><a href="#local-6989586621682165823"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; QName
-&gt; QName
-&gt; Type
-&gt; Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Int
-&gt; Permutation
-&gt; [NamedArg Pattern]
-&gt; TCM ([ProblemEq], [NamedArg Pattern])
</span><a href="Agda.TypeChecking.With.html#stripWithClausePatterns"><span class="hs-identifier hs-var">stripWithClausePatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682165774"><span class="hs-identifier hs-var">cxtNames</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165775"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165776"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165777"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165778"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165779"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165780"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165782"><span class="hs-identifier hs-var">perm</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165797"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#hang"><span class="hs-identifier hs-type">hang</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;strippedPats:&quot;</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-264"></span><span>                                  </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165826"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165827"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165828"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">A.ProblemEq</span></a></span><span> </span><span id="local-6989586621682165826"><span class="annot"><a href="#local-6989586621682165826"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682165827"><span class="annot"><a href="#local-6989586621682165827"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682165828"><span class="annot"><a href="#local-6989586621682165828"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682165822"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>      </span><span id="local-6989586621682165829"><span class="annot"><a href="#local-6989586621682165829"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682165830"><span class="hs-identifier hs-type">buildRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165822"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165794"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682165831"><span class="annot"><a href="#local-6989586621682165831"><span class="hs-identifier hs-var">ps1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165832"><span class="annot"><a href="#local-6989586621682165832"><span class="hs-identifier hs-var">ps2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="annot"><a href="#local-6989586621682165783"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165823"><span class="hs-identifier hs-type">ps'</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165833"><span class="annot"><a href="#local-6989586621682165833"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SpineLHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' SpineLHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSInfo -&gt; QName -&gt; [NamedArg Pattern] -&gt; SpineLHS
</span><a href="Agda.Syntax.Abstract.html#SpineLHS"><span class="hs-identifier hs-var">A.SpineLHS</span></a></span><span> </span><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682165791"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165776"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; SpineLHS) -&gt; [NamedArg Pattern] -&gt; SpineLHS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165831"><span class="hs-identifier hs-var">ps1</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165803"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165832"><span class="hs-identifier hs-var">ps2</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165801"><span class="hs-identifier hs-var">wps1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165793"><span class="hs-identifier hs-var">inheritedPats</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165822"><span class="hs-identifier hs-var">strippedPats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>                     </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165829"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682165795"><span class="hs-identifier hs-var">wh</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682165796"><span class="hs-identifier hs-var">catchall</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;buildWithClause returns&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165833"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682165833"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621682165830"><span class="annot"><span class="annottext">buildRHS :: [ProblemEq] -&gt; RHS -&gt; TCMT IO RHS
</span><a href="#local-6989586621682165830"><span class="hs-identifier hs-var hs-var">buildRHS</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165834"><span class="annot"><span class="annottext">rhs :: RHS
</span><a href="#local-6989586621682165834"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RHS -&gt; TCMT IO RHS
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165834"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="#local-6989586621682165830"><span class="hs-identifier hs-var">buildRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165836"><span class="annot"><span class="annottext">rhs :: RHS
</span><a href="#local-6989586621682165836"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">RHS
</span><a href="Agda.Syntax.Abstract.html#AbsurdRHS"><span class="hs-identifier hs-var">A.AbsurdRHS</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RHS -&gt; TCMT IO RHS
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165836"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="#local-6989586621682165830"><span class="hs-identifier hs-var">buildRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-type">A.WithRHS</span></a></span><span> </span><span id="local-6989586621682165839"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165839"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682165840"><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682165840"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682165841"><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682165841"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 WithExpr -&gt; List1 Clause -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-var">A.WithRHS</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165839"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682165840"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 Clause -&gt; RHS) -&gt; TCMT IO (List1 Clause) -&gt; TCMT IO RHS
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">(Clause -&gt; TCMT IO Clause)
-&gt; List1 Clause -&gt; TCMT IO (List1 Clause)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; NonEmpty a -&gt; m (NonEmpty b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause' SpineLHS -&gt; Clause
forall a b. LHSToSpine a b =&gt; b -&gt; a
</span><a href="Agda.Syntax.Abstract.Pattern.html#spineToLhs"><span class="hs-identifier hs-var">A.spineToLhs</span></a></span><span> </span><span class="annot"><span class="annottext">(Clause' SpineLHS -&gt; Clause)
-&gt; (Clause' SpineLHS -&gt; Clause' SpineLHS)
-&gt; Clause' SpineLHS
-&gt; Clause
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause' SpineLHS -&gt; Clause' SpineLHS
</span><a href="#local-6989586621682165843"><span class="hs-identifier hs-var">permuteNamedDots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Clause' SpineLHS -&gt; Clause)
-&gt; (Clause -&gt; TCMT IO (Clause' SpineLHS))
-&gt; Clause
-&gt; TCMT IO Clause
forall (m :: * -&gt; *) b c a.
Functor m =&gt;
(b -&gt; c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="Agda.Utils.Functor.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Clause' SpineLHS -&gt; TCMT IO (Clause' SpineLHS)
</span><a href="#local-6989586621682165787"><span class="hs-identifier hs-var">buildWithClause</span></a></span><span> </span><span class="annot"><span class="annottext">(Clause' SpineLHS -&gt; TCMT IO (Clause' SpineLHS))
-&gt; (Clause -&gt; Clause' SpineLHS)
-&gt; Clause
-&gt; TCMT IO (Clause' SpineLHS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Clause' SpineLHS
forall a b. LHSToSpine a b =&gt; a -&gt; b
</span><a href="Agda.Syntax.Abstract.Pattern.html#lhsToSpine"><span class="hs-identifier hs-var">A.lhsToSpine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682165841"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="#local-6989586621682165830"><span class="hs-identifier hs-var">buildRHS</span></a></span><span> </span><span id="local-6989586621682165846"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165846"><span class="hs-identifier hs-var">strippedPats1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span id="local-6989586621682165848"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682165848"><span class="hs-identifier hs-var">qes</span></a></span></span><span> </span><span id="local-6989586621682165849"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165849"><span class="hs-identifier hs-var">strippedPats2</span></a></span></span><span> </span><span id="local-6989586621682165850"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165850"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682165851"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682165851"><span class="hs-identifier hs-var">wh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">(RHS -&gt; WhereDeclarations -&gt; RHS)
-&gt; WhereDeclarations -&gt; RHS -&gt; RHS
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RewriteEqn] -&gt; [ProblemEq] -&gt; RHS -&gt; WhereDeclarations -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-var">A.RewriteRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682165848"><span class="hs-identifier hs-var">qes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg [ProblemEq])
</span><a href="#local-6989586621682165781"><span class="hs-identifier hs-var">withSub</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165846"><span class="hs-identifier hs-var">strippedPats1</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165849"><span class="hs-identifier hs-var">strippedPats2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682165851"><span class="hs-identifier hs-var">wh</span></a></span><span> </span><span class="annot"><span class="annottext">(RHS -&gt; RHS) -&gt; TCMT IO RHS -&gt; TCMT IO RHS
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; RHS -&gt; TCMT IO RHS
</span><a href="#local-6989586621682165830"><span class="hs-identifier hs-var">buildRHS</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165850"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- The stripped patterns computed by buildWithClause lives in the context</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">-- of the top with-clause (of the current call to buildWithFunction). When</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- we recurse we expect inherited patterns to live in the context</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- of the innermost parent clause. Note that this makes them live in the</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-comment">-- context of the with-function arguments before any pattern matching. We</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-comment">-- need to update again once the with-clause patterns have been checked.</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-comment">-- This happens in Rules.Def.checkClause before calling checkRHS.</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="#local-6989586621682165843"><span class="hs-identifier hs-type">permuteNamedDots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621682165843"><span class="annot"><span class="annottext">permuteNamedDots :: Clause' SpineLHS -&gt; Clause' SpineLHS
</span><a href="#local-6989586621682165843"><span class="hs-identifier hs-var hs-var">permuteNamedDots</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span id="local-6989586621682165853"><span class="annot"><span class="annottext">SpineLHS
</span><a href="#local-6989586621682165853"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682165854"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165854"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span> </span><span id="local-6989586621682165855"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165855"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682165856"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682165856"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span id="local-6989586621682165857"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682165857"><span class="hs-identifier hs-var">catchall</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">SpineLHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' SpineLHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="annot"><span class="annottext">SpineLHS
</span><a href="#local-6989586621682165853"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg [ProblemEq])
</span><a href="#local-6989586621682165781"><span class="hs-identifier hs-var">withSub</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682165854"><span class="hs-identifier hs-var">strippedPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682165855"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682165856"><span class="hs-identifier hs-var">wh</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682165857"><span class="hs-identifier hs-var">catchall</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- The arguments of @stripWithClausePatterns@ are documented</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- at its type signature.</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- The following is duplicate information, but may help reading the examples below.</span><span>
</span><span id="line-298"></span><span class="hs-comment">--</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- [@&#916;@]   context bound by lhs of original function.</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- [@f@]   name of @with@-function.</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- [@t@]   type of the original function.</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- [@qs@]  internal patterns for original function.</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- [@np@]  number of module parameters in @qs@</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- [@&#960;@]   permutation taking @vars(qs)@ to @support(&#916;)@.</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- [@ps@]  patterns in with clause (eliminating type @t@).</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- [@ps'@] patterns for with function (presumably of type @&#916;@).</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><span class="hs-comment">{-| @stripWithClausePatterns cxtNames parent f t &#916; qs np &#960; ps = ps'@

Example:

@
  record Stream (A : Set) : Set where
    coinductive
    constructor delay
    field       force : A &#215; Stream A

  record SEq (s t : Stream A) : Set where
    coinductive
    field
      ~force : let a , as = force s
                   b , bs = force t
               in  a &#8801; b &#215; SEq as bs

  test : (s : Nat &#215; Stream Nat) (t : Stream Nat) &#8594; SEq (delay s) t &#8594; SEq t (delay s)
  ~force (test (a     , as) t p) with force t
  ~force (test (suc n , as) t p) | b , bs = ?
@

With function:

@
  f : (t : Stream Nat) (w : Nat &#215; Stream Nat) (a : Nat) (as : Stream Nat)
      (p : SEq (delay (a , as)) t) &#8594; (fst w &#8801; a) &#215; SEq (snd w) as

  &#916;  = t a as p   -- reorder to bring with-relevant (= needed) vars first
  &#960;  = a as t p &#8594; &#916;
  qs = (a     , as) t p ~force
  ps = (suc n , as) t p ~force
  ps' = (suc n) as t p
@

Resulting with-function clause is:

@
  f t (b , bs) (suc n) as t p
@

Note: stripWithClausePatterns factors __@ps@__ through __@qs@__, thus

@
  ps = qs[ps']
@

where @[..]@ is to be understood as substitution.
The projection patterns have vanished from __@ps'@__ (as they are already in __@qs@__).
-}</span></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="Agda.TypeChecking.With.html#stripWithClausePatterns"><span class="hs-identifier hs-type">stripWithClausePatterns</span></a></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ __@cxtNames@__ names of the module parameters of the parent function</span></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ __@parent@__ name of the parent function.</span></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ __@f@__   name of with-function.</span></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                     </span><span class="annot"><span class="hs-comment">-- ^ __@t@__   top-level type of the original function.</span></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ __@&#916;@__   context of patterns of parent function.</span></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ __@qs@__  internal patterns for original function.</span></span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ __@npars@__ number of module parameters in @qs@.</span></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ __@&#960;@__   permutation taking @vars(qs)@ to @support(&#916;)@.</span></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ __@ps@__  patterns in with clause (eliminating type @t@).</span></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">A.ProblemEq</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ __@ps'@__ patterns for with function (presumably of type @&#916;@).</span></span><span>
</span><span id="line-370"></span><span id="stripWithClausePatterns"><span class="annot"><span class="annottext">stripWithClausePatterns :: [Name]
-&gt; QName
-&gt; QName
-&gt; Type
-&gt; Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Int
-&gt; Permutation
-&gt; [NamedArg Pattern]
-&gt; TCM ([ProblemEq], [NamedArg Pattern])
</span><a href="Agda.TypeChecking.With.html#stripWithClausePatterns"><span class="hs-identifier hs-var hs-var">stripWithClausePatterns</span></a></span></span><span> </span><span id="local-6989586621682165858"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682165858"><span class="hs-identifier hs-var">cxtNames</span></a></span></span><span> </span><span id="local-6989586621682165859"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165859"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621682165860"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165860"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682165861"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165861"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682165862"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165862"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682165863"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165863"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621682165864"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165864"><span class="hs-identifier hs-var">npars</span></a></span></span><span> </span><span id="local-6989586621682165865"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165865"><span class="hs-identifier hs-var">perm</span></a></span></span><span> </span><span id="local-6989586621682165866"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165866"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-comment">-- Andreas, 2014-03-05 expand away pattern synoyms (issue 1074)</span><span>
</span><span id="line-372"></span><span>  </span><span id="local-6989586621682165867"><span class="annot"><a href="#local-6989586621682165867"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; TCM [NamedArg Pattern]
forall a. ExpandPatternSynonyms a =&gt; a -&gt; TCM a
</span><a href="Agda.TypeChecking.Patterns.Abstract.html#expandPatternSynonyms"><span class="hs-identifier hs-var">expandPatternSynonyms</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165866"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-comment">-- Ulf, 2016-11-16 Issue 2303: We need the module parameter</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-comment">-- instantiations from qs, so we make sure</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">-- that t is the top-level type of the parent function and add patterns for</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-comment">-- the module parameters to ps before stripping.</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165869"><span class="annot"><a href="#local-6989586621682165869"><span class="hs-identifier hs-var hs-var">paramPat</span></a></span></span><span> </span><span id="local-6989586621682165870"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165870"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Pattern
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Pattern) -&gt; BindName -&gt; Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; BindName
</span><a href="Agda.Syntax.Abstract.html#mkBindName"><span class="hs-identifier hs-var">A.mkBindName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; BindName) -&gt; Name -&gt; BindName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Int -&gt; Name
forall a. a -&gt; [a] -&gt; Int -&gt; a
</span><a href="Agda.Utils.List.html#indexWithDefault"><span class="hs-identifier hs-var">indexWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Name
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682165858"><span class="hs-identifier hs-var">cxtNames</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165870"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span id="local-6989586621682165874"><span class="annot"><a href="#local-6989586621682165874"><span class="hs-identifier hs-var hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; NamedArg DeBruijnPattern -&gt; NamedArg Pattern)
-&gt; [Int] -&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg Pattern]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; Named NamedName Pattern)
-&gt; NamedArg DeBruijnPattern -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Named NamedName DeBruijnPattern -&gt; Named NamedName Pattern)
 -&gt; NamedArg DeBruijnPattern -&gt; NamedArg Pattern)
-&gt; (Int
    -&gt; Named NamedName DeBruijnPattern -&gt; Named NamedName Pattern)
-&gt; Int
-&gt; NamedArg DeBruijnPattern
-&gt; NamedArg Pattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; Pattern)
-&gt; Named NamedName DeBruijnPattern -&gt; Named NamedName Pattern
forall a b. (a -&gt; b) -&gt; Named NamedName a -&gt; Named NamedName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((DeBruijnPattern -&gt; Pattern)
 -&gt; Named NamedName DeBruijnPattern -&gt; Named NamedName Pattern)
-&gt; (Int -&gt; DeBruijnPattern -&gt; Pattern)
-&gt; Int
-&gt; Named NamedName DeBruijnPattern
-&gt; Named NamedName Pattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; DeBruijnPattern -&gt; Pattern
</span><a href="#local-6989586621682165869"><span class="hs-identifier hs-var">paramPat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165864"><span class="hs-identifier hs-var">npars</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165863"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165867"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621682165877"><span class="annot"><a href="#local-6989586621682165877"><span class="hs-identifier hs-var">psi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatternsT"><span class="hs-identifier hs-type">insertImplicitPatternsT</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165874"><span class="hs-identifier hs-type">ps'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165861"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;stripping patterns&quot;</span></span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;t   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165861"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ps  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165867"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ps' = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165874"><span class="hs-identifier hs-type">ps'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;psi = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165877"><span class="hs-identifier hs-type">psi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165862"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-387"></span><span>               </span><span class="annot"><span class="hs-string">&quot;qs  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165863"><span class="hs-identifier hs-type">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;perm= &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682165865"><span class="hs-identifier hs-type">perm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-comment">-- Andreas, 2015-11-09 Issue 1710: self starts with parent-function, not with-function!</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682165885"><span class="annot"><a href="#local-6989586621682165885"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165886"><span class="annot"><a href="#local-6989586621682165886"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165859"><span class="hs-identifier hs-type">parent</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165861"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165877"><span class="hs-identifier hs-type">psi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165863"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682165886"><span class="hs-identifier hs-type">strippedPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="hs-string">&quot;strippedPats:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165891"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165892"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165893"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">A.ProblemEq</span></a></span><span> </span><span id="local-6989586621682165891"><span class="annot"><a href="#local-6989586621682165891"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682165892"><span class="annot"><a href="#local-6989586621682165892"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682165893"><span class="annot"><a href="#local-6989586621682165893"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682165886"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165894"><span class="annot"><a href="#local-6989586621682165894"><span class="hs-identifier hs-var hs-var">psp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. Permutation -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.Permutation.html#permute"><span class="hs-identifier hs-var">permute</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682165865"><span class="hs-identifier hs-var">perm</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165885"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ps' = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165885"><span class="hs-identifier hs-type">ps'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;psp = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682165894"><span class="hs-identifier hs-type">psp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682165886"><span class="hs-identifier hs-type">strippedPats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682165894"><span class="hs-identifier hs-type">psp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-comment">-- We need to get the correct hiding from the lhs context. The unifier may have moved bindings</span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-comment">-- sites around so we can't trust the hiding of the parent pattern variables. We should preserve</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">-- the origin though.</span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621682165896"><span class="annot"><span class="annottext">varArgInfo :: DBPatVar -&gt; ArgInfo
</span><a href="#local-6989586621682165896"><span class="hs-identifier hs-var hs-var">varArgInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682165897"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165897"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165898"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682165898"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165897"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-407"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165898"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">[ArgInfo] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682165900"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682165900"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgInfo] -&gt; Int -&gt; ArgInfo
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="Agda.Utils.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682165898"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ArgInfo
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-408"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682165900"><span class="annot"><span class="annottext">infos :: [ArgInfo]
</span><a href="#local-6989586621682165900"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgInfo] -&gt; [ArgInfo]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([ArgInfo] -&gt; [ArgInfo]) -&gt; [ArgInfo] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom ([Char], Type) -&gt; ArgInfo)
-&gt; [Dom ([Char], Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom ([Char], Type) -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom ([Char], Type)] -&gt; [ArgInfo])
-&gt; [Dom ([Char], Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom ([Char], Type)]
forall t. Tele (Dom t) -&gt; [Dom ([Char], t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165862"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621682165905"><span class="annot"><span class="annottext">setVarArgInfo :: DBPatVar -&gt; NamedArg Pattern -&gt; NamedArg Pattern
</span><a href="#local-6989586621682165905"><span class="hs-identifier hs-var hs-var">setVarArgInfo</span></a></span></span><span> </span><span id="local-6989586621682165906"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165906"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682165907"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165907"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; NamedArg Pattern -&gt; NamedArg Pattern
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Origin
forall a. LensOrigin a =&gt; a -&gt; Origin
</span><a href="Agda.Syntax.Common.html#getOrigin"><span class="hs-identifier hs-var">getOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165907"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NamedArg Pattern -&gt; NamedArg Pattern)
-&gt; NamedArg Pattern -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; NamedArg Pattern -&gt; NamedArg Pattern
forall a. LensArgInfo a =&gt; ArgInfo -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setArgInfo"><span class="hs-identifier hs-var">setArgInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; ArgInfo
</span><a href="#local-6989586621682165896"><span class="hs-identifier hs-var">varArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165906"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165907"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>                         </span><span class="hs-comment">-- Self.</span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                         </span><span class="hs-comment">-- The type to be eliminated.</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- With-clause patterns.</span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Parent-clause patterns with de Bruijn indices relative to &#916;.</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-418"></span><span>            </span><span class="hs-comment">-- With-clause patterns decomposed by parent-clause patterns.</span><span>
</span><span id="line-419"></span><span>            </span><span class="hs-comment">-- Also outputs named dot patterns from the parent clause that</span><span>
</span><span id="line-420"></span><span>            </span><span class="hs-comment">-- we need to add let-bindings for.</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- Case: out of with-clause patterns.</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621682165887"><span class="annot"><span class="annottext">strip :: Term
-&gt; Type
-&gt; [NamedArg Pattern]
-&gt; [NamedArg DeBruijnPattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165887"><span class="hs-identifier hs-var hs-var">strip</span></a></span></span><span> </span><span id="local-6989586621682165911"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165911"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span id="local-6989586621682165912"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165912"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682165913"><span class="annot"><span class="annottext">qs :: [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165913"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;strip (out of A.Patterns)&quot;</span></span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;qs  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
m Doc -&gt; t (m Doc) -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; [TCMT IO Doc]) -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; TCMT IO Doc)
-&gt; [NamedArg DeBruijnPattern] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; DeBruijnPattern -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; TCMT IO Doc)
-&gt; (NamedArg DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; DeBruijnPattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165913"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;self=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165911"><span class="hs-identifier hs-var">self</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;t   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165912"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-comment">-- Andreas, 2015-06-11, issue 1551:</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-comment">-- As the type t develops, we need to insert more implicit patterns,</span><span>
</span><span id="line-432"></span><span>      </span><span class="hs-comment">-- due to copatterns / flexible arity.</span><span>
</span><span id="line-433"></span><span>      </span><span id="local-6989586621682165914"><span class="annot"><a href="#local-6989586621682165914"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM [NamedArg Pattern]
 -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; TCM [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpandHidden
-&gt; [NamedArg Pattern] -&gt; Type -&gt; TCM [NamedArg Pattern]
forall (m :: * -&gt; *).
(PureTCM m, MonadError TCErr m, MonadFresh NameId m,
 MonadTrace m) =&gt;
ExpandHidden -&gt; [NamedArg Pattern] -&gt; Type -&gt; m [NamedArg Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatternsT"><span class="hs-identifier hs-var">insertImplicitPatternsT</span></a></span><span> </span><span class="annot"><span class="annottext">ExpandHidden
</span><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-var">ExpandLast</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165912"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-434"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682165914"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TooFewPatternsInWithClause"><span class="hs-identifier hs-type">TooFewPatternsInWithClause</span></a></span><span>
</span><span id="line-435"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165911"><span class="hs-identifier hs-type">self</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165912"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165914"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165913"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-comment">-- Case: out of parent-clause patterns.</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- This is only ok if all remaining with-clause patterns</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- are implicit patterns (we inserted too many).</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-var">strip</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165916"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165916"><span class="hs-identifier hs-var">ps</span></a></span></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165919"><span class="annot"><span class="annottext">implicit :: Pattern' e -&gt; Bool
</span><a href="#local-6989586621682165919"><span class="hs-identifier hs-var hs-var hs-var">implicit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-442"></span><span>          </span><span class="annot"><a href="#local-6989586621682165919"><span class="hs-identifier hs-var">implicit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span id="local-6989586621682165922"><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682165922"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NAPs e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConPatInfo -&gt; ConOrigin
</span><a href="Agda.Syntax.Info.html#conPatOrigin"><span class="hs-identifier hs-var">conPatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682165922"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin -&gt; ConOrigin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><a href="#local-6989586621682165919"><span class="hs-identifier hs-var">implicit</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' e
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg Pattern -&gt; Bool) -&gt; [NamedArg Pattern] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Bool
forall {e}. Pattern' e -&gt; Bool
</span><a href="#local-6989586621682165919"><span class="hs-identifier hs-var">implicit</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Bool)
-&gt; (NamedArg Pattern -&gt; Pattern) -&gt; NamedArg Pattern -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165916"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(WriterT [ProblemEq] (TCMT IO) ()
 -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#TooManyPatternsInWithClause"><span class="hs-identifier hs-var">TooManyPatternsInWithClause</span></a></span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><span class="annottext">[NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-comment">-- Case: both parent-clause pattern and with-clause pattern present.</span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-comment">-- Make sure they match, and decompose into subpatterns.</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-var">strip</span></a></span><span> </span><span id="local-6989586621682165927"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165927"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span id="local-6989586621682165928"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165928"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682165929"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165929"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682165930"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165930"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682165931"><span class="annot"><span class="annottext">qs :: [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165931"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682165932"><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682165932"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165934"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682165934"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682165935"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682165935"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165929"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682165936"><span class="annot"><a href="#local-6989586621682165936"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; WriterT [ProblemEq] (TCMT IO) (Dom Type, Abs Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
Type -&gt; m (Dom Type, Abs Type)
</span><a href="Agda.TypeChecking.Telescope.html#mustBePi"><span class="hs-identifier hs-var">mustBePi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165928"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682165938"><span class="annot"><a href="#local-6989586621682165938"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; DeBruijnPattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682165932"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165934"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165938"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165936"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165927"><span class="hs-identifier hs-type">self</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165928"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">p</span></span><span> </span><span class="annot"><span class="hs-operator">&lt;$</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165929"><span class="hs-identifier hs-type">p0</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682165930"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165931"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-var">strip</span></a></span><span> </span><span id="local-6989586621682165941"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165941"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span id="local-6989586621682165942"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165942"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682165943"><span class="annot"><span class="annottext">ps0 :: [NamedArg Pattern]
</span><a href="#local-6989586621682165943"><span class="hs-identifier hs-var">ps0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682165944"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682165945"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682165945"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682165946"><span class="annot"><span class="annottext">qs0 :: [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165946"><span class="hs-identifier hs-var">qs0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682165947"><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682165947"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682165948"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682165948"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span>      </span><span id="local-6989586621682165949"><span class="annot"><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName Pattern
 -&gt; WriterT [ProblemEq] (TCMT IO) (Named NamedName Pattern))
-&gt; NamedArg Pattern
-&gt; WriterT [ProblemEq] (TCMT IO) (NamedArg Pattern)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Arg a -&gt; f (Arg b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((Named NamedName Pattern
  -&gt; WriterT [ProblemEq] (TCMT IO) (Named NamedName Pattern))
 -&gt; NamedArg Pattern
 -&gt; WriterT [ProblemEq] (TCMT IO) (NamedArg Pattern))
-&gt; ((Pattern -&gt; WriterT [ProblemEq] (TCMT IO) Pattern)
    -&gt; Named NamedName Pattern
    -&gt; WriterT [ProblemEq] (TCMT IO) (Named NamedName Pattern))
-&gt; (Pattern -&gt; WriterT [ProblemEq] (TCMT IO) Pattern)
-&gt; NamedArg Pattern
-&gt; WriterT [ProblemEq] (TCMT IO) (NamedArg Pattern)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; WriterT [ProblemEq] (TCMT IO) Pattern)
-&gt; Named NamedName Pattern
-&gt; WriterT [ProblemEq] (TCMT IO) (Named NamedName Pattern)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Named NamedName a -&gt; f (Named NamedName b)
</span><span class="hs-identifier hs-var">traverse</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; WriterT [ProblemEq] (TCMT IO) Pattern
forall (m :: * -&gt; *).
(MonadError TCErr m, MonadTCEnv m, ReadTCState m, HasBuiltins m) =&gt;
Pattern -&gt; m Pattern
</span><a href="Agda.TypeChecking.Patterns.Abstract.html#expandLitPattern"><span class="hs-identifier hs-var">expandLitPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;strip&quot;</span></span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ps0 =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165943"><span class="hs-identifier hs-type">ps0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;exp =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165949"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-461"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;qs0 =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165946"><span class="hs-identifier hs-type">qs0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;self=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165941"><span class="hs-identifier hs-type">self</span></a></span><span>
</span><span id="line-463"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;t   =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165942"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165947"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-466"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span> </span><span id="local-6989586621682165953"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682165953"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682165954"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165954"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Maybe (ProjOrigin, AmbiguousQName)
forall a. IsProjP a =&gt; a -&gt; Maybe (ProjOrigin, AmbiguousQName)
</span><a href="Agda.Syntax.Abstract.Name.html#isProjP"><span class="hs-identifier hs-var">A.isProjP</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682165956"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682165956"><span class="hs-identifier hs-var">o'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165957"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682165957"><span class="hs-identifier hs-var">ambP</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>            </span><span class="hs-comment">-- We assume here that neither @o@ nor @o'@ can be @ProjSystem@.</span><span>
</span><span id="line-469"></span><span>            </span><span class="annot"><span class="annottext">Bool
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682165953"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin -&gt; ProjOrigin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682165956"><span class="hs-identifier hs-var">o'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(WriterT [ProblemEq] (TCMT IO) ()
 -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="annot"><span class="annottext">(WriterT [ProblemEq] (TCMT IO) ()
 -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165862"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>              </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; [Char] -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;p0 = &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-471"></span><span>              </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; [Char] -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getRange p0 = &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>              </span><span class="annot"><span class="annottext">Warning -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; Warning -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
-&gt; ProjOrigin -&gt; NamedArg DeBruijnPattern -&gt; ProjOrigin -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#WithClauseProjectionFixityMismatch"><span class="hs-identifier hs-var">WithClauseProjectionFixityMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682165956"><span class="hs-identifier hs-var">o'</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682165947"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682165953"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-473"></span><span>            </span><span class="hs-comment">-- Andreas, 2016-12-28, issue #2360:</span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-comment">-- We disambiguate the projection in the with clause</span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-comment">-- to the projection in the parent clause.</span><span>
</span><span id="line-476"></span><span>            </span><span id="local-6989586621682165961"><span class="annot"><a href="#local-6989586621682165961"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM QName -&gt; WriterT [ProblemEq] (TCMT IO) QName
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM QName -&gt; WriterT [ProblemEq] (TCMT IO) QName)
-&gt; TCM QName -&gt; WriterT [ProblemEq] (TCMT IO) QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM QName
forall (m :: * -&gt; *).
(HasCallStack, HasConstInfo m) =&gt;
QName -&gt; m QName
</span><a href="Agda.TypeChecking.Monad.Signature.html#getOriginalProjection"><span class="hs-identifier hs-var">getOriginalProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165954"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-477"></span><span>            </span><span id="local-6989586621682165963"><span class="annot"><a href="#local-6989586621682165963"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#existsM"><span class="hs-identifier hs-type">existsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#getAmbiguous"><span class="hs-identifier hs-type">getAmbiguous</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165957"><span class="hs-identifier hs-type">ambP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682165966"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165966"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool)
-&gt; TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165961"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe QName -&gt; Bool)
-&gt; (Maybe Projection -&gt; Maybe QName) -&gt; Maybe Projection -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Projection -&gt; QName) -&gt; Maybe Projection -&gt; Maybe QName
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Projection -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projOrig"><span class="hs-identifier hs-var">projOrig</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Projection -&gt; Bool)
-&gt; TCMT IO (Maybe Projection) -&gt; TCM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO (Maybe Projection)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe Projection)
</span><a href="Agda.TypeChecking.Monad.Signature.html#isProjection"><span class="hs-identifier hs-var">isProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682165966"><span class="hs-identifier hs-var">d'</span></a></span><span>
</span><span id="line-478"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682165963"><span class="hs-identifier hs-type">found</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682165970"><span class="hs-identifier hs-type">mismatch</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682165971"><span class="annot"><a href="#local-6989586621682165971"><span class="hs-identifier hs-var">self1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165972"><span class="annot"><a href="#local-6989586621682165972"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165973"><span class="annot"><a href="#local-6989586621682165973"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>                </span><span id="local-6989586621682165974"><span class="annot"><a href="#local-6989586621682165974"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165942"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-481"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165976"><span class="annot"><a href="#local-6989586621682165976"><span class="hs-identifier hs-var">self1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682165977"><span class="annot"><a href="#local-6989586621682165977"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#projectTyped"><span class="hs-identifier hs-type">projectTyped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165941"><span class="hs-identifier hs-type">self</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165974"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165953"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165961"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-482"></span><span>                </span><span class="hs-comment">-- Andreas, 2016-01-21, issue #1791</span><span>
</span><span id="line-483"></span><span>                </span><span class="hs-comment">-- The type of a field might start with hidden quantifiers.</span><span>
</span><span id="line-484"></span><span>                </span><span class="hs-comment">-- So we may have to insert more implicit patterns here.</span><span>
</span><span id="line-485"></span><span>                </span><span id="local-6989586621682165980"><span class="annot"><a href="#local-6989586621682165980"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatternsT"><span class="hs-identifier hs-type">insertImplicitPatternsT</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165945"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165977"><span class="hs-identifier hs-type">t1</span></a></span><span>
</span><span id="line-486"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682165976"><span class="hs-identifier hs-type">self1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682165977"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682165980"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>              </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165971"><span class="hs-identifier hs-type">self1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165972"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165973"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165948"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-488"></span><span>          </span><span class="annot"><span class="annottext">Maybe (ProjOrigin, AmbiguousQName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-comment">-- We can safely strip dots from variables. The unifier will put them back when required.</span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165982"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165982"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165984"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682165984"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-492"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Var"><span class="hs-identifier hs-type">A.Var</span></a></span><span> </span><span id="local-6989586621682165986"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682165986"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-var">unScope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682165984"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; NamedArg Pattern -&gt; NamedArg Pattern
</span><a href="#local-6989586621682165905"><span class="hs-identifier hs-var">setVarArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165982"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern -&gt; NamedArg Pattern
forall a b. NamedArg a -&gt; b -&gt; NamedArg b
</span><a href="Agda.Syntax.Common.html#setNamedArg"><span class="hs-identifier hs-var">setNamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; NamedArg Pattern) -&gt; Pattern -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Pattern
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Pattern) -&gt; BindName -&gt; Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; BindName
</span><a href="Agda.Syntax.Abstract.html#mkBindName"><span class="hs-identifier hs-var">A.mkBindName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682165986"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-494"></span><span>            </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165982"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165991"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165991"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-497"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; NamedArg Pattern -&gt; NamedArg Pattern
</span><a href="#local-6989586621682165905"><span class="hs-identifier hs-var">setVarArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165991"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165991"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682165993"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165993"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; NamedArg Pattern -&gt; NamedArg Pattern
</span><a href="#local-6989586621682165905"><span class="hs-identifier hs-var">setVarArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165993"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682165993"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span> </span><span id="local-6989586621682165996"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682165996"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682165997"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165997"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-505"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682165998"><span class="annot"><a href="#local-6989586621682165998"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; WriterT [ProblemEq] (TCMT IO) (Dom Type, Abs Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
Type -&gt; m (Dom Type, Abs Type)
</span><a href="Agda.TypeChecking.Telescope.html#mustBePi"><span class="hs-identifier hs-var">mustBePi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165942"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-506"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165949"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682165997"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165998"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-507"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682165997"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-508"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682166000"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166000"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PatOVar"><span class="hs-identifier hs-type">PatOVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; PatOrigin
</span><a href="Agda.Syntax.Internal.html#patOrigin"><span class="hs-identifier hs-var">patOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682165996"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-509"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166000"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>            </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; NamedArg Pattern
</span><a href="#local-6989586621682166003"><span class="hs-identifier hs-var">makeWildP</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165997"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>        </span><span id="local-6989586621682166004"><span class="annot"><span class="annottext">q' :: DeBruijnPattern
</span><a href="#local-6989586621682166004"><span class="hs-identifier hs-var">q'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682166006"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166006"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682166007"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682166007"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682166008"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-513"></span><span>         </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-514"></span><span>           </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;parent pattern is constructor &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ConHead -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166006"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-515"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682166009"><span class="annot"><a href="#local-6989586621682166009"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682166010"><span class="annot"><a href="#local-6989586621682166010"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; WriterT [ProblemEq] (TCMT IO) (Dom Type, Abs Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
Type -&gt; m (Dom Type, Abs Type)
</span><a href="Agda.TypeChecking.Telescope.html#mustBePi"><span class="hs-identifier hs-var">mustBePi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165942"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-516"></span><span>         </span><span class="hs-comment">-- The type of the current pattern is a datatype.</span><span>
</span><span id="line-517"></span><span>         </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682166011"><span class="annot"><a href="#local-6989586621682166011"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682166012"><span class="annot"><a href="#local-6989586621682166012"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166009"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166015"><span class="annot"><a href="#local-6989586621682166015"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682166012"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-519"></span><span>         </span><span class="hs-comment">-- Get the original constructor and field names.</span><span>
</span><span id="line-520"></span><span>         </span><span id="local-6989586621682166017"><span class="annot"><a href="#local-6989586621682166017"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">either</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`withRangeOf`</span></span><span> </span><span class="annot"><span class="hs-identifier">c</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#getConForm"><span class="hs-identifier hs-type">getConForm</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166006"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165949"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>          </span><span class="hs-comment">-- Andreas, 2015-07-07 Issue 1606.</span><span>
</span><span id="line-525"></span><span>          </span><span class="hs-comment">-- Agda sometimes changes a record of dot patterns into a dot pattern,</span><span>
</span><span id="line-526"></span><span>          </span><span class="hs-comment">-- so the user should be allowed to do likewise.</span><span>
</span><span id="line-527"></span><span>          </span><span class="hs-comment">-- Jesper, 2017-11-16. This is now also allowed for data constructors.</span><span>
</span><span id="line-528"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span> </span><span id="local-6989586621682166022"><span class="annot"><span class="annottext">PatInfo
</span><a href="#local-6989586621682166022"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682166023"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682166023"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-529"></span><span>            </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatInfo -&gt; Expr -&gt; Pattern
forall e. PatInfo -&gt; e -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-var">A.DotP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><a href="#local-6989586621682166022"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682166023"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166004"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682166009"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-530"></span><span>            </span><span id="local-6989586621682166024"><span class="annot"><a href="#local-6989586621682166024"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-531"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; AppView
</span><a href="Agda.Syntax.Abstract.Views.html#appView"><span class="hs-identifier hs-var">appView</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682166023"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-comment">-- If dot-pattern is an application of the constructor, try to preserve the</span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-comment">-- arguments.</span><span>
</span><span id="line-534"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#Application"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Con"><span class="hs-identifier hs-type">A.Con</span></a></span><span> </span><span id="local-6989586621682166028"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166028"><span class="hs-identifier hs-var">cs'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682166029"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682166029"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>                  </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) Bool
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool)
-&gt; TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166017"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; AmbiguousQName -&gt; TCM Bool
</span><a href="Agda.TypeChecking.With.html#elemConForms"><span class="hs-operator hs-var">`elemConForms`</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166028"><span class="hs-identifier hs-var">cs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-536"></span><span>                  </span><span class="annot"><span class="annottext">[NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern]
 -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg Expr -&gt; NamedArg Pattern)
-&gt; [NamedArg Expr] -&gt; [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((NamedArg Expr -&gt; NamedArg Pattern)
 -&gt; [NamedArg Expr] -&gt; [NamedArg Pattern])
-&gt; ((Expr -&gt; Pattern) -&gt; NamedArg Expr -&gt; NamedArg Pattern)
-&gt; (Expr -&gt; Pattern)
-&gt; [NamedArg Expr]
-&gt; [NamedArg Pattern]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Named NamedName Expr -&gt; Named NamedName Pattern)
-&gt; NamedArg Expr -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Named NamedName Expr -&gt; Named NamedName Pattern)
 -&gt; NamedArg Expr -&gt; NamedArg Pattern)
-&gt; ((Expr -&gt; Pattern)
    -&gt; Named NamedName Expr -&gt; Named NamedName Pattern)
-&gt; (Expr -&gt; Pattern)
-&gt; NamedArg Expr
-&gt; NamedArg Pattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Pattern)
-&gt; Named NamedName Expr -&gt; Named NamedName Pattern
forall a b. (a -&gt; b) -&gt; Named NamedName a -&gt; Named NamedName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatInfo -&gt; Expr -&gt; Pattern
forall e. PatInfo -&gt; e -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-var">A.DotP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><a href="#local-6989586621682166022"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682166029"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-537"></span><span>                </span><span class="annot"><span class="annottext">AppView
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern]
 -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg Pattern)
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Named NamedName Pattern
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Named NamedName Pattern
-&gt; NamedArg DeBruijnPattern -&gt; NamedArg Pattern
forall a b. a -&gt; Arg b -&gt; Arg a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-538"></span><span>            </span><span class="annot"><a href="#local-6989586621682166033"><span class="hs-identifier hs-type">stripConP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166011"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166015"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166010"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166017"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOCon"><span class="hs-identifier hs-type">ConOCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166008"><span class="hs-identifier hs-type">qs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166024"><span class="hs-identifier hs-type">ps'</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>          </span><span class="hs-comment">-- Andreas, 2016-12-29, issue #2363.</span><span>
</span><span id="line-541"></span><span>          </span><span class="hs-comment">-- Allow _ to stand for the corresponding parent pattern.</span><span>
</span><span id="line-542"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>            </span><span class="hs-comment">-- Andreas, 2017-10-13, issue #2803:</span><span>
</span><span id="line-544"></span><span>            </span><span class="hs-comment">-- Delete the name, since it can confuse insertImplicitPattern.</span><span>
</span><span id="line-545"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166035"><span class="annot"><span class="annottext">ps' :: [NamedArg Pattern]
</span><a href="#local-6989586621682166035"><span class="hs-identifier hs-var hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg Pattern)
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Named NamedName Pattern
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Named NamedName Pattern
-&gt; NamedArg DeBruijnPattern -&gt; NamedArg Pattern
forall a b. a -&gt; Arg b -&gt; Arg a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-546"></span><span>            </span><span class="annot"><span class="annottext">QName
-&gt; Args
-&gt; Abs Type
-&gt; ConHead
-&gt; ConOrigin
-&gt; [NamedArg DeBruijnPattern]
-&gt; [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682166033"><span class="hs-identifier hs-var">stripConP</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166011"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166015"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682166010"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166017"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConOCon"><span class="hs-identifier hs-var">ConOCon</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682166035"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>          </span><span class="hs-comment">-- Jesper, 2018-05-13, issue #2998.</span><span>
</span><span id="line-549"></span><span>          </span><span class="hs-comment">-- We also allow turning a constructor pattern into a variable.</span><span>
</span><span id="line-550"></span><span>          </span><span class="hs-comment">-- In general this is not type-safe since the types of some variables</span><span>
</span><span id="line-551"></span><span>          </span><span class="hs-comment">-- in the constructor pattern may have changed, so we have to</span><span>
</span><span id="line-552"></span><span>          </span><span class="hs-comment">-- re-check these solutions when checking the with clause (see LHS.hs)</span><span>
</span><span id="line-553"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span> </span><span id="local-6989586621682166036"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682166036"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-554"></span><span>            </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Pattern
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682166036"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166004"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682166009"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-555"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166037"><span class="annot"><span class="annottext">ps' :: [NamedArg Pattern]
</span><a href="#local-6989586621682166037"><span class="hs-identifier hs-var hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg Pattern)
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Named NamedName Pattern
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Named NamedName Pattern
-&gt; NamedArg DeBruijnPattern -&gt; NamedArg Pattern
forall a b. a -&gt; Arg b -&gt; Arg a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><span class="annottext">QName
-&gt; Args
-&gt; Abs Type
-&gt; ConHead
-&gt; ConOrigin
-&gt; [NamedArg DeBruijnPattern]
-&gt; [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682166033"><span class="hs-identifier hs-var">stripConP</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166011"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166015"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682166010"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166017"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConOCon"><span class="hs-identifier hs-var">ConOCon</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682166037"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166038"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166038"><span class="hs-identifier hs-var">ambC</span></a></span></span><span> </span><span id="local-6989586621682166039"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682166039"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-559"></span><span>            </span><span class="hs-comment">-- Check whether the with-clause constructor can be (possibly trivially)</span><span>
</span><span id="line-560"></span><span>            </span><span class="hs-comment">-- disambiguated to be equal to the parent-clause constructor.</span><span>
</span><span id="line-561"></span><span>            </span><span class="hs-comment">-- Andreas, 2017-08-13, herein, ignore abstract constructors.</span><span>
</span><span id="line-562"></span><span>            </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) Bool
-&gt; WriterT [ProblemEq] (TCMT IO) ()
-&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool)
-&gt; TCM Bool -&gt; WriterT [ProblemEq] (TCMT IO) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166017"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; AmbiguousQName -&gt; TCM Bool
</span><a href="Agda.TypeChecking.With.html#elemConForms"><span class="hs-operator hs-var">`elemConForms`</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166038"><span class="hs-identifier hs-var">ambC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-563"></span><span>            </span><span class="hs-comment">-- Strip the subpatterns ps' and then continue.</span><span>
</span><span id="line-564"></span><span>            </span><span class="annot"><span class="annottext">QName
-&gt; Args
-&gt; Abs Type
-&gt; ConHead
-&gt; ConOrigin
-&gt; [NamedArg DeBruijnPattern]
-&gt; [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682166033"><span class="hs-identifier hs-var">stripConP</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166011"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166015"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682166010"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166017"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConOCon"><span class="hs-identifier hs-var">ConOCon</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166008"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682166039"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166041"><span class="annot"><span class="annottext">[FieldAssignment' Pattern]
</span><a href="#local-6989586621682166041"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) (Maybe RecordData)
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
-&gt; (RecordData -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM (Maybe RecordData)
-&gt; WriterT [ProblemEq] (TCMT IO) (Maybe RecordData)
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe RecordData)
 -&gt; WriterT [ProblemEq] (TCMT IO) (Maybe RecordData))
-&gt; TCM (Maybe RecordData)
-&gt; WriterT [ProblemEq] (TCMT IO) (Maybe RecordData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Maybe RecordData)
forall (m :: * -&gt; *).
(HasCallStack, HasConstInfo m) =&gt;
QName -&gt; m (Maybe RecordData)
</span><a href="Agda.TypeChecking.Records.html#isRecord"><span class="hs-identifier hs-var">isRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166011"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var">mismatch</span></a></span><span> </span><span class="annot"><span class="annottext">((RecordData -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
 -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; (RecordData -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682166044"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682166044"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-567"></span><span>            </span><span id="local-6989586621682166045"><span class="annot"><a href="#local-6989586621682166045"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. TCM a -&gt; WriterT [ProblemEq] (TCMT IO) a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM [NamedArg Pattern]
 -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; TCM [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConOrigin
-&gt; QName
-&gt; (Name -&gt; Pattern)
-&gt; [FieldAssignment' Pattern]
-&gt; [Arg Name]
-&gt; TCM [NamedArg Pattern]
forall a.
HasRange a =&gt;
ConOrigin
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; TCM [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFieldsFail"><span class="hs-identifier hs-var">insertMissingFieldsFail</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-var">ConORec</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166011"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Name -&gt; Pattern
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Name -&gt; Pattern) -&gt; Pattern -&gt; Name -&gt; Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldAssignment' Pattern]
</span><a href="#local-6989586621682166041"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-568"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom Name -&gt; Arg Name) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Name -&gt; Arg Name
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom Name] -&gt; [Arg Name]) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var">recordFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682166044"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>            </span><span class="annot"><a href="#local-6989586621682166033"><span class="hs-identifier hs-type">stripConP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166011"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166015"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166010"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166017"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-type">ConORec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166008"><span class="hs-identifier hs-type">qs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166045"><span class="hs-identifier hs-type">ps'</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>          </span><span id="local-6989586621682166051"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682166051"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span> </span><span id="local-6989586621682166053"><span class="annot"><span class="annottext">PatInfo
</span><a href="#local-6989586621682166053"><span class="hs-identifier hs-var">pi'</span></a></span></span><span> </span><span id="local-6989586621682166054"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166054"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span id="local-6989586621682166055"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682166055"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>             </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-573"></span><span>               </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;stripWithClausePatterns: encountered pattern synonym &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682166051"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-574"></span><span>             </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>          </span><span id="local-6989586621682166056"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682166056"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>           </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-578"></span><span>             </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc) -&gt; [Char] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;with clause pattern is  &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682166056"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-579"></span><span>           </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166058"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166058"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165949"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-582"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166060"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166060"><span class="hs-identifier hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166058"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166060"><span class="hs-identifier hs-var">lit'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166058"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-583"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern])
-&gt; Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166058"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>          </span><span id="local-6989586621682166062"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682166062"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span> </span><span id="local-6989586621682166063"><span class="annot"><span class="annottext">PatInfo
</span><a href="#local-6989586621682166063"><span class="hs-identifier hs-var">pi'</span></a></span></span><span> </span><span id="local-6989586621682166064"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166064"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682166065"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682166065"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>             </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; WriterT [ProblemEq] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-587"></span><span>               </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;stripWithClausePatterns: encountered pattern synonym &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682166062"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-588"></span><span>             </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>          </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var">mismatch</span></a></span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-592"></span><span>        </span><span id="local-6989586621682165989"><span class="annot"><span class="annottext">recurse :: Term -&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682165989"><span class="hs-identifier hs-var hs-var">recurse</span></a></span></span><span> </span><span id="local-6989586621682166066"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166066"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166182"><span class="annot"><span class="annottext">piOrPathApplyM :: Type -&gt; Term -&gt; m (Elims, Type)
</span><a href="#local-6989586621682166182"><span class="hs-identifier hs-var hs-var hs-var">piOrPathApplyM</span></a></span></span><span> </span><span id="local-6989586621682166183"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682166183"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682166184"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166184"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-594"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682166185"><span class="annot"><a href="#local-6989586621682166185"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682166186"><span class="annot"><a href="#local-6989586621682166186"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682166187"><span class="annot"><a href="#local-6989586621682166187"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; m (TelV Type, Boundary)
forall (m :: * -&gt; *).
PureTCM m =&gt;
Int -&gt; Type -&gt; m (TelV Type, Boundary)
</span><a href="Agda.TypeChecking.Telescope.html#telViewUpToPathBoundary%27"><span class="hs-identifier hs-var">telViewUpToPathBoundary'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682166183"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-595"></span><span>                </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166185"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-596"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#teleElims"><span class="hs-identifier hs-type">teleElims</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166185"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166187"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#subst"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621682166184"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166186"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682166191"><span class="annot"><a href="#local-6989586621682166191"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682166192"><span class="annot"><a href="#local-6989586621682166192"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; WriterT [ProblemEq] (TCMT IO) (Elims, Type)
forall {m :: * -&gt; *}. PureTCM m =&gt; Type -&gt; Term -&gt; m (Elims, Type)
</span><a href="#local-6989586621682166182"><span class="hs-identifier hs-var">piOrPathApplyM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682165942"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166066"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-598"></span><span>          </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682165941"><span class="hs-identifier hs-type">self</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-type">`applyE`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166191"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682166192"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165945"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682165948"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>        </span><span class="annot"><a href="#local-6989586621682165970"><span class="hs-identifier hs-type">mismatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682164459"><span class="annot"><a href="#local-6989586621682164459"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682164460"><span class="annot"><a href="#local-6989586621682164460"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#MonadAddContext"><span class="hs-identifier hs-type">MonadAddContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682164459"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682164459"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682164459"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682164460"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-601"></span><span>        </span><span id="local-6989586621682165970"><span class="annot"><span class="annottext">mismatch :: forall (m :: * -&gt; *) a. (MonadAddContext m, MonadTCError m) =&gt; m a
</span><a href="#local-6989586621682165970"><span class="hs-identifier hs-var hs-var">mismatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; m a -&gt; m a
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682165862"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m a) -&gt; TypeError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-602"></span><span>          </span><span class="annot"><span class="annottext">Pattern -&gt; NamedArg DeBruijnPattern -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WithClausePatternMismatch"><span class="hs-identifier hs-var">WithClausePatternMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682165944"><span class="hs-identifier hs-var">p0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682165947"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-comment">-- Make a WildP, keeping arg. info.</span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><a href="#local-6989586621682166003"><span class="hs-identifier hs-type">makeWildP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span id="local-6989586621682166003"><span class="annot"><span class="annottext">makeWildP :: NamedArg Pattern -&gt; NamedArg Pattern
</span><a href="#local-6989586621682166003"><span class="hs-identifier hs-var hs-var">makeWildP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Pattern) -&gt; NamedArg Pattern -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; NamedArg a -&gt; NamedArg b
</span><a href="Agda.Syntax.Common.html#updateNamedArg"><span class="hs-identifier hs-var">updateNamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">((Pattern -&gt; Pattern) -&gt; NamedArg Pattern -&gt; NamedArg Pattern)
-&gt; (Pattern -&gt; Pattern) -&gt; NamedArg Pattern -&gt; NamedArg Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Pattern -&gt; Pattern
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Pattern -&gt; Pattern) -&gt; Pattern -&gt; Pattern -&gt; Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><a href="Agda.Syntax.Info.html#patNoRange"><span class="hs-identifier hs-var">patNoRange</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-comment">-- case I.ConP / A.ConP</span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><a href="#local-6989586621682166033"><span class="hs-identifier hs-type">stripConP</span></a></span><span>
</span><span id="line-610"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="hs-comment">-- Data type name of this constructor pattern.</span><span>
</span><span id="line-611"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Data type arguments of this constructor pattern.</span><span>
</span><span id="line-612"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- Type the remaining patterns eliminate.</span><span>
</span><span id="line-613"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span>     </span><span class="hs-comment">-- Constructor of this pattern.</span><span>
</span><span id="line-614"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span>     </span><span class="hs-comment">-- Constructor info of this pattern (constructor/record).</span><span>
</span><span id="line-615"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Argument patterns (parent clause).</span><span>
</span><span id="line-616"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Argument patterns (with clause).</span><span>
</span><span id="line-617"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Stripped patterns.</span><span>
</span><span id="line-618"></span><span>        </span><span id="local-6989586621682166033"><span class="annot"><span class="annottext">stripConP :: QName
-&gt; Args
-&gt; Abs Type
-&gt; ConHead
-&gt; ConOrigin
-&gt; [NamedArg DeBruijnPattern]
-&gt; [NamedArg Pattern]
-&gt; WriterT [ProblemEq] (TCMT IO) [NamedArg Pattern]
</span><a href="#local-6989586621682166033"><span class="hs-identifier hs-var hs-var">stripConP</span></a></span></span><span> </span><span id="local-6989586621682166204"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166204"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682166205"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166205"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682166206"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682166206"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682166207"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166207"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682166208"><span class="annot"><span class="annottext">ConOrigin
</span><a href="#local-6989586621682166208"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682166209"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166209"><span class="hs-identifier hs-var">qs'</span></a></span></span><span> </span><span id="local-6989586621682166210"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682166210"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>          </span><span class="hs-comment">-- Get the type and number of parameters of the constructor.</span><span>
</span><span id="line-621"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682166213"><span class="annot"><a href="#local-6989586621682166213"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#conPars"><span class="hs-identifier hs-var">conPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682166217"><span class="annot"><a href="#local-6989586621682166217"><span class="hs-identifier hs-var">np</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; WriterT [ProblemEq] (TCMT IO) Definition
forall (m :: * -&gt; *).
(HasCallStack, HasConstInfo m) =&gt;
ConHead -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConInfo"><span class="hs-identifier hs-var">getConInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166207"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-622"></span><span>          </span><span class="hs-comment">-- Compute the argument telescope for the constructor</span><span>
</span><span id="line-623"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166219"><span class="annot"><a href="#local-6989586621682166219"><span class="hs-identifier hs-var hs-var">ct'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682166213"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Args -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#piApply"><span class="hs-operator hs-var">`piApply`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Args -&gt; Args
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166217"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166205"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-624"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682166221"><span class="annot"><a href="#local-6989586621682166221"><span class="hs-identifier hs-var">tel'</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewPath"><span class="hs-identifier hs-type">telViewPath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166219"><span class="hs-identifier hs-type">ct'</span></a></span><span>
</span><span id="line-625"></span><span>          </span><span class="hs-comment">-- (TelV tel' _, _boundary) &lt;- liftTCM $ telViewPathBoundary ct'</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-628"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;ct  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166213"><span class="hs-identifier hs-type">ct</span></a></span><span>
</span><span id="line-629"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ct' = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166219"><span class="hs-identifier hs-type">ct'</span></a></span><span>
</span><span id="line-630"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;np  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682166217"><span class="hs-identifier hs-type">np</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;us  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166205"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;us' = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">take</span></span><span> </span><span class="annot"><a href="#local-6989586621682166217"><span class="hs-identifier hs-type">np</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166205"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>          </span><span class="hs-comment">-- TODO Andrea: preserve IApplyP patterns in v, see _boundary?</span><span>
</span><span id="line-636"></span><span>          </span><span class="hs-comment">-- Compute the new type</span><span>
</span><span id="line-637"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166224"><span class="annot"><a href="#local-6989586621682166224"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConOrigin -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166207"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="#local-6989586621682166208"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Arg Term -&gt; Elim' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682166227"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166228"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682166228"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166228"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682166227"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682166227"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="annot"><span class="annottext">Named NamedName DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; [NamedArg DeBruijnPattern] -&gt; [(Int, NamedArg DeBruijnPattern)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166209"><span class="hs-identifier hs-var">qs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166209"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-638"></span><span>              </span><span id="local-6989586621682166230"><span class="annot"><a href="#local-6989586621682166230"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166221"><span class="hs-identifier hs-var">tel'</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; SubstArg Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-identifier hs-var">absApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Abs Type -&gt; Abs Type
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166221"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682166206"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Type
</span><a href="#local-6989586621682166224"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-639"></span><span>              </span><span id="local-6989586621682166233"><span class="annot"><a href="#local-6989586621682166233"><span class="hs-identifier hs-var hs-var">self'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166221"><span class="hs-identifier hs-var">tel'</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Term -&gt; Term
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; Term
forall t. Apply t =&gt; t -&gt; Term -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply1"><span class="hs-identifier hs-var">apply1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; Term
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166221"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682165941"><span class="hs-identifier hs-var">self</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166224"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="hs-comment">-- Issue 1546</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.strip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-642"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;inserting implicit&quot;</span></span><span>
</span><span id="line-643"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682166210"><span class="hs-identifier hs-type">ps'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682165945"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166230"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-645"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>          </span><span class="hs-comment">-- Insert implicit patterns (just for the constructor arguments)</span><span>
</span><span id="line-648"></span><span>          </span><span id="local-6989586621682166236"><span class="annot"><a href="#local-6989586621682166236"><span class="hs-identifier hs-var">psi'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatterns"><span class="hs-identifier hs-type">insertImplicitPatterns</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166210"><span class="hs-identifier hs-type">ps'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166221"><span class="hs-identifier hs-type">tel'</span></a></span><span>
</span><span id="line-649"></span><span>          </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166236"><span class="hs-identifier hs-type">psi'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166221"><span class="hs-identifier hs-type">tel'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-650"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#WrongNumberOfConstructorArguments"><span class="hs-identifier hs-type">WrongNumberOfConstructorArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166207"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166221"><span class="hs-identifier hs-type">tel'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166236"><span class="hs-identifier hs-type">psi'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>          </span><span class="hs-comment">-- Andreas, Ulf, 2016-06-01, Ulf's variant at issue #679</span><span>
</span><span id="line-653"></span><span>          </span><span class="hs-comment">-- Since instantiating the type with a constructor pattern</span><span>
</span><span id="line-654"></span><span>          </span><span class="hs-comment">-- can reveal more hidden arguments, we need to insert them here.</span><span>
</span><span id="line-655"></span><span>          </span><span id="local-6989586621682166239"><span class="annot"><a href="#local-6989586621682166239"><span class="hs-identifier hs-var">psi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatternsT"><span class="hs-identifier hs-type">insertImplicitPatternsT</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682166236"><span class="hs-identifier hs-type">psi'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682165945"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682166230"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>          </span><span class="hs-comment">-- Keep going</span><span>
</span><span id="line-658"></span><span>          </span><span class="annot"><a href="#local-6989586621682165887"><span class="hs-identifier hs-type">strip</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166233"><span class="hs-identifier hs-type">self'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166230"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166239"><span class="hs-identifier hs-type">psi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682166209"><span class="hs-identifier hs-type">qs'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682165948"><span class="hs-identifier hs-type">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="annot"><span class="hs-comment">-- | Is the first name equal to the 'constructorForm' of any disambiguation of the second name?</span></span><span>
</span><span id="line-661"></span><span class="annot"><a href="Agda.TypeChecking.With.html#elemConForms"><span class="hs-identifier hs-type">elemConForms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbiguousQName"><span class="hs-identifier hs-type">AmbiguousQName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-662"></span><span id="elemConForms"><span class="annot"><span class="annottext">elemConForms :: ConHead -&gt; AmbiguousQName -&gt; TCM Bool
</span><a href="Agda.TypeChecking.With.html#elemConForms"><span class="hs-identifier hs-var hs-var">elemConForms</span></a></span></span><span> </span><span id="local-6989586621682166241"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166241"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682166242"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166242"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>  </span><span class="annot"><span class="annottext">NonEmpty QName -&gt; (QName -&gt; TCM Bool) -&gt; TCM Bool
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable f, Monad m) =&gt;
f a -&gt; (a -&gt; m Bool) -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#existsM"><span class="hs-identifier hs-var">existsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AmbiguousQName -&gt; NonEmpty QName
</span><a href="Agda.Syntax.Abstract.Name.html#getAmbiguous"><span class="hs-identifier hs-var">getAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682166242"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682166243"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166243"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><span class="annottext">HasCallStack =&gt; QName -&gt; TCM (Either SigError ConHead)
QName -&gt; TCM (Either SigError ConHead)
</span><a href="Agda.TypeChecking.Datatypes.html#getConForm"><span class="hs-identifier hs-var">getConForm</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166243"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Either SigError ConHead)
-&gt; (Either SigError ConHead -&gt; Bool) -&gt; TCM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-665"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-666"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682166245"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166245"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166241"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConHead -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166245"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-comment">-- | Construct the display form for a with function. It will display</span><span>
</span><span id="line-669"></span><span class="hs-comment">--   applications of the with function as applications to the original function.</span><span>
</span><span id="line-670"></span><span class="hs-comment">--   For instance,</span><span>
</span><span id="line-671"></span><span class="hs-comment">--</span><span>
</span><span id="line-672"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-673"></span><span class="hs-comment">--     aux a b c</span><span>
</span><span id="line-674"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-675"></span><span class="hs-comment">--</span><span>
</span><span id="line-676"></span><span class="hs-comment">--   as</span><span>
</span><span id="line-677"></span><span class="hs-comment">--</span><span>
</span><span id="line-678"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-679"></span><span class="hs-comment">--     f (suc a) (suc b) | c</span><span>
</span><span id="line-680"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-681"></span><span class="annot"><a href="Agda.TypeChecking.With.html#withDisplayForm"><span class="hs-identifier hs-type">withDisplayForm</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-683"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ The name of parent function.</span></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-685"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ The name of the @with@-function.</span></span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>
</span><span id="line-687"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ __@&#916;&#8321;@__     The arguments of the @with@ function before the @with@ expressions.</span></span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>
</span><span id="line-689"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ __@&#916;&#8322;@__     The arguments of the @with@ function after the @with@ expressions.</span></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>
</span><span id="line-691"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ __@n@__      The number of @with@ expressions.</span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-693"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ __@qs@__      The parent patterns.</span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>
</span><span id="line-695"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ __@perm@__    Permutation to split into needed and unneeded vars.</span></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ __@lhsPerm@__ Permutation reordering the variables in parent patterns.</span></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForm"><span class="hs-identifier hs-type">DisplayForm</span></a></span><span>
</span><span id="line-699"></span><span id="withDisplayForm"><span class="annot"><span class="annottext">withDisplayForm :: QName
-&gt; QName
-&gt; Telescope
-&gt; Telescope
-&gt; Int
-&gt; [NamedArg DeBruijnPattern]
-&gt; Permutation
-&gt; Permutation
-&gt; TCM DisplayForm
</span><a href="Agda.TypeChecking.With.html#withDisplayForm"><span class="hs-identifier hs-var hs-var">withDisplayForm</span></a></span></span><span> </span><span id="local-6989586621682166247"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166247"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682166248"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166248"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682166249"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166249"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682166250"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166250"><span class="hs-identifier hs-var">delta2</span></a></span></span><span> </span><span id="local-6989586621682166251"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166251"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682166252"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166252"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621682166253"><span class="annot"><span class="annottext">perm :: Permutation
</span><a href="#local-6989586621682166253"><span class="hs-identifier hs-var">perm</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Permutation.html#Perm"><span class="hs-identifier hs-type">Perm</span></a></span><span> </span><span id="local-6989586621682166255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166255"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682166256"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682166256"><span class="hs-identifier hs-var">lhsPerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-comment">-- Compute the arity of the display form.</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166257"><span class="annot"><span class="annottext">arity0 :: Int
</span><a href="#local-6989586621682166257"><span class="hs-identifier hs-var hs-var hs-var">arity0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166251"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166249"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166250"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-comment">-- The currently free variables have to be added to the front.</span><span>
</span><span id="line-704"></span><span>  </span><span id="local-6989586621682166259"><span class="annot"><a href="#local-6989586621682166259"><span class="hs-identifier hs-var">topArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Args -&gt; Args
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166257"><span class="hs-identifier hs-var">arity0</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Args) -&gt; TCMT IO Args -&gt; TCMT IO Args
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Args
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Args
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextArgs"><span class="hs-identifier hs-var">getContextArgs</span></a></span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166261"><span class="annot"><a href="#local-6989586621682166261"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166259"><span class="hs-identifier hs-var">topArgs</span></a></span><span>
</span><span id="line-706"></span><span>      </span><span id="local-6989586621682166262"><span class="annot"><a href="#local-6989586621682166262"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166257"><span class="hs-identifier hs-var">arity0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166261"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-comment">-- Build the rhs of the display form.</span><span>
</span><span id="line-709"></span><span>  </span><span id="local-6989586621682166263"><span class="annot"><a href="#local-6989586621682166263"><span class="hs-identifier hs-var">wild</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#freshNoName_"><span class="hs-identifier hs-type">freshNoName_</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682166265"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682166265"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qualify_"><span class="hs-identifier hs-var">qualify_</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682166265"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Convert the parent patterns to terms.</span><span>
</span><span id="line-711"></span><span>      </span><span id="local-6989586621682166267"><span class="annot"><a href="#local-6989586621682166267"><span class="hs-identifier hs-var hs-var">tqs0</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; [Elim' DisplayTerm]
</span><a href="Agda.TypeChecking.With.html#patsToElims"><span class="hs-identifier hs-var">patsToElims</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166252"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="hs-comment">-- Build a substitution to replace the parent pattern vars</span><span>
</span><span id="line-713"></span><span>      </span><span class="hs-comment">-- by the pattern vars of the with-function.</span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682166269"><span class="annot"><a href="#local-6989586621682166269"><span class="hs-identifier hs-var">ys0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682166270"><span class="annot"><a href="#local-6989586621682166270"><span class="hs-identifier hs-var">ys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166249"><span class="hs-identifier hs-type">delta1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#permute"><span class="hs-identifier hs-type">permute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166253"><span class="hs-identifier hs-type">perm</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-type">downFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166255"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span id="local-6989586621682166271"><span class="annot"><a href="#local-6989586621682166271"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Maybe Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; [Int] -&gt; [Maybe Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682166269"><span class="hs-identifier hs-var">ys0</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Maybe Int] -&gt; [Maybe Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; [Maybe Int]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166251"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Maybe Int] -&gt; [Maybe Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; [Int] -&gt; [Maybe Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682166270"><span class="hs-identifier hs-var">ys1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>                   </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Maybe Int] -&gt; [Maybe Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; [Int] -&gt; [Maybe Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Maybe Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166255"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166261"><span class="hs-identifier hs-var">top</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-717"></span><span>      </span><span id="local-6989586621682166273"><span class="annot"><a href="#local-6989586621682166273"><span class="hs-identifier hs-var hs-var">rho</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Maybe Int] -&gt; Term -&gt; Substitution' Term
</span><a href="#local-6989586621682166274"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166261"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682166271"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166263"><span class="hs-identifier hs-var">wild</span></a></span><span>
</span><span id="line-718"></span><span>      </span><span id="local-6989586621682166275"><span class="annot"><a href="#local-6989586621682166275"><span class="hs-identifier hs-var hs-var">tqs</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [Elim' DisplayTerm])
-&gt; [Elim' DisplayTerm] -&gt; [Elim' DisplayTerm]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg [Elim' DisplayTerm])
</span><a href="#local-6989586621682166273"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' DisplayTerm]
</span><a href="#local-6989586621682166267"><span class="hs-identifier hs-var">tqs0</span></a></span><span>
</span><span id="line-719"></span><span>      </span><span class="hs-comment">-- Build the arguments to the with function.</span><span>
</span><span id="line-720"></span><span>      </span><span id="local-6989586621682166276"><span class="annot"><a href="#local-6989586621682166276"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' DisplayTerm) -&gt; Args -&gt; [Elim' DisplayTerm]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg DisplayTerm -&gt; Elim' DisplayTerm
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg DisplayTerm -&gt; Elim' DisplayTerm)
-&gt; (Arg Term -&gt; Arg DisplayTerm) -&gt; Arg Term -&gt; Elim' DisplayTerm
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Arg Term -&gt; Arg DisplayTerm
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DTerm"><span class="hs-identifier hs-var">DTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682166259"><span class="hs-identifier hs-var">topArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' DisplayTerm] -&gt; [Elim' DisplayTerm] -&gt; [Elim' DisplayTerm]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Elim' DisplayTerm]
</span><a href="#local-6989586621682166275"><span class="hs-identifier hs-var">tqs</span></a></span><span>
</span><span id="line-721"></span><span>      </span><span id="local-6989586621682166278"><span class="annot"><a href="#local-6989586621682166278"><span class="hs-identifier hs-var hs-var">withArgs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Term -&gt; [Term] -&gt; NonEmpty Term
forall a. List1 a -&gt; [a] -&gt; List1 a
</span><a href="Agda.Utils.List1.html#fromListSafe"><span class="hs-identifier hs-var">List1.fromListSafe</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; NonEmpty Term) -&gt; [Term] -&gt; NonEmpty Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- List is non-empty since n &gt;= 1</span><span>
</span><span id="line-722"></span><span>                     </span><span class="annot"><span class="annottext">(Int -&gt; Term) -&gt; [Int] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Term]) -&gt; [Int] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166251"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166250"><span class="hs-identifier hs-var">delta2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166251"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-723"></span><span>      </span><span id="local-6989586621682166280"><span class="annot"><a href="#local-6989586621682166280"><span class="hs-identifier hs-var hs-var">dt</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayTerm -&gt; List1 DisplayTerm -&gt; Elims -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DWithApp"><span class="hs-identifier hs-var">DWithApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; [Elim' DisplayTerm] -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DDef"><span class="hs-identifier hs-var">DDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166247"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim' DisplayTerm]
</span><a href="#local-6989586621682166276"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; NonEmpty Term -&gt; List1 DisplayTerm
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DTerm"><span class="hs-identifier hs-var">DTerm</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Term
</span><a href="#local-6989586621682166278"><span class="hs-identifier hs-var">withArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-comment">-- Build the lhs of the display form and finish.</span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-comment">-- @var 0@ is the pattern variable (hole).</span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166283"><span class="annot"><a href="#local-6989586621682166283"><span class="hs-identifier hs-var hs-var">display</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; DisplayTerm -&gt; DisplayForm
</span><a href="Agda.TypeChecking.Monad.Base.html#Display"><span class="hs-identifier hs-var">Display</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166262"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Arg Term -&gt; Elim' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; Term -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166285"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682166285"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166285"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166262"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DisplayTerm
</span><a href="#local-6989586621682166280"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-comment">-- Debug printing.</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682166286"><span class="annot"><a href="#local-6989586621682166286"><span class="hs-identifier hs-var hs-var">addFullCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166249"><span class="hs-identifier hs-var">delta1</span></a></span><span>
</span><span id="line-731"></span><span>                 </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; [[Char]] -&gt; TCMT IO Doc)
-&gt; [[Char]] -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; TCMT IO Doc -&gt; [[Char]] -&gt; TCMT IO Doc
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a. MonadAddContext m =&gt; [Char] -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; [Char]) -&gt; [[Char]]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166251"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; [Char]) -&gt; [[Char]]) -&gt; (Int -&gt; [Char]) -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682166289"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166289"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;w&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166289"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>                 </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682166250"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-733"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.display&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;withDisplayForm&quot;</span></span><span>
</span><span id="line-735"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-736"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;f      =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166247"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;aux    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166248"><span class="hs-identifier hs-type">aux</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;delta1 =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166249"><span class="hs-identifier hs-type">delta1</span></a></span><span>
</span><span id="line-739"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;delta2 =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166249"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166250"><span class="hs-identifier hs-type">delta2</span></a></span><span>
</span><span id="line-740"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;n      =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682166251"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;perm   =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682166253"><span class="hs-identifier hs-type">perm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;top    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="#local-6989586621682166286"><span class="hs-identifier hs-type">addFullCtx</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166259"><span class="hs-identifier hs-type">topArgs</span></a></span><span>
</span><span id="line-743"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;qs     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166252"><span class="hs-identifier hs-type">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;qsToTm =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166267"><span class="hs-identifier hs-type">tqs0</span></a></span><span> </span><span class="hs-comment">-- ctx would be permuted form of delta1 ++ delta2</span><span>
</span><span id="line-745"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ys     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682166271"><span class="hs-identifier hs-type">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;rho    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166273"><span class="hs-identifier hs-type">rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;qs[rho]=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="#local-6989586621682166286"><span class="hs-identifier hs-type">addFullCtx</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166275"><span class="hs-identifier hs-type">tqs</span></a></span><span>
</span><span id="line-748"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;dt     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="#local-6989586621682166286"><span class="hs-identifier hs-type">addFullCtx</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682166280"><span class="hs-identifier hs-type">dt</span></a></span><span>
</span><span id="line-749"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.display&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-752"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;raw    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682166283"><span class="hs-identifier hs-type">display</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682166283"><span class="hs-identifier hs-type">display</span></a></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-comment">-- Ulf, 2014-02-19: We need to rename the module parameters as well! (issue1035)</span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-comment">-- sub top ys wild = map term [0 .. m - 1] ++# raiseS (length qs)</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-10-28: Yes, but properly! (Issue 1407)</span><span>
</span><span id="line-760"></span><span>    </span><span id="local-6989586621682166274"><span class="annot"><span class="annottext">sub :: Int -&gt; [Maybe Int] -&gt; Term -&gt; Substitution' Term
</span><a href="#local-6989586621682166274"><span class="hs-identifier hs-var hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621682166291"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166291"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682166292"><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682166292"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621682166293"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166293"><span class="hs-identifier hs-var">wild</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution' Term
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-var">parallelS</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; Substitution' Term) -&gt; [Term] -&gt; Substitution' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Term) -&gt; [Int] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="#local-6989586621682166295"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166255"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166291"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-761"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-762"></span><span>        </span><span id="local-6989586621682166295"><span class="annot"><span class="annottext">term :: Int -&gt; Term
</span><a href="#local-6989586621682166295"><span class="hs-identifier hs-var hs-var">term</span></a></span></span><span> </span><span id="local-6989586621682166296"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166296"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; (Int -&gt; Term) -&gt; Maybe Int -&gt; Term
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166293"><span class="hs-identifier hs-var">wild</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Term) -&gt; Maybe Int -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; [Maybe Int] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-identifier hs-var">List.elemIndex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166296"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682166292"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">-- Andreas, 2014-12-05 refactored using numberPatVars</span><span>
</span><span id="line-765"></span><span class="hs-comment">-- Andreas, 2013-02-28 modeled after Coverage/Match/buildMPatterns</span><span>
</span><span id="line-766"></span><span class="annot"><a href="Agda.TypeChecking.With.html#patsToElims"><span class="hs-identifier hs-type">patsToElims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">I.Elim'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayTerm"><span class="hs-identifier hs-type">DisplayTerm</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-767"></span><span id="patsToElims"><span class="annot"><span class="annottext">patsToElims :: [NamedArg DeBruijnPattern] -&gt; [Elim' DisplayTerm]
</span><a href="Agda.TypeChecking.With.html#patsToElims"><span class="hs-identifier hs-var hs-var">patsToElims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Elim' DisplayTerm)
-&gt; [NamedArg DeBruijnPattern] -&gt; [Elim' DisplayTerm]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((NamedArg DeBruijnPattern -&gt; Elim' DisplayTerm)
 -&gt; [NamedArg DeBruijnPattern] -&gt; [Elim' DisplayTerm])
-&gt; (NamedArg DeBruijnPattern -&gt; Elim' DisplayTerm)
-&gt; [NamedArg DeBruijnPattern]
-&gt; [Elim' DisplayTerm]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg DeBruijnPattern -&gt; Elim' DisplayTerm
</span><a href="#local-6989586621682166299"><span class="hs-identifier hs-var">toElim</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg DeBruijnPattern -&gt; Elim' DisplayTerm)
-&gt; (NamedArg DeBruijnPattern -&gt; Arg DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; Elim' DisplayTerm
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern -&gt; Arg DeBruijnPattern
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Named NamedName DeBruijnPattern -&gt; DeBruijnPattern
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><a href="#local-6989586621682166299"><span class="hs-identifier hs-type">toElim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">I.Elim'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayTerm"><span class="hs-identifier hs-type">DisplayTerm</span></a></span><span>
</span><span id="line-770"></span><span>    </span><span id="local-6989586621682166299"><span class="annot"><span class="annottext">toElim :: Arg DeBruijnPattern -&gt; Elim' DisplayTerm
</span><a href="#local-6989586621682166299"><span class="hs-identifier hs-var hs-var">toElim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682166301"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682166301"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682166302"><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166302"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166302"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-771"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span> </span><span id="local-6989586621682166303"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682166303"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682166304"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166304"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' DisplayTerm
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">I.Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682166303"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166304"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-772"></span><span>      </span><span id="local-6989586621682166306"><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166306"><span class="hs-identifier hs-var">p</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arg DisplayTerm -&gt; Elim' DisplayTerm
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">I.Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg DisplayTerm -&gt; Elim' DisplayTerm)
-&gt; Arg DisplayTerm -&gt; Elim' DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; DisplayTerm -&gt; Arg DisplayTerm
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682166301"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(DisplayTerm -&gt; Arg DisplayTerm) -&gt; DisplayTerm -&gt; Arg DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166307"><span class="hs-identifier hs-var">toTerm</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166306"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="#local-6989586621682166308"><span class="hs-identifier hs-type">toTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayTerm"><span class="hs-identifier hs-type">DisplayTerm</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621682166308"><span class="annot"><span class="annottext">toTerms :: [NamedArg DeBruijnPattern] -&gt; [Arg DisplayTerm]
</span><a href="#local-6989586621682166308"><span class="hs-identifier hs-var hs-var">toTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Arg DisplayTerm)
-&gt; [NamedArg DeBruijnPattern] -&gt; [Arg DisplayTerm]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((NamedArg DeBruijnPattern -&gt; Arg DisplayTerm)
 -&gt; [NamedArg DeBruijnPattern] -&gt; [Arg DisplayTerm])
-&gt; (NamedArg DeBruijnPattern -&gt; Arg DisplayTerm)
-&gt; [NamedArg DeBruijnPattern]
-&gt; [Arg DisplayTerm]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; DisplayTerm)
-&gt; NamedArg DeBruijnPattern -&gt; Arg DisplayTerm
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Named NamedName DeBruijnPattern -&gt; DisplayTerm)
 -&gt; NamedArg DeBruijnPattern -&gt; Arg DisplayTerm)
-&gt; (Named NamedName DeBruijnPattern -&gt; DisplayTerm)
-&gt; NamedArg DeBruijnPattern
-&gt; Arg DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166307"><span class="hs-identifier hs-var">toTerm</span></a></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; DisplayTerm)
-&gt; (Named NamedName DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; Named NamedName DeBruijnPattern
-&gt; DisplayTerm
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Named NamedName DeBruijnPattern -&gt; DeBruijnPattern
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><a href="#local-6989586621682166307"><span class="hs-identifier hs-type">toTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayTerm"><span class="hs-identifier hs-type">DisplayTerm</span></a></span><span>
</span><span id="line-778"></span><span>    </span><span id="local-6989586621682166307"><span class="annot"><span class="annottext">toTerm :: DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166307"><span class="hs-identifier hs-var hs-var">toTerm</span></a></span></span><span> </span><span id="local-6989586621682166309"><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; PatOrigin
</span><a href="Agda.Syntax.Internal.html#patOrigin"><span class="hs-identifier hs-var">patOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternInfo -&gt; PatOrigin) -&gt; PatternInfo -&gt; PatOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; Maybe PatternInfo -&gt; PatternInfo
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe PatternInfo -&gt; PatternInfo)
-&gt; Maybe PatternInfo -&gt; PatternInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Maybe PatternInfo
forall x. Pattern' x -&gt; Maybe PatternInfo
</span><a href="Agda.Syntax.Internal.html#patternInfo"><span class="hs-identifier hs-var">patternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-779"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOSystem"><span class="hs-identifier hs-var">PatOSystem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var">toDisplayPattern</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-780"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOSplit"><span class="hs-identifier hs-var">PatOSplit</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var">toDisplayPattern</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-781"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#PatOSplitArg"><span class="hs-identifier hs-type">PatOSplitArg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166315"><span class="hs-identifier hs-var">toVarOrDot</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-782"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#PatOVar"><span class="hs-identifier hs-type">PatOVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166315"><span class="hs-identifier hs-var">toVarOrDot</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-783"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatODot"><span class="hs-identifier hs-var">PatODot</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DDot"><span class="hs-identifier hs-var">DDot</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Term -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-784"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOWild"><span class="hs-identifier hs-var">PatOWild</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166315"><span class="hs-identifier hs-var">toVarOrDot</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-785"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOCon"><span class="hs-identifier hs-var">PatOCon</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var">toDisplayPattern</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-786"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatORec"><span class="hs-identifier hs-var">PatORec</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var">toDisplayPattern</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-787"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOLit"><span class="hs-identifier hs-var">PatOLit</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var">toDisplayPattern</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOAbsurd"><span class="hs-identifier hs-var">PatOAbsurd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var">toDisplayPattern</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166309"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-comment">-- see test/Succeed/Issue2849.agda</span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span>    </span><span class="annot"><a href="#local-6989586621682166312"><span class="hs-identifier hs-type">toDisplayPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayTerm"><span class="hs-identifier hs-type">DisplayTerm</span></a></span><span>
</span><span id="line-791"></span><span>    </span><span id="local-6989586621682166312"><span class="annot"><span class="annottext">toDisplayPattern :: DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166312"><span class="hs-identifier hs-var hs-var">toDisplayPattern</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-792"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166323"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682166323"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DTerm"><span class="hs-identifier hs-var">DTerm</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Term -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Term) -&gt; Int -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682166323"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-comment">-- TODO, should be an Elim' DisplayTerm ?</span><span>
</span><span id="line-793"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166324"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166324"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayTerm
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-794"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span> </span><span id="local-6989586621682166325"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682166325"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682166326"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682166326"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DTerm"><span class="hs-identifier hs-var">DTerm</span></a></span><span>  </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Term -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Term) -&gt; Int -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682166326"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-795"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span> </span><span id="local-6989586621682166327"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682166327"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682166328"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166328"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DDot"><span class="hs-identifier hs-var">DDot</span></a></span><span>   </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Term -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166328"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-796"></span><span>      </span><span id="local-6989586621682166329"><span class="annot"><span class="annottext">p :: DeBruijnPattern
</span><a href="#local-6989586621682166329"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682166330"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166330"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682166331"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682166331"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span id="local-6989586621682166332"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166332"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConOrigin -&gt; [Arg DisplayTerm] -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DCon"><span class="hs-identifier hs-var">DCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682166330"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConPatternInfo -&gt; ConOrigin
</span><a href="Agda.Syntax.Internal.html#fromConPatternInfo"><span class="hs-identifier hs-var">fromConPatternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682166331"><span class="hs-identifier hs-var">cpi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Arg DisplayTerm] -&gt; DisplayTerm)
-&gt; [Arg DisplayTerm] -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; [Arg DisplayTerm]
</span><a href="#local-6989586621682166308"><span class="hs-identifier hs-var">toTerms</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166332"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-797"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span> </span><span id="local-6989586621682166335"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682166335"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682166336"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166336"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DTerm"><span class="hs-identifier hs-var">DTerm</span></a></span><span>  </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Term -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682166336"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-798"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682166337"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166337"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682166338"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166338"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Elim' DisplayTerm] -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DDef"><span class="hs-identifier hs-var">DDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682166337"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">([Elim' DisplayTerm] -&gt; DisplayTerm)
-&gt; [Elim' DisplayTerm] -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg DisplayTerm -&gt; Elim' DisplayTerm)
-&gt; [Arg DisplayTerm] -&gt; [Elim' DisplayTerm]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg DisplayTerm -&gt; Elim' DisplayTerm
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg DisplayTerm] -&gt; [Elim' DisplayTerm])
-&gt; [Arg DisplayTerm] -&gt; [Elim' DisplayTerm]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; [Arg DisplayTerm]
</span><a href="#local-6989586621682166308"><span class="hs-identifier hs-var">toTerms</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682166338"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>    </span><span class="annot"><a href="#local-6989586621682166315"><span class="hs-identifier hs-type">toVarOrDot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayTerm"><span class="hs-identifier hs-type">DisplayTerm</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span id="local-6989586621682166315"><span class="annot"><span class="annottext">toVarOrDot :: DeBruijnPattern -&gt; DisplayTerm
</span><a href="#local-6989586621682166315"><span class="hs-identifier hs-var hs-var">toVarOrDot</span></a></span></span><span> </span><span id="local-6989586621682166339"><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166339"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682166339"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-802"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682166340"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166340"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DTerm"><span class="hs-identifier hs-var">DTerm</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; DisplayTerm) -&gt; Term -&gt; DisplayTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682166340"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span id="local-6989586621682166341"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166341"><span class="hs-identifier hs-var">t</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; DisplayTerm
</span><a href="Agda.TypeChecking.Monad.Base.html#DDot"><span class="hs-identifier hs-var">DDot</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682166341"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-804"></span></pre></body></html>