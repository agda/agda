<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Check that a datatype is strictly positive.</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html"><span class="hs-identifier">Agda.TypeChecking.Positivity</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(!!)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fold</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SCC</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Seq</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DS</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Strict.These</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html"><span class="hs-identifier">Agda.Interaction.Options.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optOccurrence"><span class="hs-identifier">optOccurrence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Info</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier">HasRange</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier">noRange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#isDataOrRecordType"><span class="hs-identifier">isDataOrRecordType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Functions.html"><span class="hs-identifier">Agda.TypeChecking.Functions</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Benchmark.html#MonadBench"><span class="hs-identifier">MonadBench</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html#Phase"><span class="hs-identifier">Phase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Match.html"><span class="hs-identifier">Agda.TypeChecking.Patterns.Match</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Match.html#properlyMatching"><span class="hs-identifier">properlyMatching</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html"><span class="hs-identifier">Agda.TypeChecking.Records</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html"><span class="hs-identifier">Agda.Utils.Graph.AdjacencyMap.Unidirectional</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Graph</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier">applyUnless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier">Pretty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.SemiRing.html"><span class="hs-identifier">Agda.Utils.SemiRing</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">type</span><span> </span><span id="Graph"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Graph"><span class="hs-identifier hs-var">Graph</span></a></span></span><span> </span><span id="local-6989586621682073040"><span class="annot"><a href="#local-6989586621682073040"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682073041"><span class="annot"><a href="#local-6989586621682073041"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Graph"><span class="hs-identifier hs-type">Graph.Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073040"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073041"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | Check that the datatypes in the mutual block containing the given</span><span>
</span><span id="line-68"></span><span class="hs-comment">--   declarations are strictly positive.</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">--   Find polarity of datatypes parameters and indices.</span><span>
</span><span id="line-71"></span><span class="hs-comment">--</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   Also add information about positivity and recursivity of records</span><span>
</span><span id="line-73"></span><span class="hs-comment">--   to the signature.</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#checkStrictlyPositive"><span class="hs-identifier hs-type">checkStrictlyPositive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MutualInfo"><span class="hs-identifier hs-type">Info.MutualInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span id="checkStrictlyPositive"><span class="annot"><span class="annottext">checkStrictlyPositive :: MutualInfo -&gt; Set QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Positivity.html#checkStrictlyPositive"><span class="hs-identifier hs-var hs-var">checkStrictlyPositive</span></a></span></span><span> </span><span id="local-6989586621682073043"><span class="annot"><span class="annottext">MutualInfo
</span><a href="#local-6989586621682073043"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span id="local-6989586621682073044"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073044"><span class="hs-identifier hs-var">qset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Positivity"><span class="hs-identifier hs-var">Bench.Positivity</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- compute the occurrence graph for qs</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073047"><span class="annot"><span class="annottext">qs :: [QName]
</span><a href="#local-6989586621682073047"><span class="hs-identifier hs-var hs-var hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073044"><span class="hs-identifier hs-var">qset</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.tick&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;positivity of&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; [QName] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073047"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621682073052"><span class="annot"><a href="#local-6989586621682073052"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; TCM (Graph Node (Edge OccursWhere))
</span><a href="Agda.TypeChecking.Positivity.html#buildOccurrenceGraph"><span class="hs-identifier hs-var">buildOccurrenceGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073044"><span class="hs-identifier hs-var">qset</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073054"><span class="annot"><a href="#local-6989586621682073054"><span class="hs-identifier hs-var">gstar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073055"><span class="annot"><a href="#local-6989586621682073055"><span class="hs-identifier hs-var">sccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#gaussJordanFloydWarshallMcNaughtonYamada"><span class="hs-identifier hs-type">Graph.gaussJordanFloydWarshallMcNaughtonYamada</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621682073057"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073052"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.tick&quot;</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;constructed graph&quot;</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.graph&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Positivity graph: N=&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#nodes"><span class="hs-identifier hs-type">Graph.nodes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073052"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-85"></span><span>                               </span><span class="annot"><span class="hs-string">&quot; E=&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#edges"><span class="hs-identifier hs-type">Graph.edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073052"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.graph&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;positivity graph for&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073047"><span class="hs-identifier hs-type">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073052"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.graph&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="hs-string">&quot;Positivity graph (completed): E=&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#edges"><span class="hs-identifier hs-type">Graph.edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073054"><span class="hs-identifier hs-type">gstar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.graph&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;transitive closure of positivity graph for&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>
</span><span id="line-94"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073047"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073054"><span class="hs-identifier hs-type">gstar</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-comment">-- remember argument occurrences for qs in the signature</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="#local-6989586621682073067"><span class="hs-identifier hs-type">setArgOccs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073044"><span class="hs-identifier hs-type">qset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073047"><span class="hs-identifier hs-type">qs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073054"><span class="hs-identifier hs-type">gstar</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.tick&quot;</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;set args&quot;</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">-- check positivity for all strongly connected components of the graph for qs</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.graph.sccs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073068"><span class="annot"><a href="#local-6989586621682073068"><span class="hs-identifier hs-var">triv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073069"><span class="annot"><a href="#local-6989586621682073069"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">partitionEithers</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-type">for</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073055"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-105"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">AcyclicSCC</span></span><span> </span><span id="local-6989586621682073073"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073073"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Either Node [Node]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073073"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">CyclicSCC</span></span><span> </span><span id="local-6989586621682073075"><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682073075"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Node] -&gt; Either Node [Node]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682073075"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682073068"><span class="hs-identifier hs-type">triv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot; trivial sccs&quot;</span></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682073069"><span class="hs-identifier hs-type">others</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot; non-trivial sccs with lengths &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682073069"><span class="hs-identifier hs-type">others</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.graph.sccs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="hs-string">&quot;  sccs = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621682073078"><span class="hs-identifier hs-type">scc</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CyclicSCC</span></span><span> </span><span id="local-6989586621682073078"><span class="annot"><a href="#local-6989586621682073078"><span class="hs-identifier hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682073055"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-comment">-- #7133: Note that the graph doesn't necessarily contain all of qs in the case where there are no</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-comment">-- occurrences of a name, but we still need to setMutual for them.</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073079"><span class="annot"><a href="#local-6989586621682073079"><span class="hs-identifier hs-var hs-var">sccMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Map QName [QName]] -&gt; Map QName [QName]
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
f (Map k a) -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unions</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SCC Node
</span><a href="#local-6989586621682073081"><span class="hs-identifier hs-var">scc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">AcyclicSCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-type">DefNode</span></a></span><span> </span><span id="local-6989586621682073083"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073083"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; Map QName [QName]
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073083"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">AcyclicSCC</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ArgNode"><span class="hs-identifier hs-type">ArgNode</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map QName [QName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-119"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">CyclicSCC</span></span><span> </span><span id="local-6989586621682073086"><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682073086"><span class="hs-identifier hs-var">scc</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(QName, [QName])] -&gt; Map QName [QName]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073088"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073089"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682073088"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073088"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073089"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>                                </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682073089"><span class="annot"><span class="annottext">qs :: [QName]
</span><a href="#local-6989586621682073089"><span class="hs-identifier hs-var hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073090"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-type">DefNode</span></a></span><span> </span><span id="local-6989586621682073090"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073090"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682073086"><span class="hs-identifier hs-var">scc</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-121"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682073081"><span class="annot"><span class="annottext">SCC Node
</span><a href="#local-6989586621682073081"><span class="hs-identifier hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SCC Node]
</span><a href="#local-6989586621682073055"><span class="hs-identifier hs-var">sccs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#inAbstractMode"><span class="hs-identifier hs-type">inAbstractMode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682073047"><span class="hs-identifier hs-type">qs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073093"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073093"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [QName] -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [QName] -&gt; Bool) -&gt; TCMT IO (Maybe [QName]) -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO (Maybe [QName])
</span><a href="Agda.TypeChecking.Monad.Signature.html#getMutual"><span class="hs-identifier hs-var">getMutual</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073093"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073098"><span class="annot"><span class="annottext">qs :: [QName]
</span><a href="#local-6989586621682073098"><span class="hs-identifier hs-var hs-var hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Maybe [QName] -&gt; [QName]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Maybe [QName] -&gt; [QName]) -&gt; Maybe [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Map QName [QName] -&gt; Maybe [QName]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073093"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName [QName]
</span><a href="#local-6989586621682073079"><span class="hs-identifier hs-var">sccMap</span></a></span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; ArgName -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.mutual&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM ()) -&gt; ArgName -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;setting &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073093"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-126"></span><span>                                     </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073098"><span class="hs-identifier hs-var">qs</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;non-recursive&quot;</span></span><span>
</span><span id="line-127"></span><span>                                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Nat
forall a. [a] -&gt; Nat
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Nat
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073098"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;recursive&quot;</span></span><span>
</span><span id="line-128"></span><span>                                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;mutually recursive&quot;</span></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#setMutual"><span class="hs-identifier hs-var">setMutual</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073093"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073098"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682073104"><span class="hs-identifier hs-type">checkPos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073052"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073054"><span class="hs-identifier hs-type">gstar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682073047"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.tick&quot;</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;checked positivity&quot;</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621682073104"><span class="hs-identifier hs-type">checkPos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-137"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621682073104"><span class="annot"><span class="annottext">checkPos :: Graph Node (Edge OccursWhere)
-&gt; Graph Node Occurrence -&gt; QName -&gt; TCM ()
</span><a href="#local-6989586621682073104"><span class="hs-identifier hs-var hs-var">checkPos</span></a></span></span><span> </span><span id="local-6989586621682073105"><span class="annot"><span class="annottext">Graph Node (Edge OccursWhere)
</span><a href="#local-6989586621682073105"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621682073106"><span class="annot"><span class="annottext">Graph Node Occurrence
</span><a href="#local-6989586621682073106"><span class="hs-identifier hs-var">gstar</span></a></span></span><span> </span><span id="local-6989586621682073107"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
HasConstInfo m =&gt;
QName -&gt; (Definition -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteOrAbstractMode"><span class="hs-identifier hs-var">inConcreteOrAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; TCM ()) -&gt; TCM ())
-&gt; (Definition -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073109"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073109"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-comment">-- we check positivity only for data or record definitions</span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">Maybe (PositivityCheck, DataOrRecord)
-&gt; ((PositivityCheck, DataOrRecord) -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Maybe (PositivityCheck, DataOrRecord)
</span><a href="#local-6989586621682073111"><span class="hs-identifier hs-var">isDatatype_</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073109"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073112"><span class="annot"><span class="annottext">PositivityCheck
</span><a href="#local-6989586621682073112"><span class="hs-identifier hs-var">pc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073113"><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682073113"><span class="hs-identifier hs-var">dr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking positivity of&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682073114"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span>
</span><span id="line-144"></span><span>            </span><span id="local-6989586621682073114"><span class="annot"><span class="annottext">loop :: Maybe Occurrence
</span><a href="#local-6989586621682073114"><span class="hs-identifier hs-var hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Graph Node Occurrence -&gt; Maybe Occurrence
forall n e. Ord n =&gt; n -&gt; n -&gt; Graph n e -&gt; Maybe e
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#lookup"><span class="hs-identifier hs-var">Graph.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Graph Node Occurrence
</span><a href="#local-6989586621682073106"><span class="hs-identifier hs-var">gstar</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>            </span><span class="annot"><a href="#local-6989586621682073116"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>            </span><span id="local-6989586621682073116"><span class="annot"><span class="annottext">g' :: Graph Node (Edge (Seq OccursWhere))
</span><a href="#local-6989586621682073116"><span class="hs-identifier hs-var hs-var hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Edge OccursWhere -&gt; Edge (Seq OccursWhere))
-&gt; Graph Node (Edge OccursWhere)
-&gt; Graph Node (Edge (Seq OccursWhere))
forall a b. (a -&gt; b) -&gt; Graph Node a -&gt; Graph Node b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OccursWhere -&gt; Seq OccursWhere)
-&gt; Edge OccursWhere -&gt; Edge (Seq OccursWhere)
forall a b. (a -&gt; b) -&gt; Edge a -&gt; Edge b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">OccursWhere -&gt; Seq OccursWhere
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">DS.singleton</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Graph Node (Edge OccursWhere)
</span><a href="#local-6989586621682073105"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-comment">-- Note the property</span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-comment">-- Internal.Utils.Graph.AdjacencyMap.Unidirectional.prop_productOfEdgesInBoundedWalk,</span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-comment">-- which relates productOfEdgesInBoundedWalk to</span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-comment">-- gaussJordanFloydWarshallMcNaughtonYamada.</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>            </span><span id="local-6989586621682073118"><span class="annot"><span class="annottext">reason :: Occurrence -&gt; Seq OccursWhere
</span><a href="#local-6989586621682073118"><span class="hs-identifier hs-var hs-var hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621682073119"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073119"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-155"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Edge (Seq OccursWhere) -&gt; Occurrence)
-&gt; Graph Node (Edge (Seq OccursWhere))
-&gt; Node
-&gt; Node
-&gt; Occurrence
-&gt; Maybe (Edge (Seq OccursWhere))
forall e n.
(SemiRing e, Ord n) =&gt;
(e -&gt; Occurrence) -&gt; Graph n e -&gt; n -&gt; n -&gt; Occurrence -&gt; Maybe e
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#productOfEdgesInBoundedWalk"><span class="hs-identifier hs-var">productOfEdgesInBoundedWalk</span></a></span><span>
</span><span id="line-156"></span><span>                     </span><span class="annot"><span class="annottext">Edge (Seq OccursWhere) -&gt; Occurrence
forall {a}. Edge a -&gt; Occurrence
</span><a href="#local-6989586621682073057"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Graph Node (Edge (Seq OccursWhere))
</span><a href="#local-6989586621682073116"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073119"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073122"><span class="annot"><span class="annottext">Seq OccursWhere
</span><a href="#local-6989586621682073122"><span class="hs-identifier hs-var">how</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Seq OccursWhere
</span><a href="#local-6989586621682073122"><span class="hs-identifier hs-var">how</span></a></span><span>
</span><span id="line-158"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Edge (Seq OccursWhere))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Seq OccursWhere
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>            </span><span class="annot"><a href="#local-6989586621682073124"><span class="hs-identifier hs-type">how</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span>
</span><span id="line-161"></span><span>            </span><span id="local-6989586621682073124"><span class="annot"><span class="annottext">how :: ArgName -&gt; Occurrence -&gt; TCMT IO Doc
</span><a href="#local-6989586621682073124"><span class="hs-identifier hs-var hs-var hs-var">how</span></a></span></span><span> </span><span id="local-6989586621682073125"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682073125"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621682073126"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073126"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-162"></span><span>                  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [TCMT IO Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;is&quot;</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-163"></span><span>                  </span><span class="annot"><span class="annottext">ArgName -&gt; [TCMT IO Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682073125"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;, because it occurs&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-164"></span><span>                  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Seq OccursWhere -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Seq OccursWhere -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Seq OccursWhere
</span><a href="#local-6989586621682073118"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073126"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-comment">-- if we have a negative loop, raise error</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-comment">-- ASR (23 December 2015). We don't raise a strictly positive</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-comment">-- error if the NO_POSITIVITY_CHECK pragma was set. See Issue 1614.</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-comment">-- Andreas, 2026-02-27:</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-comment">-- This information now comes either with the mututal block</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-comment">-- or with the data/record type, see issue #3355.</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutualInfo -&gt; PositivityCheck
</span><a href="Agda.Syntax.Info.html#mutualPositivityCheck"><span class="hs-identifier hs-var">Info.mutualPositivityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">MutualInfo
</span><a href="#local-6989586621682073043"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">PositivityCheck -&gt; PositivityCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PositivityCheck
</span><a href="Agda.Syntax.Common.html#NoPositivityCheck"><span class="hs-identifier hs-var">NoPositivityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">PositivityCheck
</span><a href="#local-6989586621682073112"><span class="hs-identifier hs-var">pc</span></a></span><span> </span><span class="annot"><span class="annottext">PositivityCheck -&gt; PositivityCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PositivityCheck
</span><a href="Agda.Syntax.Common.html#NoPositivityCheck"><span class="hs-identifier hs-var">NoPositivityCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-174"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Options.html#positivityCheckEnabled"><span class="hs-identifier hs-var">positivityCheckEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-175"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><a href="#local-6989586621682073114"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073133"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073133"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073133"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustPos"><span class="hs-identifier hs-var">JustPos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>              </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Seq OccursWhere -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#NotStrictlyPositive"><span class="hs-identifier hs-var">NotStrictlyPositive</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Seq OccursWhere
</span><a href="#local-6989586621682073118"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustPos"><span class="hs-identifier hs-var">JustPos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-comment">-- if we find an unguarded record, mark it as such</span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682073113"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>          </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="Agda.Syntax.Common.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Common.html#IsRecord"><span class="hs-identifier hs-type">IsRecord</span></a></span><span> </span><span id="local-6989586621682073140"><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="#local-6989586621682073140"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><a href="#local-6989586621682073114"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073141"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073141"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073141"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>              </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.record&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Occurrence -&gt; TCMT IO Doc
</span><a href="#local-6989586621682073124"><span class="hs-identifier hs-var">how</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;not guarded&quot;</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span>
</span><span id="line-186"></span><span>              </span><span class="annot"><span class="annottext">QName -&gt; PatternOrCopattern -&gt; TCM ()
</span><a href="Agda.TypeChecking.Records.html#unguardedRecord"><span class="hs-identifier hs-var">unguardedRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="#local-6989586621682073140"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-187"></span><span>              </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="#local-6989586621682073144"><span class="hs-identifier hs-var">checkInduction</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-188"></span><span>            </span><span class="hs-comment">-- otherwise, if the record is recursive, mark it as well</span><span>
</span><span id="line-189"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073145"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073145"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073145"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>              </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.record&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Occurrence -&gt; TCMT IO Doc
</span><a href="#local-6989586621682073124"><span class="hs-identifier hs-var">how</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;recursive&quot;</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span>
</span><span id="line-191"></span><span>              </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Records.html#recursiveRecord"><span class="hs-identifier hs-var">recursiveRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-192"></span><span>              </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="#local-6989586621682073144"><span class="hs-identifier hs-var">checkInduction</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-193"></span><span>            </span><span class="hs-comment">-- If the record is not recursive, switch on eta</span><span>
</span><span id="line-194"></span><span>            </span><span class="hs-comment">-- unless it is coinductive or a no-eta-equality record.</span><span>
</span><span id="line-195"></span><span>            </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>              </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.record&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-197"></span><span>                </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;record type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-198"></span><span>                </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;is not recursive&quot;</span></span><span>
</span><span id="line-199"></span><span>              </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Records.html#nonRecursiveRecord"><span class="hs-identifier hs-var">nonRecursiveRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073107"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-200"></span><span>            </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><a href="#local-6989586621682073144"><span class="hs-identifier hs-type">checkInduction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621682073144"><span class="annot"><span class="annottext">checkInduction :: QName -&gt; TCM ()
</span><a href="#local-6989586621682073144"><span class="hs-identifier hs-var hs-var">checkInduction</span></a></span></span><span> </span><span id="local-6989586621682073149"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073149"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-comment">-- Check whether the recursive record has been declared as</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-comment">-- 'Inductive' or 'Coinductive'.  Otherwise, error.</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Induction -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Induction -&gt; Bool)
-&gt; (Definition -&gt; Maybe Induction) -&gt; Definition -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#recInduction"><span class="hs-identifier hs-var">recInduction</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Maybe Induction)
-&gt; (Definition -&gt; Defn) -&gt; Definition -&gt; Maybe Induction
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Bool) -&gt; TCMT IO Definition -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *).
(HasConstInfo m, HasCallStack) =&gt;
QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073149"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-207"></span><span>          </span><span class="annot"><span class="annottext">Range -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Range
forall a. HasNameBindingSite a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Abstract.Name.html#nameBindingSite"><span class="hs-identifier hs-var">nameBindingSite</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073149"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-208"></span><span>            </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#RecursiveRecordNeedsInductivity"><span class="hs-identifier hs-var">RecursiveRecordNeedsInductivity</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073149"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621682073057"><span class="annot"><span class="annottext">occ :: Edge a -&gt; Occurrence
</span><a href="#local-6989586621682073057"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span id="local-6989586621682073159"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073159"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073159"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="#local-6989586621682073111"><span class="hs-identifier hs-type">isDatatype_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#PositivityCheck"><span class="hs-identifier hs-type">PositivityCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#DataOrRecord"><span class="hs-identifier hs-type">DataOrRecord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621682073111"><span class="annot"><span class="annottext">isDatatype_ :: Definition -&gt; Maybe (PositivityCheck, DataOrRecord)
</span><a href="#local-6989586621682073111"><span class="hs-identifier hs-var hs-var">isDatatype_</span></a></span></span><span> </span><span id="local-6989586621682073160"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073160"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073160"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataClause :: Defn -&gt; Maybe Clause
</span><a href="Agda.TypeChecking.Monad.Base.html#dataClause"><span class="hs-identifier hs-var">dataClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Clause
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073163"><span class="annot"><span class="annottext">PositivityCheck
dataPositivityCheck :: PositivityCheck
dataPositivityCheck :: Defn -&gt; PositivityCheck
</span><a href="#local-6989586621682073163"><span class="hs-identifier hs-var hs-var">dataPositivityCheck</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>          </span><span class="annot"><span class="annottext">(PositivityCheck, DataOrRecord)
-&gt; Maybe (PositivityCheck, DataOrRecord)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PositivityCheck
</span><a href="#local-6989586621682073163"><span class="hs-identifier hs-var">dataPositivityCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataOrRecord
forall p. DataOrRecord' p
</span><a href="Agda.Syntax.Common.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span>  </span><span class="hs-special">{</span><span class="annot"><span class="annottext">recClause :: Defn -&gt; Maybe Clause
</span><a href="Agda.TypeChecking.Monad.Base.html#recClause"><span class="hs-identifier hs-var">recClause</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Clause
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073167"><span class="annot"><span class="annottext">PositivityCheck
recPositivityCheck :: PositivityCheck
recPositivityCheck :: Defn -&gt; PositivityCheck
</span><a href="#local-6989586621682073167"><span class="hs-identifier hs-var hs-var">recPositivityCheck</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073169"><span class="annot"><span class="annottext">PatternOrCopattern
recPatternMatching :: PatternOrCopattern
recPatternMatching :: Defn -&gt; PatternOrCopattern
</span><a href="#local-6989586621682073169"><span class="hs-identifier hs-var hs-var">recPatternMatching</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>          </span><span class="annot"><span class="annottext">(PositivityCheck, DataOrRecord)
-&gt; Maybe (PositivityCheck, DataOrRecord)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PositivityCheck
</span><a href="#local-6989586621682073167"><span class="hs-identifier hs-var">recPositivityCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern -&gt; DataOrRecord
forall p. p -&gt; DataOrRecord' p
</span><a href="Agda.Syntax.Common.html#IsRecord"><span class="hs-identifier hs-var">IsRecord</span></a></span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="#local-6989586621682073169"><span class="hs-identifier hs-var">recPatternMatching</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (PositivityCheck, DataOrRecord)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- Set the polarity of the arguments to a couple of definitions</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="#local-6989586621682073067"><span class="hs-identifier hs-type">setArgOccs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621682073067"><span class="annot"><span class="annottext">setArgOccs :: Set QName -&gt; [QName] -&gt; Graph Node Occurrence -&gt; TCM ()
</span><a href="#local-6989586621682073067"><span class="hs-identifier hs-var hs-var">setArgOccs</span></a></span></span><span> </span><span id="local-6989586621682073171"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073171"><span class="hs-identifier hs-var">qset</span></a></span></span><span> </span><span id="local-6989586621682073172"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073172"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621682073173"><span class="annot"><span class="annottext">Graph Node Occurrence
</span><a href="#local-6989586621682073173"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-05-11, issue #3049: we need to be pessimistic about</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-comment">-- argument polarity beyond the formal arity of the function.</span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-comment">-- -- Compute a map from each name in q to the maximal argument index</span><span>
</span><span id="line-228"></span><span>      </span><span class="hs-comment">-- let maxs = Map.fromListWith max</span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-comment">--      [ (q, i) | ArgNode q i &lt;- Set.toList $ Graph.nodes g, q `Set.member` qset ]</span><span>
</span><span id="line-230"></span><span>      </span><span class="annot"><span class="annottext">[QName] -&gt; (QName -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073172"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; TCM ()) -&gt; TCM ()) -&gt; (QName -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073174"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073174"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
HasConstInfo m =&gt;
QName -&gt; (Definition -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteOrAbstractMode"><span class="hs-identifier hs-var">inConcreteOrAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073174"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; TCM ()) -&gt; TCM ())
-&gt; (Definition -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073175"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073175"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="#local-6989586621682073177"><span class="hs-identifier hs-var">hasDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Bool) -&gt; Defn -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073175"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.args&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking args of&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073174"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621682073178"><span class="annot"><a href="#local-6989586621682073178"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCM Nat
</span><a href="Agda.TypeChecking.Positivity.html#getDefArity"><span class="hs-identifier hs-var">getDefArity</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073175"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-comment">-- If there is no outgoing edge @ArgNode q i@, all @n@ arguments are @Unused@.</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-comment">-- Otherwise, we obtain the occurrences from the Graph.</span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073180"><span class="annot"><a href="#local-6989586621682073180"><span class="hs-identifier hs-var hs-var">findOcc</span></a></span></span><span> </span><span id="local-6989586621682073181"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073181"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Maybe Occurrence -&gt; Occurrence
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-var">Unused</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Occurrence -&gt; Occurrence) -&gt; Maybe Occurrence -&gt; Occurrence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Graph Node Occurrence -&gt; Maybe Occurrence
forall n e. Ord n =&gt; n -&gt; n -&gt; Graph n e -&gt; Maybe e
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#lookup"><span class="hs-identifier hs-var">Graph.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Nat -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#ArgNode"><span class="hs-identifier hs-var">ArgNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073174"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073181"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073174"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Graph Node Occurrence
</span><a href="#local-6989586621682073173"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span id="local-6989586621682073183"><span class="annot"><a href="#local-6989586621682073183"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- caseMaybe (Map.lookup q maxs) (replicate n Unused) $ \ m -&gt;</span><span>
</span><span id="line-237"></span><span>              </span><span class="annot"><span class="annottext">(Nat -&gt; Occurrence) -&gt; [Nat] -&gt; [Occurrence]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Occurrence
</span><a href="#local-6989586621682073180"><span class="hs-identifier hs-var">findOcc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073178"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- [0 .. max m (n - 1)] -- triggers issue #3049</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.args&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-240"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;args of&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073174"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;=&quot;</span></span><span>
</span><span id="line-241"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073183"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-242"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-comment">-- The list args can take a long time to compute, but contains</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-comment">-- small elements, and is stored in the interface, so</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-comment">-- it is computed deep-strictly.</span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621682073185"><span class="annot"><a href="#local-6989586621682073185"><span class="hs-identifier hs-var">oldOccs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getArgOccurrences"><span class="hs-identifier hs-type">getArgOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073174"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682073187"><span class="annot"><a href="#local-6989586621682073187"><span class="hs-identifier hs-var hs-var">newOccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073188"><span class="annot"><span class="annottext">x :: [Occurrence]
</span><a href="#local-6989586621682073188"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; [Occurrence] -&gt; [Occurrence]
</span><a href="#local-6989586621682073189"><span class="hs-identifier hs-var">mergeOccs</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073183"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073185"><span class="hs-identifier hs-var">oldOccs</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; [Occurrence] -&gt; [Occurrence]
forall a b. NFData a =&gt; a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">deepseq</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073188"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073188"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#setArgOccurrences"><span class="hs-identifier hs-type">setArgOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073174"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073187"><span class="hs-identifier hs-type">newOccs</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><a href="#local-6989586621682073189"><span class="hs-identifier hs-type">mergeOccs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621682073189"><span class="annot"><span class="annottext">mergeOccs :: [Occurrence] -&gt; [Occurrence] -&gt; [Occurrence]
</span><a href="#local-6989586621682073189"><span class="hs-identifier hs-var hs-var">mergeOccs</span></a></span></span><span> </span><span id="local-6989586621682073192"><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073192"><span class="hs-identifier hs-var">poccs</span></a></span></span><span> </span><span id="local-6989586621682073193"><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073193"><span class="hs-identifier hs-var">toccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-comment">-- Lucas, 2022-12-01:</span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-comment">-- `poccs` are the occurences computed by the positivity-checker</span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-comment">-- `toccs` are the occurences/polarities explicitely given by the user</span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-comment">--   (and enforced through type-checking)</span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-comment">-- We consider the polarities explicitely given (toccs) to take priority over the ones</span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-comment">-- found out by the positivity checker.</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-comment">-- Note: Alas, this is hard to enforce given that non-annotated variables are</span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-comment">-- always annotated with Mixed polarity. If the annotated polarity is Mixed,</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- for now we always rely on the result from the positivity analysis.</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="annottext">[Occurrence] -&gt; [Occurrence] -&gt; [These Occurrence Occurrence]
forall a b. [a] -&gt; [b] -&gt; [These a b]
</span><a href="Agda.Utils.List.html#align"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073192"><span class="hs-identifier hs-var">poccs</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073193"><span class="hs-identifier hs-var">toccs</span></a></span><span> </span><span class="annot"><span class="annottext">[These Occurrence Occurrence]
-&gt; (These Occurrence Occurrence -&gt; Occurrence) -&gt; [Occurrence]
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence -&gt; Occurrence -&gt; Occurrence)
-&gt; These Occurrence Occurrence -&gt; Occurrence
forall a. (a -&gt; a -&gt; a) -&gt; These a a -&gt; a
</span><span class="hs-identifier hs-var">mergeThese</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073197"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073197"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682073198"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073198"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073198"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073197"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073198"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-11-23, issue #3404</span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-comment">-- Only assign argument occurrences to things which have a definition.</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-comment">-- Things without a definition would be judged &quot;constant&quot; in all arguments,</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-comment">-- since no occurrence could possibly be found, naturally.</span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><a href="#local-6989586621682073177"><span class="hs-identifier hs-type">hasDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-269"></span><span>      </span><span id="local-6989586621682073177"><span class="annot"><span class="annottext">hasDefinition :: Defn -&gt; Bool
</span><a href="#local-6989586621682073177"><span class="hs-identifier hs-var hs-var">hasDefinition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-270"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#getDefArity"><span class="hs-identifier hs-type">getDefArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-282"></span><span id="getDefArity"><span class="annot"><span class="annottext">getDefArity :: Definition -&gt; TCM Nat
</span><a href="Agda.TypeChecking.Positivity.html#getDefArity"><span class="hs-identifier hs-var hs-var">getDefArity</span></a></span></span><span> </span><span id="local-6989586621682073208"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073208"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682073210"><span class="annot"><a href="#local-6989586621682073210"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073208"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073210"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#projectionArgs"><span class="hs-identifier hs-type">projectionArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073208"><span class="hs-identifier hs-type">def</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- Computing occurrences --------------------------------------------------</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-keyword">data</span><span> </span><span id="Item"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-var">Item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AnArg"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="ADef"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ADef"><span class="hs-identifier hs-var">ADef</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073217"><span id="local-6989586621682073226"><span class="annot"><span class="annottext">Item -&gt; Item -&gt; Bool
(Item -&gt; Item -&gt; Bool) -&gt; (Item -&gt; Item -&gt; Bool) -&gt; Eq Item
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Item -&gt; Item -&gt; Bool
== :: Item -&gt; Item -&gt; Bool
$c/= :: Item -&gt; Item -&gt; Bool
/= :: Item -&gt; Item -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073233"><span id="local-6989586621682073239"><span id="local-6989586621682073244"><span id="local-6989586621682073247"><span id="local-6989586621682073250"><span id="local-6989586621682073253"><span id="local-6989586621682073256"><span class="annot"><span class="annottext">Eq Item
Eq Item =&gt;
(Item -&gt; Item -&gt; Ordering)
-&gt; (Item -&gt; Item -&gt; Bool)
-&gt; (Item -&gt; Item -&gt; Bool)
-&gt; (Item -&gt; Item -&gt; Bool)
-&gt; (Item -&gt; Item -&gt; Bool)
-&gt; (Item -&gt; Item -&gt; Item)
-&gt; (Item -&gt; Item -&gt; Item)
-&gt; Ord Item
Item -&gt; Item -&gt; Bool
Item -&gt; Item -&gt; Ordering
Item -&gt; Item -&gt; Item
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Item -&gt; Item -&gt; Ordering
compare :: Item -&gt; Item -&gt; Ordering
$c&lt; :: Item -&gt; Item -&gt; Bool
&lt; :: Item -&gt; Item -&gt; Bool
$c&lt;= :: Item -&gt; Item -&gt; Bool
&lt;= :: Item -&gt; Item -&gt; Bool
$c&gt; :: Item -&gt; Item -&gt; Bool
&gt; :: Item -&gt; Item -&gt; Bool
$c&gt;= :: Item -&gt; Item -&gt; Bool
&gt;= :: Item -&gt; Item -&gt; Bool
$cmax :: Item -&gt; Item -&gt; Item
max :: Item -&gt; Item -&gt; Item
$cmin :: Item -&gt; Item -&gt; Item
min :: Item -&gt; Item -&gt; Item
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073263"><span id="local-6989586621682073272"><span id="local-6989586621682073276"><span class="annot"><span class="annottext">Nat -&gt; Item -&gt; ArgName -&gt; ArgName
[Item] -&gt; ArgName -&gt; ArgName
Item -&gt; ArgName
(Nat -&gt; Item -&gt; ArgName -&gt; ArgName)
-&gt; (Item -&gt; ArgName) -&gt; ([Item] -&gt; ArgName -&gt; ArgName) -&gt; Show Item
forall a.
(Nat -&gt; a -&gt; ArgName -&gt; ArgName)
-&gt; (a -&gt; ArgName) -&gt; ([a] -&gt; ArgName -&gt; ArgName) -&gt; Show a
$cshowsPrec :: Nat -&gt; Item -&gt; ArgName -&gt; ArgName
showsPrec :: Nat -&gt; Item -&gt; ArgName -&gt; ArgName
$cshow :: Item -&gt; ArgName
show :: Item -&gt; ArgName
$cshowList :: [Item] -&gt; ArgName -&gt; ArgName
showList :: [Item] -&gt; ArgName -&gt; ArgName
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621682073285"><span class="annot"><span class="annottext">getRange :: Item -&gt; Range
</span><a href="#local-6989586621682073285"><span class="hs-identifier hs-var hs-var hs-var">getRange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-type">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ADef"><span class="hs-identifier hs-type">ADef</span></a></span><span> </span><span id="local-6989586621682073287"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073287"><span class="hs-identifier hs-var">qn</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073287"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682073289"><span id="local-6989586621682073293"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621682073306"><span class="annot"><span class="annottext">prettyPrec :: Nat -&gt; Item -&gt; Doc
</span><a href="#local-6989586621682073306"><span class="hs-identifier hs-var hs-var hs-var">prettyPrec</span></a></span></span><span> </span><span id="local-6989586621682073308"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073308"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-type">AnArg</span></a></span><span> </span><span id="local-6989586621682073309"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073309"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682073310"><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073310"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">P.mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073308"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;AnArg&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073309"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682073310"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyPrec"><span class="hs-identifier hs-var">prettyPrec</span></a></span><span> </span><span id="local-6989586621682073314"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073314"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ADef"><span class="hs-identifier hs-type">ADef</span></a></span><span> </span><span id="local-6989586621682073315"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073315"><span class="hs-identifier hs-var">qn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#mparens"><span class="hs-identifier hs-var">P.mparens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073314"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ADef&quot;</span></span><span>  </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073315"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">type</span><span> </span><span id="Occurrences"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Occurrences"><span class="hs-identifier hs-var">Occurrences</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><span class="hs-comment">-- | Used to build 'Occurrences' and occurrence graphs.</span></span><span>
</span><span id="line-303"></span><span class="hs-keyword">data</span><span> </span><span id="OccurrencesBuilder"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-var">OccurrencesBuilder</span></a></span></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Concat"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OccursAs"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OccursHere"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-var">OccursHere</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OnlyVarsUpTo"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OnlyVarsUpTo"><span class="hs-identifier hs-var">OnlyVarsUpTo</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- ^ @OnlyVarsUpTo n occs@ discards occurrences of de Bruijn index</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- @&gt;= n@.</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><span class="hs-comment">-- | Used to build 'Occurrences' and occurrence graphs.</span></span><span>
</span><span id="line-312"></span><span class="hs-keyword">data</span><span> </span><span id="OccurrencesBuilder%27"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-var">OccurrencesBuilder'</span></a></span></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Concat%27"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat%27"><span class="hs-identifier hs-var">Concat'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-type">OccurrencesBuilder'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OccursAs%27"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs%27"><span class="hs-identifier hs-var">OccursAs'</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-type">OccurrencesBuilder'</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OccursHere%27"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursHere%27"><span class="hs-identifier hs-var">OccursHere'</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><span class="hs-comment">-- | The semigroup laws only hold up to flattening of 'Concat'.</span></span><span>
</span><span id="line-318"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682073326"><span id="local-6989586621682073329"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621682073334"><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073334"><span class="hs-identifier hs-var">occs1</span></a></span></span><span> </span><span id="local-6989586621682073335"><span class="annot"><span class="annottext">&lt;&gt; :: OccurrencesBuilder -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621682073336"><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073336"><span class="hs-identifier hs-var">occs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder] -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073334"><span class="hs-identifier hs-var">occs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073336"><span class="hs-identifier hs-var">occs2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">-- | The monoid laws only hold up to flattening of 'Concat'.</span></span><span>
</span><span id="line-322"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-323"></span><span>  </span><span id="local-6989586621682073343"><span class="annot"><span class="annottext">mempty :: OccurrencesBuilder
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder] -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-324"></span><span>  </span><span id="local-6989586621682073345"><span class="annot"><span class="annottext">mappend :: OccurrencesBuilder -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621682073346"><span class="annot"><span class="annottext">mconcat :: [OccurrencesBuilder] -&gt; OccurrencesBuilder
</span><span class="hs-identifier hs-var hs-var hs-var">mconcat</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder] -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><span class="hs-comment">-- | Removes 'OnlyVarsUpTo' entries.</span></span><span>
</span><span id="line-328"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#preprocess"><span class="hs-identifier hs-type">preprocess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-type">OccurrencesBuilder'</span></a></span><span>
</span><span id="line-329"></span><span id="preprocess"><span class="annot"><span class="annottext">preprocess :: OccurrencesBuilder -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#preprocess"><span class="hs-identifier hs-var hs-var">preprocess</span></a></span></span><span> </span><span id="local-6989586621682073348"><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073348"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Nat -&gt; OccurrencesBuilder -&gt; Maybe OccurrencesBuilder'
</span><a href="#local-6989586621682073349"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Nat
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073348"><span class="hs-identifier hs-var">ob</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="annottext">Maybe OccurrencesBuilder'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder'] -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#Concat%27"><span class="hs-identifier hs-var">Concat'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073350"><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073350"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073350"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="#local-6989586621682073349"><span class="hs-identifier hs-type">pp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>  </span><span class="hs-comment">-- Variables larger than or equal to this number, if any,</span><span>
</span><span id="line-334"></span><span>                   </span><span class="hs-comment">-- are not retained.</span><span>
</span><span id="line-335"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span>
</span><span id="line-336"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-type">OccurrencesBuilder'</span></a></span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621682073349"><span class="annot"><span class="annottext">pp :: Maybe Nat -&gt; OccurrencesBuilder -&gt; Maybe OccurrencesBuilder'
</span><a href="#local-6989586621682073349"><span class="hs-identifier hs-var hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682073351"><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682073351"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-338"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span> </span><span id="local-6989586621682073352"><span class="annot"><span class="annottext">[OccurrencesBuilder]
</span><a href="#local-6989586621682073352"><span class="hs-identifier hs-var">obs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; Maybe OccurrencesBuilder')
-&gt; [OccurrencesBuilder] -&gt; [OccurrencesBuilder']
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Nat -&gt; OccurrencesBuilder -&gt; Maybe OccurrencesBuilder'
</span><a href="#local-6989586621682073349"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682073351"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder]
</span><a href="#local-6989586621682073352"><span class="hs-identifier hs-var">obs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe OccurrencesBuilder'
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-340"></span><span>      </span><span id="local-6989586621682073354"><span class="annot"><span class="annottext">[OccurrencesBuilder']
</span><a href="#local-6989586621682073354"><span class="hs-identifier hs-var">obs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder' -&gt; Maybe OccurrencesBuilder'
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OccurrencesBuilder'] -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#Concat%27"><span class="hs-identifier hs-var">Concat'</span></a></span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder']
</span><a href="#local-6989586621682073354"><span class="hs-identifier hs-var">obs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-type">OccursAs</span></a></span><span> </span><span id="local-6989586621682073355"><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682073355"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682073356"><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073356"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder' -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs%27"><span class="hs-identifier hs-var">OccursAs'</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682073355"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder' -&gt; OccurrencesBuilder')
-&gt; Maybe OccurrencesBuilder' -&gt; Maybe OccurrencesBuilder'
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Nat -&gt; OccurrencesBuilder -&gt; Maybe OccurrencesBuilder'
</span><a href="#local-6989586621682073349"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682073351"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073356"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OnlyVarsUpTo"><span class="hs-identifier hs-type">OnlyVarsUpTo</span></a></span><span> </span><span id="local-6989586621682073357"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073357"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682073358"><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073358"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Nat -&gt; OccurrencesBuilder -&gt; Maybe OccurrencesBuilder'
</span><a href="#local-6989586621682073349"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Maybe Nat
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; Maybe Nat) -&gt; Nat -&gt; Maybe Nat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; (Nat -&gt; Nat) -&gt; Maybe Nat -&gt; Nat
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073357"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073357"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682073351"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073358"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-type">OccursHere</span></a></span><span> </span><span id="local-6989586621682073362"><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073362"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall b (m :: * -&gt; *). (IsBool b, MonadPlus m) =&gt; b -&gt; m ()
</span><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682073364"><span class="hs-identifier hs-var">keep</span></a></span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="annottext">OccurrencesBuilder' -&gt; Maybe OccurrencesBuilder'
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#OccursHere%27"><span class="hs-identifier hs-var">OccursHere'</span></a></span><span> </span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073362"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>      </span><span id="local-6989586621682073364"><span class="annot"><span class="annottext">keep :: Bool
</span><a href="#local-6989586621682073364"><span class="hs-identifier hs-var hs-var">keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682073351"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073362"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Nat
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Item
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Nat
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ADef"><span class="hs-identifier hs-type">ADef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073365"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073365"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-type">AnArg</span></a></span><span> </span><span id="local-6989586621682073366"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073366"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073366"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073365"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-comment">-- | An interpreter for 'OccurrencesBuilder'.</span><span>
</span><span id="line-356"></span><span class="hs-comment">--</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- WARNING: There can be lots of sharing between the generated</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- 'OccursWhere' entries. Traversing all of these entries could be</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- expensive. (See 'computeEdges' for an example.)</span><span>
</span><span id="line-360"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#flatten"><span class="hs-identifier hs-type">flatten</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-361"></span><span id="flatten"><span class="annot"><span class="annottext">flatten :: OccurrencesBuilder -&gt; Map Item Integer
</span><a href="Agda.TypeChecking.Positivity.html#flatten"><span class="hs-identifier hs-var hs-var">flatten</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>  </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; [(Item, Integer)] -&gt; Map Item Integer
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">([(Item, Integer)] -&gt; Map Item Integer)
-&gt; (OccurrencesBuilder -&gt; [(Item, Integer)])
-&gt; OccurrencesBuilder
-&gt; Map Item Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><span class="annottext">(OccurrencesBuilder' -&gt; [(Item, Integer)] -&gt; [(Item, Integer)])
-&gt; [(Item, Integer)] -&gt; OccurrencesBuilder' -&gt; [(Item, Integer)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder' -&gt; [(Item, Integer)] -&gt; [(Item, Integer)]
</span><a href="#local-6989586621682073373"><span class="hs-identifier hs-var">flatten'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder' -&gt; [(Item, Integer)])
-&gt; (OccurrencesBuilder -&gt; OccurrencesBuilder')
-&gt; OccurrencesBuilder
-&gt; [(Item, Integer)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><span class="annottext">OccurrencesBuilder -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#preprocess"><span class="hs-identifier hs-var">preprocess</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><a href="#local-6989586621682073373"><span class="hs-identifier hs-type">flatten'</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-type">OccurrencesBuilder'</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621682073373"><span class="annot"><span class="annottext">flatten' :: OccurrencesBuilder' -&gt; [(Item, Integer)] -&gt; [(Item, Integer)]
</span><a href="#local-6989586621682073373"><span class="hs-identifier hs-var hs-var">flatten'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat%27"><span class="hs-identifier hs-type">Concat'</span></a></span><span> </span><span id="local-6989586621682073374"><span class="annot"><span class="annottext">[OccurrencesBuilder']
</span><a href="#local-6989586621682073374"><span class="hs-identifier hs-var">obs</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder'
 -&gt; ([(Item, Integer)] -&gt; [(Item, Integer)])
 -&gt; [(Item, Integer)]
 -&gt; [(Item, Integer)])
-&gt; ([(Item, Integer)] -&gt; [(Item, Integer)])
-&gt; [OccurrencesBuilder']
-&gt; [(Item, Integer)]
-&gt; [(Item, Integer)]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073376"><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073376"><span class="hs-identifier hs-var">occs</span></a></span></span><span> </span><span id="local-6989586621682073377"><span class="annot"><span class="annottext">[(Item, Integer)] -&gt; [(Item, Integer)]
</span><a href="#local-6989586621682073377"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder' -&gt; [(Item, Integer)] -&gt; [(Item, Integer)]
</span><a href="#local-6989586621682073373"><span class="hs-identifier hs-var">flatten'</span></a></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073376"><span class="hs-identifier hs-var">occs</span></a></span><span> </span><span class="annot"><span class="annottext">([(Item, Integer)] -&gt; [(Item, Integer)])
-&gt; ([(Item, Integer)] -&gt; [(Item, Integer)])
-&gt; [(Item, Integer)]
-&gt; [(Item, Integer)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Item, Integer)] -&gt; [(Item, Integer)]
</span><a href="#local-6989586621682073377"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Item, Integer)] -&gt; [(Item, Integer)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder']
</span><a href="#local-6989586621682073374"><span class="hs-identifier hs-var">obs</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><a href="#local-6989586621682073373"><span class="hs-identifier hs-var">flatten'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs%27"><span class="hs-identifier hs-type">OccursAs'</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073379"><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073379"><span class="hs-identifier hs-var">ob</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder' -&gt; [(Item, Integer)] -&gt; [(Item, Integer)]
</span><a href="#local-6989586621682073373"><span class="hs-identifier hs-var">flatten'</span></a></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073379"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><a href="#local-6989586621682073373"><span class="hs-identifier hs-var">flatten'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursHere%27"><span class="hs-identifier hs-type">OccursHere'</span></a></span><span> </span><span id="local-6989586621682073380"><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073380"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073380"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Item, Integer) -&gt; [(Item, Integer)] -&gt; [(Item, Integer)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><span class="hs-comment">-- | Context for computing occurrences.</span></span><span>
</span><span id="line-375"></span><span class="hs-keyword">data</span><span> </span><span id="OccEnv"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccEnv"><span class="hs-identifier hs-var">OccEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OccEnv"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccEnv"><span class="hs-identifier hs-var">OccEnv</span></a></span></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vars"><span class="annot"><span class="annottext">OccEnv -&gt; [Maybe Item]
</span><a href="Agda.TypeChecking.Positivity.html#vars"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- ^ Items corresponding to the free variables.</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-comment">--   Potential invariant: It seems as if the list has the form</span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-comment">--   @'genericReplicate' n 'Nothing' ++ 'map' ('Just' . 'AnArg') is@,</span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-comment">--   for some @n@ and @is@, where @is@ is decreasing</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">--   (non-strictly).</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="inf"><span class="annot"><span class="annottext">OccEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Positivity.html#inf"><span class="hs-identifier hs-var hs-var">inf</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Name for &#8734; builtin.</span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><span class="hs-comment">-- | Monad for computing occurrences.</span></span><span>
</span><span id="line-388"></span><span class="hs-keyword">type</span><span> </span><span id="OccM"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-var">OccM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682072132"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621682072132"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072132"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621682073401"><span class="annot"><span class="annottext">mempty :: OccM a
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; OccM a
forall a. a -&gt; ReaderT OccEnv ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621682073404"><span class="annot"><span class="annottext">mappend :: OccM a -&gt; OccM a -&gt; OccM a
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccM a -&gt; OccM a -&gt; OccM a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-393"></span><span>  </span><span id="local-6989586621682073413"><span class="annot"><span class="annottext">mconcat :: [OccM a] -&gt; OccM a
</span><span class="hs-identifier hs-var hs-var hs-var">mconcat</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; a)
-&gt; ([OccM a] -&gt; ReaderT OccEnv ReduceM [a]) -&gt; [OccM a] -&gt; OccM a
forall (m :: * -&gt; *) b c a.
Functor m =&gt;
(b -&gt; c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="Agda.Utils.Functor.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[OccM a] -&gt; ReaderT OccEnv ReduceM [a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span id="local-6989586621682072144"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv"><span class="hs-identifier hs-type">withExtendedOccEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072144"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072144"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-396"></span><span id="withExtendedOccEnv"><span class="annot"><span class="annottext">withExtendedOccEnv :: forall a. Maybe Item -&gt; OccM a -&gt; OccM a
</span><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv"><span class="hs-identifier hs-var hs-var">withExtendedOccEnv</span></a></span></span><span> </span><span id="local-6989586621682073417"><span class="annot"><span class="annottext">Maybe Item
</span><a href="#local-6989586621682073417"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; OccM a -&gt; OccM a
forall a. [Maybe Item] -&gt; OccM a -&gt; OccM a
</span><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv%27"><span class="hs-identifier hs-var">withExtendedOccEnv'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Item
</span><a href="#local-6989586621682073417"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span id="local-6989586621682072146"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv%27"><span class="hs-identifier hs-type">withExtendedOccEnv'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072146"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072146"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-399"></span><span id="withExtendedOccEnv%27"><span class="annot"><span class="annottext">withExtendedOccEnv' :: forall a. [Maybe Item] -&gt; OccM a -&gt; OccM a
</span><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv%27"><span class="hs-identifier hs-var hs-var">withExtendedOccEnv'</span></a></span></span><span> </span><span id="local-6989586621682073422"><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073422"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccEnv -&gt; OccEnv)
-&gt; ReaderT OccEnv ReduceM a -&gt; ReaderT OccEnv ReduceM a
forall a.
(OccEnv -&gt; OccEnv)
-&gt; ReaderT OccEnv ReduceM a -&gt; ReaderT OccEnv ReduceM a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((OccEnv -&gt; OccEnv)
 -&gt; ReaderT OccEnv ReduceM a -&gt; ReaderT OccEnv ReduceM a)
-&gt; (OccEnv -&gt; OccEnv)
-&gt; ReaderT OccEnv ReduceM a
-&gt; ReaderT OccEnv ReduceM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073424"><span class="annot"><span class="annottext">OccEnv
</span><a href="#local-6989586621682073424"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccEnv
</span><a href="#local-6989586621682073424"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682073422"><span class="hs-identifier hs-type">is</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073424"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><span class="hs-comment">-- | Running the monad</span></span><span>
</span><span id="line-402"></span><span id="local-6989586621682072154"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-type">getOccurrences</span></a></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621682072154"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCM"><span class="hs-identifier hs-type">PrettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072154"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072154"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Extension of the 'OccEnv', usually a local variable context.</span></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682072154"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span></span><span>
</span><span id="line-407"></span><span id="getOccurrences"><span class="annot"><span class="annottext">getOccurrences :: forall a.
(Show a, PrettyTCM a, ComputeOccurrences a) =&gt;
[Maybe Item] -&gt; a -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-var hs-var">getOccurrences</span></a></span></span><span> </span><span id="local-6989586621682073451"><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073451"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621682073452"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073452"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.occ&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;computing occurrences in &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073452"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.occ&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;computing occurrences in &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073452"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos.var&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;variables in context: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073451"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-411"></span><span>  </span><span id="local-6989586621682073454"><span class="annot"><a href="#local-6989586621682073454"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; Maybe QName -&gt; OccEnv
</span><a href="Agda.TypeChecking.Positivity.html#OccEnv"><span class="hs-identifier hs-var">OccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073451"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe QName -&gt; OccEnv)
-&gt; (Maybe CoinductionKit -&gt; Maybe QName)
-&gt; Maybe CoinductionKit
-&gt; OccEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CoinductionKit -&gt; QName) -&gt; Maybe CoinductionKit -&gt; Maybe QName
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CoinductionKit -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Builtin.html#nameOfInf"><span class="hs-identifier hs-var">nameOfInf</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CoinductionKit -&gt; OccEnv)
-&gt; TCMT IO (Maybe CoinductionKit) -&gt; TCMT IO OccEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe CoinductionKit)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#coinductionKit"><span class="hs-identifier hs-var">coinductionKit</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#runReduceM"><span class="hs-identifier hs-type">runReduceM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-type">occurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073452"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682073454"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-keyword">class</span><span> </span><span id="ComputeOccurrences"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-var">ComputeOccurrences</span></a></span></span><span> </span><span id="local-6989586621682072163"><span class="annot"><a href="#local-6989586621682072163"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-415"></span><span>  </span><span id="occurrences"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-type">occurrences</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682072163"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="occurrences"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-type">occurrences</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682072164"><span id="local-6989586621682072165"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682072164"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072165"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682072164"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072165"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621682072163"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682072163"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span></span></span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621682073460"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var">occurrences</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder)
-&gt; t b -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621682073492"><span class="annot"><span class="annottext">occurrences :: Clause -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span id="local-6989586621682073493"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073493"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073494"><span class="annot"><span class="annottext">ps :: NAPs
</span><a href="#local-6989586621682073494"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; NAPs
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073493"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span id="local-6989586621682073496"><span class="annot"><span class="annottext">items :: [Maybe Item]
</span><a href="#local-6989586621682073496"><span class="hs-identifier hs-var hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap (Maybe Item) -&gt; [Maybe Item]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IntMap.elems</span></span><span> </span><span class="annot"><span class="annottext">(IntMap (Maybe Item) -&gt; [Maybe Item])
-&gt; IntMap (Maybe Item) -&gt; [Maybe Item]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NAPs -&gt; IntMap (Maybe Item)
</span><a href="#local-6989586621682073498"><span class="hs-identifier hs-var">patItems</span></a></span><span> </span><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682073494"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-comment">-- sorted from low to high DBI</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- TODO #3733: handle hcomp/transp clauses properly</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NAPs -&gt; Bool
</span><a href="Agda.Syntax.Internal.Pattern.html#hasDefP"><span class="hs-identifier hs-var">hasDefP</span></a></span><span> </span><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682073494"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. a -&gt; ReaderT OccEnv ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>      </span><span id="local-6989586621682073500"><span class="annot"><a href="#local-6989586621682073500"><span class="hs-identifier hs-var">argOccs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Nat, NamedArg DeBruijnPattern)
 -&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder))
-&gt; [(Nat, NamedArg DeBruijnPattern)]
-&gt; ReaderT OccEnv ReduceM [OccurrencesBuilder]
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="Agda.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Nat, NamedArg DeBruijnPattern)
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
forall a.
(Nat, NamedArg (Pattern' a))
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
</span><a href="#local-6989586621682073502"><span class="hs-identifier hs-var">matching</span></a></span><span> </span><span class="annot"><span class="annottext">([(Nat, NamedArg DeBruijnPattern)]
 -&gt; ReaderT OccEnv ReduceM [OccurrencesBuilder])
-&gt; [(Nat, NamedArg DeBruijnPattern)]
-&gt; ReaderT OccEnv ReduceM [OccurrencesBuilder]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Nat] -&gt; NAPs -&gt; [(Nat, NamedArg DeBruijnPattern)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682073494"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Concat</span></span><span> </span><span class="annot"><span class="hs-identifier">argOccs</span></span><span> </span><span class="annot"><span class="hs-operator">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv%27"><span class="hs-identifier hs-type">withExtendedOccEnv'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073496"><span class="hs-identifier hs-type">items</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-429"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-type">occurrences</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073493"><span class="hs-identifier hs-type">cl</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-431"></span><span>      </span><span id="local-6989586621682072185"><span class="annot"><a href="#local-6989586621682073502"><span class="hs-identifier hs-type">matching</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern%27"><span class="hs-identifier hs-type">Pattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccM"><span class="hs-identifier hs-type">OccM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-432"></span><span>      </span><span id="local-6989586621682073502"><span class="annot"><span class="annottext">matching :: forall a.
(Nat, NamedArg (Pattern' a))
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
</span><a href="#local-6989586621682073502"><span class="hs-identifier hs-var hs-var">matching</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073511"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073511"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073512"><span class="annot"><span class="annottext">NamedArg (Pattern' a)
</span><a href="#local-6989586621682073512"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="annottext">Pattern' a -&gt; ReaderT OccEnv ReduceM Bool
forall (m :: * -&gt; *) a. HasConstInfo m =&gt; Pattern' a -&gt; m Bool
</span><a href="Agda.TypeChecking.Patterns.Match.html#properlyMatching"><span class="hs-identifier hs-var">properlyMatching</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Named NamedName (Pattern' a) -&gt; Pattern' a
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="annot"><span class="annottext">(Named NamedName (Pattern' a) -&gt; Pattern' a)
-&gt; Named NamedName (Pattern' a) -&gt; Pattern' a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' a) -&gt; Named NamedName (Pattern' a)
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' a)
</span><a href="#local-6989586621682073512"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM Bool
-&gt; (Bool -&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder))
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
forall a b.
ReaderT OccEnv ReduceM a
-&gt; (a -&gt; ReaderT OccEnv ReduceM b) -&gt; ReaderT OccEnv ReduceM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-434"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
forall a. a -&gt; ReaderT OccEnv ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe OccurrencesBuilder
 -&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder))
-&gt; Maybe OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder -&gt; Maybe OccurrencesBuilder
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; Maybe OccurrencesBuilder)
-&gt; OccurrencesBuilder -&gt; Maybe OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Matched"><span class="hs-identifier hs-var">Matched</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Item -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-var">OccursHere</span></a></span><span> </span><span class="annot"><span class="annottext">(Item -&gt; OccurrencesBuilder) -&gt; Item -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [Occurrence] -&gt; Item
</span><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073511"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-435"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM (Maybe OccurrencesBuilder)
forall a. a -&gt; ReaderT OccEnv ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe OccurrencesBuilder
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>      </span><span class="hs-comment">-- @patItems ps@ creates a map from the pattern variables of @ps@</span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-comment">-- to the index of the argument they are bound in.</span><span>
</span><span id="line-439"></span><span>      </span><span id="local-6989586621682073498"><span class="annot"><span class="annottext">patItems :: NAPs -&gt; IntMap (Maybe Item)
</span><a href="#local-6989586621682073498"><span class="hs-identifier hs-var hs-var">patItems</span></a></span></span><span> </span><span id="local-6989586621682073518"><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682073518"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntMap (Maybe Item)] -&gt; IntMap (Maybe Item)
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([IntMap (Maybe Item)] -&gt; IntMap (Maybe Item))
-&gt; [IntMap (Maybe Item)] -&gt; IntMap (Maybe Item)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; NamedArg DeBruijnPattern -&gt; IntMap (Maybe Item))
-&gt; [Nat] -&gt; NAPs -&gt; [IntMap (Maybe Item)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; NamedArg DeBruijnPattern -&gt; IntMap (Maybe Item)
</span><a href="#local-6989586621682073520"><span class="hs-identifier hs-var">patItem</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682073518"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-comment">-- @patItem i p@ assigns index @i@ to each pattern variable in @p@</span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><a href="#local-6989586621682073520"><span class="hs-identifier hs-type">patItem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>      </span><span id="local-6989586621682073520"><span class="annot"><span class="annottext">patItem :: Nat -&gt; NamedArg DeBruijnPattern -&gt; IntMap (Maybe Item)
</span><a href="#local-6989586621682073520"><span class="hs-identifier hs-var hs-var">patItem</span></a></span></span><span> </span><span id="local-6989586621682073521"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073521"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682073522"><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682073522"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; IntMap (Maybe Item)) -&gt; [Nat] -&gt; IntMap (Maybe Item)
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">Fold.foldMap</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; IntMap (Maybe Item)
</span><a href="#local-6989586621682073523"><span class="hs-identifier hs-var">makeEntry</span></a></span><span> </span><span class="annot"><span class="annottext">[Nat]
</span><a href="#local-6989586621682073524"><span class="hs-identifier hs-var">ixs</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-445"></span><span>          </span><span id="local-6989586621682073524"><span class="annot"><span class="annottext">ixs :: [Nat]
</span><a href="#local-6989586621682073524"><span class="hs-identifier hs-var hs-var">ixs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DBPatVar -&gt; Nat) -&gt; [DBPatVar] -&gt; [Nat]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">DBPatVar -&gt; Nat
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">([DBPatVar] -&gt; [Nat]) -&gt; [DBPatVar] -&gt; [Nat]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Either DBPatVar Term] -&gt; [DBPatVar]
forall a b. [Either a b] -&gt; [a]
</span><span class="hs-identifier hs-var">lefts</span></span><span> </span><span class="annot"><span class="annottext">([Either DBPatVar Term] -&gt; [DBPatVar])
-&gt; [Either DBPatVar Term] -&gt; [DBPatVar]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg (Either DBPatVar Term) -&gt; Either DBPatVar Term)
-&gt; [Arg (Either DBPatVar Term)] -&gt; [Either DBPatVar Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg (Either DBPatVar Term) -&gt; Either DBPatVar Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Either DBPatVar Term)] -&gt; [Either DBPatVar Term])
-&gt; [Arg (Either DBPatVar Term)] -&gt; [Either DBPatVar Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg DeBruijnPattern
-&gt; [Arg (Either (PatternVarOut (Arg DeBruijnPattern)) Term)]
forall a.
PatternVars a =&gt;
a -&gt; [Arg (Either (PatternVarOut a) Term)]
</span><a href="Agda.Syntax.Internal.html#patternVars"><span class="hs-identifier hs-var">patternVars</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg DeBruijnPattern
 -&gt; [Arg (Either (PatternVarOut (Arg DeBruijnPattern)) Term)])
-&gt; Arg DeBruijnPattern
-&gt; [Arg (Either (PatternVarOut (Arg DeBruijnPattern)) Term)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Named NamedName DeBruijnPattern -&gt; DeBruijnPattern
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern -&gt; Arg DeBruijnPattern
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682073522"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>          </span><span id="local-6989586621682073523"><span class="annot"><span class="annottext">makeEntry :: Nat -&gt; IntMap (Maybe Item)
</span><a href="#local-6989586621682073523"><span class="hs-identifier hs-var hs-var">makeEntry</span></a></span></span><span> </span><span id="local-6989586621682073528"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073528"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat, Maybe Item) -&gt; IntMap (Maybe Item)
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073528"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Item -&gt; Maybe Item
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Item -&gt; Maybe Item) -&gt; Item -&gt; Maybe Item
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [Occurrence] -&gt; Item
</span><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073521"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621682073586"><span class="annot"><span class="annottext">occurrences :: Term -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span id="local-6989586621682073587"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073587"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#unSpine"><span class="hs-identifier hs-var">unSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073587"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682073590"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073590"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682073591"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073591"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>      </span><span class="annot"><span class="annottext">(OccEnv -&gt; OccurrencesBuilder)
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Item] -&gt; OccurrencesBuilder
</span><a href="#local-6989586621682073592"><span class="hs-identifier hs-var">occI</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe Item] -&gt; OccurrencesBuilder)
-&gt; (OccEnv -&gt; [Maybe Item]) -&gt; OccEnv -&gt; OccurrencesBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccEnv -&gt; [Maybe Item]
</span><a href="Agda.TypeChecking.Positivity.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>        </span><span id="local-6989586621682073593"><span class="annot"><a href="#local-6989586621682073593"><span class="hs-identifier hs-var">occs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Elim -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder)
-&gt; Elims -&gt; ReaderT OccEnv ReduceM [OccurrencesBuilder]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073591"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-comment">-- Lucas, 2022-12-01: Now, variables may have the polarities of their arguments</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-comment">-- stored in the context (say, if the variable refers to a datatype parameter)</span><span>
</span><span id="line-457"></span><span>        </span><span id="local-6989586621682073595"><span class="annot"><a href="#local-6989586621682073595"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">reader</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">!!</span></span><span> </span><span class="annot"><span class="hs-identifier">i</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073598"><span class="annot"><a href="#local-6989586621682073598"><span class="hs-identifier hs-var hs-var">getPol</span></a></span></span><span> </span><span id="local-6989586621682073599"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073599"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Maybe Occurrence -&gt; Occurrence
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Occurrence -&gt; Occurrence) -&gt; Maybe Occurrence -&gt; Occurrence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-type">AnArg</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073600"><span class="annot"><a href="#local-6989586621682073600"><span class="hs-identifier hs-var">aoccs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Item
</span><a href="#local-6989586621682073595"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-461"></span><span>              </span><span class="annot"><a href="#local-6989586621682073600"><span class="hs-identifier hs-type">aoccs</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.List.html#%21%21%21"><span class="hs-operator hs-type">!!!</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073599"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073602"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073602"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Nat -&gt; Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#VarArg"><span class="hs-identifier hs-var">VarArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Occurrence
</span><a href="#local-6989586621682073598"><span class="hs-identifier hs-var">getPol</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073602"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073602"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682073593"><span class="hs-identifier hs-type">occs</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-465"></span><span>        </span><span id="local-6989586621682073592"><span class="annot"><span class="annottext">occI :: [Maybe Item] -&gt; OccurrencesBuilder
</span><a href="#local-6989586621682073592"><span class="hs-identifier hs-var hs-var">occI</span></a></span></span><span> </span><span id="local-6989586621682073604"><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073604"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
-&gt; (Item -&gt; OccurrencesBuilder) -&gt; Maybe Item -&gt; OccurrencesBuilder
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Item -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-var">OccursHere</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Item -&gt; OccurrencesBuilder)
-&gt; Maybe Item -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Item -&gt; [Maybe Item] -&gt; Nat -&gt; Maybe Item
forall a. a -&gt; [a] -&gt; Nat -&gt; a
</span><a href="Agda.Utils.List.html#indexWithDefault"><span class="hs-identifier hs-var">indexWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Item
</span><a href="#local-6989586621682073606"><span class="hs-identifier hs-var">unbound</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073604"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073590"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span id="local-6989586621682073606"><span class="annot"><span class="annottext">unbound :: Maybe Item
</span><a href="#local-6989586621682073606"><span class="hs-identifier hs-var hs-var">unbound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; Maybe Item -&gt; Maybe Item)
-&gt; Maybe Item -&gt; ArgName -&gt; Maybe Item
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Maybe Item -&gt; Maybe Item
forall a. ArgName -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="annot"><span class="annottext">Maybe Item
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; Maybe Item) -&gt; ArgName -&gt; Maybe Item
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-467"></span><span>              </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;impossible: occurrence of de Bruijn index &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073590"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-468"></span><span>              </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; in vars &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(OccEnv -&gt; [Maybe Item]) -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">OccEnv -&gt; [Maybe Item]
</span><a href="Agda.TypeChecking.Positivity.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; is unbound&quot;</span></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682073608"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073608"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682073609"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073609"><span class="hs-identifier hs-var">args</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>      </span><span id="local-6989586621682073610"><span class="annot"><a href="#local-6989586621682073610"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(OccEnv -&gt; Maybe QName) -&gt; ReaderT OccEnv ReduceM (Maybe QName)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">OccEnv -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Positivity.html#inf"><span class="hs-identifier hs-var">inf</span></a></span><span>
</span><span id="line-472"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073611"><span class="annot"><a href="#local-6989586621682073611"><span class="hs-identifier hs-var hs-var">occsAs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073608"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682073610"><span class="hs-identifier hs-var">inf</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">(Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; (Nat -&gt; Where)
-&gt; Nat
-&gt; OccurrencesBuilder
-&gt; OccurrencesBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Nat -&gt; Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#DefArg"><span class="hs-identifier hs-var">DefArg</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073608"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073614"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073614"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>            </span><span class="hs-comment">-- the principal argument of builtin INF (&#8734;) is the second (n==1)</span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-comment">-- the first is a level argument (n==0, counting from 0!)</span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073614"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#UnderInf"><span class="hs-identifier hs-var">UnderInf</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Nat -&gt; Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#DefArg"><span class="hs-identifier hs-var">DefArg</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073608"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073614"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>      </span><span id="local-6989586621682073616"><span class="annot"><a href="#local-6989586621682073616"><span class="hs-identifier hs-var">occs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-type">occurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073609"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-477"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-type">OccursHere</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ADef"><span class="hs-identifier hs-type">ADef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073608"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="#local-6989586621682073611"><span class="hs-identifier hs-type">occsAs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682073616"><span class="hs-identifier hs-type">occs</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073618"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073618"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073618"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073620"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073620"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#MetaArg"><span class="hs-identifier hs-var">MetaArg</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073620"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682073623"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682073623"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682073624"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682073624"><span class="hs-identifier hs-var">b</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#LeftOfArrow"><span class="hs-identifier hs-var">LeftOfArrow</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682073623"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682073624"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073627"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682073627"><span class="hs-identifier hs-var">b</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Abs Term -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682073627"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span id="local-6989586621682073629"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682073629"><span class="hs-identifier hs-var">l</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Level -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682073629"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-comment">-- Jesper, 2020-01-12: this information is also used for the</span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">-- occurs check, so we need to look under DontCare (see #4371)</span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span> </span><span id="local-6989586621682073633"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073633"><span class="hs-identifier hs-var">v</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073633"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-492"></span><span>  </span><span id="local-6989586621682073639"><span class="annot"><span class="annottext">occurrences :: Level -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Max"><span class="hs-identifier hs-type">Max</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073641"><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682073641"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PlusLevel' Term] -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682073641"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PlusLevel"><span class="hs-identifier hs-type">PlusLevel</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-495"></span><span>  </span><span id="local-6989586621682073645"><span class="annot"><span class="annottext">occurrences :: PlusLevel' Term -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Plus"><span class="hs-identifier hs-type">Plus</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073647"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073647"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073647"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-498"></span><span>  </span><span id="local-6989586621682073650"><span class="annot"><span class="annottext">occurrences :: Type -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073652"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073652"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682073652"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682071968"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071968"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Tele"><span class="hs-identifier hs-type">Tele</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071968"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621682073660"><span class="annot"><span class="annottext">occurrences :: Tele a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="annot"><span class="annottext">Tele a
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-502"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682073663"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073663"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682073664"><span class="annot"><span class="annottext">Abs (Tele a)
</span><a href="#local-6989586621682073664"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, Abs (Tele a)) -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073663"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Abs (Tele a)
</span><a href="#local-6989586621682073664"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682072219"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072219"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072219"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-505"></span><span>  </span><span id="local-6989586621682073669"><span class="annot"><span class="annottext">occurrences :: Abs a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span>   </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073671"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073671"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Item
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Maybe Item -&gt; OccM a -&gt; OccM a
</span><a href="Agda.TypeChecking.Positivity.html#withExtendedOccEnv"><span class="hs-identifier hs-var">withExtendedOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Item
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccEnv ReduceM OccurrencesBuilder
 -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder)
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073671"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682073673"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073673"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073673"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682072217"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072217"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072217"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>  </span><span id="local-6989586621682073681"><span class="annot"><span class="annottext">occurrences :: Elim' a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- unSpine</span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682073684"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682073684"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682073684"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682073686"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073686"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682073687"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073687"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682073688"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073688"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, (a, a)) -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073686"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073687"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073688"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO Andrea: conservative</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682071966"><span id="local-6989586621682071967"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071966"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071967"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#Boundary%27"><span class="hs-identifier hs-type">Boundary'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071966"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071967"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span>  </span><span id="local-6989586621682073695"><span class="annot"><span class="annottext">occurrences :: Boundary' x a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(x, (a, a))] -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">([(x, (a, a))] -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder)
-&gt; (Boundary' x a -&gt; [(x, (a, a))])
-&gt; Boundary' x a
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Boundary' x a -&gt; [(x, (a, a))]
forall x a. Boundary' x a -&gt; [(x, (a, a))]
</span><a href="Agda.TypeChecking.Telescope.html#theBoundary"><span class="hs-identifier hs-var">theBoundary</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682071965"><span id="local-6989586621682073699"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071965"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071965"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-517"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682071964"><span id="local-6989586621682073707"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071964"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071964"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-518"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682071963"><span id="local-6989586621682073715"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682071963"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682071963"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-519"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682072178"><span id="local-6989586621682073722"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072178"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682072178"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682072238"><span id="local-6989586621682072239"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072238"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072239"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682072238"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682072239"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621682073735"><span class="annot"><span class="annottext">occurrences :: (a, b) -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073736"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073736"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073737"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682073737"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073736"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
-&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
forall a.
ComputeOccurrences a =&gt;
a -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var">occurrences</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682073737"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ComputeOccurrences"><span class="hs-identifier hs-type">ComputeOccurrences</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-525"></span><span>  </span><span id="local-6989586621682073740"><span class="annot"><span class="annottext">occurrences :: Nat -&gt; ReaderT OccEnv ReduceM OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#occurrences"><span class="hs-identifier hs-var hs-var hs-var">occurrences</span></a></span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT OccEnv ReduceM OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="hs-comment">-- | Computes the number of occurrences of different 'Item's in the</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- given definition.</span><span>
</span><span id="line-529"></span><span class="hs-comment">--</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- WARNING: There can be lots of sharing between the 'OccursWhere'</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- entries. Traversing all of these entries could be expensive. (See</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- 'computeEdges' for an example.)</span><span>
</span><span id="line-533"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#computeOccurrences"><span class="hs-identifier hs-type">computeOccurrences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span id="computeOccurrences"><span class="annot"><span class="annottext">computeOccurrences :: QName -&gt; TCM (Map Item Integer)
</span><a href="Agda.TypeChecking.Positivity.html#computeOccurrences"><span class="hs-identifier hs-var hs-var">computeOccurrences</span></a></span></span><span> </span><span id="local-6989586621682073742"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073742"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder -&gt; Map Item Integer
</span><a href="Agda.TypeChecking.Positivity.html#flatten"><span class="hs-identifier hs-var">flatten</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; Map Item Integer)
-&gt; TCMT IO OccurrencesBuilder -&gt; TCM (Map Item Integer)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#computeOccurrences%27"><span class="hs-identifier hs-var">computeOccurrences'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073742"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="annot"><span class="hs-comment">-- | Computes the occurrences in the given definition.</span></span><span>
</span><span id="line-537"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#computeOccurrences%27"><span class="hs-identifier hs-type">computeOccurrences'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span>
</span><span id="line-538"></span><span id="computeOccurrences%27"><span class="annot"><span class="annottext">computeOccurrences' :: QName -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#computeOccurrences%27"><span class="hs-identifier hs-var hs-var">computeOccurrences'</span></a></span></span><span> </span><span id="local-6989586621682073744"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073744"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; (Definition -&gt; TCMT IO OccurrencesBuilder)
-&gt; TCMT IO OccurrencesBuilder
forall (m :: * -&gt; *) a.
HasConstInfo m =&gt;
QName -&gt; (Definition -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteOrAbstractMode"><span class="hs-identifier hs-var">inConcreteOrAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073744"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; TCMT IO OccurrencesBuilder)
 -&gt; TCMT IO OccurrencesBuilder)
-&gt; (Definition -&gt; TCMT IO OccurrencesBuilder)
-&gt; TCMT IO OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073745"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073745"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.pos&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073746"><span class="annot"><span class="annottext">a :: IsAbstract
</span><a href="#local-6989586621682073746"><span class="hs-identifier hs-var hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; IsAbstract
</span><a href="Agda.TypeChecking.Monad.Base.html#defAbstract"><span class="hs-identifier hs-var">defAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073745"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621682073748"><span class="annot"><a href="#local-6989586621682073748"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; AbstractMode) -&gt; TCMT IO AbstractMode
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; AbstractMode
</span><a href="Agda.TypeChecking.Monad.Base.html#envAbstractMode"><span class="hs-identifier hs-var">envAbstractMode</span></a></span><span>
</span><span id="line-542"></span><span>    </span><span id="local-6989586621682073751"><span class="annot"><a href="#local-6989586621682073751"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCurrentModule"><span class="hs-identifier hs-var">envCurrentModule</span></a></span><span>
</span><span id="line-543"></span><span>    </span><span id="local-6989586621682073753"><span class="annot"><a href="#local-6989586621682073753"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCurrentOpaqueId"><span class="hs-identifier hs-var">envCurrentOpaqueId</span></a></span><span>
</span><span id="line-544"></span><span>    </span><span class="annot"><span class="hs-string">&quot;computeOccurrences&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073744"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682073746"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682073753"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682073748"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073751"><span class="hs-identifier hs-type">cur</span></a></span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#InDefOf"><span class="hs-identifier hs-var">InDefOf</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073744"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; TCMT IO OccurrencesBuilder -&gt; TCMT IO OccurrencesBuilder
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073745"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funClauses :: Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073757"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682073757"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>      </span><span id="local-6989586621682073758"><span class="annot"><a href="#local-6989586621682073758"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; TCMT IO Clause) -&gt; [Clause] -&gt; TCMT IO [Clause]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; TCMT IO Clause
forall (tcm :: * -&gt; *). PureTCM tcm =&gt; Clause -&gt; tcm Clause
</span><a href="Agda.TypeChecking.Functions.html#etaExpandClause"><span class="hs-identifier hs-var">etaExpandClause</span></a></span><span> </span><span class="annot"><span class="annottext">([Clause] -&gt; TCMT IO [Clause])
-&gt; TCMT IO [Clause] -&gt; TCMT IO [Clause]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">[Clause] -&gt; TCMT IO [Clause]
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682073757"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-comment">-- Perform automated occurrence analysis for functions?</span><span>
</span><span id="line-551"></span><span>      </span><span id="local-6989586621682073762"><span class="annot"><a href="#local-6989586621682073762"><span class="hs-identifier hs-var">performAnalysis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optOccurrence"><span class="hs-identifier hs-type">optOccurrence</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682073762"><span class="hs-identifier hs-type">performAnalysis</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-553"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-type">OccursAs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#InClause"><span class="hs-identifier hs-type">InClause</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span>
</span><span id="line-554"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-type">getOccurrences</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682073758"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-555"></span><span>       </span><span class="hs-keyword">else</span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682073758"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-557"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-558"></span><span>          </span><span id="local-6989586621682073765"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073765"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-559"></span><span>            </span><span class="annot"><span class="annottext">[OccurrencesBuilder] -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span><span>
</span><span id="line-560"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Matched"><span class="hs-identifier hs-var">Matched</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-var">OccursHere</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; [Occurrence] -&gt; Item
</span><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073766"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073766"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073766"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Nat] -&gt; NAPs -&gt; [(Nat, NamedArg DeBruijnPattern)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; NAPs
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073765"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataClause :: Defn -&gt; Maybe Clause
</span><a href="Agda.TypeChecking.Monad.Base.html#dataClause"><span class="hs-identifier hs-var">dataClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073767"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073767"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; Clause -&gt; TCMT IO OccurrencesBuilder
forall a.
(Show a, PrettyTCM a, ComputeOccurrences a) =&gt;
[Maybe Item] -&gt; a -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-var">getOccurrences</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; TCMT IO OccurrencesBuilder)
-&gt; TCMT IO Clause -&gt; TCMT IO OccurrencesBuilder
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; TCMT IO Clause
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073767"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataPars :: Defn -&gt; Nat
</span><a href="Agda.TypeChecking.Monad.Base.html#dataPars"><span class="hs-identifier hs-var">dataPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073769"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073769"><span class="hs-identifier hs-var">np0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dataCons :: Defn -&gt; [QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073771"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682073771"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dataTranspIx :: Defn -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#dataTranspIx"><span class="hs-identifier hs-var">dataTranspIx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073773"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682073773"><span class="hs-identifier hs-var">trx</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-comment">-- Andreas, 2013-02-27 (later edited by someone else): First,</span><span>
</span><span id="line-567"></span><span>      </span><span class="hs-comment">-- include each index of an inductive family.</span><span>
</span><span id="line-568"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682073774"><span class="annot"><a href="#local-6989586621682073774"><span class="hs-identifier hs-var">telD</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (TelV Type)) -&gt; Type -&gt; TCMT IO (TelV Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073745"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-569"></span><span>      </span><span class="hs-comment">-- Andreas, 2017-04-26, issue #2554: count first index as parameter if it has type Size.</span><span>
</span><span id="line-570"></span><span>      </span><span class="hs-comment">-- We compute sizeIndex=1 if first first index has type Size, otherwise sizeIndex==0</span><span>
</span><span id="line-571"></span><span>      </span><span id="local-6989586621682073775"><span class="annot"><a href="#local-6989586621682073775"><span class="hs-identifier hs-var">sizeIndex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.List.html#caseList"><span class="hs-identifier hs-type">caseList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">drop</span></span><span> </span><span class="annot"><a href="#local-6989586621682073769"><span class="hs-identifier hs-type">np0</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-type">telToList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073774"><span class="hs-identifier hs-type">telD</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073779"><span class="annot"><span class="annottext">Dom (ArgName, Type)
</span><a href="#local-6989586621682073779"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO (Maybe BoundedSize)
-&gt; TCM Nat -&gt; (BoundedSize -&gt; TCM Nat) -&gt; TCM Nat
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom (ArgName, Type) -&gt; TCMT IO (Maybe BoundedSize)
forall a (m :: * -&gt; *).
(IsSizeType a, HasOptions m, HasBuiltins m) =&gt;
a -&gt; m (Maybe BoundedSize)
forall (m :: * -&gt; *).
(HasOptions m, HasBuiltins m) =&gt;
Dom (ArgName, Type) -&gt; m (Maybe BoundedSize)
</span><a href="Agda.TypeChecking.Monad.SizedTypes.html#isSizeType"><span class="hs-identifier hs-var">isSizeType</span></a></span><span> </span><span class="annot"><span class="annottext">Dom (ArgName, Type)
</span><a href="#local-6989586621682073779"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; TCM Nat
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((BoundedSize -&gt; TCM Nat) -&gt; TCM Nat)
-&gt; (BoundedSize -&gt; TCM Nat) -&gt; TCM Nat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">BoundedSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; TCM Nat
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073782"><span class="annot"><a href="#local-6989586621682073782"><span class="hs-identifier hs-var hs-var">np</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073769"><span class="hs-identifier hs-var">np0</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073775"><span class="hs-identifier hs-var">sizeIndex</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073783"><span class="annot"><a href="#local-6989586621682073783"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073782"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Nat
forall a. Sized a =&gt; a -&gt; Nat
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073774"><span class="hs-identifier hs-var">telD</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- argument positions corresponding to indices</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073784"><span class="annot"><a href="#local-6989586621682073784"><span class="hs-identifier hs-var hs-var">ioccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder] -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span><span> </span><span class="annot"><span class="annottext">([OccurrencesBuilder] -&gt; OccurrencesBuilder)
-&gt; [OccurrencesBuilder] -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; OccurrencesBuilder) -&gt; [Nat] -&gt; [OccurrencesBuilder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073785"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073785"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Item -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-var">OccursHere</span></a></span><span> </span><span class="annot"><span class="annottext">(Item -&gt; OccurrencesBuilder) -&gt; Item -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [Occurrence] -&gt; Item
</span><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073785"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073769"><span class="hs-identifier hs-var">np0</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073782"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-577"></span><span>                        </span><span class="annot"><span class="annottext">[OccurrencesBuilder]
-&gt; [OccurrencesBuilder] -&gt; [OccurrencesBuilder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; OccurrencesBuilder) -&gt; [Nat] -&gt; [OccurrencesBuilder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073786"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073786"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#IsIndex"><span class="hs-identifier hs-var">IsIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Item -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursHere"><span class="hs-identifier hs-var">OccursHere</span></a></span><span> </span><span class="annot"><span class="annottext">(Item -&gt; OccurrencesBuilder) -&gt; Item -&gt; OccurrencesBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [Occurrence] -&gt; Item
</span><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073786"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Nat]
</span><a href="#local-6989586621682073783"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span>      </span><span class="hs-comment">-- Then, we compute the occurrences in the constructor types.</span><span>
</span><span id="line-580"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073788"><span class="annot"><a href="#local-6989586621682073788"><span class="hs-identifier hs-var hs-var">conOcc</span></a></span></span><span> </span><span id="local-6989586621682073789"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073789"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>            </span><span class="hs-comment">-- Andreas, 2020-02-15, issue #4447:</span><span>
</span><span id="line-582"></span><span>            </span><span class="hs-comment">-- Allow UnconfimedReductions here to make sure we get the constructor type</span><span>
</span><span id="line-583"></span><span>            </span><span class="hs-comment">-- in same way as it was obtained when the data types was checked.</span><span>
</span><span id="line-584"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682073790"><span class="annot"><a href="#local-6989586621682073790"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682073791"><span class="annot"><a href="#local-6989586621682073791"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073792"><span class="annot"><a href="#local-6989586621682073792"><span class="hs-identifier hs-var">bnd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AllowedReductions
-&gt; TCMT IO (TelV Type, Boundary) -&gt; TCMT IO (TelV Type, Boundary)
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
AllowedReductions -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#putAllowedReductions"><span class="hs-identifier hs-var">putAllowedReductions</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedReductions
</span><a href="Agda.TypeChecking.Monad.Base.html#allReductions"><span class="hs-identifier hs-var">allReductions</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (TelV Type, Boundary) -&gt; TCMT IO (TelV Type, Boundary))
-&gt; TCMT IO (TelV Type, Boundary) -&gt; TCMT IO (TelV Type, Boundary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-585"></span><span>              </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type, Boundary)
forall (m :: * -&gt; *). PureTCM m =&gt; Type -&gt; m (TelV Type, Boundary)
</span><a href="Agda.TypeChecking.Telescope.html#telViewPathBoundary"><span class="hs-identifier hs-var">telViewPathBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (TelV Type, Boundary))
-&gt; (Definition -&gt; Type)
-&gt; Definition
-&gt; TCMT IO (TelV Type, Boundary)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO (TelV Type, Boundary))
-&gt; TCMT IO Definition -&gt; TCMT IO (TelV Type, Boundary)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *).
(HasConstInfo m, HasCallStack) =&gt;
QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073789"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-586"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073796"><span class="annot"><a href="#local-6989586621682073796"><span class="hs-identifier hs-var">tel0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682073797"><span class="annot"><a href="#local-6989586621682073797"><span class="hs-identifier hs-var">tel1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#splitTelescopeAt"><span class="hs-identifier hs-type">splitTelescopeAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073782"><span class="hs-identifier hs-type">np</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073790"><span class="hs-identifier hs-type">tel</span></a></span><span>
</span><span id="line-587"></span><span>            </span><span class="hs-comment">-- Do not collect occurrences in the data parameters.</span><span>
</span><span id="line-588"></span><span>            </span><span class="hs-comment">-- Normalization needed e.g. for test/succeed/Bush.agda.</span><span>
</span><span id="line-589"></span><span>            </span><span class="hs-comment">-- (Actually, for Bush.agda, reducing the parameters should be sufficient.)</span><span>
</span><span id="line-590"></span><span>            </span><span id="local-6989586621682073799"><span class="annot"><a href="#local-6989586621682073799"><span class="hs-identifier hs-var">tel1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073796"><span class="hs-identifier hs-type">tel0</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#normalise"><span class="hs-identifier hs-type">normalise</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682073797"><span class="hs-identifier hs-type">tel1</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span>            </span><span class="hs-comment">-- Make parameters into context items, with polarity info</span><span>
</span><span id="line-593"></span><span>            </span><span id="local-6989586621682073802"><span class="annot"><a href="#local-6989586621682073802"><span class="hs-identifier hs-var">pvars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682073803"><span class="hs-identifier hs-type">parametersToItems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073796"><span class="hs-identifier hs-type">tel0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073782"><span class="hs-identifier hs-type">np</span></a></span><span>
</span><span id="line-594"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073804"><span class="annot"><a href="#local-6989586621682073804"><span class="hs-identifier hs-var hs-var">telvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Maybe Item -&gt; [Maybe Item]
forall a. Nat -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Nat
forall a. Sized a =&gt; a -&gt; Nat
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073799"><span class="hs-identifier hs-var">tel1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Item
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; [Maybe Item] -&gt; [Maybe Item]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073802"><span class="hs-identifier hs-var">pvars</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.params&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Adding datatypes parameters in context &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073802"><span class="hs-identifier hs-type">pvars</span></a></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span>            </span><span class="hs-comment">-- Occurrences in the types of the constructor arguments.</span><span>
</span><span id="line-599"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-type">OccursAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#ConArgType"><span class="hs-identifier hs-type">ConArgType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073789"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-type">getOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073802"><span class="hs-identifier hs-type">pvars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073799"><span class="hs-identifier hs-type">tel1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span>
</span><span id="line-600"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-type">OccursAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#ConEndpoint"><span class="hs-identifier hs-type">ConEndpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073789"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-type">getOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073804"><span class="hs-identifier hs-type">telvars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073792"><span class="hs-identifier hs-type">bnd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-601"></span><span>              </span><span class="hs-comment">-- Occurrences in the indices of the data type the constructor targets.</span><span>
</span><span id="line-602"></span><span>              </span><span class="hs-comment">-- Andreas, 2020-02-15, issue #4447:</span><span>
</span><span id="line-603"></span><span>              </span><span class="hs-comment">-- WAS: @t@ is not necessarily a data type, but it could be something</span><span>
</span><span id="line-604"></span><span>              </span><span class="hs-comment">-- that reduces to a data type once UnconfirmedReductions are confirmed</span><span>
</span><span id="line-605"></span><span>              </span><span class="hs-comment">-- as safe by the termination checker.</span><span>
</span><span id="line-606"></span><span>              </span><span class="hs-comment">-- In any case, if @t@ is not showing itself as the data type, we need to</span><span>
</span><span id="line-607"></span><span>              </span><span class="hs-comment">-- do something conservative.  We will just collect *all* occurrences</span><span>
</span><span id="line-608"></span><span>              </span><span class="hs-comment">-- and flip their sign (variance) using 'LeftOfArrow'.</span><span>
</span><span id="line-609"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073791"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-610"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682073809"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span id="local-6989586621682073810"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073810"><span class="hs-identifier hs-var">vs</span></a></span></span><span>
</span><span id="line-611"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073744"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">q'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073811"><span class="annot"><span class="annottext">indices :: [Arg Term]
</span><a href="#local-6989586621682073811"><span class="hs-identifier hs-var hs-var">indices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; Maybe [Arg Term] -&gt; [Arg Term]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Arg Term] -&gt; [Arg Term]) -&gt; Maybe [Arg Term] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Maybe [Arg Term]) -&gt; Elims -&gt; Maybe [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Elims -&gt; Elims
forall a. Nat -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073782"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682073810"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-613"></span><span>                      </span><span class="annot"><span class="annottext">Where -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OccursAs"><span class="hs-identifier hs-var">OccursAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#IndArgType"><span class="hs-identifier hs-var">IndArgType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073789"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; (OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; OccurrencesBuilder
-&gt; OccurrencesBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; OccurrencesBuilder -&gt; OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#OnlyVarsUpTo"><span class="hs-identifier hs-var">OnlyVarsUpTo</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073782"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">(OccurrencesBuilder -&gt; OccurrencesBuilder)
-&gt; TCMT IO OccurrencesBuilder -&gt; TCMT IO OccurrencesBuilder
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; [Arg Term] -&gt; TCMT IO OccurrencesBuilder
forall a.
(Show a, PrettyTCM a, ComputeOccurrences a) =&gt;
[Maybe Item] -&gt; a -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-var">getOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Item]
</span><a href="#local-6989586621682073804"><span class="hs-identifier hs-var">telvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682073811"><span class="hs-identifier hs-var">indices</span></a></span><span>
</span><span id="line-614"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- this ought to be impossible now (but wasn't, see #4447)</span><span>
</span><span id="line-615"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- eliminated  by telView</span><span>
</span><span id="line-616"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a constructor target; should have been solved by now</span><span>
</span><span id="line-617"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a constructor target</span><span>
</span><span id="line-618"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a constructor target</span><span>
</span><span id="line-619"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a type</span><span>
</span><span id="line-620"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a type</span><span>
</span><span id="line-621"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a type</span><span>
</span><span id="line-622"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a type</span><span>
</span><span id="line-623"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not a type</span><span>
</span><span id="line-624"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>      </span><span class="hs-comment">-- If the data type has a transport constructor (i.e. it's an</span><span>
</span><span id="line-627"></span><span>      </span><span class="hs-comment">-- indexed family in cubical mode) we should also consider it for</span><span>
</span><span id="line-628"></span><span>      </span><span class="hs-comment">-- positivity.</span><span>
</span><span id="line-629"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">mconcat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682073784"><span class="hs-identifier hs-type">ioccs</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="#local-6989586621682073788"><span class="hs-identifier hs-type">conOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682073771"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><a href="#local-6989586621682073773"><span class="hs-identifier hs-type">trx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">recClause :: Defn -&gt; Maybe Clause
</span><a href="Agda.TypeChecking.Monad.Base.html#recClause"><span class="hs-identifier hs-var">recClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682073815"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073815"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; Clause -&gt; TCMT IO OccurrencesBuilder
forall a.
(Show a, PrettyTCM a, ComputeOccurrences a) =&gt;
[Maybe Item] -&gt; a -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-var">getOccurrences</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; TCMT IO OccurrencesBuilder)
-&gt; TCMT IO Clause -&gt; TCMT IO OccurrencesBuilder
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; TCMT IO Clause
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682073815"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">recPars :: Defn -&gt; Nat
</span><a href="Agda.TypeChecking.Monad.Base.html#recPars"><span class="hs-identifier hs-var">recPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073817"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073817"><span class="hs-identifier hs-var">np</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recTel :: Defn -&gt; Tele (Dom Type)
</span><a href="Agda.TypeChecking.Monad.Base.html#recTel"><span class="hs-identifier hs-var">recTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073819"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073819"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073820"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073820"><span class="hs-identifier hs-var hs-var">tel0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682073821"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073821"><span class="hs-identifier hs-var hs-var">tel1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Tele (Dom Type) -&gt; (Tele (Dom Type), Tele (Dom Type))
</span><a href="Agda.TypeChecking.Telescope.html#splitTelescopeAt"><span class="hs-identifier hs-var">splitTelescopeAt</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073817"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073819"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-634"></span><span>      </span><span id="local-6989586621682073822"><span class="annot"><a href="#local-6989586621682073822"><span class="hs-identifier hs-var">pvars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Nat -&gt; TCM [Maybe Item]
</span><a href="#local-6989586621682073803"><span class="hs-identifier hs-var">parametersToItems</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073820"><span class="hs-identifier hs-var">tel0</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073817"><span class="hs-identifier hs-var">np</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#getOccurrences"><span class="hs-identifier hs-type">getOccurrences</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073822"><span class="hs-identifier hs-type">pvars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073820"><span class="hs-identifier hs-type">tel0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#normalise"><span class="hs-identifier hs-type">normalise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073821"><span class="hs-identifier hs-type">tel1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Andreas, 2017-01-01, issue #1899, treat like data types</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-comment">-- Arguments to other kinds of definitions are hard-wired.</span><span>
</span><span id="line-638"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-640"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-641"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-644"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO OccurrencesBuilder
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><a href="#local-6989586621682073803"><span class="hs-identifier hs-type">parametersToItems</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-647"></span><span>    </span><span id="local-6989586621682073803"><span class="annot"><span class="annottext">parametersToItems :: Tele (Dom Type) -&gt; Nat -&gt; TCM [Maybe Item]
</span><a href="#local-6989586621682073803"><span class="hs-identifier hs-var hs-var">parametersToItems</span></a></span></span><span> </span><span id="local-6989586621682073824"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073824"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682073825"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073825"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Item] -&gt; [Maybe Item]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Maybe Item] -&gt; [Maybe Item])
-&gt; TCM [Maybe Item] -&gt; TCM [Maybe Item]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-648"></span><span>      </span><span class="annot"><span class="annottext">(Nat -&gt; Type -&gt; TCMT IO (Maybe Item))
-&gt; [Nat] -&gt; [Type] -&gt; TCM [Maybe Item]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073828"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073828"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Occurrence] -&gt; Maybe Item)
-&gt; TCMT IO [Occurrence] -&gt; TCMT IO (Maybe Item)
forall a b. (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item -&gt; Maybe Item
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Item -&gt; Maybe Item)
-&gt; ([Occurrence] -&gt; Item) -&gt; [Occurrence] -&gt; Maybe Item
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [Occurrence] -&gt; Item
</span><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-var">AnArg</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073828"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO [Occurrence] -&gt; TCMT IO (Maybe Item))
-&gt; (Type -&gt; TCMT IO [Occurrence]) -&gt; Type -&gt; TCMT IO (Maybe Item)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO [Occurrence]
</span><a href="Agda.TypeChecking.Monad.Signature.html#getOccurrencesFromType"><span class="hs-identifier hs-var">getOccurrencesFromType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682073825"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ArgName, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((ArgName, Type) -&gt; Type)
-&gt; (Dom (ArgName, Type) -&gt; (ArgName, Type))
-&gt; Dom (ArgName, Type)
-&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom (ArgName, Type) -&gt; (ArgName, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">(Dom (ArgName, Type) -&gt; Type) -&gt; [Dom (ArgName, Type)] -&gt; [Type]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682073824"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">-- Building the occurrence graph ------------------------------------------</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="hs-keyword">data</span><span> </span><span id="Node"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-var">Node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DefNode"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-656"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="ArgNode"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ArgNode"><span class="hs-identifier hs-var">ArgNode</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073833"><span id="local-6989586621682073840"><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Bool
(Node -&gt; Node -&gt; Bool) -&gt; (Node -&gt; Node -&gt; Bool) -&gt; Eq Node
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Node -&gt; Node -&gt; Bool
== :: Node -&gt; Node -&gt; Bool
$c/= :: Node -&gt; Node -&gt; Bool
/= :: Node -&gt; Node -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073846"><span id="local-6989586621682073851"><span id="local-6989586621682073856"><span id="local-6989586621682073859"><span id="local-6989586621682073862"><span id="local-6989586621682073865"><span id="local-6989586621682073868"><span class="annot"><span class="annottext">Eq Node
Eq Node =&gt;
(Node -&gt; Node -&gt; Ordering)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Node)
-&gt; (Node -&gt; Node -&gt; Node)
-&gt; Ord Node
Node -&gt; Node -&gt; Bool
Node -&gt; Node -&gt; Ordering
Node -&gt; Node -&gt; Node
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Node -&gt; Node -&gt; Ordering
compare :: Node -&gt; Node -&gt; Ordering
$c&lt; :: Node -&gt; Node -&gt; Bool
&lt; :: Node -&gt; Node -&gt; Bool
$c&lt;= :: Node -&gt; Node -&gt; Bool
&lt;= :: Node -&gt; Node -&gt; Bool
$c&gt; :: Node -&gt; Node -&gt; Bool
&gt; :: Node -&gt; Node -&gt; Bool
$c&gt;= :: Node -&gt; Node -&gt; Bool
&gt;= :: Node -&gt; Node -&gt; Bool
$cmax :: Node -&gt; Node -&gt; Node
max :: Node -&gt; Node -&gt; Node
$cmin :: Node -&gt; Node -&gt; Node
min :: Node -&gt; Node -&gt; Node
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><span class="hs-comment">-- | Edge labels for the positivity graph.</span></span><span>
</span><span id="line-660"></span><span class="hs-keyword">data</span><span> </span><span id="Edge"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span></span><span> </span><span id="local-6989586621682072309"><span class="annot"><a href="#local-6989586621682072309"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Edge"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072309"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073872"><span id="local-6989586621682073876"><span class="annot"><span class="annottext">Edge a -&gt; Edge a -&gt; Bool
(Edge a -&gt; Edge a -&gt; Bool)
-&gt; (Edge a -&gt; Edge a -&gt; Bool) -&gt; Eq (Edge a)
forall a. Eq a =&gt; Edge a -&gt; Edge a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; Edge a -&gt; Edge a -&gt; Bool
== :: Edge a -&gt; Edge a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Edge a -&gt; Edge a -&gt; Bool
/= :: Edge a -&gt; Edge a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073884"><span id="local-6989586621682073888"><span id="local-6989586621682073892"><span id="local-6989586621682073896"><span id="local-6989586621682073899"><span id="local-6989586621682073902"><span id="local-6989586621682073905"><span class="annot"><span class="annottext">Eq (Edge a)
Eq (Edge a) =&gt;
(Edge a -&gt; Edge a -&gt; Ordering)
-&gt; (Edge a -&gt; Edge a -&gt; Bool)
-&gt; (Edge a -&gt; Edge a -&gt; Bool)
-&gt; (Edge a -&gt; Edge a -&gt; Bool)
-&gt; (Edge a -&gt; Edge a -&gt; Bool)
-&gt; (Edge a -&gt; Edge a -&gt; Edge a)
-&gt; (Edge a -&gt; Edge a -&gt; Edge a)
-&gt; Ord (Edge a)
Edge a -&gt; Edge a -&gt; Bool
Edge a -&gt; Edge a -&gt; Ordering
Edge a -&gt; Edge a -&gt; Edge a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (Edge a)
forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Bool
forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Ordering
forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Edge a
$ccompare :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Ordering
compare :: Edge a -&gt; Edge a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Bool
&lt; :: Edge a -&gt; Edge a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Bool
&lt;= :: Edge a -&gt; Edge a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Bool
&gt; :: Edge a -&gt; Edge a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Bool
&gt;= :: Edge a -&gt; Edge a -&gt; Bool
$cmax :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Edge a
max :: Edge a -&gt; Edge a -&gt; Edge a
$cmin :: forall a. Ord a =&gt; Edge a -&gt; Edge a -&gt; Edge a
min :: Edge a -&gt; Edge a -&gt; Edge a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073910"><span id="local-6989586621682073915"><span id="local-6989586621682073919"><span class="annot"><span class="annottext">Nat -&gt; Edge a -&gt; ArgName -&gt; ArgName
[Edge a] -&gt; ArgName -&gt; ArgName
Edge a -&gt; ArgName
(Nat -&gt; Edge a -&gt; ArgName -&gt; ArgName)
-&gt; (Edge a -&gt; ArgName)
-&gt; ([Edge a] -&gt; ArgName -&gt; ArgName)
-&gt; Show (Edge a)
forall a. Show a =&gt; Nat -&gt; Edge a -&gt; ArgName -&gt; ArgName
forall a. Show a =&gt; [Edge a] -&gt; ArgName -&gt; ArgName
forall a. Show a =&gt; Edge a -&gt; ArgName
forall a.
(Nat -&gt; a -&gt; ArgName -&gt; ArgName)
-&gt; (a -&gt; ArgName) -&gt; ([a] -&gt; ArgName -&gt; ArgName) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Nat -&gt; Edge a -&gt; ArgName -&gt; ArgName
showsPrec :: Nat -&gt; Edge a -&gt; ArgName -&gt; ArgName
$cshow :: forall a. Show a =&gt; Edge a -&gt; ArgName
show :: Edge a -&gt; ArgName
$cshowList :: forall a. Show a =&gt; [Edge a] -&gt; ArgName -&gt; ArgName
showList :: [Edge a] -&gt; ArgName -&gt; ArgName
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073922"><span id="local-6989586621682073924"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Edge a -&gt; Edge b)
-&gt; (forall a b. a -&gt; Edge b -&gt; Edge a) -&gt; Functor Edge
forall a b. a -&gt; Edge b -&gt; Edge a
forall a b. (a -&gt; b) -&gt; Edge a -&gt; Edge b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Edge a -&gt; Edge b
fmap :: forall a b. (a -&gt; b) -&gt; Edge a -&gt; Edge b
$c&lt;$ :: forall a b. a -&gt; Edge b -&gt; Edge a
&lt;$ :: forall a b. a -&gt; Edge b -&gt; Edge a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="annot"><span class="hs-comment">-- | Merges two edges between the same source and target.</span></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span id="local-6989586621682072307"><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-type">mergeEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072307"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072307"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072307"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-666"></span><span id="mergeEdges"><span class="annot"><span class="annottext">mergeEdges :: forall a. Edge a -&gt; Edge a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var hs-var">mergeEdges</span></a></span></span><span> </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span id="local-6989586621682073928"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073928"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073928"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- dominant</span><span>
</span><span id="line-667"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span id="local-6989586621682073929"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073929"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073929"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-668"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-var">Unused</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span id="local-6989586621682073930"><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073930"><span class="hs-identifier hs-var">e</span></a></span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073930"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- neutral</span><span>
</span><span id="line-669"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span id="local-6989586621682073931"><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073931"><span class="hs-identifier hs-var">e</span></a></span></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-var">Unused</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073931"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-670"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustNeg"><span class="hs-identifier hs-var">JustNeg</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span id="local-6989586621682073933"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073933"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustNeg"><span class="hs-identifier hs-var">JustNeg</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073933"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-671"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span id="local-6989586621682073934"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073934"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustNeg"><span class="hs-identifier hs-var">JustNeg</span></a></span><span> </span><span id="local-6989586621682073935"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073935"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; a -&gt; Edge a
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073935"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-672"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span id="local-6989586621682073936"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073936"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustNeg"><span class="hs-identifier hs-var">JustNeg</span></a></span><span> </span><span id="local-6989586621682073937"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; a -&gt; Edge a
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-673"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span id="local-6989586621682073938"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073938"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustPos"><span class="hs-identifier hs-var">JustPos</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073938"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- dominates strict pos.</span><span>
</span><span id="line-674"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span id="local-6989586621682073939"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073939"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustPos"><span class="hs-identifier hs-var">JustPos</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073939"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-675"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span id="local-6989586621682073940"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073940"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073940"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- dominates 'GuardPos'</span><span>
</span><span id="line-676"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span id="local-6989586621682073941"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073941"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073941"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-677"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621682073942"><span class="annot"><span class="annottext">e :: Edge a
</span><a href="#local-6989586621682073942"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge a
</span><a href="#local-6989586621682073942"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-comment">-- | These operations form a semiring if we quotient by the relation</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- \&quot;the 'Occurrence' components are equal\&quot;.</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.Utils.SemiRing.html#SemiRing"><span class="hs-identifier hs-type">SemiRing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-683"></span><span>  </span><span id="local-6989586621682073949"><span class="annot"><span class="annottext">ozero :: Edge (Seq OccursWhere)
</span><a href="#local-6989586621682073949"><span class="hs-identifier hs-var hs-var hs-var">ozero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Seq OccursWhere -&gt; Edge (Seq OccursWhere)
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
forall a. SemiRing a =&gt; a
</span><a href="Agda.Utils.SemiRing.html#ozero"><span class="hs-identifier hs-var">ozero</span></a></span><span> </span><span class="annot"><span class="annottext">Seq OccursWhere
forall a. Seq a
</span><span class="hs-identifier hs-var">DS.empty</span></span><span>
</span><span id="line-684"></span><span>  </span><span id="local-6989586621682073953"><span class="annot"><span class="annottext">oone :: Edge (Seq OccursWhere)
</span><a href="#local-6989586621682073953"><span class="hs-identifier hs-var hs-var hs-var">oone</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Seq OccursWhere -&gt; Edge (Seq OccursWhere)
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
forall a. SemiRing a =&gt; a
</span><a href="Agda.Utils.SemiRing.html#oone"><span class="hs-identifier hs-var">oone</span></a></span><span>  </span><span class="annot"><span class="annottext">Seq OccursWhere
forall a. Seq a
</span><span class="hs-identifier hs-var">DS.empty</span></span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span>  </span><span id="local-6989586621682073955"><span class="annot"><span class="annottext">oplus :: Edge (Seq OccursWhere)
-&gt; Edge (Seq OccursWhere) -&gt; Edge (Seq OccursWhere)
</span><a href="#local-6989586621682073955"><span class="hs-identifier hs-var hs-var hs-var">oplus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge (Seq OccursWhere)
-&gt; Edge (Seq OccursWhere) -&gt; Edge (Seq OccursWhere)
forall a. Edge a -&gt; Edge a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span>  </span><span id="local-6989586621682073958"><span class="annot"><span class="annottext">otimes :: Edge (Seq OccursWhere)
-&gt; Edge (Seq OccursWhere) -&gt; Edge (Seq OccursWhere)
</span><a href="#local-6989586621682073958"><span class="hs-identifier hs-var hs-var hs-var">otimes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span id="local-6989586621682073960"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073960"><span class="hs-identifier hs-var">o1</span></a></span></span><span> </span><span id="local-6989586621682073961"><span class="annot"><span class="annottext">Seq OccursWhere
</span><a href="#local-6989586621682073961"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span id="local-6989586621682073962"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073962"><span class="hs-identifier hs-var">o2</span></a></span></span><span> </span><span id="local-6989586621682073963"><span class="annot"><span class="annottext">Seq OccursWhere
</span><a href="#local-6989586621682073963"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Seq OccursWhere -&gt; Edge (Seq OccursWhere)
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Occurrence
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-var">otimes</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073960"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073962"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq OccursWhere
</span><a href="#local-6989586621682073961"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">Seq OccursWhere -&gt; Seq OccursWhere -&gt; Seq OccursWhere
forall a. Seq a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">DS.&gt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Seq OccursWhere
</span><a href="#local-6989586621682073963"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="hs-comment">-- | WARNING: There can be lots of sharing between the 'OccursWhere'</span><span>
</span><span id="line-691"></span><span class="hs-comment">-- entries in the edges. Traversing all of these entries could be</span><span>
</span><span id="line-692"></span><span class="hs-comment">-- expensive. (See 'computeEdges' for an example.)</span><span>
</span><span id="line-693"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#buildOccurrenceGraph"><span class="hs-identifier hs-type">buildOccurrenceGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span id="buildOccurrenceGraph"><span class="annot"><span class="annottext">buildOccurrenceGraph :: Set QName -&gt; TCM (Graph Node (Edge OccursWhere))
</span><a href="Agda.TypeChecking.Positivity.html#buildOccurrenceGraph"><span class="hs-identifier hs-var hs-var">buildOccurrenceGraph</span></a></span></span><span> </span><span id="local-6989586621682073965"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073965"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><span class="annottext">(Edge OccursWhere -&gt; Edge OccursWhere -&gt; Edge OccursWhere)
-&gt; [Edge Node (Edge OccursWhere)] -&gt; Graph Node (Edge OccursWhere)
forall n e. Ord n =&gt; (e -&gt; e -&gt; e) -&gt; [Edge n e] -&gt; Graph n e
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#fromEdgesWith"><span class="hs-identifier hs-var">Graph.fromEdgesWith</span></a></span><span> </span><span class="annot"><span class="annottext">Edge OccursWhere -&gt; Edge OccursWhere -&gt; Edge OccursWhere
forall a. Edge a -&gt; Edge a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#mergeEdges"><span class="hs-identifier hs-var">mergeEdges</span></a></span><span> </span><span class="annot"><span class="annottext">([Edge Node (Edge OccursWhere)] -&gt; Graph Node (Edge OccursWhere))
-&gt; ([[Edge Node (Edge OccursWhere)]]
    -&gt; [Edge Node (Edge OccursWhere)])
-&gt; [[Edge Node (Edge OccursWhere)]]
-&gt; Graph Node (Edge OccursWhere)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Edge Node (Edge OccursWhere)]] -&gt; [Edge Node (Edge OccursWhere)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Edge Node (Edge OccursWhere)]] -&gt; Graph Node (Edge OccursWhere))
-&gt; TCMT IO [[Edge Node (Edge OccursWhere)]]
-&gt; TCM (Graph Node (Edge OccursWhere))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO [Edge Node (Edge OccursWhere)])
-&gt; [QName] -&gt; TCMT IO [[Edge Node (Edge OccursWhere)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO [Edge Node (Edge OccursWhere)]
</span><a href="#local-6989586621682073968"><span class="hs-identifier hs-var">defGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073965"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><a href="#local-6989586621682073968"><span class="hs-identifier hs-type">defGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Edge"><span class="hs-identifier hs-type">Graph.Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-699"></span><span>    </span><span id="local-6989586621682073968"><span class="annot"><span class="annottext">defGraph :: QName -&gt; TCMT IO [Edge Node (Edge OccursWhere)]
</span><a href="#local-6989586621682073968"><span class="hs-identifier hs-var hs-var">defGraph</span></a></span></span><span> </span><span id="local-6989586621682073969"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073969"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; (Definition -&gt; TCMT IO [Edge Node (Edge OccursWhere)])
-&gt; TCMT IO [Edge Node (Edge OccursWhere)]
forall (m :: * -&gt; *) a.
HasConstInfo m =&gt;
QName -&gt; (Definition -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteOrAbstractMode"><span class="hs-identifier hs-var">inConcreteOrAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073969"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; TCMT IO [Edge Node (Edge OccursWhere)])
 -&gt; TCMT IO [Edge Node (Edge OccursWhere)])
-&gt; (Definition -&gt; TCMT IO [Edge Node (Edge OccursWhere)])
-&gt; TCMT IO [Edge Node (Edge OccursWhere)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682073970"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682073970"><span class="hs-identifier hs-var">_def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-700"></span><span>      </span><span id="local-6989586621682073971"><span class="annot"><a href="#local-6989586621682073971"><span class="hs-identifier hs-var">occs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO OccurrencesBuilder
</span><a href="Agda.TypeChecking.Positivity.html#computeOccurrences%27"><span class="hs-identifier hs-var">computeOccurrences'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073969"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.occs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-703"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Occurrences in&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073969"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%24%2B%24"><span class="hs-operator hs-type">$+$</span></a></span><span>
</span><span id="line-705"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-706"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682073973"><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073973"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073974"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682073974"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-707"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682073973"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682073974"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-708"></span><span>                   </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;occurrences&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-709"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">List.sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">compare</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`on`</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-710"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Map.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#flatten"><span class="hs-identifier hs-type">flatten</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073971"><span class="hs-identifier hs-type">occs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span>      </span><span class="hs-comment">-- Placing this line before the reportSDoc lines above creates a</span><span>
</span><span id="line-713"></span><span>      </span><span class="hs-comment">-- space leak: occs is retained for too long.</span><span>
</span><span id="line-714"></span><span>      </span><span id="local-6989586621682073977"><span class="annot"><a href="#local-6989586621682073977"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#computeEdges"><span class="hs-identifier hs-type">computeEdges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073965"><span class="hs-identifier hs-type">qs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073969"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073971"><span class="hs-identifier hs-type">occs</span></a></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.pos.occs.edges&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-717"></span><span>        </span><span class="annot"><span class="hs-string">&quot;Edges:&quot;</span></span><span>
</span><span id="line-718"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%24%2B%24"><span class="hs-operator hs-type">$+$</span></a></span><span>
</span><span id="line-719"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-720"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073978"><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere)
</span><a href="#local-6989586621682073978"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-721"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span id="local-6989586621682073979"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073979"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682073980"><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682073980"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere) -&gt; Edge OccursWhere
forall n e. Edge n e -&gt; e
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#label"><span class="hs-identifier hs-var">Graph.label</span></a></span><span> </span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere)
</span><a href="#local-6989586621682073978"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-722"></span><span>                   </span><span class="annot"><span class="annottext">Node -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Node -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere) -&gt; Node
forall n e. Edge n e -&gt; n
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#source"><span class="hs-identifier hs-var">Graph.source</span></a></span><span> </span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere)
</span><a href="#local-6989586621682073978"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-723"></span><span>                   </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;-[&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO Doc
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073979"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;,&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-724"></span><span>                                 </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO Doc
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursWhere -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682073980"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;]-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-725"></span><span>                   </span><span class="annot"><span class="annottext">Node -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Node -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere) -&gt; Node
forall n e. Edge n e -&gt; n
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#target"><span class="hs-identifier hs-var">Graph.target</span></a></span><span> </span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere)
</span><a href="#local-6989586621682073978"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>               </span><span class="annot"><a href="#local-6989586621682073977"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682073977"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="hs-comment">-- | Computes all non-'ozero' occurrence graph edges represented by</span><span>
</span><span id="line-731"></span><span class="hs-comment">-- the given 'OccurrencesBuilder'.</span><span>
</span><span id="line-732"></span><span class="hs-comment">--</span><span>
</span><span id="line-733"></span><span class="hs-comment">-- WARNING: There can be lots of sharing between the 'OccursWhere'</span><span>
</span><span id="line-734"></span><span class="hs-comment">-- entries in the edges. Traversing all of these entries could be</span><span>
</span><span id="line-735"></span><span class="hs-comment">-- expensive. For instance, for the function @F@ in</span><span>
</span><span id="line-736"></span><span class="hs-comment">-- @benchmark/misc/SlowOccurrences.agda@ a large number of edges from</span><span>
</span><span id="line-737"></span><span class="hs-comment">-- the argument @X@ to the function @F@ are computed. These edges have</span><span>
</span><span id="line-738"></span><span class="hs-comment">-- polarity 'StrictPos', 'JustNeg' or 'JustPos', and contain the</span><span>
</span><span id="line-739"></span><span class="hs-comment">-- following 'OccursWhere' elements:</span><span>
</span><span id="line-740"></span><span class="hs-comment">--</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- * @'OccursWhere' _ 'DS.empty' ('DS.fromList' ['InDefOf' &quot;F&quot;, 'InClause' 0])@,</span><span>
</span><span id="line-742"></span><span class="hs-comment">--</span><span>
</span><span id="line-743"></span><span class="hs-comment">-- * @'OccursWhere' _ 'DS.empty' ('DS.fromList' ['InDefOf' &quot;F&quot;, 'InClause' 0, 'LeftOfArrow'])@,</span><span>
</span><span id="line-744"></span><span class="hs-comment">--</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- * @'OccursWhere' _ 'DS.empty' ('DS.fromList' ['InDefOf' &quot;F&quot;, 'InClause' 0, 'LeftOfArrow', 'LeftOfArrow'])@,</span><span>
</span><span id="line-746"></span><span class="hs-comment">--</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- * @'OccursWhere' _ 'DS.empty' ('DS.fromList' ['InDefOf' &quot;F&quot;, 'InClause' 0, 'LeftOfArrow', 'LeftOfArrow', 'LeftOfArrow'])@,</span><span>
</span><span id="line-748"></span><span class="hs-comment">--</span><span>
</span><span id="line-749"></span><span class="hs-comment">-- * and so on.</span><span>
</span><span id="line-750"></span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#computeEdges"><span class="hs-identifier hs-type">computeEdges</span></a></span><span>
</span><span id="line-751"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-752"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The names in the current mutual block.</span></span><span>
</span><span id="line-753"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-754"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The current name.</span></span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder"><span class="hs-identifier hs-type">OccurrencesBuilder</span></a></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Edge"><span class="hs-identifier hs-type">Graph.Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-757"></span><span id="computeEdges"><span class="annot"><span class="annottext">computeEdges :: Set QName
-&gt; QName
-&gt; OccurrencesBuilder
-&gt; TCMT IO [Edge Node (Edge OccursWhere)]
</span><a href="Agda.TypeChecking.Positivity.html#computeEdges"><span class="hs-identifier hs-var hs-var">computeEdges</span></a></span></span><span> </span><span id="local-6989586621682073985"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073985"><span class="hs-identifier hs-var">muts</span></a></span></span><span> </span><span id="local-6989586621682073986"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073986"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682073987"><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073987"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; [Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT IO [Edge Node (Edge OccursWhere)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Occurrence
-&gt; OccurrencesBuilder'
-&gt; Node
-&gt; Seq Where
-&gt; Seq Where
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
</span><a href="#local-6989586621682073988"><span class="hs-identifier hs-var">mkEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccurrencesBuilder -&gt; OccurrencesBuilder'
</span><a href="Agda.TypeChecking.Positivity.html#preprocess"><span class="hs-identifier hs-var">preprocess</span></a></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder
</span><a href="#local-6989586621682073987"><span class="hs-identifier hs-var">ob</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>                    </span><span class="annot"><span class="annottext">Node
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
forall a. Seq a
</span><span class="hs-identifier hs-var">DS.empty</span></span><span> </span><span class="annot"><span class="annottext">Seq Where
forall a. Seq a
</span><span class="hs-identifier hs-var">DS.empty</span></span><span>
</span><span id="line-760"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-761"></span><span>  </span><span class="annot"><a href="#local-6989586621682073988"><span class="hs-identifier hs-type">mkEdge</span></a></span><span>
</span><span id="line-762"></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span>
</span><span id="line-763"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccurrencesBuilder%27"><span class="hs-identifier hs-type">OccurrencesBuilder'</span></a></span><span>
</span><span id="line-764"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>          </span><span class="hs-comment">-- The current target node.</span><span>
</span><span id="line-765"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span>  </span><span class="hs-comment">-- 'Where' information encountered before the current target</span><span>
</span><span id="line-766"></span><span>                      </span><span class="hs-comment">-- node was (re)selected.</span><span>
</span><span id="line-767"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DS.Seq</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span>  </span><span class="hs-comment">-- 'Where' information encountered after the current target</span><span>
</span><span id="line-768"></span><span>                      </span><span class="hs-comment">-- node was (re)selected.</span><span>
</span><span id="line-769"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Edge"><span class="hs-identifier hs-type">Graph.Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-770"></span><span>             </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Edge"><span class="hs-identifier hs-type">Graph.Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>  </span><span id="local-6989586621682073988"><span class="annot"><span class="annottext">mkEdge :: Occurrence
-&gt; OccurrencesBuilder'
-&gt; Node
-&gt; Seq Where
-&gt; Seq Where
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
</span><a href="#local-6989586621682073988"><span class="hs-identifier hs-var hs-var">mkEdge</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682073989"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span></span><span> </span><span id="local-6989586621682073990"><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073990"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span id="local-6989586621682073991"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073991"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621682073992"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073992"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682073993"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073993"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073990"><span class="hs-identifier hs-var">ob</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-772"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Concat%27"><span class="hs-identifier hs-type">Concat'</span></a></span><span> </span><span id="local-6989586621682073994"><span class="annot"><span class="annottext">[OccurrencesBuilder']
</span><a href="#local-6989586621682073994"><span class="hs-identifier hs-var">obs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-773"></span><span>      </span><span class="annot"><span class="annottext">(TCMT
   IO
   ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; TCMT
      IO
      ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; TCMT
      IO
      ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]))
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; [TCMT
      IO
      ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])]
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; ([Edge Node (Edge OccursWhere)]
     -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; [Edge Node (Edge OccursWhere)]
 -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="annot"><span class="annottext">([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; ([Edge Node (Edge OccursWhere)]
    -&gt; [Edge Node (Edge OccursWhere)])
-&gt; [Edge Node (Edge OccursWhere)]
-&gt; [Edge Node (Edge OccursWhere)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">(.)</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Occurrence
-&gt; OccurrencesBuilder'
-&gt; Node
-&gt; Seq Where
-&gt; Seq Where
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
</span><a href="#local-6989586621682073988"><span class="hs-identifier hs-var">mkEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073996"><span class="hs-identifier hs-var">ob</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073991"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073992"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073993"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682073996"><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073996"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[OccurrencesBuilder']
</span><a href="#local-6989586621682073994"><span class="hs-identifier hs-var">obs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursAs%27"><span class="hs-identifier hs-type">OccursAs'</span></a></span><span> </span><span id="local-6989586621682073997"><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682073997"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682073998"><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073998"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-777"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682073999"><span class="annot"><a href="#local-6989586621682073999"><span class="hs-identifier hs-var">to'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074000"><span class="annot"><a href="#local-6989586621682074000"><span class="hs-identifier hs-var">pol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Occurrence -&gt; Where -&gt; TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074001"><span class="hs-identifier hs-var">mkEdge'</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073991"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682073997"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-778"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682074002"><span class="annot"><a href="#local-6989586621682074002"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence
-&gt; OccurrencesBuilder'
-&gt; Node
-&gt; Seq Where
-&gt; Seq Where
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
</span><a href="#local-6989586621682073988"><span class="hs-identifier hs-var">mkEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074000"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">OccurrencesBuilder'
</span><a href="#local-6989586621682073998"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-779"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682073999"><span class="hs-identifier hs-type">to'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-780"></span><span>        </span><span class="annot"><span class="annottext">Maybe Node
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Node
-&gt; Seq Where
-&gt; Seq Where
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
</span><a href="#local-6989586621682074002"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073991"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073992"><span class="hs-identifier hs-var">cs</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073993"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; Where -&gt; Seq Where
forall a. Seq a -&gt; a -&gt; Seq a
</span><span class="hs-operator hs-var">DS.|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682073997"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682074004"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682074004"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Node
-&gt; Seq Where
-&gt; Seq Where
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
</span><a href="#local-6989586621682074002"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682074004"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073992"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; Seq Where -&gt; Seq Where
forall a. Seq a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">DS.&gt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073993"><span class="hs-identifier hs-var">os</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Where -&gt; Seq Where
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">DS.singleton</span></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682073997"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#OccursHere%27"><span class="hs-identifier hs-type">OccursHere'</span></a></span><span> </span><span id="local-6989586621682074005"><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682074005"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-784"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682074006"><span class="annot"><span class="annottext">o :: OccursWhere
</span><a href="#local-6989586621682074006"><span class="hs-identifier hs-var hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Seq Where -&gt; Seq Where -&gt; OccursWhere
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-var">OccursWhere</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682074005"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073992"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682073993"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-785"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621682074005"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-786"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#AnArg"><span class="hs-identifier hs-type">AnArg</span></a></span><span> </span><span id="local-6989586621682074007"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074007"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682074008"><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682074008"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-787"></span><span>          </span><span class="annot"><span class="annottext">([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; TCMT
      IO
      ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]))
-&gt; ([Edge Node (Edge OccursWhere)]
    -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ([Edge Node (Edge OccursWhere)]
    -&gt; [Edge Node (Edge OccursWhere)])
-&gt; [Edge Node (Edge OccursWhere)]
-&gt; [Edge Node (Edge OccursWhere)]
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier hs-var">applyUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Edge"><span class="hs-identifier hs-type">Graph.Edge</span></a></span><span>
</span><span id="line-788"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">source :: Node
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#source"><span class="hs-identifier hs-var">Graph.source</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Nat -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#ArgNode"><span class="hs-identifier hs-var">ArgNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682073986"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074007"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-789"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">target :: Node
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#target"><span class="hs-identifier hs-var">Graph.target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073991"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-790"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">label :: Edge OccursWhere
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#label"><span class="hs-identifier hs-var">Graph.label</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; OccursWhere -&gt; Edge OccursWhere
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074006"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-791"></span><span>            </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere)
-&gt; [Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ADef"><span class="hs-identifier hs-type">ADef</span></a></span><span> </span><span id="local-6989586621682074010"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074010"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-793"></span><span>          </span><span class="hs-comment">-- Andreas, 2017-04-26, issue #2555</span><span>
</span><span id="line-794"></span><span>          </span><span class="hs-comment">-- Skip nodes pointing outside the mutual block.</span><span>
</span><span id="line-795"></span><span>          </span><span class="annot"><span class="annottext">([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
 -&gt; TCMT
      IO
      ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]))
-&gt; ([Edge Node (Edge OccursWhere)]
    -&gt; [Edge Node (Edge OccursWhere)])
-&gt; TCMT
     IO
     ([Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ([Edge Node (Edge OccursWhere)]
    -&gt; [Edge Node (Edge OccursWhere)])
-&gt; [Edge Node (Edge OccursWhere)]
-&gt; [Edge Node (Edge OccursWhere)]
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier hs-var">applyUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.notMember</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074010"><span class="hs-identifier hs-var">q'</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682073985"><span class="hs-identifier hs-var">muts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#Edge"><span class="hs-identifier hs-type">Graph.Edge</span></a></span><span>
</span><span id="line-797"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">source :: Node
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#source"><span class="hs-identifier hs-var">Graph.source</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Node
</span><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-var">DefNode</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074010"><span class="hs-identifier hs-var">q'</span></a></span><span>
</span><span id="line-798"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">target :: Node
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#target"><span class="hs-identifier hs-var">Graph.target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682073991"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-799"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">label :: Edge OccursWhere
</span><a href="Agda.Utils.Graph.AdjacencyMap.Unidirectional.html#label"><span class="hs-identifier hs-var">Graph.label</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; OccursWhere -&gt; Edge OccursWhere
forall a. Occurrence -&gt; a -&gt; Edge a
</span><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074006"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-800"></span><span>               </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Edge Node (Edge OccursWhere)
-&gt; [Edge Node (Edge OccursWhere)] -&gt; [Edge Node (Edge OccursWhere)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-comment">-- This function might return a new target node.</span><span>
</span><span id="line-803"></span><span>  </span><span class="annot"><a href="#local-6989586621682074001"><span class="hs-identifier hs-type">mkEdge'</span></a></span><span>
</span><span id="line-804"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>  </span><span class="hs-comment">-- The current target node.</span><span>
</span><span id="line-805"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>  </span><span id="local-6989586621682074001"><span class="annot"><span class="annottext">mkEdge' :: Node -&gt; Occurrence -&gt; Where -&gt; TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074001"><span class="hs-identifier hs-var hs-var">mkEdge'</span></a></span></span><span> </span><span id="local-6989586621682074012"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682074012"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682074013"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074013"><span class="hs-identifier hs-var">pol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-809"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#VarArg"><span class="hs-identifier hs-type">VarArg</span></a></span><span> </span><span id="local-6989586621682074014"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074014"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682074015"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074015"><span class="hs-identifier hs-var">i</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074016"><span class="hs-identifier hs-var">addPol</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074014"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-810"></span><span>    </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#MetaArg"><span class="hs-identifier hs-var">MetaArg</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
forall {a}. TCMT IO (Maybe a, Occurrence)
</span><a href="#local-6989586621682074017"><span class="hs-identifier hs-var">mixed</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#LeftOfArrow"><span class="hs-identifier hs-var">LeftOfArrow</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074018"><span class="hs-identifier hs-var">negative</span></a></span><span>
</span><span id="line-812"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#DefArg"><span class="hs-identifier hs-type">DefArg</span></a></span><span> </span><span id="local-6989586621682074019"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074019"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682074020"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074020"><span class="hs-identifier hs-var">i</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-813"></span><span>      </span><span id="local-6989586621682074021"><span class="annot"><a href="#local-6989586621682074021"><span class="hs-identifier hs-var">pol'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Occurrence
</span><a href="#local-6989586621682074022"><span class="hs-identifier hs-var">isGuarding</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074019"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-814"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.member</span></span><span> </span><span class="annot"><a href="#local-6989586621682074019"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073985"><span class="hs-identifier hs-type">muts</span></a></span><span>
</span><span id="line-815"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ArgNode"><span class="hs-identifier hs-type">ArgNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074019"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074020"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682074021"><span class="hs-identifier hs-type">pol'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682074016"><span class="hs-identifier hs-type">addPol</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-type">otimes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074021"><span class="hs-identifier hs-type">pol'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getArgOccurrence"><span class="hs-identifier hs-type">getArgOccurrence</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074019"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074020"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-817"></span><span>    </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#UnderInf"><span class="hs-identifier hs-var">UnderInf</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074016"><span class="hs-identifier hs-var">addPol</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span> </span><span class="hs-comment">-- Andreas, 2012-06-09: &#8734; is guarding</span><span>
</span><span id="line-818"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#ConArgType"><span class="hs-identifier hs-type">ConArgType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074025"><span class="hs-identifier hs-var">keepGoing</span></a></span><span>
</span><span id="line-819"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#IndArgType"><span class="hs-identifier hs-type">IndArgType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
forall {a}. TCMT IO (Maybe a, Occurrence)
</span><a href="#local-6989586621682074017"><span class="hs-identifier hs-var">mixed</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#ConEndpoint"><span class="hs-identifier hs-type">ConEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074025"><span class="hs-identifier hs-var">keepGoing</span></a></span><span>
</span><span id="line-821"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#InClause"><span class="hs-identifier hs-type">InClause</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074025"><span class="hs-identifier hs-var">keepGoing</span></a></span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Matched"><span class="hs-identifier hs-var">Matched</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
forall {a}. TCMT IO (Maybe a, Occurrence)
</span><a href="#local-6989586621682074017"><span class="hs-identifier hs-var">mixed</span></a></span><span> </span><span class="hs-comment">-- consider arguments matched against as used</span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#IsIndex"><span class="hs-identifier hs-var">IsIndex</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Node, Occurrence)
forall {a}. TCMT IO (Maybe a, Occurrence)
</span><a href="#local-6989586621682074017"><span class="hs-identifier hs-var">mixed</span></a></span><span> </span><span class="hs-comment">-- And similarly for indices.</span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#InDefOf"><span class="hs-identifier hs-type">InDefOf</span></a></span><span> </span><span id="local-6989586621682074026"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074026"><span class="hs-identifier hs-var">d</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-825"></span><span>      </span><span id="local-6989586621682074027"><span class="annot"><a href="#local-6989586621682074027"><span class="hs-identifier hs-var">pol'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Occurrence
</span><a href="#local-6989586621682074022"><span class="hs-identifier hs-var">isGuarding</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074026"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-type">DefNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074026"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682074027"><span class="hs-identifier hs-type">pol'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-828"></span><span>    </span><span id="local-6989586621682074025"><span class="annot"><span class="annottext">keepGoing :: TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074025"><span class="hs-identifier hs-var hs-var">keepGoing</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Node, Occurrence) -&gt; TCM (Maybe Node, Occurrence)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Node
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074013"><span class="hs-identifier hs-var">pol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>    </span><span id="local-6989586621682074017"><span class="annot"><span class="annottext">mixed :: TCMT IO (Maybe a, Occurrence)
</span><a href="#local-6989586621682074017"><span class="hs-identifier hs-var hs-var">mixed</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe a, Occurrence) -&gt; TCMT IO (Maybe a, Occurrence)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Mixed"><span class="hs-identifier hs-var">Mixed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>    </span><span id="local-6989586621682074018"><span class="annot"><span class="annottext">negative :: TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074018"><span class="hs-identifier hs-var hs-var">negative</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Node, Occurrence) -&gt; TCM (Maybe Node, Occurrence)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Node
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Occurrence
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-var">otimes</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074013"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#JustNeg"><span class="hs-identifier hs-var">JustNeg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>    </span><span id="local-6989586621682074016"><span class="annot"><span class="annottext">addPol :: Occurrence -&gt; TCM (Maybe Node, Occurrence)
</span><a href="#local-6989586621682074016"><span class="hs-identifier hs-var hs-var">addPol</span></a></span></span><span> </span><span id="local-6989586621682074031"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074031"><span class="hs-identifier hs-var">pol'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Node, Occurrence) -&gt; TCM (Maybe Node, Occurrence)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Node
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Occurrence -&gt; Occurrence
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-var">otimes</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074013"><span class="hs-identifier hs-var">pol</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074031"><span class="hs-identifier hs-var">pol'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span>  </span><span id="local-6989586621682074022"><span class="annot"><span class="annottext">isGuarding :: QName -&gt; TCMT IO Occurrence
</span><a href="#local-6989586621682074022"><span class="hs-identifier hs-var hs-var">isGuarding</span></a></span></span><span> </span><span id="local-6989586621682074034"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074034"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-834"></span><span>    </span><span class="annot"><span class="annottext">QName -&gt; TCM (Maybe DataOrRecord)
</span><a href="Agda.TypeChecking.Datatypes.html#isDataOrRecordType"><span class="hs-identifier hs-var">isDataOrRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074034"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Maybe DataOrRecord)
-&gt; (Maybe DataOrRecord -&gt; Occurrence) -&gt; TCMT IO Occurrence
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="Agda.Syntax.Common.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#GuardPos"><span class="hs-identifier hs-var">GuardPos</span></a></span><span>  </span><span class="hs-comment">-- a datatype is guarding</span><span>
</span><span id="line-836"></span><span>      </span><span class="annot"><span class="annottext">Maybe DataOrRecord
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#StrictPos"><span class="hs-identifier hs-var">StrictPos</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-comment">-- Pretty-printing -----------------------------------------------------</span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682074037"><span id="local-6989586621682074040"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-841"></span><span>  </span><span id="local-6989586621682074048"><span class="annot"><span class="annottext">pretty :: Node -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-842"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#DefNode"><span class="hs-identifier hs-type">DefNode</span></a></span><span> </span><span id="local-6989586621682074049"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074049"><span class="hs-identifier hs-var">q</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074049"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-843"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#ArgNode"><span class="hs-identifier hs-type">ArgNode</span></a></span><span> </span><span id="local-6989586621682074050"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074050"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682074051"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074051"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074050"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Doc
forall a. ArgName -&gt; Doc a
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074051"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCM"><span class="hs-identifier hs-type">PrettyTCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-846"></span><span>  </span><span id="local-6989586621682074061"><span class="annot"><span class="annottext">prettyTCM :: forall (m :: * -&gt; *). MonadPretty m =&gt; Node -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var hs-var hs-var">prettyTCM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; m Doc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m Doc) -&gt; (Node -&gt; Doc) -&gt; Node -&gt; m Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCMWithNode"><span class="hs-identifier hs-type">PrettyTCMWithNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-849"></span><span>  </span><span id="local-6989586621682074083"><span class="annot"><span class="annottext">prettyTCMWithNode :: forall n (m :: * -&gt; *).
(PrettyTCM n, MonadPretty m) =&gt;
WithNode n (Edge OccursWhere) -&gt; m Doc
</span><a href="#local-6989586621682074083"><span class="hs-identifier hs-var hs-var hs-var">prettyTCMWithNode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#WithNode"><span class="hs-identifier hs-type">WithNode</span></a></span><span> </span><span id="local-6989586621682074086"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682074086"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span id="local-6989586621682074087"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074087"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682074088"><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074088"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; m Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Occurrence -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074087"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; n -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682074086"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Functor m =&gt; Nat -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(m Doc -&gt; m Doc) -&gt; m Doc -&gt; m Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; m Doc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m Doc) -&gt; Doc -&gt; m Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursWhere -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074088"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-852"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCM"><span class="hs-identifier hs-type">PrettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-855"></span><span>  </span><span id="local-6989586621682074102"><span class="annot"><span class="annottext">prettyTCM :: forall (m :: * -&gt; *). MonadPretty m =&gt; Seq OccursWhere -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var hs-var hs-var">prettyTCM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-856"></span><span>    </span><span class="annot"><span class="annottext">((ArgName, Doc) -&gt; Doc) -&gt; m (ArgName, Doc) -&gt; m Doc
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(ArgName, Doc) -&gt; Doc
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(m (ArgName, Doc) -&gt; m Doc)
-&gt; (Seq OccursWhere -&gt; m (ArgName, Doc))
-&gt; Seq OccursWhere
-&gt; m Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[OccursWhere] -&gt; m (ArgName, Doc)
forall (m :: * -&gt; *).
MonadPretty m =&gt;
[OccursWhere] -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074103"><span class="hs-identifier hs-var">prettyOWs</span></a></span><span> </span><span class="annot"><span class="annottext">([OccursWhere] -&gt; m (ArgName, Doc))
-&gt; (Seq OccursWhere -&gt; [OccursWhere])
-&gt; Seq OccursWhere
-&gt; m (ArgName, Doc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OccursWhere -&gt; OccursWhere) -&gt; [OccursWhere] -&gt; [OccursWhere]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">OccursWhere -&gt; OccursWhere
</span><a href="#local-6989586621682074104"><span class="hs-identifier hs-var">adjustLeftOfArrow</span></a></span><span> </span><span class="annot"><span class="annottext">([OccursWhere] -&gt; [OccursWhere])
-&gt; (Seq OccursWhere -&gt; [OccursWhere])
-&gt; Seq OccursWhere
-&gt; [OccursWhere]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[OccursWhere] -&gt; [OccursWhere]
</span><a href="#local-6989586621682074105"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">([OccursWhere] -&gt; [OccursWhere])
-&gt; (Seq OccursWhere -&gt; [OccursWhere])
-&gt; Seq OccursWhere
-&gt; [OccursWhere]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Seq OccursWhere -&gt; [OccursWhere]
forall a. Seq a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span>
</span><span id="line-857"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-858"></span><span>      </span><span id="local-6989586621682074127"><span class="annot"><span class="annottext">nth :: a -&gt; [m Doc]
</span><a href="#local-6989586621682074127"><span class="hs-identifier hs-var hs-var">nth</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;first&quot;</span></span><span>
</span><span id="line-859"></span><span>      </span><span class="annot"><a href="#local-6989586621682074127"><span class="hs-identifier hs-var">nth</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;second&quot;</span></span><span>
</span><span id="line-860"></span><span>      </span><span class="annot"><a href="#local-6989586621682074127"><span class="hs-identifier hs-var">nth</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;third&quot;</span></span><span>
</span><span id="line-861"></span><span>      </span><span class="annot"><a href="#local-6989586621682074127"><span class="hs-identifier hs-var">nth</span></a></span><span> </span><span id="local-6989586621682074128"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682074128"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; [m Doc]) -&gt; ArgName -&gt; [m Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682074128"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;th&quot;</span></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>      </span><span class="hs-comment">-- Removes consecutive duplicates.</span><span>
</span><span id="line-864"></span><span>      </span><span class="annot"><a href="#local-6989586621682074105"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-865"></span><span>      </span><span id="local-6989586621682074105"><span class="annot"><span class="annottext">uniq :: [OccursWhere] -&gt; [OccursWhere]
</span><a href="#local-6989586621682074105"><span class="hs-identifier hs-var hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty OccursWhere -&gt; OccursWhere)
-&gt; [NonEmpty OccursWhere] -&gt; [OccursWhere]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty OccursWhere -&gt; OccursWhere
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.head</span></span><span> </span><span class="annot"><span class="annottext">([NonEmpty OccursWhere] -&gt; [OccursWhere])
-&gt; ([OccursWhere] -&gt; [NonEmpty OccursWhere])
-&gt; [OccursWhere]
-&gt; [OccursWhere]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OccursWhere -&gt; OccursWhere -&gt; Bool)
-&gt; [OccursWhere] -&gt; [NonEmpty OccursWhere]
forall (f :: * -&gt; *) a.
Foldable f =&gt;
(a -&gt; a -&gt; Bool) -&gt; f a -&gt; [NonEmpty a]
</span><span class="hs-identifier hs-var">List1.groupBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Where -&gt; Seq Where -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(Seq Where -&gt; Seq Where -&gt; Bool)
-&gt; (OccursWhere -&gt; Seq Where) -&gt; OccursWhere -&gt; OccursWhere -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">OccursWhere -&gt; Seq Where
</span><a href="#local-6989586621682074131"><span class="hs-identifier hs-var">snd'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-867"></span><span>        </span><span id="local-6989586621682074131"><span class="annot"><span class="annottext">snd' :: OccursWhere -&gt; Seq Where
</span><a href="#local-6989586621682074131"><span class="hs-identifier hs-var hs-var">snd'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682074132"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074132"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074132"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>      </span><span id="local-6989586621682072348"><span class="annot"><a href="#local-6989586621682074103"><span class="hs-identifier hs-type">prettyOWs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072348"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682072348"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-870"></span><span>      </span><span id="local-6989586621682074103"><span class="annot"><span class="annottext">prettyOWs :: forall (m :: * -&gt; *).
MonadPretty m =&gt;
[OccursWhere] -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074103"><span class="hs-identifier hs-var hs-var">prettyOWs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (ArgName, Doc)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="annot"><a href="#local-6989586621682074103"><span class="hs-identifier hs-var">prettyOWs</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682074151"><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074151"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682074152"><span class="annot"><a href="#local-6989586621682074152"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074153"><span class="annot"><a href="#local-6989586621682074153"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccursWhere -&gt; m (ArgName, Doc)
forall (m :: * -&gt; *).
MonadPretty m =&gt;
OccursWhere -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074154"><span class="hs-identifier hs-var">prettyOW</span></a></span><span> </span><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074151"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-873"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682074152"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682074153"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>      </span><span class="annot"><a href="#local-6989586621682074103"><span class="hs-identifier hs-var">prettyOWs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682074155"><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074155"><span class="hs-identifier hs-var">o</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682074156"><span class="annot"><span class="annottext">[OccursWhere]
</span><a href="#local-6989586621682074156"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-875"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682074157"><span class="annot"><a href="#local-6989586621682074157"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074158"><span class="annot"><a href="#local-6989586621682074158"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccursWhere -&gt; m (ArgName, Doc)
forall (m :: * -&gt; *).
MonadPretty m =&gt;
OccursWhere -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074154"><span class="hs-identifier hs-var">prettyOW</span></a></span><span>  </span><span class="annot"><span class="annottext">OccursWhere
</span><a href="#local-6989586621682074155"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-876"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682074159"><span class="annot"><a href="#local-6989586621682074159"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074160"><span class="annot"><a href="#local-6989586621682074160"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682074103"><span class="hs-identifier hs-type">prettyOWs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074156"><span class="hs-identifier hs-type">os</span></a></span><span>
</span><span id="line-877"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682074157"><span class="hs-identifier hs-type">s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682074158"><span class="hs-identifier hs-type">d1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;which&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.text</span></span><span> </span><span class="annot"><a href="#local-6989586621682074159"><span class="hs-identifier hs-type">s2</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">P.$$</span></span><span> </span><span class="annot"><a href="#local-6989586621682074160"><span class="hs-identifier hs-type">d2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>      </span><span id="local-6989586621682072356"><span class="annot"><a href="#local-6989586621682074154"><span class="hs-identifier hs-type">prettyOW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682072356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-880"></span><span>      </span><span id="local-6989586621682074154"><span class="annot"><span class="annottext">prettyOW :: forall (m :: * -&gt; *).
MonadPretty m =&gt;
OccursWhere -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074154"><span class="hs-identifier hs-var hs-var">prettyOW</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682074177"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074177"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682074178"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074178"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074177"><span class="hs-identifier hs-var">cs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; m (ArgName, Doc)
forall (m :: * -&gt; *).
MonadPretty m =&gt;
Seq Where -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074179"><span class="hs-identifier hs-var">prettyWs</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074178"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-882"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-883"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682074180"><span class="annot"><a href="#local-6989586621682074180"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074181"><span class="annot"><a href="#local-6989586621682074181"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; m (ArgName, Doc)
forall (m :: * -&gt; *).
MonadPretty m =&gt;
Seq Where -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074179"><span class="hs-identifier hs-var">prettyWs</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074178"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-884"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074182"><span class="annot"><a href="#local-6989586621682074182"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682074179"><span class="hs-identifier hs-type">prettyWs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074177"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-885"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682074180"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682074181"><span class="hs-identifier hs-type">d1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">P.$$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682074182"><span class="hs-identifier hs-type">d2</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span>      </span><span id="local-6989586621682072359"><span class="annot"><a href="#local-6989586621682074179"><span class="hs-identifier hs-type">prettyWs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072359"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682072359"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-888"></span><span>      </span><span id="local-6989586621682074179"><span class="annot"><span class="annottext">prettyWs :: forall (m :: * -&gt; *).
MonadPretty m =&gt;
Seq Where -&gt; m (ArgName, Doc)
</span><a href="#local-6989586621682074179"><span class="hs-identifier hs-var hs-var">prettyWs</span></a></span></span><span> </span><span id="local-6989586621682074208"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074208"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; [Where]
forall a. Seq a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Fold.toList</span></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074208"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#InDefOf"><span class="hs-identifier hs-type">InDefOf</span></a></span><span> </span><span id="local-6989586621682074209"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074209"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#IsIndex"><span class="hs-identifier hs-var">IsIndex</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-890"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;is&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; (ArgName, Doc)) -&gt; m Doc -&gt; m (ArgName, Doc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; m Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;an index of&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074209"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>        </span><span class="annot"><span class="annottext">[Where]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-892"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; (ArgName, Doc)) -&gt; m Doc -&gt; m (ArgName, Doc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-893"></span><span>            </span><span class="annot"><span class="annottext">(Where -&gt; Doc -&gt; m Doc) -&gt; Doc -&gt; Seq Where -&gt; m Doc
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">Fold.foldrM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682074211"><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682074211"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682074212"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621682074212"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; m Doc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621682074212"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; m Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Where -&gt; [m Doc]
forall (m :: * -&gt; *). MonadPretty m =&gt; Where -&gt; [m Doc]
</span><a href="#local-6989586621682074214"><span class="hs-identifier hs-var">prettyW</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682074211"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074208"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>      </span><span id="local-6989586621682072366"><span class="annot"><a href="#local-6989586621682074214"><span class="hs-identifier hs-type">prettyW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#MonadPretty"><span class="hs-identifier hs-type">MonadPretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682072366"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Where"><span class="hs-identifier hs-type">Where</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682072366"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-896"></span><span>      </span><span id="local-6989586621682074214"><span class="annot"><span class="annottext">prettyW :: forall (m :: * -&gt; *). MonadPretty m =&gt; Where -&gt; [m Doc]
</span><a href="#local-6989586621682074214"><span class="hs-identifier hs-var hs-var">prettyW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-897"></span><span>        </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#LeftOfArrow"><span class="hs-identifier hs-var">LeftOfArrow</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;to the left of an arrow&quot;</span></span><span>
</span><span id="line-898"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#DefArg"><span class="hs-identifier hs-type">DefArg</span></a></span><span> </span><span id="local-6989586621682074270"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074270"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682074271"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074271"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in the&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [m Doc]
forall {a} {m :: * -&gt; *}.
(Eq a, Num a, Applicative m, Show a) =&gt;
a -&gt; [m Doc]
</span><a href="#local-6989586621682074127"><span class="hs-identifier hs-var">nth</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074271"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;argument of&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-899"></span><span>                          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074270"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-900"></span><span>        </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#UnderInf"><span class="hs-identifier hs-var">UnderInf</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;under&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-901"></span><span>                        </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- this cannot fail if an 'UnderInf' has been generated</span><span>
</span><span id="line-902"></span><span>                            </span><span id="local-6989586621682074272"><span class="annot"><a href="#local-6989586621682074272"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName -&gt; QName
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">QName
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe QName -&gt; QName) -&gt; m (Maybe QName) -&gt; m QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; m (Maybe QName)
forall (m :: * -&gt; *). HasBuiltins m =&gt; BuiltinId -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-var">getBuiltinName'</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinInf"><span class="hs-identifier hs-var">builtinInf</span></a></span><span>
</span><span id="line-903"></span><span>                            </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074272"><span class="hs-identifier hs-type">inf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-904"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#VarArg"><span class="hs-identifier hs-type">VarArg</span></a></span><span> </span><span id="local-6989586621682074275"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074275"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682074276"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074276"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in an argument of a bound variable at position&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nat -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Nat -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074276"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-905"></span><span>                        </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;which uses its argument with polarity&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; m Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621682074275"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-906"></span><span>        </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#MetaArg"><span class="hs-identifier hs-var">MetaArg</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in an argument of a metavariable&quot;</span></span><span>
</span><span id="line-907"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#ConArgType"><span class="hs-identifier hs-type">ConArgType</span></a></span><span> </span><span id="local-6989586621682074277"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074277"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in the type of the constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074277"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-908"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#IndArgType"><span class="hs-identifier hs-type">IndArgType</span></a></span><span> </span><span id="local-6989586621682074278"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074278"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in an index of the target type of the constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074278"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-909"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#ConEndpoint"><span class="hs-identifier hs-type">ConEndpoint</span></a></span><span> </span><span id="local-6989586621682074279"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074279"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-910"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in an endpoint of the target of the&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-911"></span><span>                        </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;higher constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074279"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-912"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#InClause"><span class="hs-identifier hs-type">InClause</span></a></span><span> </span><span id="local-6989586621682074280"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074280"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in the&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [m Doc]
forall {a} {m :: * -&gt; *}.
(Eq a, Num a, Applicative m, Show a) =&gt;
a -&gt; [m Doc]
</span><a href="#local-6989586621682074127"><span class="hs-identifier hs-var">nth</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682074280"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;clause&quot;</span></span><span>
</span><span id="line-913"></span><span>        </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Matched"><span class="hs-identifier hs-var">Matched</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;as matched against&quot;</span></span><span>
</span><span id="line-914"></span><span>        </span><span class="annot"><span class="annottext">Where
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#IsIndex"><span class="hs-identifier hs-var">IsIndex</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;as an index&quot;</span></span><span>
</span><span id="line-915"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#InDefOf"><span class="hs-identifier hs-type">InDefOf</span></a></span><span> </span><span id="local-6989586621682074281"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074281"><span class="hs-identifier hs-var">d</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; [m Doc]
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; [m Doc]
</span><a href="Agda.TypeChecking.Pretty.html#pwords"><span class="hs-identifier hs-var">pwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in the definition of&quot;</span></span><span> </span><span class="annot"><span class="annottext">[m Doc] -&gt; [m Doc] -&gt; [m Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; m Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682074281"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-916"></span><span>
</span><span id="line-917"></span><span>      </span><span class="annot"><a href="#local-6989586621682074104"><span class="hs-identifier hs-type">adjustLeftOfArrow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span>
</span><span id="line-918"></span><span>      </span><span id="local-6989586621682074104"><span class="annot"><span class="annottext">adjustLeftOfArrow :: OccursWhere -&gt; OccursWhere
</span><a href="#local-6989586621682074104"><span class="hs-identifier hs-var hs-var">adjustLeftOfArrow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-type">OccursWhere</span></a></span><span> </span><span id="local-6989586621682074282"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682074282"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682074283"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074283"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682074284"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074284"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-919"></span><span>        </span><span class="annot"><span class="annottext">Range -&gt; Seq Where -&gt; Seq Where -&gt; OccursWhere
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#OccursWhere"><span class="hs-identifier hs-var">OccursWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682074282"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Where -&gt; Bool) -&gt; Seq Where -&gt; Seq Where
forall a. (a -&gt; Bool) -&gt; Seq a -&gt; Seq a
</span><span class="hs-identifier hs-var">DS.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Where -&gt; Bool) -&gt; Where -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Where -&gt; Bool
</span><a href="#local-6989586621682074287"><span class="hs-identifier hs-var">isArrow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074283"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Seq Where -&gt; OccursWhere) -&gt; Seq Where -&gt; OccursWhere
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-920"></span><span>          </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074288"><span class="hs-identifier hs-var">noArrows</span></a></span><span>
</span><span id="line-921"></span><span>            </span><span class="annot"><span class="annottext">Seq Where -&gt; Seq Where -&gt; Seq Where
forall a. Seq a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">DS.&gt;&lt;</span></span><span>
</span><span id="line-922"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Seq Where -&gt; ViewL Where
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">DS.viewl</span></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074290"><span class="hs-identifier hs-var">startsWithArrow</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-923"></span><span>            </span><span class="annot"><span class="annottext">ViewL Where
</span><span class="hs-identifier hs-var">DS.EmptyL</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Seq Where
forall a. Seq a
</span><span class="hs-identifier hs-var">DS.empty</span></span><span>
</span><span id="line-924"></span><span>            </span><span id="local-6989586621682074292"><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682074292"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">DS.:&lt;</span></span><span> </span><span id="local-6989586621682074294"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074294"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Where
</span><a href="#local-6989586621682074292"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Where -&gt; Seq Where -&gt; Seq Where
forall a. a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">DS.&lt;|</span></span><span> </span><span class="annot"><span class="annottext">(Where -&gt; Bool) -&gt; Seq Where -&gt; Seq Where
forall a. (a -&gt; Bool) -&gt; Seq a -&gt; Seq a
</span><span class="hs-identifier hs-var">DS.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Where -&gt; Bool) -&gt; Where -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Where -&gt; Bool
</span><a href="#local-6989586621682074287"><span class="hs-identifier hs-var">isArrow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074294"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682074288"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074288"><span class="hs-identifier hs-var">noArrows</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682074290"><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074290"><span class="hs-identifier hs-var">startsWithArrow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Where -&gt; Bool) -&gt; Seq Where -&gt; (Seq Where, Seq Where)
forall a. (a -&gt; Bool) -&gt; Seq a -&gt; (Seq a, Seq a)
</span><span class="hs-identifier hs-var">DS.breakl</span></span><span> </span><span class="annot"><span class="annottext">Where -&gt; Bool
</span><a href="#local-6989586621682074287"><span class="hs-identifier hs-var">isArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Where
</span><a href="#local-6989586621682074284"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span>        </span><span id="local-6989586621682074287"><span class="annot"><span class="annottext">isArrow :: Where -&gt; Bool
</span><a href="#local-6989586621682074287"><span class="hs-identifier hs-var hs-var">isArrow</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#LeftOfArrow"><span class="hs-identifier hs-type">LeftOfArrow</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-929"></span><span>        </span><span class="annot"><a href="#local-6989586621682074287"><span class="hs-identifier hs-var">isArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Where
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-930"></span></pre></body></html>