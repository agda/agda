<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Rewriting with arbitrary rules.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">--   The user specifies a relation symbol by the pragma</span><span>
</span><span id="line-8"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-9"></span><span class="hs-comment">--       {-\# BUILTIN REWRITE rel \#-}</span><span>
</span><span id="line-10"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-11"></span><span class="hs-comment">--   where @rel@ should be of type @&#916; &#8594; (lhs rhs : A) &#8594; Set i@.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">--   Then the user can add rewrite rules by the pragma</span><span>
</span><span id="line-14"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-15"></span><span class="hs-comment">--       {-\# REWRITE q \#-}</span><span>
</span><span id="line-16"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-17"></span><span class="hs-comment">--   where @q@ should be a closed term of type @&#915; &#8594; rel us lhs rhs@.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">--   We then intend to add a rewrite rule</span><span>
</span><span id="line-20"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-21"></span><span class="hs-comment">--       &#915; &#8866; lhs &#8614; rhs : B</span><span>
</span><span id="line-22"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-23"></span><span class="hs-comment">--   to the signature where @B = A[us/&#916;]@.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">--   To this end, we normalize @lhs@, which should be of the form</span><span>
</span><span id="line-26"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-27"></span><span class="hs-comment">--       f ts</span><span>
</span><span id="line-28"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-29"></span><span class="hs-comment">--   for a @'Def'@-symbol f (postulate, function, data, record, constructor).</span><span>
</span><span id="line-30"></span><span class="hs-comment">--   Further, @FV(ts) = dom(&#915;)@.</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   The rule @q :: &#915; &#8866; f ts &#8614; rhs : B@ is added to the signature</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   to the definition of @f@.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   When reducing a term @&#936; &#8866; f vs@ is stuck, we try the rewrites for @f@,</span><span>
</span><span id="line-35"></span><span class="hs-comment">--   by trying to unify @vs@ with @ts@.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   This is for now done by substituting fresh metas Xs for the bound</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   variables in @ts@ and checking equality with @vs@</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-39"></span><span class="hs-comment">--       &#936; &#8866; (f ts)[Xs/&#915;] = f vs : B[Xs/&#915;]</span><span>
</span><span id="line-40"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-41"></span><span class="hs-comment">--   If successful (no open metas/constraints), we replace @f vs@ by</span><span>
</span><span id="line-42"></span><span class="hs-comment">--   @rhs[Xs/&#915;]@ and continue reducing.</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runMaybeT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pos</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.Confluence</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinMatch.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.NonLinMatch</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.NonLinPattern</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Set1.html"><span class="hs-identifier">Agda.Utils.Set1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set1</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.SmallSet.html"><span class="hs-identifier">Agda.Utils.SmallSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SmallSet</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html"><span class="hs-identifier">Agda.Utils.VarSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VarSet</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html"><span class="hs-identifier">Agda.Utils.VarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier">VarSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html"><span class="hs-identifier">Agda.Utils.Either</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-type">requireOptionRewriting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span id="requireOptionRewriting"><span class="annot"><span class="annottext">requireOptionRewriting :: TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-var hs-var">requireOptionRewriting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier hs-var">optRewriting</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NeedOptionRewriting"><span class="hs-identifier hs-var">NeedOptionRewriting</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | Check that the name given to the BUILTIN REWRITE is actually</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   a relation symbol.</span><span>
</span><span id="line-98"></span><span class="hs-comment">--   I.e., its type should be of the form @&#916; &#8594; (lhs : A) (rhs : B) &#8594; Set &#8467;@.</span><span>
</span><span id="line-99"></span><span class="hs-comment">--   Note: we do not care about hiding/non-hiding of lhs and rhs.</span><span>
</span><span id="line-100"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#verifyBuiltinRewrite"><span class="hs-identifier hs-type">verifyBuiltinRewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="verifyBuiltinRewrite"><span class="annot"><span class="annottext">verifyBuiltinRewrite :: Term -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#verifyBuiltinRewrite"><span class="hs-identifier hs-var hs-var">verifyBuiltinRewrite</span></a></span></span><span> </span><span id="local-6989586621682088721"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088721"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682088722"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088722"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-var">requireOptionRewriting</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Maybe RelView) -&gt; TCM () -&gt; (RelView -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe RelView)
</span><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-var">relView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088722"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; IncorrectTypeForRewriteRelationReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IncorrectTypeForRewriteRelation"><span class="hs-identifier hs-var">IncorrectTypeForRewriteRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088721"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IncorrectTypeForRewriteRelationReason
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldAcceptAtLeastTwoArguments"><span class="hs-identifier hs-var">ShouldAcceptAtLeastTwoArguments</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((RelView -&gt; TCM ()) -&gt; TCM ()) -&gt; (RelView -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span> </span><span id="local-6989586621682088728"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088728"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682088729"><span class="annot"><span class="annottext">[Dom (ArgName, Type)]
</span><a href="#local-6989586621682088729"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682088730"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682088730"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682088731"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682088731"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682088732"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088732"><span class="hs-identifier hs-var">core</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682088730"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682088731"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; IncorrectTypeForRewriteRelationReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IncorrectTypeForRewriteRelation"><span class="hs-identifier hs-var">IncorrectTypeForRewriteRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088721"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IncorrectTypeForRewriteRelationReason
</span><a href="Agda.TypeChecking.Monad.Base.html#FinalTwoArgumentsNotVisible"><span class="hs-identifier hs-var">FinalTwoArgumentsNotVisible</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088732"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; IncorrectTypeForRewriteRelationReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IncorrectTypeForRewriteRelation"><span class="hs-identifier hs-var">IncorrectTypeForRewriteRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088721"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Tele (Dom Type) -&gt; IncorrectTypeForRewriteRelationReason
</span><a href="Agda.TypeChecking.Monad.Base.html#TypeDoesNotEndInSort"><span class="hs-identifier hs-var">TypeDoesNotEndInSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088732"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088728"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><span class="hs-comment">-- | Deconstructing a type into @&#916; &#8594; t &#8594; t' &#8594; core@.</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">data</span><span> </span><span id="RelView"><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-var">RelView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RelView"><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-var">RelView</span></a></span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="relViewTel"><span class="annot"><span class="annottext">RelView -&gt; Tele (Dom Type)
</span><a href="Agda.TypeChecking.Rewriting.html#relViewTel"><span class="hs-identifier hs-var hs-var">relViewTel</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The whole telescope @&#916;, t, t'@.</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewDelta"><span class="annot"><span class="annottext">RelView -&gt; [Dom (ArgName, Type)]
</span><a href="Agda.TypeChecking.Rewriting.html#relViewDelta"><span class="hs-identifier hs-var hs-var">relViewDelta</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ListTel"><span class="hs-identifier hs-type">ListTel</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ @&#916;@.</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewType"><span class="annot"><span class="annottext">RelView -&gt; Dom Type
</span><a href="Agda.TypeChecking.Rewriting.html#relViewType"><span class="hs-identifier hs-var hs-var">relViewType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @t@.</span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewType%27"><span class="annot"><span class="annottext">RelView -&gt; Dom Type
</span><a href="Agda.TypeChecking.Rewriting.html#relViewType%27"><span class="hs-identifier hs-var hs-var">relViewType'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @t'@.</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="relViewCore"><span class="annot"><span class="annottext">RelView -&gt; Type
</span><a href="Agda.TypeChecking.Rewriting.html#relViewCore"><span class="hs-identifier hs-var hs-var">relViewCore</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ @core@.</span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | Deconstructing a type into @&#916; &#8594; t &#8594; t' &#8594; core@.</span><span>
</span><span id="line-125"></span><span class="hs-comment">--   Returns @Nothing@ if not enough argument types.</span><span>
</span><span id="line-126"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-type">relView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="relView"><span class="annot"><span class="annottext">relView :: Type -&gt; TCMT IO (Maybe RelView)
</span><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-var hs-var">relView</span></a></span></span><span> </span><span id="local-6989586621682088752"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088752"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682088754"><span class="annot"><a href="#local-6989586621682088754"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682088755"><span class="annot"><a href="#local-6989586621682088755"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682088752"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088757"><span class="annot"><a href="#local-6989586621682088757"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088754"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682088759"><span class="annot"><a href="#local-6989586621682088759"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088760"><span class="annot"><a href="#local-6989586621682088760"><span class="hs-identifier hs-var">lastTwo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088757"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-type">telToList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088754"><span class="hs-identifier hs-type">tel</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088760"><span class="hs-identifier hs-type">lastTwo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682088764"><span class="annot"><a href="#local-6989586621682088764"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088765"><span class="annot"><a href="#local-6989586621682088765"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682088760"><span class="hs-identifier hs-type">lastTwo</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088754"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088759"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088765"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088755"><span class="hs-identifier hs-type">core</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><span class="hs-comment">-- | Check the given rewrite rules and add them to the signature.</span></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#addRewriteRules"><span class="hs-identifier hs-type">addRewriteRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span id="addRewriteRules"><span class="annot"><span class="annottext">addRewriteRules :: [QName] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#addRewriteRules"><span class="hs-identifier hs-var hs-var">addRewriteRules</span></a></span></span><span> </span><span id="local-6989586621682088768"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682088768"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-comment">-- Check the rewrite rules</span><span>
</span><span id="line-140"></span><span>  </span><span id="local-6989586621682088769"><span class="annot"><a href="#local-6989586621682088769"><span class="hs-identifier hs-var">rews</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO (Maybe RewriteRule))
-&gt; [QName] -&gt; TCMT IO RewriteRules
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="Agda.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO (Maybe RewriteRule)
</span><a href="Agda.TypeChecking.Rewriting.html#checkRewriteRule"><span class="hs-identifier hs-var">checkRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682088768"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-comment">-- Add rewrite rules to the signature</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682088769"><span class="hs-identifier hs-type">rews</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088773"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088774"><span class="annot"><span class="annottext">f :: QName
</span><a href="#local-6989586621682088774"><span class="hs-identifier hs-var hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewHead"><span class="hs-identifier hs-var">rewHead</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-145"></span><span>        </span><span id="local-6989586621682088776"><span class="annot"><span class="annottext">matchables :: [QName]
</span><a href="#local-6989586621682088776"><span class="hs-identifier hs-var hs-var hs-var">matchables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; [QName]
forall a. GetMatchables a =&gt; a -&gt; [QName]
</span><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#getMatchables"><span class="hs-identifier hs-var">getMatchables</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;adding rule&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-148"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;to the definition of&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088774"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;matchable symbols: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; [QName] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682088776"><span class="hs-identifier hs-var">matchables</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; TCM ())
-&gt; (Signature -&gt; Signature) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; RewriteRules -&gt; [QName] -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#addRewriteRulesFor"><span class="hs-identifier hs-var">addRewriteRulesFor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088774"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682088776"><span class="hs-identifier hs-var">matchables</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-comment">-- Run confluence check for the new rules</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-comment">-- (should be done after adding all rules, see #3795)</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-type">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-type">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088786"><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682088786"><span class="hs-identifier hs-var">confChk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- Warn if --cubical is enabled</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO (Maybe Cubical) -&gt; (Cubical -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Cubical)
forall (m :: * -&gt; *). HasOptions m =&gt; m (Maybe Cubical)
</span><a href="Agda.TypeChecking.Monad.Base.html#cubicalOption"><span class="hs-identifier hs-var">cubicalOption</span></a></span><span> </span><span class="annot"><span class="annottext">((Cubical -&gt; TCM ()) -&gt; TCM ()) -&gt; (Cubical -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Cubical
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#ConfluenceForCubicalNotSupported"><span class="hs-identifier hs-var">ConfluenceForCubicalNotSupported</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- Global confluence checker requires rules to be sorted</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- according to the generality of their lhs</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682088786"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; ConfluenceCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="Agda.Interaction.Options.Types.html#GlobalConfluenceCheck"><span class="hs-identifier hs-var">GlobalConfluenceCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><span class="annottext">[QName] -&gt; (QName -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; QName) -&gt; [QName] -&gt; [QName]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier hs-var">nubOn</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [QName]) -&gt; [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RewriteRule -&gt; QName) -&gt; RewriteRules -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewHead"><span class="hs-identifier hs-var">rewHead</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682088769"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#sortRulesOfSymbol"><span class="hs-identifier hs-var">sortRulesOfSymbol</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; RewriteRules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfRules"><span class="hs-identifier hs-var">checkConfluenceOfRules</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682088786"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682088769"><span class="hs-identifier hs-var">rews</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;done checking confluence of rules&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RewriteRule -&gt; TCMT IO Doc) -&gt; RewriteRules -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc)
-&gt; (RewriteRule -&gt; QName) -&gt; RewriteRule -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682088769"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- Auxiliary function for checkRewriteRule.</span><span>
</span><span id="line-166"></span><span class="annot"><span class="hs-comment">-- | Get domain of rewrite relation.</span></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewriteRelationDom"><span class="hs-identifier hs-type">rewriteRelationDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ListTel"><span class="hs-identifier hs-type">ListTel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span id="rewriteRelationDom"><span class="annot"><span class="annottext">rewriteRelationDom :: QName -&gt; TCM ([Dom (ArgName, Type)], Dom Type)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteRelationDom"><span class="hs-identifier hs-var hs-var">rewriteRelationDom</span></a></span></span><span> </span><span id="local-6989586621682088799"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088799"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-comment">-- We know that the type of rel is that of a relation.</span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621682088800"><span class="annot"><a href="#local-6989586621682088800"><span class="hs-identifier hs-var">relV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe RelView)
</span><a href="Agda.TypeChecking.Rewriting.html#relView"><span class="hs-identifier hs-var">relView</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (Maybe RelView))
-&gt; TCMT IO Type -&gt; TCMT IO (Maybe RelView)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Type) -&gt; TCMT IO Definition -&gt; TCMT IO Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088799"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#RelView"><span class="hs-identifier hs-type">RelView</span></a></span><span> </span><span id="local-6989586621682088804"><span class="annot"><a href="#local-6989586621682088804"><span class="hs-identifier hs-var">_tel</span></a></span></span><span> </span><span id="local-6989586621682088805"><span class="annot"><a href="#local-6989586621682088805"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682088806"><span class="annot"><a href="#local-6989586621682088806"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682088807"><span class="annot"><a href="#local-6989586621682088807"><span class="hs-identifier hs-var">_a'</span></a></span></span><span> </span><span id="local-6989586621682088808"><span class="annot"><a href="#local-6989586621682088808"><span class="hs-identifier hs-var">_core</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088800"><span class="hs-identifier hs-type">relV</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="hs-string">&quot;rewrite relation at type &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-type">telFromList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088805"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; |- &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088805"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088806"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088805"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088806"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Check the validity of @q : &#915; &#8594; rel us lhs rhs@ as rewrite rule</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-180"></span><span class="hs-comment">--       &#915; &#8866; lhs &#8614; rhs : B</span><span>
</span><span id="line-181"></span><span class="hs-comment">--   @</span><span>
</span><span id="line-182"></span><span class="hs-comment">--   where @B = A[us/&#916;]@.</span><span>
</span><span id="line-183"></span><span class="hs-comment">--   Remember that @rel : &#916; &#8594; A &#8594; A &#8594; Set i@, so</span><span>
</span><span id="line-184"></span><span class="hs-comment">--   @rel us : (lhs rhs : A[us/&#916;]) &#8594; Set i@.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--   Returns the checked rewrite rule to be added to the signature.</span><span>
</span><span id="line-186"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#checkRewriteRule"><span class="hs-identifier hs-type">checkRewriteRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span id="checkRewriteRule"><span class="annot"><span class="annottext">checkRewriteRule :: QName -&gt; TCMT IO (Maybe RewriteRule)
</span><a href="Agda.TypeChecking.Rewriting.html#checkRewriteRule"><span class="hs-identifier hs-var hs-var">checkRewriteRule</span></a></span></span><span> </span><span id="local-6989586621682088813"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088813"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) RewriteRule -&gt; TCMT IO (Maybe RewriteRule)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) RewriteRule -&gt; TCMT IO (Maybe RewriteRule))
-&gt; MaybeT (TCMT IO) RewriteRule -&gt; TCMT IO (Maybe RewriteRule)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName
-&gt; MaybeT (TCMT IO) RewriteRule -&gt; MaybeT (TCMT IO) RewriteRule
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088813"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.TypeChecking.Rewriting.html#requireOptionRewriting"><span class="hs-identifier hs-var">requireOptionRewriting</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621682088816"><span class="annot"><a href="#local-6989586621682088816"><span class="hs-identifier hs-var">rels</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Set QName) -&gt; MaybeT (TCMT IO) (Set QName)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Set QName)
forall (m :: * -&gt; *).
(HasBuiltins m, MonadTCError m) =&gt;
m (Set QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinRewriteRelations"><span class="hs-identifier hs-var">getBuiltinRewriteRelations</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting.relations&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Rewrite relations:&quot;</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682088816"><span class="hs-identifier hs-type">rels</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621682088820"><span class="annot"><a href="#local-6989586621682088820"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#instantiateDef"><span class="hs-identifier hs-type">instantiateDef</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088813"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-comment">-- Issue 1651: Check that we are not adding a rewrite rule</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-comment">-- for a type signature whose body has not been type-checked yet.</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#isEmptyFunction"><span class="hs-identifier hs-type">isEmptyFunction</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088820"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="#local-6989586621682088824"><span class="hs-identifier hs-type">illegalRule</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BeforeFunctionDefinition"><span class="hs-identifier hs-type">BeforeFunctionDefinition</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-comment">-- Issue 6643: Also check that there are no mututal definitions</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-comment">-- that are not yet defined.</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-type">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envMutualBlock"><span class="hs-identifier hs-var">envMutualBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682088828"><span class="annot"><span class="annottext">MutualId
</span><a href="#local-6989586621682088828"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621682088829"><span class="annot"><a href="#local-6989586621682088829"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutualBlock -&gt; Set QName
</span><a href="Agda.TypeChecking.Monad.Base.html#mutualNames"><span class="hs-identifier hs-var">mutualNames</span></a></span><span> </span><span class="annot"><span class="annottext">(MutualBlock -&gt; Set QName)
-&gt; MaybeT (TCMT IO) MutualBlock -&gt; MaybeT (TCMT IO) (Set QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MutualId -&gt; MaybeT (TCMT IO) MutualBlock
forall (tcm :: * -&gt; *).
ReadTCState tcm =&gt;
MutualId -&gt; tcm MutualBlock
</span><a href="Agda.TypeChecking.Monad.Mutual.html#lookupMutualBlock"><span class="hs-identifier hs-var">lookupMutualBlock</span></a></span><span> </span><span class="annot"><span class="annottext">MutualId
</span><a href="#local-6989586621682088828"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.member</span></span><span> </span><span class="annot"><a href="#local-6989586621682088813"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088829"><span class="hs-identifier hs-type">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682088829"><span class="hs-identifier hs-type">qs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088833"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088833"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Bool -&gt; MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#isEmptyFunction"><span class="hs-identifier hs-var">isEmptyFunction</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Bool) -&gt; (Definition -&gt; Defn) -&gt; Definition -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Bool)
-&gt; MaybeT (TCMT IO) Definition -&gt; MaybeT (TCMT IO) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MaybeT (TCMT IO) Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088833"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ())
-&gt; MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ()
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ())
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#BeforeMutualFunctionDefinition"><span class="hs-identifier hs-var">BeforeMutualFunctionDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088833"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-comment">-- Get rewrite rule (type of q).</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682088836"><span class="annot"><a href="#local-6989586621682088836"><span class="hs-identifier hs-var">gamma1</span></a></span></span><span> </span><span id="local-6989586621682088837"><span class="annot"><a href="#local-6989586621682088837"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-type">telView</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088820"><span class="hs-identifier hs-type">def</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;attempting to add rewrite rule of type &quot;</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088836"><span class="hs-identifier hs-type">gamma1</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; |- &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088836"><span class="hs-identifier hs-type">gamma1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088837"><span class="hs-identifier hs-type">core</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087925"><span class="annot"><a href="#local-6989586621682088838"><span class="hs-identifier hs-type">failureBlocked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087925"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-216"></span><span>      </span><span id="local-6989586621682088838"><span class="annot"><a href="#local-6989586621682088838"><span class="hs-identifier hs-var hs-var">failureBlocked</span></a></span></span><span> </span><span id="local-6989586621682088841"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682088841"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set1.IsNonEmpty</span></span><span> </span><span id="local-6989586621682088843"><span class="annot"><span class="annottext">NESet MetaId
</span><a href="#local-6989586621682088843"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set MetaId
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingMetas"><span class="hs-identifier hs-var">allBlockingMetas</span></a></span><span>    </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682088841"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NESet MetaId -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#ContainsUnsolvedMetaVariables"><span class="hs-identifier hs-var">ContainsUnsolvedMetaVariables</span></a></span><span> </span><span class="annot"><span class="annottext">NESet MetaId
</span><a href="#local-6989586621682088843"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set1.IsNonEmpty</span></span><span> </span><span id="local-6989586621682088846"><span class="annot"><span class="annottext">NESet ProblemId
</span><a href="#local-6989586621682088846"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set ProblemId
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingProblems"><span class="hs-identifier hs-var">allBlockingProblems</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682088841"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NESet ProblemId -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#BlockedOnProblems"><span class="hs-identifier hs-var">BlockedOnProblems</span></a></span><span> </span><span class="annot"><span class="annottext">NESet ProblemId
</span><a href="#local-6989586621682088846"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set1.IsNonEmpty</span></span><span> </span><span id="local-6989586621682088849"><span class="annot"><span class="annottext">NESet QName
</span><a href="#local-6989586621682088849"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set QName
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingDefs"><span class="hs-identifier hs-var">allBlockingDefs</span></a></span><span>     </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682088841"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NESet QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#RequiresDefinitions"><span class="hs-identifier hs-var">RequiresDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">NESet QName
</span><a href="#local-6989586621682088849"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) a
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087929"><span class="annot"><a href="#local-6989586621682088852"><span class="hs-identifier hs-type">failureFreeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087929"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-222"></span><span>      </span><span id="local-6989586621682088852"><span class="annot"><a href="#local-6989586621682088852"><span class="hs-identifier hs-var hs-var">failureFreeVars</span></a></span></span><span> </span><span id="local-6989586621682088853"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088853"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#VariablesNotBoundByLHS"><span class="hs-identifier hs-var">VariablesNotBoundByLHS</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088853"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088855"><span class="annot"><a href="#local-6989586621682088856"><span class="hs-identifier hs-type">failureNonLinearPars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088855"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-224"></span><span>      </span><span id="local-6989586621682088856"><span class="annot"><a href="#local-6989586621682088856"><span class="hs-identifier hs-var hs-var">failureNonLinearPars</span></a></span></span><span> </span><span id="local-6989586621682088857"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088857"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#VariablesBoundMoreThanOnce"><span class="hs-identifier hs-var">VariablesBoundMoreThanOnce</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088857"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-comment">-- Check that type of q targets rel.</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088837"><span class="hs-identifier hs-type">core</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682088859"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088859"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span id="local-6989586621682088860"><span class="annot"><span class="annottext">es :: Elims
</span><a href="#local-6989586621682088860"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elim' Term
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Elim' Term
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088859"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; Set a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682088816"><span class="hs-identifier hs-var">rels</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682088862"><span class="annot"><a href="#local-6989586621682088862"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088863"><span class="annot"><a href="#local-6989586621682088863"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM ([Dom (ArgName, Type)], Dom Type)
-&gt; MaybeT (TCMT IO) ([Dom (ArgName, Type)], Dom Type)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM ([Dom (ArgName, Type)], Dom Type)
 -&gt; MaybeT (TCMT IO) ([Dom (ArgName, Type)], Dom Type))
-&gt; TCM ([Dom (ArgName, Type)], Dom Type)
-&gt; MaybeT (TCMT IO) ([Dom (ArgName, Type)], Dom Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM ([Dom (ArgName, Type)], Dom Type)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteRelationDom"><span class="hs-identifier hs-var">rewriteRelationDom</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088859"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-comment">-- Because of the type of rel (&#915; &#8594; sort), all es are applications.</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088864"><span class="annot"><a href="#local-6989586621682088864"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; [Arg Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg Term] -&gt; [Term]) -&gt; [Arg Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; Maybe [Arg Term] -&gt; [Arg Term]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Arg Term] -&gt; [Arg Term]) -&gt; Maybe [Arg Term] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088860"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-comment">-- The last two arguments are lhs and rhs.</span><span>
</span><span id="line-233"></span><span>          </span><span id="local-6989586621682088867"><span class="annot"><a href="#local-6989586621682088867"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682088864"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-234"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682088868"><span class="annot"><a href="#local-6989586621682088868"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682088869"><span class="annot"><a href="#local-6989586621682088869"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088870"><span class="annot"><a href="#local-6989586621682088870"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088867"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088864"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088862"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088868"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span id="local-6989586621682088871"><span class="annot"><a href="#local-6989586621682088871"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088869"><span class="hs-identifier hs-type">lhs</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span id="local-6989586621682088873"><span class="annot"><a href="#local-6989586621682088873"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088870"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621682088874"><span class="annot"><a href="#local-6989586621682088874"><span class="hs-identifier hs-var">b</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-type">parallelS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><a href="#local-6989586621682088868"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088863"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>      </span><span id="local-6989586621682088878"><span class="annot"><a href="#local-6989586621682088878"><span class="hs-identifier hs-var">gamma0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span id="local-6989586621682088880"><span class="annot"><a href="#local-6989586621682088880"><span class="hs-identifier hs-var">gamma1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088836"><span class="hs-identifier hs-type">gamma1</span></a></span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088881"><span class="annot"><a href="#local-6989586621682088881"><span class="hs-identifier hs-var hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088878"><span class="hs-identifier hs-var">gamma0</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Tele (Dom Type) -&gt; Tele (Dom Type)
forall t. Abstract t =&gt; Tele (Dom Type) -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088880"><span class="hs-identifier hs-var">gamma1</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-comment">-- 2017-06-18, Jesper: Unfold inlined definitions on the LHS.</span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-comment">-- This is necessary to replace copies created by imports by their</span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-comment">-- original definition.</span><span>
</span><span id="line-247"></span><span>      </span><span id="local-6989586621682088883"><span class="annot"><a href="#local-6989586621682088883"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#modifyAllowedReductions"><span class="hs-identifier hs-type">modifyAllowedReductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.SmallSet.html#singleton"><span class="hs-identifier hs-type">SmallSet.singleton</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InlineReductions"><span class="hs-identifier hs-type">InlineReductions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088871"><span class="hs-identifier hs-type">lhs</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-comment">-- Find head symbol f of the lhs, its type, its parameters (in case of a constructor), and its arguments.</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682088889"><span class="annot"><a href="#local-6989586621682088889"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088890"><span class="annot"><a href="#local-6989586621682088890"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088891"><span class="annot"><a href="#local-6989586621682088891"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088892"><span class="annot"><a href="#local-6989586621682088892"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088893"><span class="annot"><a href="#local-6989586621682088893"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682088883"><span class="hs-identifier hs-type">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682088894"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088894"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682088895"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088895"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>          </span><span id="local-6989586621682088896"><span class="annot"><a href="#local-6989586621682088896"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; MaybeT (TCMT IO) Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088894"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span class="annot"><a href="#local-6989586621682088897"><span class="hs-identifier hs-type">checkAxFunOrCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088894"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088896"><span class="hs-identifier hs-type">def</span></a></span><span>
</span><span id="line-254"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088894"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088894"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088896"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088895"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682088898"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682088899"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682088899"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682088900"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088900"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088901"><span class="annot"><span class="annottext">hd :: Elims -&gt; Term
</span><a href="#local-6989586621682088901"><span class="hs-identifier hs-var hs-var hs-var">hd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682088899"><span class="hs-identifier hs-var">ci</span></a></span><span>
</span><span id="line-257"></span><span>          </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088902"><span class="annot"><a href="#local-6989586621682088902"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088903"><span class="annot"><a href="#local-6989586621682088903"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; Type
-&gt; MaybeT (TCMT IO) (Maybe ((QName, Type, [Arg Term]), Type))
forall (m :: * -&gt; *).
PureTCM m =&gt;
ConHead -&gt; Type -&gt; m (Maybe ((QName, Type, [Arg Term]), Type))
</span><a href="Agda.TypeChecking.Datatypes.html#getFullyAppliedConType"><span class="hs-identifier hs-var">getFullyAppliedConType</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Type
 -&gt; MaybeT (TCMT IO) (Maybe ((QName, Type, [Arg Term]), Type)))
-&gt; Type
-&gt; MaybeT (TCMT IO) (Maybe ((QName, Type, [Arg Term]), Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682088874"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-258"></span><span>          </span><span id="local-6989586621682088906"><span class="annot"><a href="#local-6989586621682088906"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088880"><span class="hs-identifier hs-type">gamma1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682088907"><span class="hs-identifier hs-type">checkParametersAreGeneral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088898"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088902"><span class="hs-identifier hs-type">pars</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088898"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088901"><span class="hs-identifier hs-type">hd</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088903"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088906"><span class="hs-identifier hs-type">pars</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088900"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>          </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rule.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; MaybeT (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;LHSNotDefinitionOrConstructor: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088883"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
-&gt; MaybeT (TCMT IO) (QName, Elims -&gt; Term, Type, [Int], Elims)
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#LHSNotDefinitionOrConstructor"><span class="hs-identifier hs-var">LHSNotDefinitionOrConstructor</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><a href="#local-6989586621682088911"><span class="hs-identifier hs-type">ifNotAlreadyAdded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088889"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088880"><span class="hs-identifier hs-type">gamma1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><a href="#local-6989586621682088912"><span class="hs-identifier hs-type">checkNoLhsReduction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088889"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088890"><span class="hs-identifier hs-type">hd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088893"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>        </span><span id="local-6989586621682088913"><span class="annot"><a href="#local-6989586621682088913"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html#fromRightM"><span class="hs-identifier hs-type">fromRightM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088838"><span class="hs-identifier hs-type">failureBlocked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-272"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#catchPatternErr"><span class="hs-identifier hs-type">catchPatternErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-273"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#patternFrom"><span class="hs-identifier hs-type">patternFrom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#relevant"><span class="hs-identifier hs-type">relevant</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088891"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088889"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088893"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-276"></span><span>          </span><span class="annot"><span class="hs-string">&quot;Pattern generated from lhs: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PDef"><span class="hs-identifier hs-type">PDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088889"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088913"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>        </span><span class="hs-comment">-- We need to check two properties on the variables used in the rewrite rule</span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-comment">-- 1. For actually being able to apply the rewrite rule, we need</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-comment">--    that all variables that occur in the rule (on the left or the right)</span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-comment">--    are bound in a pattern position on the left.</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-comment">-- 2. To preserve soundness, we need that all the variables that are used</span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-comment">--    in the *proof* of the rewrite rule are bound in the lhs.</span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-comment">--    For rewrite rules on constructors, we consider parameters to be bound</span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-comment">--    even though they don't appear in the lhs, since they can be reconstructed.</span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-comment">--    For postulated or abstract rewrite rules, we consider all arguments</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-comment">--    as 'used' (see #5238).</span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088919"><span class="annot"><a href="#local-6989586621682088919"><span class="hs-identifier hs-var hs-var">boundVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PElims -&gt; VarSet
forall a. NLPatVars a =&gt; a -&gt; VarSet
</span><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#nlPatVars"><span class="hs-identifier hs-var">nlPatVars</span></a></span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621682088913"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span id="local-6989586621682088921"><span class="annot"><a href="#local-6989586621682088921"><span class="hs-identifier hs-var hs-var">freeVars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PElims, Term) -&gt; VarSet
forall t. Free t =&gt; t -&gt; VarSet
</span><a href="Agda.TypeChecking.Free.html#allFreeVars"><span class="hs-identifier hs-var">allFreeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621682088913"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088873"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>            </span><span id="local-6989586621682088923"><span class="annot"><a href="#local-6989586621682088923"><span class="hs-identifier hs-var hs-var">allVars</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#full"><span class="hs-identifier hs-var">VarSet.full</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; VarSet) -&gt; Int -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088881"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span id="local-6989586621682088925"><span class="annot"><a href="#local-6989586621682088925"><span class="hs-identifier hs-var hs-var">usedVars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682088820"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; VarSet
</span><a href="#local-6989586621682088927"><span class="hs-identifier hs-var">usedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682088820"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-293"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088923"><span class="hs-identifier hs-var">allVars</span></a></span><span>
</span><span id="line-294"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088923"><span class="hs-identifier hs-var">allVars</span></a></span><span>
</span><span id="line-295"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088923"><span class="hs-identifier hs-var">allVars</span></a></span><span>
</span><span id="line-296"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682088923"><span class="hs-identifier hs-var">allVars</span></a></span><span>
</span><span id="line-297"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-298"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-299"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-300"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-301"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarSet
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-303"></span><span>          </span><span class="annot"><span class="hs-string">&quot;variables bound by the pattern: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682088919"><span class="hs-identifier hs-type">boundVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-305"></span><span>          </span><span class="annot"><span class="hs-string">&quot;variables free in the rewrite rule: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682088921"><span class="hs-identifier hs-type">freeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-307"></span><span>          </span><span class="annot"><span class="hs-string">&quot;variables used by the rewrite rule: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682088925"><span class="hs-identifier hs-type">usedVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-type">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088921"><span class="hs-identifier hs-type">freeVars</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#%5C%5C"><span class="hs-operator hs-type">VarSet.\\</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088919"><span class="hs-identifier hs-type">boundVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088852"><span class="hs-identifier hs-type">failureFreeVars</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-type">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088925"><span class="hs-identifier hs-type">usedVars</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#%5C%5C"><span class="hs-operator hs-type">VarSet.\\</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088919"><span class="hs-identifier hs-type">boundVars</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#union"><span class="hs-operator hs-type">`VarSet.union`</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#fromList"><span class="hs-identifier hs-type">VarSet.fromList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088892"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088852"><span class="hs-identifier hs-type">failureFreeVars</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-312"></span><span>          </span><span class="annot"><span class="hs-string">&quot;variables bound in (erased) parameter position: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682088892"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-type">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682088919"><span class="hs-identifier hs-type">boundVars</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#intersection"><span class="hs-operator hs-type">`VarSet.intersection`</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#fromList"><span class="hs-identifier hs-type">VarSet.fromList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088892"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088856"><span class="hs-identifier hs-type">failureNonLinearPars</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621682088944"><span class="annot"><a href="#local-6989586621682088944"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#currentTopLevelModule"><span class="hs-identifier hs-type">currentTopLevelModule</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088946"><span class="annot"><a href="#local-6989586621682088946"><span class="hs-identifier hs-var hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; Tele (Dom Type)
-&gt; QName
-&gt; PElims
-&gt; Term
-&gt; Type
-&gt; Bool
-&gt; TopLevelModuleName
-&gt; RewriteRule
</span><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-var">RewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088813"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682088881"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088889"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621682088913"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088873"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682088874"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682088944"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-319"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;checked rewrite rule&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088946"><span class="hs-identifier hs-type">rew</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-321"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;checked rewrite rule&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682088946"><span class="hs-identifier hs-type">rew</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682088946"><span class="hs-identifier hs-type">rew</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) RewriteRule
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#DoesNotTargetRewriteRelation"><span class="hs-identifier hs-var">DoesNotTargetRewriteRelation</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621682087916"><span class="annot"><a href="#local-6989586621682088824"><span class="hs-identifier hs-type">illegalRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRuleReason"><span class="hs-identifier hs-type">IllegalRewriteRuleReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087916"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621682088824"><span class="annot"><span class="annottext">illegalRule :: forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var hs-var">illegalRule</span></a></span></span><span> </span><span id="local-6989586621682088957"><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="#local-6989586621682088957"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">TCM () -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; MaybeT (TCMT IO) ()) -&gt; TCM () -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#IllegalRewriteRule"><span class="hs-identifier hs-var">IllegalRewriteRule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088813"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="#local-6989586621682088957"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) a
forall a. MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><a href="#local-6989586621682088912"><span class="hs-identifier hs-type">checkNoLhsReduction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621682088912"><span class="annot"><span class="annottext">checkNoLhsReduction :: QName -&gt; (Elims -&gt; Term) -&gt; Elims -&gt; MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682088912"><span class="hs-identifier hs-var hs-var">checkNoLhsReduction</span></a></span></span><span> </span><span id="local-6989586621682088960"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088960"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682088961"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682088962"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088962"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-comment">-- Skip this check when global confluence check is enabled, as</span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-comment">-- redundant rewrite rules may be required to prove confluence.</span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Bool -&gt; MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ConfluenceCheck -&gt; Maybe ConfluenceCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; Maybe ConfluenceCheck
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="Agda.Interaction.Options.Types.html#GlobalConfluenceCheck"><span class="hs-identifier hs-var">GlobalConfluenceCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ConfluenceCheck -&gt; Bool)
-&gt; (PragmaOptions -&gt; Maybe ConfluenceCheck)
-&gt; PragmaOptions
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-var">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool)
-&gt; MaybeT (TCMT IO) PragmaOptions -&gt; MaybeT (TCMT IO) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ())
-&gt; MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088963"><span class="annot"><span class="annottext">v :: Term
</span><a href="#local-6989586621682088963"><span class="hs-identifier hs-var hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088962"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-339"></span><span>      </span><span id="local-6989586621682088964"><span class="annot"><a href="#local-6989586621682088964"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; MaybeT (TCMT IO) Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088963"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088965"><span class="annot"><a href="#local-6989586621682088966"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088965"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-341"></span><span>          </span><span id="local-6989586621682088966"><span class="annot"><a href="#local-6989586621682088966"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; MaybeT (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;v  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088963"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; MaybeT (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;v' = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088964"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>            </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#LHSReduces"><span class="hs-identifier hs-var">LHSReduces</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088963"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682088964"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621682088980"><span class="annot"><a href="#local-6989586621682088980"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682088964"><span class="hs-identifier hs-type">v'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682088981"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088981"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span id="local-6989586621682088982"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088982"><span class="hs-identifier hs-var">es'</span></a></span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088960"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088981"><span class="hs-identifier hs-var">f'</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; MaybeT (TCMT IO) Elims
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088982"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682088983"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682088983"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682088984"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088960"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682088983"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; MaybeT (TCMT IO) Elims
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Elims
forall a. MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088966"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088962"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088980"><span class="hs-identifier hs-type">es'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>        </span><span id="local-6989586621682088986"><span class="annot"><a href="#local-6989586621682088986"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#computeElimHeadType"><span class="hs-identifier hs-type">computeElimHeadType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088960"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088962"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088980"><span class="hs-identifier hs-type">es'</span></a></span><span>
</span><span id="line-351"></span><span>        </span><span id="local-6989586621682088988"><span class="annot"><a href="#local-6989586621682088988"><span class="hs-identifier hs-var">pol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getPolarity%27"><span class="hs-identifier hs-type">getPolarity'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpEq"><span class="hs-identifier hs-type">CmpEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088960"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621682088991"><span class="annot"><a href="#local-6989586621682088991"><span class="hs-identifier hs-var">ok</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#dontAssignMetas"><span class="hs-identifier hs-type">dontAssignMetas</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#tryConversion"><span class="hs-identifier hs-type">tryConversion</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-353"></span><span>                 </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#compareElims"><span class="hs-identifier hs-type">compareElims</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088988"><span class="hs-identifier hs-type">pol</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682088986"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088960"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682088962"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088980"><span class="hs-identifier hs-type">es'</span></a></span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088991"><span class="hs-identifier hs-type">ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088966"><span class="hs-identifier hs-type">fail</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="#local-6989586621682088897"><span class="hs-identifier hs-type">checkAxFunOrCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621682088897"><span class="annot"><span class="annottext">checkAxFunOrCon :: QName -&gt; Definition -&gt; MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682088897"><span class="hs-identifier hs-var hs-var">checkAxFunOrCon</span></a></span></span><span> </span><span id="local-6989586621682088995"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088995"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682088996"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682088996"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682088996"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; MaybeT (TCMT IO) ()
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>      </span><span id="local-6989586621682088997"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621682088997"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">Maybe Projection
-&gt; (Projection -&gt; MaybeT (TCMT IO) ()) -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either ProjectionLikenessMissing Projection -&gt; Maybe Projection
forall a b. Either a b -&gt; Maybe b
</span><a href="Agda.Utils.Either.html#maybeRight"><span class="hs-identifier hs-var">maybeRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn -&gt; Either ProjectionLikenessMissing Projection
</span><a href="Agda.TypeChecking.Monad.Base.html#funProjection"><span class="hs-identifier hs-var">funProjection</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682088997"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Projection -&gt; MaybeT (TCMT IO) ()) -&gt; MaybeT (TCMT IO) ())
-&gt; (Projection -&gt; MaybeT (TCMT IO) ()) -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682089001"><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621682089001"><span class="hs-identifier hs-var">proj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projProper"><span class="hs-identifier hs-var">projProper</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621682089001"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><span class="annottext">Maybe QName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ()
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ())
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolIsProjectionLikeFunction"><span class="hs-identifier hs-var">HeadSymbolIsProjectionLikeFunction</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088995"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-362"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-363"></span><span>            </span><span class="hs-comment">-- Andreas, 2024-08-20</span><span>
</span><span id="line-364"></span><span>            </span><span class="hs-comment">-- A projection ought to be impossible in the head, since they are represented</span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-comment">-- in post-fix in the internal syntax.</span><span>
</span><span id="line-366"></span><span>            </span><span class="hs-comment">-- Thus, a lone projection @p@ will be @&#955; x &#8594; x .p@</span><span>
</span><span id="line-367"></span><span>            </span><span class="hs-comment">-- and an applied projection @p t@ will be @t .p@.</span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Bool -&gt; MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ConfluenceCheck -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ConfluenceCheck -&gt; Bool)
-&gt; (PragmaOptions -&gt; Maybe ConfluenceCheck)
-&gt; PragmaOptions
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Maybe ConfluenceCheck
</span><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-var">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool)
-&gt; MaybeT (TCMT IO) PragmaOptions -&gt; MaybeT (TCMT IO) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ())
-&gt; MaybeT (TCMT IO) () -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089005"><span class="annot"><span class="annottext">simpleClause :: Clause -&gt; (Elims, Maybe Term)
</span><a href="#local-6989586621682089005"><span class="hs-identifier hs-var hs-var hs-var">simpleClause</span></a></span></span><span> </span><span id="local-6989586621682089006"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682089006"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Elims
</span><a href="Agda.Syntax.Internal.Pattern.html#patternsToElims"><span class="hs-identifier hs-var">patternsToElims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682089006"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Maybe Term
</span><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682089006"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>          </span><span id="local-6989586621682089010"><span class="annot"><a href="#local-6989586621682089010"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Elims, Maybe Term)] -&gt; MaybeT (TCMT IO) [(Elims, Maybe Term)]
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">([(Elims, Maybe Term)] -&gt; MaybeT (TCMT IO) [(Elims, Maybe Term)])
-&gt; [(Elims, Maybe Term)] -&gt; MaybeT (TCMT IO) [(Elims, Maybe Term)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; (Elims, Maybe Term))
-&gt; [Clause] -&gt; [(Elims, Maybe Term)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; (Elims, Maybe Term)
</span><a href="#local-6989586621682089005"><span class="hs-identifier hs-var">simpleClause</span></a></span><span> </span><span class="annot"><span class="annottext">([Clause] -&gt; [(Elims, Maybe Term)])
-&gt; [Clause] -&gt; [(Elims, Maybe Term)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682088997"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html#noMetas"><span class="hs-identifier hs-type">noMetas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089010"><span class="hs-identifier hs-type">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682088824"><span class="hs-identifier hs-type">illegalRule</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolContainsMetas"><span class="hs-identifier hs-type">HeadSymbolContainsMetas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088995"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; MaybeT (TCMT IO) ()
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; MaybeT (TCMT IO) ()
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; MaybeT (TCMT IO) ()
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: is this fine?</span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var">illegalHead</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var">illegalHead</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DatatypeDefn"><span class="hs-identifier hs-type">DatatypeDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var">illegalHead</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordDefn"><span class="hs-identifier hs-type">RecordDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var">illegalHead</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var">illegalHead</span></a></span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var">illegalHead</span></a></span><span>
</span><span id="line-382"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-385"></span><span>      </span><span id="local-6989586621682089014"><span class="annot"><span class="annottext">illegalHead :: MaybeT (TCMT IO) ()
</span><a href="#local-6989586621682089014"><span class="hs-identifier hs-var hs-var">illegalHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ()
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ())
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#HeadSymbolIsTypeConstructor"><span class="hs-identifier hs-var">HeadSymbolIsTypeConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682088995"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><a href="#local-6989586621682088911"><span class="hs-identifier hs-type">ifNotAlreadyAdded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621682088911"><span class="annot"><span class="annottext">ifNotAlreadyAdded :: QName
-&gt; MaybeT (TCMT IO) RewriteRule -&gt; MaybeT (TCMT IO) RewriteRule
</span><a href="#local-6989586621682088911"><span class="hs-identifier hs-var hs-var">ifNotAlreadyAdded</span></a></span></span><span> </span><span id="local-6989586621682089018"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682089018"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682089019"><span class="annot"><span class="annottext">MaybeT (TCMT IO) RewriteRule
</span><a href="#local-6989586621682089019"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>      </span><span id="local-6989586621682089020"><span class="annot"><a href="#local-6989586621682089020"><span class="hs-identifier hs-var">rews</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; MaybeT (TCMT IO) RewriteRules
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m RewriteRules
</span><a href="Agda.TypeChecking.Monad.Signature.html#getRewriteRulesFor"><span class="hs-identifier hs-var">getRewriteRulesFor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682089018"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-comment">-- check if q is already an added rewrite rule</span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">q</span></span><span> </span><span class="annot"><span class="hs-operator">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682089020"><span class="hs-identifier hs-type">rews</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682089023"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682089023"><span class="hs-identifier hs-var">rew</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) RewriteRule
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#DuplicateRewriteRule"><span class="hs-identifier hs-var">DuplicateRewriteRule</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><span class="annottext">Maybe RewriteRule
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) RewriteRule
</span><a href="#local-6989586621682089019"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><a href="#local-6989586621682088927"><span class="hs-identifier hs-type">usedArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621682088927"><span class="annot"><span class="annottext">usedArgs :: Definition -&gt; VarSet
</span><a href="#local-6989586621682088927"><span class="hs-identifier hs-var hs-var">usedArgs</span></a></span></span><span> </span><span id="local-6989586621682089025"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089025"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#fromList"><span class="hs-identifier hs-var">VarSet.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; VarSet) -&gt; [Int] -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Occurrence, Int) -&gt; Int) -&gt; [(Occurrence, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Occurrence, Int)] -&gt; [Int]) -&gt; [(Occurrence, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Occurrence, Int)]
</span><a href="#local-6989586621682089026"><span class="hs-identifier hs-var">usedIxs</span></a></span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>        </span><span id="local-6989586621682089027"><span class="annot"><span class="annottext">occs :: [Occurrence]
</span><a href="#local-6989586621682089027"><span class="hs-identifier hs-var hs-var">occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; [Occurrence]
</span><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682089025"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-399"></span><span>        </span><span id="local-6989586621682089029"><span class="annot"><span class="annottext">allIxs :: [(Occurrence, Int)]
</span><a href="#local-6989586621682089029"><span class="hs-identifier hs-var hs-var">allIxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; [Int] -&gt; [(Occurrence, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682089027"><span class="hs-identifier hs-var">occs</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [(Occurrence, Int)]) -&gt; [Int] -&gt; [(Occurrence, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Occurrence] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Occurrence]
</span><a href="#local-6989586621682089027"><span class="hs-identifier hs-var">occs</span></a></span><span>
</span><span id="line-400"></span><span>        </span><span id="local-6989586621682089026"><span class="annot"><span class="annottext">usedIxs :: [(Occurrence, Int)]
</span><a href="#local-6989586621682089026"><span class="hs-identifier hs-var hs-var">usedIxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Occurrence, Int) -&gt; Bool)
-&gt; [(Occurrence, Int)] -&gt; [(Occurrence, Int)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; Bool
</span><a href="#local-6989586621682089031"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">(Occurrence -&gt; Bool)
-&gt; ((Occurrence, Int) -&gt; Occurrence) -&gt; (Occurrence, Int) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence, Int) -&gt; Occurrence
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Occurrence, Int)]
</span><a href="#local-6989586621682089029"><span class="hs-identifier hs-var">allIxs</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span id="local-6989586621682089031"><span class="annot"><span class="annottext">used :: Occurrence -&gt; Bool
</span><a href="#local-6989586621682089031"><span class="hs-identifier hs-var hs-var">used</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-var">Pos.Unused</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><a href="#local-6989586621682089031"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><a href="#local-6989586621682088907"><span class="hs-identifier hs-type">checkParametersAreGeneral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621682088907"><span class="annot"><span class="annottext">checkParametersAreGeneral :: ConHead -&gt; [Arg Term] -&gt; MaybeT (TCMT IO) [Int]
</span><a href="#local-6989586621682088907"><span class="hs-identifier hs-var hs-var">checkParametersAreGeneral</span></a></span></span><span> </span><span id="local-6989586621682089035"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682089035"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682089036"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682089036"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>        </span><span id="local-6989586621682089037"><span class="annot"><a href="#local-6989586621682089037"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; MaybeT (TCMT IO) [Int]
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682089036"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-407"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List.html#fastDistinct"><span class="hs-identifier hs-type">fastDistinct</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089037"><span class="hs-identifier hs-type">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682089040"><span class="hs-identifier hs-type">errorNotGeneral</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682089037"><span class="hs-identifier hs-type">is</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-410"></span><span>        </span><span id="local-6989586621682089038"><span class="annot"><span class="annottext">loop :: [Arg Term] -&gt; MaybeT (TCMT IO) [Int]
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; MaybeT (TCMT IO) [Int]
forall a. a -&gt; MaybeT (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682089047"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682089047"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682089048"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682089048"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682089047"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-412"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682089050"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089050"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089050"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int])
-&gt; MaybeT (TCMT IO) [Int] -&gt; MaybeT (TCMT IO) [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; MaybeT (TCMT IO) [Int]
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682089048"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) [Int]
forall a. MaybeT (TCMT IO) a
</span><a href="#local-6989586621682089040"><span class="hs-identifier hs-var">errorNotGeneral</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>        </span><span id="local-6989586621682089051"><span class="annot"><a href="#local-6989586621682089040"><span class="hs-identifier hs-type">errorNotGeneral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089051"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-416"></span><span>        </span><span id="local-6989586621682089040"><span class="annot"><span class="annottext">errorNotGeneral :: forall a. MaybeT (TCMT IO) a
</span><a href="#local-6989586621682089040"><span class="hs-identifier hs-var hs-var">errorNotGeneral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a. IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">illegalRule</span></a></span><span> </span><span class="annot"><span class="annottext">(IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a)
-&gt; IllegalRewriteRuleReason -&gt; MaybeT (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [Arg Term] -&gt; IllegalRewriteRuleReason
</span><a href="Agda.TypeChecking.Monad.Base.html#ConstructorParametersNotGeneral"><span class="hs-identifier hs-var">ConstructorParametersNotGeneral</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682089035"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682089036"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">-- | @rewriteWith t f es rew@ where @f : t@</span><span>
</span><span id="line-419"></span><span class="hs-comment">--   tries to rewrite @f es@ with @rew@, returning the reduct if successful.</span><span>
</span><span id="line-420"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewriteWith"><span class="hs-identifier hs-type">rewriteWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-421"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span>
</span><span id="line-424"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span id="rewriteWith"><span class="annot"><span class="annottext">rewriteWith :: Type
-&gt; (Elims -&gt; Term)
-&gt; RewriteRule
-&gt; Elims
-&gt; ReduceM (Either (Blocked Term) Term)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteWith"><span class="hs-identifier hs-var hs-var">rewriteWith</span></a></span></span><span> </span><span id="local-6989586621682089054"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089054"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682089055"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682089056"><span class="annot"><span class="annottext">rew :: RewriteRule
</span><a href="#local-6989586621682089056"><span class="hs-identifier hs-var">rew</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span> </span><span id="local-6989586621682089057"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682089057"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682089058"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682089058"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682089059"><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621682089059"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682089060"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089060"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682089061"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089061"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682089062"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682089062"><span class="hs-identifier hs-var">isClause</span></a></span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682089063"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span></span><span>
</span><span id="line-426"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682089062"><span class="hs-identifier hs-var">isClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Blocked Term) Term -&gt; ReduceM (Either (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Term) Term
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; Either (Blocked Term) Term
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Either (Blocked Term) Term
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Either (Blocked Term) Term)
-&gt; Blocked Term -&gt; Either (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; Term -&gt; Blocked Term
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-var">ReallyNotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Blocked Term) -&gt; Term -&gt; Blocked Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-427"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;{ attempting to rewrite term &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; having head &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; of type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089054"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; with rule &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; RewriteRule -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682089056"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>  </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;raw: attempting to rewrite term &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Term -&gt; ArgName) -&gt; Term -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; having head &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Term -&gt; ArgName) -&gt; Term -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; of type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Type -&gt; ArgName) -&gt; Type -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089054"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; with rule &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (RewriteRule -&gt; ArgName) -&gt; RewriteRule -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682089056"><span class="hs-identifier hs-var">rew</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621682089068"><span class="annot"><a href="#local-6989586621682089068"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
-&gt; TypeOf Elims
-&gt; PElims
-&gt; Elims
-&gt; ReduceM (Either Blocked_ Substitution)
forall (m :: * -&gt; *) a b.
(PureTCM m, Match a b) =&gt;
Tele (Dom Type)
-&gt; TypeOf b -&gt; a -&gt; b -&gt; m (Either Blocked_ Substitution)
</span><a href="Agda.TypeChecking.Rewriting.NonLinMatch.html#nonLinMatch"><span class="hs-identifier hs-var">nonLinMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682089058"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089054"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PElims
</span><a href="#local-6989586621682089059"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682089068"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682089070"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089070"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;}&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><span class="annottext">Either (Blocked Term) Term -&gt; ReduceM (Either (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Term) Term
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; Either (Blocked Term) Term
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Either (Blocked Term) Term
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Either (Blocked Term) Term)
-&gt; Blocked Term -&gt; Either (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089070"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Blocked Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- TODO: remember reductions</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682089072"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682089072"><span class="hs-identifier hs-var">sub</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089073"><span class="annot"><span class="annottext">v' :: Term
</span><a href="#local-6989586621682089073"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Term)
</span><a href="#local-6989586621682089072"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089060"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rewrote &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089063"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089073"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;}&quot;</span></span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Either (Blocked Term) Term)
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; ReduceM (Either (Blocked Term) Term)
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="annottext">Either (Blocked Term) Term -&gt; ReduceM (Either (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Blocked Term) Term
 -&gt; ReduceM (Either (Blocked Term) Term))
-&gt; Either (Blocked Term) Term
-&gt; ReduceM (Either (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Either (Blocked Term) Term
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089073"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">-- | @rewrite b v rules es@ tries to rewrite @v@ applied to @es@ with the</span><span>
</span><span id="line-451"></span><span class="hs-comment">--   rewrite rules @rules@. @b@ is the default blocking tag.</span><span>
</span><span id="line-452"></span><span class="annot"><a href="Agda.TypeChecking.Rewriting.html#rewrite"><span class="hs-identifier hs-type">rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span id="rewrite"><span class="annot"><span class="annottext">rewrite :: Blocked_
-&gt; (Elims -&gt; Term)
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="Agda.TypeChecking.Rewriting.html#rewrite"><span class="hs-identifier hs-var hs-var">rewrite</span></a></span></span><span> </span><span id="local-6989586621682089075"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089075"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621682089076"><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089076"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682089077"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682089077"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621682089078"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089078"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>  </span><span id="local-6989586621682089079"><span class="annot"><a href="#local-6989586621682089079"><span class="hs-identifier hs-var">rewritingAllowed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optRewriting"><span class="hs-identifier hs-var">optRewriting</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; ReduceM PragmaOptions -&gt; ReduceM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ReduceM PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682089079"><span class="hs-identifier hs-type">rewritingAllowed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089077"><span class="hs-identifier hs-type">rules</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682089081"><span class="annot"><a href="#local-6989586621682089081"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinMatch.html#getTypedHead"><span class="hs-identifier hs-type">getTypedHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682089076"><span class="hs-identifier hs-type">hd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>    </span><span class="annot"><a href="#local-6989586621682089083"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089075"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089081"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089077"><span class="hs-identifier hs-type">rules</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-type">instantiateFull'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089078"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="hs-comment">-- TODO: remove instantiateFull?</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">else</span><span>
</span><span id="line-459"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-type">NoReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682089075"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682089076"><span class="hs-identifier hs-type">hd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089078"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><a href="#local-6989586621682089083"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRules"><span class="hs-identifier hs-type">RewriteRules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReduceM"><span class="hs-identifier hs-type">ReduceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Reduced"><span class="hs-identifier hs-type">Reduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621682089083"><span class="annot"><span class="annottext">loop :: Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621682089086"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089086"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621682089087"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089087"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682089088"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089088"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><span class="annottext">ArgName
-&gt; Int
-&gt; TCMT IO Doc
-&gt; ReduceM (Reduced (Blocked Term) Term)
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#traceSDoc"><span class="hs-identifier hs-var">traceSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;rewriting.rewrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;failed to rewrite &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089076"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089088"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;blocking tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_ -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089086"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReduceM (Reduced (Blocked Term) Term)
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; ReduceM (Reduced (Blocked Term) Term)
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Term) Term
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Reduced (Blocked Term) Term
forall no yes. no -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-var">NoReduction</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocked Term -&gt; Reduced (Blocked Term) Term)
-&gt; Blocked Term -&gt; Reduced (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089086"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Term -&gt; Blocked Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089076"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089088"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621682089089"><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089089"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621682089090"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682089091"><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682089091"><span class="hs-identifier hs-var">rew</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682089092"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682089092"><span class="hs-identifier hs-var">rews</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682089093"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">es</span></a></span></span><span>
</span><span id="line-469"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089094"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682089094"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var">rewArity</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682089091"><span class="hs-identifier hs-var">rew</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089094"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682089097"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089097"><span class="hs-identifier hs-var hs-var">es1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682089098"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089098"><span class="hs-identifier hs-var hs-var">es2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; (Elims, Elims)
forall i a. Integral i =&gt; i -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">List.genericSplitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089094"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-471"></span><span>          </span><span id="local-6989586621682089100"><span class="annot"><a href="#local-6989586621682089100"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Elims -&gt; Term)
-&gt; RewriteRule
-&gt; Elims
-&gt; ReduceM (Either (Blocked Term) Term)
</span><a href="Agda.TypeChecking.Rewriting.html#rewriteWith"><span class="hs-identifier hs-var">rewriteWith</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Term
</span><a href="#local-6989586621682089076"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRule
</span><a href="#local-6989586621682089091"><span class="hs-identifier hs-var">rew</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089097"><span class="hs-identifier hs-var">es1</span></a></span><span>
</span><span id="line-472"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682089100"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-473"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621682089102"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682089102"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682089103"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089103"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089089"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; () -&gt; Blocked_
forall t a. Blocker -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682089102"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682089092"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-474"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089089"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682089092"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682089104"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089104"><span class="hs-identifier hs-var">w</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a. a -&gt; ReduceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduced (Blocked Term) Term
 -&gt; ReduceM (Reduced (Blocked Term) Term))
-&gt; Reduced (Blocked Term) Term
-&gt; ReduceM (Reduced (Blocked Term) Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Simplification -&gt; Term -&gt; Reduced (Blocked Term) Term
forall no yes. Simplification -&gt; yes -&gt; Reduced no yes
</span><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-var">YesReduction</span></a></span><span> </span><span class="annot"><span class="annottext">Simplification
</span><a href="Agda.TypeChecking.Monad.Base.html#YesSimplification"><span class="hs-identifier hs-var">YesSimplification</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Reduced (Blocked Term) Term)
-&gt; Term -&gt; Reduced (Blocked Term) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682089104"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089098"><span class="hs-identifier hs-var">es2</span></a></span><span>
</span><span id="line-476"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked_
-&gt; Type
-&gt; RewriteRules
-&gt; Elims
-&gt; ReduceM (Reduced (Blocked Term) Term)
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked_
</span><a href="#local-6989586621682089089"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
forall t. NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682089092"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><a href="#local-6989586621682089095"><span class="hs-identifier hs-type">rewArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RewriteRule"><span class="hs-identifier hs-type">RewriteRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-479"></span><span>    </span><span id="local-6989586621682089095"><span class="annot"><span class="annottext">rewArity :: RewriteRule -&gt; Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var hs-var">rewArity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PElims -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(PElims -&gt; Int) -&gt; (RewriteRule -&gt; PElims) -&gt; RewriteRule -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; PElims
</span><a href="Agda.TypeChecking.Monad.Base.html#rewPats"><span class="hs-identifier hs-var">rewPats</span></a></span><span>
</span><span id="line-480"></span></pre></body></html>