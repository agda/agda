<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Term</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lefts</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Generate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#disambiguateRecordFields"><span class="hs-identifier">disambiguateRecordFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Binder"><span class="hs-identifier">Binder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#TypedBindingInfo"><span class="hs-identifier">TypedBindingInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#tbTacticAttr"><span class="hs-identifier">tbTacticAttr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html"><span class="hs-identifier">Agda.Syntax.Abstract.Views</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Pretty.html"><span class="hs-identifier">Agda.Syntax.Concrete.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- only Pretty instances</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment%27"><span class="hs-identifier">FieldAssignment'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#nameFieldA"><span class="hs-identifier">nameFieldA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#TacticAttribute%27"><span class="hs-identifier">TacticAttribute'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html"><span class="hs-identifier">Agda.Syntax.Concrete.Name</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html"><span class="hs-identifier">Agda.Syntax.Literal</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ThingsInScope"><span class="hs-identifier">ThingsInScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier">AbstractName</span></a></span><span>
</span><span id="line-34"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#emptyScopeInfo"><span class="hs-identifier">emptyScopeInfo</span></a></span><span>
</span><span id="line-35"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#exportedNamesInScope"><span class="hs-identifier">exportedNamesInScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html"><span class="hs-identifier">Agda.Syntax.Scope.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier">getNamedScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html"><span class="hs-identifier">Agda.TypeChecking.Constraints</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html"><span class="hs-identifier">Agda.TypeChecking.Coverage.SplitTree</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.EtaContract.html"><span class="hs-identifier">Agda.TypeChecking.EtaContract</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Generalize.html"><span class="hs-identifier">Agda.TypeChecking.Generalize</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Implicit.html"><span class="hs-identifier">Agda.TypeChecking.Implicit</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html"><span class="hs-identifier">Agda.TypeChecking.InstanceArguments</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html"><span class="hs-identifier">Agda.TypeChecking.Irrelevance</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.IApplyConfluence.html"><span class="hs-identifier">Agda.TypeChecking.IApplyConfluence</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Level.html"><span class="hs-identifier">Agda.TypeChecking.Level</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html"><span class="hs-identifier">Agda.TypeChecking.Patterns.Abstract</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html"><span class="hs-identifier">Agda.TypeChecking.Primitive</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Quote.html"><span class="hs-identifier">Agda.TypeChecking.Quote</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.RecordPatterns.html"><span class="hs-identifier">Agda.TypeChecking.RecordPatterns</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html"><span class="hs-identifier">Agda.TypeChecking.Records</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.html"><span class="hs-identifier">Agda.TypeChecking.SizedTypes</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html"><span class="hs-identifier">Agda.TypeChecking.SizedTypes.Solve</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Sort.html"><span class="hs-identifier">Agda.TypeChecking.Sort</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Unquote.html"><span class="hs-identifier">Agda.TypeChecking.Unquote</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Empty.html"><span class="hs-identifier">Agda.TypeChecking.Empty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Empty.html#ensureEmptyType"><span class="hs-identifier">ensureEmptyType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef%27"><span class="hs-identifier">checkFunDef'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier">useTerPragma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Decl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html#checkSectionApplication"><span class="hs-identifier">checkSectionApplication</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Application.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Application</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List2.html"><span class="hs-identifier">Agda.Utils.List2</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Utils.List2.html#List2"><span class="hs-identifier">List2</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Set1.html"><span class="hs-identifier">Agda.Utils.Set1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set1</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Tuple.html"><span class="hs-identifier">Agda.Utils.Tuple</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Boolean.html"><span class="hs-identifier">Agda.Utils.Boolean</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Boolean.html#implies"><span class="hs-identifier">implies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-92"></span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-93"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-comment">-- | Check that an expression is a type.</span></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType"><span class="hs-identifier hs-type">isType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-97"></span><span id="isType"><span class="annot"><span class="annottext">isType :: Expr -&gt; Sort' Term -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType"><span class="hs-identifier hs-var hs-var">isType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Sort' Term -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType%27"><span class="hs-identifier hs-var">isType'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Check that an expression is a type.</span><span>
</span><span id="line-100"></span><span class="hs-comment">--   * If @c == CmpEq@, the given sort must be the minimal sort.</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   * If @c == CmpLeq@, the given sort may be any bigger sort.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType%27"><span class="hs-identifier hs-type">isType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-103"></span><span id="isType%27"><span class="annot"><span class="annottext">isType' :: Comparison -&gt; Expr -&gt; Sort' Term -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType%27"><span class="hs-identifier hs-var hs-var">isType'</span></a></span></span><span> </span><span id="local-6989586621682142809"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682142809"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682142810"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142810"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682142811"><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682142811"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><span class="annottext">Call -&gt; TCM Type -&gt; TCM Type
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Sort' Term -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#IsTypeCall"><span class="hs-identifier hs-var">IsTypeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682142809"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142810"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682142811"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621682142814"><span class="annot"><a href="#local-6989586621682142814"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682142809"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142810"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort' Term -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682142811"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142811"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142814"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><span class="hs-comment">-- | Check that an expression is a type and infer its (minimal) sort.</span></span><span>
</span><span id="line-109"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-type">isType_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-110"></span><span id="isType_"><span class="annot"><span class="annottext">isType_ :: Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var hs-var">isType_</span></a></span></span><span> </span><span id="local-6989586621682142819"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142819"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Call -&gt; TCM Type -&gt; TCM Type
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#IsType_"><span class="hs-identifier hs-var">IsType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142819"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; (Type -&gt; TCMT IO Doc) -&gt; TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; (a -&gt; TCMT IO Doc) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportResult"><span class="hs-identifier hs-var">reportResult</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.istype&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682142822"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142822"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;isType_&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142819"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;returns&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142822"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682142827"><span class="annot"><span class="annottext">fallback :: TCM Type
</span><a href="#local-6989586621682142827"><span class="hs-identifier hs-var hs-var hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Sort' Term -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType%27"><span class="hs-identifier hs-var">isType'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpEq"><span class="hs-identifier hs-var">CmpEq</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142819"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort' Term -&gt; TCM Type) -&gt; TCMT IO (Sort' Term) -&gt; TCM Type
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Sort' Term) -&gt; TCMT IO (Sort' Term)
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Sort' Term) -&gt; TCMT IO (Sort' Term))
-&gt; TCMT IO (Sort' Term) -&gt; TCMT IO (Sort' Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Sort' Term)
forall (m :: * -&gt; *). MonadMetaSolver m =&gt; m (Sort' Term)
</span><a href="Agda.TypeChecking.MetaVars.html#newSortMeta"><span class="hs-identifier hs-var">newSortMeta</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#SortKit"><span class="hs-identifier hs-type">SortKit</span></a></span><span class="hs-special">{</span><span id="local-6989586621682142833"><span id="local-6989586621682142834"><span class="annot"><a href="#local-6989586621682142833"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO SortKit
forall (m :: * -&gt; *).
(HasBuiltins m, MonadTCError m, HasOptions m) =&gt;
m SortKit
</span><a href="Agda.TypeChecking.Monad.Builtin.html#sortKit"><span class="hs-identifier hs-var">sortKit</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-type">unScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142819"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Fun"><span class="hs-identifier hs-type">A.Fun</span></a></span><span> </span><span id="local-6989586621682142840"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682142840"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682142842"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682142842"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682142843"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142843"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682142844"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142844"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621682142845"><span class="annot"><a href="#local-6989586621682142845"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Dom Type -&gt; Dom Type
forall a. LensArgInfo a =&gt; ArgInfo -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setArgInfo"><span class="hs-identifier hs-var">setArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682142842"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; Dom Type) -&gt; (Type -&gt; Dom Type) -&gt; Type -&gt; Dom Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Dom Type
forall a. a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultDom"><span class="hs-identifier hs-var">defaultDom</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Dom Type) -&gt; TCM Type -&gt; TCMT IO (Dom Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">List1 ArgInfo -&gt; Expr -&gt; TCM Type
forall a.
(LensLock a, LensModality a) =&gt;
List1 a -&gt; Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPiDomain"><span class="hs-identifier hs-var">checkPiDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682142842"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; [ArgInfo] -&gt; List1 ArgInfo
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142843"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621682142851"><span class="annot"><a href="#local-6989586621682142851"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-type">isType_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142844"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621682142852"><span class="annot"><a href="#local-6989586621682142852"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Sort.html#inferFunSort"><span class="hs-identifier hs-type">inferFunSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142845"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142851"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682142854"><span class="annot"><a href="#local-6989586621682142854"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682142852"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-var">Pi</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682142845"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(Abs Type -&gt; Term) -&gt; Abs Type -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Type -&gt; Abs Type
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-var">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
forall a. Underscore a =&gt; a
</span><a href="Agda.Syntax.Common.html#underscore"><span class="hs-identifier hs-var">underscore</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142851"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Sort.html#hasPTSRule"><span class="hs-identifier hs-type">hasPTSRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142845"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#underscore"><span class="hs-identifier hs-type">underscore</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-type">getSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142851"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-comment">--noFunctionsIntoSize t'</span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682142854"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pi"><span class="hs-identifier hs-type">A.Pi</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682142861"><span class="annot"><span class="annottext">Telescope1
</span><a href="#local-6989586621682142861"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682142862"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142862"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682142863"><span class="annot"><a href="#local-6989586621682142863"><span class="hs-identifier hs-var">t0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682142864"><span class="annot"><a href="#local-6989586621682142864"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; (Telescope -&gt; TCM (Type, Type)) -&gt; TCM (Type, Type)
forall a. Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPiTelescope"><span class="hs-identifier hs-var">checkPiTelescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope1 -&gt; [Item Telescope1]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">Telescope1
</span><a href="#local-6989586621682142861"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Telescope -&gt; TCM (Type, Type)) -&gt; TCM (Type, Type))
-&gt; (Telescope -&gt; TCM (Type, Type)) -&gt; TCM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682142866"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682142866"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>        </span><span id="local-6989586621682142867"><span class="annot"><a href="#local-6989586621682142867"><span class="hs-identifier hs-var">t0</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142862"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-129"></span><span>        </span><span id="local-6989586621682142869"><span class="annot"><a href="#local-6989586621682142869"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142866"><span class="hs-identifier hs-type">tel</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Sort.html#checkTelePiSort"><span class="hs-identifier hs-type">checkTelePiSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142869"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-type">getSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142867"><span class="hs-identifier hs-type">t0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682142867"><span class="hs-identifier hs-type">t0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#telePi"><span class="hs-identifier hs-type">telePi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142869"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142867"><span class="hs-identifier hs-type">t0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-comment">--noFunctionsIntoSize t'</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682142864"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Generalized"><span class="hs-identifier hs-type">A.Generalized</span></a></span><span> </span><span id="local-6989586621682142873"><span class="annot"><span class="annottext">Set1 QName
</span><a href="#local-6989586621682142873"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682142874"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142874"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682142875"><span class="annot"><a href="#local-6989586621682142875"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; TCM Type -&gt; TCM ([Maybe QName], Type)
</span><a href="Agda.TypeChecking.Generalize.html#generalizeType"><span class="hs-identifier hs-var">generalizeType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set1 QName -&gt; Set QName
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set1.toSet</span></span><span> </span><span class="annot"><span class="annottext">Set1 QName
</span><a href="#local-6989586621682142873"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM ([Maybe QName], Type))
-&gt; TCM Type -&gt; TCM ([Maybe QName], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142874"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-comment">--noFunctionsIntoSize t'</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682142875"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- Prop/(S)Set(&#969;)&#7522;</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Def%27"><span class="hs-identifier hs-type">A.Def'</span></a></span><span> </span><span id="local-6989586621682142879"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682142879"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682142880"><span class="annot"><span class="annottext">Suffix
</span><a href="#local-6989586621682142880"><span class="hs-identifier hs-var">suffix</span></a></span></span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682142881"><span class="annot"><span class="annottext">UnivSize
</span><a href="#local-6989586621682142881"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682142882"><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142882"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe (UnivSize, Univ)
</span><a href="#local-6989586621682142834"><span class="hs-identifier hs-var">isNameOfUniv</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682142879"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682142883"><span class="annot"><span class="annottext">n :: Integer
</span><a href="#local-6989586621682142883"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Suffix -&gt; Integer
</span><a href="Agda.TypeChecking.Rules.Application.html#suffixToLevel"><span class="hs-identifier hs-var">suffixToLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Suffix
</span><a href="#local-6989586621682142880"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Univ -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Application.html#univChecks"><span class="hs-identifier hs-var">univChecks</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142882"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM Type)
-&gt; (Sort' Term -&gt; Type) -&gt; Sort' Term -&gt; TCM Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort' Term -&gt; TCM Type) -&gt; Sort' Term -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnivSize
</span><a href="#local-6989586621682142881"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>          </span><span class="annot"><span class="annottext">UnivSize
</span><a href="Agda.Syntax.Internal.html#USmall"><span class="hs-identifier hs-var">USmall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Univ -&gt; Level' Term -&gt; Sort' Term
forall t. Univ -&gt; Level' t -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#Univ"><span class="hs-identifier hs-var">Univ</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142882"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Level' Term -&gt; Sort' Term) -&gt; Level' Term -&gt; Sort' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Level' Term
</span><a href="Agda.Syntax.Internal.html#ClosedLevel"><span class="hs-identifier hs-var">ClosedLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682142883"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><span class="annottext">UnivSize
</span><a href="Agda.Syntax.Internal.html#ULarge"><span class="hs-identifier hs-var">ULarge</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Univ -&gt; Integer -&gt; Sort' Term
forall t. Univ -&gt; Integer -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#Inf"><span class="hs-identifier hs-var">Inf</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142882"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682142883"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- Prop/(S)et &#8467;</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#App"><span class="hs-identifier hs-type">A.App</span></a></span><span> </span><span id="local-6989586621682142892"><span class="annot"><span class="annottext">AppInfo
</span><a href="#local-6989586621682142892"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682142893"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142893"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682142894"><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682142894"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682142894"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Def"><span class="hs-identifier hs-type">A.Def</span></a></span><span> </span><span id="local-6989586621682142897"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682142897"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-var">unScope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142893"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnivSize
</span><a href="Agda.Syntax.Internal.html#USmall"><span class="hs-identifier hs-var">USmall</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682142898"><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142898"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe (UnivSize, Univ)
</span><a href="#local-6989586621682142834"><span class="hs-identifier hs-var">isNameOfUniv</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682142897"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="annottext">Univ -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Application.html#univChecks"><span class="hs-identifier hs-var">univChecks</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142898"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Options.html#hasUniversePolymorphism"><span class="hs-identifier hs-var">hasUniversePolymorphism</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NeedOptionUniversePolymorphism"><span class="hs-identifier hs-var">NeedOptionUniversePolymorphism</span></a></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-comment">-- allow ShapeIrrelevant variables when checking level</span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-comment">--   Set : (ShapeIrrelevant) Level -&gt; Set\omega</span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">Relevance -&gt; TCM Type -&gt; TCM Type
forall (tcm :: * -&gt; *) r a.
(MonadTCEnv tcm, LensRelevance r) =&gt;
r -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyRelevanceToContext"><span class="hs-identifier hs-var">applyRelevanceToContext</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="Agda.Syntax.Common.html#shapeIrrelevant"><span class="hs-identifier hs-var">shapeIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="annottext">Sort' Term -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort' Term -&gt; Type)
-&gt; (Level' Term -&gt; Sort' Term) -&gt; Level' Term -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Univ -&gt; Level' Term -&gt; Sort' Term
forall t. Univ -&gt; Level' t -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#Univ"><span class="hs-identifier hs-var">Univ</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682142898"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Level' Term -&gt; Type) -&gt; TCMT IO (Level' Term) -&gt; TCM Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; TCMT IO (Level' Term)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLevel"><span class="hs-identifier hs-var">checkLevel</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682142894"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- Issue #707: Check an existing interaction point</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuestionMark"><span class="hs-identifier hs-type">A.QuestionMark</span></a></span><span> </span><span id="local-6989586621682142907"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682142907"><span class="hs-identifier hs-var">minfo</span></a></span></span><span> </span><span id="local-6989586621682142908"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682142908"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe MetaId)
-&gt; TCM Type -&gt; (MetaId -&gt; TCM Type) -&gt; TCM Type
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO (Maybe MetaId)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
InteractionId -&gt; m (Maybe MetaId)
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupInteractionMeta"><span class="hs-identifier hs-var">lookupInteractionMeta</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682142908"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Type
</span><a href="#local-6989586621682142827"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="annot"><span class="annottext">((MetaId -&gt; TCM Type) -&gt; TCM Type)
-&gt; (MetaId -&gt; TCM Type) -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682142911"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682142911"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-comment">-- -- | Just x &lt;- A.metaNumber minfo -&gt; do</span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.ip&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Rechecking meta &quot;</span></span><span>
</span><span id="line-167"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; MetaId -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682142911"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; for interaction point &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682142908"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>      </span><span id="local-6989586621682142916"><span class="annot"><a href="#local-6989586621682142916"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682142911"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682142918"><span class="annot"><a href="#local-6989586621682142918"><span class="hs-identifier hs-var hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Judgement MetaId -&gt; Type
forall a. Judgement a -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#jMetaType"><span class="hs-identifier hs-var">jMetaType</span></a></span><span> </span><span class="annot"><span class="annottext">(Judgement MetaId -&gt; Type)
-&gt; (MetaVariable -&gt; Judgement MetaId) -&gt; MetaVariable -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; Type) -&gt; MetaVariable -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682142916"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-comment">-- Andreas, 2016-10-14, issue #2257</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-comment">-- The meta was created in a context of length @n@.</span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682142921"><span class="annot"><a href="#local-6989586621682142921"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ContextEntry] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([ContextEntry] -&gt; Int)
-&gt; (MetaVariable -&gt; [ContextEntry]) -&gt; MetaVariable -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [ContextEntry]
</span><a href="Agda.TypeChecking.Monad.Base.html#envContext"><span class="hs-identifier hs-var">envContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; [ContextEntry])
-&gt; (MetaVariable -&gt; TCEnv) -&gt; MetaVariable -&gt; [ContextEntry]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Closure Range -&gt; TCEnv
forall a. Closure a -&gt; TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#clEnv"><span class="hs-identifier hs-var">clEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Range -&gt; TCEnv)
-&gt; (MetaVariable -&gt; Closure Range) -&gt; MetaVariable -&gt; TCEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Closure Range
</span><a href="Agda.TypeChecking.Monad.Base.html#miClosRange"><span class="hs-identifier hs-var">miClosRange</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInfo -&gt; Closure Range)
-&gt; (MetaVariable -&gt; MetaInfo) -&gt; MetaVariable -&gt; Closure Range
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; Int) -&gt; MetaVariable -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682142916"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682142927"><span class="annot"><a href="#local-6989586621682142927"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682142928"><span class="annot"><a href="#local-6989586621682142928"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="annot"><a href="#local-6989586621682142921"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextArgs"><span class="hs-identifier hs-type">getContextArgs</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682142931"><span class="annot"><a href="#local-6989586621682142931"><span class="hs-identifier hs-var hs-var">oldCxtNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; [Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameCanonical"><span class="hs-identifier hs-var">nameCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Name]) -&gt; [Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ContextEntry] -&gt; [Name]
</span><a href="Agda.TypeChecking.Monad.Context.html#contextNames%27"><span class="hs-identifier hs-var">contextNames'</span></a></span><span> </span><span class="annot"><span class="annottext">([ContextEntry] -&gt; [Name]) -&gt; [ContextEntry] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [ContextEntry]
</span><a href="Agda.TypeChecking.Monad.Base.html#envContext"><span class="hs-identifier hs-var">envContext</span></a></span><span>
</span><span id="line-178"></span><span>                      </span><span class="annot"><span class="annottext">(TCEnv -&gt; [ContextEntry]) -&gt; TCEnv -&gt; [ContextEntry]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Closure Range -&gt; TCEnv
forall a. Closure a -&gt; TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#clEnv"><span class="hs-identifier hs-var">clEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Range -&gt; TCEnv) -&gt; Closure Range -&gt; TCEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Closure Range
</span><a href="Agda.TypeChecking.Monad.Base.html#miClosRange"><span class="hs-identifier hs-var">miClosRange</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInfo -&gt; Closure Range) -&gt; MetaInfo -&gt; Closure Range
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; MetaInfo) -&gt; MetaVariable -&gt; MetaInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682142916"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>      </span><span id="local-6989586621682142934"><span class="annot"><a href="#local-6989586621682142934"><span class="hs-identifier hs-var">newCxtNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#nameCanonical"><span class="hs-identifier hs-var">nameCanonical</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextNames%27"><span class="hs-identifier hs-type">getContextNames'</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.ip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;  s0   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142918"><span class="hs-identifier hs-type">s0</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  vs   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142927"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  rest = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142928"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  oldCxtNames = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142931"><span class="hs-identifier hs-type">oldCxtNames</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  newCxtNames = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142934"><span class="hs-identifier hs-type">newCxtNames</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-comment">-- We assume the meta variable use here is in an extension of the original context.</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-comment">-- If not we revert to the old buggy behavior of #707 (see test/Succeed/Issue2257b).</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.isPrefixOf</span></span><span> </span><span class="annot"><a href="#local-6989586621682142931"><span class="hs-identifier hs-type">oldCxtNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142934"><span class="hs-identifier hs-type">newCxtNames</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682142827"><span class="hs-identifier hs-type">fallback</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>      </span><span id="local-6989586621682142939"><span class="annot"><a href="#local-6989586621682142939"><span class="hs-identifier hs-var">s1</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-identifier hs-type">piApplyM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142918"><span class="hs-identifier hs-type">s0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142927"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.ip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;  s1   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142939"><span class="hs-identifier hs-type">s1</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.ip&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;  s1   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682142939"><span class="hs-identifier hs-type">s1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142939"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621682142944"><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682142944"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM Type) -&gt; Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682142944"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682142911"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; [Arg Term] -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682142927"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Type
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Type
</span><a href="#local-6989586621682142827"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLevel"><span class="hs-identifier hs-type">checkLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span>
</span><span id="line-206"></span><span id="checkLevel"><span class="annot"><span class="annottext">checkLevel :: NamedArg Expr -&gt; TCMT IO (Level' Term)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLevel"><span class="hs-identifier hs-var hs-var">checkLevel</span></a></span></span><span> </span><span id="local-6989586621682142949"><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682142949"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621682142950"><span class="annot"><a href="#local-6989586621682142950"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Type
forall (m :: * -&gt; *). (HasBuiltins m, MonadTCError m) =&gt; m Type
</span><a href="Agda.TypeChecking.Level.html#levelType"><span class="hs-identifier hs-var">levelType</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Level.html#levelView"><span class="hs-identifier hs-type">levelView</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkNamedArg"><span class="hs-identifier hs-type">checkNamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142949"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142950"><span class="hs-identifier hs-type">lvl</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | Ensure that a (freshly created) function type does not inhabit 'SizeUniv'.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--   Precondition:  When @noFunctionsIntoSize t tBlame@ is called,</span><span>
</span><span id="line-212"></span><span class="hs-comment">--   we are in the context of @tBlame@ in order to print it correctly.</span><span>
</span><span id="line-213"></span><span class="hs-comment">--   Not being in context of @t@ should not matter, as we are only</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   checking whether its sort reduces to 'SizeUniv'.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">--   Currently UNUSED since SizeUniv is turned off (as of 2016).</span><span>
</span><span id="line-217"></span><span class="hs-comment">{-
noFunctionsIntoSize :: Type -&gt; Type -&gt; TCM ()
noFunctionsIntoSize t tBlame = do
  reportSDoc &quot;tc.fun&quot; 20 $ do
    let El s (Pi dom b) = tBlame
    sep [ &quot;created function type &quot; &lt;+&gt; prettyTCM tBlame
        , &quot;with pts rule (&quot; &lt;+&gt; prettyTCM (getSort dom) &lt;+&gt;
                        &quot;,&quot; &lt;+&gt; underAbstraction_ b (prettyTCM . getSort) &lt;+&gt;
                        &quot;,&quot; &lt;+&gt; prettyTCM s &lt;+&gt; &quot;)&quot;
        ]
  s &lt;- reduce $ getSort t
  when (s == SizeUniv) $ do
    -- Andreas, 2015-02-14
    -- We have constructed a function type in SizeUniv
    -- which is illegal to prevent issue 1428.
    typeError $ FunctionTypeInSizeUniv $ unEl tBlame
-}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><span class="hs-comment">-- | Check that an expression is a type which is equal to a given type.</span></span><span>
</span><span id="line-236"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isTypeEqualTo"><span class="hs-identifier hs-type">isTypeEqualTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-237"></span><span id="isTypeEqualTo"><span class="annot"><span class="annottext">isTypeEqualTo :: Expr -&gt; Type -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isTypeEqualTo"><span class="hs-identifier hs-var hs-var">isTypeEqualTo</span></a></span></span><span> </span><span id="local-6989586621682142956"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142956"><span class="hs-identifier hs-var">e0</span></a></span></span><span> </span><span id="local-6989586621682142957"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142957"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Expr
</span><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-var">scopedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142956"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; (Expr -&gt; TCM Type) -&gt; TCM Type
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopedExpr"><span class="hs-identifier hs-type">A.ScopedExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Type
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Underscore"><span class="hs-identifier hs-type">A.Underscore</span></a></span><span> </span><span id="local-6989586621682142961"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682142961"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe MetaId -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; Maybe MetaId
</span><a href="Agda.Syntax.Info.html#metaNumber"><span class="hs-identifier hs-var">A.metaNumber</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682142961"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142957"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621682142964"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142964"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621682142965"><span class="annot"><a href="#local-6989586621682142965"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Sort' Term -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType"><span class="hs-identifier hs-var">isType</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682142964"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142957"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="#local-6989586621682142965"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#leqType"><span class="hs-identifier hs-type">leqType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142957"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142965"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#leqType_"><span class="hs-identifier hs-type">leqType_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span id="leqType_"><span class="annot"><span class="annottext">leqType_ :: Type -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Term.html#leqType_"><span class="hs-identifier hs-var hs-var">leqType_</span></a></span></span><span> </span><span id="local-6989586621682142969"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142969"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682142970"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142970"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TCM ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Type -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#leqType"><span class="hs-identifier hs-var">leqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142969"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682142970"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-248"></span><span class="annot"><span class="hs-comment">-- * Telescopes</span></span><span>
</span><span id="line-249"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span id="local-6989586621682140570"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkGeneralizeTelescope"><span class="hs-identifier hs-type">checkGeneralizeTelescope</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-252"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-253"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ The module the telescope belongs to (if any).</span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#GeneralizeTelescope"><span class="hs-identifier hs-type">A.GeneralizeTelescope</span></a></span><span>
</span><span id="line-255"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Telescope to check and add to the context for the continuation.</span></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140570"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Continuation living in the extended context.</span></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140570"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-259"></span><span id="checkGeneralizeTelescope"><span class="annot"><span class="annottext">checkGeneralizeTelescope :: forall a.
Maybe ModuleName
-&gt; GeneralizeTelescope
-&gt; ([Maybe Name] -&gt; Telescope -&gt; TCM a)
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkGeneralizeTelescope"><span class="hs-identifier hs-var hs-var">checkGeneralizeTelescope</span></a></span></span><span> </span><span id="local-6989586621682142976"><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621682142976"><span class="hs-identifier hs-var">mm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#GeneralizeTel"><span class="hs-identifier hs-type">A.GeneralizeTel</span></a></span><span> </span><span id="local-6989586621682142978"><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621682142978"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621682142979"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682142979"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a
</span><a href="#local-6989586621682142980"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map QName Name
-&gt; (forall a1. (Telescope -&gt; TCM a1) -&gt; TCM a1)
-&gt; ([Maybe Name] -&gt; Telescope -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a.
Map QName Name
-&gt; (forall a1. (Telescope -&gt; TCM a1) -&gt; TCM a1)
-&gt; ([Maybe Name] -&gt; Telescope -&gt; TCM a)
-&gt; TCM a
</span><a href="Agda.TypeChecking.Generalize.html#generalizeTelescope"><span class="hs-identifier hs-var">generalizeTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621682142978"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; (Telescope -&gt; TCM a1) -&gt; TCM a1
forall a. Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope"><span class="hs-identifier hs-var">checkTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682142979"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Maybe Name] -&gt; Telescope -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a)
    -&gt; [Maybe Name] -&gt; Telescope -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; [Maybe Name] -&gt; Telescope -&gt; TCMT IO a
forall a b c. ((a, b) -&gt; c) -&gt; a -&gt; b -&gt; c
</span><span class="hs-identifier hs-var">curry</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name] -&gt; Telescope -&gt; TCMT IO a)
    -&gt; ([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; ([Maybe Name] -&gt; Telescope -&gt; TCMT IO a)
-&gt; TCMT IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Maybe Name] -&gt; Telescope -&gt; TCMT IO a)
-&gt; ([Maybe Name], Telescope) -&gt; TCMT IO a
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621682142980"><span class="annot"><span class="annottext">tr :: ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a
</span><a href="#local-6989586621682142980"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
    -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier hs-var">applyUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682142979"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
  -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
 -&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
 -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
 -&gt; TCMT IO a)
-&gt; (((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
    -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
-&gt; (ModuleName
    -&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
    -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
    -&gt; TCMT IO a)
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall b a. Maybe b -&gt; (b -&gt; a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhenJust"><span class="hs-identifier hs-var">applyWhenJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621682142976"><span class="hs-identifier hs-var">mm</span></a></span><span> </span><span class="annot"><span class="annottext">((ModuleName
  -&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
  -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
  -&gt; TCMT IO a)
 -&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
 -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
 -&gt; TCMT IO a)
-&gt; (ModuleName
    -&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
    -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
    -&gt; TCMT IO a)
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682142988"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682142988"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">Call
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b.
Call
-&gt; ((a -&gt; TCMT IO b) -&gt; TCMT IO b) -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b.
MonadTrace m =&gt;
Call -&gt; ((a -&gt; m b) -&gt; m b) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCallCPS"><span class="hs-identifier hs-var">traceCallCPS</span></a></span><span> </span><span class="annot"><span class="annottext">(Call
 -&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
 -&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
 -&gt; TCMT IO a)
-&gt; Call
-&gt; ((([Maybe Name], Telescope) -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (([Maybe Name], Telescope) -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Telescope -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckModuleParameters"><span class="hs-identifier hs-var">CheckModuleParameters</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682142988"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682142979"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- | Type check a (module) telescope.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--   Binds the variables defined by the telescope.</span><span>
</span><span id="line-267"></span><span id="local-6989586621682142991"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope"><span class="hs-identifier hs-type">checkTelescope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Telescope"><span class="hs-identifier hs-type">A.Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142991"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682142991"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-268"></span><span id="checkTelescope"><span class="annot"><span class="annottext">checkTelescope :: forall a. Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope"><span class="hs-identifier hs-var hs-var">checkTelescope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
forall a. LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope%27"><span class="hs-identifier hs-var">checkTelescope'</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#LamNotPi"><span class="hs-identifier hs-var">LamNotPi</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | Type check the telescope of a dependent function type.</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   Binds the resurrected variables defined by the telescope.</span><span>
</span><span id="line-272"></span><span class="hs-comment">--   The returned telescope is unmodified (not resurrected).</span><span>
</span><span id="line-273"></span><span id="local-6989586621682140502"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPiTelescope"><span class="hs-identifier hs-type">checkPiTelescope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Telescope"><span class="hs-identifier hs-type">A.Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140502"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140502"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-274"></span><span id="checkPiTelescope"><span class="annot"><span class="annottext">checkPiTelescope :: forall a. Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPiTelescope"><span class="hs-identifier hs-var hs-var">checkPiTelescope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
forall a. LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope%27"><span class="hs-identifier hs-var">checkTelescope'</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#PiNotLam"><span class="hs-identifier hs-var">PiNotLam</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><span class="hs-comment">-- | Flag to control resurrection on domains.</span></span><span>
</span><span id="line-277"></span><span class="hs-keyword">data</span><span> </span><span id="LamOrPi"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#LamOrPi"><span class="hs-identifier hs-var">LamOrPi</span></a></span></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LamNotPi"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#LamNotPi"><span class="hs-identifier hs-var">LamNotPi</span></a></span></span><span> </span><span class="hs-comment">-- ^ We are checking a module telescope.</span><span>
</span><span id="line-279"></span><span>             </span><span class="hs-comment">--   We pass into the type world to check the domain type.</span><span>
</span><span id="line-280"></span><span>             </span><span class="hs-comment">--   This resurrects the whole context.</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PiNotLam"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#PiNotLam"><span class="hs-identifier hs-var">PiNotLam</span></a></span></span><span> </span><span class="hs-comment">-- ^ We are checking a telescope in a Pi-type.</span><span>
</span><span id="line-282"></span><span>             </span><span class="hs-comment">--   We stay in the term world, but add resurrected</span><span>
</span><span id="line-283"></span><span>             </span><span class="hs-comment">--   domains to the context to check the remaining</span><span>
</span><span id="line-284"></span><span>             </span><span class="hs-comment">--   domains and codomain of the Pi-type.</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682142996"><span id="local-6989586621682143001"><span class="annot"><span class="annottext">LamOrPi -&gt; LamOrPi -&gt; Bool
(LamOrPi -&gt; LamOrPi -&gt; Bool)
-&gt; (LamOrPi -&gt; LamOrPi -&gt; Bool) -&gt; Eq LamOrPi
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: LamOrPi -&gt; LamOrPi -&gt; Bool
== :: LamOrPi -&gt; LamOrPi -&gt; Bool
$c/= :: LamOrPi -&gt; LamOrPi -&gt; Bool
/= :: LamOrPi -&gt; LamOrPi -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143006"><span id="local-6989586621682143008"><span id="local-6989586621682143012"><span class="annot"><span class="annottext">Int -&gt; LamOrPi -&gt; ArgName -&gt; ArgName
[LamOrPi] -&gt; ArgName -&gt; ArgName
LamOrPi -&gt; ArgName
(Int -&gt; LamOrPi -&gt; ArgName -&gt; ArgName)
-&gt; (LamOrPi -&gt; ArgName)
-&gt; ([LamOrPi] -&gt; ArgName -&gt; ArgName)
-&gt; Show LamOrPi
forall a.
(Int -&gt; a -&gt; ArgName -&gt; ArgName)
-&gt; (a -&gt; ArgName) -&gt; ([a] -&gt; ArgName -&gt; ArgName) -&gt; Show a
$cshowsPrec :: Int -&gt; LamOrPi -&gt; ArgName -&gt; ArgName
showsPrec :: Int -&gt; LamOrPi -&gt; ArgName -&gt; ArgName
$cshow :: LamOrPi -&gt; ArgName
show :: LamOrPi -&gt; ArgName
$cshowList :: [LamOrPi] -&gt; ArgName -&gt; ArgName
showList :: [LamOrPi] -&gt; ArgName -&gt; ArgName
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><span class="hs-comment">-- | Type check a telescope. Binds the variables defined by the telescope.</span></span><span>
</span><span id="line-288"></span><span id="local-6989586621682140591"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope%27"><span class="hs-identifier hs-type">checkTelescope'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#LamOrPi"><span class="hs-identifier hs-type">LamOrPi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Telescope"><span class="hs-identifier hs-type">A.Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140591"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140591"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-289"></span><span id="checkTelescope%27"><span class="annot"><span class="annottext">checkTelescope' :: forall a. LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope%27"><span class="hs-identifier hs-var hs-var">checkTelescope'</span></a></span></span><span> </span><span id="local-6989586621682143018"><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143018"><span class="hs-identifier hs-var">lamOrPi</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span id="local-6989586621682143019"><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143019"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143019"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
forall a. Tele a
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span>
</span><span id="line-290"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope%27"><span class="hs-identifier hs-var">checkTelescope'</span></a></span><span> </span><span id="local-6989586621682143021"><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143021"><span class="hs-identifier hs-var">lamOrPi</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143022"><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682143022"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682143023"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143023"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143024"><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143024"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><span class="annottext">LamOrPi -&gt; TypedBinding -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
forall a. LamOrPi -&gt; TypedBinding -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTypedBindings"><span class="hs-identifier hs-var">checkTypedBindings</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143021"><span class="hs-identifier hs-var">lamOrPi</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682143022"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">((Telescope -&gt; TCM a) -&gt; TCM a) -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682143026"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143026"><span class="hs-identifier hs-var">tel1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
forall a. LamOrPi -&gt; Telescope -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTelescope%27"><span class="hs-identifier hs-var">checkTelescope'</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143021"><span class="hs-identifier hs-var">lamOrPi</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143023"><span class="hs-identifier hs-var">tel</span></a></span><span>  </span><span class="annot"><span class="annottext">((Telescope -&gt; TCM a) -&gt; TCM a) -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682143027"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143027"><span class="hs-identifier hs-var">tel2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143024"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; TCM a) -&gt; Telescope -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143026"><span class="hs-identifier hs-var">tel1</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143027"><span class="hs-identifier hs-var">tel2</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Check the domain of a function type.</span><span>
</span><span id="line-296"></span><span class="hs-comment">--   Used in @checkTypedBindings@ and to typecheck @A.Fun@ cases.</span><span>
</span><span id="line-297"></span><span id="local-6989586621682140602"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkDomain"><span class="hs-identifier hs-type">checkDomain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#LensLock"><span class="hs-identifier hs-type">LensLock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140602"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensModality"><span class="hs-identifier hs-type">LensModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140602"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#LamOrPi"><span class="hs-identifier hs-type">LamOrPi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140602"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-298"></span><span id="checkDomain"><span class="annot"><span class="annottext">checkDomain :: forall a.
(LensLock a, LensModality a) =&gt;
LamOrPi -&gt; List1 a -&gt; Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#checkDomain"><span class="hs-identifier hs-var hs-var">checkDomain</span></a></span></span><span> </span><span id="local-6989586621682143088"><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143088"><span class="hs-identifier hs-var">lamOrPi</span></a></span></span><span> </span><span id="local-6989586621682143089"><span class="annot"><span class="annottext">List1 a
</span><a href="#local-6989586621682143089"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682143090"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143090"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-comment">-- Get cohesion and quantity of arguments, which should all be equal because</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-comment">-- they come from the same annotated &#928;-type.</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143091"><span class="annot"><span class="annottext">Cohesion
</span><a href="#local-6989586621682143091"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621682143092"><span class="annot"><span class="annottext">[Cohesion]
</span><a href="#local-6989586621682143092"><span class="hs-identifier hs-var hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Cohesion) -&gt; List1 a -&gt; NonEmpty Cohesion
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Cohesion) -&gt; (a -&gt; Modality) -&gt; a -&gt; Cohesion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 a
</span><a href="#local-6989586621682143089"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Cohesion -&gt; Bool) -&gt; [Cohesion] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cohesion
</span><a href="#local-6989586621682143091"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cohesion -&gt; Cohesion -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Cohesion]
</span><a href="#local-6989586621682143092"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143097"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682143097"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621682143098"><span class="annot"><span class="annottext">[Quantity]
</span><a href="#local-6989586621682143098"><span class="hs-identifier hs-var hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Quantity) -&gt; List1 a -&gt; NonEmpty Quantity
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Quantity) -&gt; (a -&gt; Modality) -&gt; a -&gt; Quantity
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 a
</span><a href="#local-6989586621682143089"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Quantity -&gt; Bool) -&gt; [Quantity] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682143097"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Quantity]
</span><a href="#local-6989586621682143098"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621682143100"><span class="annot"><a href="#local-6989586621682143100"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; TCM Type -&gt; TCM Type
forall (tcm :: * -&gt; *) q a.
(MonadTCEnv tcm, LensQuantity q) =&gt;
q -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyQuantityToJudgement"><span class="hs-identifier hs-var">applyQuantityToJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682143097"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-308"></span><span>         </span><span class="annot"><span class="annottext">Cohesion -&gt; TCM Type -&gt; TCM Type
forall (tcm :: * -&gt; *) m a.
(MonadTCEnv tcm, LensCohesion m) =&gt;
m -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyCohesionToContext"><span class="hs-identifier hs-var">applyCohesionToContext</span></a></span><span> </span><span class="annot"><span class="annottext">Cohesion
</span><a href="#local-6989586621682143091"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-309"></span><span>         </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; (TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall b (m :: * -&gt; *) a.
(IsBool b, Monad m) =&gt;
m b -&gt; (m a -&gt; m a) -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Function.html#applyWhenM"><span class="hs-identifier hs-var">applyWhenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optPolarity"><span class="hs-identifier hs-var">optPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolarityModality -&gt; TCM Type -&gt; TCM Type
forall (tcm :: * -&gt; *) p a.
(MonadTCEnv tcm, LensModalPolarity p) =&gt;
p -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyPolarityToContext"><span class="hs-identifier hs-var">applyPolarityToContext</span></a></span><span> </span><span class="annot"><span class="annottext">PolarityModality
</span><a href="Agda.Syntax.Common.html#negativePolarity"><span class="hs-identifier hs-var">negativePolarity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-310"></span><span>         </span><span class="annot"><span class="annottext">LamOrPi -&gt; TCM Type -&gt; TCM Type
forall {m :: * -&gt; *} {a}.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
LamOrPi -&gt; m a -&gt; m a
</span><a href="#local-6989586621682143108"><span class="hs-identifier hs-var">modEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143088"><span class="hs-identifier hs-var">lamOrPi</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143090"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-comment">-- Andrea TODO: also make sure that LockUniv implies IsLock</span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682143111"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682143111"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Lock
forall a. LensLock a =&gt; a -&gt; Lock
</span><a href="Agda.Syntax.Common.html#getLock"><span class="hs-identifier hs-var">getLock</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682143111"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#IsLock"><span class="hs-identifier hs-type">IsLock</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Lock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143089"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>         </span><span class="hs-comment">-- Solves issue #5033</span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-type">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">isJust</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#getName%27"><span class="hs-identifier hs-type">getName'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinLockUniv"><span class="hs-identifier hs-type">builtinLockUniv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoBindingForPrimitive"><span class="hs-identifier hs-type">NoBindingForPrimitive</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinLockUniv"><span class="hs-identifier hs-type">builtinLockUniv</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalSort"><span class="hs-identifier hs-type">equalSort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-type">getSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143100"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#LockUniv"><span class="hs-identifier hs-type">LockUniv</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682143100"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-comment">-- if we are checking a typed lambda, we resurrect before we check the</span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-comment">-- types, but do not modify the new context entries</span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-comment">-- otherwise, if we are checking a pi, we do not resurrect, but</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-comment">-- modify the new context entries</span><span>
</span><span id="line-325"></span><span>        </span><span id="local-6989586621682143108"><span class="annot"><span class="annottext">modEnv :: LamOrPi -&gt; m a -&gt; m a
</span><a href="#local-6989586621682143108"><span class="hs-identifier hs-var hs-var">modEnv</span></a></span></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#LamNotPi"><span class="hs-identifier hs-var">LamNotPi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><a href="#local-6989586621682143108"><span class="hs-identifier hs-var">modEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span id="local-6989586621682140494"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPiDomain"><span class="hs-identifier hs-type">checkPiDomain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#LensLock"><span class="hs-identifier hs-type">LensLock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140494"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensModality"><span class="hs-identifier hs-type">LensModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140494"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140494"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-329"></span><span id="checkPiDomain"><span class="annot"><span class="annottext">checkPiDomain :: forall a.
(LensLock a, LensModality a) =&gt;
List1 a -&gt; Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPiDomain"><span class="hs-identifier hs-var hs-var">checkPiDomain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LamOrPi -&gt; List1 a -&gt; Expr -&gt; TCM Type
forall a.
(LensLock a, LensModality a) =&gt;
LamOrPi -&gt; List1 a -&gt; Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#checkDomain"><span class="hs-identifier hs-var">checkDomain</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#PiNotLam"><span class="hs-identifier hs-var">PiNotLam</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | Check a typed binding and extends the context with the bound variables.</span><span>
</span><span id="line-332"></span><span class="hs-comment">--   The telescope passed to the continuation is valid in the original context.</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">--   Parametrized by a flag whether we check a typed lambda or a Pi. This flag</span><span>
</span><span id="line-335"></span><span class="hs-comment">--   is needed for irrelevance.</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span id="local-6989586621682140600"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTypedBindings"><span class="hs-identifier hs-type">checkTypedBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#LamOrPi"><span class="hs-identifier hs-type">LamOrPi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#TypedBinding"><span class="hs-identifier hs-type">A.TypedBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140600"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140600"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-338"></span><span id="checkTypedBindings"><span class="annot"><span class="annottext">checkTypedBindings :: forall a. LamOrPi -&gt; TypedBinding -&gt; (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTypedBindings"><span class="hs-identifier hs-var hs-var">checkTypedBindings</span></a></span></span><span> </span><span id="local-6989586621682143205"><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143205"><span class="hs-identifier hs-var">lamOrPi</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#TBind"><span class="hs-identifier hs-type">A.TBind</span></a></span><span> </span><span id="local-6989586621682143207"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143207"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143208"><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143208"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span id="local-6989586621682143209"><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143209"><span class="hs-identifier hs-var">xps</span></a></span></span><span> </span><span id="local-6989586621682143210"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143210"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143211"><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143211"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143212"><span class="annot"><span class="annottext">xs :: List1 (NamedArg Name)
</span><a href="#local-6989586621682143212"><span class="hs-identifier hs-var hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Binder' BindName) -&gt; NamedArg Name)
-&gt; List1 (NamedArg (Binder' BindName)) -&gt; List1 (NamedArg Name)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Binder' BindName -&gt; Name)
-&gt; NamedArg (Binder' BindName) -&gt; NamedArg Name
forall a b. (a -&gt; b) -&gt; NamedArg a -&gt; NamedArg b
</span><a href="Agda.Syntax.Common.html#updateNamedArg"><span class="hs-identifier hs-var">updateNamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">((Binder' BindName -&gt; Name)
 -&gt; NamedArg (Binder' BindName) -&gt; NamedArg Name)
-&gt; (Binder' BindName -&gt; Name)
-&gt; NamedArg (Binder' BindName)
-&gt; NamedArg Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Name)
-&gt; (Binder' BindName -&gt; BindName) -&gt; Binder' BindName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Binder' BindName -&gt; BindName
forall a. Binder' a -&gt; a
</span><a href="Agda.Syntax.Abstract.html#binderName"><span class="hs-identifier hs-var">A.binderName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143209"><span class="hs-identifier hs-var">xps</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621682143216"><span class="annot"><a href="#local-6989586621682143216"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Ranged Expr -&gt; TCM Term)
-&gt; Maybe (Ranged Expr) -&gt; TCMT IO (Maybe Term)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LamOrPi -&gt; Ranged Expr -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTacticAttribute"><span class="hs-identifier hs-var">checkTacticAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143205"><span class="hs-identifier hs-var">lamOrPi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Ranged Expr) -&gt; TCMT IO (Maybe Term))
-&gt; Maybe (Ranged Expr) -&gt; TCMT IO (Maybe Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TacticAttribute -&gt; Maybe (Ranged Expr)
forall a. TacticAttribute' a -&gt; Maybe (Ranged a)
</span><a href="Agda.Syntax.Concrete.html#theTacticAttribute"><span class="hs-identifier hs-var">theTacticAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">(TacticAttribute -&gt; Maybe (Ranged Expr))
-&gt; TacticAttribute -&gt; Maybe (Ranged Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo -&gt; TacticAttribute
</span><a href="Agda.Syntax.Abstract.html#tbTacticAttr"><span class="hs-identifier hs-var">tbTacticAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143208"><span class="hs-identifier hs-var">tac</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-type">whenJust</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143216"><span class="hs-identifier hs-type">tac</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143221"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143221"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.tactic&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checked tactic attribute:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143221"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">-- Andreas, 2011-04-26 irrelevant function arguments may appear</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">-- non-strictly in the codomain type</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- 2011-10-04 if flag --experimental-irrelevance is set</span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621682143222"><span class="annot"><a href="#local-6989586621682143222"><span class="hs-identifier hs-var">experimental</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optExperimentalIrrelevance"><span class="hs-identifier hs-type">optExperimentalIrrelevance</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621682143224"><span class="annot"><a href="#local-6989586621682143224"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkDomain"><span class="hs-identifier hs-type">checkDomain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143205"><span class="hs-identifier hs-type">lamOrPi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143209"><span class="hs-identifier hs-type">xps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143210"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- Jesper, 2019-02-12, Issue #3534: warn if the type of an</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-comment">-- instance argument does not have the right shape</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><a href="Agda.Utils.List1.html#unlessNull"><span class="hs-identifier hs-type">List1.unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">List1.filter</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#isInstance"><span class="hs-identifier hs-type">isInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143209"><span class="hs-identifier hs-type">xps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143228"><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143228"><span class="hs-identifier hs-var">ixs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682143229"><span class="annot"><a href="#local-6989586621682143229"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143230"><span class="annot"><a href="#local-6989586621682143230"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM (Telescope, Term, OutputTypeName)
</span><a href="Agda.TypeChecking.InstanceArguments.html#getOutputTypeName"><span class="hs-identifier hs-var">getOutputTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143224"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682143230"><span class="hs-identifier hs-type">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html#OutputTypeName"><span class="hs-identifier hs-type">OutputTypeName</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html#OutputTypeVar"><span class="hs-identifier hs-type">OutputTypeVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html#OutputTypeNameNotYetKnown"><span class="hs-identifier hs-type">OutputTypeNameNotYetKnown</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html#OutputTypeVisiblePi"><span class="hs-identifier hs-type">OutputTypeVisiblePi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143210"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; (Doc -&gt; Warning) -&gt; Doc -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#InstanceArgWithExplicitArg"><span class="hs-identifier hs-var">InstanceArgWithExplicitArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypedBinding -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; TypedBinding -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range
-&gt; List1 (NamedArg (Binder' BindName)) -&gt; Expr -&gt; TypedBinding
</span><a href="Agda.Syntax.Abstract.html#mkTBind"><span class="hs-identifier hs-var">A.mkTBind</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143207"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143228"><span class="hs-identifier hs-var">ixs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143210"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="annottext">OutputTypeName
</span><a href="Agda.TypeChecking.InstanceArguments.html#NoOutputTypeName"><span class="hs-identifier hs-var">NoOutputTypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143210"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-360"></span><span>          </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; (Doc -&gt; Warning) -&gt; Doc -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#InstanceNoOutputTypeName"><span class="hs-identifier hs-var">InstanceNoOutputTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypedBinding -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; TypedBinding -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range
-&gt; List1 (NamedArg (Binder' BindName)) -&gt; Expr -&gt; TypedBinding
</span><a href="Agda.Syntax.Abstract.html#mkTBind"><span class="hs-identifier hs-var">A.mkTBind</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143207"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143228"><span class="hs-identifier hs-var">ixs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143210"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143251"><span class="annot"><a href="#local-6989586621682143251"><span class="hs-identifier hs-var hs-var">setTac</span></a></span></span><span> </span><span id="local-6989586621682143252"><span class="annot"><span class="annottext">Maybe t
</span><a href="#local-6989586621682143252"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom' t e)
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom' t e)
forall a. Tele a
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span class="annot"><a href="#local-6989586621682143251"><span class="hs-identifier hs-var">setTac</span></a></span><span> </span><span id="local-6989586621682143253"><span class="annot"><span class="annottext">Maybe t
</span><a href="#local-6989586621682143253"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682143255"><span class="annot"><span class="annottext">Dom' t e
</span><a href="#local-6989586621682143255"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143256"><span class="annot"><span class="annottext">Abs (Tele (Dom' t e))
</span><a href="#local-6989586621682143256"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom' t e -&gt; Abs (Tele (Dom' t e)) -&gt; Tele (Dom' t e)
forall a. a -&gt; Abs (Tele a) -&gt; Tele a
</span><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-var">ExtendTel</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' t e
</span><a href="#local-6989586621682143255"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#domTactic"><span class="hs-identifier hs-var">domTactic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682143253"><span class="hs-identifier hs-type">tac</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">(Abs (Tele (Dom' t e)) -&gt; Tele (Dom' t e))
-&gt; Abs (Tele (Dom' t e)) -&gt; Tele (Dom' t e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe t -&gt; Tele (Dom' t e) -&gt; Tele (Dom' t e)
</span><a href="#local-6989586621682143251"><span class="hs-identifier hs-var">setTac</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe t -&gt; Maybe t
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Maybe t
</span><a href="#local-6989586621682143253"><span class="hs-identifier hs-var">tac</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tele (Dom' t e) -&gt; Tele (Dom' t e))
-&gt; Abs (Tele (Dom' t e)) -&gt; Abs (Tele (Dom' t e))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Abs (Tele (Dom' t e))
</span><a href="#local-6989586621682143256"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span id="local-6989586621682143259"><span class="annot"><a href="#local-6989586621682143259"><span class="hs-identifier hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg Name -&gt; NamedArg Name)
-&gt; List1 (NamedArg Name) -&gt; List1 (NamedArg Name)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LamOrPi -&gt; Bool -&gt; NamedArg Name -&gt; NamedArg Name
forall {c} {b}.
(LensModalPolarity c, IsBool b, LensRelevance c) =&gt;
LamOrPi -&gt; b -&gt; c -&gt; c
</span><a href="#local-6989586621682143260"><span class="hs-identifier hs-var">modMod</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143205"><span class="hs-identifier hs-var">lamOrPi</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682143222"><span class="hs-identifier hs-var">experimental</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143212"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143261"><span class="annot"><a href="#local-6989586621682143261"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Telescope -&gt; Telescope
forall {t} {t} {e}.
Subst t =&gt;
Maybe t -&gt; Tele (Dom' t e) -&gt; Tele (Dom' t e)
</span><a href="#local-6989586621682143251"><span class="hs-identifier hs-var">setTac</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682143216"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; Telescope) -&gt; Telescope -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name) -&gt; Type -&gt; Telescope
</span><a href="Agda.TypeChecking.Substitute.html#namedBindsToTel1"><span class="hs-identifier hs-var">namedBindsToTel1</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143212"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143224"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143259"><span class="hs-identifier hs-type">xs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682143224"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#addTypedPatterns"><span class="hs-identifier hs-type">addTypedPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143209"><span class="hs-identifier hs-type">xps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143211"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143261"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-comment">-- if we are checking a typed lambda, we resurrect before we check the</span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-comment">-- types, but do not modify the new context entries</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-comment">-- otherwise, if we are checking a pi, we do not resurrect, but</span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-comment">-- modify the new context entries</span><span>
</span><span id="line-374"></span><span>        </span><span id="local-6989586621682143289"><span class="annot"><span class="annottext">modEnv :: LamOrPi -&gt; m a -&gt; m a
</span><a href="#local-6989586621682143289"><span class="hs-identifier hs-var hs-var">modEnv</span></a></span></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#LamNotPi"><span class="hs-identifier hs-var">LamNotPi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><a href="#local-6989586621682143289"><span class="hs-identifier hs-var">modEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-376"></span><span>        </span><span id="local-6989586621682143260"><span class="annot"><span class="annottext">modMod :: LamOrPi -&gt; b -&gt; c -&gt; c
</span><a href="#local-6989586621682143260"><span class="hs-identifier hs-var hs-var">modMod</span></a></span></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#PiNotLam"><span class="hs-identifier hs-var">PiNotLam</span></a></span><span> </span><span id="local-6989586621682143302"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682143302"><span class="hs-identifier hs-var">xp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolarityModality -&gt; c -&gt; c
forall a. LensModalPolarity a =&gt; PolarityModality -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#inverseApplyPolarity"><span class="hs-identifier hs-var">inverseApplyPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModalPolarity -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#withStandardLock"><span class="hs-identifier hs-var">withStandardLock</span></a></span><span> </span><span class="annot"><span class="annottext">ModalPolarity
</span><a href="Agda.Syntax.Common.html#UnusedPolarity"><span class="hs-identifier hs-var">UnusedPolarity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>                             </span><span class="annot"><span class="annottext">(c -&gt; c) -&gt; (c -&gt; c) -&gt; c -&gt; c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; (c -&gt; c) -&gt; c -&gt; c
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682143302"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Relevance -&gt; Relevance) -&gt; c -&gt; c
forall a. LensRelevance a =&gt; (Relevance -&gt; Relevance) -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#mapRelevance"><span class="hs-identifier hs-var">mapRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#irrelevantToShapeIrrelevant"><span class="hs-identifier hs-var">irrelevantToShapeIrrelevant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><a href="#local-6989586621682143260"><span class="hs-identifier hs-var">modMod</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c -&gt; c
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTypedBindings"><span class="hs-identifier hs-var">checkTypedBindings</span></a></span><span> </span><span id="local-6989586621682143309"><span class="annot"><span class="annottext">LamOrPi
</span><a href="#local-6989586621682143309"><span class="hs-identifier hs-var">lamOrPi</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#TLet"><span class="hs-identifier hs-type">A.TLet</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143311"><span class="annot"><span class="annottext">List1 LetBinding
</span><a href="#local-6989586621682143311"><span class="hs-identifier hs-var">lbs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143312"><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143312"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><span class="annottext">List1 LetBinding -&gt; TCM a -&gt; TCM a
forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings"><span class="hs-identifier hs-var">checkLetBindings</span></a></span><span> </span><span class="annot"><span class="annottext">List1 LetBinding
</span><a href="#local-6989586621682143311"><span class="hs-identifier hs-var">lbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; TCM a
</span><a href="#local-6989586621682143312"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
forall a. Tele a
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="annot"><span class="hs-comment">-- | After a typed binding has been checked, add the patterns it binds</span></span><span>
</span><span id="line-384"></span><span id="local-6989586621682140677"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#addTypedPatterns"><span class="hs-identifier hs-type">addTypedPatterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Binder"><span class="hs-identifier hs-type">A.Binder</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140677"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140677"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-385"></span><span id="addTypedPatterns"><span class="annot"><span class="annottext">addTypedPatterns :: forall a. List1 (NamedArg (Binder' BindName)) -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#addTypedPatterns"><span class="hs-identifier hs-var hs-var">addTypedPatterns</span></a></span></span><span> </span><span id="local-6989586621682143318"><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143318"><span class="hs-identifier hs-var">xps</span></a></span></span><span> </span><span id="local-6989586621682143319"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682143319"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-387"></span><span>    </span><span id="local-6989586621682143320"><span class="annot"><span class="annottext">ps :: [(Pattern, BindName)]
</span><a href="#local-6989586621682143320"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Binder' BindName) -&gt; Maybe (Pattern, BindName))
-&gt; List1 (NamedArg (Binder' BindName)) -&gt; [(Pattern, BindName)]
forall a b. (a -&gt; Maybe b) -&gt; List1 a -&gt; [b]
</span><a href="Agda.Utils.List1.html#mapMaybe"><span class="hs-identifier hs-var">List1.mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binder' BindName -&gt; Maybe (Pattern, BindName)
forall a. Binder' a -&gt; Maybe (Pattern, a)
</span><a href="Agda.Syntax.Abstract.html#extractPattern"><span class="hs-identifier hs-var">A.extractPattern</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder' BindName -&gt; Maybe (Pattern, BindName))
-&gt; (NamedArg (Binder' BindName) -&gt; Binder' BindName)
-&gt; NamedArg (Binder' BindName)
-&gt; Maybe (Pattern, BindName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; Binder' BindName
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143318"><span class="hs-identifier hs-var">xps</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621682143324"><span class="annot"><span class="annottext">lbs :: [LetBinding]
</span><a href="#local-6989586621682143324"><span class="hs-identifier hs-var hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Pattern, BindName) -&gt; LetBinding)
-&gt; [(Pattern, BindName)] -&gt; [LetBinding]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Pattern, BindName) -&gt; LetBinding
</span><a href="#local-6989586621682143325"><span class="hs-identifier hs-var">letBinding</span></a></span><span> </span><span class="annot"><span class="annottext">[(Pattern, BindName)]
</span><a href="#local-6989586621682143320"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><a href="#local-6989586621682143325"><span class="hs-identifier hs-type">letBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621682143325"><span class="annot"><span class="annottext">letBinding :: (Pattern, BindName) -&gt; LetBinding
</span><a href="#local-6989586621682143325"><span class="hs-identifier hs-var hs-var">letBinding</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143326"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682143326"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143327"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682143327"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetInfo -&gt; ArgInfo -&gt; Pattern -&gt; Expr -&gt; LetBinding
</span><a href="Agda.Syntax.Abstract.html#LetPatBind"><span class="hs-identifier hs-var">A.LetPatBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; LetInfo
</span><a href="Agda.Syntax.Info.html#LetRange"><span class="hs-identifier hs-var">A.LetRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143330"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682143326"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Var"><span class="hs-identifier hs-var">A.Var</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Expr) -&gt; Name -&gt; Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682143327"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682143330"><span class="annot"><span class="annottext">r :: Range
</span><a href="#local-6989586621682143330"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; BindName -&gt; Range
forall u t. (HasRange u, HasRange t) =&gt; u -&gt; t -&gt; Range
</span><a href="Agda.Syntax.Position.html#fuseRange"><span class="hs-identifier hs-var">fuseRange</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682143326"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682143327"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">[LetBinding] -&gt; TCM a -&gt; TCM a
forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings%27"><span class="hs-identifier hs-var">checkLetBindings'</span></a></span><span> </span><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682143324"><span class="hs-identifier hs-var">lbs</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682143319"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><span class="hs-comment">-- | Check a tactic attribute. Should have type Term &#8594; TC &#8868;.</span></span><span>
</span><span id="line-397"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTacticAttribute"><span class="hs-identifier hs-type">checkTacticAttribute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#LamOrPi"><span class="hs-identifier hs-type">LamOrPi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Ranged"><span class="hs-identifier hs-type">Ranged</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-398"></span><span id="checkTacticAttribute"><span class="annot"><span class="annottext">checkTacticAttribute :: LamOrPi -&gt; Ranged Expr -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTacticAttribute"><span class="hs-identifier hs-var hs-var">checkTacticAttribute</span></a></span></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#LamNotPi"><span class="hs-identifier hs-var">LamNotPi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Ranged"><span class="hs-identifier hs-type">Ranged</span></a></span><span> </span><span id="local-6989586621682143336"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143336"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143337"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143337"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143336"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#TacticAttributeNotAllowed"><span class="hs-identifier hs-var">TacticAttributeNotAllowed</span></a></span><span>
</span><span id="line-400"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkTacticAttribute"><span class="hs-identifier hs-var">checkTacticAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#PiNotLam"><span class="hs-identifier hs-var">PiNotLam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Ranged"><span class="hs-identifier hs-type">Ranged</span></a></span><span> </span><span id="local-6989586621682143339"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143339"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143340"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143340"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621682143341"><span class="annot"><a href="#local-6989586621682143341"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Type
forall (m :: * -&gt; *). Functor m =&gt; m Term -&gt; m Type
</span><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTerm"><span class="hs-identifier hs-var">primAgdaTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type -&gt; TCM Type
forall (m :: * -&gt; *). HasOptions m =&gt; m Type -&gt; m Type -&gt; m Type
</span><a href="Agda.TypeChecking.Primitive.Base.html#--%3E"><span class="hs-operator hs-var">--&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Type
forall (m :: * -&gt; *). Functor m =&gt; m Term -&gt; m Type
</span><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTCM"><span class="hs-identifier hs-var">primAgdaTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%23%3E"><span class="hs-operator hs-var">&lt;#&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primLevelZero"><span class="hs-identifier hs-var">primLevelZero</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primUnit"><span class="hs-identifier hs-var">primUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-type">checkExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143340"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143341"><span class="hs-identifier hs-type">expectedType</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPath"><span class="hs-identifier hs-type">checkPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Binder"><span class="hs-identifier hs-type">Binder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Type"><span class="hs-identifier hs-type">A.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-405"></span><span id="checkPath"><span class="annot"><span class="annottext">checkPath :: NamedArg (Binder' BindName) -&gt; Expr -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPath"><span class="hs-identifier hs-var hs-var">checkPath</span></a></span></span><span> </span><span id="local-6989586621682143353"><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682143353"><span class="hs-identifier hs-var">xp</span></a></span></span><span> </span><span id="local-6989586621682143354"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143354"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621682143355"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143355"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143356"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143356"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking path lambda&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682143353"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-407"></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binder' BindName -&gt; Maybe (Pattern, BindName)
forall a. Binder' a -&gt; Maybe (Pattern, a)
</span><a href="Agda.Syntax.Abstract.html#extractPattern"><span class="hs-identifier hs-var">A.extractPattern</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder' BindName -&gt; Maybe (Pattern, BindName))
-&gt; Binder' BindName -&gt; Maybe (Pattern, BindName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; Binder' BindName
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682143353"><span class="hs-identifier hs-var">xp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682143353"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#PatternInPathLambda"><span class="hs-identifier hs-var">PatternInPathLambda</span></a></span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Pattern, BindName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143360"><span class="annot"><span class="annottext">x :: NamedArg Name
</span><a href="#local-6989586621682143360"><span class="hs-identifier hs-var hs-var hs-var">x</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Binder' BindName -&gt; Name)
-&gt; NamedArg (Binder' BindName) -&gt; NamedArg Name
forall a b. (a -&gt; b) -&gt; NamedArg a -&gt; NamedArg b
</span><a href="Agda.Syntax.Common.html#updateNamedArg"><span class="hs-identifier hs-var">updateNamedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Name)
-&gt; (Binder' BindName -&gt; BindName) -&gt; Binder' BindName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Binder' BindName -&gt; BindName
forall a. Binder' a -&gt; a
</span><a href="Agda.Syntax.Abstract.html#binderName"><span class="hs-identifier hs-var">A.binderName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682143353"><span class="hs-identifier hs-var">xp</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span id="local-6989586621682143361"><span class="annot"><span class="annottext">info :: ArgInfo
</span><a href="#local-6989586621682143361"><span class="hs-identifier hs-var hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg Name -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Name
</span><a href="#local-6989586621682143360"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#PathType"><span class="hs-identifier hs-type">PathType</span></a></span><span> </span><span id="local-6989586621682143364"><span class="annot"><a href="#local-6989586621682143364"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682143365"><span class="annot"><a href="#local-6989586621682143365"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682143366"><span class="annot"><a href="#local-6989586621682143366"><span class="hs-identifier hs-var">level</span></a></span></span><span> </span><span id="local-6989586621682143367"><span class="annot"><a href="#local-6989586621682143367"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621682143368"><span class="annot"><a href="#local-6989586621682143368"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682143369"><span class="annot"><a href="#local-6989586621682143369"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO PathView
forall (m :: * -&gt; *). HasBuiltins m =&gt; Type -&gt; m PathView
</span><a href="Agda.TypeChecking.Monad.Builtin.html#pathView"><span class="hs-identifier hs-var">pathView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143356"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621682143371"><span class="annot"><a href="#local-6989586621682143371"><span class="hs-identifier hs-var">interval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Cubical.Base.html#primIntervalType"><span class="hs-identifier hs-type">primIntervalType</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621682143373"><span class="annot"><a href="#local-6989586621682143373"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682143360"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682143371"><span class="hs-identifier hs-type">interval</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-415"></span><span>           </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-type">checkExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143355"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-type">raise</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621682143364"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-type">raise</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143367"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-type">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-type">argN</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621682143378"><span class="annot"><a href="#local-6989586621682143378"><span class="hs-identifier hs-var">iZero</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIZero"><span class="hs-identifier hs-type">primIZero</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621682143380"><span class="annot"><a href="#local-6989586621682143380"><span class="hs-identifier hs-var">iOne</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIOne"><span class="hs-identifier hs-type">primIOne</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143382"><span class="annot"><a href="#local-6989586621682143382"><span class="hs-identifier hs-var hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubstArg Term -&gt; Term -&gt; Term
forall a. Subst a =&gt; Int -&gt; SubstArg a -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Term
</span><a href="#local-6989586621682143378"><span class="hs-identifier hs-var">iZero</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143373"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-419"></span><span>        </span><span id="local-6989586621682143384"><span class="annot"><a href="#local-6989586621682143384"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubstArg Term -&gt; Term -&gt; Term
forall a. Subst a =&gt; Int -&gt; SubstArg a -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Term
</span><a href="#local-6989586621682143380"><span class="hs-identifier hs-var">iOne</span></a></span><span>  </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143373"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143385"><span class="annot"><a href="#local-6989586621682143385"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Abs Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143361"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(Abs Term -&gt; Term) -&gt; Abs Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Term -&gt; Abs Term
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Name -&gt; ArgName
</span><a href="Agda.Syntax.Abstract.Name.html#namedArgName"><span class="hs-identifier hs-var">namedArgName</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Name
</span><a href="#local-6989586621682143360"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143373"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143389"><span class="annot"><a href="#local-6989586621682143389"><span class="hs-identifier hs-var hs-var">btyp</span></a></span></span><span> </span><span id="local-6989586621682143390"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143390"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682143364"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682143367"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Arg Term] -&gt; Term
forall t. Apply t =&gt; t -&gt; [Arg Term] -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall e. e -&gt; Arg e
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143390"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-type">locallyTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eRange"><span class="hs-identifier hs-type">eRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-type">noRange</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#blockTerm"><span class="hs-identifier hs-type">blockTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143356"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-type">setCurrentRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143355"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143389"><span class="hs-identifier hs-type">btyp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143378"><span class="hs-identifier hs-type">iZero</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143382"><span class="hs-identifier hs-type">lhs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143368"><span class="hs-identifier hs-type">lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143389"><span class="hs-identifier hs-type">btyp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143380"><span class="hs-identifier hs-type">iOne</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143384"><span class="hs-identifier hs-type">rhs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143369"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682143385"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-428"></span><span class="annot"><span class="hs-comment">-- * Lambda abstractions</span></span><span>
</span><span id="line-429"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- | Type check a lambda expression.</span><span>
</span><span id="line-432"></span><span class="hs-comment">--   &quot;checkLambda bs e ty&quot;  means  (\ bs -&gt; e) : ty</span><span>
</span><span id="line-433"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLambda"><span class="hs-identifier hs-type">checkLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#TypedBinding"><span class="hs-identifier hs-type">A.TypedBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-434"></span><span id="checkLambda"><span class="annot"><span class="annottext">checkLambda :: Comparison -&gt; TypedBinding -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLambda"><span class="hs-identifier hs-var hs-var">checkLambda</span></a></span></span><span> </span><span id="local-6989586621682143400"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143400"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#TLet"><span class="hs-identifier hs-type">A.TLet</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143401"><span class="annot"><span class="annottext">List1 LetBinding
</span><a href="#local-6989586621682143401"><span class="hs-identifier hs-var">lbs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143402"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143402"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143403"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143403"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>  </span><span class="annot"><span class="annottext">List1 LetBinding -&gt; TCM Term -&gt; TCM Term
forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings"><span class="hs-identifier hs-var">checkLetBindings</span></a></span><span> </span><span class="annot"><span class="annottext">List1 LetBinding
</span><a href="#local-6989586621682143401"><span class="hs-identifier hs-var">lbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143402"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143403"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLambda"><span class="hs-identifier hs-var">checkLambda</span></a></span><span> </span><span id="local-6989586621682143404"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143404"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682143405"><span class="annot"><span class="annottext">b :: TypedBinding
</span><a href="#local-6989586621682143405"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#TBind"><span class="hs-identifier hs-type">A.TBind</span></a></span><span> </span><span id="local-6989586621682143406"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143406"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143407"><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143407"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span id="local-6989586621682143408"><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143408"><span class="hs-identifier hs-var">xps0</span></a></span></span><span> </span><span id="local-6989586621682143409"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143409"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143410"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143410"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143411"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143411"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682143412"><span class="annot"><a href="#local-6989586621682143412"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143413"><span class="annot"><a href="#local-6989586621682143413"><span class="hs-identifier hs-var">tgt0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; Type -&gt; TCM (Telescope, Type)
forall a. HasRange a =&gt; NamedArg a -&gt; Type -&gt; TCM (Telescope, Type)
</span><a href="Agda.TypeChecking.Implicit.html#splitImplicitBinderT"><span class="hs-identifier hs-var">splitImplicitBinderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName)) -&gt; NamedArg (Binder' BindName)
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.head</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143408"><span class="hs-identifier hs-var">xps0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143411"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-comment">-- Andreas, 2020-03-25, issue #4481: since we have named lambdas now,</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-comment">-- we need to insert skipped hidden arguments.</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-comment">-- Amy, 2024-10-17: we can't simply insert the new binders into this</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-comment">-- same TBind, since those are all assumed to be of the same type.</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-comment">-- This matters when we're skipping binders to reach something of a</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-comment">-- different type, e.g. in</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">--    (&#955; {C = C} &#8594; C) : {A B : Set} {C : Nat} &#8594; Nat</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- The previous implementation would add two binders and check them</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-comment">-- with the same type as that of {C}, i.e. something like</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-comment">--    (&#955; {A B C : _} &#8594; C)</span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-comment">-- which fails. The new strategy is to lob domains off the type until</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-comment">-- we reach the right argument, then just add them to the context, and</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-comment">-- bind them after returning.</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#teleLam"><span class="hs-identifier hs-type">teleLam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143412"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143412"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLambda%27"><span class="hs-identifier hs-type">checkLambda'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143404"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143406"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143407"><span class="hs-identifier hs-type">tac</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143408"><span class="hs-identifier hs-type">xps0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143409"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143410"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143413"><span class="hs-identifier hs-type">tgt0</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLambda%27"><span class="hs-identifier hs-type">checkLambda'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-462"></span><span>     </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ @cmp@</span></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>                     </span><span class="annot"><span class="hs-comment">-- ^ Range @r@ of the typed binding</span></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#TypedBindingInfo"><span class="hs-identifier hs-type">A.TypedBindingInfo</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ @tac@ tactic/finiteness attribute of the typed binding</span></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Binder"><span class="hs-identifier hs-type">Binder</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @xps@ variables/patterns of the typed binding</span></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Type"><span class="hs-identifier hs-type">A.Type</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ @typ@ Type of the typed binding (underscore for untyped lambda).</span></span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ @body@</span></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ @target@</span></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-470"></span><span id="checkLambda%27"><span class="annot"><span class="annottext">checkLambda' :: Comparison
-&gt; Range
-&gt; TypedBindingInfo
-&gt; List1 (NamedArg (Binder' BindName))
-&gt; Expr
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLambda%27"><span class="hs-identifier hs-var hs-var">checkLambda'</span></a></span></span><span> </span><span id="local-6989586621682143418"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143418"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682143419"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143419"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143420"><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143420"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span id="local-6989586621682143421"><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span></span><span> </span><span id="local-6989586621682143422"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143422"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621682143423"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143423"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143424"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143424"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checkLambda xs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName)) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;possiblePath   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Bool -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682143425"><span class="hs-identifier hs-var">possiblePath</span></a></span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;numbinds       =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Int -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682143426"><span class="hs-identifier hs-var">numbinds</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;typ            =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-var">unScope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143422"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;target         =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143424"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;tactic         =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TacticAttribute -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedBindingInfo -&gt; TacticAttribute
</span><a href="Agda.Syntax.Abstract.html#tbTacticAttr"><span class="hs-identifier hs-var">tbTacticAttr</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143420"><span class="hs-identifier hs-var">tac</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;info           =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (ArgInfo -&gt; ArgName) -&gt; ArgInfo -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143427"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-comment">-- Consume @tac@:</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143420"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143420"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#TypedBindingInfo"><span class="hs-identifier hs-type">A.TypedBindingInfo</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tbTacticAttr :: TypedBindingInfo -&gt; TacticAttribute
</span><a href="Agda.Syntax.Abstract.html#tbTacticAttr"><span class="hs-identifier hs-var">tbTacticAttr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#TacticAttribute"><span class="hs-identifier hs-type">TacticAttribute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682143430"><span class="annot"><span class="annottext">Ranged Expr
</span><a href="#local-6989586621682143430"><span class="hs-identifier hs-var">tactic</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-487"></span><span>      </span><span class="hs-comment">-- Andreas, 2024-02-22, issue #6783</span><span>
</span><span id="line-488"></span><span>      </span><span class="hs-comment">-- Error out if user supplied a tactic (rather than dropping it silently).</span><span>
</span><span id="line-489"></span><span>      </span><span id="local-6989586621682143431"><span class="annot"><a href="#local-6989586621682143431"><span class="hs-identifier hs-var">_tactic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LamOrPi -&gt; Ranged Expr -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkTacticAttribute"><span class="hs-identifier hs-var">checkTacticAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">LamOrPi
</span><a href="Agda.TypeChecking.Rules.Term.html#LamNotPi"><span class="hs-identifier hs-var">LamNotPi</span></a></span><span> </span><span class="annot"><span class="annottext">Ranged Expr
</span><a href="#local-6989586621682143430"><span class="hs-identifier hs-var">tactic</span></a></span><span>
</span><span id="line-490"></span><span>      </span><span class="hs-comment">-- We should not survive this check...</span><span>
</span><span id="line-491"></span><span>      </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682143433"><span class="annot"><a href="#local-6989586621682143433"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682143434"><span class="annot"><a href="#local-6989586621682143434"><span class="hs-identifier hs-var">btyp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Int -&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewUpTo"><span class="hs-identifier hs-var">telViewUpTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682143426"><span class="hs-identifier hs-var">numbinds</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143424"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;tel            =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143433"><span class="hs-identifier hs-type">tel</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;btyp           =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143434"><span class="hs-identifier hs-type">btyp</span></a></span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682143426"><span class="hs-identifier hs-type">numbinds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143433"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682143437"><span class="hs-identifier hs-type">useTargetType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143433"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143434"><span class="hs-identifier hs-type">btyp</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682143425"><span class="hs-identifier hs-type">possiblePath</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682143438"><span class="hs-identifier hs-type">trySeeingIfPath</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682143439"><span class="hs-identifier hs-type">dontUseTargetType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143433"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#and2M"><span class="hs-operator hs-type">`and2M`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">isJust</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#isBlocked"><span class="hs-identifier hs-type">isBlocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143434"><span class="hs-identifier hs-type">btyp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-comment">-- If either @tel@ is not @null@ or @btyp@ is not blocked, then @target@ is not blocked,</span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-comment">-- so we have nothing to block on, and cannot permit @dontUseTargetType@ to postpone.</span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-comment">-- This happens e.g. in ill-typed cases like @(\ x -&gt; x) : Nat@.</span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-506"></span><span>    </span><span id="local-6989586621682143442"><span class="annot"><span class="annottext">b :: TypedBinding
</span><a href="#local-6989586621682143442"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
-&gt; TypedBindingInfo
-&gt; List1 (NamedArg (Binder' BindName))
-&gt; Expr
-&gt; TypedBinding
</span><a href="Agda.Syntax.Abstract.html#TBind"><span class="hs-identifier hs-var">A.TBind</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143419"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBindingInfo
</span><a href="#local-6989586621682143420"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143422"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-507"></span><span>    </span><span class="annot"><a href="#local-6989586621682143443"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621682143443"><span class="annot"><span class="annottext">xs :: List1 (NamedArg Name)
</span><a href="#local-6989586621682143443"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Binder' BindName) -&gt; NamedArg Name)
-&gt; List1 (NamedArg (Binder' BindName)) -&gt; List1 (NamedArg Name)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Binder' BindName -&gt; Name)
-&gt; NamedArg (Binder' BindName) -&gt; NamedArg Name
forall a b. (a -&gt; b) -&gt; NamedArg a -&gt; NamedArg b
</span><a href="Agda.Syntax.Common.html#updateNamedArg"><span class="hs-identifier hs-var">updateNamedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Name)
-&gt; (Binder' BindName -&gt; BindName) -&gt; Binder' BindName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Binder' BindName -&gt; BindName
forall a. Binder' a -&gt; a
</span><a href="Agda.Syntax.Abstract.html#binderName"><span class="hs-identifier hs-var">A.binderName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621682143426"><span class="annot"><span class="annottext">numbinds :: Int
</span><a href="#local-6989586621682143426"><span class="hs-identifier hs-var hs-var">numbinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName)) -&gt; Int
forall a. NonEmpty a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621682143425"><span class="annot"><span class="annottext">possiblePath :: Bool
</span><a href="#local-6989586621682143425"><span class="hs-identifier hs-var hs-var">possiblePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682143426"><span class="hs-identifier hs-var">numbinds</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Bool
forall a. Underscore a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isUnderscore"><span class="hs-identifier hs-var">isUnderscore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-var">unScope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143422"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isRelevant"><span class="hs-identifier hs-var">isRelevant</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143427"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143427"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span id="local-6989586621682143427"><span class="annot"><span class="annottext">info :: ArgInfo
</span><a href="#local-6989586621682143427"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg Name -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(NamedArg Name -&gt; ArgInfo) -&gt; NamedArg Name -&gt; ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name) -&gt; NamedArg Name
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.head</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143443"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621682143438"><span class="annot"><span class="annottext">trySeeingIfPath :: TCM Term
</span><a href="#local-6989586621682143438"><span class="hs-identifier hs-var hs-var">trySeeingIfPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-515"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM ()) -&gt; ArgName -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;trySeeingIfPath for &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName)) -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143448"><span class="annot"><span class="annottext">postpone' :: Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143448"><span class="hs-identifier hs-var hs-var">postpone'</span></a></span></span><span> </span><span id="local-6989586621682143449"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143449"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621682143450"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143450"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-517"></span><span>            </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Cubical -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Cubical -&gt; Bool) -&gt; TCMT IO (Maybe Cubical) -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Cubical)
forall (m :: * -&gt; *). HasOptions m =&gt; m (Maybe Cubical)
</span><a href="Agda.TypeChecking.Monad.Base.html#cubicalOption"><span class="hs-identifier hs-var">cubicalOption</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; TCM Term
</span><a href="#local-6989586621682143439"><span class="hs-identifier hs-var">dontUseTargetType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143453"><span class="hs-identifier hs-var">postpone</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143449"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143450"><span class="hs-identifier hs-var">tgt</span></a></span><span>
</span><span id="line-518"></span><span>      </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term)
-&gt; TCM Term
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143424"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143448"><span class="hs-identifier hs-var">postpone'</span></a></span><span> </span><span class="annot"><span class="annottext">((NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143455"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143455"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifNotM"><span class="hs-identifier hs-var">ifNotM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathView -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#isPathType"><span class="hs-identifier hs-var">isPathType</span></a></span><span> </span><span class="annot"><span class="annottext">(PathView -&gt; Bool) -&gt; TCMT IO PathView -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO PathView
forall (m :: * -&gt; *). HasBuiltins m =&gt; Type -&gt; m PathView
</span><a href="Agda.TypeChecking.Monad.Builtin.html#pathView"><span class="hs-identifier hs-var">pathView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143455"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; TCM Term
</span><a href="#local-6989586621682143439"><span class="hs-identifier hs-var">dontUseTargetType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>          </span><span class="hs-comment">-- Note that --cubical is on here since we returned from 'pathView'.</span><span>
</span><span id="line-521"></span><span>          </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; Expr -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPath"><span class="hs-identifier hs-var">checkPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName)) -&gt; NamedArg (Binder' BindName)
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.head</span></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Binder' BindName))
</span><a href="#local-6989586621682143421"><span class="hs-identifier hs-var">xps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143422"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143423"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143455"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>    </span><span id="local-6989586621682143458"><span class="annot"><span class="annottext">postpone_ :: TCM Term
</span><a href="#local-6989586621682143458"><span class="hs-identifier hs-var hs-var">postpone_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem_"><span class="hs-identifier hs-var">postponeTypeCheckingProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-524"></span><span>      </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143418"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprInfo -&gt; LamBinding -&gt; Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-var">A.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="Agda.Syntax.Info.html#exprNoRange"><span class="hs-identifier hs-var">A.exprNoRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedBinding -&gt; LamBinding
</span><a href="Agda.Syntax.Abstract.html#DomainFull"><span class="hs-identifier hs-var">A.DomainFull</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682143442"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143423"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143424"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>    </span><span id="local-6989586621682143453"><span class="annot"><span class="annottext">postpone :: Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143453"><span class="hs-identifier hs-var hs-var">postpone</span></a></span></span><span> </span><span id="local-6989586621682143464"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143464"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621682143465"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143465"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; Blocker -&gt; TCM Term)
-&gt; Blocker -&gt; TypeCheckingProblem -&gt; TCM Term
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; Blocker -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem"><span class="hs-identifier hs-var">postponeTypeCheckingProblem</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143464"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-527"></span><span>      </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143418"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprInfo -&gt; LamBinding -&gt; Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-var">A.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="Agda.Syntax.Info.html#exprNoRange"><span class="hs-identifier hs-var">A.exprNoRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedBinding -&gt; LamBinding
</span><a href="Agda.Syntax.Abstract.html#DomainFull"><span class="hs-identifier hs-var">A.DomainFull</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682143442"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143423"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143465"><span class="hs-identifier hs-var">tgt</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-comment">-- Andreas, 2025-08-08.</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-comment">-- In case the target type does not resolve to a Pi,</span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-comment">-- we construct a Pi-type from the yet unchecked type @typ@ of the domain(s)</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-comment">-- (which is underscore for an untyped lambda).</span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-comment">-- This strategy is hazardous in various situations:</span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-comment">-- - We might be missing implicit lambdas that should precede the given lambda.</span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-comment">-- - If no modality is given at the lambda, we might commit to the default one</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">--   which then might turn out to be the wrong one as more information surfaces.</span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-comment">--   Unfortunately, we do not have modality metas otherwise we could postpone</span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-comment">--   the decision.</span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-comment">-- To fix #7001, we could check whether the user has supplied the relevant modalities</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-comment">-- (depending on which language flags are on), and refuse to progress if they are missing.</span><span>
</span><span id="line-544"></span><span>    </span><span id="local-6989586621682143439"><span class="annot"><span class="annottext">dontUseTargetType :: Bool -&gt; TCM Term
</span><a href="#local-6989586621682143439"><span class="hs-identifier hs-var hs-var">dontUseTargetType</span></a></span></span><span> </span><span id="local-6989586621682143468"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682143468"><span class="hs-identifier hs-var">mayPostpone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682143468"><span class="hs-identifier hs-var">mayPostpone</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#and2M"><span class="hs-operator hs-var">`and2M`</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name) -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#userOmittedModalities"><span class="hs-identifier hs-var">userOmittedModalities</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143443"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682143458"><span class="hs-identifier hs-var">postpone_</span></a></span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>      </span><span class="hs-comment">-- Checking &#955; (xs : argsT) &#8594; body : target</span><span>
</span><span id="line-546"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM ()
forall (m :: * -&gt; *). MonadStatistics m =&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Statistics.html#tick"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;lambda-no-target-type&quot;</span></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-comment">-- First check that argsT is a valid type or create a meta for it.</span><span>
</span><span id="line-549"></span><span>      </span><span id="local-6989586621682143472"><span class="annot"><a href="#local-6989586621682143472"><span class="hs-identifier hs-var">argsT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143422"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-comment">-- Andreas, 2025-08-08, issue #7001:</span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-comment">-- If the user has not written explicitly a modality for the lambda-bound variable,</span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-comment">-- the default modality is used which might not be correct.</span><span>
</span><span id="line-553"></span><span>      </span><span class="hs-comment">-- As a consequence, the speculated function type created by @telePi tel@ below</span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-comment">-- may have the wrong modality.</span><span>
</span><span id="line-555"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143473"><span class="annot"><a href="#local-6989586621682143473"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name) -&gt; Type -&gt; Telescope
</span><a href="Agda.TypeChecking.Substitute.html#namedBindsToTel1"><span class="hs-identifier hs-var">namedBindsToTel1</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143443"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143472"><span class="hs-identifier hs-var">argsT</span></a></span><span>
</span><span id="line-556"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;dontUseTargetType tel =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143473"><span class="hs-identifier hs-type">tel</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>      </span><span class="hs-comment">-- Andreas, 2015-05-28 Issue 1523</span><span>
</span><span id="line-559"></span><span>      </span><span class="hs-comment">-- If argsT is a SizeLt, it must be non-empty to avoid non-termination.</span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-comment">-- TODO: do we need to block checkExpr?</span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.html#checkSizeLtSat"><span class="hs-identifier hs-type">checkSizeLtSat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143472"><span class="hs-identifier hs-type">argsT</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>      </span><span class="hs-comment">-- Jesper 2019-12-17, #4261: we need to postpone here if</span><span>
</span><span id="line-564"></span><span>      </span><span class="hs-comment">-- checking of the record pattern fails; if we try to catch</span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-comment">-- higher up the metas created during checking of @argsT@ are</span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-comment">-- not available.</span><span>
</span><span id="line-567"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143476"><span class="annot"><a href="#local-6989586621682143476"><span class="hs-identifier hs-var hs-var">postponeOnBlockedPattern</span></a></span></span><span> </span><span id="local-6989586621682143477"><span class="annot"><span class="annottext">TCM (Type, Term)
</span><a href="#local-6989586621682143477"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM (Type, Term)
</span><a href="#local-6989586621682143477"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Type, Term)
-&gt; ((TCErr, Blocker) -&gt; TCM (Type, Term)) -&gt; TCM (Type, Term)
forall a. TCM a -&gt; ((TCErr, Blocker) -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#catchIlltypedPatternBlockedOnMeta"><span class="hs-operator hs-var">`catchIlltypedPatternBlockedOnMeta`</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682143479"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682143479"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143480"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143480"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-569"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking record pattern stuck on meta: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143480"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-570"></span><span>            </span><span id="local-6989586621682143481"><span class="annot"><a href="#local-6989586621682143481"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(List1 (NamedArg Name), Type) -&gt; TCM Type -&gt; TCM Type
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
(List1 (NamedArg Name), Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143443"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143472"><span class="hs-identifier hs-var">argsT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Type
</span><a href="Agda.TypeChecking.MetaVars.html#newTypeMeta_"><span class="hs-identifier hs-var">newTypeMeta_</span></a></span><span>
</span><span id="line-571"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143483"><span class="annot"><a href="#local-6989586621682143483"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExprInfo -&gt; LamBinding -&gt; Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-var">A.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="Agda.Syntax.Info.html#exprNoRange"><span class="hs-identifier hs-var">A.exprNoRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedBinding -&gt; LamBinding
</span><a href="Agda.Syntax.Abstract.html#DomainFull"><span class="hs-identifier hs-var">A.DomainFull</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682143442"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143423"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-572"></span><span>                </span><span id="local-6989586621682143484"><span class="annot"><a href="#local-6989586621682143484"><span class="hs-identifier hs-var hs-var">tgt'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#telePi"><span class="hs-identifier hs-var">telePi</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143473"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143481"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-573"></span><span>            </span><span id="local-6989586621682143485"><span class="annot"><a href="#local-6989586621682143485"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem"><span class="hs-identifier hs-type">postponeTypeCheckingProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-type">CheckExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143418"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143483"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143484"><span class="hs-identifier hs-type">tgt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143480"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-574"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143484"><span class="hs-identifier hs-type">tgt'</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682143485"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-comment">-- Now check body : ?t&#8321;</span><span>
</span><span id="line-577"></span><span>      </span><span class="hs-comment">-- DONT USE tel for addContext, as it loses NameIds.</span><span>
</span><span id="line-578"></span><span>      </span><span class="hs-comment">-- WRONG: v &lt;- addContext tel $ checkExpr body t1</span><span>
</span><span id="line-579"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682143486"><span class="annot"><a href="#local-6989586621682143486"><span class="hs-identifier hs-var">target0</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143487"><span class="annot"><a href="#local-6989586621682143487"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682143476"><span class="hs-identifier hs-type">postponeOnBlockedPattern</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-580"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143443"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682143472"><span class="hs-identifier hs-type">argsT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#addTypedPatterns"><span class="hs-identifier hs-type">addTypedPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143421"><span class="hs-identifier hs-type">xps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>           </span><span id="local-6989586621682143488"><span class="annot"><a href="#local-6989586621682143488"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-type">workOnTypes</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#newTypeMeta_"><span class="hs-identifier hs-type">newTypeMeta_</span></a></span><span>
</span><span id="line-582"></span><span>           </span><span id="local-6989586621682143489"><span class="annot"><a href="#local-6989586621682143489"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-type">checkExpr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143418"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143423"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143488"><span class="hs-identifier hs-type">t1</span></a></span><span>
</span><span id="line-583"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#telePi"><span class="hs-identifier hs-type">telePi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143473"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143488"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#teleLam"><span class="hs-identifier hs-type">teleLam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143473"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143489"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-comment">-- Do not coerce hidden lambdas</span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-type">notVisible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143427"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-type">notVisible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143443"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>        </span><span id="local-6989586621682143492"><span class="annot"><a href="#local-6989586621682143492"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#newProblem_"><span class="hs-identifier hs-type">newProblem_</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#leqType"><span class="hs-identifier hs-type">leqType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143486"><span class="hs-identifier hs-type">target0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143424"><span class="hs-identifier hs-type">target</span></a></span><span>
</span><span id="line-588"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#blockTermOnProblem"><span class="hs-identifier hs-type">blockTermOnProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143424"><span class="hs-identifier hs-type">target</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143487"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143492"><span class="hs-identifier hs-type">pid</span></a></span><span>
</span><span id="line-589"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143418"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143487"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143486"><span class="hs-identifier hs-type">target0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143424"><span class="hs-identifier hs-type">target</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621682143437"><span class="annot"><span class="annottext">useTargetType :: Telescope -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143437"><span class="hs-identifier hs-var hs-var">useTargetType</span></a></span></span><span> </span><span id="local-6989586621682143496"><span class="annot"><span class="annottext">tel :: Telescope
</span><a href="#local-6989586621682143496"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682143497"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143497"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span id="local-6989586621682143498"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682143498"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143499"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143499"><span class="hs-identifier hs-var">btyp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-594"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM ()
forall (m :: * -&gt; *). MonadStatistics m =&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Statistics.html#tick"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;lambda-with-target-type&quot;</span></span><span>
</span><span id="line-595"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.lambda&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM ()) -&gt; ArgName -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;useTargetType y  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682143498"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143500"><span class="annot"><span class="annottext">NamedArg Name
</span><a href="#local-6989586621682143500"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143443"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; ArgInfo -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143497"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143427"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongHidingInLambda"><span class="hs-identifier hs-var">WrongHidingInLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143424"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-599"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (WithOrigin (Ranged ArgName)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (WithOrigin (Ranged ArgName)) -&gt; Bool)
-&gt; Maybe (WithOrigin (Ranged ArgName)) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Name -&gt; Maybe (NameOf (NamedArg Name))
forall a. LensNamed a =&gt; a -&gt; Maybe (NameOf a)
</span><a href="Agda.Syntax.Common.html#getNameOf"><span class="hs-identifier hs-var">getNameOf</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Name
</span><a href="#local-6989586621682143500"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-600"></span><span>          </span><span class="hs-comment">-- Andreas, 2020-03-25, issue #4481: check for correct name</span><span>
</span><span id="line-601"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; NamedArg Name -&gt; Bool
forall a b.
(LensNamed a, LensNamed b, NameOf a ~ WithOrigin (Ranged ArgName),
 NameOf b ~ WithOrigin (Ranged ArgName)) =&gt;
a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#namedSame"><span class="hs-identifier hs-var">namedSame</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143497"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Name
</span><a href="#local-6989586621682143500"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-602"></span><span>            </span><span class="annot"><span class="annottext">NamedArg Name -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Name
</span><a href="#local-6989586621682143500"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongHidingInLHS"><span class="hs-identifier hs-var">WrongHidingInLHS</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-comment">-- Andreas, 2011-10-01 ignore relevance in lambda if not explicitly given</span><span>
</span><span id="line-604"></span><span>        </span><span id="local-6989586621682143506"><span class="annot"><a href="#local-6989586621682143506"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom.
(LensAnnotation dom, LensModality dom) =&gt;
dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaModalityCheck"><span class="hs-identifier hs-var">lambdaModalityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143497"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143427"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-comment">-- Andreas, 2015-05-28 Issue 1523</span><span>
</span><span id="line-606"></span><span>        </span><span class="hs-comment">-- Ensure we are not stepping under a possibly non-existing size.</span><span>
</span><span id="line-607"></span><span>        </span><span class="hs-comment">-- TODO: do we need to block checkExpr?</span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143508"><span class="annot"><a href="#local-6989586621682143508"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143497"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.html#checkSizeLtSat"><span class="hs-identifier hs-type">checkSizeLtSat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143508"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-comment">-- We only need to block the final term on the argument type</span><span>
</span><span id="line-611"></span><span>        </span><span class="hs-comment">-- comparison. The body will be blocked if necessary. We still want to</span><span>
</span><span id="line-612"></span><span>        </span><span class="hs-comment">-- compare the argument types first, so we spawn a new problem for that</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-comment">-- check.</span><span>
</span><span id="line-614"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682143510"><span class="annot"><a href="#local-6989586621682143510"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143511"><span class="annot"><a href="#local-6989586621682143511"><span class="hs-identifier hs-var">argT</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-identifier hs-type">newProblem</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isTypeEqualTo"><span class="hs-identifier hs-type">isTypeEqualTo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143422"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143508"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-comment">-- Andreas, Issue 630: take name from function type if lambda name is &quot;_&quot;</span><span>
</span><span id="line-616"></span><span>        </span><span id="local-6989586621682143513"><span class="annot"><a href="#local-6989586621682143513"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaAddContext"><span class="hs-identifier hs-type">lambdaAddContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143500"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143498"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#defaultArgDom"><span class="hs-identifier hs-type">defaultArgDom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143506"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143511"><span class="hs-identifier hs-type">argT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-617"></span><span>               </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#addTypedPatterns"><span class="hs-identifier hs-type">addTypedPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143421"><span class="hs-identifier hs-type">xps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-type">checkExpr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143418"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143423"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143499"><span class="hs-identifier hs-type">btyp</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#blockTermOnProblem"><span class="hs-identifier hs-type">blockTermOnProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143424"><span class="hs-identifier hs-type">target</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143506"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#namedArgName"><span class="hs-identifier hs-type">namedArgName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143500"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143513"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143510"><span class="hs-identifier hs-type">pid</span></a></span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="#local-6989586621682143437"><span class="hs-identifier hs-var">useTargetType</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#userOmittedModalities"><span class="hs-identifier hs-type">userOmittedModalities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-623"></span><span id="userOmittedModalities"><span class="annot"><span class="annottext">userOmittedModalities :: List1 (NamedArg Name) -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#userOmittedModalities"><span class="hs-identifier hs-var hs-var">userOmittedModalities</span></a></span></span><span> </span><span id="local-6989586621682143516"><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143516"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optErasure"><span class="hs-identifier hs-var">optErasure</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#and2M"><span class="hs-operator hs-var">`and2M`</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg Name -&gt; Bool) -&gt; List1 (NamedArg Name) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity -&gt; Bool)
-&gt; (NamedArg Name -&gt; Quantity) -&gt; NamedArg Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Name -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg Name)
</span><a href="#local-6989586621682143516"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span class="hs-comment">-- TODO: extend to modalities beyond erasure.</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- userOmittedModalities :: List1 (NamedArg Name) -&gt; TCM Bool</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- userOmittedModalities xs = do</span><span>
</span><span id="line-628"></span><span class="hs-comment">--   erasure  &lt;- optErasure &lt;$&gt; pragmaOptions</span><span>
</span><span id="line-629"></span><span class="hs-comment">--   -- polarity &lt;- optPolarity &lt;$&gt; pragmaOptions</span><span>
</span><span id="line-630"></span><span class="hs-comment">--   return $ flip any xs \ x -&gt; or</span><span>
</span><span id="line-631"></span><span class="hs-comment">--     [ erasure  &amp;&amp; null (getQuantity x)</span><span>
</span><span id="line-632"></span><span class="hs-comment">--     -- TODO: ModalPolarity does not have a concept of default yet.</span><span>
</span><span id="line-633"></span><span class="hs-comment">--     -- , polarity &amp;&amp; null (getPolarityMod x)</span><span>
</span><span id="line-634"></span><span class="hs-comment">--     -- TODO: a means for the user to tell they are serious about irrelevance,</span><span>
</span><span id="line-635"></span><span class="hs-comment">--     -- e.g. flag --irrelevance.</span><span>
</span><span id="line-636"></span><span class="hs-comment">--     -- Otherwise too many regressions.</span><span>
</span><span id="line-637"></span><span class="hs-comment">--     -- , null $ getRelevance x</span><span>
</span><span id="line-638"></span><span class="hs-comment">--     -- TODO: Cohesion and Annotation do not have a concept of default yet.</span><span>
</span><span id="line-639"></span><span class="hs-comment">--     ]</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="hs-comment">-- | Check that modality info in lambda is compatible with modality</span><span>
</span><span id="line-642"></span><span class="hs-comment">--   coming from the function type.</span><span>
</span><span id="line-643"></span><span class="hs-comment">--   If lambda has no user-given modality, copy that of function type.</span><span>
</span><span id="line-644"></span><span id="local-6989586621682140762"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaModalityCheck"><span class="hs-identifier hs-type">lambdaModalityCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#LensAnnotation"><span class="hs-identifier hs-type">LensAnnotation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140762"><span class="hs-identifier hs-type">dom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensModality"><span class="hs-identifier hs-type">LensModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140762"><span class="hs-identifier hs-type">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140762"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span></span><span>
</span><span id="line-645"></span><span id="lambdaModalityCheck"><span class="annot"><span class="annottext">lambdaModalityCheck :: forall dom.
(LensAnnotation dom, LensModality dom) =&gt;
dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaModalityCheck"><span class="hs-identifier hs-var hs-var">lambdaModalityCheck</span></a></span></span><span> </span><span id="local-6989586621682143534"><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143534"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom. LensAnnotation dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaAnnotationCheck"><span class="hs-identifier hs-var">lambdaAnnotationCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dom -&gt; Annotation
forall a. LensAnnotation a =&gt; a -&gt; Annotation
</span><a href="Agda.Syntax.Common.html#getAnnotation"><span class="hs-identifier hs-var">getAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143534"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo)
-&gt; (ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom. LensModalPolarity dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaPolarityCheck"><span class="hs-identifier hs-var">lambdaPolarityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682143539"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo)
-&gt; (ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom. LensCohesion dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaCohesionCheck"><span class="hs-identifier hs-var">lambdaCohesionCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682143539"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo)
-&gt; (ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom. LensQuantity dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaQuantityCheck"><span class="hs-identifier hs-var">lambdaQuantityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682143539"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo)
-&gt; (ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom. LensRelevance dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaIrrelevanceCheck"><span class="hs-identifier hs-var">lambdaIrrelevanceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682143539"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682143539"><span class="annot"><span class="annottext">m :: Modality
</span><a href="#local-6989586621682143539"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dom -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143534"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span class="hs-comment">-- | Check that irrelevance info in lambda is compatible with irrelevance</span><span>
</span><span id="line-649"></span><span class="hs-comment">--   coming from the function type.</span><span>
</span><span id="line-650"></span><span class="hs-comment">--   If lambda has no user-given relevance, copy that of function type.</span><span>
</span><span id="line-651"></span><span id="local-6989586621682140781"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaIrrelevanceCheck"><span class="hs-identifier hs-type">lambdaIrrelevanceCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensRelevance"><span class="hs-identifier hs-type">LensRelevance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140781"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140781"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span></span><span>
</span><span id="line-652"></span><span id="lambdaIrrelevanceCheck"><span class="annot"><span class="annottext">lambdaIrrelevanceCheck :: forall dom. LensRelevance dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaIrrelevanceCheck"><span class="hs-identifier hs-var hs-var">lambdaIrrelevanceCheck</span></a></span></span><span> </span><span id="local-6989586621682143559"><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143559"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143560"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143560"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-653"></span><span>    </span><span class="hs-comment">-- Case: no specific user annotation: use relevance of function type</span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143560"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; Relevance -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="Agda.Syntax.Common.html#defaultRelevance"><span class="hs-identifier hs-var">defaultRelevance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; ArgInfo -&gt; ArgInfo
forall a. LensRelevance a =&gt; Relevance -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setRelevance"><span class="hs-identifier hs-var">setRelevance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dom -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143559"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143560"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-comment">-- Case: explicit user annotation is taken seriously</span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143564"><span class="annot"><span class="annottext">rPi :: Relevance
</span><a href="#local-6989586621682143564"><span class="hs-identifier hs-var hs-var hs-var">rPi</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dom -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143559"><span class="hs-identifier hs-var">dom</span></a></span><span>  </span><span class="hs-comment">-- relevance of function type</span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143565"><span class="annot"><span class="annottext">rLam :: Relevance
</span><a href="#local-6989586621682143565"><span class="hs-identifier hs-var hs-var hs-var">rLam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143560"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-comment">-- relevance of lambda</span><span>
</span><span id="line-659"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relevance -&gt; Relevance -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameRelevance"><span class="hs-identifier hs-var">sameRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="#local-6989586621682143564"><span class="hs-identifier hs-var">rPi</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="#local-6989586621682143565"><span class="hs-identifier hs-var">rLam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-660"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongIrrelevanceInLambda"><span class="hs-identifier hs-var">WrongIrrelevanceInLambda</span></a></span><span>
</span><span id="line-661"></span><span>      </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143560"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-comment">-- | Check that quantity info in lambda is compatible with quantity</span><span>
</span><span id="line-664"></span><span class="hs-comment">--   coming from the function type.</span><span>
</span><span id="line-665"></span><span class="hs-comment">--   If lambda has no user-given quantity, copy that of function type.</span><span>
</span><span id="line-666"></span><span id="local-6989586621682140780"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaQuantityCheck"><span class="hs-identifier hs-type">lambdaQuantityCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensQuantity"><span class="hs-identifier hs-type">LensQuantity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140780"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140780"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span></span><span>
</span><span id="line-667"></span><span id="lambdaQuantityCheck"><span class="annot"><span class="annottext">lambdaQuantityCheck :: forall dom. LensQuantity dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaQuantityCheck"><span class="hs-identifier hs-var hs-var">lambdaQuantityCheck</span></a></span></span><span> </span><span id="local-6989586621682143583"><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143583"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143584"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143584"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-668"></span><span>    </span><span class="hs-comment">-- Case: no specific user annotation: use quantity of function type</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensQuantity a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#noUserQuantity"><span class="hs-identifier hs-var">noUserQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143584"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; ArgInfo -&gt; ArgInfo
forall a. LensQuantity a =&gt; Quantity -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setQuantity"><span class="hs-identifier hs-var">setQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dom -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143583"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143584"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="hs-comment">-- Case: explicit user annotation is taken seriously</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143587"><span class="annot"><span class="annottext">qPi :: Quantity
</span><a href="#local-6989586621682143587"><span class="hs-identifier hs-var hs-var hs-var">qPi</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dom -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143583"><span class="hs-identifier hs-var">dom</span></a></span><span>  </span><span class="hs-comment">-- quantity of function type</span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143588"><span class="annot"><span class="annottext">qLam :: Quantity
</span><a href="#local-6989586621682143588"><span class="hs-identifier hs-var hs-var hs-var">qLam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143584"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-comment">-- quantity of lambda</span><span>
</span><span id="line-674"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682143587"><span class="hs-identifier hs-var">qPi</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameQuantity"><span class="hs-operator hs-var">`sameQuantity`</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682143588"><span class="hs-identifier hs-var">qLam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongQuantityInLambda"><span class="hs-identifier hs-var">WrongQuantityInLambda</span></a></span><span>
</span><span id="line-676"></span><span>      </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143584"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span id="local-6989586621682140772"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaAnnotationCheck"><span class="hs-identifier hs-type">lambdaAnnotationCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensAnnotation"><span class="hs-identifier hs-type">LensAnnotation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140772"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140772"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span></span><span>
</span><span id="line-679"></span><span id="lambdaAnnotationCheck"><span class="annot"><span class="annottext">lambdaAnnotationCheck :: forall dom. LensAnnotation dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaAnnotationCheck"><span class="hs-identifier hs-var hs-var">lambdaAnnotationCheck</span></a></span></span><span> </span><span id="local-6989586621682143609"><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143609"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143610"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143610"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-comment">-- Case: no specific user annotation: use annotation of function type</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Annotation
forall a. LensAnnotation a =&gt; a -&gt; Annotation
</span><a href="Agda.Syntax.Common.html#getAnnotation"><span class="hs-identifier hs-var">getAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143610"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; Annotation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Annotation
</span><a href="Agda.Syntax.Common.html#defaultAnnotation"><span class="hs-identifier hs-var">defaultAnnotation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; ArgInfo -&gt; ArgInfo
forall a. LensAnnotation a =&gt; Annotation -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setAnnotation"><span class="hs-identifier hs-var">setAnnotation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dom -&gt; Annotation
forall a. LensAnnotation a =&gt; a -&gt; Annotation
</span><a href="Agda.Syntax.Common.html#getAnnotation"><span class="hs-identifier hs-var">getAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143609"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143610"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-682"></span><span>    </span><span class="hs-comment">-- Case: explicit user annotation is taken seriously</span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143613"><span class="annot"><span class="annottext">aPi :: Annotation
</span><a href="#local-6989586621682143613"><span class="hs-identifier hs-var hs-var hs-var">aPi</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dom -&gt; Annotation
forall a. LensAnnotation a =&gt; a -&gt; Annotation
</span><a href="Agda.Syntax.Common.html#getAnnotation"><span class="hs-identifier hs-var">getAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143609"><span class="hs-identifier hs-var">dom</span></a></span><span>  </span><span class="hs-comment">-- annotation of function type</span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143614"><span class="annot"><span class="annottext">aLam :: Annotation
</span><a href="#local-6989586621682143614"><span class="hs-identifier hs-var hs-var hs-var">aLam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Annotation
forall a. LensAnnotation a =&gt; a -&gt; Annotation
</span><a href="Agda.Syntax.Common.html#getAnnotation"><span class="hs-identifier hs-var">getAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143610"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-comment">-- annotation of lambda</span><span>
</span><span id="line-686"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Annotation
</span><a href="#local-6989586621682143613"><span class="hs-identifier hs-var">aPi</span></a></span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; Annotation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Annotation
</span><a href="#local-6989586621682143614"><span class="hs-identifier hs-var">aLam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-687"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongAnnotationInLambda"><span class="hs-identifier hs-var">WrongAnnotationInLambda</span></a></span><span>
</span><span id="line-688"></span><span>      </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143610"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="hs-comment">-- | Check that cohesion info in lambda is compatible with cohesion</span><span>
</span><span id="line-691"></span><span class="hs-comment">--   coming from the function type.</span><span>
</span><span id="line-692"></span><span class="hs-comment">--   If lambda has no user-given cohesion, copy that of function type.</span><span>
</span><span id="line-693"></span><span id="local-6989586621682140779"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaCohesionCheck"><span class="hs-identifier hs-type">lambdaCohesionCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensCohesion"><span class="hs-identifier hs-type">LensCohesion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140779"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140779"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span></span><span>
</span><span id="line-694"></span><span id="lambdaCohesionCheck"><span class="annot"><span class="annottext">lambdaCohesionCheck :: forall dom. LensCohesion dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaCohesionCheck"><span class="hs-identifier hs-var hs-var">lambdaCohesionCheck</span></a></span></span><span> </span><span id="local-6989586621682143632"><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143632"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143633"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143633"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-695"></span><span>    </span><span class="hs-comment">-- Case: no specific user annotation: use cohesion of function type</span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143633"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Cohesion -&gt; Cohesion -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Cohesion
</span><a href="Agda.Syntax.Common.html#defaultCohesion"><span class="hs-identifier hs-var">defaultCohesion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cohesion -&gt; ArgInfo -&gt; ArgInfo
forall a. LensCohesion a =&gt; Cohesion -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setCohesion"><span class="hs-identifier hs-var">setCohesion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dom -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143632"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143633"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-697"></span><span>    </span><span class="hs-comment">-- Case: explicit user annotation is taken seriously</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143636"><span class="annot"><span class="annottext">cPi :: Cohesion
</span><a href="#local-6989586621682143636"><span class="hs-identifier hs-var hs-var hs-var">cPi</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dom -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143632"><span class="hs-identifier hs-var">dom</span></a></span><span>  </span><span class="hs-comment">-- cohesion of function type</span><span>
</span><span id="line-700"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143637"><span class="annot"><span class="annottext">cLam :: Cohesion
</span><a href="#local-6989586621682143637"><span class="hs-identifier hs-var hs-var hs-var">cLam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143633"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-comment">-- cohesion of lambda</span><span>
</span><span id="line-701"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cohesion
</span><a href="#local-6989586621682143636"><span class="hs-identifier hs-var">cPi</span></a></span><span> </span><span class="annot"><span class="annottext">Cohesion -&gt; Cohesion -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameCohesion"><span class="hs-operator hs-var">`sameCohesion`</span></a></span><span> </span><span class="annot"><span class="annottext">Cohesion
</span><a href="#local-6989586621682143637"><span class="hs-identifier hs-var">cLam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-comment">-- if there is a cohesion annotation then</span><span>
</span><span id="line-703"></span><span>        </span><span class="hs-comment">-- it better match the domain.</span><span>
</span><span id="line-704"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongCohesionInLambda"><span class="hs-identifier hs-var">WrongCohesionInLambda</span></a></span><span>
</span><span id="line-705"></span><span>      </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143633"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">-- | Check that polarity info in lambda is compatible with polarity</span><span>
</span><span id="line-708"></span><span class="hs-comment">--   coming from the function type.</span><span>
</span><span id="line-709"></span><span class="hs-comment">--   If lambda has no user-given polarity, copy that of function type.</span><span>
</span><span id="line-710"></span><span id="local-6989586621682140778"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaPolarityCheck"><span class="hs-identifier hs-type">lambdaPolarityCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#LensModalPolarity"><span class="hs-identifier hs-type">LensModalPolarity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140778"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140778"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span></span><span>
</span><span id="line-711"></span><span id="lambdaPolarityCheck"><span class="annot"><span class="annottext">lambdaPolarityCheck :: forall dom. LensModalPolarity dom =&gt; dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaPolarityCheck"><span class="hs-identifier hs-var hs-var">lambdaPolarityCheck</span></a></span></span><span> </span><span id="local-6989586621682143657"><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143657"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143658"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143658"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-comment">-- Case: no specific user annotation: use polarity of function type</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; PolarityModality
forall a. LensModalPolarity a =&gt; a -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#getModalPolarity"><span class="hs-identifier hs-var">getModalPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143658"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">PolarityModality -&gt; PolarityModality -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PolarityModality
</span><a href="Agda.Syntax.Common.html#defaultPolarity"><span class="hs-identifier hs-var">defaultPolarity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCM ArgInfo) -&gt; ArgInfo -&gt; TCM ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PolarityModality -&gt; ArgInfo -&gt; ArgInfo
forall a. LensModalPolarity a =&gt; PolarityModality -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setModalPolarity"><span class="hs-identifier hs-var">setModalPolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dom -&gt; PolarityModality
forall a. LensModalPolarity a =&gt; a -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#getModalPolarity"><span class="hs-identifier hs-var">getModalPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143657"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143658"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-comment">-- Case: explicit user annotation is taken seriously</span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-716"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143662"><span class="annot"><span class="annottext">cPi :: PolarityModality
</span><a href="#local-6989586621682143662"><span class="hs-identifier hs-var hs-var hs-var">cPi</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dom -&gt; PolarityModality
forall a. LensModalPolarity a =&gt; a -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#getModalPolarity"><span class="hs-identifier hs-var">getModalPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">dom
</span><a href="#local-6989586621682143657"><span class="hs-identifier hs-var">dom</span></a></span><span>  </span><span class="hs-comment">-- polarity of function type</span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143663"><span class="annot"><span class="annottext">cLam :: PolarityModality
</span><a href="#local-6989586621682143663"><span class="hs-identifier hs-var hs-var hs-var">cLam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; PolarityModality
forall a. LensModalPolarity a =&gt; a -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#getModalPolarity"><span class="hs-identifier hs-var">getModalPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143658"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-comment">-- polarity of lambda</span><span>
</span><span id="line-718"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolarityModality
</span><a href="#local-6989586621682143662"><span class="hs-identifier hs-var">cPi</span></a></span><span> </span><span class="annot"><span class="annottext">PolarityModality -&gt; PolarityModality -&gt; Bool
</span><a href="Agda.Syntax.Common.html#samePolarity"><span class="hs-operator hs-var">`samePolarity`</span></a></span><span> </span><span class="annot"><span class="annottext">PolarityModality
</span><a href="#local-6989586621682143663"><span class="hs-identifier hs-var">cLam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>        </span><span class="hs-comment">-- if there is a polarity annotation then</span><span>
</span><span id="line-720"></span><span>        </span><span class="hs-comment">-- it better match the domain.</span><span>
</span><span id="line-721"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongPolarityInLambda"><span class="hs-identifier hs-var">WrongPolarityInLambda</span></a></span><span>
</span><span id="line-722"></span><span>      </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM ArgInfo
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143658"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="hs-comment">-- Andreas, issue #630: take name from function type if lambda name is &quot;_&quot;.</span><span>
</span><span id="line-725"></span><span id="local-6989586621682140767"><span id="local-6989586621682140768"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaAddContext"><span class="hs-identifier hs-type">lambdaAddContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#MonadAddContext"><span class="hs-identifier hs-type">MonadAddContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgName"><span class="hs-identifier hs-type">ArgName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140768"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140768"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-726"></span><span id="lambdaAddContext"><span class="annot"><span class="annottext">lambdaAddContext :: forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Name -&gt; ArgName -&gt; Dom Type -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaAddContext"><span class="hs-identifier hs-var hs-var">lambdaAddContext</span></a></span></span><span> </span><span id="local-6989586621682143674"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143674"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682143675"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682143675"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682143676"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143676"><span class="hs-identifier hs-var">dom</span></a></span></span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143674"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ArgName, Dom Type) -&gt; m a -&gt; m a
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
(ArgName, Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682143675"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143676"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- Note: String instance</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name, Dom Type) -&gt; m a -&gt; m a
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
(Name, Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143674"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143676"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- Name instance of addContext</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="annot"><span class="hs-comment">-- | Checking a lambda whose domain type has already been checked.</span></span><span>
</span><span id="line-731"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda"><span class="hs-identifier hs-type">checkPostponedLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#WithHiding"><span class="hs-identifier hs-type">WithHiding</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-732"></span><span class="hs-comment">-- checkPostponedLambda cmp args@(Arg _    ([]    , _ )) body target = do</span><span>
</span><span id="line-733"></span><span class="hs-comment">--   checkExpr' cmp body target</span><span>
</span><span id="line-734"></span><span id="checkPostponedLambda"><span class="annot"><span class="annottext">checkPostponedLambda :: Comparison
-&gt; Arg (List1 (WithHiding Name), Maybe Type)
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda"><span class="hs-identifier hs-var hs-var">checkPostponedLambda</span></a></span></span><span> </span><span id="local-6989586621682143679"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143679"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682143680"><span class="annot"><span class="annottext">args :: Arg (List1 (WithHiding Name), Maybe Type)
</span><a href="#local-6989586621682143680"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682143681"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143681"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#WithHiding"><span class="hs-identifier hs-type">WithHiding</span></a></span><span> </span><span id="local-6989586621682143683"><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143683"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682143684"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143684"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621682143685"><span class="annot"><span class="annottext">[WithHiding Name]
</span><a href="#local-6989586621682143685"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143686"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682143686"><span class="hs-identifier hs-var">mt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143687"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143687"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143688"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143688"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143689"><span class="annot"><span class="annottext">postpone :: Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143689"><span class="hs-identifier hs-var hs-var">postpone</span></a></span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143690"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143690"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem_"><span class="hs-identifier hs-var">postponeTypeCheckingProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; Arg (List1 (WithHiding Name), Maybe Type)
-&gt; Expr
-&gt; Type
-&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckLambda"><span class="hs-identifier hs-var">CheckLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143679"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (List1 (WithHiding Name), Maybe Type)
</span><a href="#local-6989586621682143680"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143687"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143690"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-736"></span><span>      </span><span id="local-6989586621682143692"><span class="annot"><span class="annottext">lamHiding :: Hiding
</span><a href="#local-6989586621682143692"><span class="hs-identifier hs-var hs-var">lamHiding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Hiding -&gt; Hiding
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143683"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">(Hiding -&gt; Hiding) -&gt; Hiding -&gt; Hiding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Hiding
forall a. LensHiding a =&gt; a -&gt; Hiding
</span><a href="Agda.Syntax.Common.html#getHiding"><span class="hs-identifier hs-var">getHiding</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143681"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><span class="annottext">Hiding
-&gt; Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (Type -&gt; TCM Term)
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#insertHiddenLambdas"><span class="hs-identifier hs-var">insertHiddenLambdas</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143692"><span class="hs-identifier hs-var">lamHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143688"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143689"><span class="hs-identifier hs-var">postpone</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; TCM Term) -&gt; TCM Term) -&gt; (Type -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143695"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621682143695"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682143696"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143696"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143697"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143697"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>    </span><span class="hs-comment">-- Andreas, 2011-10-01 ignore relevance in lambda if not explicitly given</span><span>
</span><span id="line-739"></span><span>    </span><span id="local-6989586621682143698"><span class="annot"><a href="#local-6989586621682143698"><span class="hs-identifier hs-var">info'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; ArgInfo -&gt; ArgInfo
forall a. LensHiding a =&gt; Hiding -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setHiding"><span class="hs-identifier hs-var">setHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143692"><span class="hs-identifier hs-var">lamHiding</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; ArgInfo) -&gt; TCM ArgInfo -&gt; TCM ArgInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ArgInfo -&gt; TCM ArgInfo
forall dom.
(LensAnnotation dom, LensModality dom) =&gt;
dom -&gt; ArgInfo -&gt; TCM ArgInfo
</span><a href="Agda.TypeChecking.Rules.Term.html#lambdaModalityCheck"><span class="hs-identifier hs-var">lambdaModalityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143696"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143681"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-comment">-- We only need to block the final term on the argument type</span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-comment">-- comparison. The body will be blocked if necessary. We still want to</span><span>
</span><span id="line-742"></span><span>    </span><span class="hs-comment">-- compare the argument types first, so we spawn a new problem for that</span><span>
</span><span id="line-743"></span><span>    </span><span class="hs-comment">-- check.</span><span>
</span><span id="line-744"></span><span>    </span><span id="local-6989586621682143700"><span class="annot"><a href="#local-6989586621682143700"><span class="hs-identifier hs-var">mpid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-type">caseMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143686"><span class="hs-identifier hs-type">mt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143702"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143702"><span class="hs-identifier hs-var">ascribedType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemId -&gt; Maybe ProblemId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ProblemId -&gt; Maybe ProblemId)
-&gt; TCMT IO ProblemId -&gt; TCMT IO (Maybe ProblemId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-745"></span><span>      </span><span class="annot"><span class="annottext">TCM () -&gt; TCMT IO ProblemId
forall (m :: * -&gt; *) a.
(MonadFresh ProblemId m, MonadConstraint m) =&gt;
m a -&gt; m ProblemId
</span><a href="Agda.TypeChecking.Constraints.html#newProblem_"><span class="hs-identifier hs-var">newProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCMT IO ProblemId) -&gt; TCM () -&gt; TCMT IO ProblemId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TCM ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Type -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#leqType"><span class="hs-identifier hs-var">leqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143696"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143702"><span class="hs-identifier hs-var">ascribedType</span></a></span><span>
</span><span id="line-746"></span><span>    </span><span class="hs-comment">-- We type-check the body with the ascribedType given by the user</span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-comment">-- to get better error messages.</span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-comment">-- Using the type dom from the usage context would be more precise,</span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-comment">-- though.</span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-comment">-- TODO: quantity</span><span>
</span><span id="line-751"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143703"><span class="annot"><a href="#local-6989586621682143703"><span class="hs-identifier hs-var hs-var">dom'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; Dom Type -&gt; Dom Type
forall a. LensRelevance a =&gt; Relevance -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setRelevance"><span class="hs-identifier hs-var">setRelevance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143698"><span class="hs-identifier hs-var">info'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; Dom Type)
-&gt; (Dom Type -&gt; Dom Type) -&gt; Dom Type -&gt; Dom Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Dom Type -&gt; Dom Type
forall a. LensHiding a =&gt; Hiding -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setHiding"><span class="hs-identifier hs-var">setHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143692"><span class="hs-identifier hs-var">lamHiding</span></a></span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; Dom Type) -&gt; Dom Type -&gt; Dom Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-752"></span><span>          </span><span class="annot"><span class="annottext">Dom Type -&gt; (Type -&gt; Dom Type) -&gt; Maybe Type -&gt; Dom Type
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143696"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143696"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type -&gt; Dom Type
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682143686"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-753"></span><span>    </span><span id="local-6989586621682143706"><span class="annot"><a href="#local-6989586621682143706"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#lambdaAddContext"><span class="hs-identifier hs-type">lambdaAddContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143684"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var">absName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143697"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143703"><span class="hs-identifier hs-type">dom'</span></a></span><span>  </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-754"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda0"><span class="hs-identifier hs-type">checkPostponedLambda0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143679"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143681"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143685"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682143686"><span class="hs-identifier hs-type">mt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143687"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-type">absBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143697"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-755"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143710"><span class="annot"><a href="#local-6989586621682143710"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Abs Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143698"><span class="hs-identifier hs-var">info'</span></a></span><span> </span><span class="annot"><span class="annottext">(Abs Term -&gt; Term) -&gt; Abs Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Term -&gt; Abs Term
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ArgName
</span><a href="Agda.Syntax.Abstract.Name.html#nameToArgName"><span class="hs-identifier hs-var">nameToArgName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143684"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143706"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682143710"><span class="hs-identifier hs-type">v'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#blockTermOnProblem"><span class="hs-identifier hs-type">blockTermOnProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143695"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143710"><span class="hs-identifier hs-type">v'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143700"><span class="hs-identifier hs-type">mpid</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda0"><span class="hs-identifier hs-type">checkPostponedLambda0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#WithHiding"><span class="hs-identifier hs-type">WithHiding</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-759"></span><span id="checkPostponedLambda0"><span class="annot"><span class="annottext">checkPostponedLambda0 :: Comparison
-&gt; Arg ([WithHiding Name], Maybe Type) -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda0"><span class="hs-identifier hs-var hs-var">checkPostponedLambda0</span></a></span></span><span> </span><span id="local-6989586621682143712"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143712"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143713"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143713"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143714"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143714"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-760"></span><span>  </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143712"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143713"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143714"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-761"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda0"><span class="hs-identifier hs-var">checkPostponedLambda0</span></a></span><span> </span><span id="local-6989586621682143715"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143715"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682143716"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143716"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143717"><span class="annot"><span class="annottext">WithHiding Name
</span><a href="#local-6989586621682143717"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682143718"><span class="annot"><span class="annottext">[WithHiding Name]
</span><a href="#local-6989586621682143718"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143719"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682143719"><span class="hs-identifier hs-var">mt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143720"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143720"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682143721"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143721"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-762"></span><span>  </span><span class="annot"><span class="annottext">Comparison
-&gt; Arg (List1 (WithHiding Name), Maybe Type)
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda"><span class="hs-identifier hs-var">checkPostponedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143715"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo
-&gt; (List1 (WithHiding Name), Maybe Type)
-&gt; Arg (List1 (WithHiding Name), Maybe Type)
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143716"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WithHiding Name
</span><a href="#local-6989586621682143717"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">WithHiding Name -&gt; [WithHiding Name] -&gt; List1 (WithHiding Name)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[WithHiding Name]
</span><a href="#local-6989586621682143718"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682143719"><span class="hs-identifier hs-var">mt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143720"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143721"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="hs-comment">-- | Insert hidden lambda until the hiding info of the domain type</span><span>
</span><span id="line-766"></span><span class="hs-comment">--   matches the expected hiding info.</span><span>
</span><span id="line-767"></span><span class="hs-comment">--   Throws 'WrongHidingInLambda'</span><span>
</span><span id="line-768"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#insertHiddenLambdas"><span class="hs-identifier hs-type">insertHiddenLambdas</span></a></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Hiding"><span class="hs-identifier hs-type">Hiding</span></a></span><span>                       </span><span class="annot"><span class="hs-comment">-- ^ Expected hiding.</span></span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                         </span><span class="annot"><span class="hs-comment">-- ^ Expected to be a function type.</span></span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Continuation on blocked type.</span></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- ^ Continuation when expected hiding found.</span><span>
</span><span id="line-773"></span><span>                                  </span><span class="hs-comment">--   The continuation may assume that the @Type@</span><span>
</span><span id="line-774"></span><span>                                  </span><span class="hs-comment">--   is of the form @(El _ (Pi _ _))@.</span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>                     </span><span class="annot"><span class="hs-comment">-- ^ Term with hidden lambda inserted.</span></span><span>
</span><span id="line-776"></span><span id="insertHiddenLambdas"><span class="annot"><span class="annottext">insertHiddenLambdas :: Hiding
-&gt; Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (Type -&gt; TCM Term)
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#insertHiddenLambdas"><span class="hs-identifier hs-var hs-var">insertHiddenLambdas</span></a></span></span><span> </span><span id="local-6989586621682143722"><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143722"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682143723"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143723"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682143724"><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143724"><span class="hs-identifier hs-var">postpone</span></a></span></span><span> </span><span id="local-6989586621682143725"><span class="annot"><span class="annottext">Type -&gt; TCM Term
</span><a href="#local-6989586621682143725"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-comment">-- If the target type is blocked, we postpone,</span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-comment">-- because we do not know if a hidden lambda needs to be inserted.</span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term)
-&gt; TCM Term
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143723"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143724"><span class="hs-identifier hs-var">postpone</span></a></span><span> </span><span class="annot"><span class="annottext">((NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143726"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143726"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143726"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682143727"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143727"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682143728"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143728"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-783"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143729"><span class="annot"><span class="annottext">h' :: Hiding
</span><a href="#local-6989586621682143729"><span class="hs-identifier hs-var hs-var">h'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Hiding
forall a. LensHiding a =&gt; a -&gt; Hiding
</span><a href="Agda.Syntax.Common.html#getHiding"><span class="hs-identifier hs-var">getHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143727"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-784"></span><span>        </span><span class="hs-comment">-- Found expected hiding: return function type.</span><span>
</span><span id="line-785"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Hiding -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143722"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143729"><span class="hs-identifier hs-var">h'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Term
</span><a href="#local-6989586621682143725"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143726"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-786"></span><span>          </span><span class="hs-comment">-- Found a visible argument but expected a hidden one:</span><span>
</span><span id="line-787"></span><span>          </span><span class="hs-comment">-- That's an error, as we cannot insert a visible lambda.</span><span>
</span><span id="line-788"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143729"><span class="hs-identifier hs-var">h'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongHidingInLambda"><span class="hs-identifier hs-var">WrongHidingInLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143723"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-789"></span><span>            </span><span class="hs-comment">-- Otherwise, we found a hidden argument that we can insert.</span><span>
</span><span id="line-790"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143730"><span class="annot"><span class="annottext">x :: ArgName
</span><a href="#local-6989586621682143730"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; ArgName
forall a. Abs a -&gt; ArgName
</span><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var">absName</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143728"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-791"></span><span>            </span><span class="annot"><span class="annottext">ArgInfo -&gt; Abs Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; ArgInfo -&gt; ArgInfo
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; ArgInfo) -&gt; ArgInfo -&gt; ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ArgInfo
forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143727"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Abs Term -&gt; Term) -&gt; (Term -&gt; Abs Term) -&gt; Term -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Term -&gt; Abs Term
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682143730"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; TCM Term -&gt; TCM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-792"></span><span>              </span><span class="annot"><span class="annottext">(ArgName, Dom Type) -&gt; TCM Term -&gt; TCM Term
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
(ArgName, Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682143730"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143727"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hiding
-&gt; Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (Type -&gt; TCM Term)
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#insertHiddenLambdas"><span class="hs-identifier hs-var">insertHiddenLambdas</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143722"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Type -&gt; Type
forall a. Subst a =&gt; Abs a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-var">absBody</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143728"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682143724"><span class="hs-identifier hs-var">postpone</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Term
</span><a href="#local-6989586621682143725"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBePi"><span class="hs-identifier hs-var">ShouldBePi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143723"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span class="hs-comment">-- | @checkAbsurdLambda i h e t@ checks absurd lambda against type @t@.</span><span>
</span><span id="line-797"></span><span class="hs-comment">--   Precondition: @e = AbsurdLam i h@</span><span>
</span><span id="line-798"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkAbsurdLambda"><span class="hs-identifier hs-type">checkAbsurdLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#ExprInfo"><span class="hs-identifier hs-type">A.ExprInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Hiding"><span class="hs-identifier hs-type">Hiding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-799"></span><span id="checkAbsurdLambda"><span class="annot"><span class="annottext">checkAbsurdLambda :: Comparison -&gt; ExprInfo -&gt; Hiding -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkAbsurdLambda"><span class="hs-identifier hs-var hs-var">checkAbsurdLambda</span></a></span></span><span> </span><span id="local-6989586621682143736"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143736"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682143737"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682143737"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682143738"><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143738"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682143739"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143739"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682143740"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143740"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Signature.html#setRunTimeModeUnlessInHardCompileTimeMode"><span class="hs-identifier hs-var">setRunTimeModeUnlessInHardCompileTimeMode</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-comment">-- Andreas, 2019-10-01: check absurd lambdas in non-erased mode.</span><span>
</span><span id="line-802"></span><span>      </span><span class="hs-comment">-- Otherwise, they are not usable in meta-solutions in the term world.</span><span>
</span><span id="line-803"></span><span>      </span><span class="hs-comment">-- See test/Succeed/Issue3176.agda for an absurd lambda</span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-comment">-- created in types.</span><span>
</span><span id="line-805"></span><span>      </span><span class="hs-comment">-- #4743: Except if hard compile-time mode is enabled.</span><span>
</span><span id="line-806"></span><span>  </span><span id="local-6989586621682143742"><span class="annot"><a href="#local-6989586621682143742"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143740"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-type">ifBlocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143742"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143743"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143743"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621682143744"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143744"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; Blocker -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem"><span class="hs-identifier hs-var">postponeTypeCheckingProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143736"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143739"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143744"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143743"><span class="hs-identifier hs-var">blocker</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143745"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143745"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143745"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682143746"><span class="annot"><span class="annottext">dom :: Dom Type
</span><a href="#local-6989586621682143746"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682143748"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143748"><span class="hs-identifier hs-var">info'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682143749"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143749"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143750"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143750"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-810"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hiding -&gt; ArgInfo -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682143738"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143748"><span class="hs-identifier hs-var">info'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongHidingInLambda"><span class="hs-identifier hs-var">WrongHidingInLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143745"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-811"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *).
(MonadMetaSolver m, MonadConstraint m, MonadFresh Int m,
 MonadFresh ProblemId m) =&gt;
Type -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.MetaVars.html#blockTerm"><span class="hs-identifier hs-var">blockTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143745"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-812"></span><span>          </span><span class="annot"><span class="annottext">Range -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Empty.html#ensureEmptyType"><span class="hs-identifier hs-var">ensureEmptyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682143737"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143749"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-813"></span><span>          </span><span class="hs-comment">-- Add helper function</span><span>
</span><span id="line-814"></span><span>          </span><span id="local-6989586621682143752"><span class="annot"><a href="#local-6989586621682143752"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Dom Type -&gt; Abs Type -&gt; TCM QName
</span><a href="Agda.TypeChecking.Rules.Term.html#makeAbsurdLambda"><span class="hs-identifier hs-var">makeAbsurdLambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682143737"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143746"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143750"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-815"></span><span>          </span><span class="hs-comment">-- Andreas 2012-01-30: since aux is lifted to toplevel</span><span>
</span><span id="line-816"></span><span>          </span><span class="hs-comment">-- it needs to be applied to the current telescope (issue 557)</span><span>
</span><span id="line-817"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143752"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#teleArgs"><span class="hs-identifier hs-type">teleArgs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span>
</span><span id="line-818"></span><span>      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBePi"><span class="hs-identifier hs-var">ShouldBePi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143745"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="hs-comment">-- Create an absurd lambda with the given type.</span><span>
</span><span id="line-821"></span><span class="hs-comment">-- Precondition: the given type is a pi type with an empty domain.</span><span>
</span><span id="line-822"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#makeAbsurdLambda"><span class="hs-identifier hs-type">makeAbsurdLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-823"></span><span id="makeAbsurdLambda"><span class="annot"><span class="annottext">makeAbsurdLambda :: Range -&gt; Dom Type -&gt; Abs Type -&gt; TCM QName
</span><a href="Agda.TypeChecking.Rules.Term.html#makeAbsurdLambda"><span class="hs-identifier hs-var hs-var">makeAbsurdLambda</span></a></span></span><span> </span><span id="local-6989586621682143757"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682143757"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143758"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143758"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682143759"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143759"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143760"><span class="annot"><span class="annottext">t :: Term
</span><a href="#local-6989586621682143760"><span class="hs-identifier hs-var hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-var">Pi</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143758"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143759"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-825"></span><span>      </span><span id="local-6989586621682143761"><span class="annot"><span class="annottext">s :: Sort' Term
</span><a href="#local-6989586621682143761"><span class="hs-identifier hs-var hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Sort' Term
</span><a href="Agda.TypeChecking.Substitute.html#mkPiSort"><span class="hs-identifier hs-var">mkPiSort</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143758"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682143759"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-826"></span><span>      </span><span id="local-6989586621682143763"><span class="annot"><span class="annottext">info :: ArgInfo
</span><a href="#local-6989586621682143763"><span class="hs-identifier hs-var hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ArgInfo
forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682143758"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span id="local-6989586621682143764"><span class="annot"><a href="#local-6989586621682143764"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ModuleName
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m ModuleName
</span><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-var">currentModule</span></a></span><span>
</span><span id="line-828"></span><span>  </span><span id="local-6989586621682143766"><span class="annot"><a href="#local-6989586621682143766"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qualify"><span class="hs-identifier hs-type">qualify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143764"><span class="hs-identifier hs-type">top</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#freshName_"><span class="hs-identifier hs-type">freshName_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143757"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#absurdLambdaName"><span class="hs-identifier hs-type">absurdLambdaName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-comment">-- if we are in irrelevant / erased position, the helper function</span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-comment">-- is added as irrelevant / erased</span><span>
</span><span id="line-831"></span><span>  </span><span id="local-6989586621682143770"><span class="annot"><a href="#local-6989586621682143770"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#currentModality"><span class="hs-identifier hs-type">currentModality</span></a></span><span>
</span><span id="line-832"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.absurd&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Adding absurd function&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143770"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143766"><span class="hs-identifier hs-type">aux</span></a></span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;of type&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143760"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-836"></span><span>  </span><span id="local-6989586621682143772"><span class="annot"><a href="#local-6989586621682143772"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getLanguage"><span class="hs-identifier hs-type">getLanguage</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span id="local-6989586621682143774"><span class="annot"><a href="#local-6989586621682143774"><span class="hs-identifier hs-var">fun</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#emptyFunctionData"><span class="hs-identifier hs-type">emptyFunctionData</span></a></span><span>
</span><span id="line-838"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-type">addConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143766"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-839"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143777"><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682143777"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; QName -&gt; Type -&gt; Language -&gt; Defn -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-var">defaultDefn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; ArgInfo
forall a. LensModality a =&gt; Modality -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setModality"><span class="hs-identifier hs-var">setModality</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682143770"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682143763"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682143766"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682143761"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682143760"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621682143772"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682143777"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defPolarity"><span class="hs-identifier hs-var">defPolarity</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Nonvariant"><span class="hs-identifier hs-type">Nonvariant</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-841"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defArgOccurrences"><span class="hs-identifier hs-var">defArgOccurrences</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Unused"><span class="hs-identifier hs-type">Unused</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#FunctionDefn"><span class="hs-identifier hs-type">FunctionDefn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143774"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-843"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funClauses"><span class="hs-identifier hs-var">_funClauses</span></a></span><span>        </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span>
</span><span id="line-845"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseLHSRange"><span class="hs-identifier hs-var">clauseLHSRange</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682143757"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-846"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseFullRange"><span class="hs-identifier hs-var">clauseFullRange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682143757"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-847"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseTel"><span class="hs-identifier hs-var">clauseTel</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-type">telFromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#absurdPatternName"><span class="hs-identifier hs-type">absurdPatternName</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682143758"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-848"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143763"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#WithOrigin"><span class="hs-identifier hs-type">WithOrigin</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-type">Inserted</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unranged"><span class="hs-identifier hs-type">unranged</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var">absName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143759"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#absurdP"><span class="hs-identifier hs-type">absurdP</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-849"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-850"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseType"><span class="hs-identifier hs-var">clauseType</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#setModality"><span class="hs-identifier hs-type">setModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143770"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-type">defaultArg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-type">absBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143759"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-851"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseCatchall"><span class="hs-identifier hs-var">clauseCatchall</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#YesCatchall"><span class="hs-identifier hs-type">YesCatchall</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>      </span><span class="hs-comment">-- absurd clauses are safe as catch-alls</span><span>
</span><span id="line-852"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseRecursive"><span class="hs-identifier hs-var">clauseRecursive</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#NotRecursive"><span class="hs-identifier hs-type">NotRecursive</span></a></span><span>
</span><span id="line-853"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseUnreachable"><span class="hs-identifier hs-var">clauseUnreachable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-comment">-- absurd clauses are unreachable</span><span>
</span><span id="line-854"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseEllipsis"><span class="hs-identifier hs-var">clauseEllipsis</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NoEllipsis"><span class="hs-identifier hs-type">NoEllipsis</span></a></span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseWhereModule"><span class="hs-identifier hs-var">clauseWhereModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-856"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-857"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funCompiled"><span class="hs-identifier hs-var">_funCompiled</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Fail"><span class="hs-identifier hs-type">Fail</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143763"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;()&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-859"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funSplitTree"><span class="hs-identifier hs-var">_funSplitTree</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplittingDone"><span class="hs-identifier hs-type">SplittingDone</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-860"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funMutual"><span class="hs-identifier hs-var">_funMutual</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-861"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funTerminates"><span class="hs-identifier hs-var">_funTerminates</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-862"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funExtLam"><span class="hs-identifier hs-var">_funExtLam</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExtLamInfo"><span class="hs-identifier hs-type">ExtLamInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143764"><span class="hs-identifier hs-type">top</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-863"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-864"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682143766"><span class="hs-identifier hs-type">aux</span></a></span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span class="hs-comment">-- | @checkExtendedLambda i di erased qname cs e t@ check pattern matching lambda.</span><span>
</span><span id="line-867"></span><span class="hs-comment">-- Precondition: @e = ExtendedLam i di erased qname cs@</span><span>
</span><span id="line-868"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExtendedLambda"><span class="hs-identifier hs-type">checkExtendedLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-869"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#ExprInfo"><span class="hs-identifier hs-type">A.ExprInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefInfo"><span class="hs-identifier hs-type">A.DefInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Erased"><span class="hs-identifier hs-type">Erased</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-870"></span><span>  </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-871"></span><span id="checkExtendedLambda"><span class="annot"><span class="annottext">checkExtendedLambda :: Comparison
-&gt; ExprInfo
-&gt; DefInfo
-&gt; Erased
-&gt; QName
-&gt; List1 Clause
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExtendedLambda"><span class="hs-identifier hs-var hs-var">checkExtendedLambda</span></a></span></span><span> </span><span id="local-6989586621682143818"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143818"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682143819"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682143819"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682143820"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682143820"><span class="hs-identifier hs-var">di</span></a></span></span><span> </span><span id="local-6989586621682143821"><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682143821"><span class="hs-identifier hs-var">erased</span></a></span></span><span> </span><span id="local-6989586621682143822"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682143822"><span class="hs-identifier hs-var">qname</span></a></span></span><span> </span><span id="local-6989586621682143823"><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682143823"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682143824"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143824"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682143825"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143825"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>  </span><span id="local-6989586621682143826"><span class="annot"><a href="#local-6989586621682143826"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Modality
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Modality
</span><a href="Agda.TypeChecking.Monad.Base.html#currentModality"><span class="hs-identifier hs-var">currentModality</span></a></span><span>
</span><span id="line-873"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#isErased"><span class="hs-identifier hs-type">isErased</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143821"><span class="hs-identifier hs-type">erased</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#hasQuantity0"><span class="hs-identifier hs-type">hasQuantity0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143826"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LambdaIsErased"><span class="hs-identifier hs-type">LambdaIsErased</span></a></span><span>
</span><span id="line-874"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#setModeUnlessInHardCompileTimeMode"><span class="hs-identifier hs-type">setModeUnlessInHardCompileTimeMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143821"><span class="hs-identifier hs-type">erased</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-875"></span><span>         </span><span class="hs-comment">-- Erased pattern-matching lambdas are checked in hard</span><span>
</span><span id="line-876"></span><span>         </span><span class="hs-comment">-- compile-time mode. For non-erased pattern-matching lambdas</span><span>
</span><span id="line-877"></span><span>         </span><span class="hs-comment">-- run-time mode is used, unless the current mode is hard</span><span>
</span><span id="line-878"></span><span>         </span><span class="hs-comment">-- compile-time mode.</span><span>
</span><span id="line-879"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-06-16 issue #2045</span><span>
</span><span id="line-880"></span><span>    </span><span class="hs-comment">-- Try to get rid of unsolved size metas before we</span><span>
</span><span id="line-881"></span><span>    </span><span class="hs-comment">-- fix the type of the extended lambda auxiliary function</span><span>
</span><span id="line-882"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints"><span class="hs-identifier hs-type">solveSizeConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#DontDefaultToInfty"><span class="hs-identifier hs-type">DontDefaultToInfty</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span id="local-6989586621682143833"><span class="annot"><a href="#local-6989586621682143833"><span class="hs-identifier hs-var">lamMod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#inFreshModuleIfFreeParams"><span class="hs-identifier hs-type">inFreshModuleIfFreeParams</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-type">currentModule</span></a></span><span>  </span><span class="hs-comment">-- #2883: need a fresh module if refined params</span><span>
</span><span id="line-884"></span><span>    </span><span id="local-6989586621682143835"><span class="annot"><a href="#local-6989586621682143835"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143825"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-885"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-type">ifBlocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143835"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143836"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143836"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682143837"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143837"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem_"><span class="hs-identifier hs-var">postponeTypeCheckingProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143818"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143824"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143837"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143838"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143838"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-886"></span><span>      </span><span id="local-6989586621682143839"><span class="annot"><a href="#local-6989586621682143839"><span class="hs-identifier hs-var">j</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM MutualId
</span><a href="Agda.TypeChecking.Monad.Mutual.html#currentOrFreshMutualBlock"><span class="hs-identifier hs-var">currentOrFreshMutualBlock</span></a></span><span>
</span><span id="line-887"></span><span>      </span><span id="local-6989586621682143841"><span class="annot"><a href="#local-6989586621682143841"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#currentModality"><span class="hs-identifier hs-type">currentModality</span></a></span><span>
</span><span id="line-888"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682143842"><span class="annot"><a href="#local-6989586621682143842"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; ArgInfo
forall a. LensModality a =&gt; Modality -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setModality"><span class="hs-identifier hs-var">setModality</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682143841"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.exlam&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-type">hsep</span></a></span><span>
</span><span id="line-892"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#defAbstract"><span class="hs-identifier hs-var">A.defAbstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143820"><span class="hs-identifier hs-type">di</span></a></span><span>
</span><span id="line-893"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;extended lambda's implementation&quot;</span></span><span>
</span><span id="line-894"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#doubleQuotes"><span class="hs-identifier hs-type">doubleQuotes</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143822"><span class="hs-identifier hs-type">qname</span></a></span><span>
</span><span id="line-895"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;has type:&quot;</span></span><span>
</span><span id="line-896"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-897"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143838"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-comment">-- &lt;+&gt; &quot; where clauses: &quot; &lt;+&gt; text (show cs)</span><span>
</span><span id="line-898"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-899"></span><span>      </span><span id="local-6989586621682143845"><span class="annot"><a href="#local-6989586621682143845"><span class="hs-identifier hs-var">args</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextArgs"><span class="hs-identifier hs-type">getContextArgs</span></a></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>      </span><span class="hs-comment">-- Andreas, Ulf, 2016-02-02: We want to postpone type checking an extended lambda</span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-comment">-- in case the lhs checker failed due to insufficient type info for the patterns.</span><span>
</span><span id="line-903"></span><span>      </span><span class="hs-comment">-- Issues 480, 1159, 1811.</span><span>
</span><span id="line-904"></span><span>      </span><span class="annot"><a href="#local-6989586621682143846"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#defAbstract"><span class="hs-identifier hs-var">A.defAbstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143820"><span class="hs-identifier hs-type">di</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>        </span><span class="hs-comment">-- Andreas, 2013-12-28: add extendedlambda as @Function@, not as @Axiom@;</span><span>
</span><span id="line-906"></span><span>        </span><span class="hs-comment">-- otherwise, @addClause@ in @checkFunDef'@ fails (see issue 1009).</span><span>
</span><span id="line-907"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-type">addConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143822"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-908"></span><span>          </span><span id="local-6989586621682143847"><span class="annot"><a href="#local-6989586621682143847"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getLanguage"><span class="hs-identifier hs-type">getLanguage</span></a></span><span>
</span><span id="line-909"></span><span>          </span><span id="local-6989586621682143848"><span class="annot"><a href="#local-6989586621682143848"><span class="hs-identifier hs-var">fun</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#emptyFunction"><span class="hs-identifier hs-type">emptyFunction</span></a></span><span>
</span><span id="line-910"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-type">useTerPragma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-911"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-type">defaultDefn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143842"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143822"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143838"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143847"><span class="hs-identifier hs-type">lang</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143848"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defMutual"><span class="hs-identifier hs-var">defMutual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682143839"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-913"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef%27"><span class="hs-identifier hs-type">checkFunDef'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143838"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143842"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExtLamInfo"><span class="hs-identifier hs-type">ExtLamInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143833"><span class="hs-identifier hs-type">lamMod</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682143820"><span class="hs-identifier hs-type">di</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143822"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-914"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">List1.toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682143823"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-915"></span><span>        </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenNothingM"><span class="hs-identifier hs-type">whenNothingM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envMutualBlock"><span class="hs-identifier hs-var">envMutualBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-916"></span><span>          </span><span class="hs-comment">-- Andrea 10-03-2018: Should other checks be performed here too? e.g. termination/positivity/..</span><span>
</span><span id="line-917"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.IApplyConfluence.html#checkIApplyConfluence_"><span class="hs-identifier hs-type">checkIApplyConfluence_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143822"><span class="hs-identifier hs-type">qname</span></a></span><span>
</span><span id="line-918"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143822"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143845"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-920"></span><span>    </span><span class="hs-comment">-- Concrete definitions cannot use information about abstract things.</span><span>
</span><span id="line-921"></span><span>    </span><span id="local-6989586621682143846"><span class="annot"><span class="annottext">abstract :: IsAbstract -&gt; m a -&gt; m a
</span><a href="#local-6989586621682143846"><span class="hs-identifier hs-var hs-var">abstract</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inConcreteMode"><span class="hs-identifier hs-var">inConcreteMode</span></a></span><span>
</span><span id="line-922"></span><span>    </span><span class="annot"><a href="#local-6989586621682143846"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#AbstractDef"><span class="hs-identifier hs-var">AbstractDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#inAbstractMode"><span class="hs-identifier hs-var">inAbstractMode</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="hs-comment">-- | Run a computation.</span><span>
</span><span id="line-925"></span><span class="hs-comment">--</span><span>
</span><span id="line-926"></span><span class="hs-comment">--   * If successful, that's it, we are done.</span><span>
</span><span id="line-927"></span><span class="hs-comment">--</span><span>
</span><span id="line-928"></span><span class="hs-comment">--   * If @NotADatatype a@ or @CannotEliminateWithPattern p a@</span><span>
</span><span id="line-929"></span><span class="hs-comment">--     is thrown and type @a@ is blocked on some meta @x@,</span><span>
</span><span id="line-930"></span><span class="hs-comment">--     reset any changes to the state and pass (the error and) @x@ to the handler.</span><span>
</span><span id="line-931"></span><span class="hs-comment">--</span><span>
</span><span id="line-932"></span><span class="hs-comment">--   * If @SplitError (UnificationStuck c tel us vs _)@ is thrown and the unification</span><span>
</span><span id="line-933"></span><span class="hs-comment">--     problem @us =?= vs : tel@ is blocked on some meta @x@ pass @x@ to the handler.</span><span>
</span><span id="line-934"></span><span class="hs-comment">--</span><span>
</span><span id="line-935"></span><span class="hs-comment">--   * If another error was thrown or the type @a@ is not blocked, reraise the error.</span><span>
</span><span id="line-936"></span><span class="hs-comment">--</span><span>
</span><span id="line-937"></span><span class="hs-comment">--   Note that the returned meta might only exists in the state where the error was</span><span>
</span><span id="line-938"></span><span class="hs-comment">--   thrown, thus, be an invalid 'MetaId' in the current state.</span><span>
</span><span id="line-939"></span><span class="hs-comment">--</span><span>
</span><span id="line-940"></span><span id="local-6989586621682140752"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#catchIlltypedPatternBlockedOnMeta"><span class="hs-identifier hs-type">catchIlltypedPatternBlockedOnMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140752"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140752"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140752"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-941"></span><span id="catchIlltypedPatternBlockedOnMeta"><span class="annot"><span class="annottext">catchIlltypedPatternBlockedOnMeta :: forall a. TCM a -&gt; ((TCErr, Blocker) -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#catchIlltypedPatternBlockedOnMeta"><span class="hs-identifier hs-var hs-var">catchIlltypedPatternBlockedOnMeta</span></a></span></span><span> </span><span id="local-6989586621682143900"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682143900"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682143901"><span class="annot"><span class="annottext">(TCErr, Blocker) -&gt; TCM a
</span><a href="#local-6989586621682143901"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>  </span><span class="hs-comment">-- Andreas, 2016-07-13, issue 2028.</span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-comment">-- Save the state to rollback the changes to the signature.</span><span>
</span><span id="line-945"></span><span>  </span><span id="local-6989586621682143902"><span class="annot"><a href="#local-6989586621682143902"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span>  </span><span class="annot"><a href="#local-6989586621682143900"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143905"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682143905"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682140868"><span id="local-6989586621682140869"><span class="annot"><a href="#local-6989586621682143906"><span class="hs-identifier hs-type">reraise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140868"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140868"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140869"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-950"></span><span>        </span><span id="local-6989586621682143906"><span class="annot"><span class="annottext">reraise :: forall (m :: * -&gt; *) a. MonadError TCErr m =&gt; m a
</span><a href="#local-6989586621682143906"><span class="hs-identifier hs-var hs-var hs-var">reraise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; m a
forall a. TCErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682143905"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>    </span><span class="hs-comment">-- Get the blocker responsible for the type error.</span><span>
</span><span id="line-953"></span><span>    </span><span class="hs-comment">-- If we do not find a blocker or the error should not be handled,</span><span>
</span><span id="line-954"></span><span>    </span><span class="hs-comment">-- we reraise the error.</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621682143910"><span class="annot"><a href="#local-6989586621682143910"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Blocker
-&gt; (Blocker -&gt; TCMT IO Blocker) -&gt; Maybe Blocker -&gt; TCMT IO Blocker
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Blocker
forall (m :: * -&gt; *) a. MonadError TCErr m =&gt; m a
</span><a href="#local-6989586621682143906"><span class="hs-identifier hs-var">reraise</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Blocker
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Blocker -&gt; TCMT IO Blocker)
-&gt; Maybe Blocker -&gt; TCMT IO Blocker
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682143905"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-956"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143912"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682143912"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682143913"><span class="annot"><span class="annottext">Closure TypeError
</span><a href="#local-6989586621682143913"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Closure TypeError -&gt; TypeError
forall a. Closure a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#clValue"><span class="hs-identifier hs-var">clValue</span></a></span><span> </span><span class="annot"><span class="annottext">Closure TypeError
</span><a href="#local-6989586621682143913"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-957"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#SortOfSplitVarError"><span class="hs-identifier hs-type">SortOfSplitVarError</span></a></span><span> </span><span id="local-6989586621682143916"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143916"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143916"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-958"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#SplitError"><span class="hs-identifier hs-type">SplitError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UnificationStuck"><span class="hs-identifier hs-type">UnificationStuck</span></a></span><span> </span><span id="local-6989586621682143919"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143919"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682143920"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682143920"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682143921"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682143921"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682143922"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682143922"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682143923"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682143923"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="annot"><span class="annottext">[UnificationFailure]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143919"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-959"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#SplitError"><span class="hs-identifier hs-type">SplitError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BlockedType"><span class="hs-identifier hs-type">BlockedType</span></a></span><span> </span><span id="local-6989586621682143925"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143925"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682143926"><span class="annot"><span class="annottext">Closure Type
</span><a href="#local-6989586621682143926"><span class="hs-identifier hs-var">aClosure</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Maybe Blocker
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682143925"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-960"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CannotEliminateWithPattern"><span class="hs-identifier hs-type">CannotEliminateWithPattern</span></a></span><span> </span><span id="local-6989586621682143928"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143928"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682143929"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682143929"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682143930"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143930"><span class="hs-identifier hs-var">a</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-961"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CannotEliminateWithProjection"><span class="hs-identifier hs-type">CannotEliminateWithProjection</span></a></span><span> </span><span id="local-6989586621682143932"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143932"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682143932"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-962"></span><span>        </span><span class="hs-comment">-- Andrea: TODO look for blocking meta in tClosure and its Sort.</span><span>
</span><span id="line-963"></span><span>        </span><span class="hs-comment">-- SplitError (CannotCreateMissingClause _ _ _ tClosure) -&gt;</span><span>
</span><span id="line-964"></span><span>        </span><span class="annot"><span class="annottext">TypeError
</span><span class="hs-identifier">_</span></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-965"></span><span>      </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.postpone&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-968"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;checking definition blocked on: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143910"><span class="hs-identifier hs-type">blocker</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span>    </span><span class="hs-comment">-- Note that we messed up the state a bit.  We might want to unroll these state changes.</span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-comment">-- However, they are mostly harmless:</span><span>
</span><span id="line-972"></span><span>    </span><span class="hs-comment">-- 1. We created a new mutual block id.</span><span>
</span><span id="line-973"></span><span>    </span><span class="hs-comment">-- 2. We added a constant without definition.</span><span>
</span><span id="line-974"></span><span>    </span><span class="hs-comment">-- In fact, they are not so harmless, see issue 2028!</span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-comment">-- Thus, reset the state!</span><span>
</span><span id="line-976"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-type">putTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143902"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span>    </span><span class="hs-comment">-- There might be metas in the blocker not known in the reset state, as they could have been</span><span>
</span><span id="line-979"></span><span>    </span><span class="hs-comment">-- created somewhere on the way to the type error.</span><span>
</span><span id="line-980"></span><span>    </span><span id="local-6989586621682143934"><span class="annot"><a href="#local-6989586621682143934"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`onBlockingMetasM`</span></span><span> </span><span class="annot"><span class="hs-identifier">blocker</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143936"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682143936"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-981"></span><span>                </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO (Maybe (Either RemoteMetaVariable MetaVariable))
forall (m :: * -&gt; *).
ReadTCState m =&gt;
MetaId -&gt; m (Maybe (Either RemoteMetaVariable MetaVariable))
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMeta"><span class="hs-identifier hs-var">lookupMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682143936"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe (Either RemoteMetaVariable MetaVariable))
-&gt; (Maybe (Either RemoteMetaVariable MetaVariable)
    -&gt; TCMT IO Blocker)
-&gt; TCMT IO Blocker
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">case</span><span>
</span><span id="line-982"></span><span>      </span><span class="hs-comment">-- Case: we do not know the meta, so cannot unblock.</span><span>
</span><span id="line-983"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Either RemoteMetaVariable MetaVariable)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Blocker
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-comment">-- Case: we know the meta here.</span><span>
</span><span id="line-985"></span><span>      </span><span class="hs-comment">-- Just m | InstV{} &lt;- mvInstantiation m -&gt; __IMPOSSIBLE__  -- It cannot be instantiated yet.</span><span>
</span><span id="line-986"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-11-23: I do not understand why @InstV@ is necessarily impossible.</span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-comment">-- The reasoning is probably that the state @st@ is more advanced that @s@</span><span>
</span><span id="line-988"></span><span>      </span><span class="hs-comment">-- in which @x@ was blocking, thus metas in @st@ should be more instantiated than</span><span>
</span><span id="line-989"></span><span>      </span><span class="hs-comment">-- in @s@.  But issue #3403 presents a counterexample, so let's play save and reraise.</span><span>
</span><span id="line-990"></span><span>      </span><span class="hs-comment">-- Ulf, 2020-08-13: But treat this case as not blocked and reraise on both always and never.</span><span>
</span><span id="line-991"></span><span>      </span><span class="hs-comment">-- Ulf, 2020-08-13: Previously we returned neverUnblock for frozen metas here, but this is in</span><span>
</span><span id="line-992"></span><span>      </span><span class="hs-comment">-- fact not very helpful. Yes there is no hope of solving the problem, but throwing a hard</span><span>
</span><span id="line-993"></span><span>      </span><span class="hs-comment">-- error means we rob the user of the tools needed to figure out why the meta has not been</span><span>
</span><span id="line-994"></span><span>      </span><span class="hs-comment">-- solved. Better to leave the constraint.</span><span>
</span><span id="line-995"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Blocker
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-var">alwaysUnblock</span></a></span><span>
</span><span id="line-996"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682143940"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682143940"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InstV"><span class="hs-identifier hs-type">InstV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682143940"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Blocker
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-var">alwaysUnblock</span></a></span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Blocker
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; TCMT IO Blocker) -&gt; Blocker -&gt; TCMT IO Blocker
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#unblockOnMeta"><span class="hs-identifier hs-var">unblockOnMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682143936"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>    </span><span class="hs-comment">-- If it's not blocked or we can't ever unblock reraise the error.</span><span>
</span><span id="line-1001"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682143934"><span class="hs-identifier hs-type">blocker</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-type">neverUnblock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-type">alwaysUnblock</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682143906"><span class="hs-identifier hs-type">reraise</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682143901"><span class="hs-identifier hs-type">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143905"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682143934"><span class="hs-identifier hs-type">blocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1004"></span><span class="annot"><span class="hs-comment">-- * Records</span></span><span>
</span><span id="line-1005"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span class="hs-comment">-- | Picks up record field assignments from modules that export a definition</span><span>
</span><span id="line-1008"></span><span class="hs-comment">--   that has the same name as the missing field.</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#expandModuleAssigns"><span class="hs-identifier hs-type">expandModuleAssigns</span></a></span><span>
</span><span id="line-1011"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Assign"><span class="hs-identifier hs-type">A.Assign</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Modules and field assignments.</span></span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ Names of fields of the record type.</span></span><span>
</span><span id="line-1013"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Assigns"><span class="hs-identifier hs-type">A.Assigns</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Completed field assignments from modules.</span></span><span>
</span><span id="line-1014"></span><span id="expandModuleAssigns"><span class="annot"><span class="annottext">expandModuleAssigns :: [Either (FieldAssignment' Expr) ModuleName]
-&gt; [Name] -&gt; TCM Assigns
</span><a href="Agda.TypeChecking.Rules.Term.html#expandModuleAssigns"><span class="hs-identifier hs-var hs-var">expandModuleAssigns</span></a></span></span><span> </span><span id="local-6989586621682143947"><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682143947"><span class="hs-identifier hs-var">mfs</span></a></span></span><span> </span><span id="local-6989586621682143948"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682143948"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143949"><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682143949"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143950"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682143950"><span class="hs-identifier hs-var hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
-&gt; (Assigns, [ModuleName])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682143947"><span class="hs-identifier hs-var">mfs</span></a></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-comment">-- The fields of the record that have not been given by field assignments @fs@</span><span>
</span><span id="line-1018"></span><span>  </span><span class="hs-comment">-- are looked up in the given modules @ms@.</span><span>
</span><span id="line-1019"></span><span>  </span><span id="local-6989586621682143951"><span class="annot"><a href="#local-6989586621682143951"><span class="hs-identifier hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; (Name -&gt; TCMT IO (Maybe (FieldAssignment' Expr)))
-&gt; TCMT IO [Maybe (FieldAssignment' Expr)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682143948"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">List.\\</span></span><span> </span><span class="annot"><span class="annottext">(FieldAssignment' Expr -&gt; Name) -&gt; Assigns -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' (FieldAssignment' Expr) Name -&gt; FieldAssignment' Expr -&gt; Name
forall o (m :: * -&gt; *) i. MonadReader o m =&gt; Lens' o i -&gt; m i
</span><a href="Agda.Utils.Lens.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; f Name)
-&gt; FieldAssignment' Expr -&gt; f (FieldAssignment' Expr)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Name -&gt; f Name) -&gt; FieldAssignment' a -&gt; f (FieldAssignment' a)
Lens' (FieldAssignment' Expr) Name
</span><a href="Agda.Syntax.Concrete.html#nameFieldA"><span class="hs-identifier hs-var">nameFieldA</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682143949"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Name -&gt; TCMT IO (Maybe (FieldAssignment' Expr)))
 -&gt; TCMT IO [Maybe (FieldAssignment' Expr)])
-&gt; (Name -&gt; TCMT IO (Maybe (FieldAssignment' Expr)))
-&gt; TCMT IO [Maybe (FieldAssignment' Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143957"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143957"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-comment">-- Get the possible assignments for field f from the modules.</span><span>
</span><span id="line-1022"></span><span>    </span><span id="local-6989586621682143958"><span class="annot"><a href="#local-6989586621682143958"><span class="hs-identifier hs-var">pms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
-&gt; (ModuleName
    -&gt; TCMT IO (Maybe (ModuleName, FieldAssignment' Expr)))
-&gt; TCMT IO [Maybe (ModuleName, FieldAssignment' Expr)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682143950"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">((ModuleName
  -&gt; TCMT IO (Maybe (ModuleName, FieldAssignment' Expr)))
 -&gt; TCMT IO [Maybe (ModuleName, FieldAssignment' Expr)])
-&gt; (ModuleName
    -&gt; TCMT IO (Maybe (ModuleName, FieldAssignment' Expr)))
-&gt; TCMT IO [Maybe (ModuleName, FieldAssignment' Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682143959"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682143959"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1023"></span><span>      </span><span id="local-6989586621682143960"><span class="annot"><a href="#local-6989586621682143960"><span class="hs-identifier hs-var">modScope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682143959"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1024"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682143961"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ThingsInScope"><span class="hs-identifier hs-type">ThingsInScope</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span>
</span><span id="line-1025"></span><span>          </span><span id="local-6989586621682143961"><span class="annot"><a href="#local-6989586621682143961"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ThingsInScope AbstractName
forall a. InScope a =&gt; Scope -&gt; ThingsInScope a
</span><a href="Agda.Syntax.Scope.Base.html#exportedNamesInScope"><span class="hs-identifier hs-var">exportedNamesInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621682143960"><span class="hs-identifier hs-var">modScope</span></a></span><span>
</span><span id="line-1026"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1027"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621682143957"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143961"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1028"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682143963"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621682143963"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr)
-&gt; Maybe (ModuleName, FieldAssignment' Expr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682143959"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Expr -&gt; FieldAssignment' Expr
forall a. Name -&gt; a -&gt; FieldAssignment' a
</span><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-var">FieldAssignment</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143957"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; FieldAssignment' Expr) -&gt; Expr -&gt; FieldAssignment' Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Expr) -&gt; Expr -&gt; Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; Expr
forall a. NameToExpr a =&gt; a -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#nameToExpr"><span class="hs-identifier hs-var">A.nameToExpr</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621682143963"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>          </span><span class="annot"><span class="annottext">Maybe (List1 AbstractName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ModuleName, FieldAssignment' Expr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span>    </span><span class="hs-comment">-- If we have several matching assignments, that's an error.</span><span>
</span><span id="line-1032"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">catMaybes</span></span><span> </span><span class="annot"><a href="#local-6989586621682143958"><span class="hs-identifier hs-type">pms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1033"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (FieldAssignment' Expr)
-&gt; TCMT IO (Maybe (FieldAssignment' Expr))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (FieldAssignment' Expr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1034"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682143968"><span class="annot"><span class="annottext">FieldAssignment' Expr
</span><a href="#local-6989586621682143968"><span class="hs-identifier hs-var">fa</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (FieldAssignment' Expr)
-&gt; TCMT IO (Maybe (FieldAssignment' Expr))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldAssignment' Expr -&gt; Maybe (FieldAssignment' Expr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FieldAssignment' Expr
</span><a href="#local-6989586621682143968"><span class="hs-identifier hs-var">fa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>      </span><span id="local-6989586621682143969"><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr)
</span><a href="#local-6989586621682143969"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682143970"><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr)
</span><a href="#local-6989586621682143970"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682143971"><span class="annot"><span class="annottext">[(ModuleName, FieldAssignment' Expr)]
</span><a href="#local-6989586621682143971"><span class="hs-identifier hs-var">zs</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO (Maybe (FieldAssignment' Expr))
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO (Maybe (FieldAssignment' Expr)))
-&gt; TypeError -&gt; TCMT IO (Maybe (FieldAssignment' Expr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; List2 ModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AmbiguousField"><span class="hs-identifier hs-var">AmbiguousField</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143957"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(List2 ModuleName -&gt; TypeError) -&gt; List2 ModuleName -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ModuleName, FieldAssignment' Expr) -&gt; ModuleName)
-&gt; List2 (ModuleName, FieldAssignment' Expr) -&gt; List2 ModuleName
forall a b. (a -&gt; b) -&gt; List2 a -&gt; List2 b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr) -&gt; ModuleName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(List2 (ModuleName, FieldAssignment' Expr) -&gt; List2 ModuleName)
-&gt; List2 (ModuleName, FieldAssignment' Expr) -&gt; List2 ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr)
-&gt; (ModuleName, FieldAssignment' Expr)
-&gt; [(ModuleName, FieldAssignment' Expr)]
-&gt; List2 (ModuleName, FieldAssignment' Expr)
forall a. a -&gt; a -&gt; [a] -&gt; List2 a
</span><a href="Agda.Utils.List2.html#List2"><span class="hs-identifier hs-var">List2</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr)
</span><a href="#local-6989586621682143969"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, FieldAssignment' Expr)
</span><a href="#local-6989586621682143970"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, FieldAssignment' Expr)]
</span><a href="#local-6989586621682143971"><span class="hs-identifier hs-var">zs</span></a></span><span>
</span><span id="line-1036"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682143949"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">catMaybes</span></span><span> </span><span class="annot"><a href="#local-6989586621682143951"><span class="hs-identifier hs-type">fs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="hs-comment">-- | @checkRecordExpression fs e t@ checks record construction against type @t@.</span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- Precondition @e = Rec _ fs@.</span><span>
</span><span id="line-1040"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkRecordExpression"><span class="hs-identifier hs-type">checkRecordExpression</span></a></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span>       </span><span class="hs-comment">-- ^ How do we related the inferred type of the record expression</span><span>
</span><span id="line-1042"></span><span>                      </span><span class="hs-comment">--   to the expected type?  Subtype or equal type?</span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecordAssigns"><span class="hs-identifier hs-type">A.RecordAssigns</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @mfs@: modules and field assignments.</span></span><span>
</span><span id="line-1044"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Must be @A.Rec _ mfs@.</span></span><span>
</span><span id="line-1045"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Expected type of record expression.</span></span><span>
</span><span id="line-1046"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConOrigin"><span class="hs-identifier hs-type">ConOrigin</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Is this a record expression or a @record where@ expression?</span></span><span>
</span><span id="line-1047"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Record value in internal syntax.</span></span><span>
</span><span id="line-1048"></span><span id="checkRecordExpression"><span class="annot"><span class="annottext">checkRecordExpression :: Comparison
-&gt; [Either (FieldAssignment' Expr) ModuleName]
-&gt; Expr
-&gt; Type
-&gt; ConOrigin
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordExpression"><span class="hs-identifier hs-var hs-var">checkRecordExpression</span></a></span></span><span> </span><span id="local-6989586621682143976"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143976"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682143977"><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682143977"><span class="hs-identifier hs-var">mfs</span></a></span></span><span> </span><span id="local-6989586621682143978"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621682143978"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Rec"><span class="hs-identifier hs-type">A.Rec</span></a></span><span> </span><span id="local-6989586621682143980"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682143980"><span class="hs-identifier hs-var">kwr</span></a></span></span><span> </span><span id="local-6989586621682143981"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682143981"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682143982"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143982"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682143983"><span class="annot"><span class="annottext">ConOrigin
</span><a href="#local-6989586621682143983"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1049"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.rec&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking record expression&quot;</span></span><span>
</span><span id="line-1051"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143978"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1052"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1053"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1054"></span><span>    </span><span id="local-6989586621682143985"><span class="annot"><span class="annottext">resume :: TCM Term
</span><a href="#local-6989586621682143985"><span class="hs-identifier hs-var hs-var">resume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem_"><span class="hs-identifier hs-var">postponeTypeCheckingProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143976"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143978"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143982"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1055"></span><span>    </span><span id="local-6989586621682143986"><span class="annot"><span class="annottext">fields :: [Name]
</span><a href="#local-6989586621682143986"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143987"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-type">FieldAssignment</span></a></span><span> </span><span id="local-6989586621682143987"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682143987"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682143977"><span class="hs-identifier hs-var">mfs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1056"></span><span>  </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term)
-&gt; TCM Term
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143982"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143988"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143988"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; Comparison -&gt; Expr -&gt; [Name] -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#guessRecordType"><span class="hs-identifier hs-var">guessRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682143985"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682143976"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682143978"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682143986"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143988"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><span class="annottext">((NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682143990"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143990"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1057"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143990"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1058"></span><span>    </span><span class="hs-comment">-- Case: We know the type of the record already.</span><span>
</span><span id="line-1059"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682143991"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682143991"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682143992"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682143992"><span class="hs-identifier hs-var">es</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1060"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682143993"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682143993"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682143992"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1061"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.rec&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  r   = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO Doc
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682143991"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>      </span><span id="local-6989586621682143996"><span class="annot"><a href="#local-6989586621682143996"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO RecordData
forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m, MonadError TCErr m) =&gt;
QName -&gt; m RecordData
</span><a href="Agda.TypeChecking.Records.html#getRecordDef"><span class="hs-identifier hs-var">getRecordDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682143991"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1064"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Field names (C.Name) with ArgInfo from record type definition.</span><span>
</span><span id="line-1065"></span><span>          </span><span id="local-6989586621682143998"><span class="annot"><a href="#local-6989586621682143998"><span class="hs-identifier hs-var hs-var">cxs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom Name -&gt; Arg Name) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Name -&gt; Arg Name
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom Name] -&gt; [Arg Name]) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var">recordFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682143996"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1066"></span><span>          </span><span class="hs-comment">-- Just field names.</span><span>
</span><span id="line-1067"></span><span>          </span><span id="local-6989586621682144001"><span class="annot"><a href="#local-6989586621682144001"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg Name -&gt; Name) -&gt; [Arg Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Name
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682143998"><span class="hs-identifier hs-var">cxs</span></a></span><span>
</span><span id="line-1068"></span><span>          </span><span class="hs-comment">-- Record constructor.</span><span>
</span><span id="line-1069"></span><span>          </span><span id="local-6989586621682144002"><span class="annot"><a href="#local-6989586621682144002"><span class="hs-identifier hs-var hs-var">con</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillRangeT ConHead
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">KillRangeT ConHead -&gt; KillRangeT ConHead
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#_recConHead"><span class="hs-identifier hs-var">_recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682143996"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1070"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.rec&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1071"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;  xs  = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-type">P.pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144001"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  ftel= &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_recTel"><span class="hs-identifier hs-var">_recTel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143996"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  con = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-type">P.pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144002"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>      </span><span class="hs-comment">-- Record expressions corresponding to erased record</span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-comment">-- constructors can only be used in compile-time mode.</span><span>
</span><span id="line-1078"></span><span>      </span><span id="local-6989586621682144005"><span class="annot"><a href="#local-6989586621682144005"><span class="hs-identifier hs-var">constructorQ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-type">getQuantity</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144002"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>      </span><span id="local-6989586621682144008"><span class="annot"><a href="#local-6989586621682144008"><span class="hs-identifier hs-var">currentQ</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eQuantity"><span class="hs-identifier hs-type">eQuantity</span></a></span><span>
</span><span id="line-1080"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144005"><span class="hs-identifier hs-type">constructorQ</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#moreQuantity"><span class="hs-operator hs-type">`moreQuantity`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144008"><span class="hs-identifier hs-type">currentQ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordIsErased"><span class="hs-identifier hs-type">RecordIsErased</span></a></span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-09-06, issue #3122.</span><span>
</span><span id="line-1083"></span><span>      </span><span class="hs-comment">-- Associate the concrete record field names used in the record expression</span><span>
</span><span id="line-1084"></span><span>      </span><span class="hs-comment">-- to their counterpart in the record type definition.</span><span>
</span><span id="line-1085"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#disambiguateRecordFields"><span class="hs-identifier hs-type">disambiguateRecordFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#_nameFieldA"><span class="hs-identifier hs-var">_nameFieldA</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lefts</span></span><span> </span><span class="annot"><a href="#local-6989586621682143977"><span class="hs-identifier hs-type">mfs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143996"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>      </span><span class="hs-comment">-- Compute the list of given fields, decorated with the ArgInfo from the record def.</span><span>
</span><span id="line-1088"></span><span>      </span><span class="hs-comment">-- Andreas, 2019-03-18, issue #3122, also pick up non-visible fields from the modules.</span><span>
</span><span id="line-1089"></span><span>      </span><span id="local-6989586621682144017"><span class="annot"><a href="#local-6989586621682144017"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#expandModuleAssigns"><span class="hs-identifier hs-type">expandModuleAssigns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143977"><span class="hs-identifier hs-type">mfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144001"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span>      </span><span class="hs-comment">-- Compute a list of metas for the missing visible fields.</span><span>
</span><span id="line-1092"></span><span>      </span><span id="local-6989586621682144018"><span class="annot"><a href="#local-6989586621682144018"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-type">getScope</span></a></span><span>
</span><span id="line-1093"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144020"><span class="annot"><a href="#local-6989586621682144020"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621682144021"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144021"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Underscore"><span class="hs-identifier hs-var">A.Underscore</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInfo -&gt; Expr) -&gt; MetaInfo -&gt; Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Range
-&gt; ScopeInfo -&gt; Maybe MetaId -&gt; ArgName -&gt; MetaKind -&gt; MetaInfo
</span><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-var">A.MetaInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KwRange -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682143980"><span class="hs-identifier hs-var">kwr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682144018"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetaId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144021"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetaKind
</span><a href="Agda.Syntax.Info.html#UnificationMeta"><span class="hs-identifier hs-var">A.UnificationMeta</span></a></span><span>
</span><span id="line-1094"></span><span>      </span><span class="hs-comment">-- In @es@ omitted explicit fields are replaced by underscores.</span><span>
</span><span id="line-1095"></span><span>      </span><span class="hs-comment">-- Omitted implicit or instance fields</span><span>
</span><span id="line-1096"></span><span>      </span><span class="hs-comment">-- are still left out and inserted later by checkArguments_.</span><span>
</span><span id="line-1097"></span><span>      </span><span id="local-6989586621682144024"><span class="annot"><a href="#local-6989586621682144024"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#insertMissingFieldsWarn"><span class="hs-identifier hs-type">insertMissingFieldsWarn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143983"><span class="hs-identifier hs-type">origin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143991"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144020"><span class="hs-identifier hs-type">meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144017"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143998"><span class="hs-identifier hs-type">cxs</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span>      </span><span id="local-6989586621682144026"><span class="annot"><a href="#local-6989586621682144026"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Application.html#checkArguments_"><span class="hs-identifier hs-type">checkArguments_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143976"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143978"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144024"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_recTel"><span class="hs-identifier hs-var">_recTel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143996"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-type">`apply`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143993"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1100"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682144029"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682144029"><span class="hs-identifier hs-var">elims</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144030"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682144030"><span class="hs-identifier hs-var">remainingTel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682144030"><span class="hs-identifier hs-var">remainingTel</span></a></span><span>
</span><span id="line-1101"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682144031"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144031"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682144029"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; TCMT IO [Arg Term]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144031"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1102"></span><span>        </span><span class="annot"><span class="annottext">(Elims, Telescope)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [Arg Term]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1103"></span><span>      </span><span class="hs-comment">-- Don't need to block here!</span><span>
</span><span id="line-1104"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.rec&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;finished record expression&quot;</span></span><span>
</span><span id="line-1105"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144002"><span class="hs-identifier hs-type">con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682143983"><span class="hs-identifier hs-type">origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144026"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBeRecordType"><span class="hs-identifier hs-var">ShouldBeRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682143990"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1107"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkRecordExpression"><span class="hs-identifier hs-var">checkRecordExpression</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#guessRecordType"><span class="hs-identifier hs-type">guessRecordType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1110"></span><span id="guessRecordType"><span class="annot"><span class="annottext">guessRecordType :: TCM Term -&gt; Comparison -&gt; Expr -&gt; [Name] -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#guessRecordType"><span class="hs-identifier hs-var hs-var">guessRecordType</span></a></span></span><span> </span><span id="local-6989586621682144034"><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144034"><span class="hs-identifier hs-var">resume</span></a></span></span><span> </span><span id="local-6989586621682144035"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144035"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144036"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144036"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682144037"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144037"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621682144038"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144038"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1111"></span><span>  </span><span id="local-6989586621682144039"><span class="annot"><a href="#local-6989586621682144039"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; TCM [QName]
</span><a href="Agda.TypeChecking.Records.html#findPossibleRecords"><span class="hs-identifier hs-var">findPossibleRecords</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144037"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1112"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.rec&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Possible records for&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144038"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;are&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-type">&lt;?&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144039"><span class="hs-identifier hs-type">rs</span></a></span><span>
</span><span id="line-1113"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682144039"><span class="hs-identifier hs-type">rs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1114"></span><span>      </span><span class="hs-comment">-- If there are no records with the right fields we might as well fail right away.</span><span>
</span><span id="line-1115"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NoKnownRecordWithSuchFields"><span class="hs-identifier hs-var">NoKnownRecordWithSuchFields</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144037"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1116"></span><span>      </span><span class="hs-comment">-- If there's only one record with the appropriate fields, go with that.</span><span>
</span><span id="line-1117"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621682144042"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144042"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1118"></span><span>      </span><span class="hs-comment">-- #5198: Don't generate metas for parameters of the current module. In most cases they</span><span>
</span><span id="line-1119"></span><span>      </span><span class="hs-comment">-- get solved, but not always.</span><span>
</span><span id="line-1120"></span><span>      </span><span id="local-6989586621682144043"><span class="annot"><a href="#local-6989586621682144043"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *).
(Functor m, HasConstInfo m, HasOptions m, ReadTCState m,
 MonadTCEnv m, MonadDebug m) =&gt;
Definition -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#instantiateDef"><span class="hs-identifier hs-var">instantiateDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Definition)
-&gt; TCMT IO Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144042"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1121"></span><span>      </span><span id="local-6989586621682144045"><span class="annot"><a href="#local-6989586621682144045"><span class="hs-identifier hs-var">ps</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#freeVarsToApply"><span class="hs-identifier hs-type">freeVarsToApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144042"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-1122"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144047"><span class="annot"><a href="#local-6989586621682144047"><span class="hs-identifier hs-var hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682144043"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1123"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.rec&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Type of unique record&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144047"><span class="hs-identifier hs-type">rt</span></a></span><span>
</span><span id="line-1124"></span><span>      </span><span id="local-6989586621682144049"><span class="annot"><a href="#local-6989586621682144049"><span class="hs-identifier hs-var">vs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#newArgsMeta"><span class="hs-identifier hs-type">newArgsMeta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144047"><span class="hs-identifier hs-type">rt</span></a></span><span>
</span><span id="line-1125"></span><span>      </span><span id="local-6989586621682144051"><span class="annot"><a href="#local-6989586621682144051"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#piApply"><span class="hs-identifier hs-type">piApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144047"><span class="hs-identifier hs-type">rt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144049"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-1126"></span><span>      </span><span id="local-6989586621682144053"><span class="annot"><a href="#local-6989586621682144053"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144051"><span class="hs-identifier hs-type">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1127"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621682144054"><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682144054"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; TCMT IO (Sort' Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682144054"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1128"></span><span>        </span><span id="local-6989586621682144055"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144055"><span class="hs-identifier hs-var">v</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1129"></span><span>          </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1130"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;The impossible happened when checking record expression against meta&quot;</span></span><span>
</span><span id="line-1131"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Candidate record type r = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144042"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1132"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Type of r               = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144047"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-1133"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Ends in (should be sort)= &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144055"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1134"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;  Raw                   =  &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144055"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1135"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1136"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO (Sort' Term)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144056"><span class="annot"><a href="#local-6989586621682144056"><span class="hs-identifier hs-var hs-var">inferred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682144053"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144042"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; [Arg Term] -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144045"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term] -&gt; [Arg Term] -&gt; [Arg Term]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144049"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>      </span><span id="local-6989586621682144057"><span class="annot"><a href="#local-6989586621682144057"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-type">checkExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144036"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144056"><span class="hs-identifier hs-type">inferred</span></a></span><span>
</span><span id="line-1139"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144035"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144057"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144056"><span class="hs-identifier hs-type">inferred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144038"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>      </span><span class="hs-comment">-- If there are more than one possible record we postpone</span><span>
</span><span id="line-1142"></span><span>    </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[QName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1143"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.expr.rec&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1144"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Postponing type checking of&quot;</span></span><span>
</span><span id="line-1145"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144036"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144038"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1146"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1147"></span><span>      </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144034"><span class="hs-identifier hs-var">resume</span></a></span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- | @checkRecordUpdate cmp ei recexpr fs e t@</span><span>
</span><span id="line-1150"></span><span class="hs-comment">--</span><span>
</span><span id="line-1151"></span><span class="hs-comment">-- Preconditions: @e = RecUpdate ei recexpr fs@ and @t@ is reduced.</span><span>
</span><span id="line-1152"></span><span class="hs-comment">--</span><span>
</span><span id="line-1153"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkRecordUpdate"><span class="hs-identifier hs-type">checkRecordUpdate</span></a></span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @cmp@</span></span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.KeywordRange.html#KwRange"><span class="hs-identifier hs-type">KwRange</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Range of the @record@ keyword.</span></span><span>
</span><span id="line-1156"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#ExprInfo"><span class="hs-identifier hs-type">A.ExprInfo</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @ei@</span></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ @recexpr@</span></span><span>
</span><span id="line-1158"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Assigns"><span class="hs-identifier hs-type">A.Assigns</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ @fs@</span></span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ @e = RecUpdate ei recexpr fs@</span></span><span>
</span><span id="line-1160"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Need not be reduced.</span></span><span>
</span><span id="line-1161"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1162"></span><span id="checkRecordUpdate"><span class="annot"><span class="annottext">checkRecordUpdate :: Comparison
-&gt; KwRange
-&gt; ExprInfo
-&gt; Expr
-&gt; Assigns
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordUpdate"><span class="hs-identifier hs-var hs-var">checkRecordUpdate</span></a></span></span><span> </span><span id="local-6989586621682144059"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144059"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144060"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144060"><span class="hs-identifier hs-var">kwr</span></a></span></span><span> </span><span id="local-6989586621682144061"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144061"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621682144062"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144062"><span class="hs-identifier hs-var">recexpr</span></a></span></span><span> </span><span id="local-6989586621682144063"><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144063"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682144064"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144064"><span class="hs-identifier hs-var">eupd</span></a></span></span><span> </span><span id="local-6989586621682144065"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144065"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1163"></span><span>  </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term)
-&gt; TCM Term
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144065"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144066"><span class="hs-identifier hs-var">tryInfer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144067"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144067"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1164"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO (Maybe (QName, [Arg Term], RecordData))
-&gt; TCM Term
-&gt; ((QName, [Arg Term], RecordData) -&gt; TCM Term)
-&gt; TCM Term
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe (QName, [Arg Term], RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, [Arg Term], RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var">isRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144067"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144069"><span class="hs-identifier hs-var">should</span></a></span><span> </span><span class="annot"><span class="annottext">(((QName, [Arg Term], RecordData) -&gt; TCM Term) -&gt; TCM Term)
-&gt; ((QName, [Arg Term], RecordData) -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144070"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144070"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144071"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144071"><span class="hs-identifier hs-var">_pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144072"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682144072"><span class="hs-identifier hs-var">defn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1165"></span><span>      </span><span class="hs-comment">-- Bind the record value (before update) to a fresh @name@.</span><span>
</span><span id="line-1166"></span><span>      </span><span id="local-6989586621682144073"><span class="annot"><a href="#local-6989586621682144073"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144059"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144062"><span class="hs-identifier hs-var">recexpr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144067"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1167"></span><span>      </span><span id="local-6989586621682144074"><span class="annot"><a href="#local-6989586621682144074"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#freshNoName"><span class="hs-identifier hs-type">freshNoName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144062"><span class="hs-identifier hs-type">recexpr</span></a></span><span>
</span><span id="line-1168"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding"><span class="hs-identifier hs-type">addLetBinding</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-type">defaultArgInfo</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-type">Inserted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144074"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144073"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144067"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144077"><span class="annot"><a href="#local-6989586621682144077"><span class="hs-identifier hs-var hs-var">projs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom QName -&gt; Arg QName) -&gt; [Dom QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom QName] -&gt; [Arg QName]) -&gt; [Dom QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682144072"><span class="hs-identifier hs-var">defn</span></a></span><span>
</span><span id="line-1171"></span><span>
</span><span id="line-1172"></span><span>        </span><span class="hs-comment">-- Andreas, 2018-09-06, issue #3122.</span><span>
</span><span id="line-1173"></span><span>        </span><span class="hs-comment">-- Associate the concrete record field names used in the record expression</span><span>
</span><span id="line-1174"></span><span>        </span><span class="hs-comment">-- to their counterpart in the record type definition.</span><span>
</span><span id="line-1175"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#disambiguateRecordFields"><span class="hs-identifier hs-type">disambiguateRecordFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#_nameFieldA"><span class="hs-identifier hs-var">_nameFieldA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144063"><span class="hs-identifier hs-type">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144077"><span class="hs-identifier hs-type">projs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span>        </span><span class="hs-comment">-- Desugar record update expression into record expression.</span><span>
</span><span id="line-1178"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144078"><span class="annot"><a href="#local-6989586621682144078"><span class="hs-identifier hs-var hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldAssignment' Expr -&gt; (Name, Maybe Expr))
-&gt; Assigns -&gt; [(Name, Maybe Expr)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-type">FieldAssignment</span></a></span><span> </span><span id="local-6989586621682144079"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144079"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682144080"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144080"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144079"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144080"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144063"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1179"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144081"><span class="annot"><a href="#local-6989586621682144081"><span class="hs-identifier hs-var hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom Name -&gt; Arg Name) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Name -&gt; Arg Name
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom Name] -&gt; [Arg Name]) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var">recordFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682144072"><span class="hs-identifier hs-var">defn</span></a></span><span>
</span><span id="line-1180"></span><span>        </span><span id="local-6989586621682144082"><span class="annot"><a href="#local-6989586621682144082"><span class="hs-identifier hs-var">es</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#orderFieldsWarn"><span class="hs-identifier hs-type">orderFieldsWarn</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-type">ConORec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144070"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144081"><span class="hs-identifier hs-type">axs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144078"><span class="hs-identifier hs-type">fs'</span></a></span><span>
</span><span id="line-1181"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144085"><span class="annot"><a href="#local-6989586621682144085"><span class="hs-identifier hs-var hs-var">es'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; Maybe Expr -&gt; Maybe Expr)
-&gt; [Arg QName] -&gt; [Maybe Expr] -&gt; [Maybe Expr]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ExprInfo -&gt; Arg QName -&gt; Maybe Expr -&gt; Maybe Expr
</span><a href="#local-6989586621682144087"><span class="hs-identifier hs-var">replaceFields</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144074"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144061"><span class="hs-identifier hs-var">ei</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682144077"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Expr]
</span><a href="#local-6989586621682144082"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1182"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144088"><span class="annot"><a href="#local-6989586621682144088"><span class="hs-identifier hs-var hs-var">erec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KwRange
-&gt; ExprInfo -&gt; [Either (FieldAssignment' Expr) ModuleName] -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Rec"><span class="hs-identifier hs-var">A.Rec</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144060"><span class="hs-identifier hs-var">kwr</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144061"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldAssignment' Expr -&gt; Either (FieldAssignment' Expr) ModuleName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Expr -&gt; FieldAssignment' Expr
forall a. Name -&gt; a -&gt; FieldAssignment' a
</span><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-var">FieldAssignment</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144089"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144090"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144089"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144089"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682144090"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144090"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Arg Name] -&gt; [Maybe Expr] -&gt; [(Arg Name, Maybe Expr)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682144081"><span class="hs-identifier hs-var">axs</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Expr]
</span><a href="#local-6989586621682144085"><span class="hs-identifier hs-var">es'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1183"></span><span>        </span><span class="hs-comment">-- Call the type checker on the desugared syntax.</span><span>
</span><span id="line-1184"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-type">checkExpr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144059"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144088"><span class="hs-identifier hs-type">erec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144065"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1185"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1186"></span><span>    </span><span class="annot"><a href="#local-6989586621682144087"><span class="hs-identifier hs-type">replaceFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#ExprInfo"><span class="hs-identifier hs-type">A.ExprInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>
</span><span id="line-1187"></span><span>    </span><span id="local-6989586621682144087"><span class="annot"><span class="annottext">replaceFields :: Name -&gt; ExprInfo -&gt; Arg QName -&gt; Maybe Expr -&gt; Maybe Expr
</span><a href="#local-6989586621682144087"><span class="hs-identifier hs-var hs-var">replaceFields</span></a></span></span><span> </span><span id="local-6989586621682144091"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144091"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682144092"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144092"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682144093"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144093"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682144094"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144094"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144093"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Maybe Expr) -&gt; Expr -&gt; Maybe Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1188"></span><span>      </span><span class="hs-comment">-- omitted visible fields remain unchanged: @{ ...; p = p name; ...}@</span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-comment">-- (hidden fields are supposed to be inferred)</span><span>
</span><span id="line-1190"></span><span>      </span><span class="annot"><span class="annottext">AppInfo -&gt; Expr -&gt; NamedArg Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#App"><span class="hs-identifier hs-var">A.App</span></a></span><span>
</span><span id="line-1191"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; AppInfo
</span><a href="Agda.Syntax.Info.html#defaultAppInfo"><span class="hs-identifier hs-var">A.defaultAppInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; AppInfo) -&gt; Range -&gt; AppInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExprInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144092"><span class="hs-identifier hs-var">ei</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjOrigin -&gt; AmbiguousQName -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Proj"><span class="hs-identifier hs-var">A.Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">(AmbiguousQName -&gt; Expr) -&gt; AmbiguousQName -&gt; Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; AmbiguousQName
</span><a href="Agda.Syntax.Abstract.Name.html#unambiguous"><span class="hs-identifier hs-var">unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144094"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; NamedArg Expr
forall a. a -&gt; NamedArg a
</span><a href="Agda.Syntax.Common.html#defaultNamedArg"><span class="hs-identifier hs-var">defaultNamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; NamedArg Expr) -&gt; Expr -&gt; NamedArg Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Var"><span class="hs-identifier hs-var">A.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144091"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>    </span><span class="annot"><a href="#local-6989586621682144087"><span class="hs-identifier hs-var">replaceFields</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Arg QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144100"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682144100"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682144100"><span class="hs-identifier hs-var">me</span></a></span><span>  </span><span class="hs-comment">-- other fields get the user-written updates</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span>    </span><span id="local-6989586621682144066"><span class="annot"><span class="annottext">tryInfer :: TCM Term
</span><a href="#local-6989586621682144066"><span class="hs-identifier hs-var hs-var">tryInfer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1197"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144101"><span class="annot"><a href="#local-6989586621682144101"><span class="hs-identifier hs-var">trec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-var">inferExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144062"><span class="hs-identifier hs-var">recexpr</span></a></span><span>
</span><span id="line-1198"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-type">ifBlocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144101"><span class="hs-identifier hs-type">trec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144103"><span class="hs-identifier hs-var">postpone</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1199"></span><span>        </span><span id="local-6989586621682144104"><span class="annot"><a href="#local-6989586621682144104"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144059"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144064"><span class="hs-identifier hs-var">eupd</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144101"><span class="hs-identifier hs-var">trec</span></a></span><span>
</span><span id="line-1200"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144059"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144104"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144101"><span class="hs-identifier hs-type">trec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144065"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>    </span><span id="local-6989586621682144103"><span class="annot"><span class="annottext">postpone :: TCM Term
</span><a href="#local-6989586621682144103"><span class="hs-identifier hs-var hs-var">postpone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem_"><span class="hs-identifier hs-var">postponeTypeCheckingProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144059"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144064"><span class="hs-identifier hs-var">eupd</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144065"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1203"></span><span>    </span><span id="local-6989586621682144069"><span class="annot"><span class="annottext">should :: TCM Term
</span><a href="#local-6989586621682144069"><span class="hs-identifier hs-var hs-var">should</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBeRecordType"><span class="hs-identifier hs-var">ShouldBeRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144065"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- | Check a @record where@ expression, pushing information about the</span><span>
</span><span id="line-1206"></span><span class="hs-comment">-- type of the fields obtained from the context into the @let@-bindings.</span><span>
</span><span id="line-1207"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkRecordWhere"><span class="hs-identifier hs-type">checkRecordWhere</span></a></span><span>
</span><span id="line-1208"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span>
</span><span id="line-1209"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.KeywordRange.html#KwRange"><span class="hs-identifier hs-type">KwRange</span></a></span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#ExprInfo"><span class="hs-identifier hs-type">A.ExprInfo</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ @ei@</span></span><span>
</span><span id="line-1211"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ are we updating?</span></span><span>
</span><span id="line-1212"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ @ds@</span></span><span>
</span><span id="line-1213"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Assigns"><span class="hs-identifier hs-type">A.Assigns</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ @as@</span></span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ the overall expression (for resumption)</span></span><span>
</span><span id="line-1215"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1216"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span class="hs-comment">{-
The key problem with simply checking the let bindings and then
checking a made-up record literal is implicit insertion. Consider:

  record X : Set&#8321; where
    field
      it : {A : Set} &#8594; A &#8594; A
  _ = record where it x = x

Here we would first check `(&#955; x &#8594; x) : _0`, inventing a fresh meta
for the type of `it`-qua-let-binding, solving `_0 := _1 &#8594; _1`
because of the lambda, and then falling over when trying to unify
`_1 &#8594; _1 =? &#8704; {A} &#8594; A &#8594; A`. Indeed we also can not simply

  _ = record where it : _0 ; it = ?

since checking the record expression would produce something like
record { it = &#955; {x} &#8594; ?0 }, where 'checkArgumentsE' has &quot;helpfully&quot;
inserted implicit binders for the argument, and `x` is obviously not
in scope in `_0`. But if we tell 'tryInsertHiddenLambda' to take a
hike, we *can* learn the actual type of the record field by putting
a meta there!

So the strategy for pushing type information into the bindings is
the following:

  * For every field-defining LetBind, replace its body with a meta;
    and set aside the actual expression to check later.

  * Check the synthesised record{} expression, but under
    reallyDontExpandLast.
    If the *types* of field bindings were previously bare metas,
    they will now be solved to the types of corresponding fields,
    even if these have implicit arguments.

  * Go back and actually check all the expressions we set aside at the
    start, solving the metas that we invented.
-}</span><span>
</span><span id="line-1256"></span><span id="checkRecordWhere"><span class="annot"><span class="annottext">checkRecordWhere :: Comparison
-&gt; KwRange
-&gt; ExprInfo
-&gt; Maybe Expr
-&gt; [LetBinding]
-&gt; Assigns
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordWhere"><span class="hs-identifier hs-var hs-var">checkRecordWhere</span></a></span></span><span> </span><span id="local-6989586621682144106"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144106"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144107"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144107"><span class="hs-identifier hs-var">kwr</span></a></span></span><span> </span><span id="local-6989586621682144108"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144108"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621682144109"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682144109"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span id="local-6989586621682144110"><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144110"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span id="local-6989586621682144111"><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144111"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682144112"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144112"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682144113"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144113"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1257"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1258"></span><span>    </span><span id="local-6989586621682144114"><span class="annot"><span class="annottext">fnames :: [Name]
</span><a href="#local-6989586621682144114"><span class="hs-identifier hs-var hs-var">fnames</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144115"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-type">FieldAssignment</span></a></span><span> </span><span id="local-6989586621682144115"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144115"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144111"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1259"></span><span>
</span><span id="line-1260"></span><span>    </span><span id="local-6989586621682144116"><span class="annot"><span class="annottext">postpone :: TCM Term
</span><a href="#local-6989586621682144116"><span class="hs-identifier hs-var hs-var">postpone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem_"><span class="hs-identifier hs-var">postponeTypeCheckingProblem_</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeCheckingProblem -&gt; TCM Term)
-&gt; TypeCheckingProblem -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144106"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144112"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144113"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1261"></span><span>    </span><span id="local-6989586621682144117"><span class="annot"><span class="annottext">tryinfer :: TCM Term
</span><a href="#local-6989586621682144117"><span class="hs-identifier hs-var hs-var">tryinfer</span></a></span></span><span>
</span><span id="line-1262"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682144118"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144118"><span class="hs-identifier hs-var">e0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682144109"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1263"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144119"><span class="annot"><a href="#local-6989586621682144119"><span class="hs-identifier hs-var">trec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-var">inferExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144118"><span class="hs-identifier hs-var">e0</span></a></span><span>
</span><span id="line-1264"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-type">ifBlocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144119"><span class="hs-identifier hs-type">trec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144116"><span class="hs-identifier hs-var">postpone</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1265"></span><span>          </span><span id="local-6989586621682144120"><span class="annot"><a href="#local-6989586621682144120"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144106"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144112"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144119"><span class="hs-identifier hs-var">trec</span></a></span><span>
</span><span id="line-1266"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144106"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144120"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144119"><span class="hs-identifier hs-type">trec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144113"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1267"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144116"><span class="hs-identifier hs-var">postpone</span></a></span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span>    </span><span id="local-6989586621682144121"><span class="annot"><span class="annottext">findtype :: ((QName, [Arg Term], RecordData) -&gt; TCM Term) -&gt; TCM Term
</span><a href="#local-6989586621682144121"><span class="hs-identifier hs-var hs-var">findtype</span></a></span></span><span> </span><span id="local-6989586621682144122"><span class="annot"><span class="annottext">(QName, [Arg Term], RecordData) -&gt; TCM Term
</span><a href="#local-6989586621682144122"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker -&gt; Type -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Type -&gt; TCM Term)
-&gt; TCM Term
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144113"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144123"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144123"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; Comparison -&gt; Expr -&gt; [Name] -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#guessRecordType"><span class="hs-identifier hs-var">guessRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144117"><span class="hs-identifier hs-var">tryinfer</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144106"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144112"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144114"><span class="hs-identifier hs-var">fnames</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144123"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144124"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144124"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1270"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO (Maybe (QName, [Arg Term], RecordData))
-&gt; TCM Term
-&gt; ((QName, [Arg Term], RecordData) -&gt; TCM Term)
-&gt; TCM Term
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Maybe (QName, [Arg Term], RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Maybe (QName, [Arg Term], RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordType"><span class="hs-identifier hs-var">isRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144124"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBeRecordType"><span class="hs-identifier hs-var">ShouldBeRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144124"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName, [Arg Term], RecordData) -&gt; TCM Term
</span><a href="#local-6989586621682144122"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-1271"></span><span>
</span><span id="line-1272"></span><span>  </span><span class="annot"><span class="annottext">((QName, [Arg Term], RecordData) -&gt; TCM Term) -&gt; TCM Term
</span><a href="#local-6989586621682144121"><span class="hs-identifier hs-var">findtype</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144125"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144125"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144126"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144126"><span class="hs-identifier hs-var">_pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144127"><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682144127"><span class="hs-identifier hs-var">defn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1273"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1274"></span><span>      </span><span id="local-6989586621682144128"><span class="annot"><span class="annottext">ei :: ExprInfo
</span><a href="#local-6989586621682144128"><span class="hs-identifier hs-var hs-var hs-var">ei</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; ExprInfo
</span><a href="Agda.Syntax.Info.html#ExprRange"><span class="hs-identifier hs-var">A.ExprRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144112"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>      </span><span id="local-6989586621682144130"><span class="annot"><span class="annottext">cxs :: [Name]
</span><a href="#local-6989586621682144130"><span class="hs-identifier hs-var hs-var hs-var">cxs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom Name -&gt; Name) -&gt; [Dom Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Name -&gt; Name
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom Name] -&gt; [Name]) -&gt; [Dom Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var">recordFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682144127"><span class="hs-identifier hs-var">defn</span></a></span><span>
</span><span id="line-1276"></span><span>      </span><span id="local-6989586621682144131"><span class="annot"><span class="annottext">recfs :: Map Name Int
</span><a href="#local-6989586621682144131"><span class="hs-identifier hs-var hs-var hs-var">recfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Int)] -&gt; Map Name Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Name, Int)] -&gt; Map Name Int) -&gt; [(Name, Int)] -&gt; Map Name Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Int] -&gt; [(Name, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144130"><span class="hs-identifier hs-var">cxs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1277"></span><span>      </span><span id="local-6989586621682144133"><span class="annot"><span class="annottext">names :: Map Name (Int, Name)
</span><a href="#local-6989586621682144133"><span class="hs-identifier hs-var hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, (Int, Name))] -&gt; Map Name (Int, Name)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-1278"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144134"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144135"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144136"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1279"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-type">FieldAssignment</span></a></span><span> </span><span id="local-6989586621682144136"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144136"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Var"><span class="hs-identifier hs-type">A.Var</span></a></span><span> </span><span id="local-6989586621682144134"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144134"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144111"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1280"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682144135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144135"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; [Maybe Int]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Map Name Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144136"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Int
</span><a href="#local-6989586621682144131"><span class="hs-identifier hs-var">recfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1281"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1282"></span><span>
</span><span id="line-1283"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.record.where&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1284"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking `record where` at type&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144113"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1285"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;bound fields:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (Int, Name) -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (Int, Name)
</span><a href="#local-6989586621682144133"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1286"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1289"></span><span>      </span><span id="local-6989586621682140949"><span class="annot"><a href="#local-6989586621682144137"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140949"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140949"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1290"></span><span>      </span><span id="local-6989586621682144137"><span class="annot"><span class="annottext">check :: forall a.
[LetBinding]
-&gt; (IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
    -&gt; TCM a)
-&gt; TCM a
</span><a href="#local-6989586621682144137"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144169"><span class="annot"><span class="annottext">b :: LetBinding
</span><a href="#local-6989586621682144169"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBind"><span class="hs-identifier hs-type">A.LetBind</span></a></span><span> </span><span id="local-6989586621682144171"><span class="annot"><span class="annottext">LetInfo
</span><a href="#local-6989586621682144171"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144172"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144172"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144173"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682144173"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682144174"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144174"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682144175"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144175"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682144176"><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144176"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144177"><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term) -&gt; TCM a
</span><a href="#local-6989586621682144177"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144178"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144178"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144179"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144179"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name (Int, Name) -&gt; Maybe (Int, Name)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682144173"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name (Int, Name)
</span><a href="#local-6989586621682144133"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1291"></span><span>
</span><span id="line-1292"></span><span>        </span><span class="hs-comment">-- We create the meta with the actual type of the binding, to</span><span>
</span><span id="line-1293"></span><span>        </span><span class="hs-comment">-- make sure that e.g. the user can choose to write a more</span><span>
</span><span id="line-1294"></span><span>        </span><span class="hs-comment">-- general signature than the record type demands.</span><span>
</span><span id="line-1295"></span><span>        </span><span id="local-6989586621682144180"><span class="annot"><a href="#local-6989586621682144180"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144174"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1296"></span><span>
</span><span id="line-1297"></span><span>        </span><span class="hs-comment">-- One minor quibble is that we should remember what let</span><span>
</span><span id="line-1298"></span><span>        </span><span class="hs-comment">-- bindings are actually in the context when the binding is</span><span>
</span><span id="line-1299"></span><span>        </span><span class="hs-comment">-- processed, and use *those*, rather than the full set of</span><span>
</span><span id="line-1300"></span><span>        </span><span class="hs-comment">-- `let`-bindings that would otherwise be available.</span><span>
</span><span id="line-1301"></span><span>        </span><span id="local-6989586621682144181"><span class="annot"><a href="#local-6989586621682144181"><span class="hs-identifier hs-var">lets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.keysSet</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envLetBindings"><span class="hs-identifier hs-var">envLetBindings</span></a></span><span>
</span><span id="line-1302"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1303"></span><span>          </span><span id="local-6989586621682144184"><span class="annot"><a href="#local-6989586621682144184"><span class="hs-identifier hs-var hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv (Map Name (Open LetBinding))
-&gt; (Map Name (Open LetBinding) -&gt; Map Name (Open LetBinding))
-&gt; TCM Term
-&gt; TCM Term
forall (m :: * -&gt; *) a b.
MonadTCEnv m =&gt;
Lens' TCEnv a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-var">locallyTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (Open LetBinding) -&gt; f (Map Name (Open LetBinding)))
-&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv (Map Name (Open LetBinding))
</span><a href="Agda.TypeChecking.Monad.Base.html#eLetBindings"><span class="hs-identifier hs-var">eLetBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name (Open LetBinding)
-&gt; Set Name -&gt; Map Name (Open LetBinding)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.restrictKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621682144181"><span class="hs-identifier hs-var">lets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>          </span><span class="hs-comment">-- Unlike 'checkLetBinding' which sometimes needs to</span><span>
</span><span id="line-1305"></span><span>          </span><span class="hs-comment">-- checkDontExpandLast, here we should always.</span><span>
</span><span id="line-1306"></span><span>          </span><span id="local-6989586621682144189"><span class="annot"><a href="#local-6989586621682144189"><span class="hs-identifier hs-var hs-var">checkit</span></a></span></span><span> </span><span id="local-6989586621682144190"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144190"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
</span><a href="#local-6989586621682144184"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCM Term -&gt; TCM Term
forall (tcm :: * -&gt; *) m a.
(MonadTCEnv tcm, LensModality m) =&gt;
m -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-var">applyModalityToContext</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144172"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144175"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144190"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1307"></span><span>
</span><span id="line-1308"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682144192"><span class="annot"><a href="#local-6989586621682144192"><span class="hs-identifier hs-var">mv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144193"><span class="annot"><a href="#local-6989586621682144193"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-type">applyModalityToContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144172"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#newValueMeta"><span class="hs-identifier hs-type">newValueMeta</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RunMetaOccursCheck"><span class="hs-identifier hs-type">RunMetaOccursCheck</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpEq"><span class="hs-identifier hs-type">CmpEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144180"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.record.where&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;deferring field&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144173"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144180"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span>        </span><span class="hs-comment">-- Then just add the let binding with the value set to a meta.</span><span>
</span><span id="line-1313"></span><span>        </span><span class="annot"><a href="#local-6989586621682144181"><span class="hs-identifier hs-type">lets</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding"><span class="hs-identifier hs-type">addLetBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144172"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#UserWritten"><span class="hs-identifier hs-type">UserWritten</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144173"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144193"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144180"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682144137"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144176"><span class="hs-identifier hs-type">bs</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682144197"><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
</span><a href="#local-6989586621682144197"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1314"></span><span>          </span><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term) -&gt; TCM a
</span><a href="#local-6989586621682144177"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
-&gt; IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
-&gt; IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144178"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682144173"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144192"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144193"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144175"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Term
</span><a href="#local-6989586621682144189"><span class="hs-identifier hs-var">checkit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
</span><a href="#local-6989586621682144197"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1315"></span><span>
</span><span id="line-1316"></span><span>      </span><span class="hs-comment">-- For any other bindings we can check them on the spot (so the</span><span>
</span><span id="line-1317"></span><span>      </span><span class="hs-comment">-- hardest parts of 'checkLetBinding' don't need to be</span><span>
</span><span id="line-1318"></span><span>      </span><span class="hs-comment">-- duplicated.)</span><span>
</span><span id="line-1319"></span><span>      </span><span class="annot"><a href="#local-6989586621682144137"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144199"><span class="annot"><span class="annottext">LetBinding
</span><a href="#local-6989586621682144199"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682144200"><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144200"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144201"><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term) -&gt; TCM a
</span><a href="#local-6989586621682144201"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetBinding -&gt; TCM a -&gt; TCM a
forall a. LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding"><span class="hs-identifier hs-var">checkLetBinding</span></a></span><span> </span><span class="annot"><span class="annottext">LetBinding
</span><a href="#local-6989586621682144199"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LetBinding]
-&gt; (IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
    -&gt; TCM a)
-&gt; TCM a
forall a.
[LetBinding]
-&gt; (IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
    -&gt; TCM a)
-&gt; TCM a
</span><a href="#local-6989586621682144137"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144200"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term) -&gt; TCM a
</span><a href="#local-6989586621682144201"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-1320"></span><span>      </span><span class="annot"><a href="#local-6989586621682144137"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682144203"><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term) -&gt; TCM a
</span><a href="#local-6989586621682144203"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term) -&gt; TCM a
</span><a href="#local-6989586621682144203"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1321"></span><span>
</span><span id="line-1322"></span><span>      </span><span class="hs-comment">-- Compute the actual synthesised field assignments we'll be</span><span>
</span><span id="line-1323"></span><span>      </span><span class="hs-comment">-- using, handling record updates along the way. If there's no</span><span>
</span><span id="line-1324"></span><span>      </span><span class="hs-comment">-- update, then the fields are just the ones that the user wrote;</span><span>
</span><span id="line-1325"></span><span>      </span><span id="local-6989586621682144204"><span class="annot"><span class="annottext">checkUpdate :: ([Either (FieldAssignment' Expr) ModuleName] -&gt; TCM Term)
-&gt; TCM Term
</span><a href="#local-6989586621682144204"><span class="hs-identifier hs-var hs-var">checkUpdate</span></a></span></span><span> </span><span id="local-6989586621682144205"><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName] -&gt; TCM Term
</span><a href="#local-6989586621682144205"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682144109"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1326"></span><span>        </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName] -&gt; TCM Term
</span><a href="#local-6989586621682144205"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldAssignment' Expr
 -&gt; Either (FieldAssignment' Expr) ModuleName)
-&gt; Assigns -&gt; [Either (FieldAssignment' Expr) ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldAssignment' Expr -&gt; Either (FieldAssignment' Expr) ModuleName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144111"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1327"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682144206"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144206"><span class="hs-identifier hs-var">exp0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1328"></span><span>          </span><span class="hs-comment">-- Otherwise, we check the original record value against the</span><span>
</span><span id="line-1329"></span><span>          </span><span class="hs-comment">-- expected type, and use it to fill in any field assignments</span><span>
</span><span id="line-1330"></span><span>          </span><span class="hs-comment">-- that were not given by the user.</span><span>
</span><span id="line-1331"></span><span>          </span><span id="local-6989586621682144207"><span class="annot"><a href="#local-6989586621682144207"><span class="hs-identifier hs-var">v</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144106"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144206"><span class="hs-identifier hs-var">exp0</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144113"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1332"></span><span>          </span><span id="local-6989586621682144208"><span class="annot"><a href="#local-6989586621682144208"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#freshNoName"><span class="hs-identifier hs-type">freshNoName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144206"><span class="hs-identifier hs-type">exp0</span></a></span><span>
</span><span id="line-1333"></span><span>
</span><span id="line-1334"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-1335"></span><span>            </span><span id="local-6989586621682144209"><span class="annot"><a href="#local-6989586621682144209"><span class="hs-identifier hs-var hs-var">here_keys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144114"><span class="hs-identifier hs-var">fnames</span></a></span><span>
</span><span id="line-1336"></span><span>            </span><span id="local-6989586621682144211"><span class="annot"><a href="#local-6989586621682144211"><span class="hs-identifier hs-var hs-var">proj</span></a></span></span><span> </span><span id="local-6989586621682144212"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144212"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppInfo -&gt; Expr -&gt; NamedArg Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#App"><span class="hs-identifier hs-var">A.App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; AppInfo
</span><a href="Agda.Syntax.Info.html#defaultAppInfo"><span class="hs-identifier hs-var">A.defaultAppInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; AppInfo) -&gt; Range -&gt; AppInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExprInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144128"><span class="hs-identifier hs-var">ei</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjOrigin -&gt; AmbiguousQName -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Proj"><span class="hs-identifier hs-var">A.Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">(AmbiguousQName -&gt; Expr) -&gt; AmbiguousQName -&gt; Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; AmbiguousQName
</span><a href="Agda.Syntax.Abstract.Name.html#unambiguous"><span class="hs-identifier hs-var">unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144212"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; NamedArg Expr
forall a. a -&gt; NamedArg a
</span><a href="Agda.Syntax.Common.html#defaultNamedArg"><span class="hs-identifier hs-var">defaultNamedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Var"><span class="hs-identifier hs-var">A.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144208"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1337"></span><span>            </span><span id="local-6989586621682144213"><span class="annot"><a href="#local-6989586621682144213"><span class="hs-identifier hs-var hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1338"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldAssignment' Expr -&gt; Either (FieldAssignment' Expr) ModuleName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Expr -&gt; FieldAssignment' Expr
forall a. Name -&gt; a -&gt; FieldAssignment' a
</span><a href="Agda.Syntax.Concrete.html#FieldAssignment"><span class="hs-identifier hs-var">FieldAssignment</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144214"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Expr
</span><a href="#local-6989586621682144211"><span class="hs-identifier hs-var">proj</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144215"><span class="hs-identifier hs-var">pname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144214"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144214"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682144215"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144215"><span class="hs-identifier hs-var">pname</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Dom QName] -&gt; [(Name, Dom QName)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682144130"><span class="hs-identifier hs-var">cxs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecordData -&gt; [Dom QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682144127"><span class="hs-identifier hs-var">defn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682144214"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621682144209"><span class="hs-identifier hs-var">here_keys</span></a></span><span>
</span><span id="line-1341"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1342"></span><span>
</span><span id="line-1343"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding"><span class="hs-identifier hs-type">addLetBinding</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-type">defaultArgInfo</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-type">Inserted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144208"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144207"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144113"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682144205"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144213"><span class="hs-identifier hs-type">fs'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><a href="#local-6989586621682144111"><span class="hs-identifier hs-type">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span>
</span><span id="line-1345"></span><span>    </span><span class="annot"><span class="annottext">[LetBinding]
-&gt; (IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
    -&gt; TCM Term)
-&gt; TCM Term
forall a.
[LetBinding]
-&gt; (IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
    -&gt; TCM a)
-&gt; TCM a
</span><a href="#local-6989586621682144137"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144110"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682144217"><span class="annot"><span class="annottext">IntMap (BindName, MetaId, Term, Expr, Type -&gt; TCM Term)
</span><a href="#local-6989586621682144217"><span class="hs-identifier hs-var">later</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Either (FieldAssignment' Expr) ModuleName] -&gt; TCM Term)
-&gt; TCM Term
</span><a href="#local-6989586621682144204"><span class="hs-identifier hs-var">checkUpdate</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682144218"><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682144218"><span class="hs-identifier hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1346"></span><span>      </span><span class="hs-comment">-- Check the synthesised record expression, but make sure that</span><span>
</span><span id="line-1347"></span><span>      </span><span class="hs-comment">-- checkArguments won't try to do implicit insertion on us.</span><span>
</span><span id="line-1348"></span><span>      </span><span id="local-6989586621682144219"><span class="annot"><a href="#local-6989586621682144219"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Env.html#reallyDontExpandLast"><span class="hs-identifier hs-var">reallyDontExpandLast</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1349"></span><span>        </span><span class="annot"><span class="annottext">Comparison
-&gt; [Either (FieldAssignment' Expr) ModuleName]
-&gt; Expr
-&gt; Type
-&gt; ConOrigin
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordExpression"><span class="hs-identifier hs-var">checkRecordExpression</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144106"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682144218"><span class="hs-identifier hs-var">fs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KwRange
-&gt; ExprInfo -&gt; [Either (FieldAssignment' Expr) ModuleName] -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Rec"><span class="hs-identifier hs-var">A.Rec</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144107"><span class="hs-identifier hs-var">kwr</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144128"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682144218"><span class="hs-identifier hs-var">fs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144113"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConORecWhere"><span class="hs-identifier hs-var">ConORecWhere</span></a></span><span>
</span><span id="line-1350"></span><span>
</span><span id="line-1351"></span><span>      </span><span class="hs-comment">-- Then we can go back and check the bindings. (The name and</span><span>
</span><span id="line-1352"></span><span>      </span><span class="hs-comment">-- expression are just for debug printing.)</span><span>
</span><span id="line-1353"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap.toAscList</span></span><span> </span><span class="annot"><a href="#local-6989586621682144217"><span class="hs-identifier hs-type">later</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144224"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682144224"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144225"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144225"><span class="hs-identifier hs-var">mid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144226"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144226"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144227"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144227"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144228"><span class="annot"><span class="annottext">Type -&gt; TCM Term
</span><a href="#local-6989586621682144228"><span class="hs-identifier hs-var">check</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1354"></span><span>        </span><span id="local-6989586621682144229"><span class="annot"><a href="#local-6989586621682144229"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Type
forall (m :: * -&gt; *).
(HasBuiltins m, HasCallStack, MonadDebug m, MonadReduce m,
 MonadTCEnv m, ReadTCState m) =&gt;
MetaId -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaTypeInContext"><span class="hs-identifier hs-var">getMetaTypeInContext</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144225"><span class="hs-identifier hs-var">mid</span></a></span><span>
</span><span id="line-1355"></span><span>
</span><span id="line-1356"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.record.where&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1357"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;checking deferred `record where` binding for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144224"><span class="hs-identifier hs-type">fname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-1358"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1359"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144226"><span class="hs-identifier hs-type">meta</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144229"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-1360"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144226"><span class="hs-identifier hs-type">meta</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144227"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span>        </span><span id="local-6989586621682144231"><span class="annot"><a href="#local-6989586621682144231"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682144228"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144229"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-1363"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144229"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144226"><span class="hs-identifier hs-type">meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144231"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1364"></span><span>
</span><span id="line-1365"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682144219"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1368"></span><span class="annot"><span class="hs-comment">-- * Literal</span></span><span>
</span><span id="line-1369"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLiteral"><span class="hs-identifier hs-type">checkLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1372"></span><span id="checkLiteral"><span class="annot"><span class="annottext">checkLiteral :: Literal -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLiteral"><span class="hs-identifier hs-var hs-var">checkLiteral</span></a></span></span><span> </span><span id="local-6989586621682144233"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682144233"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span id="local-6989586621682144234"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144234"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1373"></span><span>  </span><span id="local-6989586621682144235"><span class="annot"><a href="#local-6989586621682144235"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; TCM Type
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
Literal -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.Builtin.html#litType"><span class="hs-identifier hs-var">litType</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682144233"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1374"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpEq"><span class="hs-identifier hs-type">CmpEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144233"><span class="hs-identifier hs-type">lit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144235"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144234"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1375"></span><span>
</span><span id="line-1376"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1377"></span><span class="annot"><span class="hs-comment">-- * Terms</span></span><span>
</span><span id="line-1378"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span class="hs-comment">-- | Remove top layers of scope info of expression and set the scope accordingly</span><span>
</span><span id="line-1381"></span><span class="hs-comment">--   in the 'TCState'.</span><span>
</span><span id="line-1382"></span><span>
</span><span id="line-1383"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-type">scopedExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>
</span><span id="line-1384"></span><span id="scopedExpr"><span class="annot"><span class="annottext">scopedExpr :: Expr -&gt; TCM Expr
</span><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-var hs-var">scopedExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopedExpr"><span class="hs-identifier hs-type">A.ScopedExpr</span></a></span><span> </span><span id="local-6989586621682144238"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682144238"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621682144239"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144239"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-var">setScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682144238"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM Expr -&gt; TCM Expr
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Expr
</span><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-var">scopedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144239"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1385"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-var">scopedExpr</span></a></span><span> </span><span id="local-6989586621682144241"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144241"><span class="hs-identifier hs-var">e</span></a></span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Expr
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144241"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span class="annot"><span class="hs-comment">-- | Type check an expression.</span></span><span>
</span><span id="line-1388"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-type">checkExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1389"></span><span id="checkExpr"><span class="annot"><span class="annottext">checkExpr :: Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var hs-var">checkExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span>
</span><span id="line-1390"></span><span>
</span><span id="line-1391"></span><span class="hs-comment">-- Andreas, 2019-10-13, issue #4125:</span><span>
</span><span id="line-1392"></span><span class="hs-comment">-- For the sake of readable types in interactive program construction,</span><span>
</span><span id="line-1393"></span><span class="hs-comment">-- avoid unnecessary unfoldings via 'reduce' in the type checker!</span><span>
</span><span id="line-1394"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-type">checkExpr'</span></a></span><span>
</span><span id="line-1395"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span>
</span><span id="line-1396"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>
</span><span id="line-1397"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Unreduced!</span></span><span>
</span><span id="line-1398"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1399"></span><span id="checkExpr%27"><span class="annot"><span class="annottext">checkExpr' :: Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var hs-var">checkExpr'</span></a></span></span><span> </span><span id="local-6989586621682144242"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144243"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144243"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682144244"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1400"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCM Term -&gt; TCM Term
forall a. ArgName -&gt; Int -&gt; ArgName -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseBracket"><span class="hs-identifier hs-var">verboseBracket</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.expr.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;checkExpr&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1401"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; (Term -&gt; TCMT IO Doc) -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; (a -&gt; TCMT IO Doc) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportResult"><span class="hs-identifier hs-var">reportResult</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.expr.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682144246"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144246"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1402"></span><span>                                              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checkExpr&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144243"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1403"></span><span>                                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  returns&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144246"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1404"></span><span>  </span><span class="annot"><span class="annottext">Call -&gt; TCM Term -&gt; TCM Term
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExprCall"><span class="hs-identifier hs-var">CheckExprCall</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144243"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Env.html#doExpandLast"><span class="hs-identifier hs-var">doExpandLast</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Term
forall (m :: * -&gt; *). PureTCM m =&gt; Term -&gt; m Term
</span><a href="Agda.TypeChecking.Reduce.html#unfoldInlined"><span class="hs-identifier hs-var">unfoldInlined</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1405"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.expr.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1406"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1407"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144243"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1408"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;at &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (Range -&gt; ArgName) -&gt; Range -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; TCMT IO Doc) -&gt; TCMT IO Range -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Range
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Range
</span><a href="Agda.TypeChecking.Monad.Trace.html#getCurrentRange"><span class="hs-identifier hs-var">getCurrentRange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1409"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1410"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.expr.top.detailed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1411"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144243"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1412"></span><span>    </span><span id="local-6989586621682144252"><span class="annot"><a href="#local-6989586621682144252"><span class="hs-identifier hs-var">tReduced</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1413"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.expr.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1414"></span><span>        </span><span class="annot"><span class="hs-string">&quot;    --&gt; &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144252"><span class="hs-identifier hs-type">tReduced</span></a></span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span>    </span><span id="local-6989586621682144253"><span class="annot"><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-type">scopedExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144243"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-1417"></span><span>
</span><span id="line-1418"></span><span>    </span><span id="local-6989586621682144254"><span class="annot"><a href="#local-6989586621682144254"><span class="hs-identifier hs-var">irrelevantIfProp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#runBlocked"><span class="hs-identifier hs-type">runBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html#isPropM"><span class="hs-identifier hs-type">isPropM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1419"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1420"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144257"><span class="annot"><span class="annottext">mod :: Modality
</span><a href="#local-6989586621682144257"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Agda.Syntax.Common.html#unitModality"><span class="hs-identifier hs-var">unitModality</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#modRelevance"><span class="hs-identifier hs-var">modRelevance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#irrelevant"><span class="hs-identifier hs-type">irrelevant</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1421"></span><span>        </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCMT IO (TCM Term -&gt; TCM Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((TCM Term -&gt; TCM Term) -&gt; TCMT IO (TCM Term -&gt; TCM Term))
-&gt; (TCM Term -&gt; TCM Term) -&gt; TCMT IO (TCM Term -&gt; TCM Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#dontCare"><span class="hs-identifier hs-var">dontCare</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term)
-&gt; (TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; TCM Term -&gt; TCM Term
forall (tcm :: * -&gt; *) m a.
(MonadTCEnv tcm, LensModality m) =&gt;
m -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-var">applyModalityToContext</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682144257"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1422"></span><span>      </span><span class="annot"><span class="annottext">Either Blocker Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCMT IO (TCM Term -&gt; TCM Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span>    </span><span class="annot"><a href="#local-6989586621682144254"><span class="hs-identifier hs-type">irrelevantIfProp</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682144262"><span class="hs-identifier hs-type">tryInsertHiddenLambda</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144253"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144252"><span class="hs-identifier hs-type">tReduced</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682144253"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopedExpr"><span class="hs-identifier hs-type">A.ScopedExpr</span></a></span><span> </span><span id="local-6989586621682144263"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682144263"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621682144264"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144264"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-comment">-- setScope scope &gt;&gt; checkExpr e t</span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span>        </span><span class="hs-comment">-- a meta variable without arguments: type check directly for efficiency</span><span>
</span><span id="line-1429"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuestionMark"><span class="hs-identifier hs-type">A.QuestionMark</span></a></span><span> </span><span id="local-6989586621682144265"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144265"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144266"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144266"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison -&gt; Type -&gt; MetaInfo -&gt; InteractionId -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkQuestionMark"><span class="hs-identifier hs-var">checkQuestionMark</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RunMetaOccursCheck -&gt; Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
RunMetaOccursCheck -&gt; Comparison -&gt; Type -&gt; m (MetaId, Term)
</span><a href="Agda.TypeChecking.MetaVars.html#newValueMeta%27"><span class="hs-identifier hs-var">newValueMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck
</span><a href="Agda.TypeChecking.Monad.Base.html#RunMetaOccursCheck"><span class="hs-identifier hs-var">RunMetaOccursCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144265"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144266"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1430"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Underscore"><span class="hs-identifier hs-type">A.Underscore</span></a></span><span> </span><span id="local-6989586621682144269"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144269"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Comparison -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkUnderscore"><span class="hs-identifier hs-var">checkUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144269"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithApp"><span class="hs-identifier hs-type">A.WithApp</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144272"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144272"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682144273"><span class="annot"><span class="annottext">List1 Expr
</span><a href="#local-6989586621682144273"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;type checking of with application&quot;</span></span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span>        </span><span id="local-6989586621682144275"><span class="annot"><span class="annottext">e0 :: Expr
</span><a href="#local-6989586621682144275"><span class="hs-identifier hs-var">e0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#App"><span class="hs-identifier hs-type">A.App</span></a></span><span> </span><span id="local-6989586621682144276"><span class="annot"><span class="annottext">AppInfo
</span><a href="#local-6989586621682144276"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144277"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144277"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682144278"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144278"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682144279"><span class="annot"><span class="annottext">Named_ Expr
</span><a href="#local-6989586621682144279"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1435"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Quote"><span class="hs-identifier hs-type">A.Quote</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-var">unScope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144277"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1436"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144278"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1437"></span><span>               </span><span id="local-6989586621682144281"><span class="annot"><a href="#local-6989586621682144281"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM QName
forall (m :: * -&gt; *).
(MonadTCError m, MonadAbsToCon m) =&gt;
Expr -&gt; m QName
</span><a href="Agda.TypeChecking.Quote.html#quotedName"><span class="hs-identifier hs-var">quotedName</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; TCM QName) -&gt; Expr -&gt; TCM QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Named_ Expr -&gt; Expr
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="annot"><span class="annottext">Named_ Expr
</span><a href="#local-6989586621682144279"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1438"></span><span>               </span><span id="local-6989586621682144284"><span class="annot"><a href="#local-6989586621682144284"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Unquote.html#qNameType"><span class="hs-identifier hs-type">qNameType</span></a></span><span>
</span><span id="line-1439"></span><span>               </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Quote.html#quoteName"><span class="hs-identifier hs-type">quoteName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144281"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144284"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1440"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CannotQuote -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotQuote"><span class="hs-identifier hs-var">CannotQuote</span></a></span><span> </span><span class="annot"><span class="annottext">CannotQuote
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotQuoteHidden"><span class="hs-identifier hs-var">CannotQuoteHidden</span></a></span><span>
</span><span id="line-1441"></span><span>
</span><span id="line-1442"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuoteTerm"><span class="hs-identifier hs-type">A.QuoteTerm</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.Views.html#unScope"><span class="hs-identifier hs-var">unScope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144277"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1443"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144278"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1444"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621682144290"><span class="annot"><a href="#local-6989586621682144290"><span class="hs-identifier hs-var">et</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-var">inferExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Named_ Expr -&gt; Expr
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="annot"><span class="annottext">Named_ Expr
</span><a href="#local-6989586621682144279"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1445"></span><span>               </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#doQuoteTerm"><span class="hs-identifier hs-type">doQuoteTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144290"><span class="hs-identifier hs-type">et</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1446"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CannotQuoteTerm -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotQuoteTerm"><span class="hs-identifier hs-var">CannotQuoteTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CannotQuoteTerm
</span><a href="Agda.Interaction.Options.Errors.html#CannotQuoteTermHidden"><span class="hs-identifier hs-var">CannotQuoteTermHidden</span></a></span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Quote"><span class="hs-identifier hs-type">A.Quote</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CannotQuote -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotQuote"><span class="hs-identifier hs-var">CannotQuote</span></a></span><span> </span><span class="annot"><span class="annottext">CannotQuote
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotQuoteNothing"><span class="hs-identifier hs-var">CannotQuoteNothing</span></a></span><span>
</span><span id="line-1449"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuoteTerm"><span class="hs-identifier hs-type">A.QuoteTerm</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Term) -&gt; TypeError -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CannotQuoteTerm -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotQuoteTerm"><span class="hs-identifier hs-var">CannotQuoteTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CannotQuoteTerm
</span><a href="Agda.Interaction.Options.Errors.html#CannotQuoteTermNothing"><span class="hs-identifier hs-var">CannotQuoteTermNothing</span></a></span><span>
</span><span id="line-1450"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Unquote"><span class="hs-identifier hs-type">A.Unquote</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnquoteError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
UnquoteError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#unquoteError"><span class="hs-identifier hs-var">unquoteError</span></a></span><span> </span><span class="annot"><span class="annottext">UnquoteError
</span><a href="Agda.TypeChecking.Monad.Base.html#NakedUnquote"><span class="hs-identifier hs-var">NakedUnquote</span></a></span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdLam"><span class="hs-identifier hs-type">A.AbsurdLam</span></a></span><span> </span><span id="local-6989586621682144300"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144300"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144301"><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682144301"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; ExprInfo -&gt; Hiding -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkAbsurdLambda"><span class="hs-identifier hs-var">checkAbsurdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144300"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682144301"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ExtendedLam"><span class="hs-identifier hs-type">A.ExtendedLam</span></a></span><span> </span><span id="local-6989586621682144303"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144303"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144304"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682144304"><span class="hs-identifier hs-var">di</span></a></span></span><span> </span><span id="local-6989586621682144305"><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682144305"><span class="hs-identifier hs-var">erased</span></a></span></span><span> </span><span id="local-6989586621682144306"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144306"><span class="hs-identifier hs-var">qname</span></a></span></span><span> </span><span id="local-6989586621682144307"><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682144307"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1455"></span><span>          </span><span class="annot"><span class="annottext">Comparison
-&gt; ExprInfo
-&gt; DefInfo
-&gt; Erased
-&gt; QName
-&gt; List1 Clause
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExtendedLambda"><span class="hs-identifier hs-var">checkExtendedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144303"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682144304"><span class="hs-identifier hs-var">di</span></a></span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682144305"><span class="hs-identifier hs-var">erased</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144306"><span class="hs-identifier hs-var">qname</span></a></span><span> </span><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682144307"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-type">A.Lam</span></a></span><span> </span><span id="local-6989586621682144308"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144308"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#DomainFull"><span class="hs-identifier hs-type">A.DomainFull</span></a></span><span> </span><span id="local-6989586621682144309"><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682144309"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144310"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144310"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; TypedBinding -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLambda"><span class="hs-identifier hs-var">checkLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">TypedBinding
</span><a href="#local-6989586621682144309"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144310"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1458"></span><span>
</span><span id="line-1459"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-type">A.Lam</span></a></span><span> </span><span id="local-6989586621682144311"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144311"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#DomainFree"><span class="hs-identifier hs-type">A.DomainFree</span></a></span><span> </span><span class="annot"><span class="annottext">TacticAttribute
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144313"><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682144313"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144314"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144314"><span class="hs-identifier hs-var">e0</span></a></span></span><span>
</span><span id="line-1460"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (WithOrigin (Ranged ArgName)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Named (WithOrigin (Ranged ArgName)) (Binder' BindName)
-&gt; Maybe (WithOrigin (Ranged ArgName))
forall name a. Named name a -&gt; Maybe name
</span><a href="Agda.Syntax.Common.html#nameOf"><span class="hs-identifier hs-var">nameOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Named (WithOrigin (Ranged ArgName)) (Binder' BindName)
 -&gt; Maybe (WithOrigin (Ranged ArgName)))
-&gt; Named (WithOrigin (Ranged ArgName)) (Binder' BindName)
-&gt; Maybe (WithOrigin (Ranged ArgName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
-&gt; Named (WithOrigin (Ranged ArgName)) (Binder' BindName)
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682144313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Pattern -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binder' BindName -&gt; Maybe Pattern
forall a. Binder' a -&gt; Maybe Pattern
</span><a href="Agda.Syntax.Abstract.html#binderPattern"><span class="hs-identifier hs-var">A.binderPattern</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder' BindName -&gt; Maybe Pattern)
-&gt; Binder' BindName -&gt; Maybe Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; Binder' BindName
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682144313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1461"></span><span>              </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExprInfo -&gt; LamBinding -&gt; Expr -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-var">A.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144311"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Binder' Name -&gt; LamBinding
</span><a href="Agda.TypeChecking.Rules.Term.html#domainFree"><span class="hs-identifier hs-var">domainFree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682144313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Binder' Name -&gt; LamBinding) -&gt; Binder' Name -&gt; LamBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Name) -&gt; Binder' BindName -&gt; Binder' Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; Binder' BindName
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Binder' BindName)
</span><a href="#local-6989586621682144313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144314"><span class="hs-identifier hs-var">e0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1462"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1463"></span><span>
</span><span id="line-1464"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lit"><span class="hs-identifier hs-type">A.Lit</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144319"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682144319"><span class="hs-identifier hs-var">lit</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLiteral"><span class="hs-identifier hs-var">checkLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682144319"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1465"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Let"><span class="hs-identifier hs-type">A.Let</span></a></span><span> </span><span id="local-6989586621682144321"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144321"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144322"><span class="annot"><span class="annottext">List1 LetBinding
</span><a href="#local-6989586621682144322"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682144323"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144323"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">List1 LetBinding -&gt; TCM Term -&gt; TCM Term
forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings"><span class="hs-identifier hs-var">checkLetBindings</span></a></span><span> </span><span class="annot"><span class="annottext">List1 LetBinding
</span><a href="#local-6989586621682144322"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144323"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1466"></span><span>        </span><span id="local-6989586621682144324"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621682144324"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pi"><span class="hs-identifier hs-type">A.Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1467"></span><span>            </span><span id="local-6989586621682144325"><span class="annot"><a href="#local-6989586621682144325"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144324"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1468"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144326"><span class="annot"><a href="#local-6989586621682144326"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144325"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1469"></span><span>                </span><span id="local-6989586621682144327"><span class="annot"><a href="#local-6989586621682144327"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144325"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1470"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144327"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-type">sort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144326"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1471"></span><span>
</span><span id="line-1472"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Generalized"><span class="hs-identifier hs-type">A.Generalized</span></a></span><span> </span><span id="local-6989586621682144328"><span class="annot"><span class="annottext">Set1 QName
</span><a href="#local-6989586621682144328"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682144329"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144329"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1473"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144330"><span class="annot"><a href="#local-6989586621682144330"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; TCM Type -&gt; TCM ([Maybe QName], Type)
</span><a href="Agda.TypeChecking.Generalize.html#generalizeType"><span class="hs-identifier hs-var">generalizeType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set1 QName -&gt; Set QName
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set1.toSet</span></span><span> </span><span class="annot"><span class="annottext">Set1 QName
</span><a href="#local-6989586621682144328"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM ([Maybe QName], Type))
-&gt; TCM Type -&gt; TCM ([Maybe QName], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144329"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1474"></span><span>            </span><span class="hs-comment">--noFunctionsIntoSize t' t'</span><span>
</span><span id="line-1475"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144331"><span class="annot"><a href="#local-6989586621682144331"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144330"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1476"></span><span>                </span><span id="local-6989586621682144332"><span class="annot"><a href="#local-6989586621682144332"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144330"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1477"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144332"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-type">sort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144331"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span>        </span><span id="local-6989586621682144333"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621682144333"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Fun"><span class="hs-identifier hs-type">A.Fun</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1480"></span><span>            </span><span id="local-6989586621682144334"><span class="annot"><a href="#local-6989586621682144334"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144333"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1481"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144335"><span class="annot"><a href="#local-6989586621682144335"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144334"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1482"></span><span>                </span><span id="local-6989586621682144336"><span class="annot"><a href="#local-6989586621682144336"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144334"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1483"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144336"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-type">sort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144335"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1484"></span><span>
</span><span id="line-1485"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Rec"><span class="hs-identifier hs-type">A.Rec</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144337"><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682144337"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; [Either (FieldAssignment' Expr) ModuleName]
-&gt; Expr
-&gt; Type
-&gt; ConOrigin
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordExpression"><span class="hs-identifier hs-var">checkRecordExpression</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (FieldAssignment' Expr) ModuleName]
</span><a href="#local-6989586621682144337"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ConOrigin
</span><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-var">ConORec</span></a></span><span>
</span><span id="line-1486"></span><span>
</span><span id="line-1487"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecUpdate"><span class="hs-identifier hs-type">A.RecUpdate</span></a></span><span> </span><span id="local-6989586621682144339"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144339"><span class="hs-identifier hs-var">kwr</span></a></span></span><span> </span><span id="local-6989586621682144340"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144340"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621682144341"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144341"><span class="hs-identifier hs-var">recexpr</span></a></span></span><span> </span><span id="local-6989586621682144342"><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144342"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; KwRange
-&gt; ExprInfo
-&gt; Expr
-&gt; Assigns
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordUpdate"><span class="hs-identifier hs-var">checkRecordUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144339"><span class="hs-identifier hs-var">kwr</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144340"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144341"><span class="hs-identifier hs-var">recexpr</span></a></span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144342"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecWhere"><span class="hs-identifier hs-type">A.RecWhere</span></a></span><span> </span><span id="local-6989586621682144344"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144344"><span class="hs-identifier hs-var">kwr</span></a></span></span><span> </span><span id="local-6989586621682144345"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144345"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621682144346"><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144346"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span id="local-6989586621682144347"><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144347"><span class="hs-identifier hs-var">fs</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; KwRange
-&gt; ExprInfo
-&gt; Maybe Expr
-&gt; [LetBinding]
-&gt; Assigns
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordWhere"><span class="hs-identifier hs-var">checkRecordWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144344"><span class="hs-identifier hs-var">kwr</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144345"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144346"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144347"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1490"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecUpdateWhere"><span class="hs-identifier hs-type">A.RecUpdateWhere</span></a></span><span> </span><span id="local-6989586621682144349"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144349"><span class="hs-identifier hs-var">kwr</span></a></span></span><span> </span><span id="local-6989586621682144350"><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144350"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621682144351"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144351"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621682144352"><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144352"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span id="local-6989586621682144353"><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144353"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; KwRange
-&gt; ExprInfo
-&gt; Maybe Expr
-&gt; [LetBinding]
-&gt; Assigns
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkRecordWhere"><span class="hs-identifier hs-var">checkRecordWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682144349"><span class="hs-identifier hs-var">kwr</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><a href="#local-6989586621682144350"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144351"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682144352"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Assigns
</span><a href="#local-6989586621682144353"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DontCare"><span class="hs-identifier hs-type">A.DontCare</span></a></span><span> </span><span id="local-6989586621682144355"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144355"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1493"></span><span>          </span><span id="local-6989586621682144356"><span class="annot"><a href="#local-6989586621682144356"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv Relevance -&gt; TCMT IO Relevance
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Relevance -&gt; f Relevance) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv Relevance
</span><a href="Agda.TypeChecking.Monad.Base.html#eRelevance"><span class="hs-identifier hs-var">eRelevance</span></a></span><span>
</span><span id="line-1494"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-type">isIrrelevant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144356"><span class="hs-identifier hs-type">rel</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#dontCare"><span class="hs-identifier hs-type">dontCare</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1495"></span><span>            </span><span class="hs-comment">-- resurrect variables</span><span>
</span><span id="line-1496"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#applyRelevanceToContext"><span class="hs-identifier hs-type">applyRelevanceToContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144356"><span class="hs-identifier hs-type">rel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-type">checkExpr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144355"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144244"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1497"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-1498"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#internalError"><span class="hs-identifier hs-type">internalError</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;DontCare may only appear in irrelevant contexts&quot;</span></span><span>
</span><span id="line-1499"></span><span>
</span><span id="line-1500"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Dot"><span class="hs-identifier hs-type">A.Dot</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#InvalidDottedExpression"><span class="hs-identifier hs-var">InvalidDottedExpression</span></a></span><span>
</span><span id="line-1501"></span><span>
</span><span id="line-1502"></span><span>        </span><span class="hs-comment">-- Application</span><span>
</span><span id="line-1503"></span><span>        </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#Application"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span id="local-6989586621682144365"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144365"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682144366"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144366"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; AppView' Expr
</span><a href="Agda.Syntax.Abstract.Views.html#appView"><span class="hs-identifier hs-var">appView</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; [NamedArg Expr] -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Application.html#checkApplication"><span class="hs-identifier hs-var">checkApplication</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144365"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144366"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#catchIlltypedPatternBlockedOnMeta"><span class="hs-operator hs-type">`catchIlltypedPatternBlockedOnMeta`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144369"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682144369"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144370"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682144370"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1506"></span><span>        </span><span class="hs-comment">-- We could not check the term because the type of some pattern is blocked.</span><span>
</span><span id="line-1507"></span><span>        </span><span class="hs-comment">-- It has to be blocked on some meta, so we can postpone,</span><span>
</span><span id="line-1508"></span><span>        </span><span class="hs-comment">-- being sure it will be retried when a meta is solved</span><span>
</span><span id="line-1509"></span><span>        </span><span class="hs-comment">-- (which might be the blocking meta in which case we actually make progress).</span><span>
</span><span id="line-1510"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1511"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking pattern got stuck on meta: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682144370"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1512"></span><span>        </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; Blocker -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem"><span class="hs-identifier hs-var">postponeTypeCheckingProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-var">CheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144242"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144253"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144244"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682144370"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1515"></span><span>  </span><span class="hs-comment">-- Call checkExpr with an hidden lambda inserted if appropriate,</span><span>
</span><span id="line-1516"></span><span>  </span><span class="hs-comment">-- else fallback.</span><span>
</span><span id="line-1517"></span><span>  </span><span class="annot"><a href="#local-6989586621682144262"><span class="hs-identifier hs-type">tryInsertHiddenLambda</span></a></span><span>
</span><span id="line-1518"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>
</span><span id="line-1519"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>      </span><span class="hs-comment">-- Reduced.</span><span>
</span><span id="line-1520"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1521"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1522"></span><span>  </span><span id="local-6989586621682144262"><span class="annot"><span class="annottext">tryInsertHiddenLambda :: Expr -&gt; Type -&gt; TCM Term -&gt; TCM Term
</span><a href="#local-6989586621682144262"><span class="hs-identifier hs-var hs-var">tryInsertHiddenLambda</span></a></span></span><span> </span><span id="local-6989586621682144371"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144371"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682144372"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144372"><span class="hs-identifier hs-var">tReduced</span></a></span></span><span> </span><span id="local-6989586621682144373"><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144373"><span class="hs-identifier hs-var">fallback</span></a></span></span><span>
</span><span id="line-1523"></span><span>    </span><span class="hs-comment">-- Insert hidden lambda if all of the following conditions are met:</span><span>
</span><span id="line-1524"></span><span>    </span><span class="hs-comment">-- type is a hidden function type, {x : A} -&gt; B or {{x : A}} -&gt; B</span><span>
</span><span id="line-1525"></span><span>    </span><span class="hs-comment">-- expression is not a lambda with the appropriate hiding yet</span><span>
</span><span id="line-1526"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682144374"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144374"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682144375"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144375"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144376"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682144376"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144372"><span class="hs-identifier hs-var">tReduced</span></a></span><span>
</span><span id="line-1527"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144377"><span class="annot"><span class="annottext">h :: Hiding
</span><a href="#local-6989586621682144377"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Hiding
forall a. LensHiding a =&gt; a -&gt; Hiding
</span><a href="Agda.Syntax.Common.html#getHiding"><span class="hs-identifier hs-var">getHiding</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144374"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1528"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-var">notVisible</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682144377"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1529"></span><span>        </span><span class="hs-comment">-- expression is not a matching hidden lambda or question mark</span><span>
</span><span id="line-1530"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hiding -&gt; Expr -&gt; Bool
forall {a}. LensHiding a =&gt; a -&gt; Expr -&gt; Bool
</span><a href="#local-6989586621682144378"><span class="hs-identifier hs-var">hiddenLambdaOrHole</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682144377"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144371"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1532"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144379"><span class="annot"><span class="annottext">proceed :: TCM Term
</span><a href="#local-6989586621682144379"><span class="hs-identifier hs-var hs-var hs-var">proceed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgName -&gt; TCM Term
</span><a href="#local-6989586621682144380"><span class="hs-identifier hs-var">doInsert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; ArgInfo -&gt; ArgInfo
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144374"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM Term) -&gt; ArgName -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; ArgName
forall a. Abs a -&gt; ArgName
</span><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var">absName</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682144376"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1533"></span><span>      </span><span id="local-6989586621682144381"><span class="annot"><a href="#local-6989586621682144381"><span class="hs-identifier hs-var">expandHidden</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; ExpandHidden) -&gt; TCMT IO ExpandHidden
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; ExpandHidden
</span><a href="Agda.TypeChecking.Monad.Base.html#envExpandLast"><span class="hs-identifier hs-var">envExpandLast</span></a></span><span>
</span><span id="line-1534"></span><span>      </span><span class="hs-comment">-- If we skip the lambda insertion for an introduction,</span><span>
</span><span id="line-1535"></span><span>      </span><span class="hs-comment">-- we will hit a dead end, so proceed no matter what.</span><span>
</span><span id="line-1536"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682144383"><span class="hs-identifier hs-type">definitelyIntroduction</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682144379"><span class="hs-identifier hs-type">proceed</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-1537"></span><span>        </span><span class="hs-comment">-- #3019 and #4170: don't insert implicit lambdas in arguments to existing metas</span><span>
</span><span id="line-1538"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682144381"><span class="hs-identifier hs-type">expandHidden</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReallyDontExpandLast"><span class="hs-identifier hs-type">ReallyDontExpandLast</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682144373"><span class="hs-identifier hs-type">fallback</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1539"></span><span>        </span><span class="hs-comment">-- Andreas, 2017-01-19, issue #2412:</span><span>
</span><span id="line-1540"></span><span>        </span><span class="hs-comment">-- We do not want to insert a hidden lambda if A is</span><span>
</span><span id="line-1541"></span><span>        </span><span class="hs-comment">-- possibly empty type of sizes, as this will produce an error.</span><span>
</span><span id="line-1542"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144375"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.SizedTypes.html#isSizeType"><span class="hs-identifier hs-type">isSizeType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1543"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.SizedTypes.html#BoundedLt"><span class="hs-identifier hs-type">BoundedLt</span></a></span><span> </span><span id="local-6989586621682144387"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144387"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term
-&gt; (Blocker -&gt; Term -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Term -&gt; TCM Term)
-&gt; TCM Term
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144387"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144373"><span class="hs-identifier hs-var">fallback</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NotBlocked -&gt; Term -&gt; TCM Term) -&gt; TCM Term)
-&gt; (NotBlocked -&gt; Term -&gt; TCM Term) -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144388"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144388"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1544"></span><span>            </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.SizedTypes.html#checkSizeNeverZero"><span class="hs-identifier hs-var">checkSizeNeverZero</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144388"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144379"><span class="hs-identifier hs-var">proceed</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144373"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-1545"></span><span>            </span><span class="annot"><span class="annottext">TCM Term -&gt; (TCErr -&gt; TCM Term) -&gt; TCM Term
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144373"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-1546"></span><span>          </span><span class="annot"><span class="annottext">Maybe BoundedSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144379"><span class="hs-identifier hs-var">proceed</span></a></span><span>
</span><span id="line-1547"></span><span>
</span><span id="line-1548"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Term
</span><a href="#local-6989586621682144373"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1551"></span><span>    </span><span id="local-6989586621682144390"><span class="annot"><span class="annottext">re :: Range
</span><a href="#local-6989586621682144390"><span class="hs-identifier hs-var hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144371"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1552"></span><span>    </span><span id="local-6989586621682144391"><span class="annot"><span class="annottext">rx :: Range
</span><a href="#local-6989586621682144391"><span class="hs-identifier hs-var hs-var">rx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Position' SrcFile)
-&gt; Range -&gt; (Position' SrcFile -&gt; Range) -&gt; Range
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe (Position' SrcFile)
forall a. Range' a -&gt; Maybe (Position' a)
</span><a href="Agda.Syntax.Position.html#rStart"><span class="hs-identifier hs-var">rStart</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682144390"><span class="hs-identifier hs-var">re</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">((Position' SrcFile -&gt; Range) -&gt; Range)
-&gt; (Position' SrcFile -&gt; Range) -&gt; Range
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682144393"><span class="annot"><span class="annottext">Position' SrcFile
</span><a href="#local-6989586621682144393"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position' SrcFile -&gt; Position' SrcFile -&gt; Range
forall a b. Position' a -&gt; Position' b -&gt; Range' a
</span><a href="Agda.Syntax.Position.html#posToRange"><span class="hs-identifier hs-var">posToRange</span></a></span><span> </span><span class="annot"><span class="annottext">Position' SrcFile
</span><a href="#local-6989586621682144393"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Position' SrcFile
</span><a href="#local-6989586621682144393"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span>    </span><span id="local-6989586621682144380"><span class="annot"><span class="annottext">doInsert :: ArgInfo -&gt; ArgName -&gt; TCM Term
</span><a href="#local-6989586621682144380"><span class="hs-identifier hs-var hs-var">doInsert</span></a></span></span><span> </span><span id="local-6989586621682144395"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144395"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144396"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682144396"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1555"></span><span>      </span><span id="local-6989586621682144397"><span class="annot"><a href="#local-6989586621682144397"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall a. LensInScope a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Concrete.Name.html#setNotInScope"><span class="hs-identifier hs-var">C.setNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; TCMT IO Name -&gt; TCMT IO Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; ArgName -&gt; TCMT IO Name
forall (m :: * -&gt; *).
MonadFresh NameId m =&gt;
Range -&gt; ArgName -&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Base.html#freshName"><span class="hs-identifier hs-var">freshName</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682144391"><span class="hs-identifier hs-var">rx</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682144396"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1556"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.expr.impl&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Inserting implicit lambda&quot;</span></span><span>
</span><span id="line-1557"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-type">checkExpr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144242"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-type">A.Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#ExprRange"><span class="hs-identifier hs-type">A.ExprRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144390"><span class="hs-identifier hs-type">re</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#domainFree"><span class="hs-identifier hs-type">domainFree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144395"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#mkBinder"><span class="hs-identifier hs-type">A.mkBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144397"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144371"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144372"><span class="hs-identifier hs-type">tReduced</span></a></span><span>
</span><span id="line-1558"></span><span>
</span><span id="line-1559"></span><span>    </span><span id="local-6989586621682144378"><span class="annot"><span class="annottext">hiddenLambdaOrHole :: a -&gt; Expr -&gt; Bool
</span><a href="#local-6989586621682144378"><span class="hs-identifier hs-var hs-var">hiddenLambdaOrHole</span></a></span></span><span> </span><span id="local-6989586621682144408"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682144408"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1560"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdLam"><span class="hs-identifier hs-type">A.AbsurdLam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144409"><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682144409"><span class="hs-identifier hs-var">h'</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Hiding -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682144408"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="#local-6989586621682144409"><span class="hs-identifier hs-var">h'</span></a></span><span>
</span><span id="line-1561"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ExtendedLam"><span class="hs-identifier hs-type">A.ExtendedLam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Erased
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144410"><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682144410"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; Bool) -&gt; List1 Clause -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Bool
</span><a href="#local-6989586621682144411"><span class="hs-identifier hs-var">hiddenLHS</span></a></span><span> </span><span class="annot"><span class="annottext">List1 Clause
</span><a href="#local-6989586621682144410"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1562"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-type">A.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ExprInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144412"><span class="annot"><span class="annottext">LamBinding
</span><a href="#local-6989586621682144412"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; LamBinding -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682144408"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">LamBinding
</span><a href="#local-6989586621682144412"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-1563"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuestionMark"><span class="hs-identifier hs-type">A.QuestionMark</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1564"></span><span>      </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1565"></span><span>
</span><span id="line-1566"></span><span>    </span><span id="local-6989586621682144411"><span class="annot"><span class="annottext">hiddenLHS :: Clause -&gt; Bool
</span><a href="#local-6989586621682144411"><span class="hs-identifier hs-var hs-var">hiddenLHS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-type">A.LHS</span></a></span><span> </span><span class="annot"><span class="annottext">LHSInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSHead"><span class="hs-identifier hs-type">A.LHSHead</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144417"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682144417"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RHS
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-var">notVisible</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682144417"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1567"></span><span>    </span><span class="annot"><a href="#local-6989586621682144411"><span class="hs-identifier hs-var">hiddenLHS</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1568"></span><span>
</span><span id="line-1569"></span><span>    </span><span class="hs-comment">-- Things with are definitely introductions,</span><span>
</span><span id="line-1570"></span><span>    </span><span class="hs-comment">-- thus, cannot be of hidden Pi-type, unless they are hidden lambdas.</span><span>
</span><span id="line-1571"></span><span>    </span><span id="local-6989586621682144383"><span class="annot"><span class="annottext">definitelyIntroduction :: Bool
</span><a href="#local-6989586621682144383"><span class="hs-identifier hs-var hs-var">definitelyIntroduction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144371"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1572"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lam"><span class="hs-identifier hs-type">A.Lam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1573"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdLam"><span class="hs-identifier hs-type">A.AbsurdLam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1574"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Lit"><span class="hs-identifier hs-type">A.Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1575"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pi"><span class="hs-identifier hs-type">A.Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1576"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Fun"><span class="hs-identifier hs-type">A.Fun</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1577"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Rec"><span class="hs-identifier hs-type">A.Rec</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1578"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecUpdate"><span class="hs-identifier hs-type">A.RecUpdate</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1579"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopedExpr"><span class="hs-identifier hs-type">A.ScopedExpr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1580"></span><span>      </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1581"></span><span>
</span><span id="line-1582"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1583"></span><span class="annot"><span class="hs-comment">-- * Reflection</span></span><span>
</span><span id="line-1584"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1585"></span><span>
</span><span id="line-1586"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#doQuoteTerm"><span class="hs-identifier hs-type">doQuoteTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1587"></span><span id="doQuoteTerm"><span class="annot"><span class="annottext">doQuoteTerm :: Comparison -&gt; Term -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#doQuoteTerm"><span class="hs-identifier hs-var hs-var">doQuoteTerm</span></a></span></span><span> </span><span id="local-6989586621682144418"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144418"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144419"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144419"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621682144420"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144420"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1588"></span><span>  </span><span id="local-6989586621682144421"><span class="annot"><a href="#local-6989586621682144421"><span class="hs-identifier hs-var">et'</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Term
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasConstInfo m, HasOptions m, TermLike a) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.EtaContract.html#etaContract"><span class="hs-identifier hs-var">etaContract</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144419"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-1589"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html#allMetasList"><span class="hs-identifier hs-type">allMetasList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144421"><span class="hs-identifier hs-type">et'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1590"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1591"></span><span>      </span><span id="local-6989586621682144424"><span class="annot"><a href="#local-6989586621682144424"><span class="hs-identifier hs-var">q</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Term
</span><a href="Agda.TypeChecking.Quote.html#quoteTerm"><span class="hs-identifier hs-var">quoteTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144421"><span class="hs-identifier hs-var">et'</span></a></span><span>
</span><span id="line-1592"></span><span>      </span><span id="local-6989586621682144426"><span class="annot"><a href="#local-6989586621682144426"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-type">el</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTerm"><span class="hs-identifier hs-type">primAgdaTerm</span></a></span><span>
</span><span id="line-1593"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144418"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144424"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144426"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144420"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1594"></span><span>    </span><span id="local-6989586621682144427"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621682144427"><span class="hs-identifier hs-var">metas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeCheckingProblem -&gt; Blocker -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.html#postponeTypeCheckingProblem"><span class="hs-identifier hs-var">postponeTypeCheckingProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Term -&gt; Type -&gt; TypeCheckingProblem
</span><a href="Agda.TypeChecking.Monad.Base.html#DoQuoteTerm"><span class="hs-identifier hs-var">DoQuoteTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144418"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144419"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144420"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; TCM Term) -&gt; Blocker -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#unblockOnAllMetas"><span class="hs-identifier hs-var">unblockOnAllMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(Set MetaId -&gt; Blocker) -&gt; Set MetaId -&gt; Blocker
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[MetaId] -&gt; Set MetaId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621682144427"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="annot"><span class="hs-comment">-- | Unquote a TCM computation in a given hole.</span></span><span>
</span><span id="line-1597"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#unquoteM"><span class="hs-identifier hs-type">unquoteM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1598"></span><span id="unquoteM"><span class="annot"><span class="annottext">unquoteM :: Expr -&gt; Term -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Term.html#unquoteM"><span class="hs-identifier hs-var hs-var">unquoteM</span></a></span></span><span> </span><span id="local-6989586621682144431"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144431"><span class="hs-identifier hs-var">tacA</span></a></span></span><span> </span><span id="local-6989586621682144432"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144432"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span id="local-6989586621682144433"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144433"><span class="hs-identifier hs-var">holeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1599"></span><span>  </span><span id="local-6989586621682144434"><span class="annot"><a href="#local-6989586621682144434"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; TCM Term -&gt; TCM Term
forall (tcm :: * -&gt; *) q a.
(MonadTCEnv tcm, LensQuantity q) =&gt;
q -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyQuantityToJudgement"><span class="hs-identifier hs-var">applyQuantityToJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="Agda.Syntax.Common.html#zeroQuantity"><span class="hs-identifier hs-var">zeroQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1600"></span><span>    </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144431"><span class="hs-identifier hs-var">tacA</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM Term) -&gt; TCM Type -&gt; TCM Term
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Type
forall (m :: * -&gt; *). Functor m =&gt; m Term -&gt; m Type
</span><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTerm"><span class="hs-identifier hs-var">primAgdaTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type -&gt; TCM Type
forall (m :: * -&gt; *). HasOptions m =&gt; m Type -&gt; m Type -&gt; m Type
</span><a href="Agda.TypeChecking.Primitive.Base.html#--%3E"><span class="hs-operator hs-var">--&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Type
forall (m :: * -&gt; *). Functor m =&gt; m Term -&gt; m Type
</span><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTCM"><span class="hs-identifier hs-var">primAgdaTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%23%3E"><span class="hs-operator hs-var">&lt;#&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primLevelZero"><span class="hs-identifier hs-var">primLevelZero</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primUnit"><span class="hs-identifier hs-var">primUnit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#inFreshModuleIfFreeParams"><span class="hs-identifier hs-type">inFreshModuleIfFreeParams</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#unquoteTactic"><span class="hs-identifier hs-type">unquoteTactic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144434"><span class="hs-identifier hs-type">tac</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144432"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144433"><span class="hs-identifier hs-type">holeType</span></a></span><span>
</span><span id="line-1602"></span><span>
</span><span id="line-1603"></span><span class="hs-comment">-- | Run a tactic `tac : Term &#8594; TC &#8868;` in a hole (second argument) of the type</span><span>
</span><span id="line-1604"></span><span class="hs-comment">--   given by the third argument. Runs the continuation if successful.</span><span>
</span><span id="line-1605"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#unquoteTactic"><span class="hs-identifier hs-type">unquoteTactic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span id="unquoteTactic"><span class="annot"><span class="annottext">unquoteTactic :: Term -&gt; Term -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Term.html#unquoteTactic"><span class="hs-identifier hs-var hs-var">unquoteTactic</span></a></span></span><span> </span><span id="local-6989586621682144437"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144437"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span id="local-6989586621682144438"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144438"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span id="local-6989586621682144439"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144439"><span class="hs-identifier hs-var">goal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1607"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' TCState Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; TCState -&gt; f TCState
Lens' TCState Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#stConsideringInstance"><span class="hs-identifier hs-var">stConsideringInstance</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; Constraint -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
Blocker -&gt; Constraint -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#addConstraint"><span class="hs-identifier hs-var">addConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; Type -&gt; Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#UnquoteTactic"><span class="hs-identifier hs-var">UnquoteTactic</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144437"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144438"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144439"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1608"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.tactic&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1609"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Running tactic&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144437"><span class="hs-identifier hs-var">tac</span></a></span><span>
</span><span id="line-1610"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;on&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144438"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144439"><span class="hs-identifier hs-var">goal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1611"></span><span>  </span><span id="local-6989586621682144446"><span class="annot"><a href="#local-6989586621682144446"><span class="hs-identifier hs-var">ok</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnquoteM Term -&gt; TCM (Either UnquoteError (Term, [QName]))
forall a. UnquoteM a -&gt; TCM (Either UnquoteError (a, [QName]))
</span><a href="Agda.TypeChecking.Unquote.html#runUnquoteM"><span class="hs-identifier hs-var">runUnquoteM</span></a></span><span> </span><span class="annot"><span class="annottext">(UnquoteM Term -&gt; TCM (Either UnquoteError (Term, [QName])))
-&gt; UnquoteM Term -&gt; TCM (Either UnquoteError (Term, [QName]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; UnquoteM Term
</span><a href="Agda.TypeChecking.Unquote.html#unquoteTCM"><span class="hs-identifier hs-var">unquoteTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144437"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144438"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682144446"><span class="hs-identifier hs-type">ok</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1613"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BlockedOnMeta"><span class="hs-identifier hs-type">BlockedOnMeta</span></a></span><span> </span><span id="local-6989586621682144450"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682144450"><span class="hs-identifier hs-var">oldState</span></a></span></span><span> </span><span id="local-6989586621682144451"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682144451"><span class="hs-identifier hs-var">blocker</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1614"></span><span>      </span><span class="annot"><span class="annottext">TCState -&gt; TCM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682144450"><span class="hs-identifier hs-var">oldState</span></a></span><span>
</span><span id="line-1615"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144462"><span class="annot"><span class="annottext">stripFreshMeta :: MetaId -&gt; f Blocker
</span><a href="#local-6989586621682144462"><span class="hs-identifier hs-var hs-var hs-var">stripFreshMeta</span></a></span></span><span> </span><span id="local-6989586621682144463"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144463"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker
-&gt; (MetaVariable -&gt; Blocker) -&gt; Maybe MetaVariable -&gt; Blocker
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; MetaVariable -&gt; Blocker
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; MetaVariable -&gt; Blocker)
-&gt; Blocker -&gt; MetaVariable -&gt; Blocker
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#unblockOnMeta"><span class="hs-identifier hs-var">unblockOnMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144463"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe MetaVariable -&gt; Blocker)
-&gt; f (Maybe MetaVariable) -&gt; f Blocker
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; f (Maybe MetaVariable)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
MetaId -&gt; m (Maybe MetaVariable)
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta%27"><span class="hs-identifier hs-var">lookupLocalMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144463"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1616"></span><span>      </span><span id="local-6989586621682144465"><span class="annot"><a href="#local-6989586621682144465"><span class="hs-identifier hs-var">blocker'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCMT IO Blocker) -&gt; Blocker -&gt; TCMT IO Blocker
forall (m :: * -&gt; *).
Monad m =&gt;
(MetaId -&gt; m Blocker) -&gt; Blocker -&gt; m Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#onBlockingMetasM"><span class="hs-identifier hs-var">onBlockingMetasM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Blocker
forall {f :: * -&gt; *}. ReadTCState f =&gt; MetaId -&gt; f Blocker
</span><a href="#local-6989586621682144462"><span class="hs-identifier hs-var">stripFreshMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682144451"><span class="hs-identifier hs-var">blocker</span></a></span><span>
</span><span id="line-1617"></span><span>      </span><span id="local-6989586621682144466"><span class="annot"><a href="#local-6989586621682144466"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#allBlockingMetas"><span class="hs-identifier hs-type">allBlockingMetas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144465"><span class="hs-identifier hs-type">blocker'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1618"></span><span>            </span><span id="local-6989586621682144469"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144469"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe MetaVariable -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MetaVariable -&gt; Range)
-&gt; TCMT IO (Maybe MetaVariable) -&gt; TCMT IO Range
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO (Maybe MetaVariable)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
MetaId -&gt; m (Maybe MetaVariable)
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta%27"><span class="hs-identifier hs-var">lookupLocalMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144469"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1619"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Range -&gt; TCMT IO Range
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span>
</span><span id="line-1620"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-type">setCurrentRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144466"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1621"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144465"><span class="hs-identifier hs-type">blocker'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UnquoteTactic"><span class="hs-identifier hs-type">UnquoteTactic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144437"><span class="hs-identifier hs-type">tac</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144438"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144439"><span class="hs-identifier hs-type">goal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682144470"><span class="annot"><span class="annottext">UnquoteError
</span><a href="#local-6989586621682144470"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnquoteError -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#UnquoteFailed"><span class="hs-identifier hs-var">UnquoteFailed</span></a></span><span> </span><span class="annot"><span class="annottext">UnquoteError
</span><a href="#local-6989586621682144470"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1623"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">(Term, [QName])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1624"></span><span>
</span><span id="line-1625"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1626"></span><span class="annot"><span class="hs-comment">-- * Meta variables</span></span><span>
</span><span id="line-1627"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1628"></span><span>
</span><span id="line-1629"></span><span class="annot"><span class="hs-comment">-- | Check an interaction point without arguments.</span></span><span>
</span><span id="line-1630"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkQuestionMark"><span class="hs-identifier hs-type">checkQuestionMark</span></a></span><span>
</span><span id="line-1631"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1632"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span>
</span><span id="line-1633"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Not reduced!</span></span><span>
</span><span id="line-1634"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-type">A.MetaInfo</span></a></span><span>
</span><span id="line-1635"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span>
</span><span id="line-1636"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1637"></span><span id="checkQuestionMark"><span class="annot"><span class="annottext">checkQuestionMark :: (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison -&gt; Type -&gt; MetaInfo -&gt; InteractionId -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkQuestionMark"><span class="hs-identifier hs-var hs-var">checkQuestionMark</span></a></span></span><span> </span><span id="local-6989586621682144472"><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144472"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621682144473"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144473"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144474"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144474"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span id="local-6989586621682144475"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144475"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144476"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144476"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1638"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.interaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1639"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Found interaction point&quot;</span></span><span>
</span><span id="line-1640"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (IsAbstract -&gt; ArgName) -&gt; IsAbstract -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsAbstract -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(IsAbstract -&gt; TCMT IO Doc) -&gt; TCMT IO IsAbstract -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; IsAbstract) -&gt; TCMT IO IsAbstract
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCEnv -&gt; Lens' TCEnv IsAbstract -&gt; IsAbstract
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(IsAbstract -&gt; f IsAbstract) -&gt; TCEnv -&gt; f TCEnv
forall a. LensIsAbstract a =&gt; Lens' a IsAbstract
Lens' TCEnv IsAbstract
</span><a href="Agda.Syntax.Common.html#lensIsAbstract"><span class="hs-identifier hs-var">lensIsAbstract</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1641"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InteractionId -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144476"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1642"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-1643"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144474"><span class="hs-identifier hs-var">t0</span></a></span><span>
</span><span id="line-1644"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1645"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.interaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1646"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Raw:&quot;</span></span><span>
</span><span id="line-1647"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144474"><span class="hs-identifier hs-var">t0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1649"></span><span>  </span><span class="annot"><span class="annottext">MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkMeta"><span class="hs-identifier hs-var">checkMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144475"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; InteractionId -&gt; Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="Agda.TypeChecking.MetaVars.html#newQuestionMark%27"><span class="hs-identifier hs-var">newQuestionMark'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144472"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144476"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144473"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144474"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="hs-comment">-- Andreas, 2013-05-22 use unreduced type t0!</span><span>
</span><span id="line-1650"></span><span>
</span><span id="line-1651"></span><span class="annot"><span class="hs-comment">-- | Check an underscore without arguments.</span></span><span>
</span><span id="line-1652"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkUnderscore"><span class="hs-identifier hs-type">checkUnderscore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-type">A.MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1653"></span><span id="checkUnderscore"><span class="annot"><span class="annottext">checkUnderscore :: MetaInfo -&gt; Comparison -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkUnderscore"><span class="hs-identifier hs-var hs-var">checkUnderscore</span></a></span></span><span> </span><span id="local-6989586621682144487"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144487"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkMeta"><span class="hs-identifier hs-var">checkMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144487"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo
-&gt; RunMetaOccursCheck
-&gt; Comparison
-&gt; Type
-&gt; TCMT IO (MetaId, Term)
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
MetaInfo
-&gt; RunMetaOccursCheck -&gt; Comparison -&gt; Type -&gt; m (MetaId, Term)
</span><a href="Agda.TypeChecking.MetaVars.html#newValueMetaOfKind"><span class="hs-identifier hs-var">newValueMetaOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144487"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck
</span><a href="Agda.TypeChecking.Monad.Base.html#RunMetaOccursCheck"><span class="hs-identifier hs-var">RunMetaOccursCheck</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span class="annot"><span class="hs-comment">-- | Type check a meta variable.</span></span><span>
</span><span id="line-1656"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkMeta"><span class="hs-identifier hs-type">checkMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-type">A.MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1657"></span><span id="checkMeta"><span class="annot"><span class="annottext">checkMeta :: MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkMeta"><span class="hs-identifier hs-var hs-var">checkMeta</span></a></span></span><span> </span><span id="local-6989586621682144489"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144489"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144490"><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144490"><span class="hs-identifier hs-var">newMeta</span></a></span></span><span> </span><span id="local-6989586621682144491"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144491"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144492"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144492"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term, Type) -&gt; Term
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Term, Type) -&gt; Term) -&gt; TCM (Term, Type) -&gt; TCM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Maybe (Comparison, Type)
-&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkOrInferMeta"><span class="hs-identifier hs-var">checkOrInferMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144489"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144490"><span class="hs-identifier hs-var">newMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Comparison, Type) -&gt; Maybe (Comparison, Type)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144491"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144492"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span>
</span><span id="line-1659"></span><span class="hs-comment">-- | Infer the type of a meta variable.</span><span>
</span><span id="line-1660"></span><span class="hs-comment">--   If it is a new one, we create a new meta for its type.</span><span>
</span><span id="line-1661"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#inferMeta"><span class="hs-identifier hs-type">inferMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-type">A.MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1662"></span><span id="inferMeta"><span class="annot"><span class="annottext">inferMeta :: MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; TCM (Elims -&gt; Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferMeta"><span class="hs-identifier hs-var hs-var">inferMeta</span></a></span></span><span> </span><span id="local-6989586621682144495"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144495"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144496"><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144496"><span class="hs-identifier hs-var">newMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Elims -&gt; Term) -&gt; (Term, Type) -&gt; (Elims -&gt; Term, Type)
forall a c b. (a -&gt; c) -&gt; (a, b) -&gt; (c, b)
</span><a href="Agda.Utils.Tuple.html#mapFst"><span class="hs-identifier hs-var">mapFst</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-identifier hs-var">applyE</span></a></span><span> </span><span class="annot"><span class="annottext">((Term, Type) -&gt; (Elims -&gt; Term, Type))
-&gt; TCM (Term, Type) -&gt; TCM (Elims -&gt; Term, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Maybe (Comparison, Type)
-&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkOrInferMeta"><span class="hs-identifier hs-var">checkOrInferMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144495"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144496"><span class="hs-identifier hs-var">newMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Comparison, Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span class="hs-comment">-- | Type check a meta variable.</span><span>
</span><span id="line-1665"></span><span class="hs-comment">--   If its type is not given, we return its type, or a fresh one, if it is a new meta.</span><span>
</span><span id="line-1666"></span><span class="hs-comment">--   If its type is given, we check that the meta has this type, and we return the same</span><span>
</span><span id="line-1667"></span><span class="hs-comment">--   type.</span><span>
</span><span id="line-1668"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkOrInferMeta"><span class="hs-identifier hs-type">checkOrInferMeta</span></a></span><span>
</span><span id="line-1669"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-type">A.MetaInfo</span></a></span><span>
</span><span id="line-1670"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1673"></span><span id="checkOrInferMeta"><span class="annot"><span class="annottext">checkOrInferMeta :: MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Maybe (Comparison, Type)
-&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkOrInferMeta"><span class="hs-identifier hs-var hs-var">checkOrInferMeta</span></a></span></span><span> </span><span id="local-6989586621682144499"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144499"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144500"><span class="annot"><span class="annottext">Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="#local-6989586621682144500"><span class="hs-identifier hs-var">newMeta</span></a></span></span><span> </span><span id="local-6989586621682144501"><span class="annot"><span class="annottext">Maybe (Comparison, Type)
</span><a href="#local-6989586621682144501"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1674"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Maybe MetaId
</span><a href="Agda.Syntax.Info.html#metaNumber"><span class="hs-identifier hs-var">A.metaNumber</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144499"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1675"></span><span>    </span><span class="annot"><span class="annottext">Maybe MetaId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1676"></span><span>      </span><span class="annot"><span class="annottext">ScopeInfo -&gt; (ScopeInfo -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Info.html#metaScope"><span class="hs-identifier hs-var">A.metaScope</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144499"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-var">setScope</span></a></span><span>
</span><span id="line-1677"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682144504"><span class="annot"><a href="#local-6989586621682144504"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144505"><span class="annot"><a href="#local-6989586621682144505"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Comparison, Type)
-&gt; ((Comparison, Type) -&gt; TCMT IO (Comparison, Type))
-&gt; Maybe (Comparison, Type)
-&gt; TCMT IO (Comparison, Type)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpEq"><span class="hs-identifier hs-var">CmpEq</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; (Comparison, Type))
-&gt; TCM Type -&gt; TCMT IO (Comparison, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Type
</span><a href="Agda.TypeChecking.MetaVars.html#newTypeMeta_"><span class="hs-identifier hs-var">newTypeMeta_</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Comparison, Type) -&gt; TCMT IO (Comparison, Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Comparison, Type)
</span><a href="#local-6989586621682144501"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-1678"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682144506"><span class="annot"><a href="#local-6989586621682144506"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144507"><span class="annot"><a href="#local-6989586621682144507"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682144500"><span class="hs-identifier hs-type">newMeta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144504"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144505"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1679"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#setMetaNameSuggestion"><span class="hs-identifier hs-type">setMetaNameSuggestion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144506"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#metaNameSuggestion"><span class="hs-identifier hs-var">A.metaNameSuggestion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144499"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144507"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682144505"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1681"></span><span>    </span><span class="hs-comment">-- Rechecking an existing metavariable</span><span>
</span><span id="line-1682"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682144510"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144510"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1683"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144511"><span class="annot"><span class="annottext">v :: Term
</span><a href="#local-6989586621682144511"><span class="hs-identifier hs-var hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144510"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1684"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.meta.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1685"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking existing meta &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144511"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1686"></span><span>      </span><span id="local-6989586621682144512"><span class="annot"><a href="#local-6989586621682144512"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Type
forall (m :: * -&gt; *). ReadTCState m =&gt; MetaId -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#metaType"><span class="hs-identifier hs-var">metaType</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682144510"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1687"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.check&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1688"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;of type &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144512"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-1689"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682144501"><span class="hs-identifier hs-type">mt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1690"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Comparison, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Term, Type) -&gt; TCM (Term, Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144511"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144512"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144514"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144514"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144515"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144515"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144515"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; (Term, Type)) -&gt; TCM Term -&gt; TCM (Term, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Term -&gt; Type -&gt; Type -&gt; TCM Term
forall (m :: * -&gt; *).
(MonadConversion m, MonadTCM m) =&gt;
Comparison -&gt; Term -&gt; Type -&gt; Type -&gt; m Term
</span><a href="Agda.TypeChecking.Conversion.html#coerce"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144514"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144511"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144512"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144515"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1692"></span><span>
</span><span id="line-1693"></span><span class="hs-comment">-- | Turn a domain-free binding (e.g. lambda) into a domain-full one,</span><span>
</span><span id="line-1694"></span><span class="hs-comment">--   by inserting an underscore for the missing type.</span><span>
</span><span id="line-1695"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#domainFree"><span class="hs-identifier hs-type">domainFree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Binder%27"><span class="hs-identifier hs-type">A.Binder'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LamBinding"><span class="hs-identifier hs-type">A.LamBinding</span></a></span><span>
</span><span id="line-1696"></span><span id="domainFree"><span class="annot"><span class="annottext">domainFree :: ArgInfo -&gt; Binder' Name -&gt; LamBinding
</span><a href="Agda.TypeChecking.Rules.Term.html#domainFree"><span class="hs-identifier hs-var hs-var">domainFree</span></a></span></span><span> </span><span id="local-6989586621682144516"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144516"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144517"><span class="annot"><span class="annottext">Binder' Name
</span><a href="#local-6989586621682144517"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1697"></span><span>  </span><span class="annot"><span class="annottext">TypedBinding -&gt; LamBinding
</span><a href="Agda.Syntax.Abstract.html#DomainFull"><span class="hs-identifier hs-var">A.DomainFull</span></a></span><span> </span><span class="annot"><span class="annottext">(TypedBinding -&gt; LamBinding) -&gt; TypedBinding -&gt; LamBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Range
-&gt; List1 (NamedArg (Binder' BindName)) -&gt; Expr -&gt; TypedBinding
</span><a href="Agda.Syntax.Abstract.html#mkTBind"><span class="hs-identifier hs-var">A.mkTBind</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682144518"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg (Binder' BindName) -&gt; List1 (NamedArg (Binder' BindName))
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(NamedArg (Binder' BindName)
 -&gt; List1 (NamedArg (Binder' BindName)))
-&gt; NamedArg (Binder' BindName)
-&gt; List1 (NamedArg (Binder' BindName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Binder' BindName -&gt; NamedArg (Binder' BindName)
forall a. ArgInfo -&gt; a -&gt; NamedArg a
</span><a href="Agda.Syntax.Common.html#unnamedArg"><span class="hs-identifier hs-var">unnamedArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144516"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(Binder' BindName -&gt; NamedArg (Binder' BindName))
-&gt; Binder' BindName -&gt; NamedArg (Binder' BindName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; BindName) -&gt; Binder' Name -&gt; Binder' BindName
forall a b. (a -&gt; b) -&gt; Binder' a -&gt; Binder' b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; BindName
</span><a href="Agda.Syntax.Abstract.html#mkBindName"><span class="hs-identifier hs-var">A.mkBindName</span></a></span><span> </span><span class="annot"><span class="annottext">Binder' Name
</span><a href="#local-6989586621682144517"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span>               </span><span class="annot"><span class="annottext">(Expr -&gt; TypedBinding) -&gt; Expr -&gt; TypedBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Expr
</span><a href="Agda.Syntax.Abstract.html#Underscore"><span class="hs-identifier hs-var">A.Underscore</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144522"><span class="hs-identifier hs-var">underscoreInfo</span></a></span><span>
</span><span id="line-1699"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1700"></span><span>    </span><span id="local-6989586621682144518"><span class="annot"><span class="annottext">r :: Range
</span><a href="#local-6989586621682144518"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binder' Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Binder' Name
</span><a href="#local-6989586621682144517"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1701"></span><span>    </span><span id="local-6989586621682144522"><span class="annot"><span class="annottext">underscoreInfo :: MetaInfo
</span><a href="#local-6989586621682144522"><span class="hs-identifier hs-var hs-var">underscoreInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#MetaInfo"><span class="hs-identifier hs-type">A.MetaInfo</span></a></span><span>
</span><span id="line-1702"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">metaRange :: Range
</span><a href="Agda.Syntax.Info.html#metaRange"><span class="hs-identifier hs-var">A.metaRange</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682144518"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1703"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metaScope :: ScopeInfo
</span><a href="Agda.Syntax.Info.html#metaScope"><span class="hs-identifier hs-var">A.metaScope</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#emptyScopeInfo"><span class="hs-identifier hs-var">emptyScopeInfo</span></a></span><span>
</span><span id="line-1704"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metaNumber :: Maybe MetaId
</span><a href="Agda.Syntax.Info.html#metaNumber"><span class="hs-identifier hs-var">A.metaNumber</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe MetaId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1705"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metaNameSuggestion :: ArgName
</span><a href="Agda.Syntax.Info.html#metaNameSuggestion"><span class="hs-identifier hs-var">A.metaNameSuggestion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; ArgName) -&gt; Name -&gt; ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">A.nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Name -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Binder' Name -&gt; Name
forall a. Binder' a -&gt; a
</span><a href="Agda.Syntax.Abstract.html#binderName"><span class="hs-identifier hs-var">A.binderName</span></a></span><span> </span><span class="annot"><span class="annottext">Binder' Name
</span><a href="#local-6989586621682144517"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1706"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metaKind :: MetaKind
</span><a href="Agda.Syntax.Info.html#metaKind"><span class="hs-identifier hs-var">A.metaKind</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaKind
</span><a href="Agda.Syntax.Info.html#UnificationMeta"><span class="hs-identifier hs-var">A.UnificationMeta</span></a></span><span>
</span><span id="line-1707"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1708"></span><span>
</span><span id="line-1709"></span><span>
</span><span id="line-1710"></span><span class="hs-comment">-- | Check arguments whose value we already know.</span><span>
</span><span id="line-1711"></span><span class="hs-comment">--</span><span>
</span><span id="line-1712"></span><span class="hs-comment">--   This function can be used to check user-supplied parameters</span><span>
</span><span id="line-1713"></span><span class="hs-comment">--   we have already computed by inference.</span><span>
</span><span id="line-1714"></span><span class="hs-comment">--</span><span>
</span><span id="line-1715"></span><span class="hs-comment">--   Precondition: The type @t@ of the head has enough domains.</span><span>
</span><span id="line-1716"></span><span>
</span><span id="line-1717"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArguments"><span class="hs-identifier hs-type">checkKnownArguments</span></a></span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ User-supplied arguments (hidden ones may be missing).</span></span><span>
</span><span id="line-1719"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Inferred arguments (including hidden ones).</span></span><span>
</span><span id="line-1720"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Type of the head (must be Pi-type with enough domains).</span></span><span>
</span><span id="line-1721"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Remaining inferred arguments, remaining type.</span></span><span>
</span><span id="line-1722"></span><span id="checkKnownArguments"><span class="annot"><span class="annottext">checkKnownArguments :: [NamedArg Expr] -&gt; [Arg Term] -&gt; Type -&gt; TCM ([Arg Term], Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArguments"><span class="hs-identifier hs-var hs-var">checkKnownArguments</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span id="local-6989586621682144528"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144528"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682144529"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144529"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Arg Term], Type) -&gt; TCM ([Arg Term], Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144528"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144529"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1723"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArguments"><span class="hs-identifier hs-var">checkKnownArguments</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144530"><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144530"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682144531"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144531"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144532"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144532"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682144533"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144533"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1724"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682144534"><span class="annot"><a href="#local-6989586621682144534"><span class="hs-identifier hs-var">vs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144535"><span class="annot"><a href="#local-6989586621682144535"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; TCM ([Arg Term], Type) -&gt; TCM ([Arg Term], Type)
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144530"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ([Arg Term], Type) -&gt; TCM ([Arg Term], Type))
-&gt; TCM ([Arg Term], Type) -&gt; TCM ([Arg Term], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; [Arg Term] -&gt; Type -&gt; TCM ([Arg Term], Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArgument"><span class="hs-identifier hs-var">checkKnownArgument</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144530"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144532"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144533"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1725"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArguments"><span class="hs-identifier hs-type">checkKnownArguments</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144531"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144534"><span class="hs-identifier hs-type">vs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144535"><span class="hs-identifier hs-type">t'</span></a></span><span>
</span><span id="line-1726"></span><span>
</span><span id="line-1727"></span><span class="annot"><span class="hs-comment">-- | Check an argument whose value we already know.</span></span><span>
</span><span id="line-1728"></span><span>
</span><span id="line-1729"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArgument"><span class="hs-identifier hs-type">checkKnownArgument</span></a></span><span>
</span><span id="line-1730"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ User-supplied argument.</span></span><span>
</span><span id="line-1731"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Inferred arguments (including hidden ones).</span></span><span>
</span><span id="line-1732"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Type of the head (must be Pi-type with enough domains).</span></span><span>
</span><span id="line-1733"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Remaining inferred arguments, remaining type.</span></span><span>
</span><span id="line-1734"></span><span id="checkKnownArgument"><span class="annot"><span class="annottext">checkKnownArgument :: NamedArg Expr -&gt; [Arg Term] -&gt; Type -&gt; TCM ([Arg Term], Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArgument"><span class="hs-identifier hs-var hs-var">checkKnownArgument</span></a></span></span><span> </span><span id="local-6989586621682144537"><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144537"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ([Arg Term], Type)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ([Arg Term], Type))
-&gt; TypeError -&gt; TCM ([Arg Term], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#InvalidProjectionParameter"><span class="hs-identifier hs-var">InvalidProjectionParameter</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144537"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- Andreas, 2019-07-22, while #3353: we should use domName, not absName !!</span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- WAS:</span><span>
</span><span id="line-1737"></span><span class="hs-comment">-- checkKnownArgument arg@(Arg info e) (Arg _infov v : vs) t = do</span><span>
</span><span id="line-1738"></span><span class="hs-comment">--   (dom@Dom{domInfo = info',unDom = a}, b) &lt;- mustBePi t</span><span>
</span><span id="line-1739"></span><span class="hs-comment">--   -- Skip the arguments from vs that do not correspond to e</span><span>
</span><span id="line-1740"></span><span class="hs-comment">--   if not (sameHiding info info'</span><span>
</span><span id="line-1741"></span><span class="hs-comment">--           &amp;&amp; (visible info || maybe True (absName b ==) (bareNameOf e)))</span><span>
</span><span id="line-1742"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArgument"><span class="hs-identifier hs-var">checkKnownArgument</span></a></span><span> </span><span id="local-6989586621682144539"><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144539"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144540"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144540"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682144541"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682144541"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144542"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144542"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1743"></span><span>  </span><span class="hs-comment">-- Skip the arguments from vs that do not correspond to e</span><span>
</span><span id="line-1744"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682144543"><span class="annot"><a href="#local-6989586621682144543"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682144544"><span class="annot"><a href="#local-6989586621682144544"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144545"><span class="annot"><a href="#local-6989586621682144545"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Dom Type, Abs Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
Type -&gt; m (Dom Type, Abs Type)
</span><a href="Agda.TypeChecking.Telescope.html#mustBePi"><span class="hs-identifier hs-var">mustBePi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144542"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1745"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#fittingNamedArg"><span class="hs-identifier hs-type">fittingNamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144539"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144543"><span class="hs-identifier hs-type">dom</span></a></span><span>
</span><span id="line-1746"></span><span>    </span><span class="hs-comment">-- Continue with the next one</span><span>
</span><span id="line-1747"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkKnownArgument"><span class="hs-identifier hs-type">checkKnownArgument</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144539"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144541"><span class="hs-identifier hs-type">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144545"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-operator hs-type">`absApp`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144540"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1748"></span><span>    </span><span class="hs-comment">-- Found the right argument</span><span>
</span><span id="line-1749"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1750"></span><span>      </span><span id="local-6989586621682144550"><span class="annot"><a href="#local-6989586621682144550"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkNamedArg"><span class="hs-identifier hs-type">checkNamedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144539"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144544"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1751"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144544"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144550"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144540"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1752"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144541"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682144545"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-operator hs-type">`absApp`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144540"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1753"></span><span>
</span><span id="line-1754"></span><span class="annot"><span class="hs-comment">-- | Check a single argument.</span></span><span>
</span><span id="line-1755"></span><span>
</span><span id="line-1756"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkNamedArg"><span class="hs-identifier hs-type">checkNamedArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1757"></span><span id="checkNamedArg"><span class="annot"><span class="annottext">checkNamedArg :: NamedArg Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkNamedArg"><span class="hs-identifier hs-var hs-var">checkNamedArg</span></a></span></span><span> </span><span id="local-6989586621682144551"><span class="annot"><span class="annottext">arg :: NamedArg Expr
</span><a href="#local-6989586621682144551"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682144552"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144552"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144553"><span class="annot"><span class="annottext">Named_ Expr
</span><a href="#local-6989586621682144553"><span class="hs-identifier hs-var">e0</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144554"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144554"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1758"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144555"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621682144555"><span class="hs-identifier hs-var hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Named_ Expr -&gt; Expr
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="annot"><span class="annottext">Named_ Expr
</span><a href="#local-6989586621682144553"><span class="hs-identifier hs-var">e0</span></a></span><span>
</span><span id="line-1759"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144556"><span class="annot"><span class="annottext">x :: ArgName
</span><a href="#local-6989586621682144556"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Named_ Expr -&gt; ArgName
forall a.
(LensNamed a, NameOf a ~ WithOrigin (Ranged ArgName)) =&gt;
ArgName -&gt; a -&gt; ArgName
</span><a href="Agda.Syntax.Common.html#bareNameWithDefault"><span class="hs-identifier hs-var">bareNameWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Named_ Expr
</span><a href="#local-6989586621682144553"><span class="hs-identifier hs-var">e0</span></a></span><span>
</span><span id="line-1760"></span><span>  </span><span class="annot"><span class="annottext">Call -&gt; TCM Term -&gt; TCM Term
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExprCall"><span class="hs-identifier hs-var">CheckExprCall</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144555"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144554"><span class="hs-identifier hs-var">t0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1761"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.args.named&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1762"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking named arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1763"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; NamedArg Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144551"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144554"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1764"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1765"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.args.named&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">75</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM ()) -&gt; ArgName -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;  arg = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Expr -&gt; NamedArg Expr
forall a. ExprLike a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Abstract.Views.html#deepUnscope"><span class="hs-identifier hs-var">deepUnscope</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Expr
</span><a href="#local-6989586621682144551"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1766"></span><span>    </span><span class="hs-comment">-- Ulf, 2017-03-24: (#2172) Always treat explicit _ and ? as implicit</span><span>
</span><span id="line-1767"></span><span>    </span><span class="hs-comment">-- argument (i.e. solve with unification).</span><span>
</span><span id="line-1768"></span><span>    </span><span class="hs-comment">-- Andreas, 2024-03-07, issue #2829: Except when we don't.</span><span>
</span><span id="line-1769"></span><span>    </span><span class="hs-comment">-- E.g. when 'insertImplicitPatSynArgs' inserted an instance underscore.</span><span>
</span><span id="line-1770"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144559"><span class="annot"><span class="annottext">checkU :: MetaInfo -&gt; TCM Term
</span><a href="#local-6989586621682144559"><span class="hs-identifier hs-var hs-var hs-var">checkU</span></a></span></span><span> </span><span id="local-6989586621682144560"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144560"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; (Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkMeta"><span class="hs-identifier hs-var">checkMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144560"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaKind
-&gt; ArgInfo
-&gt; ArgName
-&gt; Comparison
-&gt; Type
-&gt; TCMT IO (MetaId, Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadMetaSolver m) =&gt;
MetaKind
-&gt; ArgInfo -&gt; ArgName -&gt; Comparison -&gt; Type -&gt; m (MetaId, Term)
</span><a href="Agda.TypeChecking.Implicit.html#newMetaArg"><span class="hs-identifier hs-var">newMetaArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; MetaKind
</span><a href="Agda.Syntax.Info.html#metaKind"><span class="hs-identifier hs-var">A.metaKind</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144560"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144552"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682144556"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144554"><span class="hs-identifier hs-var">t0</span></a></span><span>
</span><span id="line-1771"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144562"><span class="annot"><span class="annottext">checkQ :: MetaInfo -&gt; InteractionId -&gt; TCM Term
</span><a href="#local-6989586621682144562"><span class="hs-identifier hs-var hs-var">checkQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term))
-&gt; Comparison -&gt; Type -&gt; MetaInfo -&gt; InteractionId -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkQuestionMark"><span class="hs-identifier hs-var">checkQuestionMark</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgName -&gt; Comparison -&gt; Type -&gt; TCMT IO (MetaId, Term)
</span><a href="Agda.TypeChecking.Implicit.html#newInteractionMetaArg"><span class="hs-identifier hs-var">newInteractionMetaArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144552"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621682144556"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144554"><span class="hs-identifier hs-var">t0</span></a></span><span>
</span><span id="line-1772"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Bool
</span><a href="#local-6989586621682144564"><span class="hs-identifier hs-var">isHole</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144555"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144555"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144554"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1773"></span><span>      </span><span class="hs-comment">-- Note: we need localScope_ here,</span><span>
</span><span id="line-1774"></span><span>      </span><span class="hs-comment">-- as scopedExpr manipulates the scope in the state.</span><span>
</span><span id="line-1775"></span><span>      </span><span class="hs-comment">-- However, we may not pull localScope_ over checkExpr!</span><span>
</span><span id="line-1776"></span><span>      </span><span class="hs-comment">-- This is why we first test for isHole, and only do</span><span>
</span><span id="line-1777"></span><span>      </span><span class="hs-comment">-- scope manipulations if we actually handle the checking</span><span>
</span><span id="line-1778"></span><span>      </span><span class="hs-comment">-- of e here (and not pass it to checkExpr).</span><span>
</span><span id="line-1779"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; TCM Expr
</span><a href="Agda.TypeChecking.Rules.Term.html#scopedExpr"><span class="hs-identifier hs-var">scopedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144555"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Expr -&gt; (Expr -&gt; TCM Term) -&gt; TCM Term
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1780"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Underscore"><span class="hs-identifier hs-type">A.Underscore</span></a></span><span> </span><span id="local-6989586621682144565"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144565"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">MetaInfo -&gt; TCM Term
</span><a href="#local-6989586621682144559"><span class="hs-identifier hs-var">checkU</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144565"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1781"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuestionMark"><span class="hs-identifier hs-type">A.QuestionMark</span></a></span><span> </span><span id="local-6989586621682144566"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144566"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144567"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144567"><span class="hs-identifier hs-var">ii</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; InteractionId -&gt; TCM Term
</span><a href="#local-6989586621682144562"><span class="hs-identifier hs-var">checkQ</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682144566"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621682144567"><span class="hs-identifier hs-var">ii</span></a></span><span>
</span><span id="line-1782"></span><span>        </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Term
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1783"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1784"></span><span>  </span><span id="local-6989586621682144564"><span class="annot"><span class="annottext">isHole :: Expr -&gt; Bool
</span><a href="#local-6989586621682144564"><span class="hs-identifier hs-var hs-var">isHole</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Underscore"><span class="hs-identifier hs-type">A.Underscore</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1785"></span><span>  </span><span class="annot"><a href="#local-6989586621682144564"><span class="hs-identifier hs-var">isHole</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#QuestionMark"><span class="hs-identifier hs-type">A.QuestionMark</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1786"></span><span>  </span><span class="annot"><a href="#local-6989586621682144564"><span class="hs-identifier hs-var">isHole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopedExpr"><span class="hs-identifier hs-type">A.ScopedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144568"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144568"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Bool
</span><a href="#local-6989586621682144564"><span class="hs-identifier hs-var">isHole</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144568"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1787"></span><span>  </span><span class="annot"><a href="#local-6989586621682144564"><span class="hs-identifier hs-var">isHole</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span class="hs-comment">-- | Infer the type of an expression. Implemented by checking against a meta</span><span>
</span><span id="line-1790"></span><span class="hs-comment">--   variable.  Except for neutrals, for them a polymorphic type is inferred.</span><span>
</span><span id="line-1791"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-type">inferExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span class="hs-comment">-- inferExpr e = inferOrCheck e Nothing</span><span>
</span><span id="line-1793"></span><span id="inferExpr"><span class="annot"><span class="annottext">inferExpr :: Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-var hs-var">inferExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExpandHidden -&gt; Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr%27"><span class="hs-identifier hs-var">inferExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">ExpandHidden
</span><a href="Agda.TypeChecking.Monad.Base.html#DontExpandLast"><span class="hs-identifier hs-var">DontExpandLast</span></a></span><span>
</span><span id="line-1794"></span><span>
</span><span id="line-1795"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#inferExpr%27"><span class="hs-identifier hs-type">inferExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandHidden"><span class="hs-identifier hs-type">ExpandHidden</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1796"></span><span id="inferExpr%27"><span class="annot"><span class="annottext">inferExpr' :: ExpandHidden -&gt; Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr%27"><span class="hs-identifier hs-var hs-var">inferExpr'</span></a></span></span><span> </span><span id="local-6989586621682144571"><span class="annot"><span class="annottext">ExpandHidden
</span><a href="#local-6989586621682144571"><span class="hs-identifier hs-var">exh</span></a></span></span><span> </span><span id="local-6989586621682144572"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144572"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Call -&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#InferExpr"><span class="hs-identifier hs-var">InferExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144572"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM (Term, Type) -&gt; TCM (Term, Type))
-&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1797"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#Application"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span id="local-6989586621682144574"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144574"><span class="hs-identifier hs-var hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682144575"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144575"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; AppView' Expr
</span><a href="Agda.Syntax.Abstract.Views.html#appView"><span class="hs-identifier hs-var">appView</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144572"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1798"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.infer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1799"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;inferExpr': appView of &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144572"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1800"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  hd   = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144574"><span class="hs-identifier hs-var">hd</span></a></span><span>
</span><span id="line-1801"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  args = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr] -&gt; TCMT IO Doc
forall a ce (m :: * -&gt; *).
(ToConcrete a, ConOfAbs a ~ [ce], Pretty ce, MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyAs"><span class="hs-identifier hs-var">prettyAs</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144575"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1802"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1803"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.infer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1804"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;  hd (raw) = &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144574"><span class="hs-identifier hs-var">hd</span></a></span><span>
</span><span id="line-1805"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1806"></span><span>  </span><span class="annot"><span class="annottext">ExpandHidden -&gt; Expr -&gt; [NamedArg Expr] -&gt; Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Application.html#inferApplication"><span class="hs-identifier hs-var">inferApplication</span></a></span><span> </span><span class="annot"><span class="annottext">ExpandHidden
</span><a href="#local-6989586621682144571"><span class="hs-identifier hs-var">exh</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144574"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144575"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144572"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1807"></span><span>
</span><span id="line-1808"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-type">defOrVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1809"></span><span id="defOrVar"><span class="annot"><span class="annottext">defOrVar :: Expr -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var hs-var">defOrVar</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Var"><span class="hs-identifier hs-type">A.Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1810"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var">defOrVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Def%27"><span class="hs-identifier hs-type">A.Def'</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1811"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var">defOrVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Proj"><span class="hs-identifier hs-type">A.Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1812"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var">defOrVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopedExpr"><span class="hs-identifier hs-type">A.ScopedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144579"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144579"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var">defOrVar</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144579"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1813"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var">defOrVar</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1814"></span><span>
</span><span id="line-1815"></span><span class="hs-comment">-- | Used to check aliases @f = e@.</span><span>
</span><span id="line-1816"></span><span class="hs-comment">--   Switches off 'ExpandLast' for the checking of top-level application.</span><span>
</span><span id="line-1817"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkDontExpandLast"><span class="hs-identifier hs-type">checkDontExpandLast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1818"></span><span id="checkDontExpandLast"><span class="annot"><span class="annottext">checkDontExpandLast :: Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkDontExpandLast"><span class="hs-identifier hs-var hs-var">checkDontExpandLast</span></a></span></span><span> </span><span id="local-6989586621682144581"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144581"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682144582"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144582"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682144583"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144583"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144582"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1819"></span><span>  </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#Application"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span id="local-6989586621682144584"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144584"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682144585"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144585"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; AppView' Expr
</span><a href="Agda.Syntax.Abstract.Views.html#appView"><span class="hs-identifier hs-var">appView</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144582"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Expr -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#defOrVar"><span class="hs-identifier hs-var">defOrVar</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144584"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1820"></span><span>    </span><span class="annot"><span class="annottext">Call -&gt; TCM Term -&gt; TCM Term
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckExprCall"><span class="hs-identifier hs-var">CheckExprCall</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144581"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144582"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144583"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Term -&gt; TCM Term
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Env.html#dontExpandLast"><span class="hs-identifier hs-var">dontExpandLast</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1821"></span><span>      </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; [NamedArg Expr] -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Application.html#checkApplication"><span class="hs-identifier hs-var">checkApplication</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144581"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144584"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682144585"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144582"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144583"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1822"></span><span>  </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682144581"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144582"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144583"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- note that checkExpr always sets ExpandLast</span><span>
</span><span id="line-1823"></span><span>
</span><span id="line-1824"></span><span class="annot"><span class="hs-comment">-- | Check whether a de Bruijn index is bound by a module telescope.</span></span><span>
</span><span id="line-1825"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isModuleFreeVar"><span class="hs-identifier hs-type">isModuleFreeVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1826"></span><span id="isModuleFreeVar"><span class="annot"><span class="annottext">isModuleFreeVar :: Int -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#isModuleFreeVar"><span class="hs-identifier hs-var hs-var">isModuleFreeVar</span></a></span></span><span> </span><span id="local-6989586621682144588"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144588"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1827"></span><span>  </span><span id="local-6989586621682144589"><span class="annot"><a href="#local-6989586621682144589"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TCMT IO [Arg Term]
forall (m :: * -&gt; *).
(Functor m, Applicative m, HasOptions m, MonadTCEnv m,
 ReadTCState m, MonadDebug m) =&gt;
ModuleName -&gt; m [Arg Term]
</span><a href="Agda.TypeChecking.Monad.Signature.html#moduleParamsToApply"><span class="hs-identifier hs-var">moduleParamsToApply</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; TCMT IO [Arg Term])
-&gt; TCMT IO ModuleName -&gt; TCMT IO [Arg Term]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO ModuleName
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m ModuleName
</span><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-var">currentModule</span></a></span><span>
</span><span id="line-1828"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">==</span></span><span> </span><span class="annot"><span class="hs-identifier">Var</span></span><span> </span><span class="annot"><span class="hs-identifier">i</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144589"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span class="hs-comment">-- | Infer the type of an expression, and if it is of the form</span><span>
</span><span id="line-1831"></span><span class="hs-comment">--   @{tel} -&gt; D vs@ for some datatype @D@ then insert the hidden</span><span>
</span><span id="line-1832"></span><span class="hs-comment">--   arguments.  Otherwise, leave the type polymorphic.</span><span>
</span><span id="line-1833"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#inferExprForWith"><span class="hs-identifier hs-type">inferExprForWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1834"></span><span id="inferExprForWith"><span class="annot"><span class="annottext">inferExprForWith :: Arg Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExprForWith"><span class="hs-identifier hs-var hs-var">inferExprForWith</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682144593"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144593"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144594"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144594"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a. ArgName -&gt; Int -&gt; ArgName -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseBracket"><span class="hs-identifier hs-var">verboseBracket</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.with.infer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;inferExprForWith&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Term, Type) -&gt; TCM (Term, Type))
-&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1835"></span><span>  </span><span class="annot"><span class="annottext">Relevance -&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall (tcm :: * -&gt; *) r a.
(MonadTCEnv tcm, LensRelevance r) =&gt;
r -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyRelevanceToContext"><span class="hs-identifier hs-var">applyRelevanceToContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144593"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM (Term, Type) -&gt; TCM (Term, Type))
-&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1836"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.with.infer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;inferExprForWith &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144594"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1837"></span><span>    </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span>  </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.with.infer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM ()) -&gt; ArgName -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;inferExprForWith &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Expr
forall a. ExprLike a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Abstract.Views.html#deepUnscope"><span class="hs-identifier hs-var">deepUnscope</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144594"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1838"></span><span>    </span><span class="annot"><span class="annottext">Call -&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#InferExpr"><span class="hs-identifier hs-var">InferExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144594"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM (Term, Type) -&gt; TCM (Term, Type))
-&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1839"></span><span>      </span><span class="hs-comment">-- Andreas, 2024-02-26, issue #7148:</span><span>
</span><span id="line-1840"></span><span>      </span><span class="hs-comment">-- The 'instantiateFull' here performs necessary eta-contraction,</span><span>
</span><span id="line-1841"></span><span>      </span><span class="hs-comment">-- both for future with-abstraction,</span><span>
</span><span id="line-1842"></span><span>      </span><span class="hs-comment">-- and for testing whether v is a variable modulo eta.</span><span>
</span><span id="line-1843"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682144595"><span class="annot"><a href="#local-6989586621682144595"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144596"><span class="annot"><a href="#local-6989586621682144596"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Term, Type) -&gt; TCM (Term, Type)
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">((Term, Type) -&gt; TCM (Term, Type))
-&gt; TCM (Term, Type) -&gt; TCM (Term, Type)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-var">inferExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144594"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1844"></span><span>      </span><span id="local-6989586621682144597"><span class="annot"><a href="#local-6989586621682144597"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144595"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1845"></span><span>      </span><span class="hs-comment">-- Andreas 2014-11-06, issue 1342.</span><span>
</span><span id="line-1846"></span><span>      </span><span class="hs-comment">-- Check that we do not `with` on a module parameter!</span><span>
</span><span id="line-1847"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682144597"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1848"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682144598"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144598"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.Rules.Term.html#isModuleFreeVar"><span class="hs-identifier hs-var">isModuleFreeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144598"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1849"></span><span>          </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.with.infer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1850"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; ArgName -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;with expression is variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144598"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1851"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;current modules = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (ModuleName -&gt; ArgName) -&gt; ModuleName -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; TCMT IO Doc) -&gt; TCMT IO ModuleName -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO ModuleName
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m ModuleName
</span><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-var">currentModule</span></a></span><span>
</span><span id="line-1852"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;current module free vars = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; (Int -&gt; ArgName) -&gt; Int -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TCMT IO Doc) -&gt; TCMT IO Int -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Int
</span><a href="Agda.TypeChecking.Monad.Signature.html#getCurrentModuleFreeVars"><span class="hs-identifier hs-var">getCurrentModuleFreeVars</span></a></span><span>
</span><span id="line-1853"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;context size = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc) -&gt; (Int -&gt; ArgName) -&gt; Int -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TCMT IO Doc) -&gt; TCMT IO Int -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Int
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Int
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-var">getContextSize</span></a></span><span>
</span><span id="line-1854"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;current context = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; TCMT IO Doc) -&gt; TCMT IO Telescope -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-1855"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1856"></span><span>          </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Term -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WithOnFreeVariable"><span class="hs-identifier hs-var">WithOnFreeVariable</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144594"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144597"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1857"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1858"></span><span>      </span><span class="hs-comment">-- Possibly insert hidden arguments.</span><span>
</span><span id="line-1859"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682144603"><span class="annot"><a href="#local-6989586621682144603"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682144604"><span class="annot"><a href="#local-6989586621682144604"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewUpTo%27"><span class="hs-identifier hs-type">telViewUpTo'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-type">visible</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144596"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1860"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682144606"><span class="annot"><a href="#local-6989586621682144606"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144607"><span class="annot"><a href="#local-6989586621682144607"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144604"><span class="hs-identifier hs-type">t0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1861"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682144608"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144608"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682144609"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682144609"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1862"></span><span>          </span><span class="annot"><span class="annottext">QName -&gt; TCM (Maybe DataOrRecord)
</span><a href="Agda.TypeChecking.Datatypes.html#isDataOrRecordType"><span class="hs-identifier hs-var">isDataOrRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682144608"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Maybe DataOrRecord)
-&gt; (Maybe DataOrRecord -&gt; TCM (Term, Type)) -&gt; TCM (Term, Type)
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1863"></span><span>            </span><span class="annot"><span class="annottext">Maybe DataOrRecord
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Term, Type) -&gt; TCM (Term, Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144597"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144596"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1865"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682144611"><span class="annot"><a href="#local-6989586621682144611"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144612"><span class="annot"><a href="#local-6989586621682144612"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Hiding -&gt; Bool) -&gt; Type -&gt; TCM ([Arg Term], Type)
forall (m :: * -&gt; *).
(PureTCM m, MonadMetaSolver m, MonadTCM m) =&gt;
Int -&gt; (Hiding -&gt; Bool) -&gt; Type -&gt; m ([Arg Term], Type)
</span><a href="Agda.TypeChecking.Implicit.html#implicitArgs"><span class="hs-identifier hs-var">implicitArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-var">notVisible</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144596"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1866"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144597"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-type">`apply`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144611"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682144612"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1867"></span><span>        </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Term, Type) -&gt; TCM (Term, Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144597"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144596"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1868"></span><span>      </span><span class="hs-comment">-- #6868, #7113: trigger instance search to resolve instances in with-expression</span><span>
</span><span id="line-1869"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#solveAwakeConstraints"><span class="hs-identifier hs-type">solveAwakeConstraints</span></a></span><span>
</span><span id="line-1870"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682144606"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682144607"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1871"></span><span>
</span><span id="line-1872"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1873"></span><span class="annot"><span class="hs-comment">-- * Let bindings</span></span><span>
</span><span id="line-1874"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-1875"></span><span>
</span><span id="line-1876"></span><span id="local-6989586621682144615"><span id="local-6989586621682144616"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings%27"><span class="hs-identifier hs-type">checkLetBindings'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682144615"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682144615"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144616"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1877"></span><span id="checkLetBindings%27"><span class="annot"><span class="annottext">checkLetBindings' :: forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings%27"><span class="hs-identifier hs-var hs-var">checkLetBindings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LetBinding -&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a)
-&gt; (TCM a -&gt; TCM a) -&gt; t LetBinding -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">(.)</span></span><span> </span><span class="annot"><span class="annottext">((TCM a -&gt; TCM a) -&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a)
-&gt; (LetBinding -&gt; TCM a -&gt; TCM a)
-&gt; LetBinding
-&gt; (TCM a -&gt; TCM a)
-&gt; TCM a
-&gt; TCM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LetBinding -&gt; TCM a -&gt; TCM a
forall a. LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var">checkLetBinding'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCM a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1878"></span><span>
</span><span id="line-1879"></span><span id="local-6989586621682144621"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-type">checkLetBinding'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144621"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144621"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1880"></span><span>
</span><span id="line-1881"></span><span id="checkLetBinding%27"><span class="annot"><span class="annottext">checkLetBinding' :: forall a. LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var hs-var">checkLetBinding'</span></a></span></span><span> </span><span id="local-6989586621682144829"><span class="annot"><span class="annottext">b :: LetBinding
</span><a href="#local-6989586621682144829"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBind"><span class="hs-identifier hs-type">A.LetBind</span></a></span><span> </span><span id="local-6989586621682144830"><span class="annot"><span class="annottext">LetInfo
</span><a href="#local-6989586621682144830"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144831"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144831"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144832"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682144832"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682144833"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144833"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682144834"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144834"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144835"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682144835"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1882"></span><span>  </span><span class="hs-comment">-- #4131: Only DontExpandLast if no user written type signature</span><span>
</span><span id="line-1883"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1884"></span><span>    </span><span id="local-6989586621682144836"><span class="annot"><span class="annottext">check :: Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="#local-6989586621682144836"><span class="hs-identifier hs-var hs-var hs-var">check</span></a></span></span><span>
</span><span id="line-1885"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Origin
forall a. LensOrigin a =&gt; a -&gt; Origin
</span><a href="Agda.Syntax.Common.html#getOrigin"><span class="hs-identifier hs-var">getOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144831"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; Origin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkDontExpandLast"><span class="hs-identifier hs-var">checkDontExpandLast</span></a></span><span>
</span><span id="line-1886"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span>
</span><span id="line-1887"></span><span>
</span><span id="line-1888"></span><span>  </span><span id="local-6989586621682144838"><span class="annot"><a href="#local-6989586621682144838"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144833"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1889"></span><span>  </span><span id="local-6989586621682144839"><span class="annot"><a href="#local-6989586621682144839"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-type">applyModalityToContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144831"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682144836"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-type">CmpLeq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144834"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144838"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding"><span class="hs-identifier hs-type">addLetBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144831"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#UserWritten"><span class="hs-identifier hs-type">UserWritten</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144832"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144839"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144838"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144835"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-1892"></span><span>
</span><span id="line-1893"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var">checkLetBinding'</span></a></span><span> </span><span id="local-6989586621682144840"><span class="annot"><span class="annottext">b :: LetBinding
</span><a href="#local-6989586621682144840"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetAxiom"><span class="hs-identifier hs-type">A.LetAxiom</span></a></span><span> </span><span id="local-6989586621682144842"><span class="annot"><span class="annottext">LetInfo
</span><a href="#local-6989586621682144842"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144843"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144843"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682144844"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682144844"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682144845"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144845"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144846"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682144846"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1894"></span><span>  </span><span id="local-6989586621682144847"><span class="annot"><a href="#local-6989586621682144847"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Type -&gt; TCM Type
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Modality.html#workOnTypes"><span class="hs-identifier hs-var">workOnTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Type -&gt; TCM Type) -&gt; TCM Type -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144845"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1895"></span><span>  </span><span id="local-6989586621682144848"><span class="annot"><a href="#local-6989586621682144848"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-type">currentModule</span></a></span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span>  </span><span class="hs-comment">-- Note: if addConstant is called under a nontrivial context then</span><span>
</span><span id="line-1898"></span><span>  </span><span class="hs-comment">-- it'll automatically quantify the type we give it over the context</span><span>
</span><span id="line-1899"></span><span>  </span><span id="local-6989586621682144849"><span class="annot"><a href="#local-6989586621682144849"><span class="hs-identifier hs-var">axn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qualify"><span class="hs-identifier hs-type">qualify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144848"><span class="hs-identifier hs-type">current</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#freshName_"><span class="hs-identifier hs-type">freshName_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144844"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1900"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant%27"><span class="hs-identifier hs-type">addConstant'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144849"><span class="hs-identifier hs-type">axn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144843"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144847"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defaultAxiom"><span class="hs-identifier hs-type">defaultAxiom</span></a></span><span>
</span><span id="line-1901"></span><span>
</span><span id="line-1902"></span><span>  </span><span id="local-6989586621682144852"><span class="annot"><a href="#local-6989586621682144852"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144849"><span class="hs-identifier hs-type">axn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextArgs"><span class="hs-identifier hs-type">getContextArgs</span></a></span><span>
</span><span id="line-1903"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding"><span class="hs-identifier hs-type">addLetBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144843"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#UserWritten"><span class="hs-identifier hs-type">UserWritten</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144844"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144852"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144847"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144846"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-1904"></span><span>
</span><span id="line-1905"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var">checkLetBinding'</span></a></span><span> </span><span id="local-6989586621682144853"><span class="annot"><span class="annottext">b :: LetBinding
</span><a href="#local-6989586621682144853"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetPatBind"><span class="hs-identifier hs-type">A.LetPatBind</span></a></span><span> </span><span id="local-6989586621682144854"><span class="annot"><span class="annottext">LetInfo
</span><a href="#local-6989586621682144854"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144855"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144855"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682144856"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682144856"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682144857"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682144857"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144858"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682144858"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1906"></span><span>    </span><span id="local-6989586621682144859"><span class="annot"><a href="#local-6989586621682144859"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCM Pattern
forall a. ExpandPatternSynonyms a =&gt; a -&gt; TCM a
</span><a href="Agda.TypeChecking.Patterns.Abstract.html#expandPatternSynonyms"><span class="hs-identifier hs-var">expandPatternSynonyms</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682144856"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1907"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682144861"><span class="annot"><a href="#local-6989586621682144861"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144862"><span class="annot"><a href="#local-6989586621682144862"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-type">applyModalityToContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144855"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#inferExpr%27"><span class="hs-identifier hs-type">inferExpr'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144857"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-1908"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- construct a type  t -&gt; dummy  for use in checkLeftHandSide</span><span>
</span><span id="line-1909"></span><span>        </span><span id="local-6989586621682144863"><span class="annot"><a href="#local-6989586621682144863"><span class="hs-identifier hs-var hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144862"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-var">Pi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Type -&gt; Dom Type
forall a. ArgInfo -&gt; a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultArgDom"><span class="hs-identifier hs-var">defaultArgDom</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144855"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682144862"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; Type -&gt; Abs Type
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-var">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
forall a. Underscore a =&gt; a
</span><a href="Agda.Syntax.Common.html#underscore"><span class="hs-identifier hs-var">underscore</span></a></span><span> </span><span class="annot"><span class="annottext">Type
HasCallStack =&gt; Type
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TYPE__"><span class="hs-identifier hs-var">__DUMMY_TYPE__</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1910"></span><span>        </span><span id="local-6989586621682144865"><span class="annot"><a href="#local-6989586621682144865"><span class="hs-identifier hs-var hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo
-&gt; Named (WithOrigin (Ranged ArgName)) Pattern -&gt; NamedArg Pattern
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682144855"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (WithOrigin (Ranged ArgName))
-&gt; Pattern -&gt; Named (WithOrigin (Ranged ArgName)) Pattern
forall name a. Maybe name -&gt; a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-var">Named</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WithOrigin (Ranged ArgName))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682144859"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1911"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.let.pattern&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1912"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;let-binding pattern p at type t&quot;</span></span><span>
</span><span id="line-1913"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1914"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;p (A) =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144859"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-1915"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;t     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144862"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1916"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cxtRel=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eRelevance"><span class="hs-identifier hs-type">eRelevance</span></a></span><span>
</span><span id="line-1917"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cxtQnt=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eQuantity"><span class="hs-identifier hs-type">eQuantity</span></a></span><span>
</span><span id="line-1918"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1919"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1920"></span><span>    </span><span id="local-6989586621682144870"><span class="annot"><a href="#local-6989586621682144870"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-type">getContextSize</span></a></span><span>
</span><span id="line-1921"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLeftHandSide"><span class="hs-identifier hs-type">checkLeftHandSide</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckPattern"><span class="hs-identifier hs-type">CheckPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144859"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-type">EmptyTel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144862"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-type">noRange</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682144865"><span class="hs-identifier hs-type">p0</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682144863"><span class="hs-identifier hs-type">t0</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144874"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682144874"><span class="hs-identifier hs-var">delta0</span></a></span></span><span> </span><span id="local-6989586621682144875"><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682144875"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144876"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682144876"><span class="hs-identifier hs-var">_t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682144877"><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682144877"><span class="hs-identifier hs-var">asb</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[AsBinding] -&gt; TCM a -&gt; TCM a
forall a. [AsBinding] -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-var">bindAsPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682144877"><span class="hs-identifier hs-var">asb</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1922"></span><span>          </span><span class="hs-comment">-- After dropping the free variable patterns there should be a single pattern left.</span><span>
</span><span id="line-1923"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144879"><span class="annot"><span class="annottext">p :: DeBruijnPattern
</span><a href="#local-6989586621682144879"><span class="hs-identifier hs-var hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NAPs -&gt; NAPs
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144870"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">NAPs
</span><a href="#local-6989586621682144875"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682144881"><span class="annot"><span class="annottext">Arg (Named_ DeBruijnPattern)
</span><a href="#local-6989586621682144881"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arg (Named_ DeBruijnPattern) -&gt; DeBruijnPattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Named_ DeBruijnPattern)
</span><a href="#local-6989586621682144881"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NAPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1924"></span><span>          </span><span class="hs-comment">-- Also strip the context variables from the telescope</span><span>
</span><span id="line-1925"></span><span>          </span><span id="local-6989586621682144882"><span class="annot"><span class="annottext">delta :: Telescope
</span><a href="#local-6989586621682144882"><span class="hs-identifier hs-var hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListTel -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">(ListTel -&gt; Telescope) -&gt; ListTel -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ListTel -&gt; ListTel
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144870"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">(ListTel -&gt; ListTel) -&gt; ListTel -&gt; ListTel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; ListTel
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682144874"><span class="hs-identifier hs-var">delta0</span></a></span><span>
</span><span id="line-1926"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.let.pattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1927"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;p (I) =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; DeBruijnPattern -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682144879"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1928"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682144882"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-1929"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;cxtRel=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Relevance -&gt; TCMT IO Doc) -&gt; TCMT IO Relevance -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv Relevance -&gt; TCMT IO Relevance
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Relevance -&gt; f Relevance) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv Relevance
</span><a href="Agda.TypeChecking.Monad.Base.html#eRelevance"><span class="hs-identifier hs-var">eRelevance</span></a></span><span>
</span><span id="line-1930"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;cxtQnt=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity -&gt; TCMT IO Doc) -&gt; TCMT IO Quantity -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv Quantity -&gt; TCMT IO Quantity
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity -&gt; f Quantity) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv Quantity
</span><a href="Agda.TypeChecking.Monad.Base.html#eQuantity"><span class="hs-identifier hs-var">eQuantity</span></a></span><span>
</span><span id="line-1931"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1932"></span><span>      </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.term.let.pattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1933"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;p (I) =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO Doc)
-&gt; (DeBruijnPattern -&gt; ArgName) -&gt; DeBruijnPattern -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682144879"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1934"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1935"></span><span>      </span><span class="hs-comment">-- We translate it into a list of projections.</span><span>
</span><span id="line-1936"></span><span>      </span><span id="local-6989586621682144888"><span class="annot"><a href="#local-6989586621682144888"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCM [Term -&gt; Term]
</span><a href="Agda.TypeChecking.RecordPatterns.html#recordPatternToProjections"><span class="hs-identifier hs-var">recordPatternToProjections</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682144879"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1937"></span><span>      </span><span class="hs-comment">-- We remove the bindings for the pattern variables from the context.</span><span>
</span><span id="line-1938"></span><span>      </span><span id="local-6989586621682144890"><span class="annot"><a href="#local-6989586621682144890"><span class="hs-identifier hs-var">cxt0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-type">getContext</span></a></span><span>
</span><span id="line-1939"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682144892"><span class="annot"><a href="#local-6989586621682144892"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682144893"><span class="annot"><a href="#local-6989586621682144893"><span class="hs-identifier hs-var">cxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144882"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144890"><span class="hs-identifier hs-type">cxt0</span></a></span><span>
</span><span id="line-1940"></span><span>          </span><span id="local-6989586621682144895"><span class="annot"><a href="#local-6989586621682144895"><span class="hs-identifier hs-var hs-var">toDrop</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ContextEntry] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ContextEntry]
</span><a href="#local-6989586621682144892"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1941"></span><span>
</span><span id="line-1942"></span><span>          </span><span class="hs-comment">-- We create a substitution for the let-bound variables</span><span>
</span><span id="line-1943"></span><span>          </span><span class="hs-comment">-- (unfortunately, we cannot refer to x in internal syntax</span><span>
</span><span id="line-1944"></span><span>          </span><span class="hs-comment">-- so we have to copy v).</span><span>
</span><span id="line-1945"></span><span>          </span><span id="local-6989586621682144896"><span class="annot"><a href="#local-6989586621682144896"><span class="hs-identifier hs-var hs-var">sigma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Term -&gt; Term) -&gt; Term) -&gt; [Term -&gt; Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682144861"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term -&gt; Term]
</span><a href="#local-6989586621682144888"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1946"></span><span>          </span><span class="hs-comment">-- We apply the types of the let bound-variables to this substitution.</span><span>
</span><span id="line-1947"></span><span>          </span><span class="hs-comment">-- The 0th variable in a context is the last one, so we reverse.</span><span>
</span><span id="line-1948"></span><span>          </span><span class="hs-comment">-- Further, we need to lower all other de Bruijn indices by</span><span>
</span><span id="line-1949"></span><span>          </span><span class="hs-comment">-- the size of delta, so we append the identity substitution.</span><span>
</span><span id="line-1950"></span><span>          </span><span id="local-6989586621682144897"><span class="annot"><a href="#local-6989586621682144897"><span class="hs-identifier hs-var hs-var">sub</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-var">parallelS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term] -&gt; [Term]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682144896"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1951"></span><span>
</span><span id="line-1952"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-type">updateContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144897"><span class="hs-identifier hs-type">sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">drop</span></span><span> </span><span class="annot"><a href="#local-6989586621682144895"><span class="hs-identifier hs-type">toDrop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1953"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.let.pattern&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1954"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;delta =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144882"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-1955"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;binds =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144892"><span class="hs-identifier hs-type">binds</span></a></span><span>
</span><span id="line-1956"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1957"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144901"><span class="annot"><a href="#local-6989586621682144901"><span class="hs-identifier hs-var hs-var">fdelta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom Type]
forall a. TermSubst a =&gt; Tele (Dom a) -&gt; [Dom a]
</span><a href="Agda.TypeChecking.Telescope.html#flattenTel"><span class="hs-identifier hs-var">flattenTel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682144882"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-1958"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.let.pattern&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1959"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;fdelta =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144882"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144901"><span class="hs-identifier hs-type">fdelta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1960"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1961"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144903"><span class="annot"><a href="#local-6989586621682144903"><span class="hs-identifier hs-var hs-var">tsl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [Dom Type]) -&gt; [Dom Type] -&gt; [Dom Type]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg [Dom Type])
</span><a href="#local-6989586621682144897"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom Type]
</span><a href="#local-6989586621682144901"><span class="hs-identifier hs-var">fdelta</span></a></span><span>
</span><span id="line-1962"></span><span>        </span><span class="hs-comment">-- We get a list of types</span><span>
</span><span id="line-1963"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144905"><span class="annot"><a href="#local-6989586621682144905"><span class="hs-identifier hs-var hs-var">ts</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; Type) -&gt; [Dom Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom Type]
</span><a href="#local-6989586621682144903"><span class="hs-identifier hs-var">tsl</span></a></span><span>
</span><span id="line-1964"></span><span>        </span><span class="hs-comment">-- and relevances.</span><span>
</span><span id="line-1965"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144906"><span class="annot"><a href="#local-6989586621682144906"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; ArgInfo) -&gt; [Dom Type] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ArgInfo
forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom Type]
</span><a href="#local-6989586621682144903"><span class="hs-identifier hs-var">tsl</span></a></span><span>
</span><span id="line-1966"></span><span>        </span><span class="hs-comment">-- We get list of names of the let-bound vars from the context.</span><span>
</span><span id="line-1967"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144907"><span class="annot"><a href="#local-6989586621682144907"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContextEntry -&gt; Name) -&gt; [ContextEntry] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ContextEntry -&gt; Name
</span><a href="Agda.TypeChecking.Monad.Context.html#ctxEntryName"><span class="hs-identifier hs-var">ctxEntryName</span></a></span><span> </span><span class="annot"><span class="annottext">([ContextEntry] -&gt; [Name]) -&gt; [ContextEntry] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ContextEntry] -&gt; [ContextEntry]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[ContextEntry]
</span><a href="#local-6989586621682144892"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1968"></span><span>        </span><span class="hs-comment">-- We add all the bindings to the context.</span><span>
</span><span id="line-1969"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Tuple.html#uncurry4"><span class="hs-identifier hs-type">uncurry4</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding"><span class="hs-identifier hs-type">addLetBinding</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#UserWritten"><span class="hs-identifier hs-type">UserWritten</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682144858"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.zip4</span></span><span> </span><span class="annot"><a href="#local-6989586621682144906"><span class="hs-identifier hs-type">infos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144907"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144896"><span class="hs-identifier hs-type">sigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144905"><span class="hs-identifier hs-type">ts</span></a></span><span>
</span><span id="line-1970"></span><span>
</span><span id="line-1971"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var">checkLetBinding'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetApply"><span class="hs-identifier hs-type">A.LetApply</span></a></span><span> </span><span id="local-6989586621682144912"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682144912"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682144913"><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682144913"><span class="hs-identifier hs-var">erased</span></a></span></span><span> </span><span id="local-6989586621682144914"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682144914"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682144915"><span class="annot"><span class="annottext">ModuleApplication
</span><a href="#local-6989586621682144915"><span class="hs-identifier hs-var">modapp</span></a></span></span><span> </span><span id="local-6989586621682144916"><span class="annot"><span class="annottext">ScopeCopyInfo
</span><a href="#local-6989586621682144916"><span class="hs-identifier hs-var">copyInfo</span></a></span></span><span> </span><span id="local-6989586621682144917"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621682144917"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682144918"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682144918"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1972"></span><span>  </span><span class="hs-comment">-- Any variables in the context that doesn't belong to the current</span><span>
</span><span id="line-1973"></span><span>  </span><span class="hs-comment">-- module should go with the new module.</span><span>
</span><span id="line-1974"></span><span>  </span><span class="hs-comment">-- Example: @f x y = let open M t in u@.</span><span>
</span><span id="line-1975"></span><span>  </span><span class="hs-comment">-- There are 2 @new@ variables, @x@ and @y@, going into the anonynous module</span><span>
</span><span id="line-1976"></span><span>  </span><span class="hs-comment">-- @module _ (x : _) (y : _) = M t@.</span><span>
</span><span id="line-1977"></span><span>  </span><span id="local-6989586621682144919"><span class="annot"><a href="#local-6989586621682144919"><span class="hs-identifier hs-var">fv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Int
</span><a href="Agda.TypeChecking.Monad.Signature.html#getCurrentModuleFreeVars"><span class="hs-identifier hs-var">getCurrentModuleFreeVars</span></a></span><span>
</span><span id="line-1978"></span><span>  </span><span id="local-6989586621682144920"><span class="annot"><a href="#local-6989586621682144920"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-type">getContextSize</span></a></span><span>
</span><span id="line-1979"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682144921"><span class="annot"><a href="#local-6989586621682144921"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144920"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682144919"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-1980"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.let.apply&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Applying&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144914"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144915"><span class="hs-identifier hs-type">modapp</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-type">&lt;?&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;with&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pshow"><span class="hs-identifier hs-type">pshow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144921"><span class="hs-identifier hs-type">new</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;free variables&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1981"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.term.let.apply&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1982"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;context =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1983"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;module  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-type">currentModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1984"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;fv      =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682144919"><span class="hs-identifier hs-type">fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1985"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1986"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html#checkSectionApplication"><span class="hs-identifier hs-type">checkSectionApplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144912"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144913"><span class="hs-identifier hs-type">erased</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144914"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144915"><span class="hs-identifier hs-type">modapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144916"><span class="hs-identifier hs-type">copyInfo</span></a></span><span>
</span><span id="line-1987"></span><span>    </span><span class="hs-comment">-- Some other part of the code ensures that &quot;open public&quot; is</span><span>
</span><span id="line-1988"></span><span>    </span><span class="hs-comment">-- ignored in let expressions. Thus there is no need for</span><span>
</span><span id="line-1989"></span><span>    </span><span class="hs-comment">-- checkSectionApplication to throw an error if the import</span><span>
</span><span id="line-1990"></span><span>    </span><span class="hs-comment">-- directive does contain &quot;open public&quot;.</span><span>
</span><span id="line-1991"></span><span>    </span><span class="annot"><a href="#local-6989586621682144917"><span class="hs-identifier hs-type">dir</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#publicOpen"><span class="hs-identifier hs-var">publicOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1992"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#withAnonymousModule"><span class="hs-identifier hs-type">withAnonymousModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144914"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144921"><span class="hs-identifier hs-type">new</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682144918"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-1993"></span><span class="hs-comment">-- LetOpen and (WAS:) LetDeclaredVariable are only used for highlighting.</span><span>
</span><span id="line-1994"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var">checkLetBinding'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetOpen"><span class="hs-identifier hs-type">A.LetOpen</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621682144926"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682144926"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682144926"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1995"></span><span>
</span><span id="line-1996"></span><span class="hs-comment">-- | Version of checkLetBinding which traces the fact that we're</span><span>
</span><span id="line-1997"></span><span class="hs-comment">-- checking each binding in the Call.</span><span>
</span><span id="line-1998"></span><span id="local-6989586621682140966"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding"><span class="hs-identifier hs-type">checkLetBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140966"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140966"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1999"></span><span id="checkLetBinding"><span class="annot"><span class="annottext">checkLetBinding :: forall a. LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding"><span class="hs-identifier hs-var hs-var">checkLetBinding</span></a></span></span><span> </span><span id="local-6989586621682144928"><span class="annot"><span class="annottext">LetBinding
</span><a href="#local-6989586621682144928"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Call -&gt; (TCMT IO a -&gt; TCMT IO a) -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) b.
MonadTrace m =&gt;
Call -&gt; (m b -&gt; m b) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCallCPS%27"><span class="hs-identifier hs-var">traceCallCPS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LetBinding -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckLetBinding"><span class="hs-identifier hs-var">CheckLetBinding</span></a></span><span> </span><span class="annot"><span class="annottext">LetBinding
</span><a href="#local-6989586621682144928"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LetBinding -&gt; TCMT IO a -&gt; TCMT IO a
forall a. LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding%27"><span class="hs-identifier hs-var">checkLetBinding'</span></a></span><span> </span><span class="annot"><span class="annottext">LetBinding
</span><a href="#local-6989586621682144928"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2000"></span><span>
</span><span id="line-2001"></span><span id="local-6989586621682140686"><span id="local-6989586621682140687"><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings"><span class="hs-identifier hs-type">checkLetBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682140686"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682140686"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LetBinding"><span class="hs-identifier hs-type">A.LetBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140687"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682140687"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-2002"></span><span id="checkLetBindings"><span class="annot"><span class="annottext">checkLetBindings :: forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings"><span class="hs-identifier hs-var hs-var">checkLetBindings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LetBinding -&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a)
-&gt; (TCM a -&gt; TCM a) -&gt; t LetBinding -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">(.)</span></span><span> </span><span class="annot"><span class="annottext">((TCM a -&gt; TCM a) -&gt; (TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a)
-&gt; (LetBinding -&gt; TCM a -&gt; TCM a)
-&gt; LetBinding
-&gt; (TCM a -&gt; TCM a)
-&gt; TCM a
-&gt; TCM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LetBinding -&gt; TCM a -&gt; TCM a
forall a. LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBinding"><span class="hs-identifier hs-var">checkLetBinding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCM a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-2003"></span></pre></body></html>