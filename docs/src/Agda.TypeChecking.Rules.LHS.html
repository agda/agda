<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS</span></a></span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLeftHandSide"><span class="hs-identifier">checkLeftHandSide</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier">LHSResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier">bindAsPatterns</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier">IsFlexiblePattern</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#DataOrRecord"><span class="hs-identifier">DataOrRecord</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkSortOfSplitVar"><span class="hs-identifier">checkSortOfSplitVar</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">left</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadWriter</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runWriterT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">findIndex</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Generate</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#storeDisambiguatedConstructor"><span class="hs-identifier">storeDisambiguatedConstructor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#storeDisambiguatedProjection"><span class="hs-identifier">storeDisambiguatedProjection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#disambiguateRecordFields"><span class="hs-identifier">disambiguateRecordFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html"><span class="hs-identifier">Agda.Interaction.Options.Lenses</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#DataOrRecord"><span class="hs-identifier">DataOrRecord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html"><span class="hs-identifier">Agda.Syntax.Abstract.Views</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#asView"><span class="hs-identifier">asView</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#deepUnscope"><span class="hs-identifier">deepUnscope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#FieldAssignment%27"><span class="hs-identifier">FieldAssignment'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#LensInScope"><span class="hs-identifier">LensInScope</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Common</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html"><span class="hs-identifier">Agda.Syntax.Literal</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html"><span class="hs-identifier">Agda.TypeChecking.Constraints</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CheckInternal.html"><span class="hs-identifier">Agda.TypeChecking.CheckInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CheckInternal.html#checkInternal"><span class="hs-identifier">checkInternal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#isDataOrRecordType"><span class="hs-identifier">isDataOrRecordType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Errors.html"><span class="hs-identifier">Agda.TypeChecking.Errors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Errors.html#dropTopLevelModule"><span class="hs-identifier">dropTopLevelModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html"><span class="hs-identifier">Agda.TypeChecking.Irrelevance</span></a></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- Prevent &quot;Ambiguous occurrence &#8216;DontKnow&#8217;&quot; when loading with ghci.</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- (DontKnow is one of the constructors of ErrorNonEmpty *and* UnifactionResult').</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- We can't explicitly hide just the constructor here because it isn't in the</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- hs-boot file.</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Empty.html"><span class="hs-identifier">Agda.TypeChecking.Empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Empty.html#ensureEmptyType"><span class="hs-identifier">ensureEmptyType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html"><span class="hs-identifier">Agda.TypeChecking.Patterns.Abstract</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html"><span class="hs-identifier">Agda.TypeChecking.Records</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Records.html#getRecordConstructor"><span class="hs-identifier">getRecordConstructor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Sort.html"><span class="hs-identifier">Agda.TypeChecking.Sort</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.Path.html"><span class="hs-identifier">Agda.TypeChecking.Telescope.Path</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html"><span class="hs-identifier">Agda.TypeChecking.Primitive</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Primitive.html#Nat"><span class="hs-identifier">Nat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier">checkExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier">isType_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS.Problem</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.ProblemRest.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS.ProblemRest</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Unify.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS.Unify</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS.Implicit</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.html"><span class="hs-identifier">Agda.Utils.CallStack</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.Base.html#withCallerCallStack"><span class="hs-identifier">withCallerCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List2.html"><span class="hs-identifier">Agda.Utils.List2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Utils.List2.html#List2"><span class="hs-identifier">List2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List2.html"><span class="hs-identifier">Agda.Utils.List2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List2</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html"><span class="hs-identifier">Agda.Utils.Either</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Tuple.html"><span class="hs-identifier">Agda.Utils.Tuple</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Free.html#freeIn"><span class="hs-identifier">freeIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Extra read-only state for the LHS checker.</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="LHSContext"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSContext"><span class="hs-identifier hs-var">LHSContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LHSContext"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSContext"><span class="hs-identifier hs-var">LHSContext</span></a></span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="lhsRange"><span class="annot"><span class="annottext">LHSContext -&gt; Range
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsRange"><span class="hs-identifier hs-var hs-var">lhsRange</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The range of the whole lhs of a clause.</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsContextSize"><span class="annot"><span class="annottext">LHSContext -&gt; Int
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsContextSize"><span class="hs-identifier hs-var hs-var">lhsContextSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Original size of the context in which the lhs checker runs.</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | A pattern is flexible if it is dotted or implicit, or a record pattern</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   with only flexible subpatterns.</span><span>
</span><span id="line-107"></span><span class="hs-keyword">class</span><span> </span><span id="IsFlexiblePattern"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-var">IsFlexiblePattern</span></a></span></span><span> </span><span id="local-6989586621682117574"><span class="annot"><a href="#local-6989586621682117574"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>  </span><span id="maybeFlexiblePattern"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-type">maybeFlexiblePattern</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682117586"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117586"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117586"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682117574"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><a href="#local-6989586621682117586"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#FlexibleVarKind"><span class="hs-identifier hs-type">FlexibleVarKind</span></a></span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>  </span><span id="isFlexiblePattern"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#isFlexiblePattern"><span class="hs-identifier hs-type">isFlexiblePattern</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682117573"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117573"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117573"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682117574"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682117573"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621682119413"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#isFlexiblePattern"><span class="hs-identifier hs-var hs-var">isFlexiblePattern</span></a></span><span> </span><span id="local-6989586621682119422"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682119422"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; (FlexibleVarKind -&gt; Bool) -&gt; Maybe FlexibleVarKind -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; Bool
</span><a href="#local-6989586621682119424"><span class="hs-identifier hs-var">notOtherFlex</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe FlexibleVarKind -&gt; Bool)
-&gt; m (Maybe FlexibleVarKind) -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind -&gt; m (Maybe FlexibleVarKind)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682119422"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621682119424"><span class="annot"><span class="annottext">notOtherFlex :: FlexibleVarKind -&gt; Bool
</span><a href="#local-6989586621682119424"><span class="hs-identifier hs-var hs-var">notOtherFlex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#RecordFlex"><span class="hs-identifier hs-type">RecordFlex</span></a></span><span> </span><span id="local-6989586621682119429"><span class="annot"><span class="annottext">[FlexibleVarKind]
</span><a href="#local-6989586621682119429"><span class="hs-identifier hs-var">fls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FlexibleVarKind -&gt; Bool) -&gt; [FlexibleVarKind] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; Bool
</span><a href="#local-6989586621682119424"><span class="hs-identifier hs-var">notOtherFlex</span></a></span><span> </span><span class="annot"><span class="annottext">[FlexibleVarKind]
</span><a href="#local-6989586621682119429"><span class="hs-identifier hs-var">fls</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#ImplicitFlex"><span class="hs-identifier hs-var">ImplicitFlex</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#DotFlex"><span class="hs-identifier hs-var">DotFlex</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#OtherFlex"><span class="hs-identifier hs-var">OtherFlex</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682119436"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621682119492"><span class="annot"><span class="annottext">maybeFlexiblePattern :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
Pattern -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var hs-var hs-var">maybeFlexiblePattern</span></a></span></span><span> </span><span id="local-6989586621682119493"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119493"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; MaybeT m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.flex&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; MaybeT m ()) -&gt; TCMT IO Doc -&gt; MaybeT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;maybeFlexiblePattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119493"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; MaybeT m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.flex&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; MaybeT m ()) -&gt; TCMT IO Doc -&gt; MaybeT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;maybeFlexiblePattern (raw) &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (Pattern -&gt; String) -&gt; Pattern -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; String) -&gt; (Pattern -&gt; Pattern) -&gt; Pattern -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Pattern
forall a. ExprLike a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Abstract.Views.html#deepUnscope"><span class="hs-identifier hs-var">deepUnscope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119493"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119493"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#DotFlex"><span class="hs-identifier hs-var">DotFlex</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#ImplicitFlex"><span class="hs-identifier hs-var">ImplicitFlex</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#ImplicitFlex"><span class="hs-identifier hs-var">ImplicitFlex</span></a></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119504"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119504"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
Pattern -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119504"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119506"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682119506"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682119507"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119507"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682119508"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119508"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AmbiguousQName -&gt; Maybe QName
</span><a href="Agda.Syntax.Abstract.Name.html#getUnambiguous"><span class="hs-identifier hs-var">getUnambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682119506"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">MaybeT m Bool
-&gt; MaybeT m FlexibleVarKind
-&gt; MaybeT m FlexibleVarKind
-&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QName, RecordData) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (QName, RecordData) -&gt; Bool)
-&gt; MaybeT m (Maybe (QName, RecordData)) -&gt; MaybeT m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; MaybeT m (Maybe (QName, RecordData))
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe (QName, RecordData))
</span><a href="Agda.TypeChecking.Records.html#isRecordConstructor"><span class="hs-identifier hs-var">isRecordConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119508"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#OtherFlex"><span class="hs-identifier hs-var">OtherFlex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-else-}</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
[NamedArg Pattern] -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119507"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#OtherFlex"><span class="hs-identifier hs-var">OtherFlex</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682117631"><span id="local-6989586621682119517"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern%27"><span class="hs-identifier hs-type">I.Pattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117631"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621682119541"><span class="annot"><span class="annottext">maybeFlexiblePattern :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
Pattern' a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var hs-var hs-var">maybeFlexiblePattern</span></a></span></span><span> </span><span id="local-6989586621682119542"><span class="annot"><span class="annottext">Pattern' a
</span><a href="#local-6989586621682119542"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern' a
</span><a href="#local-6989586621682119542"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">I.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#DotFlex"><span class="hs-identifier hs-var">DotFlex</span></a></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">I.ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119545"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682119545"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682119546"><span class="annot"><span class="annottext">[NamedArg (Pattern' a)]
</span><a href="#local-6989586621682119546"><span class="hs-identifier hs-var">ps</span></a></span></span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPRecord"><span class="hs-identifier hs-var">conPRecord</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682119545"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOSystem"><span class="hs-identifier hs-var">PatOSystem</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; PatOrigin
</span><a href="Agda.Syntax.Internal.html#patOrigin"><span class="hs-identifier hs-var">patOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConPatternInfo -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#conPInfo"><span class="hs-identifier hs-var">conPInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682119545"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind -&gt; MaybeT m FlexibleVarKind
forall a. a -&gt; MaybeT m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#ImplicitFlex"><span class="hs-identifier hs-var">ImplicitFlex</span></a></span><span>  </span><span class="hs-comment">-- expanded from ImplicitP</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPRecord"><span class="hs-identifier hs-var">conPRecord</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682119545"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' a)] -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
[NamedArg (Pattern' a)] -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' a)]
</span><a href="#local-6989586621682119546"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">I.VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">I.LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">I.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">I.IApplyP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">I.DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT m FlexibleVarKind
forall a. MaybeT m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span> </span><span class="hs-comment">-- TODO Andrea check semantics</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- | Lists of flexible patterns are 'RecordFlex'.</span></span><span>
</span><span id="line-150"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682117601"><span id="local-6989586621682119559"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117601"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682117601"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621682119575"><span class="annot"><span class="annottext">maybeFlexiblePattern :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
[a] -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var hs-var hs-var">maybeFlexiblePattern</span></a></span></span><span> </span><span id="local-6989586621682119576"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682119576"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FlexibleVarKind] -&gt; FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#RecordFlex"><span class="hs-identifier hs-var">RecordFlex</span></a></span><span> </span><span class="annot"><span class="annottext">([FlexibleVarKind] -&gt; FlexibleVarKind)
-&gt; MaybeT m [FlexibleVarKind] -&gt; MaybeT m FlexibleVarKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; MaybeT m FlexibleVarKind)
-&gt; [a] -&gt; MaybeT m [FlexibleVarKind]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682119576"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682117600"><span id="local-6989586621682119581"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117600"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117600"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621682119592"><span class="annot"><span class="annottext">maybeFlexiblePattern :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
Arg a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var hs-var hs-var">maybeFlexiblePattern</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; MaybeT m FlexibleVarKind)
-&gt; (Arg a -&gt; a) -&gt; Arg a -&gt; MaybeT m FlexibleVarKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; a
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682117598"><span id="local-6989586621682117599"><span id="local-6989586621682119597"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117598"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#IsFlexiblePattern"><span class="hs-identifier hs-type">IsFlexiblePattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Common.Named</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117599"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117598"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621682119608"><span class="annot"><span class="annottext">maybeFlexiblePattern :: forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
Named name a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var hs-var hs-var">maybeFlexiblePattern</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; MaybeT m FlexibleVarKind
forall a (m :: * -&gt; *).
(IsFlexiblePattern a, HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
forall (m :: * -&gt; *).
(HasConstInfo m, MonadDebug m) =&gt;
a -&gt; MaybeT m FlexibleVarKind
</span><a href="Agda.TypeChecking.Rules.LHS.html#maybeFlexiblePattern"><span class="hs-identifier hs-var">maybeFlexiblePattern</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; MaybeT m FlexibleVarKind)
-&gt; (Named name a -&gt; a) -&gt; Named name a -&gt; MaybeT m FlexibleVarKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Named name a -&gt; a
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Update the given LHS state:</span><span>
</span><span id="line-160"></span><span class="hs-comment">--   1. simplify problem equations</span><span>
</span><span id="line-161"></span><span class="hs-comment">--   2. rename telescope variables</span><span>
</span><span id="line-162"></span><span class="hs-comment">--   3. introduce trailing patterns</span><span>
</span><span id="line-163"></span><span id="local-6989586621682117653"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#updateLHSState"><span class="hs-identifier hs-type">updateLHSState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117653"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117653"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-164"></span><span id="updateLHSState"><span class="annot"><span class="annottext">updateLHSState :: forall a. LHSState a -&gt; TCM (LHSState a)
</span><a href="Agda.TypeChecking.Rules.LHS.html#updateLHSState"><span class="hs-identifier hs-var hs-var">updateLHSState</span></a></span></span><span> </span><span id="local-6989586621682119621"><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682119621"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119622"><span class="annot"><span class="annottext">tel :: Telescope
</span><a href="#local-6989586621682119622"><span class="hs-identifier hs-var hs-var hs-var">tel</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682119621"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LHSState a -&gt; Lens' (LHSState a) Telescope -&gt; Telescope
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; f Telescope) -&gt; LHSState a -&gt; f (LHSState a)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Telescope -&gt; f Telescope) -&gt; LHSState a -&gt; f (LHSState a)
Lens' (LHSState a) Telescope
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-var">lhsTel</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span id="local-6989586621682119627"><span class="annot"><span class="annottext">problem :: Problem a
</span><a href="#local-6989586621682119627"><span class="hs-identifier hs-var hs-var hs-var">problem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682119621"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LHSState a -&gt; Lens' (LHSState a) (Problem a) -&gt; Problem a
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Problem a -&gt; f (Problem a)) -&gt; LHSState a -&gt; f (LHSState a)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Problem a -&gt; f (Problem a)) -&gt; LHSState a -&gt; f (LHSState a)
Lens' (LHSState a) (Problem a)
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsProblem"><span class="hs-identifier hs-var">lhsProblem</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621682119631"><span class="annot"><a href="#local-6989586621682119631"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682119622"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [ProblemEq] -&gt; TCMT IO [ProblemEq])
-&gt; TCMT IO [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.html#updateProblemEqs"><span class="hs-identifier hs-var">updateProblemEqs</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; TCMT IO [ProblemEq])
-&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119627"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; Lens' (Problem a) [ProblemEq] -&gt; [ProblemEq]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621682119637"><span class="annot"><a href="#local-6989586621682119637"><span class="hs-identifier hs-var">tel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.ProblemRest.html#useNamesFromProblemEqs"><span class="hs-identifier hs-type">useNamesFromProblemEqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119631"><span class="hs-identifier hs-type">eqs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119622"><span class="hs-identifier hs-type">tel</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.ProblemRest.html#updateProblemRest"><span class="hs-identifier hs-type">updateProblemRest</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-type">lhsTel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119637"><span class="hs-identifier hs-type">tel'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsProblem"><span class="hs-identifier hs-type">lhsProblem</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-type">problemEqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682119631"><span class="hs-identifier hs-type">eqs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119621"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | Update the user patterns in the given problem, simplifying equations</span><span>
</span><span id="line-172"></span><span class="hs-comment">--   between constructors where possible.</span><span>
</span><span id="line-173"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#updateProblemEqs"><span class="hs-identifier hs-type">updateProblemEqs</span></a></span><span>
</span><span id="line-174"></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span id="updateProblemEqs"><span class="annot"><span class="annottext">updateProblemEqs :: [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.html#updateProblemEqs"><span class="hs-identifier hs-var hs-var">updateProblemEqs</span></a></span></span><span> </span><span id="local-6989586621682119646"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119646"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;updateProblem: equations to update&quot;</span></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119646"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;(none)&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ProblemEq -&gt; TCMT IO Doc) -&gt; [ProblemEq] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ProblemEq -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119646"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621682119651"><span class="annot"><a href="#local-6989586621682119651"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119652"><span class="hs-identifier hs-var">updates</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119646"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;updateProblem: new equations&quot;</span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119651"><span class="hs-identifier hs-type">eqs'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-string">&quot;(none)&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119651"><span class="hs-identifier hs-type">eqs'</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682119651"><span class="hs-identifier hs-type">eqs'</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="#local-6989586621682119652"><span class="hs-identifier hs-type">updates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682119652"><span class="annot"><span class="annottext">updates :: [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119652"><span class="hs-identifier hs-var hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[ProblemEq]] -&gt; [ProblemEq]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[ProblemEq]] -&gt; [ProblemEq])
-&gt; ([ProblemEq] -&gt; TCMT IO [[ProblemEq]])
-&gt; [ProblemEq]
-&gt; TCMT IO [ProblemEq]
forall (m :: * -&gt; *) b c a.
Functor m =&gt;
(b -&gt; c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="Agda.Utils.Functor.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(ProblemEq -&gt; TCMT IO [ProblemEq])
-&gt; [ProblemEq] -&gt; TCMT IO [[ProblemEq]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119656"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="#local-6989586621682119656"><span class="hs-identifier hs-type">update</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621682119656"><span class="annot"><span class="annottext">update :: ProblemEq -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119656"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span id="local-6989586621682119657"><span class="annot"><span class="annottext">eq :: ProblemEq
</span><a href="#local-6989586621682119657"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682119657"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="#local-6989586621682119656"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span id="local-6989586621682119659"><span class="annot"><span class="annottext">eq :: ProblemEq
</span><a href="#local-6989586621682119659"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682119660"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682119660"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO [ProblemEq]
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO [ProblemEq])
-&gt; TypeError -&gt; TCMT IO [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllformedProjectionPatternAbstract"><span class="hs-identifier hs-var">IllformedProjectionPatternAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119660"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="#local-6989586621682119656"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span id="local-6989586621682119664"><span class="annot"><span class="annottext">eq :: ProblemEq
</span><a href="#local-6989586621682119664"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682119665"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682119665"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span id="local-6989586621682119666"><span class="annot"><span class="annottext">PatInfo
</span><a href="#local-6989586621682119666"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682119667"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119667"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682119668"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119668"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682119669"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119669"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682119670"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119670"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Pattern
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119667"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119669"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119670"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq])
-&gt; TCMT IO [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119656"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119668"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119669"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119670"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="#local-6989586621682119656"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span id="local-6989586621682119671"><span class="annot"><span class="annottext">eq :: ProblemEq
</span><a href="#local-6989586621682119671"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682119672"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119672"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682119673"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119673"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682119674"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119674"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119673"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term -&gt; (Term -&gt; TCMT IO Term) -&gt; TCMT IO Term
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall (m :: * -&gt; *). HasBuiltins m =&gt; Term -&gt; m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#constructorForm"><span class="hs-identifier hs-var">constructorForm</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
-&gt; (Term -&gt; TCMT IO [ProblemEq]) -&gt; TCMT IO [ProblemEq]
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682119678"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119678"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682119679"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682119679"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682119680"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682119680"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119681"><span class="annot"><span class="annottext">vs :: Args
</span><a href="#local-6989586621682119681"><span class="hs-identifier hs-var hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682119680"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-comment">-- we should only simplify equations between fully applied constructors</span><span>
</span><span id="line-205"></span><span>        </span><span id="local-6989586621682119685"><span class="annot"><a href="#local-6989586621682119685"><span class="hs-identifier hs-var">contype</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; Type -&gt; TCMT IO (Maybe ((QName, Type, Args), Type))
forall (m :: * -&gt; *).
PureTCM m =&gt;
ConHead -&gt; Type -&gt; m (Maybe ((QName, Type, Args), Type))
</span><a href="Agda.TypeChecking.Datatypes.html#getFullyAppliedConType"><span class="hs-identifier hs-var">getFullyAppliedConType</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119678"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (Maybe ((QName, Type, Args), Type)))
-&gt; TCMT IO Type -&gt; TCMT IO (Maybe ((QName, Type, Args), Type))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Type
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119674"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-type">caseMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119685"><span class="hs-identifier hs-type">contype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682119671"><span class="hs-identifier hs-type">eq</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119690"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119690"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682119691"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119691"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621682119692"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119692"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682119694"><span class="annot"><a href="#local-6989586621682119694"><span class="hs-identifier hs-var">ctel</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *). PureTCM m =&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewPath"><span class="hs-identifier hs-var">telViewPath</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119692"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-comment">-- Andrea 15/10/2020: propagate modality to constructor arguments</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119696"><span class="annot"><a href="#local-6989586621682119696"><span class="hs-identifier hs-var hs-var">updMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Modality
</span><a href="Agda.Syntax.Common.html#composeModality"><span class="hs-identifier hs-var">composeModality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119674"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>        </span><span id="local-6989586621682119699"><span class="annot"><a href="#local-6989586621682119699"><span class="hs-identifier hs-var">ctel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#mapModality"><span class="hs-identifier hs-type">mapModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119696"><span class="hs-identifier hs-type">updMod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682119694"><span class="hs-identifier hs-type">ctel</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119701"><span class="annot"><a href="#local-6989586621682119701"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Term] -&gt; [Dom Type]
</span><a href="#local-6989586621682119702"><span class="hs-identifier hs-var">instTel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682119699"><span class="hs-identifier hs-var">ctel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; Args -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119681"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621682119703"><span class="annot"><a href="#local-6989586621682119703"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html#expandLitPattern"><span class="hs-identifier hs-type">expandLitPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119672"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682119703"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-217"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-218"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span id="local-6989586621682119705"><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682119705"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span id="local-6989586621682119706"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682119706"><span class="hs-identifier hs-var">ambC</span></a></span></span><span> </span><span id="local-6989586621682119707"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119707"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682119708"><span class="annot"><a href="#local-6989586621682119708"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AmbiguousQName -&gt; QName -&gt; Args -&gt; TCM (ConHead, Type)
</span><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateConstructor"><span class="hs-identifier hs-var">disambiguateConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682119706"><span class="hs-identifier hs-var">ambC</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119690"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119691"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>            </span><span class="hs-comment">-- Issue #3014: If the constructor is forced but the user wrote a</span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-comment">-- different constructor,that's an error. We simply keep the</span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-comment">-- problem equation, this will result in a proper error message later.</span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119678"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119708"><span class="hs-identifier hs-type">c'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682119671"><span class="hs-identifier hs-type">eq</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-comment">-- Insert implicit patterns</span><span>
</span><span id="line-227"></span><span>            </span><span id="local-6989586621682119712"><span class="annot"><a href="#local-6989586621682119712"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatterns"><span class="hs-identifier hs-type">insertImplicitPatterns</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119707"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119699"><span class="hs-identifier hs-type">ctel</span></a></span><span>
</span><span id="line-228"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.imp&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-229"></span><span>              </span><span class="annot"><span class="hs-string">&quot;insertImplicitPatternsT returned&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119712"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-comment">-- Check argument count and hiding (not just count: #3074)</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119716"><span class="annot"><a href="#local-6989586621682119716"><span class="hs-identifier hs-var hs-var">checkArgs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                </span><span class="annot"><a href="#local-6989586621682119716"><span class="hs-identifier hs-var">checkArgs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119717"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119717"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119718"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119718"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119719"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682119719"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119720"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119720"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682119721"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119721"><span class="hs-identifier hs-var">nExpected</span></a></span></span><span> </span><span id="local-6989586621682119722"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119722"><span class="hs-identifier hs-var">nActual</span></a></span></span><span>
</span><span id="line-234"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Hiding
forall a. LensHiding a =&gt; a -&gt; Hiding
</span><a href="Agda.Syntax.Common.html#getHiding"><span class="hs-identifier hs-var">getHiding</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119717"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Hiding -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Hiding
forall a. LensHiding a =&gt; a -&gt; Hiding
</span><a href="Agda.Syntax.Common.html#getHiding"><span class="hs-identifier hs-var">getHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682119719"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; Args -&gt; Int -&gt; Int -&gt; TCMT IO ()
</span><a href="#local-6989586621682119716"><span class="hs-identifier hs-var">checkArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119718"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119720"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119721"><span class="hs-identifier hs-var">nExpected</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119722"><span class="hs-identifier hs-var">nActual</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119717"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongHidingInLHS"><span class="hs-identifier hs-var">WrongHidingInLHS</span></a></span><span>
</span><span id="line-236"></span><span>                </span><span class="annot"><a href="#local-6989586621682119716"><span class="hs-identifier hs-var">checkArgs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682119727"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119727"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682119728"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119728"><span class="hs-identifier hs-var">nExpected</span></a></span></span><span> </span><span id="local-6989586621682119729"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119729"><span class="hs-identifier hs-var">nActual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO ()) -&gt; TypeError -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-237"></span><span>                  </span><span class="annot"><span class="annottext">QName -&gt; Int -&gt; Int -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongNumberOfConstructorArguments"><span class="hs-identifier hs-var">WrongNumberOfConstructorArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119678"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119728"><span class="hs-identifier hs-var">nExpected</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Args -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119727"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119729"><span class="hs-identifier hs-var">nActual</span></a></span><span>
</span><span id="line-238"></span><span>                </span><span class="annot"><a href="#local-6989586621682119716"><span class="hs-identifier hs-var">checkArgs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119732"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119732"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119733"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119733"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682119734"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119734"><span class="hs-identifier hs-var">nExpected</span></a></span></span><span> </span><span id="local-6989586621682119735"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119735"><span class="hs-identifier hs-var">nActual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119732"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO ()) -&gt; TypeError -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-239"></span><span>                  </span><span class="annot"><span class="annottext">QName -&gt; Int -&gt; Int -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#WrongNumberOfConstructorArguments"><span class="hs-identifier hs-var">WrongNumberOfConstructorArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119678"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119734"><span class="hs-identifier hs-var">nExpected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682119735"><span class="hs-identifier hs-var">nActual</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119733"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><a href="#local-6989586621682119716"><span class="hs-identifier hs-type">checkArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119712"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119681"><span class="hs-identifier hs-type">vs</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><a href="#local-6989586621682119652"><span class="hs-identifier hs-type">updates</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith3</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119712"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119681"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682119701"><span class="hs-identifier hs-type">bs</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119739"><span class="annot"><span class="annottext">[FieldAssignment' Pattern]
</span><a href="#local-6989586621682119739"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>            </span><span id="local-6989586621682119740"><span class="annot"><a href="#local-6989586621682119740"><span class="hs-identifier hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Arg QName) -&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term QName] -&gt; [Arg QName])
-&gt; (Definition -&gt; [Dom' Term QName]) -&gt; Definition -&gt; [Arg QName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#recFields"><span class="hs-identifier hs-var">recFields</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; [Dom' Term QName])
-&gt; (Definition -&gt; Defn) -&gt; Definition -&gt; [Dom' Term QName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; [Arg QName])
-&gt; TCMT IO Definition -&gt; TCMT IO [Arg QName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119690"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>            </span><span class="hs-comment">-- Andreas, 2018-09-06, issue #3122.</span><span>
</span><span id="line-249"></span><span>            </span><span class="hs-comment">-- Associate the concrete record field names used in the record pattern</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-comment">-- to their counterpart in the record type definition.</span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#disambiguateRecordFields"><span class="hs-identifier hs-type">disambiguateRecordFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#_nameFieldA"><span class="hs-identifier hs-var">_nameFieldA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119739"><span class="hs-identifier hs-type">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119740"><span class="hs-identifier hs-type">axs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119746"><span class="annot"><a href="#local-6989586621682119746"><span class="hs-identifier hs-var hs-var">cxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; Arg Name) -&gt; [Arg QName] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; Arg QName -&gt; Arg Name
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (QName -&gt; Name) -&gt; QName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg QName]
</span><a href="#local-6989586621682119740"><span class="hs-identifier hs-var">axs</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-comment">-- In fs omitted explicit fields are replaced by underscores,</span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-comment">-- and the fields are put in the correct order.</span><span>
</span><span id="line-257"></span><span>            </span><span id="local-6989586621682119749"><span class="annot"><a href="#local-6989586621682119749"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#insertMissingFieldsFail"><span class="hs-identifier hs-type">insertMissingFieldsFail</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-type">ConORec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119690"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682119739"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119746"><span class="hs-identifier hs-type">cxs</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>            </span><span class="hs-comment">-- We also need to insert missing implicit or instance fields.</span><span>
</span><span id="line-260"></span><span>            </span><span id="local-6989586621682119754"><span class="annot"><a href="#local-6989586621682119754"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatterns"><span class="hs-identifier hs-type">insertImplicitPatterns</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119749"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119699"><span class="hs-identifier hs-type">ctel</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119755"><span class="annot"><a href="#local-6989586621682119755"><span class="hs-identifier hs-var hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq)
-&gt; [Pattern] -&gt; [Term] -&gt; [Dom Type] -&gt; [ProblemEq]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><span class="hs-identifier hs-var">zipWith3</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg Pattern -&gt; Pattern) -&gt; [NamedArg Pattern] -&gt; [Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119754"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; Args -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682119681"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom Type]
</span><a href="#local-6989586621682119701"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-263"></span><span>            </span><span class="annot"><a href="#local-6989586621682119652"><span class="hs-identifier hs-type">updates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119755"><span class="hs-identifier hs-type">eqs</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>          </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682119671"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682119757"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682119757"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119758"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682119758"><span class="hs-identifier hs-var">l'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119672"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682119757"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682119758"><span class="hs-identifier hs-var">l'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119672"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>        </span><span id="local-6989586621682119760"><span class="annot"><a href="#local-6989586621682119760"><span class="hs-identifier hs-var">itisone</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Term -&gt; TCMT IO Term
forall a. TCM a -&gt; TCM a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primItIsOne"><span class="hs-identifier hs-var">primItIsOne</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#tryConversion"><span class="hs-identifier hs-type">tryConversion</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119674"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682119673"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119760"><span class="hs-identifier hs-type">itisone</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682119671"><span class="hs-identifier hs-type">eq</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682119671"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="#local-6989586621682119702"><span class="hs-identifier hs-type">instTel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621682119702"><span class="annot"><span class="annottext">instTel :: Telescope -&gt; [Term] -&gt; [Dom Type]
</span><a href="#local-6989586621682119702"><span class="hs-identifier hs-var hs-var">instTel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="#local-6989586621682119702"><span class="hs-identifier hs-var">instTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682119767"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119767"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682119768"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682119768"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119769"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119769"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119770"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682119770"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119767"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; [Dom Type] -&gt; [Dom Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Term] -&gt; [Dom Type]
</span><a href="#local-6989586621682119702"><span class="hs-identifier hs-var">instTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Telescope -&gt; SubstArg Telescope -&gt; Telescope
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-identifier hs-var">absApp</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682119768"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Telescope
</span><a href="#local-6989586621682119769"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682119770"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="#local-6989586621682119702"><span class="hs-identifier hs-var">instTel</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom Type]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | Check if a problem is solved.</span><span>
</span><span id="line-282"></span><span class="hs-comment">--   That is, if the patterns are all variables,</span><span>
</span><span id="line-283"></span><span class="hs-comment">--   and there is no 'problemRest'.</span><span>
</span><span id="line-284"></span><span id="local-6989586621682117761"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#isSolvedProblem"><span class="hs-identifier hs-type">isSolvedProblem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#Problem"><span class="hs-identifier hs-type">Problem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117761"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-285"></span><span id="isSolvedProblem"><span class="annot"><span class="annottext">isSolvedProblem :: forall a. Problem a -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#isSolvedProblem"><span class="hs-identifier hs-var hs-var">isSolvedProblem</span></a></span></span><span> </span><span id="local-6989586621682119774"><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119774"><span class="hs-identifier hs-var">problem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119774"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
-&gt; Lens' (Problem a) [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [NamedArg Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemRestPats"><span class="hs-identifier hs-var">problemRestPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">Problem a -&gt; Bool
forall a. Problem a -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#problemAllVariables"><span class="hs-identifier hs-var">problemAllVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119774"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- | Check if a problem consists only of variable patterns.</span><span>
</span><span id="line-289"></span><span class="hs-comment">--   (Includes the 'problemRest').</span><span>
</span><span id="line-290"></span><span id="local-6989586621682119780"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#problemAllVariables"><span class="hs-identifier hs-type">problemAllVariables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#Problem"><span class="hs-identifier hs-type">Problem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119780"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-291"></span><span id="problemAllVariables"><span class="annot"><span class="annottext">problemAllVariables :: forall a. Problem a -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#problemAllVariables"><span class="hs-identifier hs-var hs-var">problemAllVariables</span></a></span></span><span> </span><span id="local-6989586621682119782"><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119782"><span class="hs-identifier hs-var">problem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">(Pattern -&gt; Bool) -&gt; [Pattern] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Bool
forall {e}. Pattern' e -&gt; Bool
</span><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><span class="annottext">([Pattern] -&gt; Bool) -&gt; [Pattern] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">(NamedArg Pattern -&gt; Pattern) -&gt; [NamedArg Pattern] -&gt; [Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119782"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
-&gt; Lens' (Problem a) [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [NamedArg Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemRestPats"><span class="hs-identifier hs-var">problemRestPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pattern] -&gt; [Pattern] -&gt; [Pattern]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; [Pattern]
forall a. Problem a -&gt; [Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemInPats"><span class="hs-identifier hs-var">problemInPats</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682119782"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-comment">-- need further splitting:</span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621682119783"><span class="annot"><span class="annottext">isSolved :: Pattern' e -&gt; Bool
</span><a href="#local-6989586621682119783"><span class="hs-identifier hs-var hs-var">isSolved</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- record pattern</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-comment">-- solved:</span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdP"><span class="hs-identifier hs-type">A.AbsurdP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-comment">-- recursive cases</span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119796"><span class="annot"><span class="annottext">Pattern' e
</span><a href="#local-6989586621682119796"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' e -&gt; Bool
</span><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' e
</span><a href="#local-6989586621682119796"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-comment">-- impossible:</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefP"><span class="hs-identifier hs-type">A.DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- expanded before</span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- __IMPOSSIBLE__</span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><a href="#local-6989586621682119783"><span class="hs-identifier hs-var">isSolved</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">-- | For each user-defined pattern variable in the 'Problem', check</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- that the corresponding data type (if any) does not contain a</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- constructor of the same name (which is not in scope); this</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- \&quot;shadowing\&quot; could indicate an error, and is not allowed.</span><span>
</span><span id="line-317"></span><span class="hs-comment">--</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- Precondition: The problem has to be solved.</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#noShadowingOfConstructors"><span class="hs-identifier hs-type">noShadowingOfConstructors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span id="noShadowingOfConstructors"><span class="annot"><span class="annottext">noShadowingOfConstructors :: ProblemEq -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#noShadowingOfConstructors"><span class="hs-identifier hs-var hs-var">noShadowingOfConstructors</span></a></span></span><span> </span><span id="local-6989586621682119802"><span class="annot"><span class="annottext">problem :: ProblemEq
</span><a href="#local-6989586621682119802"><span class="hs-identifier hs-var">problem</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682119803"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119803"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682119806"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682119806"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119808"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119808"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119803"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span>       </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdP"><span class="hs-identifier hs-type">A.AbsurdP</span></a></span><span>     </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span>      </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119809"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119809"><span class="hs-identifier hs-var">p</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#noShadowingOfConstructors"><span class="hs-identifier hs-var">noShadowingOfConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">(ProblemEq -&gt; TCMT IO ()) -&gt; ProblemEq -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682119802"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#problemInPat"><span class="hs-identifier hs-var">problemInPat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682119809"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-328"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-329"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-330"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span>       </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-331"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefP"><span class="hs-identifier hs-type">A.DefP</span></a></span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-332"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-333"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-334"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span>       </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-335"></span><span>   </span><span class="hs-comment">-- Andreas, 2017-12-01, issue #2859.</span><span>
</span><span id="line-336"></span><span>   </span><span class="hs-comment">-- Due to parameter refinement, there can be (invisible) variable patterns from module</span><span>
</span><span id="line-337"></span><span>   </span><span class="hs-comment">-- parameters that shadow constructors.</span><span>
</span><span id="line-338"></span><span>   </span><span class="hs-comment">-- Thus, only complain about user written variable that shadow constructors.</span><span>
</span><span id="line-339"></span><span>   </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">unBind :: BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">unBind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682119813"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119813"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Origin
forall a. LensOrigin a =&gt; a -&gt; Origin
</span><a href="Agda.Syntax.Common.html#getOrigin"><span class="hs-identifier hs-var">getOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682119806"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; Origin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#UserWritten"><span class="hs-identifier hs-var">UserWritten</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.shadow&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc) -&gt; String -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checking whether pattern variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119813"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; shadows a constructor&quot;</span></span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;type of variable =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119808"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;position of variable =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (Range -&gt; String) -&gt; Range -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119813"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.shadow&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;a =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119808"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- Get a conflicting data or record constructor, if any.</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621682119819"><span class="annot"><a href="#local-6989586621682119819"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) QName -&gt; TCMT IO (Maybe QName)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-comment">-- Is the type of the pattern variable a data or pattern record type?</span><span>
</span><span id="line-351"></span><span>      </span><span id="local-6989586621682119820"><span class="annot"><a href="#local-6989586621682119820"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Term -&gt; MaybeT (TCMT IO) Term
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Term -&gt; MaybeT (TCMT IO) Term)
-&gt; TCMT IO Term -&gt; MaybeT (TCMT IO) Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119808"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682119822"><span class="annot"><a href="#local-6989586621682119822"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682119823"><span class="annot"><a href="#local-6989586621682119823"><span class="hs-identifier hs-var">dr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#isDataOrRecord"><span class="hs-identifier hs-type">isDataOrRecord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119820"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#guard"><span class="hs-identifier hs-type">guard</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#patternMatchingAllowed"><span class="hs-identifier hs-type">patternMatchingAllowed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119823"><span class="hs-identifier hs-type">dr</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-comment">-- Look for a constructor with the same name as the pattern variable.</span><span>
</span><span id="line-356"></span><span>      </span><span id="local-6989586621682119828"><span class="annot"><a href="#local-6989586621682119828"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#getConstructors"><span class="hs-identifier hs-type">getConstructors</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119822"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">A.nameConcrete</span></span><span> </span><span class="annot"><span class="hs-identifier">x</span></span><span> </span><span class="annot"><span class="hs-operator">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">A.nameConcrete</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">A.qnameName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682119828"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-comment">-- Alert if there is a constructor of the same name.</span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-type">whenJust</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119819"><span class="hs-identifier hs-type">mc</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682119832"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119832"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119813"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; TCMT IO ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCMT IO ()) -&gt; Warning -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; QName -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#PatternShadowsConstructor"><span class="hs-identifier hs-var">PatternShadowsConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119813"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119832"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- Andreas, 2023-09-08, issue #6829:</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-comment">-- I rewrote the code originally dating from 2009, commit:</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-comment">-- https://github.com/agda/agda/commit/5d5095ba080b04f16867d4ed5af4ba7091f1a773</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-comment">-- The code survived for almost 15 years, but it slept through the advent</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-comment">-- of matchable record constructors in 2010 (Agda 2.2.8):</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- https://github.com/agda/agda/blob/283730b392d7c21c54b53b0f486802ec143e4af7/doc/release-notes/2.2.8.md#L7-L9</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-comment">-- Here are comments on the last version of the code I'd like to preserve,</span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-comment">-- as they reflect some considerations and design decisions:</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-comment">-- Abstract constructors cannot be brought into scope,</span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-comment">-- even by a bigger import list.</span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-comment">-- Thus, they cannot be confused with variables.</span><span>
</span><span id="line-375"></span><span>            </span><span class="hs-comment">-- Alternatively, we could do getConstInfo in ignoreAbstractMode,</span><span>
</span><span id="line-376"></span><span>            </span><span class="hs-comment">-- then Agda would complain if a variable shadowed an abstract constructor.</span><span>
</span><span id="line-377"></span><span>          </span><span class="hs-comment">-- TODO: in the future some stuck primitives might allow constructors</span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-comment">-- TODO: If the type is a meta-variable, should the test be</span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-comment">-- postponed? If there is a problem, then it will be caught when</span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-comment">-- the completed module is type checked, so it is safe to skip</span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-comment">-- the test here. However, users may be annoyed if they get an</span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-comment">-- error in code which has already passed the type checker.</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><span class="hs-comment">-- | Check that a dot pattern matches it's instantiation.</span></span><span>
</span><span id="line-385"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkDotPattern"><span class="hs-identifier hs-type">checkDotPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#DotPattern"><span class="hs-identifier hs-type">DotPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span id="checkDotPattern"><span class="annot"><span class="annottext">checkDotPattern :: DotPattern -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkDotPattern"><span class="hs-identifier hs-var hs-var">checkDotPattern</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#Dot"><span class="hs-identifier hs-type">Dot</span></a></span><span> </span><span id="local-6989586621682119836"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119836"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682119837"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119837"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682119838"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682119838"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682119839"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119839"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><span class="annottext">Call -&gt; TCMT IO () -&gt; TCMT IO ()
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Term -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckDotPattern"><span class="hs-identifier hs-var">CheckDotPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119836"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119837"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.dot&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-389"></span><span>    </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking dot pattern&quot;</span></span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119836"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119837"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119839"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCMT IO () -&gt; TCMT IO ()
forall (tcm :: * -&gt; *) m a.
(MonadTCEnv tcm, LensModality m) =&gt;
m -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-var">applyModalityToContext</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682119838"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621682119844"><span class="annot"><a href="#local-6989586621682119844"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCMT IO Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119836"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119839"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.dot&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-397"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;equalTerm&quot;</span></span><span>
</span><span id="line-398"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119839"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119844"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-400"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119837"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-401"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119839"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119844"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119837"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkAbsurdPattern"><span class="hs-identifier hs-type">checkAbsurdPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#AbsurdPattern"><span class="hs-identifier hs-type">AbsurdPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span id="checkAbsurdPattern"><span class="annot"><span class="annottext">checkAbsurdPattern :: AbsurdPattern -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkAbsurdPattern"><span class="hs-identifier hs-var hs-var">checkAbsurdPattern</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#Absurd"><span class="hs-identifier hs-type">Absurd</span></a></span><span> </span><span id="local-6989586621682119847"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682119847"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682119848"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119848"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Type -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Empty.html#ensureEmptyType"><span class="hs-identifier hs-var">ensureEmptyType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682119847"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119848"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkAnnotationPattern"><span class="hs-identifier hs-type">checkAnnotationPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#AnnotationPattern"><span class="hs-identifier hs-type">AnnotationPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span id="checkAnnotationPattern"><span class="annot"><span class="annottext">checkAnnotationPattern :: AnnotationPattern -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkAnnotationPattern"><span class="hs-identifier hs-var hs-var">checkAnnotationPattern</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span id="local-6989586621682119851"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119851"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682119852"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119852"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.ann&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking type annotation in pattern&quot;</span></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119851"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119852"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-414"></span><span>  </span><span id="local-6989586621682119853"><span class="annot"><a href="#local-6989586621682119853"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Type
</span><a href="Agda.TypeChecking.Rules.Term.html#isType_"><span class="hs-identifier hs-var">isType_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682119851"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalType"><span class="hs-identifier hs-type">equalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119852"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119853"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">-- | After splitting is complete, we transfer the origins</span><span>
</span><span id="line-418"></span><span class="hs-comment">--   We also transfer the locations of absurd patterns, since these haven't</span><span>
</span><span id="line-419"></span><span class="hs-comment">--   been introduced yet in the internal pattern.</span><span>
</span><span id="line-420"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#transferOrigins"><span class="hs-identifier hs-type">transferOrigins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-422"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-423"></span><span id="transferOrigins"><span class="annot"><span class="annottext">transferOrigins :: [NamedArg Pattern]
-&gt; [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
</span><a href="Agda.TypeChecking.Rules.LHS.html#transferOrigins"><span class="hs-identifier hs-var hs-var">transferOrigins</span></a></span></span><span> </span><span id="local-6989586621682119856"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119856"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682119857"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119857"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.origin&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;transferOrigins&quot;</span></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;ps  =   &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119856"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;qs  =   &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119857"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-429"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><span class="annottext">[NamedArg Pattern]
-&gt; [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119858"><span class="hs-identifier hs-var">transfers</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119856"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119857"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-434"></span><span>    </span><span class="annot"><a href="#local-6989586621682119858"><span class="hs-identifier hs-type">transfers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-435"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-436"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621682119858"><span class="annot"><span class="annottext">transfers :: [NamedArg Pattern]
-&gt; [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119858"><span class="hs-identifier hs-var hs-var">transfers</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682119859"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119859"><span class="hs-identifier hs-var">qs</span></a></span></span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Bool)
-&gt; [NamedArg DeBruijnPattern] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-var">notVisible</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119859"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119859"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-439"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM [NamedArg DeBruijnPattern]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="#local-6989586621682119858"><span class="hs-identifier hs-var">transfers</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119863"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119863"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119864"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119864"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM [NamedArg DeBruijnPattern]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="#local-6989586621682119858"><span class="hs-identifier hs-var">transfers</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119865"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119865"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119866"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119866"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119867"><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119867"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119868"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119868"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; NamedArg DeBruijnPattern -&gt; Bool
</span><a href="#local-6989586621682119869"><span class="hs-identifier hs-var">matchingArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119865"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119867"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>          </span><span id="local-6989586621682119870"><span class="annot"><a href="#local-6989586621682119870"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe (NameOf (NamedArg DeBruijnPattern))
 -&gt; Maybe (NameOf (NamedArg DeBruijnPattern)))
-&gt; NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a.
LensNamed a =&gt;
(Maybe (NameOf a) -&gt; Maybe (NameOf a)) -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#mapNameOf"><span class="hs-identifier hs-var">mapNameOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe (NameOf (NamedArg DeBruijnPattern))
 -&gt; Maybe (NameOf (NamedArg DeBruijnPattern)))
-&gt; (NamedName
    -&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
    -&gt; Maybe (NameOf (NamedArg DeBruijnPattern)))
-&gt; Maybe NamedName
-&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
-&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NameOf (NamedArg DeBruijnPattern))
-&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
Maybe NamedName -&gt; Maybe NamedName
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe NamedName -&gt; Maybe NamedName -&gt; Maybe NamedName
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Maybe NamedName -&gt; Maybe NamedName -&gt; Maybe NamedName)
-&gt; (NamedName -&gt; Maybe NamedName)
-&gt; NamedName
-&gt; Maybe NamedName
-&gt; Maybe NamedName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedName -&gt; Maybe NamedName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe NamedName
 -&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
 -&gt; Maybe (NameOf (NamedArg DeBruijnPattern)))
-&gt; Maybe NamedName
-&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
-&gt; Maybe (NameOf (NamedArg DeBruijnPattern))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Maybe (NameOf (NamedArg Pattern))
forall a. LensNamed a =&gt; a -&gt; Maybe (NameOf a)
</span><a href="Agda.Syntax.Common.html#getNameOf"><span class="hs-identifier hs-var">getNameOf</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119865"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- take NamedName from p if present</span><span>
</span><span id="line-444"></span><span>              </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; (NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; NamedArg DeBruijnPattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Origin
forall a. LensOrigin a =&gt; a -&gt; Origin
</span><a href="Agda.Syntax.Common.html#getOrigin"><span class="hs-identifier hs-var">getOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119865"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>            </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; TCMT IO (NamedArg DeBruijnPattern)
-&gt; TCMT IO (NamedArg DeBruijnPattern)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern
 -&gt; TCMT IO (Named NamedName DeBruijnPattern))
-&gt; NamedArg DeBruijnPattern -&gt; TCMT IO (NamedArg DeBruijnPattern)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Arg a -&gt; f (Arg b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((Named NamedName DeBruijnPattern
  -&gt; TCMT IO (Named NamedName DeBruijnPattern))
 -&gt; NamedArg DeBruijnPattern -&gt; TCMT IO (NamedArg DeBruijnPattern))
-&gt; (Named NamedName DeBruijnPattern
    -&gt; TCMT IO (Named NamedName DeBruijnPattern))
-&gt; NamedArg DeBruijnPattern
-&gt; TCMT IO (NamedArg DeBruijnPattern)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; Named NamedName DeBruijnPattern
-&gt; TCMT IO (Named NamedName DeBruijnPattern)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Named NamedName a -&gt; f (Named NamedName b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
 -&gt; Named NamedName DeBruijnPattern
 -&gt; TCMT IO (Named NamedName DeBruijnPattern))
-&gt; (DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; Named NamedName DeBruijnPattern
-&gt; TCMT IO (Named NamedName DeBruijnPattern)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
</span><a href="#local-6989586621682119874"><span class="hs-identifier hs-var">transfer</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; Pattern -&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119865"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119867"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-446"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">q'</span></span><span> </span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682119858"><span class="hs-identifier hs-type">transfers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119866"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119868"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-447"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119867"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern])
-&gt; TCM [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
-&gt; [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119858"><span class="hs-identifier hs-var">transfers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119865"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119866"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119868"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><a href="#local-6989586621682119874"><span class="hs-identifier hs-type">transfer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621682119874"><span class="annot"><span class="annottext">transfer :: Pattern -&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
</span><a href="#local-6989586621682119874"><span class="hs-identifier hs-var hs-var">transfer</span></a></span></span><span> </span><span id="local-6989586621682119875"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119875"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682119876"><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682119876"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; ([Name], Pattern)
</span><a href="Agda.Syntax.Abstract.Views.html#asView"><span class="hs-identifier hs-var">asView</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119875"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682119876"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119877"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119877"><span class="hs-identifier hs-var">asB</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span id="local-6989586621682119878"><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682119878"><span class="hs-identifier hs-var">pi</span></a></span></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119879"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119879"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682119880"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119880"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-type">ConPatternInfo</span></a></span><span> </span><span id="local-6989586621682119882"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682119882"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682119883"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119883"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682119884"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119884"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span id="local-6989586621682119885"><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119885"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span id="local-6989586621682119886"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119886"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682119887"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119887"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119888"><span class="annot"><span class="annottext">cpi :: ConPatternInfo
</span><a href="#local-6989586621682119888"><span class="hs-identifier hs-var hs-var">cpi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternInfo
-&gt; Bool -&gt; Bool -&gt; Maybe (Arg Type) -&gt; Bool -&gt; ConPatternInfo
</span><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-var">ConPatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOCon"><span class="hs-identifier hs-var">PatOCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119877"><span class="hs-identifier hs-var">asB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119883"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119884"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119885"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119886"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><span class="annottext">ConHead
-&gt; ConPatternInfo -&gt; [NamedArg DeBruijnPattern] -&gt; DeBruijnPattern
forall x.
ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-var">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119880"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682119888"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; DeBruijnPattern)
-&gt; TCM [NamedArg DeBruijnPattern] -&gt; TCMT IO DeBruijnPattern
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
-&gt; [NamedArg DeBruijnPattern] -&gt; TCM [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119858"><span class="hs-identifier hs-var">transfers</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682119879"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119887"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119891"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119891"><span class="hs-identifier hs-var">asB</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span> </span><span id="local-6989586621682119892"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682119892"><span class="hs-identifier hs-var">_kwr</span></a></span></span><span> </span><span id="local-6989586621682119893"><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682119893"><span class="hs-identifier hs-var">pi</span></a></span></span><span> </span><span id="local-6989586621682119894"><span class="annot"><span class="annottext">[FieldAssignment' Pattern]
</span><a href="#local-6989586621682119894"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682119895"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119895"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-type">ConPatternInfo</span></a></span><span> </span><span id="local-6989586621682119896"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682119896"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682119897"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119897"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682119898"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119898"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span id="local-6989586621682119899"><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119899"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span id="local-6989586621682119900"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119900"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682119901"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119901"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682119903"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119903"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Term) -&gt; Type -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Type
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Type -&gt; Type) -&gt; Arg Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Maybe (Arg Type) -&gt; Arg Type
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Arg Type
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119899"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-458"></span><span>            </span><span id="local-6989586621682119905"><span class="annot"><span class="annottext">axs :: [Arg Name]
</span><a href="#local-6989586621682119905"><span class="hs-identifier hs-var hs-var hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg QName -&gt; Name) -&gt; [Arg QName] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (Arg QName -&gt; Name) -&gt; Arg QName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; (Arg QName -&gt; QName) -&gt; Arg QName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg QName -&gt; QName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; [Arg QName]
</span><a href="Agda.Syntax.Internal.html#conFields"><span class="hs-identifier hs-var">conFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119895"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [NamedArg DeBruijnPattern] -&gt; [Arg Name]
forall a b. [a] -&gt; [Arg b] -&gt; [Arg a]
</span><a href="Agda.Syntax.Common.html#withArgsFrom"><span class="hs-operator hs-var">`withArgsFrom`</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119901"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-459"></span><span>            </span><span id="local-6989586621682119908"><span class="annot"><span class="annottext">cpi :: ConPatternInfo
</span><a href="#local-6989586621682119908"><span class="hs-identifier hs-var hs-var hs-var">cpi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternInfo
-&gt; Bool -&gt; Bool -&gt; Maybe (Arg Type) -&gt; Bool -&gt; ConPatternInfo
</span><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-var">ConPatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatORec"><span class="hs-identifier hs-var">PatORec</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119891"><span class="hs-identifier hs-var">asB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119897"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119898"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119899"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119900"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span id="local-6989586621682119910"><span class="annot"><a href="#local-6989586621682119910"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConInfo
-&gt; QName
-&gt; (Name -&gt; Pattern)
-&gt; [FieldAssignment' Pattern]
-&gt; [Arg Name]
-&gt; TCMT IO [NamedArg Pattern]
forall a.
HasRange a =&gt;
ConInfo
-&gt; QName
-&gt; (Name -&gt; a)
-&gt; [FieldAssignment' a]
-&gt; [Arg Name]
-&gt; TCM [NamedArg a]
</span><a href="Agda.TypeChecking.Records.html#insertMissingFieldsFail"><span class="hs-identifier hs-var">insertMissingFieldsFail</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-var">ConORec</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682119903"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Name -&gt; Pattern
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Name -&gt; Pattern) -&gt; Pattern -&gt; Name -&gt; Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldAssignment' Pattern]
</span><a href="#local-6989586621682119894"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Name]
</span><a href="#local-6989586621682119905"><span class="hs-identifier hs-var">axs</span></a></span><span>
</span><span id="line-461"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119895"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119908"><span class="hs-identifier hs-type">cpi</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682119858"><span class="hs-identifier hs-type">transfers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119910"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682119901"><span class="hs-identifier hs-type">qs</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119911"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119911"><span class="hs-identifier hs-var">asB</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682119912"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119912"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682119913"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119913"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-type">ConPatternInfo</span></a></span><span> </span><span id="local-6989586621682119914"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682119914"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682119915"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119915"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682119916"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119916"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span id="local-6989586621682119917"><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119917"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span id="local-6989586621682119918"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119918"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682119919"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119919"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119920"><span class="annot"><span class="annottext">cpi :: ConPatternInfo
</span><a href="#local-6989586621682119920"><span class="hs-identifier hs-var hs-var">cpi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternInfo
-&gt; Bool -&gt; Bool -&gt; Maybe (Arg Type) -&gt; Bool -&gt; ConPatternInfo
</span><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-var">ConPatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; PatOrigin
</span><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119912"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119911"><span class="hs-identifier hs-var">asB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119915"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119916"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg Type)
</span><a href="#local-6989586621682119917"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682119918"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-465"></span><span>        </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; ConPatternInfo -&gt; [NamedArg DeBruijnPattern] -&gt; DeBruijnPattern
forall x.
ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-var">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682119913"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682119920"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682119919"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119922"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119922"><span class="hs-identifier hs-var">asB</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682119923"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119923"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119924"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682119924"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; DBPatVar -&gt; DeBruijnPattern
forall x. PatternInfo -&gt; x -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-var">VarP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; PatOrigin
</span><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119923"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119922"><span class="hs-identifier hs-var">asB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682119924"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119925"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119925"><span class="hs-identifier hs-var">asB</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682119926"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119926"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119927"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119927"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; Term -&gt; DeBruijnPattern
forall x. PatternInfo -&gt; Term -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-var">DotP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; PatOrigin
</span><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119926"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119925"><span class="hs-identifier hs-var">asB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119927"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682119928"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119928"><span class="hs-identifier hs-var">asB</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682119929"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119929"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119930"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682119930"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; TCMT IO DeBruijnPattern)
-&gt; DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; Literal -&gt; DeBruijnPattern
forall x. PatternInfo -&gt; Literal -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-var">LitP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; PatOrigin
</span><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119929"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682119928"><span class="hs-identifier hs-var">asB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682119930"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>      </span><span class="annot"><span class="annottext">(([Name], Pattern), DeBruijnPattern)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO DeBruijnPattern
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682119876"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-type">patOrig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PatOrigin"><span class="hs-identifier hs-type">PatOrigin</span></a></span><span>
</span><span id="line-476"></span><span>    </span><span id="local-6989586621682119921"><span class="annot"><span class="annottext">patOrig :: Pattern -&gt; PatOrigin
</span><a href="#local-6989586621682119921"><span class="hs-identifier hs-var hs-var">patOrig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span> </span><span id="local-6989586621682119931"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119931"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOVar"><span class="hs-identifier hs-var">PatOVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119931"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatODot"><span class="hs-identifier hs-var">PatODot</span></a></span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOCon"><span class="hs-identifier hs-var">PatOCon</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatORec"><span class="hs-identifier hs-var">PatORec</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOWild"><span class="hs-identifier hs-var">PatOWild</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdP"><span class="hs-identifier hs-type">A.AbsurdP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOAbsurd"><span class="hs-identifier hs-var">PatOAbsurd</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOLit"><span class="hs-identifier hs-var">PatOLit</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOCon"><span class="hs-identifier hs-var">PatOCon</span></a></span><span> </span><span class="hs-comment">--TODO: origin for EqualP</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefP"><span class="hs-identifier hs-type">A.DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="#local-6989586621682119921"><span class="hs-identifier hs-var">patOrig</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><a href="#local-6989586621682119869"><span class="hs-identifier hs-type">matchingArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-491"></span><span>    </span><span id="local-6989586621682119869"><span class="annot"><span class="annottext">matchingArgs :: NamedArg Pattern -&gt; NamedArg DeBruijnPattern -&gt; Bool
</span><a href="#local-6989586621682119869"><span class="hs-identifier hs-var hs-var">matchingArgs</span></a></span></span><span> </span><span id="local-6989586621682119937"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682119938"><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119938"><span class="hs-identifier hs-var">q</span></a></span></span><span>
</span><span id="line-492"></span><span>      </span><span class="hs-comment">-- The arguments match if</span><span>
</span><span id="line-493"></span><span>      </span><span class="hs-comment">-- 1. they are both projections,</span><span>
</span><span id="line-494"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (ProjOrigin, AmbiguousQName) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Maybe (ProjOrigin, AmbiguousQName)
forall a. IsProjP a =&gt; a -&gt; Maybe (ProjOrigin, AmbiguousQName)
</span><a href="Agda.Syntax.Abstract.Name.html#isProjP"><span class="hs-identifier hs-var">A.isProjP</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ProjOrigin, AmbiguousQName) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; Maybe (ProjOrigin, AmbiguousQName)
forall a. IsProjP a =&gt; a -&gt; Maybe (ProjOrigin, AmbiguousQName)
</span><a href="Agda.Syntax.Abstract.Name.html#isProjP"><span class="hs-identifier hs-var">isProjP</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119938"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>      </span><span class="hs-comment">-- 2. or they are both visible,</span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119938"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-497"></span><span>      </span><span class="hs-comment">-- 3. or they have the same hiding and the argument is not named,</span><span>
</span><span id="line-498"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; NamedArg DeBruijnPattern -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119938"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe NamedName -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Maybe (NameOf (NamedArg Pattern))
forall a. LensNamed a =&gt; a -&gt; Maybe (NameOf a)
</span><a href="Agda.Syntax.Common.html#getNameOf"><span class="hs-identifier hs-var">getNameOf</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-comment">-- 4. or they have the same hiding and the same name.</span><span>
</span><span id="line-500"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; NamedArg DeBruijnPattern -&gt; Bool
forall a b. (LensHiding a, LensHiding b) =&gt; a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-var">sameHiding</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119938"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; NamedArg DeBruijnPattern -&gt; Bool
forall a b.
(LensNamed a, LensNamed b, NameOf a ~ NamedName,
 NameOf b ~ NamedName) =&gt;
a -&gt; b -&gt; Bool
</span><a href="Agda.Syntax.Common.html#namedSame"><span class="hs-identifier hs-var">namedSame</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682119937"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682119938"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-501"></span><span>      </span><span class="hs-comment">-- Otherwise this argument was inserted by the typechecker.</span><span>
</span><span id="line-502"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">-- | If a user-written variable occurs more than once, it should be bound</span><span>
</span><span id="line-506"></span><span class="hs-comment">--   to the same internal variable (or term) in all positions.</span><span>
</span><span id="line-507"></span><span class="hs-comment">--   Returns the list of patterns with the duplicate user patterns removed.</span><span>
</span><span id="line-508"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkPatternLinearity"><span class="hs-identifier hs-type">checkPatternLinearity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-509"></span><span id="checkPatternLinearity"><span class="annot"><span class="annottext">checkPatternLinearity :: [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkPatternLinearity"><span class="hs-identifier hs-var hs-var">checkPatternLinearity</span></a></span></span><span> </span><span id="local-6989586621682119945"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119945"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.linear&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking linearity of pattern variables&quot;</span></span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><span class="annottext">Map BindName (Term, Type) -&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119946"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119945"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><a href="#local-6989586621682119946"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621682119946"><span class="annot"><span class="annottext">check :: Map BindName (Term, Type) -&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119946"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><a href="#local-6989586621682119946"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span id="local-6989586621682119948"><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><a href="#local-6989586621682119948"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119949"><span class="annot"><span class="annottext">eq :: ProblemEq
</span><a href="#local-6989586621682119949"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682119950"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119950"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682119951"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119951"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682119952"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682119953"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119953"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-516"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.linear&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-517"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;linearity: checking pattern &quot;</span></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119950"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-519"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; equal to term &quot;</span></span><span>
</span><span id="line-520"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119951"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-521"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; of type &quot;</span></span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Dom Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119950"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span> </span><span id="local-6989586621682119954"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119954"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682119955"><span class="annot"><span class="annottext">y :: Name
</span><a href="#local-6989586621682119955"><span class="hs-identifier hs-var hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Name
</span><a href="Agda.Syntax.Abstract.html#unBind"><span class="hs-identifier hs-var">A.unBind</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119954"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.linear&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO ()) -&gt; String -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-528"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pattern variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">A.nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119955"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; with id &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NameId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">A.nameId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119955"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Map BindName (Term, Type) -&gt; Maybe (Term, Type)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119954"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><a href="#local-6989586621682119948"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-530"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682119959"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119959"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682119960"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119960"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-531"></span><span>              </span><span class="annot"><span class="annottext">Call -&gt; TCMT IO () -&gt; TCMT IO ()
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckPatternLinearityType"><span class="hs-identifier hs-var">CheckPatternLinearityType</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Call) -&gt; Name -&gt; Call
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">A.nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119955"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-532"></span><span>                </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Type -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalType"><span class="hs-identifier hs-var">equalType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682119960"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-533"></span><span>              </span><span class="annot"><span class="annottext">Call -&gt; TCMT IO () -&gt; TCMT IO ()
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckPatternLinearityValue"><span class="hs-identifier hs-var">CheckPatternLinearityValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Call) -&gt; Name -&gt; Call
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">A.nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682119955"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-534"></span><span>                </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Type -&gt; Term -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-var">equalTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119951"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119959"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-535"></span><span>              </span><span class="annot"><span class="annottext">Map BindName (Term, Type) -&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119946"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><a href="#local-6989586621682119948"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119953"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-536"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Term, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682119949"><span class="hs-identifier hs-var">eq</span></a></span><span class="annot"><span class="annottext">ProblemEq -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq])
-&gt; TCMT IO [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-537"></span><span>              </span><span class="annot"><span class="annottext">Map BindName (Term, Type) -&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119946"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName
-&gt; (Term, Type)
-&gt; Map BindName (Term, Type)
-&gt; Map BindName (Term, Type)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119954"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119951"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><a href="#local-6989586621682119948"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119953"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682119965"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119965"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682119966"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119966"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>          </span><span class="annot"><span class="annottext">Map BindName (Term, Type) -&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119946"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><a href="#local-6989586621682119948"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; TCMT IO [ProblemEq])
-&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Pattern
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682119965"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119951"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682119966"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682119951"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682119952"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119953"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-540"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119967"><span class="hs-identifier hs-var">continue</span></a></span><span>
</span><span id="line-541"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119967"><span class="hs-identifier hs-var">continue</span></a></span><span>
</span><span id="line-542"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdP"><span class="hs-identifier hs-type">A.AbsurdP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119967"><span class="hs-identifier hs-var">continue</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefP"><span class="hs-identifier hs-type">A.DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-549"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [ProblemEq]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682119967"><span class="annot"><span class="annottext">continue :: TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119967"><span class="hs-identifier hs-var hs-var">continue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682119949"><span class="hs-identifier hs-var">eq</span></a></span><span class="annot"><span class="annottext">ProblemEq -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq])
-&gt; TCMT IO [ProblemEq] -&gt; TCMT IO [ProblemEq]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type) -&gt; [ProblemEq] -&gt; TCMT IO [ProblemEq]
</span><a href="#local-6989586621682119946"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Map BindName (Term, Type)
</span><a href="#local-6989586621682119948"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682119953"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">-- | Construct the context for a left hand side, making up out-of-scope names</span><span>
</span><span id="line-555"></span><span class="hs-comment">--   for unnamed variables.</span><span>
</span><span id="line-556"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#computeLHSContext"><span class="hs-identifier hs-type">computeLHSContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-557"></span><span id="computeLHSContext"><span class="annot"><span class="annottext">computeLHSContext :: [Maybe Name] -&gt; Telescope -&gt; TCM Context
</span><a href="Agda.TypeChecking.Rules.LHS.html#computeLHSContext"><span class="hs-identifier hs-var hs-var">computeLHSContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Name] -&gt; [Maybe Name] -&gt; Telescope -&gt; TCM Context
forall {m :: * -&gt; *}.
(MonadDebug m, MonadFresh NameId m) =&gt;
Context -&gt; [Name] -&gt; [Maybe Name] -&gt; Telescope -&gt; m Context
</span><a href="#local-6989586621682119969"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621682119969"><span class="annot"><span class="annottext">go :: Context -&gt; [Name] -&gt; [Maybe Name] -&gt; Telescope -&gt; m Context
</span><a href="#local-6989586621682119969"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682120023"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120023"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span id="local-6989586621682120024"><span class="annot"><span class="annottext">tel :: Telescope
</span><a href="#local-6989586621682120024"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-561"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;computeLHSContext: no patterns left, but tel =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120024"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-562"></span><span>      </span><span class="annot"><span class="annottext">m Context
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-563"></span><span>    </span><span class="annot"><a href="#local-6989586621682119969"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682120025"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120025"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">Telescope
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Context
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><a href="#local-6989586621682119969"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682120026"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120026"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="annottext">Telescope
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; m Context
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120026"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><a href="#local-6989586621682119969"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682120027"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120027"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621682120028"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682120028"><span class="hs-identifier hs-var">taken</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682120029"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682120029"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682120030"><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621682120030"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682120031"><span class="annot"><span class="annottext">tel0 :: Telescope
</span><a href="#local-6989586621682120031"><span class="hs-identifier hs-var">tel0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682120032"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120032"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682120033"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682120033"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>        </span><span id="local-6989586621682120034"><span class="annot"><a href="#local-6989586621682120034"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Name -&gt; (Name -&gt; m Name) -&gt; Maybe Name -&gt; m Name
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; String -&gt; m Name
forall {m :: * -&gt; *} {p}.
MonadFresh NameId m =&gt;
p -&gt; String -&gt; m Name
</span><a href="#local-6989586621682120035"><span class="hs-identifier hs-var">dummyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682120028"><span class="hs-identifier hs-var">taken</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m Name) -&gt; String -&gt; m Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Abs Telescope -&gt; String
forall a. Abs a -&gt; String
</span><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var">absName</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682120033"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; m Name
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682120029"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120037"><span class="annot"><a href="#local-6989586621682120037"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Dom Type -&gt; ContextEntry
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CtxVar"><span class="hs-identifier hs-var">CtxVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682120034"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120032"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-568"></span><span>        </span><span class="annot"><a href="#local-6989586621682119969"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682120037"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682120027"><span class="hs-identifier hs-type">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682120034"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682120028"><span class="hs-identifier hs-type">taken</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682120030"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-type">absBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120033"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>    </span><span id="local-6989586621682120035"><span class="annot"><span class="annottext">dummyName :: p -&gt; String -&gt; m Name
</span><a href="#local-6989586621682120035"><span class="hs-identifier hs-var hs-var">dummyName</span></a></span></span><span> </span><span id="local-6989586621682120059"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682120059"><span class="hs-identifier hs-var">taken</span></a></span></span><span> </span><span id="local-6989586621682120060"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682120060"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-571"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Underscore a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isUnderscore"><span class="hs-identifier hs-var">isUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682120060"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Name
forall (m :: * -&gt; *). MonadFresh NameId m =&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Base.html#freshNoName_"><span class="hs-identifier hs-var">freshNoName_</span></a></span><span>
</span><span id="line-572"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall a. LensInScope a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Concrete.Name.html#setNotInScope"><span class="hs-identifier hs-var">setNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; m Name -&gt; m Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m Name
forall a (m :: * -&gt; *).
(FreshName a, MonadFresh NameId m) =&gt;
a -&gt; m Name
forall (m :: * -&gt; *). MonadFresh NameId m =&gt; String -&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Base.html#freshName_"><span class="hs-identifier hs-var">freshName_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Syntax.Common.html#argNameToString"><span class="hs-identifier hs-var">argNameToString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682120060"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><span class="hs-comment">-- | Bind as patterns</span></span><span>
</span><span id="line-575"></span><span id="local-6989586621682117850"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-type">bindAsPatterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#AsBinding"><span class="hs-identifier hs-type">AsBinding</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117850"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117850"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-576"></span><span id="bindAsPatterns"><span class="annot"><span class="annottext">bindAsPatterns :: forall a. [AsBinding] -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-var hs-var">bindAsPatterns</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                </span><span id="local-6989586621682120085"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682120085"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682120085"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-577"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-var">bindAsPatterns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#AsB"><span class="hs-identifier hs-type">AsB</span></a></span><span> </span><span id="local-6989586621682120087"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682120087"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682120088"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682120088"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682120089"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120089"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682120090"><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120090"><span class="hs-identifier hs-var">asb</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682120091"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682120091"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.as&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;as pattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Name -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682120087"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Dom Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120089"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682120088"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-581"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="annottext">Origin -&gt; Name -&gt; Term -&gt; Dom Type -&gt; TCM a -&gt; TCM a
forall a.
Origin -&gt; Name -&gt; Term -&gt; Dom Type -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Origin -&gt; Name -&gt; Term -&gt; Dom Type -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding%27"><span class="hs-identifier hs-var">addLetBinding'</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682120087"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682120088"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120089"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[AsBinding] -&gt; TCM a -&gt; TCM a
forall a. [AsBinding] -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-var">bindAsPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120090"><span class="hs-identifier hs-var">asb</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682120091"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="hs-comment">-- | Since with-abstraction can change the type of a variable, we have to</span><span>
</span><span id="line-585"></span><span class="hs-comment">--   recheck the stripped with patterns when checking a with function.</span><span>
</span><span id="line-586"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#recheckStrippedWithPattern"><span class="hs-identifier hs-type">recheckStrippedWithPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span id="recheckStrippedWithPattern"><span class="annot"><span class="annottext">recheckStrippedWithPattern :: ProblemEq -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#recheckStrippedWithPattern"><span class="hs-identifier hs-var hs-var">recheckStrippedWithPattern</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682120094"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682120094"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682120095"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682120095"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682120096"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120096"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682120094"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Comparison -&gt; TypeOf Term -&gt; TCMT IO ()
forall a (m :: * -&gt; *).
(CheckInternal a, MonadCheckInternal m) =&gt;
a -&gt; Comparison -&gt; TypeOf a -&gt; m ()
forall (m :: * -&gt; *).
MonadCheckInternal m =&gt;
Term -&gt; Comparison -&gt; TypeOf Term -&gt; m ()
</span><a href="Agda.TypeChecking.CheckInternal.html#checkInternal"><span class="hs-identifier hs-var">checkInternal</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682120095"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120096"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO () -&gt; (TCErr -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO ()) -&gt; TypeError -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#IllTypedPatternAfterWithAbstraction"><span class="hs-identifier hs-var">IllTypedPatternAfterWithAbstraction</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682120094"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="annot"><span class="hs-comment">-- | Result of checking the LHS of a clause.</span></span><span>
</span><span id="line-593"></span><span class="hs-keyword">data</span><span> </span><span id="LHSResult"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-var">LHSResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LHSResult"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-var">LHSResult</span></a></span></span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="lhsParameters"><span class="annot"><span class="annottext">LHSResult -&gt; Int
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsParameters"><span class="hs-identifier hs-var hs-var">lhsParameters</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-comment">-- ^ The number of original module parameters. These are present in the</span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-comment">-- the patterns.</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsVarTele"><span class="annot"><span class="annottext">LHSResult -&gt; Telescope
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsVarTele"><span class="hs-identifier hs-var hs-var">lhsVarTele</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-comment">-- ^ &#916; : The types of the pattern variables, in internal dependency order.</span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-comment">-- Corresponds to 'clauseTel'.</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsPatterns"><span class="annot"><span class="annottext">LHSResult -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsPatterns"><span class="hs-identifier hs-var hs-var">lhsPatterns</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The patterns in internal syntax.</span></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsHasAbsurd"><span class="annot"><span class="annottext">LHSResult -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsHasAbsurd"><span class="hs-identifier hs-var hs-var">lhsHasAbsurd</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Whether the LHS has at least one absurd pattern.</span></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsBodyType"><span class="annot"><span class="annottext">LHSResult -&gt; Arg Type
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsBodyType"><span class="hs-identifier hs-var hs-var">lhsBodyType</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-605"></span><span>    </span><span class="hs-comment">-- ^ The type of the body. Is @b&#963;@ if @&#915;@ is defined.</span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-comment">-- 'Irrelevant' to indicate the rhs must be checked in irrelevant mode.</span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsPatSubst"><span class="annot"><span class="annottext">LHSResult -&gt; Substitution
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsPatSubst"><span class="hs-identifier hs-var hs-var">lhsPatSubst</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-comment">-- ^ Substitution version of @lhsPatterns@, only up to the first projection</span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-comment">-- pattern. @&#916; |- lhsPatSubst : &#915;@. Where @&#915;@ is the argument telescope of</span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-comment">-- the function. This is used to update inherited dot patterns in</span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-comment">-- with-function clauses.</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsAsBindings"><span class="annot"><span class="annottext">LHSResult -&gt; [AsBinding]
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsAsBindings"><span class="hs-identifier hs-var hs-var">lhsAsBindings</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#AsBinding"><span class="hs-identifier hs-type">AsBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-comment">-- ^ As-bindings from the left-hand side. Return instead of bound since we</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-comment">-- want them in where's and right-hand sides, but not in with-clauses</span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-comment">-- (Issue 2303).</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsPartialSplit"><span class="annot"><span class="annottext">LHSResult -&gt; IntSet
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsPartialSplit"><span class="hs-identifier hs-var hs-var">lhsPartialSplit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ have we done a partial split?</span></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lhsIndexedSplit"><span class="annot"><span class="annottext">LHSResult -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsIndexedSplit"><span class="hs-identifier hs-var hs-var">lhsIndexedSplit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ have we split on an indexed type?</span></span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#InstantiateFull"><span class="hs-identifier hs-type">InstantiateFull</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-623"></span><span>  </span><span id="local-6989586621682120153"><span class="annot"><span class="annottext">instantiateFull' :: LHSResult -&gt; ReduceM LHSResult
</span><a href="#local-6989586621682120153"><span class="hs-identifier hs-var hs-var hs-var">instantiateFull'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span id="local-6989586621682120155"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120155"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682120156"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120156"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682120157"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120157"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682120158"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120158"><span class="hs-identifier hs-var">abs</span></a></span></span><span> </span><span id="local-6989586621682120159"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682120159"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682120160"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682120160"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621682120161"><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120161"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621682120162"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682120162"><span class="hs-identifier hs-var">psplit</span></a></span></span><span> </span><span id="local-6989586621682120163"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120163"><span class="hs-identifier hs-var">ixsplit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Bool
-&gt; Arg Type
-&gt; Substitution
-&gt; [AsBinding]
-&gt; IntSet
-&gt; Bool
-&gt; LHSResult
</span><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-var">LHSResult</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120155"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><span class="annottext">(Telescope
 -&gt; [NamedArg DeBruijnPattern]
 -&gt; Bool
 -&gt; Arg Type
 -&gt; Substitution
 -&gt; [AsBinding]
 -&gt; IntSet
 -&gt; Bool
 -&gt; LHSResult)
-&gt; ReduceM Telescope
-&gt; ReduceM
     ([NamedArg DeBruijnPattern]
      -&gt; Bool
      -&gt; Arg Type
      -&gt; Substitution
      -&gt; [AsBinding]
      -&gt; IntSet
      -&gt; Bool
      -&gt; LHSResult)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; ReduceM Telescope
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120156"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-625"></span><span>    </span><span class="annot"><span class="annottext">ReduceM
  ([NamedArg DeBruijnPattern]
   -&gt; Bool
   -&gt; Arg Type
   -&gt; Substitution
   -&gt; [AsBinding]
   -&gt; IntSet
   -&gt; Bool
   -&gt; LHSResult)
-&gt; ReduceM [NamedArg DeBruijnPattern]
-&gt; ReduceM
     (Bool
      -&gt; Arg Type
      -&gt; Substitution
      -&gt; [AsBinding]
      -&gt; IntSet
      -&gt; Bool
      -&gt; LHSResult)
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; ReduceM [NamedArg DeBruijnPattern]
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120157"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><span class="annottext">ReduceM
  (Bool
   -&gt; Arg Type
   -&gt; Substitution
   -&gt; [AsBinding]
   -&gt; IntSet
   -&gt; Bool
   -&gt; LHSResult)
-&gt; ReduceM Bool
-&gt; ReduceM
     (Arg Type
      -&gt; Substitution -&gt; [AsBinding] -&gt; IntSet -&gt; Bool -&gt; LHSResult)
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ReduceM Bool
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120158"><span class="hs-identifier hs-var">abs</span></a></span><span>
</span><span id="line-627"></span><span>    </span><span class="annot"><span class="annottext">ReduceM
  (Arg Type
   -&gt; Substitution -&gt; [AsBinding] -&gt; IntSet -&gt; Bool -&gt; LHSResult)
-&gt; ReduceM (Arg Type)
-&gt; ReduceM
     (Substitution -&gt; [AsBinding] -&gt; IntSet -&gt; Bool -&gt; LHSResult)
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; ReduceM (Arg Type)
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682120159"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span class="annot"><span class="annottext">ReduceM
  (Substitution -&gt; [AsBinding] -&gt; IntSet -&gt; Bool -&gt; LHSResult)
-&gt; ReduceM Substitution
-&gt; ReduceM ([AsBinding] -&gt; IntSet -&gt; Bool -&gt; LHSResult)
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; ReduceM Substitution
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682120160"><span class="hs-identifier hs-var">sub</span></a></span><span>
</span><span id="line-629"></span><span>    </span><span class="annot"><span class="annottext">ReduceM ([AsBinding] -&gt; IntSet -&gt; Bool -&gt; LHSResult)
-&gt; ReduceM [AsBinding] -&gt; ReduceM (IntSet -&gt; Bool -&gt; LHSResult)
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[AsBinding] -&gt; ReduceM [AsBinding]
forall t. InstantiateFull t =&gt; t -&gt; ReduceM t
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-var">instantiateFull'</span></a></span><span> </span><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120161"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span class="annot"><span class="annottext">ReduceM (IntSet -&gt; Bool -&gt; LHSResult)
-&gt; ReduceM IntSet -&gt; ReduceM (Bool -&gt; LHSResult)
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; ReduceM IntSet
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682120162"><span class="hs-identifier hs-var">psplit</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span class="annot"><span class="annottext">ReduceM (Bool -&gt; LHSResult) -&gt; ReduceM Bool -&gt; ReduceM LHSResult
forall a b. ReduceM (a -&gt; b) -&gt; ReduceM a -&gt; ReduceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ReduceM Bool
forall a. a -&gt; ReduceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120163"><span class="hs-identifier hs-var">ixsplit</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="hs-comment">-- | Check a LHS. Main function.</span><span>
</span><span id="line-634"></span><span class="hs-comment">--</span><span>
</span><span id="line-635"></span><span class="hs-comment">--   @checkLeftHandSide a ps a ret@ checks that user patterns @ps@ eliminate</span><span>
</span><span id="line-636"></span><span class="hs-comment">--   the type @a@ of the defined function, and calls continuation @ret@</span><span>
</span><span id="line-637"></span><span class="hs-comment">--   if successful.</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLeftHandSide"><span class="hs-identifier hs-type">checkLeftHandSide</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682117878"><span class="annot"><a href="#local-6989586621682117878"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-640"></span><span>     </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span>
</span><span id="line-641"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Trace, e.g. 'CheckLHS' or 'CheckPattern'.</span></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>
</span><span id="line-643"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ 'Range' of the entire left hand side, for error reporting.</span></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-645"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The name of the definition we are checking.</span></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-647"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The patterns.</span></span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-649"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The expected type @a = &#915; &#8594; b@.</span></span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>
</span><span id="line-651"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Module parameter substitution from with-abstraction.</span></span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-653"></span><span>     </span><span class="hs-comment">-- ^ Patterns that have been stripped away by with-desugaring.</span><span>
</span><span id="line-654"></span><span>     </span><span class="hs-comment">-- ^ These should not contain any proper matches.</span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117878"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Continuation.</span></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117878"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-658"></span><span id="checkLeftHandSide"><span class="annot"><span class="annottext">checkLeftHandSide :: forall a.
Call
-&gt; Range
-&gt; Maybe QName
-&gt; [NamedArg Pattern]
-&gt; Type
-&gt; Maybe Substitution
-&gt; [ProblemEq]
-&gt; (LHSResult -&gt; TCM a)
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkLeftHandSide"><span class="hs-identifier hs-var hs-var">checkLeftHandSide</span></a></span></span><span> </span><span id="local-6989586621682120486"><span class="annot"><span class="annottext">Call
</span><a href="#local-6989586621682120486"><span class="hs-identifier hs-var">call</span></a></span></span><span> </span><span id="local-6989586621682120487"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682120487"><span class="hs-identifier hs-var">lhsRng</span></a></span></span><span> </span><span id="local-6989586621682120488"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682120488"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682120489"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682120489"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682120490"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120490"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682120491"><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682120491"><span class="hs-identifier hs-var">withSub'</span></a></span></span><span> </span><span id="local-6989586621682120492"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682120492"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-659"></span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; ((LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (LHSResult -&gt; TCMT IO a)
-&gt; TCMT IO a
forall (m :: * -&gt; *) b c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; ((b -&gt; m c) -&gt; m c) -&gt; (b -&gt; m c) -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billToCPS"><span class="hs-identifier hs-var">Bench.billToCPS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Bench.Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#CheckLHS"><span class="hs-identifier hs-var">Bench.CheckLHS</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(((LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
 -&gt; (LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; ((LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (LHSResult -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-660"></span><span> </span><span class="annot"><span class="annottext">Call
-&gt; ((LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (LHSResult -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b.
Call
-&gt; ((a -&gt; TCMT IO b) -&gt; TCMT IO b) -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b.
MonadTrace m =&gt;
Call -&gt; ((a -&gt; m b) -&gt; m b) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCallCPS"><span class="hs-identifier hs-var">traceCallCPS</span></a></span><span> </span><span class="annot"><span class="annottext">Call
</span><a href="#local-6989586621682120486"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">(((LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
 -&gt; (LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; ((LHSResult -&gt; TCMT IO a) -&gt; TCMT IO a)
-&gt; (LHSResult -&gt; TCMT IO a)
-&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682120497"><span class="annot"><span class="annottext">LHSResult -&gt; TCMT IO a
</span><a href="#local-6989586621682120497"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-comment">-- To allow module parameters to be refined by matching, we're adding the</span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-comment">-- context arguments as wildcard patterns and extending the type with the</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-comment">-- context telescope.</span><span>
</span><span id="line-665"></span><span>  </span><span id="local-6989586621682120498"><span class="annot"><a href="#local-6989586621682120498"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ContextEntry -&gt; ContextEntry) -&gt; Context -&gt; Context
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; ContextEntry -&gt; ContextEntry
forall a. LensOrigin a =&gt; Origin -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-var">setOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Context) -&gt; TCM Context -&gt; TCM Context
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM Context
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Context
</span><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-var">getContext</span></a></span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120500"><span class="annot"><a href="#local-6989586621682120500"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#contextToTel"><span class="hs-identifier hs-var">contextToTel</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120498"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-667"></span><span>      </span><span id="local-6989586621682120502"><span class="annot"><a href="#local-6989586621682120502"><span class="hs-identifier hs-var hs-var">cps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Dom' Term Name -&gt; Arg Name
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Name
</span><a href="#local-6989586621682120503"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Name -&gt; Named NamedName Pattern -&gt; NamedArg Pattern
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Named NamedName Pattern
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindName -&gt; Pattern
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Pattern) -&gt; BindName -&gt; Pattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; BindName
</span><a href="Agda.Syntax.Abstract.html#mkBindName"><span class="hs-identifier hs-var">A.mkBindName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; BindName) -&gt; Name -&gt; BindName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term Name -&gt; Name
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Name
</span><a href="#local-6989586621682120503"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682120503"><span class="annot"><span class="annottext">Dom' Term Name
</span><a href="#local-6989586621682120503"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [(Int, Dom' Term Name)]
</span><a href="Agda.TypeChecking.Monad.Context.html#contextVars"><span class="hs-identifier hs-var">contextVars</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120498"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-669"></span><span>      </span><span id="local-6989586621682120508"><span class="annot"><a href="#local-6989586621682120508"><span class="hs-identifier hs-var hs-var">eqs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq)
-&gt; [Pattern] -&gt; [Term] -&gt; [Dom Type] -&gt; [ProblemEq]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><span class="hs-identifier hs-var">zipWith3</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Term -&gt; Dom Type -&gt; ProblemEq
</span><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-var">ProblemEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg Pattern -&gt; Pattern) -&gt; [NamedArg Pattern] -&gt; [Pattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Pattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682120502"><span class="hs-identifier hs-var">cps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Term) -&gt; [Int] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Term]) -&gt; [Int] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120500"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; [Dom Type]
forall a. TermSubst a =&gt; Tele (Dom a) -&gt; [Dom a]
</span><a href="Agda.TypeChecking.Telescope.html#flattenTel"><span class="hs-identifier hs-var">flattenTel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120500"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682120513"><span class="hs-identifier hs-type">finalChecks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117878"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117878"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span id="local-6989586621682120513"><span class="annot"><a href="#local-6989586621682120513"><span class="hs-identifier hs-var hs-var">finalChecks</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span id="local-6989586621682120515"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120515"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682120516"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120516"><span class="hs-identifier hs-var">qs0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#Problem"><span class="hs-identifier hs-type">Problem</span></a></span><span> </span><span id="local-6989586621682120517"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682120517"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621682120518"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682120518"><span class="hs-identifier hs-var">rps</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHSState a -&gt; TCMT IO a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682120519"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682120519"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682120520"><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682120520"><span class="hs-identifier hs-var">psplit</span></a></span></span><span> </span><span id="local-6989586621682120521"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120521"><span class="hs-identifier hs-var">ixsplit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-675"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;lhs: final checks with remaining equations&quot;</span></span><span>
</span><span id="line-676"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682120517"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;(none)&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120515"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ProblemEq -&gt; TCMT IO Doc) -&gt; [ProblemEq] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ProblemEq -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682120517"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-677"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;qs0 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120515"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; TCMT IO Doc
forall (m :: * -&gt; *).
MonadPretty m =&gt;
[NamedArg DeBruijnPattern] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCMPatternList"><span class="hs-identifier hs-var">prettyTCMPatternList</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120516"><span class="hs-identifier hs-var">qs0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg Pattern] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682120518"><span class="hs-identifier hs-var">rps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120515"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-683"></span><span>          </span><span class="annot"><span class="annottext">(ProblemEq -&gt; TCMT IO ()) -&gt; [ProblemEq] -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#noShadowingOfConstructors"><span class="hs-identifier hs-var">noShadowingOfConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682120517"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>          </span><span class="hs-comment">-- When working --without-K or --cubical=compatible, we have</span><span>
</span><span id="line-686"></span><span>          </span><span class="hs-comment">-- to check that the target type can be used at the &#8220;ambient&#8221;</span><span>
</span><span id="line-687"></span><span>          </span><span class="hs-comment">-- modality. For --cubical=compatible, this just improves an</span><span>
</span><span id="line-688"></span><span>          </span><span class="hs-comment">-- error message (printing the type rather than the generated</span><span>
</span><span id="line-689"></span><span>          </span><span class="hs-comment">-- RHS). For --without-K, it implements the same check without</span><span>
</span><span id="line-690"></span><span>          </span><span class="hs-comment">-- necessarily generating --cubical code.</span><span>
</span><span id="line-691"></span><span>          </span><span class="hs-comment">-- The reason for this check is that a clause</span><span>
</span><span id="line-692"></span><span>          </span><span class="hs-comment">--    foo : x &#8801; y &#8594; ... &#8594; T y</span><span>
</span><span id="line-693"></span><span>          </span><span class="hs-comment">--    foo refl ... = ...</span><span>
</span><span id="line-694"></span><span>          </span><span class="hs-comment">-- in Cubical mode, gets elaborated to an extra clause of the</span><span>
</span><span id="line-695"></span><span>          </span><span class="hs-comment">-- form</span><span>
</span><span id="line-696"></span><span>          </span><span class="hs-comment">--    foo (transp p &#966; x) ... = transp (&#955; i &#8594; T (p i)) &#966; (foo x ...)</span><span>
</span><span id="line-697"></span><span>          </span><span class="hs-comment">-- (approximately), where T is the target type. That is: to</span><span>
</span><span id="line-698"></span><span>          </span><span class="hs-comment">-- implement the substitution T[y/x], we use an actual</span><span>
</span><span id="line-699"></span><span>          </span><span class="hs-comment">-- transport. See #5448.</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>        </span><span id="local-6989586621682120525"><span class="annot"><a href="#local-6989586621682120525"><span class="hs-identifier hs-var">arity_a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Int
</span><a href="Agda.TypeChecking.Telescope.Path.html#arityPiPath"><span class="hs-identifier hs-var">arityPiPath</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120490"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-704"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;a        =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-705"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;arity_a  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120525"><span class="hs-identifier hs-type">arity_a</span></a></span><span>
</span><span id="line-706"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;withSub' =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120491"><span class="hs-identifier hs-type">withSub'</span></a></span><span>
</span><span id="line-707"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-comment">-- Compute substitution from the out patterns @qs0@</span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120527"><span class="annot"><a href="#local-6989586621682120527"><span class="hs-identifier hs-var hs-var">notProj</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-711"></span><span>            </span><span class="annot"><a href="#local-6989586621682120527"><span class="hs-identifier hs-var">notProj</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-712"></span><span>            </span><span id="local-6989586621682120528"><span class="annot"><a href="#local-6989586621682120528"><span class="hs-identifier hs-var hs-var">numPats</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; Int)
-&gt; [NamedArg DeBruijnPattern] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Bool)
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Bool
forall {x}. Pattern' x -&gt; Bool
</span><a href="#local-6989586621682120527"><span class="hs-identifier hs-var">notProj</span></a></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; Bool)
-&gt; (NamedArg DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; DeBruijnPattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120516"><span class="hs-identifier hs-var">qs0</span></a></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>            </span><span class="hs-comment">-- We have two slightly different cases here: normal function and</span><span>
</span><span id="line-715"></span><span>            </span><span class="hs-comment">-- with-function. In both cases the goal is to build a substitution</span><span>
</span><span id="line-716"></span><span>            </span><span class="hs-comment">-- from the context &#915; of the previous checkpoint to the current lhs</span><span>
</span><span id="line-717"></span><span>            </span><span class="hs-comment">-- context &#916;:</span><span>
</span><span id="line-718"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-719"></span><span>            </span><span class="hs-comment">--    &#916; &#8866; paramSub : &#915;</span><span>
</span><span id="line-720"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-721"></span><span>            </span><span class="hs-comment">--  * Normal function, f</span><span>
</span><span id="line-722"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-723"></span><span>            </span><span class="hs-comment">--    &#915; = cxt = module parameter telescope of f</span><span>
</span><span id="line-724"></span><span>            </span><span class="hs-comment">--    &#936; = non-parameter arguments of f (we have f : &#915; &#936; &#8594; A)</span><span>
</span><span id="line-725"></span><span>            </span><span class="hs-comment">--    &#916;   &#8866; patSub  : &#915; &#936;</span><span>
</span><span id="line-726"></span><span>            </span><span class="hs-comment">--    &#915; &#936; &#8866; weakSub : &#915;</span><span>
</span><span id="line-727"></span><span>            </span><span class="hs-comment">--    paramSub = patSub &#8728; weakSub</span><span>
</span><span id="line-728"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-729"></span><span>            </span><span class="hs-comment">--  * With-function</span><span>
</span><span id="line-730"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-731"></span><span>            </span><span class="hs-comment">--    &#915; = lhs context of the parent clause (cxt = [])</span><span>
</span><span id="line-732"></span><span>            </span><span class="hs-comment">--    &#936; = argument telescope of with-function</span><span>
</span><span id="line-733"></span><span>            </span><span class="hs-comment">--    &#920; = inserted implicit patterns not in &#936; (#2827)</span><span>
</span><span id="line-734"></span><span>            </span><span class="hs-comment">--        (this happens if the goal computes to an implicit</span><span>
</span><span id="line-735"></span><span>            </span><span class="hs-comment">--         function type after some matching in the with-clause)</span><span>
</span><span id="line-736"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-737"></span><span>            </span><span class="hs-comment">--    &#936;   &#8866; withSub : &#915;</span><span>
</span><span id="line-738"></span><span>            </span><span class="hs-comment">--    &#916;   &#8866; patSub  : &#936; &#920;</span><span>
</span><span id="line-739"></span><span>            </span><span class="hs-comment">--    &#936; &#920; &#8866; weakSub : &#936;</span><span>
</span><span id="line-740"></span><span>            </span><span class="hs-comment">--    paramSub = patSub &#8728; weakSub &#8728; withSub</span><span>
</span><span id="line-741"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-742"></span><span>            </span><span class="hs-comment">--    To compute &#920; we can look at the arity of the with-function</span><span>
</span><span id="line-743"></span><span>            </span><span class="hs-comment">--    and compare it to numPats. This works since the with-function</span><span>
</span><span id="line-744"></span><span>            </span><span class="hs-comment">--    type is fully reduced.</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>            </span><span class="annot"><a href="#local-6989586621682120530"><span class="hs-identifier hs-type">weakSub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>
</span><span id="line-747"></span><span>            </span><span id="local-6989586621682120530"><span class="annot"><a href="#local-6989586621682120530"><span class="hs-identifier hs-var hs-var">weakSub</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Substitution -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682120491"><span class="hs-identifier hs-var">withSub'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#wkS"><span class="hs-identifier hs-var">wkS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120528"><span class="hs-identifier hs-var">numPats</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120525"><span class="hs-identifier hs-var">arity_a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span> </span><span class="hs-comment">-- if numPats &lt; arity, &#920; is empty</span><span>
</span><span id="line-748"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#wkS"><span class="hs-identifier hs-var">wkS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120528"><span class="hs-identifier hs-var">numPats</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120498"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span>
</span><span id="line-749"></span><span>            </span><span id="local-6989586621682120534"><span class="annot"><a href="#local-6989586621682120534"><span class="hs-identifier hs-var hs-var">withSub</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Maybe Substitution -&gt; Substitution
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682120491"><span class="hs-identifier hs-var">withSub'</span></a></span><span>
</span><span id="line-750"></span><span>            </span><span id="local-6989586621682120535"><span class="annot"><a href="#local-6989586621682120535"><span class="hs-identifier hs-var hs-var">patSub</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Term)
-&gt; [NamedArg DeBruijnPattern] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; Term)
-&gt; (NamedArg DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; DeBruijnPattern
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120528"><span class="hs-identifier hs-var">numPats</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120516"><span class="hs-identifier hs-var">qs0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution -&gt; Substitution
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#%2B%2B%23"><span class="hs-operator hs-var">++#</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible -&gt; Substitution
forall a. Impossible -&gt; Substitution' a
</span><a href="Agda.Syntax.Internal.html#EmptyS"><span class="hs-identifier hs-var">EmptyS</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible
HasCallStack =&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span>
</span><span id="line-751"></span><span>            </span><span id="local-6989586621682120542"><span class="annot"><a href="#local-6989586621682120542"><span class="hs-identifier hs-var hs-var">paramSub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682120535"><span class="hs-identifier hs-var">patSub</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Substitution -&gt; Substitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682120530"><span class="hs-identifier hs-var">weakSub</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Substitution -&gt; Substitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682120534"><span class="hs-identifier hs-var">withSub</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>        </span><span id="local-6989586621682120544"><span class="annot"><a href="#local-6989586621682120544"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkPatternLinearity"><span class="hs-identifier hs-type">checkPatternLinearity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120517"><span class="hs-identifier hs-type">eqs</span></a></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span>        </span><span id="local-6989586621682120545"><span class="annot"><a href="#local-6989586621682120545"><span class="hs-identifier hs-var">leftovers</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LeftoverPatterns"><span class="hs-identifier hs-type">LeftoverPatterns</span></a></span><span> </span><span id="local-6989586621682120547"><span class="annot"><a href="#local-6989586621682120547"><span class="hs-identifier hs-var">patVars</span></a></span></span><span> </span><span id="local-6989586621682120548"><span class="annot"><a href="#local-6989586621682120548"><span class="hs-identifier hs-var">asb0</span></a></span></span><span> </span><span id="local-6989586621682120549"><span class="annot"><a href="#local-6989586621682120549"><span class="hs-identifier hs-var">dots</span></a></span></span><span> </span><span id="local-6989586621682120550"><span class="annot"><a href="#local-6989586621682120550"><span class="hs-identifier hs-var">absurds</span></a></span></span><span> </span><span id="local-6989586621682120551"><span class="annot"><a href="#local-6989586621682120551"><span class="hs-identifier hs-var">annps</span></a></span></span><span> </span><span id="local-6989586621682120552"><span class="annot"><a href="#local-6989586621682120552"><span class="hs-identifier hs-var">otherPats</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#getLeftoverPatterns"><span class="hs-identifier hs-type">getLeftoverPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120544"><span class="hs-identifier hs-type">eqs</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.leftover&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-759"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;leftover patterns: &quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120545"><span class="hs-identifier hs-type">leftovers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120552"><span class="hs-identifier hs-type">otherPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>        </span><span class="hs-comment">-- Get the user-written names for the pattern variables</span><span>
</span><span id="line-764"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682120554"><span class="annot"><a href="#local-6989586621682120554"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682120555"><span class="annot"><a href="#local-6989586621682120555"><span class="hs-identifier hs-var">asb1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#getUserVariableNames"><span class="hs-identifier hs-type">getUserVariableNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120547"><span class="hs-identifier hs-type">patVars</span></a></span><span>
</span><span id="line-765"></span><span>            </span><span id="local-6989586621682120557"><span class="annot"><a href="#local-6989586621682120557"><span class="hs-identifier hs-var hs-var">asb</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120548"><span class="hs-identifier hs-var">asb0</span></a></span><span> </span><span class="annot"><span class="annottext">[AsBinding] -&gt; [AsBinding] -&gt; [AsBinding]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120555"><span class="hs-identifier hs-var">asb1</span></a></span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span>        </span><span class="hs-comment">-- Rename internal patterns with these names</span><span>
</span><span id="line-768"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120560"><span class="annot"><a href="#local-6989586621682120560"><span class="hs-identifier hs-var hs-var">makeVar</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; DeBruijnPattern)
-&gt; (Name -&gt; Int -&gt; DeBruijnPattern)
-&gt; Maybe Name
-&gt; Int
-&gt; DeBruijnPattern
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; DeBruijnPattern
forall a. DeBruijn a =&gt; Int -&gt; a
</span><a href="Agda.TypeChecking.Substitute.DeBruijn.html#deBruijnVar"><span class="hs-identifier hs-var">deBruijnVar</span></a></span><span> </span><span class="annot"><span class="annottext">((Name -&gt; Int -&gt; DeBruijnPattern)
 -&gt; Maybe Name -&gt; Int -&gt; DeBruijnPattern)
-&gt; (Name -&gt; Int -&gt; DeBruijnPattern)
-&gt; Maybe Name
-&gt; Int
-&gt; DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; DeBruijnPattern
forall a. DeBruijn a =&gt; String -&gt; Int -&gt; a
</span><a href="Agda.TypeChecking.Substitute.DeBruijn.html#deBruijnNamedVar"><span class="hs-identifier hs-var">deBruijnNamedVar</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Int -&gt; DeBruijnPattern)
-&gt; (Name -&gt; String) -&gt; Name -&gt; Int -&gt; DeBruijnPattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="Agda.Syntax.Abstract.Name.html#nameToArgName"><span class="hs-identifier hs-var">nameToArgName</span></a></span><span>
</span><span id="line-769"></span><span>            </span><span id="local-6989586621682120564"><span class="annot"><a href="#local-6989586621682120564"><span class="hs-identifier hs-var hs-var">ren</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DeBruijnPattern] -&gt; PatternSubstitution
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-var">parallelS</span></a></span><span> </span><span class="annot"><span class="annottext">([DeBruijnPattern] -&gt; PatternSubstitution)
-&gt; [DeBruijnPattern] -&gt; PatternSubstitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; Int -&gt; DeBruijnPattern)
-&gt; [Maybe Name] -&gt; [Int] -&gt; [DeBruijnPattern]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Int -&gt; DeBruijnPattern
</span><a href="#local-6989586621682120560"><span class="hs-identifier hs-var">makeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Name] -&gt; [Maybe Name]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621682120554"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>        </span><span id="local-6989586621682120567"><span class="annot"><a href="#local-6989586621682120567"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#transferOrigins"><span class="hs-identifier hs-type">transferOrigins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682120502"><span class="hs-identifier hs-type">cps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682120489"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120564"><span class="hs-identifier hs-type">ren</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120516"><span class="hs-identifier hs-type">qs0</span></a></span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120569"><span class="annot"><a href="#local-6989586621682120569"><span class="hs-identifier hs-var hs-var">hasAbsurd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([AbsurdPattern] -&gt; Bool) -&gt; [AbsurdPattern] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[AbsurdPattern] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([AbsurdPattern] -&gt; Bool) -&gt; [AbsurdPattern] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[AbsurdPattern]
</span><a href="#local-6989586621682120550"><span class="hs-identifier hs-var">absurds</span></a></span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120571"><span class="annot"><a href="#local-6989586621682120571"><span class="hs-identifier hs-var hs-var">lhsResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Bool
-&gt; Arg Type
-&gt; Substitution
-&gt; [AsBinding]
-&gt; IntSet
-&gt; Bool
-&gt; LHSResult
</span><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-var">LHSResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120498"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120515"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682120567"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120569"><span class="hs-identifier hs-var">hasAbsurd</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682120519"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682120535"><span class="hs-identifier hs-var">patSub</span></a></span><span> </span><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682120557"><span class="hs-identifier hs-var">asb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><span class="hs-identifier hs-var">IntSet.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; IntSet) -&gt; [Int] -&gt; IntSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Int]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682120520"><span class="hs-identifier hs-var">psplit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682120521"><span class="hs-identifier hs-var">ixsplit</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>        </span><span class="hs-comment">-- Debug output</span><span>
</span><span id="line-778"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-779"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;checked lhs:&quot;</span></span><span>
</span><span id="line-780"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-781"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;delta   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-782"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;dots    = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120549"><span class="hs-identifier hs-type">dots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;asb     = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120557"><span class="hs-identifier hs-type">asb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;absurds = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120550"><span class="hs-identifier hs-type">absurds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;qs      = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120567"><span class="hs-identifier hs-type">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;b       = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120519"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-788"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-789"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-790"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-791"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;vars   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120554"><span class="hs-identifier hs-type">vars</span></a></span><span>
</span><span id="line-792"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;b      = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120519"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-793"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-794"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;withSub  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120534"><span class="hs-identifier hs-type">withSub</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;weakSub  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120530"><span class="hs-identifier hs-type">weakSub</span></a></span><span>
</span><span id="line-796"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;patSub   = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120535"><span class="hs-identifier hs-type">patSub</span></a></span><span>
</span><span id="line-797"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;paramSub = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120542"><span class="hs-identifier hs-type">paramSub</span></a></span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span>        </span><span id="local-6989586621682120578"><span class="annot"><a href="#local-6989586621682120578"><span class="hs-identifier hs-var">newCxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#computeLHSContext"><span class="hs-identifier hs-type">computeLHSContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120554"><span class="hs-identifier hs-type">vars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120515"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-type">updateContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120542"><span class="hs-identifier hs-type">paramSub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><a href="#local-6989586621682120578"><span class="hs-identifier hs-type">newCxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;bound pattern variables&quot;</span></span><span>
</span><span id="line-804"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;context = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;type  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120519"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-806"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;type  = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120519"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-type">bindAsPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120557"><span class="hs-identifier hs-type">asb</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span>            </span><span class="hs-comment">-- Check dot patterns</span><span>
</span><span id="line-811"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkDotPattern"><span class="hs-identifier hs-type">checkDotPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120549"><span class="hs-identifier hs-type">dots</span></a></span><span>
</span><span id="line-812"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkAbsurdPattern"><span class="hs-identifier hs-type">checkAbsurdPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120550"><span class="hs-identifier hs-type">absurds</span></a></span><span>
</span><span id="line-813"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkAnnotationPattern"><span class="hs-identifier hs-type">checkAnnotationPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120551"><span class="hs-identifier hs-type">annps</span></a></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span>          </span><span class="hs-comment">-- Issue2303: don't bind asb' for the continuation (return in lhsResult instead)</span><span>
</span><span id="line-816"></span><span>          </span><span class="annot"><a href="#local-6989586621682120497"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120571"><span class="hs-identifier hs-type">lhsResult</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>  </span><span id="local-6989586621682120581"><span class="annot"><a href="#local-6989586621682120581"><span class="hs-identifier hs-var">st0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.ProblemRest.html#initLHSState"><span class="hs-identifier hs-type">initLHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120500"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120508"><span class="hs-identifier hs-type">eqs0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120489"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120513"><span class="hs-identifier hs-type">finalChecks</span></a></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-comment">-- after we have introduced variables, we can add the patterns stripped by</span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-comment">-- with-desugaring to the state.</span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120583"><span class="annot"><a href="#local-6989586621682120583"><span class="hs-identifier hs-var hs-var">withSub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Maybe Substitution -&gt; Substitution
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682120491"><span class="hs-identifier hs-var">withSub'</span></a></span><span>
</span><span id="line-823"></span><span>  </span><span id="local-6989586621682120584"><span class="annot"><a href="#local-6989586621682120584"><span class="hs-identifier hs-var">withEqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#updateProblemEqs"><span class="hs-identifier hs-type">updateProblemEqs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120583"><span class="hs-identifier hs-type">withSub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120492"><span class="hs-identifier hs-type">strippedPats</span></a></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-comment">-- Jesper, 2017-05-13: re-check the stripped patterns here!</span><span>
</span><span id="line-825"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682120581"><span class="hs-identifier hs-type">st0</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-type">lhsTel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682120584"><span class="hs-identifier hs-type">withEqs</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#recheckStrippedWithPattern"><span class="hs-identifier hs-type">recheckStrippedWithPattern</span></a></span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120589"><span class="annot"><a href="#local-6989586621682120589"><span class="hs-identifier hs-var hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (LHSState a) [ProblemEq] -&gt; LensMap (LHSState a) [ProblemEq]
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Problem a -&gt; f (Problem a)) -&gt; LHSState a -&gt; f (LHSState a)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Problem a -&gt; f (Problem a)) -&gt; LHSState a -&gt; f (LHSState a)
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsProblem"><span class="hs-identifier hs-var">lhsProblem</span></a></span><span> </span><span class="annot"><span class="annottext">((Problem a -&gt; f (Problem a)) -&gt; LHSState a -&gt; f (LHSState a))
-&gt; (([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a))
-&gt; ([ProblemEq] -&gt; f [ProblemEq])
-&gt; LHSState a
-&gt; f (LHSState a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ProblemEq] -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682120584"><span class="hs-identifier hs-var">withEqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682120581"><span class="hs-identifier hs-var">st0</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-comment">-- doing the splits:</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682120594"><span class="annot"><a href="#local-6989586621682120594"><span class="hs-identifier hs-var hs-var">initLHSContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSContext"><span class="hs-identifier hs-type">LHSContext</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lhsRange :: Range
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsRange"><span class="hs-identifier hs-var">lhsRange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682120487"><span class="hs-identifier hs-var">lhsRng</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lhsContextSize :: Int
</span><a href="Agda.TypeChecking.Rules.LHS.html#lhsContextSize"><span class="hs-identifier hs-var">lhsContextSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682120498"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682120595"><span class="annot"><a href="#local-6989586621682120595"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682120596"><span class="annot"><a href="#local-6989586621682120596"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#unsafeInTopContext"><span class="hs-identifier hs-type">unsafeInTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`runReaderT`</span></span><span> </span><span class="annot"><span class="hs-identifier">initLHSContext</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLHS"><span class="hs-identifier hs-type">checkLHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120488"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120589"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682120595"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="hs-comment">-- | Check that this split will generate a modality-correct internal</span><span>
</span><span id="line-836"></span><span class="hs-comment">-- clause when --cubical=compatible is used. This means that the type of</span><span>
</span><span id="line-837"></span><span class="hs-comment">-- anything which might be transported must be modality-correct. This is</span><span>
</span><span id="line-838"></span><span class="hs-comment">-- necessarily an approximate check. We assume that any argument which</span><span>
</span><span id="line-839"></span><span class="hs-comment">-- (a) comes after and (b) mentions a dotted argument will be</span><span>
</span><span id="line-840"></span><span class="hs-comment">-- transported, which is probably an overestimate.</span><span>
</span><span id="line-841"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#conSplitModalityCheck"><span class="hs-identifier hs-type">conSplitModalityCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-842"></span><span>     </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>
</span><span id="line-843"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Range of the whole left hand side, for error reporting.</span></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span>
</span><span id="line-845"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Modality to check at.</span></span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PatternSubstitution"><span class="hs-identifier hs-type">PatternSubstitution</span></a></span><span>
</span><span id="line-847"></span><span>      </span><span class="hs-comment">-- ^ Substitution resulting from index unification. @&#915; &#8866; &#961; : &#916;'@,</span><span>
</span><span id="line-848"></span><span>      </span><span class="hs-comment">-- where @&#916;'@ is the context we're in, and @&#915;@ is the clause telescope</span><span>
</span><span id="line-849"></span><span>      </span><span class="hs-comment">-- before unification.</span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Variable @x@ at which we split.</span></span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The telescope @&#915;@ itself.</span></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Target type of the clause.</span></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span id="conSplitModalityCheck"><span class="annot"><span class="annottext">conSplitModalityCheck :: Range
-&gt; Modality
-&gt; PatternSubstitution
-&gt; Int
-&gt; Telescope
-&gt; Type
-&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#conSplitModalityCheck"><span class="hs-identifier hs-var hs-var">conSplitModalityCheck</span></a></span></span><span> </span><span id="local-6989586621682120600"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682120600"><span class="hs-identifier hs-var">lhsRng</span></a></span></span><span> </span><span id="local-6989586621682120601"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682120601"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682120602"><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span></span><span> </span><span id="local-6989586621682120603"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120603"><span class="hs-identifier hs-var">blocking</span></a></span></span><span> </span><span id="local-6989586621682120604"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span id="local-6989586621682120605"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom Type -&gt; Bool) -&gt; Telescope -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Agda.Syntax.Common.html#defaultModality"><span class="hs-identifier hs-var">defaultModality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Bool) -&gt; (Dom Type -&gt; Modality) -&gt; Dom Type -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-856"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;LHS modality check for modality: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Modality -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682120601"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-857"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho:    &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; PatternSubstitution -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;gamma:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;target: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-860"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;target (raw): &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;&#916;'target: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Type -&gt; Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;blocking:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Int -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120603"><span class="hs-identifier hs-var">blocking</span></a></span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-864"></span><span>  </span><span class="annot"><span class="annottext">Maybe Int -&gt; (Int -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Int -&gt; Maybe Int
</span><a href="#local-6989586621682120609"><span class="hs-identifier hs-var">firstForced</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Tele a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682120610"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120610"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-865"></span><span>      </span><span class="hs-comment">-- We've found a forced argument. This means that the unifier has</span><span>
</span><span id="line-866"></span><span>      </span><span class="hs-comment">-- decided to kill a unification variable, and any of its</span><span>
</span><span id="line-867"></span><span>      </span><span class="hs-comment">-- occurrences in the generated term will be replaced by an</span><span>
</span><span id="line-868"></span><span>      </span><span class="hs-comment">-- occurrence of a path, and any terms whose types mention that</span><span>
</span><span id="line-869"></span><span>      </span><span class="hs-comment">-- variable will be transported.</span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-871"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682120611"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120611"><span class="hs-identifier hs-var hs-var">gamma0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682120612"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120612"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Telescope -&gt; (Telescope, Telescope)
</span><a href="Agda.TypeChecking.Telescope.html#splitTelescopeAt"><span class="hs-identifier hs-var">splitTelescopeAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Tele a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120610"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-872"></span><span>        </span><span id="local-6989586621682120614"><span class="annot"><span class="annottext">name :: Int -&gt; TCMT IO Name
</span><a href="#local-6989586621682120614"><span class="hs-identifier hs-var hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO Name -&gt; TCMT IO Name
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Name -&gt; TCMT IO Name)
-&gt; (Int -&gt; TCMT IO Name) -&gt; Int -&gt; TCMT IO Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Name -&gt; TCMT IO Name
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Name -&gt; TCMT IO Name)
-&gt; (Int -&gt; TCMT IO Name) -&gt; Int -&gt; TCMT IO Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Name
forall (m :: * -&gt; *). (MonadDebug m, MonadTCEnv m) =&gt; Int -&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Context.html#nameOfBV"><span class="hs-identifier hs-var">nameOfBV</span></a></span><span>
</span><span id="line-873"></span><span>        </span><span id="local-6989586621682120616"><span class="annot"><span class="annottext">delta'target :: Type
</span><a href="#local-6989586621682120616"><span class="hs-identifier hs-var hs-var hs-var">delta'target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Type -&gt; Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-874"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-875"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;found forced argument!&quot;</span></span><span>
</span><span id="line-876"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;forced: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Int -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120610"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-877"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;before: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120611"><span class="hs-identifier hs-var">gamma0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;after:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120611"><span class="hs-identifier hs-var">gamma0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120612"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-880"></span><span>      </span><span id="local-6989586621682120617"><span class="annot"><a href="#local-6989586621682120617"><span class="hs-identifier hs-var">forced</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Name
</span><a href="#local-6989586621682120614"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120610"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-881"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682120610"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682120610"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-type">telToList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120612"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682120619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120619"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682120620"><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682120620"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-882"></span><span>        </span><span class="hs-comment">-- Example: The first argument after the first forced variable. So</span><span>
</span><span id="line-883"></span><span>        </span><span class="hs-comment">-- we have e.g.:</span><span>
</span><span id="line-884"></span><span>        </span><span class="hs-comment">--   &#915; = &#915;&#8320;.x.&#916;</span><span>
</span><span id="line-885"></span><span>        </span><span class="hs-comment">--   &#916;' &#8866; &#961; : &#915;&#8320;.x.&#916;</span><span>
</span><span id="line-886"></span><span>        </span><span class="hs-comment">--   &#915;&#8320; &#8866; x : Type</span><span>
</span><span id="line-887"></span><span>        </span><span class="hs-comment">-- but we need</span><span>
</span><span id="line-888"></span><span>        </span><span class="hs-comment">--   &#916;' &#8866; x : Type,</span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-comment">-- since &#916;' is the context we are in. Then we have</span><span>
</span><span id="line-890"></span><span>        </span><span class="hs-comment">--   &#915; &#8866; x[wkS |&#916;|] : Type</span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-comment">-- and consequently</span><span>
</span><span id="line-892"></span><span>        </span><span class="hs-comment">--   &#916;' &#8866; x[wkS |&#916;|][&#961;] : Type</span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-894"></span><span>          </span><span id="local-6989586621682120621"><span class="annot"><span class="annottext">rho' :: PatternSubstitution
</span><a href="#local-6989586621682120621"><span class="hs-identifier hs-var hs-var hs-var">rho'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; PatternSubstitution -&gt; PatternSubstitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-identifier hs-var">composeS</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PatternSubstitution -&gt; PatternSubstitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#wkS"><span class="hs-identifier hs-var">wkS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120619"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>        </span><span id="local-6989586621682120622"><span class="annot"><a href="#local-6989586621682120622"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Term -&gt; Term
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120621"><span class="hs-identifier hs-var">rho'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom (String, Type) -&gt; (String, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682120620"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-897"></span><span>          </span><span class="hs-comment">-- It's actually rather tricky to know when, exactly, a</span><span>
</span><span id="line-898"></span><span>          </span><span class="hs-comment">-- transport will be needed in a position that forces an</span><span>
</span><span id="line-899"></span><span>          </span><span class="hs-comment">-- usable-at-modality check. Our current heuristic is:</span><span>
</span><span id="line-900"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-901"></span><span>          </span><span class="hs-comment">-- The variable we're looking at has a fibrant type, with the</span><span>
</span><span id="line-902"></span><span>          </span><span class="hs-comment">-- first forced variable free.</span><span>
</span><span id="line-903"></span><span>          </span><span class="hs-comment">-- The variable appears free in the result type.</span><span>
</span><span id="line-904"></span><span>          </span><span id="local-6989586621682120624"><span class="annot"><a href="#local-6989586621682120624"><span class="hs-identifier hs-var hs-var">docheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span>
</span><span id="line-905"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120610"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; Bool
forall a. Free a =&gt; Int -&gt; a -&gt; Bool
</span><a href="Agda.TypeChecking.Free.html#freeIn"><span class="hs-operator hs-var">`freeIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#wkS"><span class="hs-identifier hs-var">wkS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120619"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom (String, Type) -&gt; (String, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682120620"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120619"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120603"><span class="hs-identifier hs-var">blocking</span></a></span><span>
</span><span id="line-907"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120619"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Bool
forall a. Free a =&gt; Int -&gt; a -&gt; Bool
</span><a href="Agda.TypeChecking.Free.html#freeIn"><span class="hs-operator hs-var">`freeIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-908"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-909"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-910"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;arg:        &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120619"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-911"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;arg type:   &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-type">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#wkS"><span class="hs-identifier hs-type">wkS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682120619"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-type">idS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120620"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;check       &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120624"><span class="hs-identifier hs-type">docheck</span></a></span><span>
</span><span id="line-913"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-914"></span><span>        </span><span id="local-6989586621682120626"><span class="annot"><a href="#local-6989586621682120626"><span class="hs-identifier hs-var">argn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682120614"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120619"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-915"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120624"><span class="hs-identifier hs-type">docheck</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-916"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html#usableAtModality"><span class="hs-identifier hs-type">usableAtModality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IndexedClauseArg"><span class="hs-identifier hs-type">IndexedClauseArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120617"><span class="hs-identifier hs-type">forced</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120626"><span class="hs-identifier hs-type">argn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682120601"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682120622"><span class="hs-identifier hs-type">ty'</span></a></span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-comment">-- ALways check the target clause type. Specifically, we check it both</span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-comment">-- in &#916;' and in &#915;. The check in &#916;' will sometimes let slip by a</span><span>
</span><span id="line-920"></span><span>  </span><span class="hs-comment">-- quantity violation which is masked by an indexed match (recall that</span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-comment">-- the unifier likes to replace @0-variables for @&#969;-variables). A</span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-comment">-- concrete case where this happens is #5468. Check in &#916;' first since</span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-comment">-- that will have the forced variable names.</span><span>
</span><span id="line-924"></span><span>  </span><span class="annot"><span class="annottext">Range -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682120600"><span class="hs-identifier hs-var">lhsRng</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-925"></span><span>    </span><span class="annot"><span class="annottext">WhyCheckModality -&gt; Modality -&gt; Term -&gt; TCMT IO ()
MonadConstraint (TCMT IO) =&gt;
WhyCheckModality -&gt; Modality -&gt; Term -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Irrelevance.html#usableAtModality"><span class="hs-identifier hs-var">usableAtModality</span></a></span><span> </span><span class="annot"><span class="annottext">WhyCheckModality
</span><a href="Agda.TypeChecking.Monad.Base.html#IndexedClause"><span class="hs-identifier hs-var">IndexedClause</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682120601"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Type -&gt; Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120602"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682120604"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WhyCheckModality -&gt; Modality -&gt; Term -&gt; TCMT IO ()
MonadConstraint (TCMT IO) =&gt;
WhyCheckModality -&gt; Modality -&gt; Term -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Irrelevance.html#usableAtModality"><span class="hs-identifier hs-var">usableAtModality</span></a></span><span> </span><span class="annot"><span class="annottext">WhyCheckModality
</span><a href="Agda.TypeChecking.Monad.Base.html#IndexedClause"><span class="hs-identifier hs-var">IndexedClause</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682120601"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682120605"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-928"></span><span>    </span><span class="hs-comment">-- Find the first dotted pattern in the substitution. &quot;First&quot; =</span><span>
</span><span id="line-929"></span><span>    </span><span class="hs-comment">-- &quot;earliest bound&quot;, so counts down from the length of the</span><span>
</span><span id="line-930"></span><span>    </span><span class="hs-comment">-- telescope.</span><span>
</span><span id="line-931"></span><span>    </span><span class="annot"><a href="#local-6989586621682120609"><span class="hs-identifier hs-type">firstForced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PatternSubstitution"><span class="hs-identifier hs-type">PatternSubstitution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-932"></span><span>    </span><span id="local-6989586621682120609"><span class="annot"><span class="annottext">firstForced :: PatternSubstitution -&gt; Int -&gt; Maybe Int
</span><a href="#local-6989586621682120609"><span class="hs-identifier hs-var hs-var">firstForced</span></a></span></span><span> </span><span id="local-6989586621682120630"><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120630"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682120631"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120631"><span class="hs-identifier hs-var">level</span></a></span></span><span>
</span><span id="line-933"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120631"><span class="hs-identifier hs-var">level</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Int -&gt; DeBruijnPattern
forall a. EndoSubst a =&gt; Substitution' a -&gt; Int -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#lookupS"><span class="hs-identifier hs-var">lookupS</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120630"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120631"><span class="hs-identifier hs-var">level</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-934"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120631"><span class="hs-identifier hs-var">level</span></a></span><span>
</span><span id="line-935"></span><span>        </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Int -&gt; Maybe Int
</span><a href="#local-6989586621682120609"><span class="hs-identifier hs-var">firstForced</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682120630"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682120631"><span class="hs-identifier hs-var">level</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="annot"><span class="hs-comment">-- | Determine which splits should be tried.</span></span><span>
</span><span id="line-939"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#splitStrategy"><span class="hs-identifier hs-type">splitStrategy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-940"></span><span id="splitStrategy"><span class="annot"><span class="annottext">splitStrategy :: [ProblemEq] -&gt; [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.html#splitStrategy"><span class="hs-identifier hs-var hs-var">splitStrategy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ProblemEq -&gt; Bool) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; Bool
</span><a href="#local-6989586621682120634"><span class="hs-identifier hs-var">shouldSplit</span></a></span><span>
</span><span id="line-941"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-942"></span><span>    </span><span class="annot"><a href="#local-6989586621682120634"><span class="hs-identifier hs-type">shouldSplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-943"></span><span>    </span><span id="local-6989586621682120634"><span class="annot"><span class="annottext">shouldSplit :: ProblemEq -&gt; Bool
</span><a href="#local-6989586621682120634"><span class="hs-identifier hs-var hs-var">shouldSplit</span></a></span></span><span> </span><span id="local-6989586621682120635"><span class="annot"><span class="annottext">problem :: ProblemEq
</span><a href="#local-6989586621682120635"><span class="hs-identifier hs-var">problem</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682120636"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682120636"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682120637"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682120637"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682120638"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682120638"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682120636"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-944"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-945"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-946"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-947"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-950"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-951"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-952"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdP"><span class="hs-identifier hs-type">A.AbsurdP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682120639"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682120639"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemEq -&gt; Bool
</span><a href="#local-6989586621682120634"><span class="hs-identifier hs-var">shouldSplit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProblemEq -&gt; Bool) -&gt; ProblemEq -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682120635"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#problemInPat"><span class="hs-identifier hs-var">problemInPat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682120639"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-957"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefP"><span class="hs-identifier hs-type">A.DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-958"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-959"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span class="annot"><span class="hs-comment">-- | The loop (tail-recursive): split at a variable in the problem until problem is solved</span></span><span>
</span><span id="line-963"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLHS"><span class="hs-identifier hs-type">checkLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682117996"><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span></span><span> </span><span id="local-6989586621682117997"><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked_"><span class="hs-identifier hs-type">Blocked_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSContext"><span class="hs-identifier hs-type">LHSContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The name of the definition we are checking.</span></span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ The current state.</span></span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-967"></span><span id="checkLHS"><span class="annot"><span class="annottext">checkLHS :: forall (tcm :: * -&gt; *) a.
(MonadTCM tcm, PureTCM tcm, MonadWriter (Blocked' Term ()) tcm,
 MonadError TCErr tcm, MonadTrace tcm,
 MonadReader LHSContext tcm) =&gt;
Maybe QName -&gt; LHSState a -&gt; tcm a
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkLHS"><span class="hs-identifier hs-var hs-var">checkLHS</span></a></span></span><span> </span><span id="local-6989586621682121591"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682121591"><span class="hs-identifier hs-var">mf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHSState a -&gt; tcm a) -&gt; LHSState a -&gt; tcm a
forall {tcm :: * -&gt; *} {a} {a}.
MonadTCEnv tcm =&gt;
(LHSState a -&gt; tcm a) -&gt; LHSState a -&gt; tcm a
</span><a href="#local-6989586621682121592"><span class="hs-identifier hs-var">updateModality</span></a></span><span> </span><span class="annot"><span class="annottext">LHSState a -&gt; tcm a
</span><a href="#local-6989586621682121593"><span class="hs-identifier hs-var">checkLHS_</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-comment">-- If the target type is irrelevant or in Prop,</span><span>
</span><span id="line-969"></span><span>    </span><span class="hs-comment">-- we need to check the lhs in irr. cxt. (see Issue 939).</span><span>
</span><span id="line-970"></span><span> </span><span id="local-6989586621682121592"><span class="annot"><span class="annottext">updateModality :: (LHSState a -&gt; tcm a) -&gt; LHSState a -&gt; tcm a
</span><a href="#local-6989586621682121592"><span class="hs-identifier hs-var hs-var">updateModality</span></a></span></span><span> </span><span id="local-6989586621682121608"><span class="annot"><span class="annottext">LHSState a -&gt; tcm a
</span><a href="#local-6989586621682121608"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span id="local-6989586621682121609"><span class="annot"><span class="annottext">st :: LHSState a
</span><a href="#local-6989586621682121609"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span id="local-6989586621682121610"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121610"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682121611"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121611"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span id="local-6989586621682121612"><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121612"><span class="hs-identifier hs-var">problem</span></a></span></span><span> </span><span id="local-6989586621682121613"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121613"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682121614"><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682121614"><span class="hs-identifier hs-var">psplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-971"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121615"><span class="annot"><span class="annottext">m :: Modality
</span><a href="#local-6989586621682121615"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121613"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-972"></span><span>      </span><span class="annot"><span class="annottext">Modality -&gt; tcm a -&gt; tcm a
forall (tcm :: * -&gt; *) m a.
(MonadTCEnv tcm, LensModality m) =&gt;
m -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContext"><span class="hs-identifier hs-var">applyModalityToContext</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682121615"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(tcm a -&gt; tcm a) -&gt; tcm a -&gt; tcm a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-973"></span><span>        </span><span class="annot"><span class="annottext">LHSState a -&gt; tcm a
</span><a href="#local-6989586621682121608"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">(LHSState a -&gt; tcm a) -&gt; LHSState a -&gt; tcm a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' (LHSState a) [Dom (String, Type)]
-&gt; LensMap (LHSState a) [Dom (String, Type)]
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Telescope -&gt; f Telescope) -&gt; LHSState a -&gt; f (LHSState a)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Telescope -&gt; f Telescope) -&gt; LHSState a -&gt; f (LHSState a)
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-var">lhsTel</span></a></span><span> </span><span class="annot"><span class="annottext">((Telescope -&gt; f Telescope) -&gt; LHSState a -&gt; f (LHSState a))
-&gt; (([Dom (String, Type)] -&gt; f [Dom (String, Type)])
    -&gt; Telescope -&gt; f Telescope)
-&gt; ([Dom (String, Type)] -&gt; f [Dom (String, Type)])
-&gt; LHSState a
-&gt; f (LHSState a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Dom (String, Type)] -&gt; f [Dom (String, Type)])
-&gt; Telescope -&gt; f Telescope
Lens' Telescope [Dom (String, Type)]
</span><a href="Agda.Syntax.Internal.html#listTel"><span class="hs-identifier hs-var">listTel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom (String, Type) -&gt; Dom (String, Type))
-&gt; [Dom (String, Type)] -&gt; [Dom (String, Type)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((Dom (String, Type) -&gt; Dom (String, Type))
 -&gt; [Dom (String, Type)] -&gt; [Dom (String, Type)])
-&gt; (Dom (String, Type) -&gt; Dom (String, Type))
-&gt; [Dom (String, Type)]
-&gt; [Dom (String, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Dom (String, Type) -&gt; Dom (String, Type)
forall a. LensModality a =&gt; Modality -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#inverseApplyModalityButNotQuantity"><span class="hs-identifier hs-var">inverseApplyModalityButNotQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682121615"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121609"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-975"></span><span>        </span><span class="hs-comment">-- Andreas, 2018-10-23, issue #3309</span><span>
</span><span id="line-976"></span><span>        </span><span class="hs-comment">-- the modalities in the clause telescope also need updating.</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span> </span><span id="local-6989586621682121593"><span class="annot"><span class="annottext">checkLHS_ :: LHSState a -&gt; tcm a
</span><a href="#local-6989586621682121593"><span class="hs-identifier hs-var hs-var">checkLHS_</span></a></span></span><span> </span><span id="local-6989586621682121621"><span class="annot"><span class="annottext">st :: LHSState a
</span><a href="#local-6989586621682121621"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span id="local-6989586621682121622"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682121623"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span id="local-6989586621682121624"><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span></span><span> </span><span id="local-6989586621682121625"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682121626"><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682121626"><span class="hs-identifier hs-var">psplit</span></a></span></span><span> </span><span id="local-6989586621682121627"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682121627"><span class="hs-identifier hs-var">ixsplit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-979"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; tcm ()) -&gt; TCMT IO Doc -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;tel is&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-980"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; tcm ()) -&gt; TCMT IO Doc -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;ip is&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-981"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; tcm ()) -&gt; TCMT IO Doc -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;target is&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Arg Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; Bool
forall a. Problem a -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#isSolvedProblem"><span class="hs-identifier hs-var">isSolvedProblem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-983"></span><span>    </span><span class="annot"><span class="annottext">TCM a -&gt; tcm a
forall a. TCM a -&gt; tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; tcm a) -&gt; TCM a -&gt; tcm a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
-&gt; Lens' (Problem a) (LHSState a -&gt; TCM a) -&gt; LHSState a -&gt; TCM a
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">((LHSState a -&gt; TCM a) -&gt; f (LHSState a -&gt; TCM a))
-&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
((LHSState a -&gt; TCM a) -&gt; f (LHSState a -&gt; TCM a))
-&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) (LHSState a -&gt; TCM a)
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemCont"><span class="hs-identifier hs-var">problemCont</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121621"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-984"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; tcm ()) -&gt; TCMT IO Doc -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;LHS state: &quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSState a -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; LHSState a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121621"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span>    </span><span class="annot"><span class="annottext">tcm Bool -&gt; tcm () -&gt; tcm ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optPatternMatching"><span class="hs-identifier hs-var">optPatternMatching</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; tcm PragmaOptions -&gt; tcm Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; PragmaOptions) -&gt; tcm PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; (TCState -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-var">getsTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PragmaOptions
forall a. LensPragmaOptions a =&gt; a -&gt; PragmaOptions
</span><a href="Agda.Interaction.Options.Types.html#getPragmaOptions"><span class="hs-identifier hs-var">getPragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(tcm () -&gt; tcm ()) -&gt; tcm () -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-990"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; tcm () -&gt; tcm ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Problem a -&gt; Bool
forall a. Problem a -&gt; Bool
</span><a href="Agda.TypeChecking.Rules.LHS.html#problemAllVariables"><span class="hs-identifier hs-var">problemAllVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(tcm () -&gt; tcm ()) -&gt; tcm () -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-991"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NeedOptionPatternMatching"><span class="hs-identifier hs-var">NeedOptionPatternMatching</span></a></span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121636"><span class="annot"><span class="annottext">splitsToTry :: [ProblemEq]
</span><a href="#local-6989586621682121636"><span class="hs-identifier hs-var hs-var">splitsToTry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ProblemEq] -&gt; [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.html#splitStrategy"><span class="hs-identifier hs-var">splitStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; Lens' (Problem a) [ProblemEq] -&gt; [ProblemEq]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span>    </span><span class="annot"><span class="annottext">(ProblemEq
 -&gt; tcm (Either [TCErr] (LHSState a))
 -&gt; tcm (Either [TCErr] (LHSState a)))
-&gt; tcm (Either [TCErr] (LHSState a))
-&gt; [ProblemEq]
-&gt; tcm (Either [TCErr] (LHSState a))
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">ProblemEq
-&gt; tcm (Either [TCErr] (LHSState a))
-&gt; tcm (Either [TCErr] (LHSState a))
</span><a href="#local-6989586621682121640"><span class="hs-identifier hs-var">trySplit</span></a></span><span> </span><span class="annot"><span class="annottext">tcm (Either [TCErr] (LHSState a))
</span><a href="#local-6989586621682121641"><span class="hs-identifier hs-var">trySplitRest</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682121636"><span class="hs-identifier hs-var">splitsToTry</span></a></span><span> </span><span class="annot"><span class="annottext">tcm (Either [TCErr] (LHSState a))
-&gt; (Either [TCErr] (LHSState a) -&gt; tcm a) -&gt; tcm a
forall a b. tcm a -&gt; (a -&gt; tcm b) -&gt; tcm b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-996"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682121642"><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121642"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; LHSState a -&gt; tcm a
forall (tcm :: * -&gt; *) a.
(MonadTCM tcm, PureTCM tcm, MonadWriter (Blocked' Term ()) tcm,
 MonadError TCErr tcm, MonadTrace tcm,
 MonadReader LHSContext tcm) =&gt;
Maybe QName -&gt; LHSState a -&gt; tcm a
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkLHS"><span class="hs-identifier hs-var">checkLHS</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682121591"><span class="hs-identifier hs-var">mf</span></a></span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121642"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-comment">-- If no split works, give error from first split.</span><span>
</span><span id="line-998"></span><span>      </span><span class="hs-comment">-- This is conservative, but might not be the best behavior.</span><span>
</span><span id="line-999"></span><span>      </span><span class="hs-comment">-- It might be better to print all the errors instead.</span><span>
</span><span id="line-1000"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682121643"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682121643"><span class="hs-identifier hs-var">err</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; tcm a
forall a. TCErr -&gt; tcm a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682121643"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1001"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">tcm a
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>    </span><span class="annot"><a href="#local-6989586621682121640"><span class="hs-identifier hs-type">trySplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span>
</span><span id="line-1006"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>    </span><span id="local-6989586621682121640"><span class="annot"><span class="annottext">trySplit :: ProblemEq
-&gt; tcm (Either [TCErr] (LHSState a))
-&gt; tcm (Either [TCErr] (LHSState a))
</span><a href="#local-6989586621682121640"><span class="hs-identifier hs-var hs-var">trySplit</span></a></span></span><span> </span><span id="local-6989586621682121645"><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682121645"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621682121646"><span class="annot"><span class="annottext">tcm (Either [TCErr] (LHSState a))
</span><a href="#local-6989586621682121646"><span class="hs-identifier hs-var">tryNextSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a) -&gt; tcm (Either TCErr (LHSState a))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProblemEq -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121647"><span class="hs-identifier hs-var">splitArg</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemEq
</span><a href="#local-6989586621682121645"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tcm (Either TCErr (LHSState a))
-&gt; (Either TCErr (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a)))
-&gt; tcm (Either [TCErr] (LHSState a))
forall a b. tcm a -&gt; (a -&gt; tcm b) -&gt; tcm b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1009"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682121648"><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121648"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either [TCErr] (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a))
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [TCErr] (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a)))
-&gt; Either [TCErr] (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHSState a -&gt; Either [TCErr] (LHSState a)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">LHSState a
</span><a href="#local-6989586621682121648"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-1010"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682121649"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682121649"><span class="hs-identifier hs-var">err</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([TCErr] -&gt; [TCErr])
-&gt; Either [TCErr] (LHSState a) -&gt; Either [TCErr] (LHSState a)
forall b c d. (b -&gt; c) -&gt; Either b d -&gt; Either c d
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><span class="hs-identifier hs-var">left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682121649"><span class="hs-identifier hs-var">err</span></a></span><span class="annot"><span class="annottext">TCErr -&gt; [TCErr] -&gt; [TCErr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either [TCErr] (LHSState a) -&gt; Either [TCErr] (LHSState a))
-&gt; tcm (Either [TCErr] (LHSState a))
-&gt; tcm (Either [TCErr] (LHSState a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">tcm (Either [TCErr] (LHSState a))
</span><a href="#local-6989586621682121646"><span class="hs-identifier hs-var">tryNextSplit</span></a></span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-comment">-- If there are any remaining user patterns, try to split on them</span><span>
</span><span id="line-1013"></span><span>    </span><span class="annot"><a href="#local-6989586621682121641"><span class="hs-identifier hs-type">trySplitRest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>    </span><span id="local-6989586621682121641"><span class="annot"><span class="annottext">trySplitRest :: tcm (Either [TCErr] (LHSState a))
</span><a href="#local-6989586621682121641"><span class="hs-identifier hs-var hs-var">trySplitRest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
-&gt; Lens' (Problem a) [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [NamedArg Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemRestPats"><span class="hs-identifier hs-var">problemRestPats</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1015"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either [TCErr] (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a))
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [TCErr] (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a)))
-&gt; Either [TCErr] (LHSState a) -&gt; tcm (Either [TCErr] (LHSState a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCErr] -&gt; Either [TCErr] (LHSState a)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682121652"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121652"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TCErr -&gt; [TCErr])
-&gt; Either TCErr (LHSState a) -&gt; Either [TCErr] (LHSState a)
forall b c d. (b -&gt; c) -&gt; Either b d -&gt; Either c d
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><span class="hs-identifier hs-var">left</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; [TCErr]
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TCErr (LHSState a) -&gt; Either [TCErr] (LHSState a))
-&gt; tcm (Either TCErr (LHSState a))
-&gt; tcm (Either [TCErr] (LHSState a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a) -&gt; tcm (Either TCErr (LHSState a))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121654"><span class="hs-identifier hs-var">splitRest</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121652"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>    </span><span class="annot"><a href="#local-6989586621682121647"><span class="hs-identifier hs-type">splitArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-comment">-- Split on constructor/literal pattern</span><span>
</span><span id="line-1020"></span><span>    </span><span id="local-6989586621682121647"><span class="annot"><span class="annottext">splitArg :: ProblemEq -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121647"><span class="hs-identifier hs-var hs-var">splitArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">ProblemEq</span></a></span><span> </span><span id="local-6989586621682121655"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121655"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682121656"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121656"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682121657"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121657"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Call
-&gt; ExceptT TCErr tcm (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a)
forall a. Call -&gt; ExceptT TCErr tcm a -&gt; ExceptT TCErr tcm a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Telescope -&gt; Type -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckPattern"><span class="hs-identifier hs-var">CheckPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121655"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121657"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a))
-&gt; ExceptT TCErr tcm (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1023"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;split looking at pattern&quot;</span></span><span>
</span><span id="line-1024"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;p =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121655"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1025"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span>      </span><span class="hs-comment">-- in order to split, v must be a variable.</span><span>
</span><span id="line-1028"></span><span>      </span><span id="local-6989586621682121658"><span class="annot"><a href="#local-6989586621682121658"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Int -&gt; ExceptT TCErr tcm Int
forall a. TCM a -&gt; ExceptT TCErr tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Int -&gt; ExceptT TCErr tcm Int)
-&gt; TCM Int -&gt; ExceptT TCErr tcm Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Int -&gt; TCM Int
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Int -&gt; TCM Int) -&gt; TCM Int -&gt; TCM Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Int) -&gt; (Int -&gt; TCM Int) -&gt; TCM Int -&gt; TCM Int
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m b) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Maybe.html#ifJustM"><span class="hs-identifier hs-var">ifJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Type -&gt; TCMT IO (Maybe Int)
forall (m :: * -&gt; *). PureTCM m =&gt; Term -&gt; Type -&gt; m (Maybe Int)
</span><a href="Agda.TypeChecking.Records.html#isEtaVar"><span class="hs-identifier hs-var">isEtaVar</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121656"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121657"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Int
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TCM Int -&gt; TCM Int) -&gt; TCM Int -&gt; TCM Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1029"></span><span>             </span><span class="annot"><span class="annottext">TypeError -&gt; TCM Int
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM Int) -&gt; TypeError -&gt; TCM Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnNonVariable"><span class="hs-identifier hs-var">SplitOnNonVariable</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121656"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121657"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121663"><span class="annot"><a href="#local-6989586621682121663"><span class="hs-identifier hs-var hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682121658"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1032"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682121664"><span class="annot"><a href="#local-6989586621682121664"><span class="hs-identifier hs-var">delta1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121665"><span class="annot"><a href="#local-6989586621682121665"><span class="hs-identifier hs-var">tel'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682121666"><span class="annot"><a href="#local-6989586621682121666"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682121667"><span class="annot"><a href="#local-6989586621682121667"><span class="hs-identifier hs-var">adelta2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#splitTelescopeAt"><span class="hs-identifier hs-type">splitTelescopeAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121663"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121622"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="hs-comment">-- TODO:: tel' defined but not used</span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span>      </span><span id="local-6989586621682121668"><span class="annot"><a href="#local-6989586621682121668"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html#expandLitPattern"><span class="hs-identifier hs-type">expandLitPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121655"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-1035"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121669"><span class="annot"><a href="#local-6989586621682121669"><span class="hs-identifier hs-var hs-var">splitOnPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1036"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LitP"><span class="hs-identifier hs-type">A.LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121670"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682121670"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; Literal
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121671"><span class="hs-identifier hs-var">splitLit</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121664"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121666"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121667"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682121670"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1037"></span><span>            </span><span id="local-6989586621682121672"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682121672"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; Pattern
-&gt; Maybe AmbiguousQName
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121673"><span class="hs-identifier hs-var">splitCon</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121664"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121666"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121667"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121672"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AmbiguousQName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1038"></span><span>            </span><span id="local-6989586621682121674"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682121674"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121675"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682121675"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682121676"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682121676"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; Pattern
-&gt; Maybe AmbiguousQName
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121673"><span class="hs-identifier hs-var">splitCon</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121664"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121666"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121667"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121674"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe AmbiguousQName -&gt; ExceptT TCErr tcm (LHSState a))
-&gt; Maybe AmbiguousQName -&gt; ExceptT TCErr tcm (LHSState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName -&gt; Maybe AmbiguousQName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682121675"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1039"></span><span>            </span><span id="local-6989586621682121677"><span class="annot"><span class="annottext">p :: Pattern
</span><a href="#local-6989586621682121677"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#EqualP"><span class="hs-identifier hs-type">A.EqualP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121678"><span class="annot"><span class="annottext">List1 (Expr, Expr)
</span><a href="#local-6989586621682121678"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; List1 (Expr, Expr)
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121679"><span class="hs-identifier hs-var">splitPartial</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121664"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121666"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121667"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Expr, Expr)
</span><a href="#local-6989586621682121678"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1040"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AsP"><span class="hs-identifier hs-type">A.AsP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BindName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121680"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121680"><span class="hs-identifier hs-var">p</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121669"><span class="hs-identifier hs-var">splitOnPat</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121680"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-type">A.VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1043"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1044"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DotP"><span class="hs-identifier hs-type">A.DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1045"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdP"><span class="hs-identifier hs-type">A.AbsurdP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1046"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProjP"><span class="hs-identifier hs-type">A.ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1047"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefP"><span class="hs-identifier hs-type">A.DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1048"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynP"><span class="hs-identifier hs-type">A.PatternSynP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1049"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithP"><span class="hs-identifier hs-type">A.WithP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr tcm (LHSState a)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1050"></span><span>      </span><span class="annot"><a href="#local-6989586621682121669"><span class="hs-identifier hs-type">splitOnPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121668"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span>    </span><span class="annot"><a href="#local-6989586621682121654"><span class="hs-identifier hs-type">splitRest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span>    </span><span id="local-6989586621682121654"><span class="annot"><span class="annottext">splitRest :: NamedArg Pattern -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121654"><span class="hs-identifier hs-var hs-var">splitRest</span></a></span></span><span> </span><span id="local-6989586621682121681"><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121681"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
-&gt; ExceptT TCErr tcm (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a)
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121681"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a))
-&gt; ExceptT TCErr tcm (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1055"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1056"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;splitting problem rest&quot;</span></span><span>
</span><span id="line-1057"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;projection pattern =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121681"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1058"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;eliminates type    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Arg Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1059"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1060"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1061"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc) -&gt; String -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;projection pattern (raw) = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121681"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1062"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>      </span><span class="hs-comment">-- @p@ should be a projection pattern projection from @target@</span><span>
</span><span id="line-1065"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682121682"><span class="annot"><a href="#local-6989586621682121682"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121683"><span class="annot"><a href="#local-6989586621682121683"><span class="hs-identifier hs-var">ambProjName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (ProjOrigin, AmbiguousQName)
-&gt; ((ProjOrigin, AmbiguousQName)
    -&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName))
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
forall a b. Maybe a -&gt; (a -&gt; b) -&gt; b -&gt; b
</span><a href="Agda.Utils.Maybe.html#ifJust"><span class="hs-identifier hs-var">ifJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Maybe (ProjOrigin, AmbiguousQName)
forall a. IsProjP a =&gt; a -&gt; Maybe (ProjOrigin, AmbiguousQName)
</span><a href="Agda.Syntax.Abstract.Name.html#isProjP"><span class="hs-identifier hs-var">A.isProjP</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121681"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ProjOrigin, AmbiguousQName)
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
forall a. a -&gt; ExceptT TCErr tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
 -&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName))
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
 -&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName))
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
-&gt; ExceptT TCErr tcm (ProjOrigin, AmbiguousQName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1066"></span><span>        </span><span id="local-6989586621682121685"><span class="annot"><a href="#local-6989586621682121685"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; ExceptT TCErr tcm (Maybe Blocker)
forall t (m :: * -&gt; *).
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; m (Maybe Blocker)
</span><a href="Agda.TypeChecking.Reduce.html#isBlocked"><span class="hs-identifier hs-var">isBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1067"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-type">softTypeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CannotEliminateWithPattern"><span class="hs-identifier hs-type">CannotEliminateWithPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121685"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121681"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121625"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682121688"><span class="annot"><a href="#local-6989586621682121688"><span class="hs-identifier hs-var">projName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121689"><span class="annot"><a href="#local-6989586621682121689"><span class="hs-identifier hs-var">comatchingAllowed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121690"><span class="annot"><a href="#local-6989586621682121690"><span class="hs-identifier hs-var">recName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121691"><span class="annot"><a href="#local-6989586621682121691"><span class="hs-identifier hs-var">projType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121692"><span class="annot"><a href="#local-6989586621682121692"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#suspendErrors"><span class="hs-identifier hs-type">suspendErrors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-comment">-- Andreas, 2018-10-18, issue #3289: postfix projections do not have hiding</span><span>
</span><span id="line-1071"></span><span>        </span><span class="hs-comment">-- information for their principal argument; we do not parse @{r}.p@ and the like.</span><span>
</span><span id="line-1072"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121694"><span class="annot"><a href="#local-6989586621682121694"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682121682"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin -&gt; ProjOrigin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjPostfix"><span class="hs-identifier hs-var">ProjPostfix</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Hiding
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Hiding -&gt; Maybe Hiding
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Hiding -&gt; Maybe Hiding) -&gt; Hiding -&gt; Maybe Hiding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern -&gt; Hiding
forall a. LensHiding a =&gt; a -&gt; Hiding
</span><a href="Agda.Syntax.Common.html#getHiding"><span class="hs-identifier hs-var">getHiding</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg Pattern
</span><a href="#local-6989586621682121681"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1073"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121622"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateProjection"><span class="hs-identifier hs-type">disambiguateProjection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121694"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121683"><span class="hs-identifier hs-type">ambProjName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121625"><span class="hs-identifier hs-type">target</span></a></span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121689"><span class="hs-identifier hs-type">comatchingAllowed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1076"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-type">hardTypeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ComatchingDisabledForRecord"><span class="hs-identifier hs-type">ComatchingDisabledForRecord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121690"><span class="hs-identifier hs-type">recName</span></a></span><span>
</span><span id="line-1077"></span><span>
</span><span id="line-1078"></span><span>      </span><span class="hs-comment">-- Compute the new rest type by applying the projection type to 'self'.</span><span>
</span><span id="line-1079"></span><span>      </span><span class="hs-comment">-- Note: we cannot be in a let binding.</span><span>
</span><span id="line-1080"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121699"><span class="annot"><a href="#local-6989586621682121699"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName -&gt; QName
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">QName
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682121591"><span class="hs-identifier hs-var">mf</span></a></span><span>
</span><span id="line-1081"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121700"><span class="annot"><a href="#local-6989586621682121700"><span class="hs-identifier hs-var hs-var">self</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682121699"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Elims
</span><a href="Agda.Syntax.Internal.Pattern.html#patternsToElims"><span class="hs-identifier hs-var">patternsToElims</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-1082"></span><span>      </span><span id="local-6989586621682121702"><span class="annot"><a href="#local-6989586621682121702"><span class="hs-identifier hs-var">target'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`piApplyM`</span></span><span> </span><span class="annot"><span class="hs-identifier">self</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682121691"><span class="hs-identifier hs-type">projType</span></a></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span>      </span><span class="hs-comment">-- Compute the new state</span><span>
</span><span id="line-1085"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121704"><span class="annot"><a href="#local-6989586621682121704"><span class="hs-identifier hs-var hs-var">projP</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; NamedArg DeBruijnPattern
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682121682"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin -&gt; ProjOrigin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjPostfix"><span class="hs-identifier hs-var">ProjPostfix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hiding -&gt; NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a. LensHiding a =&gt; Hiding -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setHiding"><span class="hs-identifier hs-var">setHiding</span></a></span><span> </span><span class="annot"><span class="annottext">Hiding
</span><a href="Agda.Syntax.Common.html#NotHidden"><span class="hs-identifier hs-var">NotHidden</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1086"></span><span>                       </span><span class="annot"><span class="annottext">ArgInfo
-&gt; Named NamedName DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121692"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; NamedArg DeBruijnPattern)
-&gt; Named NamedName DeBruijnPattern -&gt; NamedArg DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe NamedName
-&gt; DeBruijnPattern -&gt; Named NamedName DeBruijnPattern
forall name a. Maybe name -&gt; a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-var">Named</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NamedName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; DeBruijnPattern
forall x. ProjOrigin -&gt; QName -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-var">ProjP</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682121682"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682121688"><span class="hs-identifier hs-var">projName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>          </span><span id="local-6989586621682121710"><span class="annot"><a href="#local-6989586621682121710"><span class="hs-identifier hs-var hs-var">ip'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682121704"><span class="hs-identifier hs-var">projP</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1088"></span><span>          </span><span class="hs-comment">-- drop the projection pattern (already splitted)</span><span>
</span><span id="line-1089"></span><span>          </span><span id="local-6989586621682121711"><span class="annot"><a href="#local-6989586621682121711"><span class="hs-identifier hs-var hs-var">problem'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (Problem a) [NamedArg Pattern]
-&gt; LensMap (Problem a) [NamedArg Pattern]
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([NamedArg Pattern] -&gt; f [NamedArg Pattern])
-&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [NamedArg Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemRestPats"><span class="hs-identifier hs-var">problemRestPats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [NamedArg Pattern] -&gt; [NamedArg Pattern]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-1090"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#updateLHSState"><span class="hs-identifier hs-type">updateLHSState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121622"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121710"><span class="hs-identifier hs-type">ip'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121711"><span class="hs-identifier hs-type">problem'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121702"><span class="hs-identifier hs-type">target'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121626"><span class="hs-identifier hs-type">psplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121627"><span class="hs-identifier hs-type">ixsplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span>    </span><span class="hs-comment">-- Split a Partial.</span><span>
</span><span id="line-1094"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1095"></span><span>    </span><span class="hs-comment">-- Example for splitPartial:</span><span>
</span><span id="line-1096"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1097"></span><span>    </span><span class="hs-comment">--   g : &#8704; i j &#8594; Partial (i &#8744; j) A</span><span>
</span><span id="line-1098"></span><span>    </span><span class="hs-comment">--   g i j (i = 1) = a i j</span><span>
</span><span id="line-1099"></span><span>    </span><span class="hs-comment">--   g i j (j = 1) = b i j</span><span>
</span><span id="line-1100"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1101"></span><span>    </span><span class="hs-comment">-- leads to, in the first clause:</span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1103"></span><span>    </span><span class="hs-comment">--   dom   = IsOne (i &#8744; j)</span><span>
</span><span id="line-1104"></span><span>    </span><span class="hs-comment">--   ts    = [(i, 1)]</span><span>
</span><span id="line-1105"></span><span>    </span><span class="hs-comment">--   phi   = i</span><span>
</span><span id="line-1106"></span><span>    </span><span class="hs-comment">--   sigma = [1/i]</span><span>
</span><span id="line-1107"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1108"></span><span>    </span><span class="hs-comment">-- Final clauses:</span><span>
</span><span id="line-1109"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1110"></span><span>    </span><span class="hs-comment">--   g : &#8704; i j &#8594; Partial (i &#8744; j) A</span><span>
</span><span id="line-1111"></span><span>    </span><span class="hs-comment">--   g 1? j  .itIsOne = a 1 j</span><span>
</span><span id="line-1112"></span><span>    </span><span class="hs-comment">--   g i  1? .itIsOne = b i 1</span><span>
</span><span id="line-1113"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-comment">-- Herein, ? indicates a 'conPFallThrough' pattern.</span><span>
</span><span id="line-1115"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1116"></span><span>    </span><span class="hs-comment">-- Example for splitPartial:</span><span>
</span><span id="line-1117"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1118"></span><span>    </span><span class="hs-comment">--   h : &#8704; i j &#8594; Partial (i &amp; &#172; j) A</span><span>
</span><span id="line-1119"></span><span>    </span><span class="hs-comment">--   h i j (i = 1) (j = 0)</span><span>
</span><span id="line-1120"></span><span>    </span><span class="hs-comment">--   -- ALT: h i j (i &amp; &#172; j = 1)</span><span>
</span><span id="line-1121"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1122"></span><span>    </span><span class="hs-comment">-- gives</span><span>
</span><span id="line-1123"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1124"></span><span>    </span><span class="hs-comment">--   dom = IsOne (i &amp; &#172; j)</span><span>
</span><span id="line-1125"></span><span>    </span><span class="hs-comment">--   ts  = [(i,1), (j,0)]  -- ALT: [(i &amp; &#172; j, 1)]</span><span>
</span><span id="line-1126"></span><span>    </span><span class="hs-comment">--   phi = i &amp; &#172; j</span><span>
</span><span id="line-1127"></span><span>    </span><span class="hs-comment">--   sigma = [1/i,0/j]</span><span>
</span><span id="line-1128"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1129"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1130"></span><span>    </span><span class="hs-comment">-- Example for splitPartial:</span><span>
</span><span id="line-1131"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1132"></span><span>    </span><span class="hs-comment">--   g : &#8704; i j &#8594; Partial (i &#8744; j) A</span><span>
</span><span id="line-1133"></span><span>    </span><span class="hs-comment">--   g i j (i &#8744; j = 1) = a i j</span><span>
</span><span id="line-1134"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1135"></span><span>    </span><span class="hs-comment">-- leads to, in the first clause:</span><span>
</span><span id="line-1136"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1137"></span><span>    </span><span class="hs-comment">--   dom   = IsOne (i &#8744; j)</span><span>
</span><span id="line-1138"></span><span>    </span><span class="hs-comment">--   ts    = [(i &#8744; j, 1)]</span><span>
</span><span id="line-1139"></span><span>    </span><span class="hs-comment">--   phi   = i &#8744; j</span><span>
</span><span id="line-1140"></span><span>    </span><span class="hs-comment">--   sigma = fails because several substitutions [[1/i],[1/j]] correspond to phi</span><span>
</span><span id="line-1141"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>    </span><span class="annot"><a href="#local-6989586621682121679"><span class="hs-identifier hs-type">splitPartial</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1144"></span><span>         </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>
</span><span id="line-1145"></span><span>            </span><span class="hs-comment">-- The types of arguments before the one we split on.</span><span>
</span><span id="line-1146"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1147"></span><span>            </span><span class="hs-comment">-- The type of the argument we split on.</span><span>
</span><span id="line-1148"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>
</span><span id="line-1149"></span><span>            </span><span class="hs-comment">-- The types of arguments after the one we split on.</span><span>
</span><span id="line-1150"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>            </span><span class="hs-comment">-- [(&#966;&#8321; = b1),..,(&#966;n = bn)]</span><span>
</span><span id="line-1152"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>
</span><span id="line-1154"></span><span>    </span><span id="local-6989586621682121679"><span class="annot"><span class="annottext">splitPartial :: Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; List1 (Expr, Expr)
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121679"><span class="hs-identifier hs-var hs-var">splitPartial</span></a></span></span><span> </span><span id="local-6989586621682121715"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121715"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682121716"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121716"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621682121717"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121717"><span class="hs-identifier hs-var">adelta2</span></a></span></span><span> </span><span id="local-6989586621682121718"><span class="annot"><span class="annottext">List1 (Expr, Expr)
</span><a href="#local-6989586621682121718"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type -&gt; Bool
forall t e. Dom' t e -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#domIsFinite"><span class="hs-identifier hs-var">domIsFinite</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121716"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; ExceptT TCErr tcm ()
forall a. TCM a -&gt; ExceptT TCErr tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121715"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1157"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO ()) -&gt; TypeError -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnPartial"><span class="hs-identifier hs-var">SplitOnPartial</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121716"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span>      </span><span id="local-6989586621682121721"><span class="annot"><a href="#local-6989586621682121721"><span class="hs-identifier hs-var">tInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Type -&gt; ExceptT TCErr tcm Type
forall a. TCM a -&gt; ExceptT TCErr tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Type -&gt; ExceptT TCErr tcm Type)
-&gt; TCMT IO Type -&gt; ExceptT TCErr tcm Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Type
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Type
</span><a href="Agda.TypeChecking.Primitive.Cubical.Base.html#primIntervalType"><span class="hs-identifier hs-var">primIntervalType</span></a></span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span>      </span><span id="local-6989586621682121723"><span class="annot"><a href="#local-6989586621682121723"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121622"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LeftoverPatterns"><span class="hs-identifier hs-type">LeftoverPatterns</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#patternVariables"><span class="hs-identifier hs-var">patternVariables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682121725"><span class="annot"><a href="#local-6989586621682121725"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#getLeftoverPatterns"><span class="hs-identifier hs-type">getLeftoverPatterns</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682121624"><span class="hs-identifier hs-type">problem</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-type">problemEqs</span></a></span><span>
</span><span id="line-1163"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121715"><span class="hs-identifier hs-type">delta1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#getUserVariableNames"><span class="hs-identifier hs-type">getUserVariableNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121622"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121725"><span class="hs-identifier hs-type">vars</span></a></span><span>
</span><span id="line-1164"></span><span>
</span><span id="line-1165"></span><span>      </span><span class="hs-comment">-- Problem: The context does not match the checkpoints in checkLHS,</span><span>
</span><span id="line-1166"></span><span>      </span><span class="hs-comment">--          however we still need a proper checkpoint substitution</span><span>
</span><span id="line-1167"></span><span>      </span><span class="hs-comment">--          for checkExpr below.</span><span>
</span><span id="line-1168"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1169"></span><span>      </span><span class="hs-comment">-- Solution: partial splits are not allowed when there are</span><span>
</span><span id="line-1170"></span><span>      </span><span class="hs-comment">--           constructor patterns (checked in checkDef), so</span><span>
</span><span id="line-1171"></span><span>      </span><span class="hs-comment">--           newContext is an extension of the definition</span><span>
</span><span id="line-1172"></span><span>      </span><span class="hs-comment">--           context.</span><span>
</span><span id="line-1173"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-comment">-- i.e.: Given</span><span>
</span><span id="line-1175"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1176"></span><span>      </span><span class="hs-comment">--             &#915; = context where def is checked, also last checkpoint.</span><span>
</span><span id="line-1177"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1178"></span><span>      </span><span class="hs-comment">--       Then</span><span>
</span><span id="line-1179"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1180"></span><span>      </span><span class="hs-comment">--             newContext = &#915; &#926;</span><span>
</span><span id="line-1181"></span><span>      </span><span class="hs-comment">--             cpSub = raiseS |&#926;|</span><span>
</span><span id="line-1182"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1183"></span><span>      </span><span id="local-6989586621682121729"><span class="annot"><a href="#local-6989586621682121729"><span class="hs-identifier hs-var">lhsCxtSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">asks</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#lhsContextSize"><span class="hs-identifier hs-var">lhsContextSize</span></a></span><span> </span><span class="hs-comment">-- size of the context before checkLHS call.</span><span>
</span><span id="line-1184"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;lhsCxtSize =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121729"><span class="hs-identifier hs-type">lhsCxtSize</span></a></span><span>
</span><span id="line-1185"></span><span>
</span><span id="line-1186"></span><span>      </span><span id="local-6989586621682121730"><span class="annot"><a href="#local-6989586621682121730"><span class="hs-identifier hs-var">newContext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#computeLHSContext"><span class="hs-identifier hs-type">computeLHSContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121723"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121715"><span class="hs-identifier hs-type">delta1</span></a></span><span>
</span><span id="line-1187"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;newContext =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121730"><span class="hs-identifier hs-type">newContext</span></a></span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121731"><span class="annot"><a href="#local-6989586621682121731"><span class="hs-identifier hs-var hs-var">cpSub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Substitution) -&gt; Int -&gt; Substitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682121730"><span class="hs-identifier hs-var">newContext</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682121729"><span class="hs-identifier hs-var">lhsCxtSize</span></a></span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682121733"><span class="annot"><a href="#local-6989586621682121733"><span class="hs-identifier hs-var">gamma</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682121734"><span class="annot"><a href="#local-6989586621682121734"><span class="hs-identifier hs-var">sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-type">updateContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121731"><span class="hs-identifier hs-type">cpSub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><a href="#local-6989586621682121730"><span class="hs-identifier hs-type">newContext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1192"></span><span>         </span><span id="local-6989586621682121735"><span class="annot"><a href="#local-6989586621682121735"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682121718"><span class="hs-identifier hs-type">ts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682121737"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682121737"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121738"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682121738"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1193"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;currentCxt =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Context -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; TCMT IO Doc) -&gt; TCM Context -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCM Context
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Context
</span><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-var">getContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t, u (Expr) =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr, Expr) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; (Expr, Expr) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682121737"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682121738"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>                 </span><span id="local-6989586621682121739"><span class="annot"><a href="#local-6989586621682121739"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCMT IO Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682121737"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121721"><span class="hs-identifier hs-var">tInterval</span></a></span><span>
</span><span id="line-1196"></span><span>                 </span><span id="local-6989586621682121740"><span class="annot"><a href="#local-6989586621682121740"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-type">checkExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121738"><span class="hs-identifier hs-type">rhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121721"><span class="hs-identifier hs-type">tInterval</span></a></span><span>
</span><span id="line-1197"></span><span>                 </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;t, u        =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121739"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682121740"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>                 </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121740"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#intervalView"><span class="hs-identifier hs-type">intervalView</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1199"></span><span>                   </span><span class="annot"><span class="annottext">IntervalView
</span><a href="Agda.Syntax.Internal.html#IZero"><span class="hs-identifier hs-var">IZero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primINeg"><span class="hs-identifier hs-var">primINeg</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term -&gt; TCMT IO Term -&gt; TCMT IO Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121739"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1200"></span><span>                   </span><span class="annot"><span class="annottext">IntervalView
</span><a href="Agda.Syntax.Internal.html#IOne"><span class="hs-identifier hs-var">IOne</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121739"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1201"></span><span>                   </span><span class="annot"><span class="annottext">IntervalView
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO Term
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO Term) -&gt; TypeError -&gt; TCMT IO Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ExpectedIntervalLiteral"><span class="hs-identifier hs-var">ExpectedIntervalLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682121738"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1202"></span><span>         </span><span class="hs-comment">-- Example: ts = (i=0) (j=1) will result in phi = &#172; i &amp; j</span><span>
</span><span id="line-1203"></span><span>         </span><span id="local-6989586621682121747"><span class="annot"><a href="#local-6989586621682121747"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682121749"><span class="annot"><span class="annottext">TCMT IO Term
</span><a href="#local-6989586621682121749"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682121750"><span class="annot"><span class="annottext">TCMT IO Term
</span><a href="#local-6989586621682121750"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primIMin"><span class="hs-identifier hs-var">primIMin</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term -&gt; TCMT IO Term -&gt; TCMT IO Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
</span><a href="#local-6989586621682121749"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term -&gt; TCMT IO Term -&gt; TCMT IO Term
forall (m :: * -&gt; *). Applicative m =&gt; m Term -&gt; m Term -&gt; m Term
</span><a href="Agda.TypeChecking.Primitive.Base.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
</span><a href="#local-6989586621682121750"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIOne"><span class="hs-identifier hs-type">primIOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682121735"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1204"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;phi           =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121747"><span class="hs-identifier hs-type">phi</span></a></span><span>
</span><span id="line-1205"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;phi           =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121747"><span class="hs-identifier hs-type">phi</span></a></span><span>
</span><span id="line-1206"></span><span>         </span><span id="local-6989586621682121753"><span class="annot"><a href="#local-6989586621682121753"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121747"><span class="hs-identifier hs-type">phi</span></a></span><span>
</span><span id="line-1207"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;phi (reduced) =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121753"><span class="hs-identifier hs-type">phi</span></a></span><span>
</span><span id="line-1208"></span><span>         </span><span id="local-6989586621682121754"><span class="annot"><a href="#local-6989586621682121754"><span class="hs-identifier hs-var">refined</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#forallFaceMaps"><span class="hs-identifier hs-type">forallFaceMaps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121753"><span class="hs-identifier hs-type">phi</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682121756"><span class="annot"><span class="annottext">IntMap Bool
</span><a href="#local-6989586621682121756"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621682121757"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682121757"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682121758"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121758"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCM (Telescope, Substitution)
forall a. Blocker -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadBlock m =&gt; Blocker -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#patternViolation"><span class="hs-identifier hs-var">patternViolation</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682121757"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">IntMap Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121760"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682121760"><span class="hs-identifier hs-var">sigma</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682121760"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; (Telescope, Substitution))
-&gt; TCMT IO Telescope -&gt; TCM (Telescope, Substitution)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682121754"><span class="hs-identifier hs-type">refined</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1211"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621682121761"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121761"><span class="hs-identifier hs-var">gamma</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682121762"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682121762"><span class="hs-identifier hs-var">sigma</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Telescope, Substitution) -&gt; TCM (Telescope, Substitution)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121761"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682121762"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM (Telescope, Substitution)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#FaceConstraintUnsatisfiable"><span class="hs-identifier hs-var">FaceConstraintUnsatisfiable</span></a></span><span>
</span><span id="line-1213"></span><span>           </span><span class="annot"><span class="annottext">[(Telescope, Substitution)]
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM (Telescope, Substitution)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#FaceConstraintDisjunction"><span class="hs-identifier hs-var">FaceConstraintDisjunction</span></a></span><span>
</span><span id="line-1214"></span><span>      </span><span id="local-6989586621682121765"><span class="annot"><a href="#local-6989586621682121765"><span class="hs-identifier hs-var">itisone</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primItIsOne"><span class="hs-identifier hs-type">primItIsOne</span></a></span><span>
</span><span id="line-1215"></span><span>      </span><span class="hs-comment">-- substitute the literal in p1 and dpi</span><span>
</span><span id="line-1216"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.faces&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682121734"><span class="hs-identifier hs-type">sigma</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121766"><span class="annot"><a href="#local-6989586621682121766"><span class="hs-identifier hs-var hs-var">oix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121717"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="hs-comment">-- de brujin index of IsOne</span><span>
</span><span id="line-1219"></span><span>          </span><span id="local-6989586621682121767"><span class="annot"><a href="#local-6989586621682121767"><span class="hs-identifier hs-var hs-var">o_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1220"></span><span>            </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Bool)
-&gt; [NamedArg DeBruijnPattern] -&gt; Maybe Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe Int
</span><span class="hs-identifier hs-var">findIndex</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682121768"><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682121768"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Named NamedName DeBruijnPattern -&gt; DeBruijnPattern
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; Named NamedName DeBruijnPattern
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern
</span><a href="#local-6989586621682121768"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1221"></span><span>                                   </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121769"><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682121769"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DBPatVar -&gt; Int
</span><a href="Agda.Syntax.Internal.html#dbPatVarIndex"><span class="hs-identifier hs-var">dbPatVarIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DBPatVar
</span><a href="#local-6989586621682121769"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682121766"><span class="hs-identifier hs-var">oix</span></a></span><span>
</span><span id="line-1222"></span><span>                                   </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-1223"></span><span>          </span><span id="local-6989586621682121771"><span class="annot"><a href="#local-6989586621682121771"><span class="hs-identifier hs-var hs-var">delta2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Telescope -&gt; SubstArg Telescope -&gt; Telescope
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-identifier hs-var">absApp</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121717"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Telescope
</span><a href="#local-6989586621682121765"><span class="hs-identifier hs-var">itisone</span></a></span><span>
</span><span id="line-1224"></span><span>          </span><span id="local-6989586621682121772"><span class="annot"><a href="#local-6989586621682121772"><span class="hs-identifier hs-var hs-var">delta2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Telescope) -&gt; Telescope -&gt; Telescope
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Telescope)
</span><a href="#local-6989586621682121734"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121771"><span class="hs-identifier hs-var">delta2'</span></a></span><span>
</span><span id="line-1225"></span><span>          </span><span id="local-6989586621682121773"><span class="annot"><a href="#local-6989586621682121773"><span class="hs-identifier hs-var hs-var">mkConP</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682121774"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682121774"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; ConPatternInfo -&gt; [NamedArg DeBruijnPattern] -&gt; DeBruijnPattern
forall x.
ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-var">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682121774"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="Agda.Syntax.Internal.html#noConPatternInfo"><span class="hs-identifier hs-var">noConPatternInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conPType"><span class="hs-identifier hs-var">conPType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-type">defaultArgInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121721"><span class="hs-identifier hs-type">tInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1227"></span><span>                                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conPFallThrough"><span class="hs-identifier hs-var">conPFallThrough</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span>                          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1229"></span><span>          </span><span class="annot"><a href="#local-6989586621682121773"><span class="hs-identifier hs-var">mkConP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682121780"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682121780"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; DBPatVar -&gt; DeBruijnPattern
forall x. PatternInfo -&gt; x -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-var">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><a href="Agda.Syntax.Internal.html#defaultPatternInfo"><span class="hs-identifier hs-var">defaultPatternInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Int -&gt; DBPatVar
</span><a href="Agda.Syntax.Internal.html#DBPatVar"><span class="hs-identifier hs-var">DBPatVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682121780"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>          </span><span class="annot"><a href="#local-6989586621682121773"><span class="hs-identifier hs-var">mkConP</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1231"></span><span>          </span><span id="local-6989586621682121783"><span class="annot"><a href="#local-6989586621682121783"><span class="hs-identifier hs-var hs-var">rho0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; DeBruijnPattern) -&gt; Substitution -&gt; PatternSubstitution
forall a b. (a -&gt; b) -&gt; Substitution' a -&gt; Substitution' b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; DeBruijnPattern
</span><a href="#local-6989586621682121773"><span class="hs-identifier hs-var">mkConP</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682121734"><span class="hs-identifier hs-var">sigma</span></a></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>          </span><span id="local-6989586621682121784"><span class="annot"><a href="#local-6989586621682121784"><span class="hs-identifier hs-var hs-var">rho</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PatternSubstitution -&gt; PatternSubstitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121772"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PatternSubstitution -&gt; PatternSubstitution)
-&gt; PatternSubstitution -&gt; PatternSubstitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; PatternSubstitution -&gt; PatternSubstitution
forall a. DeBruijn a =&gt; a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#consS"><span class="hs-identifier hs-var">consS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternInfo -&gt; Term -&gt; DeBruijnPattern
forall x. PatternInfo -&gt; Term -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-var">DotP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><a href="Agda.Syntax.Internal.html#defaultPatternInfo"><span class="hs-identifier hs-var">defaultPatternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682121765"><span class="hs-identifier hs-var">itisone</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121783"><span class="hs-identifier hs-var">rho0</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>          </span><span id="local-6989586621682121787"><span class="annot"><a href="#local-6989586621682121787"><span class="hs-identifier hs-var hs-var">delta'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121733"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121772"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-1236"></span><span>          </span><span id="local-6989586621682121789"><span class="annot"><a href="#local-6989586621682121789"><span class="hs-identifier hs-var hs-var">eqs'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121784"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; Lens' (Problem a) [ProblemEq] -&gt; [ProblemEq]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span>
</span><span id="line-1237"></span><span>          </span><span id="local-6989586621682121792"><span class="annot"><a href="#local-6989586621682121792"><span class="hs-identifier hs-var hs-var">ip'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
Substitution' (SubstArg [NamedArg DeBruijnPattern])
</span><a href="#local-6989586621682121784"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-1238"></span><span>          </span><span id="local-6989586621682121793"><span class="annot"><a href="#local-6989586621682121793"><span class="hs-identifier hs-var hs-var">target'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Arg Type -&gt; Arg Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121784"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>      </span><span class="hs-comment">-- Compute the new state</span><span>
</span><span id="line-1241"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121794"><span class="annot"><a href="#local-6989586621682121794"><span class="hs-identifier hs-var hs-var">problem'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (Problem a) [ProblemEq] -&gt; LensSet (Problem a) [ProblemEq]
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682121789"><span class="hs-identifier hs-var">eqs'</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-1242"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.partial&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682121794"><span class="hs-identifier hs-type">problem'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#updateLHSState"><span class="hs-identifier hs-type">updateLHSState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121787"><span class="hs-identifier hs-type">delta'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121792"><span class="hs-identifier hs-type">ip'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121794"><span class="hs-identifier hs-type">problem'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121793"><span class="hs-identifier hs-type">target'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121626"><span class="hs-identifier hs-type">psplit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682121767"><span class="hs-identifier hs-type">o_n</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682121627"><span class="hs-identifier hs-type">ixsplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>    </span><span class="annot"><a href="#local-6989586621682121671"><span class="hs-identifier hs-type">splitLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>      </span><span class="hs-comment">-- The types of arguments before the one we split on</span><span>
</span><span id="line-1247"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="hs-comment">-- The type of the literal we split on</span><span>
</span><span id="line-1248"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>  </span><span class="hs-comment">-- The types of arguments after the one we split on</span><span>
</span><span id="line-1249"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span>        </span><span class="hs-comment">-- The literal written by the user</span><span>
</span><span id="line-1250"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>    </span><span id="local-6989586621682121671"><span class="annot"><span class="annottext">splitLit :: Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; Literal
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121671"><span class="hs-identifier hs-var hs-var">splitLit</span></a></span></span><span> </span><span id="local-6989586621682121797"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121797"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682121798"><span class="annot"><span class="annottext">dom :: Dom Type
</span><a href="#local-6989586621682121798"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682121799"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121799"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682121800"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121800"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621682121801"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121801"><span class="hs-identifier hs-var">adelta2</span></a></span></span><span> </span><span id="local-6989586621682121802"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682121802"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1252"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121803"><span class="annot"><span class="annottext">delta2 :: Telescope
</span><a href="#local-6989586621682121803"><span class="hs-identifier hs-var hs-var hs-var">delta2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Telescope -&gt; SubstArg Telescope -&gt; Telescope
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-identifier hs-var">absApp</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121801"><span class="hs-identifier hs-var">adelta2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682121802"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1253"></span><span>          </span><span id="local-6989586621682121804"><span class="annot"><span class="annottext">delta' :: Telescope
</span><a href="#local-6989586621682121804"><span class="hs-identifier hs-var hs-var hs-var">delta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121797"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121803"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-1254"></span><span>          </span><span id="local-6989586621682121805"><span class="annot"><span class="annottext">rho :: PatternSubstitution
</span><a href="#local-6989586621682121805"><span class="hs-identifier hs-var hs-var hs-var">rho</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DeBruijnPattern -&gt; PatternSubstitution
forall a. DeBruijn a =&gt; Int -&gt; a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#singletonS"><span class="hs-identifier hs-var">singletonS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121803"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; DeBruijnPattern
forall a. Literal -&gt; Pattern' a
</span><a href="Agda.Syntax.Internal.html#litP"><span class="hs-identifier hs-var">litP</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682121802"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>          </span><span class="hs-comment">-- Andreas, 2015-06-13 Literals are closed, so no need to raise them!</span><span>
</span><span id="line-1256"></span><span>          </span><span class="hs-comment">-- rho    = liftS (size delta2) $ singletonS 0 (Lit lit)</span><span>
</span><span id="line-1257"></span><span>          </span><span class="hs-comment">-- rho    = [ var i | i &lt;- [0..size delta2 - 1] ]</span><span>
</span><span id="line-1258"></span><span>          </span><span class="hs-comment">--       ++ [ raise (size delta2) $ Lit lit ]</span><span>
</span><span id="line-1259"></span><span>          </span><span class="hs-comment">--       ++ [ var i | i &lt;- [size delta2 ..] ]</span><span>
</span><span id="line-1260"></span><span>          </span><span id="local-6989586621682121808"><span class="annot"><span class="annottext">eqs' :: [ProblemEq]
</span><a href="#local-6989586621682121808"><span class="hs-identifier hs-var hs-var hs-var">eqs'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121805"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; Lens' (Problem a) [ProblemEq] -&gt; [ProblemEq]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span>
</span><span id="line-1261"></span><span>          </span><span id="local-6989586621682121811"><span class="annot"><span class="annottext">ip' :: [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121811"><span class="hs-identifier hs-var hs-var hs-var">ip'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
Substitution' (SubstArg [NamedArg DeBruijnPattern])
</span><a href="#local-6989586621682121805"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-1262"></span><span>          </span><span id="local-6989586621682121812"><span class="annot"><span class="annottext">target' :: Arg Type
</span><a href="#local-6989586621682121812"><span class="hs-identifier hs-var hs-var hs-var">target'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Arg Type -&gt; Arg Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121805"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span>      </span><span class="hs-comment">-- Andreas, 2010-09-07 cannot split on irrelevant args</span><span>
</span><span id="line-1265"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#usableRelevance"><span class="hs-identifier hs-var">usableRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121799"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1266"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121797"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnIrrelevant"><span class="hs-identifier hs-var">SplitOnIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121798"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-10-17, we can however split on erased things</span><span>
</span><span id="line-1269"></span><span>      </span><span class="hs-comment">-- if there is a single constructor (checked in Coverage).</span><span>
</span><span id="line-1270"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1271"></span><span>      </span><span class="hs-comment">-- Thus, no checking of (usableQuantity info) here.</span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span>      </span><span class="annot"><span class="annottext">ExceptT TCErr tcm Bool
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; ExceptT TCErr tcm Bool
forall (m :: * -&gt; *) a.
(HasOptions m, LensCohesion a) =&gt;
a -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Modality.html#splittableCohesion"><span class="hs-identifier hs-var">splittableCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121799"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1274"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121797"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnUnusableCohesion"><span class="hs-identifier hs-var">SplitOnUnusableCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121798"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolarityModality -&gt; Bool
forall a. LensModalPolarity a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#splittablePolarity"><span class="hs-identifier hs-var">splittablePolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; PolarityModality
forall a. LensModalPolarity a =&gt; a -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#getModalPolarity"><span class="hs-identifier hs-var">getModalPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121799"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1277"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121797"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnUnusablePolarity"><span class="hs-identifier hs-var">SplitOnUnusablePolarity</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121798"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1278"></span><span>
</span><span id="line-1279"></span><span>      </span><span class="hs-comment">-- check that a is indeed the type of lit (otherwise fail softly)</span><span>
</span><span id="line-1280"></span><span>      </span><span class="hs-comment">-- if not, fail softly since it could be instantiated by a later split.</span><span>
</span><span id="line-1281"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO () -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m) =&gt;
TCM a -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#suspendErrors"><span class="hs-identifier hs-var">suspendErrors</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121797"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Type -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalType"><span class="hs-identifier hs-var">equalType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121800"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO ()) -&gt; TCMT IO Type -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; TCMT IO Type
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
Literal -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.Builtin.html#litType"><span class="hs-identifier hs-var">litType</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682121802"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1282"></span><span>
</span><span id="line-1283"></span><span>      </span><span class="hs-comment">-- Compute the new state</span><span>
</span><span id="line-1284"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121821"><span class="annot"><span class="annottext">problem' :: Problem a
</span><a href="#local-6989586621682121821"><span class="hs-identifier hs-var hs-var">problem'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (Problem a) [ProblemEq] -&gt; LensSet (Problem a) [ProblemEq]
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682121808"><span class="hs-identifier hs-var">eqs'</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-1285"></span><span>      </span><span class="annot"><span class="annottext">TCM (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a)
forall a. TCM a -&gt; ExceptT TCErr tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a))
-&gt; TCM (LHSState a) -&gt; ExceptT TCErr tcm (LHSState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHSState a -&gt; TCM (LHSState a)
forall a. LHSState a -&gt; TCM (LHSState a)
</span><a href="Agda.TypeChecking.Rules.LHS.html#updateLHSState"><span class="hs-identifier hs-var">updateLHSState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Problem a
-&gt; Arg Type
-&gt; [Maybe Int]
-&gt; Bool
-&gt; LHSState a
forall a.
Telescope
-&gt; [NamedArg DeBruijnPattern]
-&gt; Problem a
-&gt; Arg Type
-&gt; [Maybe Int]
-&gt; Bool
-&gt; LHSState a
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-var">LHSState</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121804"><span class="hs-identifier hs-var">delta'</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121811"><span class="hs-identifier hs-var">ip'</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121821"><span class="hs-identifier hs-var">problem'</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121812"><span class="hs-identifier hs-var">target'</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Int]
</span><a href="#local-6989586621682121626"><span class="hs-identifier hs-var">psplit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682121627"><span class="hs-identifier hs-var">ixsplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span>    </span><span class="annot"><a href="#local-6989586621682121673"><span class="hs-identifier hs-type">splitCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>      </span><span class="hs-comment">-- The types of arguments before the one we split on</span><span>
</span><span id="line-1289"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="hs-comment">-- The type of the constructor we split on</span><span>
</span><span id="line-1290"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>  </span><span class="hs-comment">-- The types of arguments after the one we split on</span><span>
</span><span id="line-1291"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span>      </span><span class="hs-comment">-- The pattern written by the user</span><span>
</span><span id="line-1292"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbiguousQName"><span class="hs-identifier hs-type">AmbiguousQName</span></a></span><span>  </span><span class="hs-comment">-- @Just c@ for a (possibly ambiguous) constructor @c@, or</span><span>
</span><span id="line-1293"></span><span>                                      </span><span class="hs-comment">-- @Nothing@ for a record pattern</span><span>
</span><span id="line-1294"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117996"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682117997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1295"></span><span>    </span><span id="local-6989586621682121673"><span class="annot"><span class="annottext">splitCon :: Telescope
-&gt; Dom Type
-&gt; Abs Telescope
-&gt; Pattern
-&gt; Maybe AmbiguousQName
-&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121673"><span class="hs-identifier hs-var hs-var">splitCon</span></a></span></span><span> </span><span id="local-6989586621682121824"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682121825"><span class="annot"><span class="annottext">dom :: Dom Type
</span><a href="#local-6989586621682121825"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">domInfo :: forall t e. Dom' t e -&gt; ArgInfo
</span><a href="Agda.Syntax.Internal.html#domInfo"><span class="hs-identifier hs-var">domInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682121826"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682121827"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121827"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621682121828"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121828"><span class="hs-identifier hs-var">adelta2</span></a></span></span><span> </span><span id="local-6989586621682121829"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121829"><span class="hs-identifier hs-var">focusPat</span></a></span></span><span> </span><span id="local-6989586621682121830"><span class="annot"><span class="annottext">Maybe AmbiguousQName
</span><a href="#local-6989586621682121830"><span class="hs-identifier hs-var">ambC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1296"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121831"><span class="annot"><span class="annottext">delta2 :: Telescope
</span><a href="#local-6989586621682121831"><span class="hs-identifier hs-var hs-var hs-var">delta2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Telescope -&gt; Telescope
forall a. Subst a =&gt; Abs a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-var">absBody</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621682121828"><span class="hs-identifier hs-var">adelta2</span></a></span><span>
</span><span id="line-1297"></span><span>
</span><span id="line-1298"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1299"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking lhs&quot;</span></span><span>
</span><span id="line-1300"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;tel =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121622"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-1301"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rel =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relevance -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Relevance -&gt; String) -&gt; Relevance -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;mod =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; String) -&gt; Modality -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span>  </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1303"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1304"></span><span>
</span><span id="line-1305"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1306"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;split problem&quot;</span></span><span>
</span><span id="line-1307"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1308"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta1 = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span>
</span><span id="line-1309"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;a      = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121827"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1310"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta2 = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span>
</span><span id="line-1311"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
(String, Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121825"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121831"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1313"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span>      </span><span class="hs-comment">-- We cannot split on (shape-)irrelevant arguments.</span><span>
</span><span id="line-1316"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT TCErr tcm ()) -&gt; String -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;split ConP: relevance is &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#usableRelevance"><span class="hs-identifier hs-var">usableRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1318"></span><span>        </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnIrrelevant"><span class="hs-identifier hs-var">SplitOnIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121825"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1319"></span><span>
</span><span id="line-1320"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-10-17, we can however split on erased things</span><span>
</span><span id="line-1321"></span><span>      </span><span class="hs-comment">-- if there is a single constructor (checked in Coverage).</span><span>
</span><span id="line-1322"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1323"></span><span>      </span><span class="hs-comment">-- Thus, no checking of (usableQuantity info) here.</span><span>
</span><span id="line-1324"></span><span>
</span><span id="line-1325"></span><span>      </span><span class="annot"><span class="annottext">ExceptT TCErr tcm Bool
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; ExceptT TCErr tcm Bool
forall (m :: * -&gt; *) a.
(HasOptions m, LensCohesion a) =&gt;
a -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Modality.html#splittableCohesion"><span class="hs-identifier hs-var">splittableCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1326"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnUnusableCohesion"><span class="hs-identifier hs-var">SplitOnUnusableCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121825"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1327"></span><span>
</span><span id="line-1328"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolarityModality -&gt; Bool
forall a. LensModalPolarity a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#splittablePolarity"><span class="hs-identifier hs-var">splittablePolarity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; PolarityModality
forall a. LensModalPolarity a =&gt; a -&gt; PolarityModality
</span><a href="Agda.Syntax.Common.html#getModalPolarity"><span class="hs-identifier hs-var">getModalPolarity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1329"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnUnusablePolarity"><span class="hs-identifier hs-var">SplitOnUnusablePolarity</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682121825"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1330"></span><span>
</span><span id="line-1331"></span><span>      </span><span class="hs-comment">-- Should we attempt to compute a left inverse for this clause? When</span><span>
</span><span id="line-1332"></span><span>      </span><span class="hs-comment">-- --cubical=compatible --flat-split is given, we don't generate a</span><span>
</span><span id="line-1333"></span><span>      </span><span class="hs-comment">-- left inverse (at all). This means that, when the coverage checker</span><span>
</span><span id="line-1334"></span><span>      </span><span class="hs-comment">-- gets to the clause this was in, it won't generate a (malformed!)</span><span>
</span><span id="line-1335"></span><span>      </span><span class="hs-comment">-- transpX clause for @&#9837; matching.</span><span>
</span><span id="line-1336"></span><span>      </span><span class="hs-comment">-- TODO(Amy): properly support transpX when @&#9837; stuff is in the</span><span>
</span><span id="line-1337"></span><span>      </span><span class="hs-comment">-- context.</span><span>
</span><span id="line-1338"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121833"><span class="annot"><span class="annottext">genTrx :: Maybe NoLeftInv
</span><a href="#local-6989586621682121833"><span class="hs-identifier hs-var hs-var hs-var">genTrx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; NoLeftInv -&gt; Maybe NoLeftInv
forall a. Bool -&gt; a -&gt; Maybe a
</span><a href="Agda.Utils.Maybe.html#boolToMaybe"><span class="hs-identifier hs-var">boolToMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Cohesion -&gt; Cohesion -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Cohesion
</span><a href="Agda.Syntax.Common.html#Flat"><span class="hs-identifier hs-var">Flat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoLeftInv
</span><a href="Agda.TypeChecking.Rules.LHS.Unify.LeftInverse.html#SplitOnFlat"><span class="hs-identifier hs-var">SplitOnFlat</span></a></span><span>
</span><span id="line-1339"></span><span>
</span><span id="line-1340"></span><span>      </span><span class="hs-comment">-- We should be at a data/record type</span><span>
</span><span id="line-1341"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682121838"><span class="annot"><a href="#local-6989586621682121838"><span class="hs-identifier hs-var">dr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121839"><span class="annot"><a href="#local-6989586621682121839"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121840"><span class="annot"><a href="#local-6989586621682121840"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121841"><span class="annot"><a href="#local-6989586621682121841"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121842"><span class="annot"><a href="#local-6989586621682121842"><span class="hs-identifier hs-var">ixs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Telescope
-&gt; ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args)
-&gt; ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args)
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args)
 -&gt; ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args)
-&gt; ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type
-&gt; ExceptT TCErr tcm (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *).
(MonadTCM m, PureTCM m) =&gt;
Type
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
</span><a href="Agda.TypeChecking.Rules.LHS.html#isDataOrRecordType"><span class="hs-identifier hs-var">isDataOrRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121827"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1342"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121844"><span class="annot"><a href="#local-6989586621682121844"><span class="hs-identifier hs-var hs-var">isRec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682121838"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1343"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Internal.html#IsData"><span class="hs-identifier hs-type">IsData</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1344"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Internal.html#IsRecord"><span class="hs-identifier hs-type">IsRecord</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1345"></span><span>
</span><span id="line-1346"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkMatchingAllowed"><span class="hs-identifier hs-type">checkMatchingAllowed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121839"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121838"><span class="hs-identifier hs-type">dr</span></a></span><span>  </span><span class="hs-comment">-- No splitting on coinductive constructors.</span><span>
</span><span id="line-1347"></span><span>
</span><span id="line-1348"></span><span>      </span><span class="hs-comment">-- Issue #7503: use principal sort for checking if split is ok</span><span>
</span><span id="line-1349"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121848"><span class="annot"><a href="#local-6989586621682121848"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' Type (Sort' Term) -&gt; LensSet Type (Sort' Term)
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort' Term -&gt; f (Sort' Term)) -&gt; Type -&gt; f Type
forall a. LensSort a =&gt; Lens' a (Sort' Term)
Lens' Type (Sort' Term)
</span><a href="Agda.Syntax.Internal.html#lensSort"><span class="hs-identifier hs-var">lensSort</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682121840"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121827"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1350"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121824"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkSortOfSplitVar"><span class="hs-identifier hs-type">checkSortOfSplitVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121838"><span class="hs-identifier hs-type">dr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121848"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121831"><span class="hs-identifier hs-type">delta2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682121625"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span>
</span><span id="line-1352"></span><span>      </span><span class="hs-comment">-- Jesper, 2019-09-13: if the data type we split on is a strict</span><span>
</span><span id="line-1353"></span><span>      </span><span class="hs-comment">-- set, we locally enable --with-K during unification.</span><span>
</span><span id="line-1354"></span><span>      </span><span id="local-6989586621682121853"><span class="annot"><a href="#local-6989586621682121853"><span class="hs-identifier hs-var">withKIfStrict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-type">getSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121827"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682121856"><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682121856"><span class="hs-identifier hs-var">dsort</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1355"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; (TCMT IO UnificationResult -&gt; TCMT IO UnificationResult)
-&gt; TCMT IO UnificationResult
-&gt; TCMT IO UnificationResult
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort' Term -&gt; Bool
forall t. Sort' t -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#isStrictDataSort"><span class="hs-identifier hs-var">isStrictDataSort</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682121856"><span class="hs-identifier hs-var">dsort</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TCMT IO UnificationResult -&gt; TCMT IO UnificationResult)
 -&gt; TCMT IO UnificationResult -&gt; TCMT IO UnificationResult)
-&gt; (TCMT IO UnificationResult -&gt; TCMT IO UnificationResult)
-&gt; TCMT IO UnificationResult
-&gt; TCMT IO UnificationResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv Bool
-&gt; (Bool -&gt; Bool)
-&gt; TCMT IO UnificationResult
-&gt; TCMT IO UnificationResult
forall (m :: * -&gt; *) a b.
MonadTCEnv m =&gt;
Lens' TCEnv a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-var">locallyTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f Bool) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#eSplitOnStrict"><span class="hs-identifier hs-var">eSplitOnStrict</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool -&gt; Bool)
 -&gt; TCMT IO UnificationResult -&gt; TCMT IO UnificationResult)
-&gt; (Bool -&gt; Bool)
-&gt; TCMT IO UnificationResult
-&gt; TCMT IO UnificationResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1356"></span><span>
</span><span id="line-1357"></span><span>      </span><span class="hs-comment">-- The constructor should construct an element of this datatype</span><span>
</span><span id="line-1358"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682121862"><span class="annot"><a href="#local-6989586621682121862"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">ConHead</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121863"><span class="annot"><a href="#local-6989586621682121863"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121824"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682121830"><span class="hs-identifier hs-type">ambC</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1359"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682121864"><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682121864"><span class="hs-identifier hs-var">ambC</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AmbiguousQName -&gt; QName -&gt; Args -&gt; TCM (ConHead, Type)
</span><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateConstructor"><span class="hs-identifier hs-var">disambiguateConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682121864"><span class="hs-identifier hs-var">ambC</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682121839"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682121841"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-1360"></span><span>        </span><span class="annot"><span class="annottext">Maybe AmbiguousQName
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Args -&gt; Type -&gt; TCM (ConHead, Type)
</span><a href="Agda.TypeChecking.Rules.LHS.html#getRecordConstructor"><span class="hs-identifier hs-var">getRecordConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682121839"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682121841"><span class="hs-identifier hs-var">pars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121827"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span>      </span><span class="hs-comment">-- Don't split on lazy (non-eta) constructor</span><span>
</span><span id="line-1363"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682121829"><span class="hs-identifier hs-type">focusPat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1364"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span id="local-6989586621682121866"><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682121866"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConPatInfo -&gt; ConPatLazy
</span><a href="Agda.Syntax.Info.html#conPatLazy"><span class="hs-identifier hs-var">A.conPatLazy</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><a href="#local-6989586621682121866"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatLazy -&gt; ConPatLazy -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConPatLazy
</span><a href="Agda.Syntax.Info.html#ConPatLazy"><span class="hs-identifier hs-var">A.ConPatLazy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1365"></span><span>          </span><span class="annot"><span class="annottext">ExceptT TCErr tcm Bool
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; ExceptT TCErr tcm Bool
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaRecord"><span class="hs-identifier hs-var">isEtaRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682121839"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ())
-&gt; ExceptT TCErr tcm () -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm ())
-&gt; TypeError -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ForcedConstructorNotInstantiated"><span class="hs-identifier hs-var">ForcedConstructorNotInstantiated</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621682121829"><span class="hs-identifier hs-var">focusPat</span></a></span><span>
</span><span id="line-1366"></span><span>        </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCErr tcm ()
forall a. a -&gt; ExceptT TCErr tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span>      </span><span class="hs-comment">-- The type of the constructor will end in an application of the datatype</span><span>
</span><span id="line-1369"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682121871"><span class="annot"><a href="#local-6989586621682121871"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121872"><span class="annot"><a href="#local-6989586621682121872"><span class="hs-identifier hs-var">ctarget</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682121873"><span class="annot"><a href="#local-6989586621682121873"><span class="hs-identifier hs-var">boundary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewPathBoundary"><span class="hs-identifier hs-type">telViewPathBoundary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121863"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1370"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682121875"><span class="annot"><a href="#local-6989586621682121875"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span id="local-6989586621682121876"><span class="annot"><a href="#local-6989586621682121876"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682121872"><span class="hs-identifier hs-type">ctarget</span></a></span><span>
</span><span id="line-1371"></span><span>          </span><span id="local-6989586621682121877"><span class="annot"><a href="#local-6989586621682121877"><span class="hs-identifier hs-var hs-var">cixs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Args -&gt; Args
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Args -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682121841"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Args) -&gt; Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682121876"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>      </span><span class="hs-comment">-- &#916;&#8321;&#915; &#8866; boundary</span><span>
</span><span id="line-1374"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split.con&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  boundary = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121873"><span class="hs-identifier hs-type">boundary</span></a></span><span>
</span><span id="line-1375"></span><span>
</span><span id="line-1376"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121839"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682121875"><span class="hs-identifier hs-type">d'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-'-}</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1377"></span><span>
</span><span id="line-1378"></span><span>      </span><span class="hs-comment">-- Get names for the constructor arguments from the user patterns</span><span>
</span><span id="line-1379"></span><span>      </span><span id="local-6989586621682121878"><span class="annot"><a href="#local-6989586621682121878"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682121829"><span class="hs-identifier hs-type">focusPat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1380"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121879"><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682121879"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1381"></span><span>          </span><span id="local-6989586621682121880"><span class="annot"><a href="#local-6989586621682121880"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpandHidden
-&gt; [NamedArg Pattern] -&gt; Telescope -&gt; TCMT IO [NamedArg Pattern]
forall (m :: * -&gt; *).
(PureTCM m, MonadError TCErr m, MonadFresh NameId m,
 MonadTrace m) =&gt;
ExpandHidden
-&gt; [NamedArg Pattern] -&gt; Telescope -&gt; m [NamedArg Pattern]
</span><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatterns"><span class="hs-identifier hs-var">insertImplicitPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">ExpandHidden
</span><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-var">ExpandLast</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Pattern]
</span><a href="#local-6989586621682121879"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121871"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-1382"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.ProblemRest.html#useNamesFromPattern"><span class="hs-identifier hs-type">useNamesFromPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121880"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121871"><span class="hs-identifier hs-type">gamma</span></a></span><span>
</span><span id="line-1383"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RecP"><span class="hs-identifier hs-type">A.RecP</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConPatInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682121882"><span class="annot"><span class="annottext">[FieldAssignment' Pattern]
</span><a href="#local-6989586621682121882"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1384"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordDefn"><span class="hs-identifier hs-type">RecordDefn</span></a></span><span> </span><span id="local-6989586621682121884"><span class="annot"><a href="#local-6989586621682121884"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Defn) -&gt; TCMT IO Definition -&gt; TCMT IO Defn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682121839"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1385"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121885"><span class="annot"><a href="#local-6989586621682121885"><span class="hs-identifier hs-var hs-var">axs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom Name -&gt; Arg Name) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom Name -&gt; Arg Name
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom Name] -&gt; [Arg Name]) -&gt; [Dom Name] -&gt; [Arg Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordData -&gt; [Dom Name]
</span><a href="Agda.TypeChecking.Records.html#recordFieldNames"><span class="hs-identifier hs-var">recordFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">RecordData
</span><a href="#local-6989586621682121884"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1386"></span><span>          </span><span id="local-6989586621682121887"><span class="annot"><a href="#local-6989586621682121887"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#insertMissingFieldsFail"><span class="hs-identifier hs-type">insertMissingFieldsFail</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ConORec"><span class="hs-identifier hs-type">ConORec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121839"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682121882"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121885"><span class="hs-identifier hs-type">axs</span></a></span><span>
</span><span id="line-1387"></span><span>          </span><span id="local-6989586621682121888"><span class="annot"><a href="#local-6989586621682121888"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Implicit.html#insertImplicitPatterns"><span class="hs-identifier hs-type">insertImplicitPatterns</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExpandLast"><span class="hs-identifier hs-type">ExpandLast</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121887"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121871"><span class="hs-identifier hs-type">gamma</span></a></span><span>
</span><span id="line-1388"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.ProblemRest.html#useNamesFromPattern"><span class="hs-identifier hs-type">useNamesFromPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121888"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121871"><span class="hs-identifier hs-type">gamma</span></a></span><span>
</span><span id="line-1389"></span><span>        </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1390"></span><span>
</span><span id="line-1391"></span><span>      </span><span class="hs-comment">-- Andreas 2010-09-07  propagate relevance info to new vars</span><span>
</span><span id="line-1392"></span><span>      </span><span class="hs-comment">-- Andreas 2018-10-17  propagate modality</span><span>
</span><span id="line-1393"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121889"><span class="annot"><a href="#local-6989586621682121889"><span class="hs-identifier hs-var hs-var">updMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Modality
</span><a href="Agda.Syntax.Common.html#composeModality"><span class="hs-identifier hs-var">composeModality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>      </span><span id="local-6989586621682121890"><span class="annot"><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#mapModality"><span class="hs-identifier hs-type">mapModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121889"><span class="hs-identifier hs-type">updMod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682121878"><span class="hs-identifier hs-type">gamma</span></a></span><span>
</span><span id="line-1395"></span><span>
</span><span id="line-1396"></span><span>      </span><span class="hs-comment">-- Get the type of the datatype.</span><span>
</span><span id="line-1397"></span><span>      </span><span id="local-6989586621682121891"><span class="annot"><a href="#local-6989586621682121891"><span class="hs-identifier hs-var">da</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`piApply`</span></span><span> </span><span class="annot"><span class="hs-identifier">pars</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121839"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-1398"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  da = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121891"><span class="hs-identifier hs-type">da</span></a></span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121824"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1401"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;preparing to unify&quot;</span></span><span>
</span><span id="line-1402"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1403"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;c      =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121862"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121863"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1404"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;d      =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121839"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121841"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121891"><span class="hs-identifier hs-type">da</span></a></span><span>
</span><span id="line-1405"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;isRec  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682121844"><span class="hs-identifier hs-type">isRec</span></a></span><span>
</span><span id="line-1406"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;gamma  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121890"><span class="hs-identifier hs-type">gamma</span></a></span><span>
</span><span id="line-1407"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;pars   =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121841"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1408"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ixs    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121842"><span class="hs-identifier hs-type">ixs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1409"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cixs   =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121890"><span class="hs-identifier hs-type">gamma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121877"><span class="hs-identifier hs-type">cixs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1410"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1411"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1412"></span><span>                 </span><span class="hs-comment">-- We ignore forcing for make-case</span><span>
</span><span id="line-1413"></span><span>      </span><span id="local-6989586621682121895"><span class="annot"><a href="#local-6989586621682121895"><span class="hs-identifier hs-var">cforced</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eMakeCase"><span class="hs-identifier hs-type">eMakeCase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1414"></span><span>                 </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defForced"><span class="hs-identifier hs-type">defForced</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121862"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121901"><span class="annot"><a href="#local-6989586621682121901"><span class="hs-identifier hs-var hs-var">delta1Gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-1417"></span><span>          </span><span id="local-6989586621682121902"><span class="annot"><a href="#local-6989586621682121902"><span class="hs-identifier hs-var hs-var">da'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121891"><span class="hs-identifier hs-var">da</span></a></span><span>
</span><span id="line-1418"></span><span>          </span><span id="local-6989586621682121904"><span class="annot"><a href="#local-6989586621682121904"><span class="hs-identifier hs-var hs-var">ixs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Args -&gt; Args
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682121842"><span class="hs-identifier hs-var">ixs</span></a></span><span>
</span><span id="line-1419"></span><span>          </span><span class="hs-comment">-- Variables in &#916;&#8321; are not forced, since the unifier takes care to not introduce forced</span><span>
</span><span id="line-1420"></span><span>          </span><span class="hs-comment">-- variables.</span><span>
</span><span id="line-1421"></span><span>          </span><span id="local-6989586621682121905"><span class="annot"><a href="#local-6989586621682121905"><span class="hs-identifier hs-var hs-var">forced</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IsForced -&gt; [IsForced]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsForced
</span><a href="Agda.TypeChecking.Monad.Base.html#NotForced"><span class="hs-identifier hs-var">NotForced</span></a></span><span> </span><span class="annot"><span class="annottext">[IsForced] -&gt; [IsForced] -&gt; [IsForced]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621682121895"><span class="hs-identifier hs-var">cforced</span></a></span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span>      </span><span class="hs-comment">-- All variables are flexible.</span><span>
</span><span id="line-1424"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121908"><span class="annot"><a href="#local-6989586621682121908"><span class="hs-identifier hs-var hs-var">flex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IsForced] -&gt; Telescope -&gt; FlexibleVars
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#allFlexVars"><span class="hs-identifier hs-var">allFlexVars</span></a></span><span> </span><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621682121905"><span class="hs-identifier hs-var">forced</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; FlexibleVars) -&gt; Telescope -&gt; FlexibleVars
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121901"><span class="hs-identifier hs-var">delta1Gamma</span></a></span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span>      </span><span class="hs-comment">-- Unify constructor target and given type (in &#916;&#8321;&#915;)</span><span>
</span><span id="line-1427"></span><span>      </span><span class="hs-comment">-- Given: &#916;&#8321;  &#8866; D pars : &#934; &#8594; Set&#7522;</span><span>
</span><span id="line-1428"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;  &#8866; c      : &#915; &#8594; D pars cixs</span><span>
</span><span id="line-1429"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;  &#8866; ixs    : &#934;</span><span>
</span><span id="line-1430"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;&#915; &#8866; cixs   : &#934;</span><span>
</span><span id="line-1431"></span><span>      </span><span class="hs-comment">-- unification of ixs and cixs in context &#916;&#8321;&#915; gives us a telescope &#916;&#8321;'</span><span>
</span><span id="line-1432"></span><span>      </span><span class="hs-comment">-- and a substitution &#961;&#8320; such that</span><span>
</span><span id="line-1433"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;' &#8866; &#961;&#8320; : &#916;&#8321;&#915;</span><span>
</span><span id="line-1434"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;' &#8866; (ixs)&#961;&#8320; &#8801; (cixs)&#961;&#8320; : &#934;&#961;&#8320;</span><span>
</span><span id="line-1435"></span><span>      </span><span class="hs-comment">-- We can split &#961;&#8320; into two parts &#961;&#8321; and &#961;&#8322;, giving</span><span>
</span><span id="line-1436"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;' &#8866; &#961;&#8321; : &#916;&#8321;</span><span>
</span><span id="line-1437"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;' &#8866; &#961;&#8322; : &#915;&#961;&#8321;</span><span>
</span><span id="line-1438"></span><span>      </span><span class="hs-comment">-- Application of the constructor c gives</span><span>
</span><span id="line-1439"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;' &#8866; (c &#915;)(&#961;&#8320;) : (D pars cixs)(&#961;&#8321;;&#961;&#8322;)</span><span>
</span><span id="line-1440"></span><span>      </span><span class="hs-comment">-- We have</span><span>
</span><span id="line-1441"></span><span>      </span><span class="hs-comment">--        cixs(&#961;&#8321;;&#961;&#8322;)</span><span>
</span><span id="line-1442"></span><span>      </span><span class="hs-comment">--         &#8801; cixs(&#961;&#8320;)   (since &#961;&#8320;=&#961;&#8321;;&#961;&#8322;)</span><span>
</span><span id="line-1443"></span><span>      </span><span class="hs-comment">--         &#8801; ixs(&#961;&#8320;)    (by unification)</span><span>
</span><span id="line-1444"></span><span>      </span><span class="hs-comment">--         &#8801; ixs(&#961;&#8321;)    (since ixs doesn't actually depend on &#915;)</span><span>
</span><span id="line-1445"></span><span>      </span><span class="hs-comment">-- so     &#916;&#8321;' &#8866; (c &#915;)(&#961;&#8320;) : (D pars ixs)&#961;&#8321;</span><span>
</span><span id="line-1446"></span><span>      </span><span class="hs-comment">-- Putting this together with &#961;&#8321; gives &#961;&#8323; = &#961;&#8321;;c &#961;&#8322;</span><span>
</span><span id="line-1447"></span><span>      </span><span class="hs-comment">--        &#916;&#8321;' &#8866; &#961;&#8321;;(c &#915;)(&#961;&#8320;) : &#916;&#8321;(x : D vs ws)</span><span>
</span><span id="line-1448"></span><span>      </span><span class="hs-comment">-- and lifting over &#916;&#8322; gives the final substitution &#961; = &#961;&#8323;;&#916;&#8322;</span><span>
</span><span id="line-1449"></span><span>      </span><span class="hs-comment">-- from &#916;' = &#916;&#8321;';&#916;&#8322;&#961;&#8323;</span><span>
</span><span id="line-1450"></span><span>      </span><span class="hs-comment">--        &#916;' &#8866; &#961; : &#916;&#8321;(x : D vs ws)&#916;&#8322;</span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span>      </span><span class="hs-comment">-- Andrea 2019-07-17 propagate the Cohesion to the equation telescope</span><span>
</span><span id="line-1453"></span><span>      </span><span class="hs-comment">-- TODO: should we propagate the modality in general?</span><span>
</span><span id="line-1454"></span><span>      </span><span class="hs-comment">-- See also Coverage checking.</span><span>
</span><span id="line-1455"></span><span>      </span><span id="local-6989586621682121910"><span class="annot"><a href="#local-6989586621682121910"><span class="hs-identifier hs-var">da'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121901"><span class="hs-identifier hs-type">delta1Gamma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1456"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121911"><span class="annot"><a href="#local-6989586621682121911"><span class="hs-identifier hs-var hs-var">updCoh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cohesion -&gt; Cohesion -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#composeCohesion"><span class="hs-identifier hs-var">composeCohesion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Cohesion
forall a. LensCohesion a =&gt; a -&gt; Cohesion
</span><a href="Agda.Syntax.Common.html#getCohesion"><span class="hs-identifier hs-var">getCohesion</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1457"></span><span>             </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682121913"><span class="annot"><a href="#local-6989586621682121913"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682121914"><span class="annot"><a href="#local-6989586621682121914"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-type">telView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121902"><span class="hs-identifier hs-type">da'</span></a></span><span>
</span><span id="line-1458"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#mapCohesion"><span class="hs-identifier hs-type">mapCohesion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121911"><span class="hs-identifier hs-type">updCoh</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682121913"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682121827"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121917"><span class="annot"><a href="#local-6989586621682121917"><span class="hs-identifier hs-var hs-var">stuck</span></a></span></span><span> </span><span id="local-6989586621682121918"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682121918"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682121919"><span class="annot"><span class="annottext">[UnificationFailure]
</span><a href="#local-6989586621682121919"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm (LHSState a)
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm (LHSState a))
-&gt; TypeError -&gt; ExceptT TCErr tcm (LHSState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SplitError -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitError"><span class="hs-identifier hs-var">SplitError</span></a></span><span> </span><span class="annot"><span class="annottext">(SplitError -&gt; TypeError) -&gt; SplitError -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1461"></span><span>            </span><span class="annot"><span class="annottext">Maybe Blocker
-&gt; QName
-&gt; Telescope
-&gt; Args
-&gt; Args
-&gt; [UnificationFailure]
-&gt; SplitError
</span><a href="Agda.TypeChecking.Monad.Base.html#UnificationStuck"><span class="hs-identifier hs-var">UnificationStuck</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682121918"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682121862"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121824"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682121877"><span class="hs-identifier hs-var">cixs</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682121904"><span class="hs-identifier hs-var">ixs'</span></a></span><span> </span><span class="annot"><span class="annottext">[UnificationFailure]
</span><a href="#local-6989586621682121919"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121853"><span class="hs-identifier hs-type">withKIfStrict</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Unify.html#unifyIndices"><span class="hs-identifier hs-type">unifyIndices</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121833"><span class="hs-identifier hs-type">genTrx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121901"><span class="hs-identifier hs-type">delta1Gamma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121908"><span class="hs-identifier hs-type">flex</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121910"><span class="hs-identifier hs-type">da'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121877"><span class="hs-identifier hs-type">cixs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121904"><span class="hs-identifier hs-type">ixs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span>        </span><span class="hs-comment">-- Mismatch.  Report and abort.</span><span>
</span><span id="line-1466"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Unify.html#NoUnify"><span class="hs-identifier hs-type">NoUnify</span></a></span><span> </span><span id="local-6989586621682121924"><span class="annot"><span class="annottext">NegativeUnification
</span><a href="#local-6989586621682121924"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr tcm (LHSState a)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr tcm (LHSState a))
-&gt; TypeError -&gt; ExceptT TCErr tcm (LHSState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; NegativeUnification -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ImpossibleConstructor"><span class="hs-identifier hs-var">ImpossibleConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682121862"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NegativeUnification
</span><a href="#local-6989586621682121924"><span class="hs-identifier hs-var">neg</span></a></span><span>
</span><span id="line-1467"></span><span>
</span><span id="line-1468"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Unify.html#UnifyBlocked"><span class="hs-identifier hs-type">UnifyBlocked</span></a></span><span> </span><span id="local-6989586621682121927"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682121927"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
-&gt; [UnificationFailure] -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121917"><span class="hs-identifier hs-var">stuck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; Maybe Blocker
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682121927"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span>        </span><span class="hs-comment">-- Unclear situation.  Try next split.</span><span>
</span><span id="line-1471"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Unify.html#UnifyStuck"><span class="hs-identifier hs-type">UnifyStuck</span></a></span><span> </span><span id="local-6989586621682121929"><span class="annot"><span class="annottext">[UnificationFailure]
</span><a href="#local-6989586621682121929"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
-&gt; [UnificationFailure] -&gt; ExceptT TCErr tcm (LHSState a)
</span><a href="#local-6989586621682121917"><span class="hs-identifier hs-var">stuck</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[UnificationFailure]
</span><a href="#local-6989586621682121929"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-1472"></span><span>
</span><span id="line-1473"></span><span>        </span><span class="hs-comment">-- Success.</span><span>
</span><span id="line-1474"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Unify.html#Unifies"><span class="hs-identifier hs-type">Unifies</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682121931"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682121932"><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121932"><span class="hs-identifier hs-var">rho0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682121933"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121933"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1475"></span><span>
</span><span id="line-1476"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;unification successful&quot;</span></span><span>
</span><span id="line-1477"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1478"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta1' =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span>
</span><span id="line-1479"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho0    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; PatternSubstitution -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121932"><span class="hs-identifier hs-var">rho0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1480"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;es      =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Named NamedName Term)] -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *).
MonadPretty m =&gt;
[Arg (Named NamedName Term)] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Named NamedName Term)] -&gt; TCMT IO Doc)
-&gt; [Arg (Named NamedName Term)] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Arg (Named NamedName Term))
-&gt; [NamedArg DeBruijnPattern] -&gt; [Arg (Named NamedName Term)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((NamedArg DeBruijnPattern -&gt; Arg (Named NamedName Term))
 -&gt; [NamedArg DeBruijnPattern] -&gt; [Arg (Named NamedName Term)])
-&gt; ((DeBruijnPattern -&gt; Term)
    -&gt; NamedArg DeBruijnPattern -&gt; Arg (Named NamedName Term))
-&gt; (DeBruijnPattern -&gt; Term)
-&gt; [NamedArg DeBruijnPattern]
-&gt; [Arg (Named NamedName Term)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; Named NamedName Term)
-&gt; NamedArg DeBruijnPattern -&gt; Arg (Named NamedName Term)
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Named NamedName DeBruijnPattern -&gt; Named NamedName Term)
 -&gt; NamedArg DeBruijnPattern -&gt; Arg (Named NamedName Term))
-&gt; ((DeBruijnPattern -&gt; Term)
    -&gt; Named NamedName DeBruijnPattern -&gt; Named NamedName Term)
-&gt; (DeBruijnPattern -&gt; Term)
-&gt; NamedArg DeBruijnPattern
-&gt; Arg (Named NamedName Term)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; Term)
-&gt; Named NamedName DeBruijnPattern -&gt; Named NamedName Term
forall a b. (a -&gt; b) -&gt; Named NamedName a -&gt; Named NamedName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Term
</span><a href="Agda.Syntax.Internal.Pattern.html#patternToTerm"><span class="hs-identifier hs-var">patternToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121933"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1481"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1482"></span><span>
</span><span id="line-1483"></span><span>          </span><span class="hs-comment">-- split substitution into part for &#916;&#8321; and part for &#915;</span><span>
</span><span id="line-1484"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682121934"><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121934"><span class="hs-identifier hs-var hs-var">rho1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682121935"><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121935"><span class="hs-identifier hs-var hs-var">rho2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; PatternSubstitution
-&gt; (PatternSubstitution, PatternSubstitution)
forall a.
Int -&gt; Substitution' a -&gt; (Substitution' a, Substitution' a)
</span><a href="Agda.TypeChecking.Substitute.Class.html#splitS"><span class="hs-identifier hs-var">splitS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121932"><span class="hs-identifier hs-var">rho0</span></a></span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1487"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho1    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; PatternSubstitution -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121934"><span class="hs-identifier hs-var">rho1</span></a></span><span>
</span><span id="line-1488"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho2    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; PatternSubstitution -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121935"><span class="hs-identifier hs-var">rho2</span></a></span><span>
</span><span id="line-1489"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1490"></span><span>
</span><span id="line-1491"></span><span>          </span><span class="hs-comment">-- Andreas, 2010-09-09, save the type.</span><span>
</span><span id="line-1492"></span><span>          </span><span class="hs-comment">-- It is relative to &#916;&#8321;, but it should be relative to &#916;&#8321;'</span><span>
</span><span id="line-1493"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121937"><span class="annot"><span class="annottext">a' :: Type
</span><a href="#local-6989586621682121937"><span class="hs-identifier hs-var hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Type -&gt; Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121934"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121827"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span>          </span><span class="hs-comment">-- Also remember if we are a record pattern.</span><span>
</span><span id="line-1496"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121938"><span class="annot"><span class="annottext">cpi :: ConPatternInfo
</span><a href="#local-6989586621682121938"><span class="hs-identifier hs-var hs-var hs-var">cpi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConPatternInfo"><span class="hs-identifier hs-type">ConPatternInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">conPInfo :: PatternInfo
</span><a href="Agda.Syntax.Internal.html#conPInfo"><span class="hs-identifier hs-var">conPInfo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatOrigin -&gt; [Name] -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#PatternInfo"><span class="hs-identifier hs-var">PatternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatOCon"><span class="hs-identifier hs-var">PatOCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1497"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conPRecord :: Bool
</span><a href="Agda.Syntax.Internal.html#conPRecord"><span class="hs-identifier hs-var">conPRecord</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682121844"><span class="hs-identifier hs-var">isRec</span></a></span><span>
</span><span id="line-1498"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conPFallThrough :: Bool
</span><a href="Agda.Syntax.Internal.html#conPFallThrough"><span class="hs-identifier hs-var">conPFallThrough</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1499"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conPType :: Maybe (Arg Type)
</span><a href="Agda.Syntax.Internal.html#conPType"><span class="hs-identifier hs-var">conPType</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Maybe (Arg Type)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Arg Type -&gt; Maybe (Arg Type)) -&gt; Arg Type -&gt; Maybe (Arg Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Type -&gt; Arg Type
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682121937"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-1500"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conPLazy :: Bool
</span><a href="Agda.Syntax.Internal.html#conPLazy"><span class="hs-identifier hs-var">conPLazy</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- Don't mark eta-record matches as lazy (#4254)</span><span>
</span><span id="line-1501"></span><span>
</span><span id="line-1502"></span><span>          </span><span class="hs-comment">-- compute final context and substitution</span><span>
</span><span id="line-1503"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121940"><span class="annot"><span class="annottext">crho :: DeBruijnPattern
</span><a href="#local-6989586621682121940"><span class="hs-identifier hs-var hs-var hs-var">crho</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; ConPatternInfo -&gt; [NamedArg DeBruijnPattern] -&gt; DeBruijnPattern
forall x.
ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-var">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682121862"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682121938"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; DeBruijnPattern)
-&gt; [NamedArg DeBruijnPattern] -&gt; DeBruijnPattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
Substitution' (SubstArg [NamedArg DeBruijnPattern])
</span><a href="#local-6989586621682121932"><span class="hs-identifier hs-var">rho0</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Boundary -&gt; [NamedArg DeBruijnPattern]
forall a.
DeBruijn a =&gt;
Telescope -&gt; Boundary -&gt; [NamedArg (Pattern' a)]
</span><a href="Agda.TypeChecking.Telescope.html#telePatterns"><span class="hs-identifier hs-var">telePatterns</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121890"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Boundary
</span><a href="#local-6989586621682121873"><span class="hs-identifier hs-var">boundary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span>              </span><span id="local-6989586621682121942"><span class="annot"><span class="annottext">rho3 :: PatternSubstitution
</span><a href="#local-6989586621682121942"><span class="hs-identifier hs-var hs-var hs-var">rho3</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; PatternSubstitution -&gt; PatternSubstitution
forall a. DeBruijn a =&gt; a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#consS"><span class="hs-identifier hs-var">consS</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682121940"><span class="hs-identifier hs-var">crho</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121934"><span class="hs-identifier hs-var">rho1</span></a></span><span>
</span><span id="line-1505"></span><span>              </span><span id="local-6989586621682121943"><span class="annot"><span class="annottext">delta2' :: Telescope
</span><a href="#local-6989586621682121943"><span class="hs-identifier hs-var hs-var hs-var">delta2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Telescope -&gt; Telescope
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121942"><span class="hs-identifier hs-var">rho3</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121831"><span class="hs-identifier hs-var">delta2</span></a></span><span>
</span><span id="line-1506"></span><span>              </span><span id="local-6989586621682121944"><span class="annot"><span class="annottext">delta' :: Telescope
</span><a href="#local-6989586621682121944"><span class="hs-identifier hs-var hs-var hs-var">delta'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121943"><span class="hs-identifier hs-var">delta2'</span></a></span><span>
</span><span id="line-1507"></span><span>              </span><span id="local-6989586621682121945"><span class="annot"><span class="annottext">rho :: PatternSubstitution
</span><a href="#local-6989586621682121945"><span class="hs-identifier hs-var hs-var hs-var">rho</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PatternSubstitution -&gt; PatternSubstitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121831"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121942"><span class="hs-identifier hs-var">rho3</span></a></span><span>
</span><span id="line-1508"></span><span>
</span><span id="line-1509"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1510"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;crho    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; DeBruijnPattern -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682121940"><span class="hs-identifier hs-var">crho</span></a></span><span>
</span><span id="line-1511"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho3    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; PatternSubstitution -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121942"><span class="hs-identifier hs-var">rho3</span></a></span><span>
</span><span id="line-1512"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta2' =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121943"><span class="hs-identifier hs-var">delta2'</span></a></span><span>
</span><span id="line-1513"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1514"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121931"><span class="hs-identifier hs-var">delta1'</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1515"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;crho    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682121940"><span class="hs-identifier hs-var">crho</span></a></span><span>
</span><span id="line-1516"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho3    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121942"><span class="hs-identifier hs-var">rho3</span></a></span><span>
</span><span id="line-1517"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta2' =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121943"><span class="hs-identifier hs-var">delta2'</span></a></span><span>
</span><span id="line-1518"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; ExceptT TCErr tcm ())
-&gt; TCMT IO Doc -&gt; ExceptT TCErr tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1521"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta'  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Telescope -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121944"><span class="hs-identifier hs-var">delta'</span></a></span><span>
</span><span id="line-1522"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;rho     =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Telescope -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682121944"><span class="hs-identifier hs-var">delta'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSubstitution -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; PatternSubstitution -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121945"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1524"></span><span>
</span><span id="line-1525"></span><span>          </span><span class="hs-comment">-- Compute the new out patterns and target type.</span><span>
</span><span id="line-1526"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121946"><span class="annot"><span class="annottext">ip' :: [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121946"><span class="hs-identifier hs-var hs-var hs-var">ip'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
Substitution' (SubstArg [NamedArg DeBruijnPattern])
</span><a href="#local-6989586621682121945"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682121623"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-1527"></span><span>              </span><span id="local-6989586621682121947"><span class="annot"><span class="annottext">target' :: Arg Type
</span><a href="#local-6989586621682121947"><span class="hs-identifier hs-var hs-var hs-var">target'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; Arg Type -&gt; Arg Type
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121945"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121625"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span>          </span><span class="hs-comment">-- Update the problem equations</span><span>
</span><span id="line-1530"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121948"><span class="annot"><span class="annottext">eqs' :: [ProblemEq]
</span><a href="#local-6989586621682121948"><span class="hs-identifier hs-var hs-var hs-var">eqs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSubstitution -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. TermSubst a =&gt; PatternSubstitution -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.html#applyPatSubst"><span class="hs-identifier hs-var">applyPatSubst</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSubstitution
</span><a href="#local-6989586621682121945"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a -&gt; Lens' (Problem a) [ProblemEq] -&gt; [ProblemEq]
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span>
</span><span id="line-1531"></span><span>              </span><span id="local-6989586621682121951"><span class="annot"><span class="annottext">problem' :: Problem a
</span><a href="#local-6989586621682121951"><span class="hs-identifier hs-var hs-var hs-var">problem'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (Problem a) [ProblemEq] -&gt; LensSet (Problem a) [ProblemEq]
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
forall a (f :: * -&gt; *).
Functor f =&gt;
([ProblemEq] -&gt; f [ProblemEq]) -&gt; Problem a -&gt; f (Problem a)
Lens' (Problem a) [ProblemEq]
</span><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-var">problemEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682121948"><span class="hs-identifier hs-var">eqs'</span></a></span><span> </span><span class="annot"><span class="annottext">Problem a
</span><a href="#local-6989586621682121624"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span>          </span><span class="hs-comment">-- The result type's quantity is set to 0 for erased</span><span>
</span><span id="line-1534"></span><span>          </span><span class="hs-comment">-- constructors, but not if the match is made in an erased</span><span>
</span><span id="line-1535"></span><span>          </span><span class="hs-comment">-- position, or if the original constructor definition is</span><span>
</span><span id="line-1536"></span><span>          </span><span class="hs-comment">-- not erased.</span><span>
</span><span id="line-1537"></span><span>          </span><span id="local-6989586621682121954"><span class="annot"><a href="#local-6989586621682121954"><span class="hs-identifier hs-var">cq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Quantity)
-&gt; ExceptT TCErr tcm Definition -&gt; ExceptT TCErr tcm Quantity
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ExceptT TCErr tcm Definition
forall (m :: * -&gt; *).
(ReadTCState m, HasConstInfo m) =&gt;
QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getOriginalConstInfo"><span class="hs-identifier hs-var">getOriginalConstInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682121862"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1538"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682121957"><span class="annot"><a href="#local-6989586621682121957"><span class="hs-identifier hs-var hs-var">target''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Quantity -&gt; Quantity) -&gt; Arg Type -&gt; Arg Type
forall a. LensQuantity a =&gt; (Quantity -&gt; Quantity) -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#mapQuantity"><span class="hs-identifier hs-var">mapQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity
</span><a href="#local-6989586621682121959"><span class="hs-identifier hs-var">updResMod</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682121947"><span class="hs-identifier hs-var">target'</span></a></span><span>
</span><span id="line-1539"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-1540"></span><span>                  </span><span id="local-6989586621682121960"><span class="annot"><span class="annottext">erased :: Bool
</span><a href="#local-6989586621682121960"><span class="hs-identifier hs-var hs-var">erased</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682121826"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1541"></span><span>                    </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity0"><span class="hs-identifier hs-type">Quantity0</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1542"></span><span>                    </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity1"><span class="hs-identifier hs-type">Quantity1</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1543"></span><span>                    </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity%3C9"><span class="hs-identifier hs-type">Quantity&#969;</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1544"></span><span>                  </span><span class="hs-comment">-- either sets to Quantity0 or is the identity.</span><span>
</span><span id="line-1545"></span><span>                  </span><span id="local-6989586621682121959"><span class="annot"><span class="annottext">updResMod :: Quantity -&gt; Quantity
</span><a href="#local-6989586621682121959"><span class="hs-identifier hs-var hs-var">updResMod</span></a></span></span><span> </span><span id="local-6989586621682121964"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682121964"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1546"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682121954"><span class="hs-identifier hs-var">cq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1547"></span><span>                     </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682121960"><span class="hs-identifier hs-var">erased</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682121964"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-1548"></span><span>                     </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity0"><span class="hs-identifier hs-type">Quantity0</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#composeQuantity"><span class="hs-identifier hs-var">composeQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682121954"><span class="hs-identifier hs-var">cq</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682121964"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-1549"></span><span>                                 </span><span class="hs-comment">-- zero-out, preserves origin</span><span>
</span><span id="line-1550"></span><span>                     </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity1"><span class="hs-identifier hs-type">Quantity1</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Quantity
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1551"></span><span>                     </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity%3C9"><span class="hs-identifier hs-type">Quantity&#969;</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682121964"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span>          </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121842"><span class="hs-identifier hs-type">ixs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1554"></span><span>            </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#withoutKOption"><span class="hs-identifier hs-type">withoutKOption</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#or2M"><span class="hs-operator hs-type">`or2M`</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#cubicalCompatibleOption"><span class="hs-identifier hs-type">cubicalCompatibleOption</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1555"></span><span>              </span><span id="local-6989586621682121970"><span class="annot"><a href="#local-6989586621682121970"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#currentModality"><span class="hs-identifier hs-type">currentModality</span></a></span><span>
</span><span id="line-1556"></span><span>              </span><span id="local-6989586621682121972"><span class="annot"><a href="#local-6989586621682121972"><span class="hs-identifier hs-var">lhsRng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">asks</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#lhsRange"><span class="hs-identifier hs-var">lhsRange</span></a></span><span>
</span><span id="line-1557"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121944"><span class="hs-identifier hs-type">delta'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1558"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#conSplitModalityCheck"><span class="hs-identifier hs-type">conSplitModalityCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121972"><span class="hs-identifier hs-type">lhsRng</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121970"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121945"><span class="hs-identifier hs-type">rho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682121831"><span class="hs-identifier hs-type">delta2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682121622"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121625"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>
</span><span id="line-1560"></span><span>          </span><span class="hs-comment">-- if rest type reduces,</span><span>
</span><span id="line-1561"></span><span>          </span><span class="hs-comment">-- extend the split problem by previously not considered patterns</span><span>
</span><span id="line-1562"></span><span>          </span><span id="local-6989586621682121973"><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#updateLHSState"><span class="hs-identifier hs-type">updateLHSState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#LHSState"><span class="hs-identifier hs-type">LHSState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121944"><span class="hs-identifier hs-type">delta'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121946"><span class="hs-identifier hs-type">ip'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121951"><span class="hs-identifier hs-type">problem'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121957"><span class="hs-identifier hs-type">target''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121626"><span class="hs-identifier hs-type">psplit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121627"><span class="hs-identifier hs-type">ixsplit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682121842"><span class="hs-identifier hs-type">ixs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">12</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-1565"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;new problem from rest&quot;</span></span><span>
</span><span id="line-1566"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1567"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;delta'  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-type">st'</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-type">lhsTel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;eqs'    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-type">st'</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-type">lhsTel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-type">st'</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsProblem"><span class="hs-identifier hs-type">lhsProblem</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#problemEqs"><span class="hs-identifier hs-type">problemEqs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1569"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ip'     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-type">st'</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsTel"><span class="hs-identifier hs-type">lhsTel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-type">st'</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.Problem.html#lhsOutPat"><span class="hs-identifier hs-type">lhsOutPat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1571"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1572"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682121973"><span class="hs-identifier hs-type">st'</span></a></span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span class="annot"><span class="hs-comment">-- | Ensures that we are not performing pattern matching on coinductive constructors.</span></span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span id="local-6989586621682118172"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkMatchingAllowed"><span class="hs-identifier hs-type">checkMatchingAllowed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118172"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ The name of the data or record type the constructor belongs to.</span></span><span>
</span><span id="line-1579"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#DataOrRecord"><span class="hs-identifier hs-type">DataOrRecord</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Information about data or (co)inductive (no-)eta-equality record.</span></span><span>
</span><span id="line-1580"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118172"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1581"></span><span id="checkMatchingAllowed"><span class="annot"><span class="annottext">checkMatchingAllowed :: forall (m :: * -&gt; *).
MonadTCError m =&gt;
QName -&gt; DataOrRecord -&gt; m ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkMatchingAllowed"><span class="hs-identifier hs-var hs-var">checkMatchingAllowed</span></a></span></span><span> </span><span id="local-6989586621682122000"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122000"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1582"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#IsRecord"><span class="hs-identifier hs-type">IsRecord</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InductionAndEta"><span class="hs-identifier hs-type">InductionAndEta</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recordInduction :: InductionAndEta -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#recordInduction"><span class="hs-identifier hs-var">recordInduction</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682122003"><span class="annot"><span class="annottext">Maybe Induction
</span><a href="#local-6989586621682122003"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recordEtaEquality :: InductionAndEta -&gt; EtaEquality
</span><a href="Agda.TypeChecking.Monad.Base.html#recordEtaEquality"><span class="hs-identifier hs-var">recordEtaEquality</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682122005"><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682122005"><span class="hs-identifier hs-var">eta</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1583"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.Aspect.html#CoInductive"><span class="hs-identifier hs-var">CoInductive</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Induction
</span><a href="#local-6989586621682122003"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnCoinductive"><span class="hs-identifier hs-var">SplitOnCoinductive</span></a></span><span>
</span><span id="line-1584"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EtaEquality -&gt; Bool
forall a. PatternMatchingAllowed a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#patternMatchingAllowed"><span class="hs-identifier hs-var">patternMatchingAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682122005"><span class="hs-identifier hs-var">eta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; TypeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnNonEtaRecord"><span class="hs-identifier hs-var">SplitOnNonEtaRecord</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122000"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1585"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1586"></span><span>  </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="Agda.Syntax.Internal.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1587"></span><span>
</span><span id="line-1588"></span><span class="hs-comment">-- | When working with a monad @m@ implementing @MonadTCM@ and @MonadError TCErr@,</span><span>
</span><span id="line-1589"></span><span class="hs-comment">--   @suspendErrors f@ performs the TCM action @f@ but catches any errors and throws</span><span>
</span><span id="line-1590"></span><span class="hs-comment">--   them in the monad @m@ instead.</span><span>
</span><span id="line-1591"></span><span id="local-6989586621682118115"><span id="local-6989586621682118116"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#suspendErrors"><span class="hs-identifier hs-type">suspendErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118115"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118115"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118116"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118115"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118116"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1592"></span><span id="suspendErrors"><span class="annot"><span class="annottext">suspendErrors :: forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m) =&gt;
TCM a -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#suspendErrors"><span class="hs-identifier hs-var hs-var">suspendErrors</span></a></span></span><span> </span><span id="local-6989586621682122020"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682122020"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1593"></span><span>  </span><span id="local-6989586621682122021"><span class="annot"><a href="#local-6989586621682122021"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Either TCErr a) -&gt; m (Either TCErr a)
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Either TCErr a) -&gt; m (Either TCErr a))
-&gt; TCM (Either TCErr a) -&gt; m (Either TCErr a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either TCErr a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either TCErr a) -&gt; TCM a -&gt; TCM (Either TCErr a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682122020"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM (Either TCErr a)
-&gt; (TCErr -&gt; TCM (Either TCErr a)) -&gt; TCM (Either TCErr a)
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either TCErr a -&gt; TCM (Either TCErr a)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either TCErr a -&gt; TCM (Either TCErr a))
-&gt; (TCErr -&gt; Either TCErr a) -&gt; TCErr -&gt; TCM (Either TCErr a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; Either TCErr a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682122021"><span class="hs-identifier hs-type">ok</span></a></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="hs-comment">-- | A more direct implementation of the specification</span><span>
</span><span id="line-1597"></span><span class="hs-comment">--   @softTypeError err == suspendErrors (typeError err)@</span><span>
</span><span id="line-1598"></span><span id="local-6989586621682118108"><span id="local-6989586621682118109"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-type">softTypeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118108"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118108"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCEnv"><span class="hs-identifier hs-type">MonadTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118108"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118108"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118109"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1599"></span><span id="softTypeError"><span class="annot"><span class="annottext">softTypeError :: forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var hs-var">softTypeError</span></a></span></span><span> </span><span id="local-6989586621682122034"><span class="annot"><span class="annottext">TypeError
</span><a href="#local-6989586621682122034"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CallStack -&gt; m a) -&gt; m a
forall b. HasCallStack =&gt; (CallStack -&gt; b) -&gt; b
</span><a href="Agda.Utils.CallStack.Base.html#withCallerCallStack"><span class="hs-identifier hs-var">withCallerCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">((CallStack -&gt; m a) -&gt; m a) -&gt; (CallStack -&gt; m a) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682122035"><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621682122035"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1600"></span><span>  </span><span class="annot"><span class="annottext">TCErr -&gt; m a
forall a. TCErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(TCErr -&gt; m a) -&gt; m TCErr -&gt; m a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; TypeError -&gt; m TCErr
forall (m :: * -&gt; *) a.
MonadTCError m =&gt;
CallStack -&gt; TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError%27"><span class="hs-identifier hs-var">typeError'</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621682122035"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="#local-6989586621682122034"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span class="hs-comment">-- | A convenient alias for @liftTCM . typeError@. Throws the error directly</span><span>
</span><span id="line-1603"></span><span class="hs-comment">--   in the TCM even if there is a surrounding monad also implementing</span><span>
</span><span id="line-1604"></span><span class="hs-comment">--   @MonadError TCErr@.</span><span>
</span><span id="line-1605"></span><span id="local-6989586621682118117"><span id="local-6989586621682118118"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-type">hardTypeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118117"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118117"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118118"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1606"></span><span id="hardTypeError"><span class="annot"><span class="annottext">hardTypeError :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var hs-var">hardTypeError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CallStack -&gt; TypeError -&gt; m a) -&gt; TypeError -&gt; m a
forall b. HasCallStack =&gt; (CallStack -&gt; b) -&gt; b
</span><a href="Agda.Utils.CallStack.Base.html#withCallerCallStack"><span class="hs-identifier hs-var">withCallerCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">((CallStack -&gt; TypeError -&gt; m a) -&gt; TypeError -&gt; m a)
-&gt; (CallStack -&gt; TypeError -&gt; m a) -&gt; TypeError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682122043"><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621682122043"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; m a
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; m a) -&gt; (TypeError -&gt; TCM a) -&gt; TypeError -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; TypeError -&gt; TCM a
forall (m :: * -&gt; *) a.
MonadTCError m =&gt;
CallStack -&gt; TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError%27"><span class="hs-identifier hs-var">typeError'</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621682122043"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1607"></span><span>
</span><span id="line-1608"></span><span class="hs-keyword">type</span><span> </span><span id="DataOrRecord"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#DataOrRecord"><span class="hs-identifier hs-var">DataOrRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DataOrRecord%27"><span class="hs-identifier hs-type">DataOrRecord'</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InductionAndEta"><span class="hs-identifier hs-type">InductionAndEta</span></a></span><span>
</span><span id="line-1609"></span><span>
</span><span id="line-1610"></span><span class="hs-comment">-- | Check if the type is a data or record type and return its name,</span><span>
</span><span id="line-1611"></span><span class="hs-comment">--   definition, sort, parameters, and indices. Fails softly if the type could become</span><span>
</span><span id="line-1612"></span><span class="hs-comment">--   a data/record type by instantiating a variable/metavariable, or fail hard</span><span>
</span><span id="line-1613"></span><span class="hs-comment">--   otherwise.</span><span>
</span><span id="line-1614"></span><span id="local-6989586621682118171"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#isDataOrRecordType"><span class="hs-identifier hs-type">isDataOrRecordType</span></a></span><span>
</span><span id="line-1615"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118171"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118171"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118171"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#DataOrRecord"><span class="hs-identifier hs-type">DataOrRecord</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1618"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ The 'Args' are parameters and indices.</span></span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span id="isDataOrRecordType"><span class="annot"><span class="annottext">isDataOrRecordType :: forall (m :: * -&gt; *).
(MonadTCM m, PureTCM m) =&gt;
Type
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
</span><a href="Agda.TypeChecking.Rules.LHS.html#isDataOrRecordType"><span class="hs-identifier hs-var hs-var">isDataOrRecordType</span></a></span></span><span> </span><span id="local-6989586621682122173"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122173"><span class="hs-identifier hs-var">a0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; (Blocker
    -&gt; Type
    -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; (NotBlocked
    -&gt; Type
    -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122173"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
-&gt; Type
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
</span><a href="#local-6989586621682122175"><span class="hs-identifier hs-var">blocked</span></a></span><span> </span><span class="annot"><span class="annottext">((NotBlocked
  -&gt; Type
  -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; (NotBlocked
    -&gt; Type
    -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1621"></span><span>  </span><span class="annot"><span class="annottext">NotBlocked
</span><a href="Agda.Syntax.Internal.Blockers.html#ReallyNotBlocked"><span class="hs-identifier hs-var">ReallyNotBlocked</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682122177"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122177"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122177"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1622"></span><span>
</span><span id="line-1623"></span><span>    </span><span class="hs-comment">-- Subcase: split type is a Def.</span><span>
</span><span id="line-1624"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682122178"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122178"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122179"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682122179"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Definition -&gt; ExceptT TCErr m Definition
forall a. TCM a -&gt; ExceptT TCErr m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122178"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m Definition
-&gt; (Definition
    -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a b.
ExceptT TCErr m a -&gt; (a -&gt; ExceptT TCErr m b) -&gt; ExceptT TCErr m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682122180"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682122180"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682122180"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataPars :: Defn -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#dataPars"><span class="hs-identifier hs-var">dataPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682122183"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682122183"><span class="hs-identifier hs-var">np</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dataSort :: Defn -&gt; Sort' Term
</span><a href="Agda.TypeChecking.Monad.Base.html#dataSort"><span class="hs-identifier hs-var">dataSort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682122185"><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682122185"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span>        </span><span class="annot"><span class="annottext">ExceptT TCErr m Bool -&gt; ExceptT TCErr m () -&gt; ExceptT TCErr m ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExceptT TCErr m Bool
forall (m :: * -&gt; *). (MonadTCM m, MonadReduce m) =&gt; Type -&gt; m Bool
</span><a href="Agda.TypeChecking.Telescope.Path.html#isInterval"><span class="hs-identifier hs-var">isInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122177"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr m () -&gt; ExceptT TCErr m ())
-&gt; ExceptT TCErr m () -&gt; ExceptT TCErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ExceptT TCErr m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ExceptT TCErr m ())
-&gt; ExceptT TCErr m TypeError -&gt; ExceptT TCErr m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1629"></span><span>
</span><span id="line-1630"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122188"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122188"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122189"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122189"><span class="hs-identifier hs-var">ixs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Args -&gt; (Args, Args)
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682122183"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; (Args, Args)) -&gt; Args -&gt; (Args, Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682122179"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1631"></span><span>        </span><span class="annot"><span class="annottext">(DataOrRecord, QName, Sort' Term, Args, Args)
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. a -&gt; ExceptT TCErr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataOrRecord
forall p. DataOrRecord' p
</span><a href="Agda.Syntax.Internal.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122178"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682122185"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122188"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122189"><span class="hs-identifier hs-var">ixs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span> </span><span id="local-6989586621682122192"><span class="annot"><span class="annottext">Maybe Induction
recInduction :: Maybe Induction
recInduction :: Defn -&gt; Maybe Induction
</span><a href="#local-6989586621682122192"><span class="hs-identifier hs-var hs-var">recInduction</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122194"><span class="annot"><span class="annottext">EtaEquality
recEtaEquality' :: EtaEquality
recEtaEquality' :: Defn -&gt; EtaEquality
</span><a href="#local-6989586621682122194"><span class="hs-identifier hs-var hs-var">recEtaEquality'</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1634"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122196"><span class="annot"><span class="annottext">pars :: Args
</span><a href="#local-6989586621682122196"><span class="hs-identifier hs-var hs-var hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682122179"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-1635"></span><span>        </span><span id="local-6989586621682122197"><span class="annot"><a href="#local-6989586621682122197"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ExceptT TCErr m (Sort' Term)
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m, MonadError TCErr m) =&gt;
Type -&gt; m (Sort' Term)
</span><a href="Agda.TypeChecking.Sort.html#shouldBeSort"><span class="hs-identifier hs-var">shouldBeSort</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ExceptT TCErr m (Sort' Term))
-&gt; ExceptT TCErr m Type -&gt; ExceptT TCErr m (Sort' Term)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682122180"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Args -&gt; ExceptT TCErr m Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; a -&gt; m Type
forall (m :: * -&gt; *).
(MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; Args -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-operator hs-var">`piApplyM`</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122196"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-1636"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#IsRecord"><span class="hs-identifier hs-type">IsRecord</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InductionAndEta"><span class="hs-identifier hs-type">InductionAndEta</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#recordInduction"><span class="hs-identifier hs-var">recordInduction</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621682122192"><span class="hs-identifier hs-type">recInduction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#recordEtaEquality"><span class="hs-identifier hs-var">recordEtaEquality</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621682122194"><span class="hs-identifier hs-type">recEtaEquality'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122178"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122197"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122196"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>
</span><span id="line-1638"></span><span>      </span><span class="hs-comment">-- Issue #2253: the data type could be abstract.</span><span>
</span><span id="line-1639"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnAbstract"><span class="hs-identifier hs-var">SplitOnAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122178"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1640"></span><span>
</span><span id="line-1641"></span><span>      </span><span class="hs-comment">-- the type could be an axiom</span><span>
</span><span id="line-1642"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span>      </span><span class="hs-comment">-- Can't match before we have the definition</span><span>
</span><span id="line-1645"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitOnUnchecked"><span class="hs-identifier hs-var">SplitOnUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122178"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>      </span><span class="hs-comment">-- Issue #2997: the type could be a Def that does not reduce for some reason</span><span>
</span><span id="line-1648"></span><span>      </span><span class="hs-comment">-- (abstract, failed termination checking, NON_TERMINATING, ...)</span><span>
</span><span id="line-1649"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1650"></span><span>
</span><span id="line-1651"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1652"></span><span>
</span><span id="line-1653"></span><span>      </span><span class="hs-comment">-- Issue #3620: Some primitives are types too.</span><span>
</span><span id="line-1654"></span><span>      </span><span class="hs-comment">-- Not data though, at least currently 11/03/2018.</span><span>
</span><span id="line-1655"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1658"></span><span>
</span><span id="line-1659"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1660"></span><span>
</span><span id="line-1661"></span><span>    </span><span class="hs-comment">-- variable: fail softly</span><span>
</span><span id="line-1662"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1663"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- That is handled in @blocked@.</span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span>    </span><span class="hs-comment">-- pi or sort: fail hard</span><span>
</span><span id="line-1666"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1667"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1668"></span><span>
</span><span id="line-1669"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1670"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1671"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1672"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1673"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1674"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span> </span><span id="local-6989586621682122216"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682122216"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadDebug m) =&gt;
String -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#__IMPOSSIBLE_VERBOSE__"><span class="hs-identifier hs-var">__IMPOSSIBLE_VERBOSE__</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682122216"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1675"></span><span>
</span><span id="line-1676"></span><span>  </span><span class="hs-comment">-- neutral type: fail softly</span><span>
</span><span id="line-1677"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#StuckOn"><span class="hs-identifier hs-type">StuckOn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682122219"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122219"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1678"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#AbsurdMatch"><span class="hs-identifier hs-type">AbsurdMatch</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682122221"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122221"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1679"></span><span>
</span><span id="line-1680"></span><span>  </span><span class="hs-comment">-- missing clauses: fail hard</span><span>
</span><span id="line-1681"></span><span>  </span><span class="hs-comment">-- TODO: postpone checking of the whole clause until later?</span><span>
</span><span id="line-1682"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-type">MissingClauses</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682122223"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122223"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCM m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#hardTypeError"><span class="hs-identifier hs-var">hardTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var">notData</span></a></span><span>
</span><span id="line-1683"></span><span>
</span><span id="line-1684"></span><span>  </span><span class="hs-comment">-- underapplied type: should not happen</span><span>
</span><span id="line-1685"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-type">Underapplied</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1686"></span><span>
</span><span id="line-1687"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1688"></span><span>  </span><span id="local-6989586621682122187"><span class="annot"><span class="annottext">notData :: ExceptT TCErr m TypeError
</span><a href="#local-6989586621682122187"><span class="hs-identifier hs-var hs-var">notData</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM TypeError -&gt; ExceptT TCErr m TypeError
forall a. TCM a -&gt; ExceptT TCErr m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM TypeError -&gt; ExceptT TCErr m TypeError)
-&gt; TCM TypeError -&gt; ExceptT TCErr m TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SplitError -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitError"><span class="hs-identifier hs-var">SplitError</span></a></span><span> </span><span class="annot"><span class="annottext">(SplitError -&gt; TypeError)
-&gt; (Closure Type -&gt; SplitError) -&gt; Closure Type -&gt; TypeError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Closure Type -&gt; SplitError
</span><a href="Agda.TypeChecking.Monad.Base.html#NotADatatype"><span class="hs-identifier hs-var">NotADatatype</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Type -&gt; TypeError)
-&gt; TCMT IO (Closure Type) -&gt; TCM TypeError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Closure Type)
forall (m :: * -&gt; *) a.
(MonadTCEnv m, ReadTCState m) =&gt;
a -&gt; m (Closure a)
</span><a href="Agda.TypeChecking.Monad.Base.html#buildClosure"><span class="hs-identifier hs-var">buildClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122173"><span class="hs-identifier hs-var">a0</span></a></span><span>
</span><span id="line-1689"></span><span>  </span><span id="local-6989586621682122175"><span class="annot"><span class="annottext">blocked :: Blocker
-&gt; Type
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
</span><a href="#local-6989586621682122175"><span class="hs-identifier hs-var hs-var">blocked</span></a></span></span><span> </span><span id="local-6989586621682122227"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122227"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682122228"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122228"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError
 -&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args))
-&gt; ExceptT TCErr m TypeError
-&gt; ExceptT TCErr m (DataOrRecord, QName, Sort' Term, Args, Args)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">TCM TypeError -&gt; ExceptT TCErr m TypeError
forall a. TCM a -&gt; ExceptT TCErr m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM TypeError -&gt; ExceptT TCErr m TypeError)
-&gt; TCM TypeError -&gt; ExceptT TCErr m TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SplitError -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitError"><span class="hs-identifier hs-var">SplitError</span></a></span><span> </span><span class="annot"><span class="annottext">(SplitError -&gt; TypeError)
-&gt; (Closure Type -&gt; SplitError) -&gt; Closure Type -&gt; TypeError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Closure Type -&gt; SplitError
</span><a href="Agda.TypeChecking.Monad.Base.html#BlockedType"><span class="hs-identifier hs-var">BlockedType</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122227"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Type -&gt; TypeError)
-&gt; TCMT IO (Closure Type) -&gt; TCM TypeError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Closure Type)
forall (m :: * -&gt; *) a.
(MonadTCEnv m, ReadTCState m) =&gt;
a -&gt; m (Closure a)
</span><a href="Agda.TypeChecking.Monad.Base.html#buildClosure"><span class="hs-identifier hs-var">buildClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122173"><span class="hs-identifier hs-var">a0</span></a></span><span>
</span><span id="line-1690"></span><span>
</span><span id="line-1691"></span><span class="hs-comment">-- | Get the constructor of the given record type together with its type.</span><span>
</span><span id="line-1692"></span><span class="hs-comment">--   Throws an error if the type is not a record type.</span><span>
</span><span id="line-1693"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#getRecordConstructor"><span class="hs-identifier hs-type">getRecordConstructor</span></a></span><span>
</span><span id="line-1694"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Name @d@ of the record type</span></span><span>
</span><span id="line-1695"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Parameters @pars@ of the record type</span></span><span>
</span><span id="line-1696"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ The record type @Def d pars@ (for error reporting)</span></span><span>
</span><span id="line-1697"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span id="getRecordConstructor"><span class="annot"><span class="annottext">getRecordConstructor :: QName -&gt; Args -&gt; Type -&gt; TCM (ConHead, Type)
</span><a href="Agda.TypeChecking.Rules.LHS.html#getRecordConstructor"><span class="hs-identifier hs-var hs-var">getRecordConstructor</span></a></span></span><span> </span><span id="local-6989586621682122230"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122230"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122231"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122231"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span id="local-6989586621682122232"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122232"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1699"></span><span>  </span><span id="local-6989586621682122233"><span class="annot"><a href="#local-6989586621682122233"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Defn) -&gt; TCMT IO Definition -&gt; TCMT IO Defn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122230"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Defn -&gt; (Defn -&gt; TCMT IO ConHead) -&gt; TCMT IO ConHead
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1700"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">recConHead :: Defn -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#recConHead"><span class="hs-identifier hs-var">recConHead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682122235"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682122235"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; TCMT IO ConHead
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConHead -&gt; TCMT IO ConHead) -&gt; ConHead -&gt; TCMT IO ConHead
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KillRangeT ConHead
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682122235"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1701"></span><span>    </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ConHead
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO ConHead) -&gt; TypeError -&gt; TCMT IO ConHead
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ShouldBeRecordType"><span class="hs-identifier hs-var">ShouldBeRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122232"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1702"></span><span>  </span><span id="local-6989586621682122238"><span class="annot"><a href="#local-6989586621682122238"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`piApply`</span></span><span> </span><span class="annot"><span class="hs-identifier">pars</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122233"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1703"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682122233"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122238"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1704"></span><span>
</span><span id="line-1705"></span><span>
</span><span id="line-1706"></span><span class="hs-comment">-- | Disambiguate a projection based on the record type it is supposed to be</span><span>
</span><span id="line-1707"></span><span class="hs-comment">--   projecting from. Returns the unambiguous projection name and its type.</span><span>
</span><span id="line-1708"></span><span class="hs-comment">--   Throws an error if the type is not a record type.</span><span>
</span><span id="line-1709"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateProjection"><span class="hs-identifier hs-type">disambiguateProjection</span></a></span><span>
</span><span id="line-1710"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Hiding"><span class="hs-identifier hs-type">Hiding</span></a></span><span>   </span><span class="hs-comment">-- ^ Hiding info of the projection's principal argument.</span><span>
</span><span id="line-1711"></span><span>                    </span><span class="hs-comment">--   @Nothing@ if 'Postfix' projection.</span><span>
</span><span id="line-1712"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbiguousQName"><span class="hs-identifier hs-type">AmbiguousQName</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Name of the projection to be disambiguated.</span></span><span>
</span><span id="line-1713"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Record type we are projecting from.</span></span><span>
</span><span id="line-1714"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1715"></span><span>       </span><span class="hs-comment">-- ^ @Bool@ signifies whether copattern matching is allowed at</span><span>
</span><span id="line-1716"></span><span>       </span><span class="hs-comment">--   the inferred record type.</span><span>
</span><span id="line-1717"></span><span id="disambiguateProjection"><span class="annot"><span class="annottext">disambiguateProjection :: Maybe Hiding
-&gt; AmbiguousQName
-&gt; Arg Type
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateProjection"><span class="hs-identifier hs-var hs-var">disambiguateProjection</span></a></span></span><span> </span><span id="local-6989586621682122239"><span class="annot"><span class="annottext">Maybe Hiding
</span><a href="#local-6989586621682122239"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682122240"><span class="annot"><span class="annottext">ambD :: AmbiguousQName
</span><a href="#local-6989586621682122240"><span class="hs-identifier hs-var">ambD</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbQ"><span class="hs-identifier hs-type">AmbQ</span></a></span><span> </span><span id="local-6989586621682122242"><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122242"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682122243"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682122243"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-comment">-- If the target is not a record type, that's an error.</span><span>
</span><span id="line-1719"></span><span>  </span><span class="hs-comment">-- It could be a meta, but since we cannot postpone lhs checking, we crash here.</span><span>
</span><span id="line-1720"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
-&gt; (Blocked Type -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; ((QName, Args, RecordData)
    -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
m (Either a b) -&gt; (a -&gt; m c) -&gt; (b -&gt; m c) -&gt; m c
</span><a href="Agda.Utils.Either.html#caseEitherM"><span class="hs-identifier hs-var">caseEitherM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
-&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
forall a. TCM a -&gt; TCM a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
 -&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
-&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
forall (m :: * -&gt; *).
PureTCM m =&gt;
Type -&gt; m (Either (Blocked Type) (QName, Args, RecordData))
</span><a href="Agda.TypeChecking.Records.html#tryRecordType"><span class="hs-identifier hs-var">tryRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData)))
-&gt; Type
-&gt; TCMT IO (Either (Blocked Type) (QName, Args, RecordData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Type
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682122243"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocked Type -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122246"><span class="hs-identifier hs-var">notRecord</span></a></span><span>
</span><span id="line-1721"></span><span>    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122247"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122247"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122248"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122248"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RecordData"><span class="hs-identifier hs-type">RecordData</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_recFields :: RecordData -&gt; [Dom' Term QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#_recFields"><span class="hs-identifier hs-var">_recFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682122251"><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122251"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_recInduction :: RecordData -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#_recInduction"><span class="hs-identifier hs-var">_recInduction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682122253"><span class="annot"><span class="annottext">Maybe Induction
</span><a href="#local-6989586621682122253"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_recEtaEquality' :: RecordData -&gt; EtaEquality
</span><a href="Agda.TypeChecking.Monad.Base.html#_recEtaEquality%27"><span class="hs-identifier hs-var">_recEtaEquality'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682122255"><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682122255"><span class="hs-identifier hs-var">eta</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1722"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1723"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;we are of record type r  = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO Doc
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122247"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1724"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;applied to parameters vs = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Args -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122248"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1725"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;and have fields       fs = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO Doc
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg QName] -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg QName] -&gt; Doc) -&gt; [Arg QName] -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom' Term QName -&gt; Arg QName) -&gt; [Dom' Term QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122251"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1726"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1727"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122257"><span class="annot"><span class="annottext">comatching :: Bool
</span><a href="#local-6989586621682122257"><span class="hs-identifier hs-var hs-var">comatching</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Induction
</span><a href="#local-6989586621682122253"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Induction -&gt; Maybe Induction -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Induction -&gt; Maybe Induction
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.Aspect.html#CoInductive"><span class="hs-identifier hs-var">CoInductive</span></a></span><span>
</span><span id="line-1728"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">EtaEquality -&gt; Bool
forall a. CopatternMatchingAllowed a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#copatternMatchingAllowed"><span class="hs-identifier hs-var">copatternMatchingAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">EtaEquality
</span><a href="#local-6989586621682122255"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-1729"></span><span>      </span><span class="hs-comment">-- Try the projection candidates.</span><span>
</span><span id="line-1730"></span><span>      </span><span class="hs-comment">-- First, we try to find a disambiguation that doesn't produce</span><span>
</span><span id="line-1731"></span><span>      </span><span class="hs-comment">-- any new constraints.</span><span>
</span><span id="line-1732"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [Dom' Term QName]
-&gt; QName
-&gt; Args
-&gt; Bool
-&gt; (([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
    -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122259"><span class="hs-identifier hs-var">tryDisambiguate</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122251"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122247"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122248"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122257"><span class="hs-identifier hs-var">comatching</span></a></span><span> </span><span class="annot"><span class="annottext">((([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
  -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
 -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; (([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
    -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1733"></span><span>          </span><span class="hs-comment">-- If this fails, we try again with constraints, but we require</span><span>
</span><span id="line-1734"></span><span>          </span><span class="hs-comment">-- the solution to be unique.</span><span>
</span><span id="line-1735"></span><span>          </span><span class="annot"><span class="annottext">Bool
-&gt; [Dom' Term QName]
-&gt; QName
-&gt; Args
-&gt; Bool
-&gt; (([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
    -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122259"><span class="hs-identifier hs-var">tryDisambiguate</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122251"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122247"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122248"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122257"><span class="hs-identifier hs-var">comatching</span></a></span><span> </span><span class="annot"><span class="annottext">((([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
  -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
 -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; (([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
    -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1736"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682122260"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682122260"><span class="hs-identifier hs-var">err</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682122260"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1737"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1738"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(QName, (Arg Type, ArgInfo, Maybe TCState))
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1739"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122261"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122261"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Arg Type, ArgInfo, Maybe TCState)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122262"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122262"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Arg Type, ArgInfo, Maybe TCState)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682122263"><span class="annot"><span class="annottext">[(QName, (Arg Type, ArgInfo, Maybe TCState))]
</span><a href="#local-6989586621682122263"><span class="hs-identifier hs-var">disambs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1740"></span><span>              </span><span class="annot"><span class="annottext">TypeError -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TypeError -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AmbiguousProjection"><span class="hs-identifier hs-var">AmbiguousProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122261"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 QName -&gt; TypeError) -&gt; List1 QName -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122262"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; List1 QName
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">((QName, (Arg Type, ArgInfo, Maybe TCState)) -&gt; QName)
-&gt; [(QName, (Arg Type, ArgInfo, Maybe TCState))] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(QName, (Arg Type, ArgInfo, Maybe TCState)) -&gt; QName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(QName, (Arg Type, ArgInfo, Maybe TCState))]
</span><a href="#local-6989586621682122263"><span class="hs-identifier hs-var">disambs</span></a></span><span>
</span><span id="line-1741"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1742"></span><span>    </span><span id="local-6989586621682122259"><span class="annot"><span class="annottext">tryDisambiguate :: Bool
-&gt; [Dom' Term QName]
-&gt; QName
-&gt; Args
-&gt; Bool
-&gt; (([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
    -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122259"><span class="hs-identifier hs-var hs-var">tryDisambiguate</span></a></span></span><span> </span><span id="local-6989586621682122265"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122265"><span class="hs-identifier hs-var">constraintsOk</span></a></span></span><span> </span><span id="local-6989586621682122266"><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122266"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682122267"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122267"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682122268"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122268"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682122269"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122269"><span class="hs-identifier hs-var">comatching</span></a></span></span><span> </span><span id="local-6989586621682122270"><span class="annot"><span class="annottext">([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122270"><span class="hs-identifier hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1743"></span><span>      </span><span class="hs-comment">-- Note that tryProj wraps TCM in an ExceptT, collecting errors</span><span>
</span><span id="line-1744"></span><span>      </span><span class="hs-comment">-- instead of throwing them to the user immediately.</span><span>
</span><span id="line-1745"></span><span>      </span><span id="local-6989586621682122271"><span class="annot"><a href="#local-6989586621682122271"><span class="hs-identifier hs-var">disambiguations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Either</span></span><span> </span><span class="annot"><span class="hs-identifier">TCErr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">QName</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Arg</span></span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ArgInfo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier">TCState</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1746"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName
 -&gt; TCM (Either TCErr (QName, (Arg Type, ArgInfo, Maybe TCState))))
-&gt; List1 QName
-&gt; TCM
     (List1 (Either TCErr (QName, (Arg Type, ArgInfo, Maybe TCState))))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; NonEmpty a -&gt; m (NonEmpty b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState))
-&gt; TCM (Either TCErr (QName, (Arg Type, ArgInfo, Maybe TCState)))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState))
 -&gt; TCM (Either TCErr (QName, (Arg Type, ArgInfo, Maybe TCState))))
-&gt; (QName
    -&gt; ExceptT
         TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState)))
-&gt; QName
-&gt; TCM (Either TCErr (QName, (Arg Type, ArgInfo, Maybe TCState)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [Dom' Term QName]
-&gt; QName
-&gt; Args
-&gt; QName
-&gt; ExceptT
     TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState))
</span><a href="#local-6989586621682122272"><span class="hs-identifier hs-var">tryProj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122265"><span class="hs-identifier hs-var">constraintsOk</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122266"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122267"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122268"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122242"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1747"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#partitionEithers"><span class="hs-identifier hs-type">List1.partitionEithers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122271"><span class="hs-identifier hs-type">disambiguations</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1748"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122274"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122274"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122275"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682122275"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122276"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682122276"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122277"><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122277"><span class="hs-identifier hs-var">mst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682122278"><span class="annot"><span class="annottext">[(QName, (Arg Type, ArgInfo, Maybe TCState))]
</span><a href="#local-6989586621682122278"><span class="hs-identifier hs-var">disambs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122265"><span class="hs-identifier hs-var">constraintsOk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">[(QName, (Arg Type, ArgInfo, Maybe TCState))] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(QName, (Arg Type, ArgInfo, Maybe TCState))]
</span><a href="#local-6989586621682122278"><span class="hs-identifier hs-var">disambs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1749"></span><span>          </span><span class="annot"><span class="annottext">(TCState -&gt; TCMT IO ()) -&gt; Maybe TCState -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122277"><span class="hs-identifier hs-var">mst</span></a></span><span> </span><span class="hs-comment">-- Activate state changes</span><span>
</span><span id="line-1750"></span><span>          </span><span class="hs-comment">-- From here, we have the correctly disambiguated projection.</span><span>
</span><span id="line-1751"></span><span>          </span><span class="hs-comment">-- For highlighting, we remember which name we disambiguated to.</span><span>
</span><span id="line-1752"></span><span>          </span><span class="hs-comment">-- This is safe here (fingers crossed) as we won't decide on a</span><span>
</span><span id="line-1753"></span><span>          </span><span class="hs-comment">-- different projection even if we backtrack and come here again.</span><span>
</span><span id="line-1754"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall a. TCM a -&gt; TCM a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#storeDisambiguatedProjection"><span class="hs-identifier hs-var">storeDisambiguatedProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122274"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1755"></span><span>          </span><span class="annot"><span class="annottext">(QName, Bool, QName, Arg Type, ArgInfo)
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122274"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122269"><span class="hs-identifier hs-var">comatching</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122267"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682122275"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682122276"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1756"></span><span>        </span><span id="local-6989586621682122281"><span class="annot"><span class="annottext">([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
</span><a href="#local-6989586621682122281"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
-&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122270"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">([TCErr], [(QName, (Arg Type, ArgInfo, Maybe TCState))])
</span><a href="#local-6989586621682122281"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-1757"></span><span>
</span><span id="line-1758"></span><span>    </span><span id="local-6989586621682122246"><span class="annot"><span class="annottext">notRecord :: Blocked Type -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
</span><a href="#local-6989586621682122246"><span class="hs-identifier hs-var hs-var">notRecord</span></a></span></span><span> </span><span id="local-6989586621682122282"><span class="annot"><span class="annottext">Blocked Type
</span><a href="#local-6989586621682122282"><span class="hs-identifier hs-var">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
-&gt; QName -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m, ReadTCState m) =&gt;
Maybe Blocker -&gt; QName -&gt; m a
</span><a href="#local-6989586621682122283"><span class="hs-identifier hs-var">wrongProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; Maybe Blocker
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked Type -&gt; Blocker
forall t a. Blocked' t a -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#getBlocker"><span class="hs-identifier hs-var">getBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Type
</span><a href="#local-6989586621682122282"><span class="hs-identifier hs-var">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo))
-&gt; QName -&gt; TCM (QName, Bool, QName, Arg Type, ArgInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 QName -&gt; QName
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.head</span></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122242"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1759"></span><span>
</span><span id="line-1760"></span><span>    </span><span id="local-6989586621682118266"><span id="local-6989586621682118267"><span class="annot"><a href="#local-6989586621682122283"><span class="hs-identifier hs-type">wrongProj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118266"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118266"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118266"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118266"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118267"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1761"></span><span>    </span><span id="local-6989586621682122283"><span class="annot"><span class="annottext">wrongProj :: forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m, ReadTCState m) =&gt;
Maybe Blocker -&gt; QName -&gt; m a
</span><a href="#local-6989586621682122283"><span class="hs-identifier hs-var hs-var">wrongProj</span></a></span></span><span> </span><span id="local-6989586621682122301"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122301"><span class="hs-identifier hs-var">blk</span></a></span></span><span> </span><span id="local-6989586621682122302"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122302"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m a) -&gt; m TypeError -&gt; m a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1762"></span><span>      </span><span class="annot"><span class="annottext">TCM TypeError -&gt; m TypeError
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM TypeError -&gt; m TypeError) -&gt; TCM TypeError -&gt; m TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">AmbiguousQName -&gt; Bool
</span><a href="Agda.Syntax.Abstract.Name.html#isAmbiguous"><span class="hs-identifier hs-var">isAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682122240"><span class="hs-identifier hs-var">ambD</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; Arg Type -&gt; Bool -&gt; QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotEliminateWithProjection"><span class="hs-identifier hs-var">CannotEliminateWithProjection</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122301"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682122243"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TypeError) -&gt; TCMT IO QName -&gt; TCM TypeError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO QName
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m QName
</span><a href="Agda.TypeChecking.Errors.html#dropTopLevelModule"><span class="hs-identifier hs-var">dropTopLevelModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122302"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1763"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM TypeError
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM TypeError) -&gt; TypeError -&gt; TCM TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; Arg Type -&gt; Bool -&gt; QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotEliminateWithProjection"><span class="hs-identifier hs-var">CannotEliminateWithProjection</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122301"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682122243"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122302"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1764"></span><span>
</span><span id="line-1765"></span><span>    </span><span class="annot"><a href="#local-6989586621682122272"><span class="hs-identifier hs-type">tryProj</span></a></span><span>
</span><span id="line-1766"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                 </span><span class="hs-comment">-- Are we allowed to create new constraints?</span><span>
</span><span id="line-1767"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- Fields of record type under consideration.</span><span>
</span><span id="line-1768"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="hs-comment">-- Name of record type we are eliminating.</span><span>
</span><span id="line-1769"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>                 </span><span class="hs-comment">-- Parameters of record type we are eliminating.</span><span>
</span><span id="line-1770"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                </span><span class="hs-comment">-- Candidate projection.</span><span>
</span><span id="line-1771"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1772"></span><span>           </span><span class="hs-comment">-- TCState contains possibly new constraints/meta solutions.</span><span>
</span><span id="line-1773"></span><span>    </span><span id="local-6989586621682122272"><span class="annot"><span class="annottext">tryProj :: Bool
-&gt; [Dom' Term QName]
-&gt; QName
-&gt; Args
-&gt; QName
-&gt; ExceptT
     TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState))
</span><a href="#local-6989586621682122272"><span class="hs-identifier hs-var hs-var">tryProj</span></a></span></span><span> </span><span id="local-6989586621682122305"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122305"><span class="hs-identifier hs-var">constraintsOk</span></a></span></span><span> </span><span id="local-6989586621682122306"><span class="annot"><span class="annottext">[Dom' Term QName]
</span><a href="#local-6989586621682122306"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682122307"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122307"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682122308"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122308"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682122309"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122309"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ExceptT TCErr (TCMT IO) (Maybe Projection)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe Projection)
</span><a href="Agda.TypeChecking.Monad.Signature.html#isProjection"><span class="hs-identifier hs-var">isProjection</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122309"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) (Maybe Projection)
-&gt; (Maybe Projection
    -&gt; ExceptT
         TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState)))
-&gt; ExceptT
     TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState))
forall a b.
ExceptT TCErr (TCMT IO) a
-&gt; (a -&gt; ExceptT TCErr (TCMT IO) b) -&gt; ExceptT TCErr (TCMT IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1774"></span><span>      </span><span class="hs-comment">-- Not a projection</span><span>
</span><span id="line-1775"></span><span>      </span><span class="annot"><span class="annottext">Maybe Projection
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
-&gt; QName
-&gt; ExceptT
     TCErr (TCMT IO) (QName, (Arg Type, ArgInfo, Maybe TCState))
forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m, ReadTCState m) =&gt;
Maybe Blocker -&gt; QName -&gt; m a
</span><a href="#local-6989586621682122283"><span class="hs-identifier hs-var">wrongProj</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122309"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-1776"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682122311"><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621682122311"><span class="hs-identifier hs-var">proj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1777"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122312"><span class="annot"><span class="annottext">d :: QName
</span><a href="#local-6989586621682122312"><span class="hs-identifier hs-var hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projOrig"><span class="hs-identifier hs-var">projOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621682122311"><span class="hs-identifier hs-var">proj</span></a></span><span>
</span><span id="line-1778"></span><span>
</span><span id="line-1779"></span><span>        </span><span class="hs-comment">-- Andreas, 2015-05-06 issue 1413 projProper=Nothing is not impossible</span><span>
</span><span id="line-1780"></span><span>        </span><span id="local-6989586621682122314"><span class="annot"><a href="#local-6989586621682122314"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) QName
-&gt; (QName -&gt; ExceptT TCErr (TCMT IO) QName)
-&gt; Maybe QName
-&gt; ExceptT TCErr (TCMT IO) QName
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Blocker -&gt; QName -&gt; ExceptT TCErr (TCMT IO) QName
forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m, ReadTCState m) =&gt;
Maybe Blocker -&gt; QName -&gt; m a
</span><a href="#local-6989586621682122283"><span class="hs-identifier hs-var">wrongProj</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122312"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ExceptT TCErr (TCMT IO) QName
forall a. a -&gt; ExceptT TCErr (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe QName -&gt; ExceptT TCErr (TCMT IO) QName)
-&gt; Maybe QName -&gt; ExceptT TCErr (TCMT IO) QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Projection -&gt; Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projProper"><span class="hs-identifier hs-var">projProper</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621682122311"><span class="hs-identifier hs-var">proj</span></a></span><span>
</span><span id="line-1781"></span><span>
</span><span id="line-1782"></span><span>        </span><span class="hs-comment">-- If projIndex==0, then the projection is already applied</span><span>
</span><span id="line-1783"></span><span>        </span><span class="hs-comment">-- to the record value (like in @open R r@), and then it</span><span>
</span><span id="line-1784"></span><span>        </span><span class="hs-comment">-- is no longer a projection but a record field.</span><span>
</span><span id="line-1785"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#projLams"><span class="hs-identifier hs-var">projLams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122311"><span class="hs-identifier hs-type">proj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682122283"><span class="hs-identifier hs-type">wrongProj</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682122312"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-1786"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="hs-string">&quot;we are a projection pattern&quot;</span></span><span>
</span><span id="line-1787"></span><span>        </span><span class="hs-comment">-- If the target is not a record type, that's an error.</span><span>
</span><span id="line-1788"></span><span>        </span><span class="hs-comment">-- It could be a meta, but since we cannot postpone lhs checking, we crash here.</span><span>
</span><span id="line-1789"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-1790"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;proj                  d0 = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122309"><span class="hs-identifier hs-type">d0</span></a></span><span>
</span><span id="line-1791"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;original proj         d  = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122312"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-1792"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1793"></span><span>        </span><span class="hs-comment">-- Get the field decoration.</span><span>
</span><span id="line-1794"></span><span>        </span><span class="hs-comment">-- If the projection pattern name @d@ is not a field name,</span><span>
</span><span id="line-1795"></span><span>        </span><span class="hs-comment">-- we have to try the next projection name.</span><span>
</span><span id="line-1796"></span><span>        </span><span class="hs-comment">-- If this was not an ambiguous projection, that's an error.</span><span>
</span><span id="line-1797"></span><span>        </span><span id="local-6989586621682122317"><span class="annot"><a href="#local-6989586621682122317"><span class="hs-identifier hs-var">argd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682122283"><span class="hs-identifier hs-type">wrongProj</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682122312"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">d</span></span><span> </span><span class="annot"><span class="hs-operator">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682122306"><span class="hs-identifier hs-type">fs</span></a></span><span>
</span><span id="line-1798"></span><span>
</span><span id="line-1799"></span><span>        </span><span class="hs-comment">-- Issue4998: This used to use the hiding from the principal argument, but this is not</span><span>
</span><span id="line-1800"></span><span>        </span><span class="hs-comment">-- relevant for the ArgInfo of the clause rhs. We return that separately so we can set the</span><span>
</span><span id="line-1801"></span><span>        </span><span class="hs-comment">-- correct hiding for the projection pattern in splitRest above.</span><span>
</span><span id="line-1802"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122318"><span class="annot"><a href="#local-6989586621682122318"><span class="hs-identifier hs-var hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom' Term QName -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term QName
</span><a href="#local-6989586621682122317"><span class="hs-identifier hs-var">argd</span></a></span><span>
</span><span id="line-1803"></span><span>
</span><span id="line-1804"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1805"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;original proj relevance  = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-type">getRelevance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122317"><span class="hs-identifier hs-type">argd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1806"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;original proj quantity   = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-type">getQuantity</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621682122317"><span class="hs-identifier hs-type">argd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1807"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1808"></span><span>        </span><span class="hs-comment">-- Andreas, 2016-12-31, issue #2374:</span><span>
</span><span id="line-1809"></span><span>        </span><span class="hs-comment">-- We can also disambiguate by hiding info.</span><span>
</span><span id="line-1810"></span><span>        </span><span class="hs-comment">-- Andreas, 2018-10-18, issue #3289: postfix projections have no hiding info.</span><span>
</span><span id="line-1811"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-type">caseMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122239"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#sameHiding"><span class="hs-identifier hs-type">sameHiding</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#projArgInfo"><span class="hs-identifier hs-type">projArgInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122311"><span class="hs-identifier hs-type">proj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1812"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-type">softTypeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#WrongHidingInProjection"><span class="hs-identifier hs-type">WrongHidingInProjection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122312"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span>        </span><span class="hs-comment">-- Andreas, 2016-12-31, issue #1976: Check parameters.</span><span>
</span><span id="line-1815"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122322"><span class="annot"><a href="#local-6989586621682122322"><span class="hs-identifier hs-var hs-var">chk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Args -&gt; TCMT IO ()
forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
QName -&gt; QName -&gt; Args -&gt; tcm ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkParameters"><span class="hs-identifier hs-var">checkParameters</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122314"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122307"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122308"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1816"></span><span>        </span><span id="local-6989586621682122324"><span class="annot"><a href="#local-6989586621682122324"><span class="hs-identifier hs-var">mst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#suspendErrors"><span class="hs-identifier hs-type">suspendErrors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1817"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682122305"><span class="hs-identifier hs-type">constraintsOk</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#localTCStateSaving"><span class="hs-identifier hs-type">localTCStateSaving</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122322"><span class="hs-identifier hs-type">chk</span></a></span><span>
</span><span id="line-1818"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#nonConstraining"><span class="hs-identifier hs-type">nonConstraining</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122322"><span class="hs-identifier hs-type">chk</span></a></span><span>
</span><span id="line-1819"></span><span>
</span><span id="line-1820"></span><span>        </span><span class="hs-comment">-- Get the type of projection d applied to &quot;self&quot;</span><span>
</span><span id="line-1821"></span><span>        </span><span id="local-6989586621682122328"><span class="annot"><a href="#local-6989586621682122328"><span class="hs-identifier hs-var">dType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122312"><span class="hs-identifier hs-type">d</span></a></span><span>  </span><span class="hs-comment">-- full type!</span><span>
</span><span id="line-1822"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-1823"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;we are being projected by dType = &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122328"><span class="hs-identifier hs-type">dType</span></a></span><span>
</span><span id="line-1824"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1825"></span><span>        </span><span id="local-6989586621682122329"><span class="annot"><a href="#local-6989586621682122329"><span class="hs-identifier hs-var">projType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682122328"><span class="hs-identifier hs-type">dType</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-operator hs-type">`piApplyM`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122308"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-1826"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682122309"><span class="hs-identifier hs-type">d0</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122318"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122329"><span class="hs-identifier hs-type">projType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#projArgInfo"><span class="hs-identifier hs-type">projArgInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122311"><span class="hs-identifier hs-type">proj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122324"><span class="hs-identifier hs-type">mst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1827"></span><span>
</span><span id="line-1828"></span><span class="hs-comment">-- | Disambiguate a constructor based on the data type it is supposed to be</span><span>
</span><span id="line-1829"></span><span class="hs-comment">--   constructing. Returns the unambiguous constructor name and its type.</span><span>
</span><span id="line-1830"></span><span class="hs-comment">--   Precondition: type should be a data/record type.</span><span>
</span><span id="line-1831"></span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateConstructor"><span class="hs-identifier hs-type">disambiguateConstructor</span></a></span><span>
</span><span id="line-1832"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbiguousQName"><span class="hs-identifier hs-type">AmbiguousQName</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The name of the constructor to be disambiguated.</span></span><span>
</span><span id="line-1833"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Name of the datatype.</span></span><span>
</span><span id="line-1834"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Parameters of the datatype</span></span><span>
</span><span id="line-1835"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1836"></span><span id="disambiguateConstructor"><span class="annot"><span class="annottext">disambiguateConstructor :: AmbiguousQName -&gt; QName -&gt; Args -&gt; TCM (ConHead, Type)
</span><a href="Agda.TypeChecking.Rules.LHS.html#disambiguateConstructor"><span class="hs-identifier hs-var hs-var">disambiguateConstructor</span></a></span></span><span> </span><span id="local-6989586621682122330"><span class="annot"><span class="annottext">ambC :: AmbiguousQName
</span><a href="#local-6989586621682122330"><span class="hs-identifier hs-var">ambC</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#AmbQ"><span class="hs-identifier hs-type">AmbQ</span></a></span><span> </span><span id="local-6989586621682122331"><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122331"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682122332"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122332"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122333"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122333"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1837"></span><span>  </span><span id="local-6989586621682122334"><span class="annot"><a href="#local-6989586621682122334"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO QName
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m QName
</span><a href="Agda.TypeChecking.Monad.Signature.html#canonicalName"><span class="hs-identifier hs-var">canonicalName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122332"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1838"></span><span>  </span><span id="local-6989586621682122336"><span class="annot"><a href="#local-6989586621682122336"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122334"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1839"></span><span>    </span><span id="local-6989586621682122337"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621682122337"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; TCMT IO [QName]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; TCMT IO [QName]) -&gt; [QName] -&gt; TCMT IO [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; [QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682122337"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1840"></span><span>    </span><span id="local-6989586621682122339"><span class="annot"><span class="annottext">def :: Defn
</span><a href="#local-6989586621682122339"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; TCMT IO [QName]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; TCMT IO [QName]) -&gt; [QName] -&gt; TCMT IO [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">(ConHead -&gt; QName) -&gt; ConHead -&gt; QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#recConHead"><span class="hs-identifier hs-var">recConHead</span></a></span><span> </span><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682122339"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1841"></span><span>    </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO [QName]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1842"></span><span>
</span><span id="line-1843"></span><span>  </span><span class="hs-comment">-- First, try do disambiguate with nonConstraining,</span><span>
</span><span id="line-1844"></span><span>  </span><span class="hs-comment">-- if that fails, try again allowing constraint/solution generation.</span><span>
</span><span id="line-1845"></span><span>  </span><span class="annot"><a href="#local-6989586621682122340"><span class="hs-identifier hs-type">tryDisambiguate</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621682122334"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122336"><span class="hs-identifier hs-type">cons</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1846"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; QName
-&gt; [QName]
-&gt; (([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
    -&gt; TCM (ConHead, Type))
-&gt; TCM (ConHead, Type)
</span><a href="#local-6989586621682122340"><span class="hs-identifier hs-var">tryDisambiguate</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122334"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682122336"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">((([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
  -&gt; TCM (ConHead, Type))
 -&gt; TCM (ConHead, Type))
-&gt; (([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
    -&gt; TCM (ConHead, Type))
-&gt; TCM (ConHead, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1847"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (ConHead, Type)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1848"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682122341"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682122341"><span class="hs-identifier hs-var">err</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCM (ConHead, Type)
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682122341"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1849"></span><span>        </span><span class="hs-comment">-- If all disambiguations point to the same original constructor</span><span>
</span><span id="line-1850"></span><span>        </span><span class="hs-comment">-- meaning that only the parameters may differ,</span><span>
</span><span id="line-1851"></span><span>        </span><span class="hs-comment">-- then throw more specific error.</span><span>
</span><span id="line-1852"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">List1 (QName, ConHead, (Type, Maybe TCState))
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM (ConHead, Type)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM (ConHead, Type))
-&gt; TypeError -&gt; TCM (ConHead, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CantResolveOverloadedConstructorsTargetingSameDatatype"><span class="hs-identifier hs-var">CantResolveOverloadedConstructorsTargetingSameDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122334"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122331"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1853"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCErr]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122343"><span class="annot"><span class="annottext">d0 :: List1 (QName, ConHead, (Type, Maybe TCState))
</span><a href="#local-6989586621682122343"><span class="hs-identifier hs-var">d0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682122344"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122344"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Type, Maybe TCState)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[(QName, ConHead, (Type, Maybe TCState))]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682122345"><span class="annot"><span class="annottext">List1 (QName, ConHead, (Type, Maybe TCState))
</span><a href="#local-6989586621682122345"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682122346"><span class="annot"><span class="annottext">[List1 (QName, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122346"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM (ConHead, Type)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM (ConHead, Type))
-&gt; TypeError -&gt; TCM (ConHead, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1854"></span><span>          </span><span class="annot"><span class="annottext">QName -&gt; List2 QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AmbiguousConstructor"><span class="hs-identifier hs-var">AmbiguousConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122344"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(List2 QName -&gt; TypeError) -&gt; List2 QName -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((QName, ConHead, (Type, Maybe TCState)) -&gt; QName)
-&gt; List2 (QName, ConHead, (Type, Maybe TCState)) -&gt; List2 QName
forall a b. (a -&gt; b) -&gt; List2 a -&gt; List2 b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">(ConHead -&gt; QName)
-&gt; ((QName, ConHead, (Type, Maybe TCState)) -&gt; ConHead)
-&gt; (QName, ConHead, (Type, Maybe TCState))
-&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(QName, ConHead, (Type, Maybe TCState)) -&gt; ConHead
forall a b c. (a, b, c) -&gt; b
</span><a href="Agda.Utils.Tuple.html#snd3"><span class="hs-identifier hs-var">snd3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(List2 (QName, ConHead, (Type, Maybe TCState)) -&gt; List2 QName)
-&gt; List2 (QName, ConHead, (Type, Maybe TCState)) -&gt; List2 QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List2 (List1 (QName, ConHead, (Type, Maybe TCState)))
-&gt; List2 (QName, ConHead, (Type, Maybe TCState))
forall a. List2 (List1 a) -&gt; List2 a
</span><a href="Agda.Utils.List2.html#concat21"><span class="hs-identifier hs-var">List2.concat21</span></a></span><span> </span><span class="annot"><span class="annottext">(List2 (List1 (QName, ConHead, (Type, Maybe TCState)))
 -&gt; List2 (QName, ConHead, (Type, Maybe TCState)))
-&gt; List2 (List1 (QName, ConHead, (Type, Maybe TCState)))
-&gt; List2 (QName, ConHead, (Type, Maybe TCState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (QName, ConHead, (Type, Maybe TCState))
-&gt; List1 (QName, ConHead, (Type, Maybe TCState))
-&gt; [List1 (QName, ConHead, (Type, Maybe TCState))]
-&gt; List2 (List1 (QName, ConHead, (Type, Maybe TCState)))
forall a. a -&gt; a -&gt; [a] -&gt; List2 a
</span><a href="Agda.Utils.List2.html#List2"><span class="hs-identifier hs-var">List2</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (QName, ConHead, (Type, Maybe TCState))
</span><a href="#local-6989586621682122343"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (QName, ConHead, (Type, Maybe TCState))
</span><a href="#local-6989586621682122345"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">[List1 (QName, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122346"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1855"></span><span>
</span><span id="line-1856"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1857"></span><span>    </span><span class="annot"><a href="#local-6989586621682122340"><span class="hs-identifier hs-type">tryDisambiguate</span></a></span><span>
</span><span id="line-1858"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>     </span><span class="hs-comment">-- May we constrain/solve metas to arrive at unique disambiguation?</span><span>
</span><span id="line-1859"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>    </span><span class="hs-comment">-- Data/record type.</span><span>
</span><span id="line-1860"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Its constructor(s).</span><span>
</span><span id="line-1861"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1862"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1863"></span><span>           </span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Failure continuation, taking</span><span>
</span><span id="line-1865"></span><span>                                     </span><span class="hs-comment">-- possible disambiguations</span><span>
</span><span id="line-1866"></span><span>                                     </span><span class="hs-comment">-- grouped by the original</span><span>
</span><span id="line-1867"></span><span>                                     </span><span class="hs-comment">-- constructor name in 'ConHead'.</span><span>
</span><span id="line-1868"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Unique disambiguation and its type.</span><span>
</span><span id="line-1869"></span><span>    </span><span id="local-6989586621682122340"><span class="annot"><span class="annottext">tryDisambiguate :: Bool
-&gt; QName
-&gt; [QName]
-&gt; (([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
    -&gt; TCM (ConHead, Type))
-&gt; TCM (ConHead, Type)
</span><a href="#local-6989586621682122340"><span class="hs-identifier hs-var hs-var">tryDisambiguate</span></a></span></span><span> </span><span id="local-6989586621682122350"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122350"><span class="hs-identifier hs-var">constraintsOk</span></a></span></span><span> </span><span id="local-6989586621682122351"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122351"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122352"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682122352"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621682122353"><span class="annot"><span class="annottext">([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
-&gt; TCM (ConHead, Type)
</span><a href="#local-6989586621682122353"><span class="hs-identifier hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1870"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.disamb&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[TCMT IO Doc]] -&gt; [TCMT IO Doc]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.concat</span></span><span> </span><span class="annot"><span class="annottext">([[TCMT IO Doc]] -&gt; [TCMT IO Doc])
-&gt; [[TCMT IO Doc]] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1871"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;tryDisambiguate&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1872"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122350"><span class="hs-identifier hs-var">constraintsOk</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;(allowing new constraints)&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc]
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1873"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (QName -&gt; TCMT IO Doc) -&gt; QName -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [TCMT IO Doc]) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 QName -&gt; [Item (List1 QName)]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122331"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1874"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;against&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1875"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc) -&gt; [QName] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (QName -&gt; TCMT IO Doc) -&gt; QName -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682122352"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1876"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1877"></span><span>      </span><span id="local-6989586621682122354"><span class="annot"><a href="#local-6989586621682122354"><span class="hs-identifier hs-var">disambiguations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(QName
 -&gt; TCMT IO (Either TCErr (QName, ConHead, (Type, Maybe TCState))))
-&gt; List1 QName
-&gt; TCMT
     IO
     (NonEmpty (Either TCErr (QName, ConHead, (Type, Maybe TCState))))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; NonEmpty a -&gt; m (NonEmpty b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
-&gt; TCMT IO (Either TCErr (QName, ConHead, (Type, Maybe TCState)))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
 -&gt; TCMT IO (Either TCErr (QName, ConHead, (Type, Maybe TCState))))
-&gt; (QName
    -&gt; ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState)))
-&gt; QName
-&gt; TCMT IO (Either TCErr (QName, ConHead, (Type, Maybe TCState)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [QName]
-&gt; QName
-&gt; Args
-&gt; QName
-&gt; ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
</span><a href="#local-6989586621682122355"><span class="hs-identifier hs-var">tryCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122350"><span class="hs-identifier hs-var">constraintsOk</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682122352"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122351"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122333"><span class="hs-identifier hs-var">pars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682122331"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1878"></span><span>      </span><span class="hs-comment">-- Q: can we be more lazy, like using the ListT monad?</span><span>
</span><span id="line-1879"></span><span>      </span><span class="hs-comment">-- Andreas, 2020-06-17: Not really, since we need to make sure</span><span>
</span><span id="line-1880"></span><span>      </span><span class="hs-comment">-- that only a single candidate remains, and if not,</span><span>
</span><span id="line-1881"></span><span>      </span><span class="hs-comment">-- report all alternatives in the error message.</span><span>
</span><span id="line-1882"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122356"><span class="annot"><a href="#local-6989586621682122356"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122357"><span class="annot"><a href="#local-6989586621682122357"><span class="hs-identifier hs-var">fits0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#partitionEithers"><span class="hs-identifier hs-type">List1.partitionEithers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122354"><span class="hs-identifier hs-type">disambiguations</span></a></span><span>
</span><span id="line-1883"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.disamb&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1884"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122360"><span class="annot"><a href="#local-6989586621682122360"><span class="hs-identifier hs-var hs-var">hideSt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122361"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122361"><span class="hs-identifier hs-var">c0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682122362"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682122362"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621682122363"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122363"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682122364"><span class="annot"><span class="annottext">f b
</span><a href="#local-6989586621682122364"><span class="hs-identifier hs-var">mst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122361"><span class="hs-identifier hs-var">c0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682122362"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122363"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(state change)&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; f b -&gt; f String
forall a b. a -&gt; f b -&gt; f a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">f b
</span><a href="#local-6989586621682122364"><span class="hs-identifier hs-var">mst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1885"></span><span>        </span><span class="annot"><span class="hs-string">&quot;remaining candidates: &quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621682122360"><span class="hs-identifier hs-type">hideSt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682122357"><span class="hs-identifier hs-type">fits0</span></a></span><span>
</span><span id="line-1886"></span><span>      </span><span class="annot"><a href="#local-6989586621682122365"><span class="hs-identifier hs-type">dedupCons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122357"><span class="hs-identifier hs-type">fits0</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1887"></span><span>
</span><span id="line-1888"></span><span>        </span><span class="hs-comment">-- Single candidate remains.</span><span>
</span><span id="line-1889"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122366"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122366"><span class="hs-identifier hs-var">c0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682122367"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682122367"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621682122368"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122368"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682122369"><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122369"><span class="hs-identifier hs-var">mst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1890"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.disamb&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1891"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;tryDisambiguate suceeds with&quot;</span></span><span>
</span><span id="line-1892"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122366"><span class="hs-identifier hs-var">c0</span></a></span><span>
</span><span id="line-1893"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-1894"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122368"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1895"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1896"></span><span>          </span><span class="hs-comment">-- Andreas, 2020-06-16, issue #4135</span><span>
</span><span id="line-1897"></span><span>          </span><span class="hs-comment">-- If disambiguation succeeded with new constraints/solutions,</span><span>
</span><span id="line-1898"></span><span>          </span><span class="hs-comment">-- put them into action.</span><span>
</span><span id="line-1899"></span><span>          </span><span class="annot"><span class="annottext">Maybe TCState -&gt; (TCState -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122369"><span class="hs-identifier hs-var">mst</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span>
</span><span id="line-1900"></span><span>          </span><span class="hs-comment">-- If there are multiple candidates for the constructor pattern, exactly one of</span><span>
</span><span id="line-1901"></span><span>          </span><span class="hs-comment">-- which type checks, remember our choice for highlighting info.</span><span>
</span><span id="line-1902"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AmbiguousQName -&gt; Bool
</span><a href="Agda.Syntax.Abstract.Name.html#isAmbiguous"><span class="hs-identifier hs-var">isAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousQName
</span><a href="#local-6989586621682122330"><span class="hs-identifier hs-var">ambC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall a. TCM a -&gt; TCM a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1903"></span><span>            </span><span class="annot"><span class="annottext">Induction -&gt; QName -&gt; TCMT IO ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#storeDisambiguatedConstructor"><span class="hs-identifier hs-var">storeDisambiguatedConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; Induction
</span><a href="Agda.Syntax.Internal.html#conInductive"><span class="hs-identifier hs-var">conInductive</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682122367"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122366"><span class="hs-identifier hs-var">c0</span></a></span><span>
</span><span id="line-1904"></span><span>          </span><span class="annot"><span class="annottext">(ConHead, Type) -&gt; TCM (ConHead, Type)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682122367"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122368"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1905"></span><span>
</span><span id="line-1906"></span><span>        </span><span class="hs-comment">-- Either no candidate constructor in 'cs' type checks, or multiple candidates</span><span>
</span><span id="line-1907"></span><span>        </span><span class="hs-comment">-- type check.</span><span>
</span><span id="line-1908"></span><span>        </span><span id="local-6989586621682122371"><span class="annot"><span class="annottext">[List1 (QName, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122371"><span class="hs-identifier hs-var">groups</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([TCErr], [List1 (QName, ConHead, (Type, Maybe TCState))])
-&gt; TCM (ConHead, Type)
</span><a href="#local-6989586621682122353"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TCErr]
</span><a href="#local-6989586621682122356"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[List1 (QName, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122371"><span class="hs-identifier hs-var">groups</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1909"></span><span>
</span><span id="line-1910"></span><span>    </span><span id="local-6989586621682122392"><span class="annot"><span class="annottext">abstractConstructor :: QName -&gt; m a
</span><a href="#local-6989586621682122392"><span class="hs-identifier hs-var hs-var">abstractConstructor</span></a></span></span><span> </span><span id="local-6989586621682122393"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122393"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m a) -&gt; TypeError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1911"></span><span>      </span><span class="annot"><span class="annottext">QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AbstractConstructorNotInScope"><span class="hs-identifier hs-var">AbstractConstructorNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122393"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1912"></span><span>
</span><span id="line-1913"></span><span>    </span><span id="local-6989586621682122415"><span class="annot"><span class="annottext">wrongDatatype :: QName -&gt; QName -&gt; m a
</span><a href="#local-6989586621682122415"><span class="hs-identifier hs-var hs-var">wrongDatatype</span></a></span></span><span> </span><span id="local-6989586621682122416"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122416"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682122417"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122417"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m a) -&gt; TypeError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1914"></span><span>      </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ConstructorPatternInWrongDatatype"><span class="hs-identifier hs-var">ConstructorPatternInWrongDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122416"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122417"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1915"></span><span>
</span><span id="line-1916"></span><span>    </span><span class="annot"><a href="#local-6989586621682122355"><span class="hs-identifier hs-type">tryCon</span></a></span><span>
</span><span id="line-1917"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>        </span><span class="hs-comment">-- Are we allowed to constrain metas?</span><span>
</span><span id="line-1918"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Constructors of data type under consideration.</span><span>
</span><span id="line-1919"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="hs-comment">-- Name of data/record type we are eliminating.</span><span>
</span><span id="line-1920"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>        </span><span class="hs-comment">-- Parameters of data/record type we are eliminating.</span><span>
</span><span id="line-1921"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>       </span><span class="hs-comment">-- Candidate constructor.</span><span>
</span><span id="line-1922"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1923"></span><span>           </span><span class="hs-comment">-- If this candidate succeeds, return its disambiguation</span><span>
</span><span id="line-1924"></span><span>           </span><span class="hs-comment">-- its type, and maybe the state obtained after checking it</span><span>
</span><span id="line-1925"></span><span>           </span><span class="hs-comment">-- (which may contain new constraints/solutions).</span><span>
</span><span id="line-1926"></span><span>    </span><span id="local-6989586621682122355"><span class="annot"><span class="annottext">tryCon :: Bool
-&gt; [QName]
-&gt; QName
-&gt; Args
-&gt; QName
-&gt; ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
</span><a href="#local-6989586621682122355"><span class="hs-identifier hs-var hs-var">tryCon</span></a></span></span><span> </span><span id="local-6989586621682122419"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122419"><span class="hs-identifier hs-var">constraintsOk</span></a></span></span><span> </span><span id="local-6989586621682122420"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682122420"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621682122421"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122421"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122422"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122422"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span id="local-6989586621682122423"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122423"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ExceptT TCErr (TCMT IO) (Either SigError Definition)
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Either SigError Definition)
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo%27"><span class="hs-identifier hs-var">getConstInfo'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122423"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) (Either SigError Definition)
-&gt; (Either SigError Definition
    -&gt; ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState)))
-&gt; ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
forall a b.
ExceptT TCErr (TCMT IO) a
-&gt; (a -&gt; ExceptT TCErr (TCMT IO) b) -&gt; ExceptT TCErr (TCMT IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1927"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#SigUnknown"><span class="hs-identifier hs-type">SigUnknown</span></a></span><span> </span><span id="local-6989586621682122426"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682122426"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1928"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">SigError
</span><a href="Agda.TypeChecking.Monad.Signature.html#SigCubicalNotErasure"><span class="hs-identifier hs-var">SigCubicalNotErasure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1929"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">SigError
</span><a href="Agda.TypeChecking.Monad.Signature.html#SigAbstract"><span class="hs-identifier hs-var">SigAbstract</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; ExceptT TCErr (TCMT IO) (QName, ConHead, (Type, Maybe TCState))
forall {m :: * -&gt; *} {a}.
(ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
QName -&gt; m a
</span><a href="#local-6989586621682122392"><span class="hs-identifier hs-var">abstractConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122423"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1930"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682122429"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682122429"><span class="hs-identifier hs-var">def</span></a></span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1931"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122430"><span class="annot"><span class="annottext">con :: ConHead
</span><a href="#local-6989586621682122430"><span class="hs-identifier hs-var hs-var hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#conSrcCon"><span class="hs-identifier hs-var">conSrcCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682122429"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName -&gt; ConHead
forall t u. (SetRange t, HasRange u) =&gt; t -&gt; u -&gt; t
</span><a href="Agda.Syntax.Position.html#withRangeOf"><span class="hs-operator hs-var">`withRangeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122423"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1932"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT TCErr (TCMT IO) () -&gt; ExceptT TCErr (TCMT IO) ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682122430"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682122420"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT TCErr (TCMT IO) () -&gt; ExceptT TCErr (TCMT IO) ())
-&gt; ExceptT TCErr (TCMT IO) () -&gt; ExceptT TCErr (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; ExceptT TCErr (TCMT IO) ()
forall {m :: * -&gt; *} {a}.
(ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
QName -&gt; QName -&gt; m a
</span><a href="#local-6989586621682122415"><span class="hs-identifier hs-var">wrongDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122423"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122421"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1933"></span><span>
</span><span id="line-1934"></span><span>        </span><span class="hs-comment">-- Andreas, 2013-03-22 fixing issue 279</span><span>
</span><span id="line-1935"></span><span>        </span><span class="hs-comment">-- To resolve ambiguous constructors, Agda always looks up</span><span>
</span><span id="line-1936"></span><span>        </span><span class="hs-comment">-- their original definition and reconstructs the parameters</span><span>
</span><span id="line-1937"></span><span>        </span><span class="hs-comment">-- from the type @Def d vs@ we check against.</span><span>
</span><span id="line-1938"></span><span>        </span><span class="hs-comment">-- However, the constructor could come from a module instantiation</span><span>
</span><span id="line-1939"></span><span>        </span><span class="hs-comment">-- with some of the parameters already fixed.</span><span>
</span><span id="line-1940"></span><span>        </span><span class="hs-comment">-- Agda did not make sure the two parameter lists coincide,</span><span>
</span><span id="line-1941"></span><span>        </span><span class="hs-comment">-- so we add a check here.</span><span>
</span><span id="line-1942"></span><span>        </span><span class="hs-comment">-- I guess this issue could be solved more systematically,</span><span>
</span><span id="line-1943"></span><span>        </span><span class="hs-comment">-- but the extra check here is non-invasive to the existing code.</span><span>
</span><span id="line-1944"></span><span>        </span><span class="hs-comment">-- Andreas, 2016-12-31 fixing issue #1975</span><span>
</span><span id="line-1945"></span><span>        </span><span class="hs-comment">-- Do this also for constructors which were originally ambiguous.</span><span>
</span><span id="line-1946"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122434"><span class="annot"><span class="annottext">chk :: TCMT IO ()
</span><a href="#local-6989586621682122434"><span class="hs-identifier hs-var hs-var hs-var">chk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Args -&gt; TCMT IO ()
forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
QName -&gt; QName -&gt; Args -&gt; tcm ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkConstructorParameters"><span class="hs-identifier hs-var">checkConstructorParameters</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122423"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122421"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122422"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-1947"></span><span>        </span><span id="local-6989586621682122436"><span class="annot"><a href="#local-6989586621682122436"><span class="hs-identifier hs-var">mst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe TCState) -&gt; ExceptT TCErr (TCMT IO) (Maybe TCState)
forall (m :: * -&gt; *) a.
(MonadTCM m, MonadError TCErr m) =&gt;
TCM a -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#suspendErrors"><span class="hs-identifier hs-var">suspendErrors</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe TCState) -&gt; ExceptT TCErr (TCMT IO) (Maybe TCState))
-&gt; TCM (Maybe TCState) -&gt; ExceptT TCErr (TCMT IO) (Maybe TCState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1948"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682122419"><span class="hs-identifier hs-var">constraintsOk</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Maybe TCState
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; Maybe TCState)
-&gt; (((), TCState) -&gt; TCState) -&gt; ((), TCState) -&gt; Maybe TCState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((), TCState) -&gt; TCState
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(((), TCState) -&gt; Maybe TCState)
-&gt; TCMT IO ((), TCState) -&gt; TCM (Maybe TCState)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ((), TCState)
forall a. TCM a -&gt; TCM (a, TCState)
</span><a href="Agda.TypeChecking.Monad.State.html#localTCStateSaving"><span class="hs-identifier hs-var">localTCStateSaving</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
</span><a href="#local-6989586621682122434"><span class="hs-identifier hs-var">chk</span></a></span><span>
</span><span id="line-1949"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe TCState
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe TCState -&gt; TCMT IO () -&gt; TCM (Maybe TCState)
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasOptions m, MonadConstraint m, MonadDebug m, MonadError TCErr m,
 MonadFresh ProblemId m, MonadTCEnv m, MonadWarning m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#nonConstraining"><span class="hs-identifier hs-var">nonConstraining</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
</span><a href="#local-6989586621682122434"><span class="hs-identifier hs-var">chk</span></a></span><span>
</span><span id="line-1950"></span><span>
</span><span id="line-1951"></span><span>        </span><span class="hs-comment">-- Get the type from the original constructor.</span><span>
</span><span id="line-1952"></span><span>        </span><span class="hs-comment">-- Andreas, 2020-06-17 TODO:</span><span>
</span><span id="line-1953"></span><span>        </span><span class="hs-comment">-- Couldn't we return this type from checkConstructorParameters?</span><span>
</span><span id="line-1954"></span><span>        </span><span id="local-6989586621682122437"><span class="annot"><a href="#local-6989586621682122437"><span class="hs-identifier hs-var">cType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`piApply`</span></span><span> </span><span class="annot"><span class="hs-identifier">pars</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConInfo"><span class="hs-identifier hs-type">getConInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122430"><span class="hs-identifier hs-type">con</span></a></span><span>
</span><span id="line-1955"></span><span>
</span><span id="line-1956"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682122423"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122430"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682122437"><span class="hs-identifier hs-type">cType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682122436"><span class="hs-identifier hs-type">mst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1957"></span><span>
</span><span id="line-1958"></span><span>    </span><span class="hs-comment">-- This deduplication identifies different names of the same</span><span>
</span><span id="line-1959"></span><span>    </span><span class="hs-comment">-- constructor, ensuring that the &quot;ambiguous constructor&quot; error</span><span>
</span><span id="line-1960"></span><span>    </span><span class="hs-comment">-- does not fire for the case described in #4130.</span><span>
</span><span id="line-1961"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1962"></span><span>    </span><span class="hs-comment">-- Andreas, 2020-06-17, issue #4135:</span><span>
</span><span id="line-1963"></span><span>    </span><span class="hs-comment">-- However, we need to distinguish different occurrences</span><span>
</span><span id="line-1964"></span><span>    </span><span class="hs-comment">-- of the same original constructor if it is used</span><span>
</span><span id="line-1965"></span><span>    </span><span class="hs-comment">-- with different data parameters, as recorded in the @Type@.</span><span>
</span><span id="line-1966"></span><span>    </span><span class="annot"><a href="#local-6989586621682122365"><span class="hs-identifier hs-type">dedupCons</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1967"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682118296"><span class="annot"><a href="#local-6989586621682118296"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>       </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682118296"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1968"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682118296"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCState"><span class="hs-identifier hs-type">TCState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1969"></span><span>    </span><span id="local-6989586621682122365"><span class="annot"><span class="annottext">dedupCons :: forall a.
[(a, ConHead, (Type, Maybe TCState))]
-&gt; TCM [List1 (a, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122365"><span class="hs-identifier hs-var hs-var">dedupCons</span></a></span></span><span> </span><span id="local-6989586621682122444"><span class="annot"><span class="annottext">[(a, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122444"><span class="hs-identifier hs-var">cands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1970"></span><span>      </span><span class="hs-comment">-- Group candidates by original constructor name.</span><span>
</span><span id="line-1971"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122445"><span class="annot"><span class="annottext">groups :: [NonEmpty (a, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122445"><span class="hs-identifier hs-var hs-var">groups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, ConHead, (Type, Maybe TCState)) -&gt; QName)
-&gt; [(a, ConHead, (Type, Maybe TCState))]
-&gt; [NonEmpty (a, ConHead, (Type, Maybe TCState))]
forall (f :: * -&gt; *) b a.
(Foldable f, Eq b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [NonEmpty a]
</span><span class="hs-identifier hs-var">List1.groupWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">(ConHead -&gt; QName)
-&gt; ((a, ConHead, (Type, Maybe TCState)) -&gt; ConHead)
-&gt; (a, ConHead, (Type, Maybe TCState))
-&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, ConHead, (Type, Maybe TCState)) -&gt; ConHead
forall a b c. (a, b, c) -&gt; b
</span><a href="Agda.Utils.Tuple.html#snd3"><span class="hs-identifier hs-var">snd3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122444"><span class="hs-identifier hs-var">cands</span></a></span><span>
</span><span id="line-1972"></span><span>      </span><span class="hs-comment">-- Eliminate duplicates (same type) from groups.</span><span>
</span><span id="line-1973"></span><span>      </span><span class="annot"><span class="annottext">(NonEmpty (a, ConHead, (Type, Maybe TCState))
 -&gt; TCMT IO (NonEmpty (a, ConHead, (Type, Maybe TCState))))
-&gt; [NonEmpty (a, ConHead, (Type, Maybe TCState))]
-&gt; TCMT IO [NonEmpty (a, ConHead, (Type, Maybe TCState))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, ConHead, (Type, Maybe TCState))
 -&gt; (a, ConHead, (Type, Maybe TCState)) -&gt; TCMT IO Bool)
-&gt; NonEmpty (a, ConHead, (Type, Maybe TCState))
-&gt; TCMT IO (NonEmpty (a, ConHead, (Type, Maybe TCState)))
forall (m :: * -&gt; *) a.
Monad m =&gt;
(a -&gt; a -&gt; m Bool) -&gt; List1 a -&gt; m (List1 a)
</span><a href="Agda.Utils.List1.html#nubM"><span class="hs-identifier hs-var">List1.nubM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type, Maybe TCState) -&gt; (Type, Maybe TCState) -&gt; TCMT IO Bool
</span><a href="#local-6989586621682122448"><span class="hs-identifier hs-var">cmpM</span></a></span><span> </span><span class="annot"><span class="annottext">((Type, Maybe TCState) -&gt; (Type, Maybe TCState) -&gt; TCMT IO Bool)
-&gt; ((a, ConHead, (Type, Maybe TCState)) -&gt; (Type, Maybe TCState))
-&gt; (a, ConHead, (Type, Maybe TCState))
-&gt; (a, ConHead, (Type, Maybe TCState))
-&gt; TCMT IO Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(a, ConHead, (Type, Maybe TCState)) -&gt; (Type, Maybe TCState)
forall a b c. (a, b, c) -&gt; c
</span><a href="Agda.Utils.Tuple.html#thd3"><span class="hs-identifier hs-var">thd3</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NonEmpty (a, ConHead, (Type, Maybe TCState))]
</span><a href="#local-6989586621682122445"><span class="hs-identifier hs-var">groups</span></a></span><span>
</span><span id="line-1974"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1975"></span><span>      </span><span class="hs-comment">-- The types come possibly with their own state.</span><span>
</span><span id="line-1976"></span><span>      </span><span id="local-6989586621682122448"><span class="annot"><span class="annottext">cmpM :: (Type, Maybe TCState) -&gt; (Type, Maybe TCState) -&gt; TCMT IO Bool
</span><a href="#local-6989586621682122448"><span class="hs-identifier hs-var hs-var">cmpM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122465"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122465"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122466"><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122466"><span class="hs-identifier hs-var">mst1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682122467"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122467"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682122468"><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122468"><span class="hs-identifier hs-var">mst2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1977"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122469"><span class="annot"><span class="annottext">cmpTypes :: TCMT IO Bool
</span><a href="#local-6989586621682122469"><span class="hs-identifier hs-var hs-var">cmpTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO Bool
forall (m :: * -&gt; *).
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m () -&gt; m Bool
</span><a href="Agda.TypeChecking.Conversion.html#tryConversion"><span class="hs-identifier hs-var">tryConversion</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO Bool) -&gt; TCMT IO () -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Type -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalType"><span class="hs-identifier hs-var">equalType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122465"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122467"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-1978"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122466"><span class="hs-identifier hs-var">mst1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><a href="#local-6989586621682122468"><span class="hs-identifier hs-var">mst2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1979"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
</span><a href="#local-6989586621682122469"><span class="hs-identifier hs-var">cmpTypes</span></a></span><span>
</span><span id="line-1980"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682122470"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682122470"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall {a}. TCState -&gt; TCMT IO a -&gt; TCMT IO a
</span><a href="#local-6989586621682122471"><span class="hs-identifier hs-var">inState</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682122470"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
</span><a href="#local-6989586621682122469"><span class="hs-identifier hs-var">cmpTypes</span></a></span><span>
</span><span id="line-1981"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682122472"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682122472"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall {a}. TCState -&gt; TCMT IO a -&gt; TCMT IO a
</span><a href="#local-6989586621682122471"><span class="hs-identifier hs-var">inState</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682122472"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
</span><a href="#local-6989586621682122469"><span class="hs-identifier hs-var">cmpTypes</span></a></span><span>
</span><span id="line-1982"></span><span>          </span><span class="hs-comment">-- Andreas, 2020-06-17, issue #4135.</span><span>
</span><span id="line-1983"></span><span>          </span><span class="hs-comment">-- If the state has diverged into two states we give up.</span><span>
</span><span id="line-1984"></span><span>          </span><span class="hs-comment">-- For instance, one state may say `?0 := true`</span><span>
</span><span id="line-1985"></span><span>          </span><span class="hs-comment">-- and the other `?0 := false`.</span><span>
</span><span id="line-1986"></span><span>          </span><span class="hs-comment">-- The types may be both `D ?0`, which is the same</span><span>
</span><span id="line-1987"></span><span>          </span><span class="hs-comment">-- but diverges in the different states.</span><span>
</span><span id="line-1988"></span><span>          </span><span class="hs-comment">-- We do not check states for equality.</span><span>
</span><span id="line-1989"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1990"></span><span>          </span><span class="hs-comment">-- Of course, this is conservative and not maximally extensional.</span><span>
</span><span id="line-1991"></span><span>          </span><span class="hs-comment">-- We might throw an ambiguity error too eagerly,</span><span>
</span><span id="line-1992"></span><span>          </span><span class="hs-comment">-- but this can always be worked around.</span><span>
</span><span id="line-1993"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1994"></span><span>      </span><span id="local-6989586621682122471"><span class="annot"><span class="annottext">inState :: TCState -&gt; TCMT IO a -&gt; TCMT IO a
</span><a href="#local-6989586621682122471"><span class="hs-identifier hs-var hs-var">inState</span></a></span></span><span> </span><span id="local-6989586621682122477"><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682122477"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621682122478"><span class="annot"><span class="annottext">TCMT IO a
</span><a href="#local-6989586621682122478"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO a -&gt; TCMT IO a
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localTCState"><span class="hs-identifier hs-var">localTCState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO a -&gt; TCMT IO a) -&gt; TCMT IO a -&gt; TCMT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">TCState -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadTCState m =&gt; TCState -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-var">putTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState
</span><a href="#local-6989586621682122477"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TCMT IO a
</span><a href="#local-6989586621682122478"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1995"></span><span>
</span><span id="line-1996"></span><span class="hs-comment">-- | @checkConstructorParameters c d pars@ checks that the data/record type</span><span>
</span><span id="line-1997"></span><span class="hs-comment">--   behind @c@ is has initial parameters (coming e.g. from a module instantiation)</span><span>
</span><span id="line-1998"></span><span class="hs-comment">--   that coincide with an prefix of @pars@.</span><span>
</span><span id="line-1999"></span><span id="local-6989586621682122480"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkConstructorParameters"><span class="hs-identifier hs-type">checkConstructorParameters</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122480"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682122480"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2000"></span><span id="checkConstructorParameters"><span class="annot"><span class="annottext">checkConstructorParameters :: forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
QName -&gt; QName -&gt; Args -&gt; tcm ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkConstructorParameters"><span class="hs-identifier hs-var hs-var">checkConstructorParameters</span></a></span></span><span> </span><span id="local-6989586621682122488"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122488"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682122489"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122489"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122490"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122490"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2001"></span><span>  </span><span id="local-6989586621682122491"><span class="annot"><a href="#local-6989586621682122491"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO QName -&gt; tcm QName
forall a. TCM a -&gt; tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO QName -&gt; tcm QName) -&gt; TCMT IO QName -&gt; tcm QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO QName
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m QName
</span><a href="Agda.TypeChecking.Datatypes.html#getConstructorData"><span class="hs-identifier hs-var">getConstructorData</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122488"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-2002"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkParameters"><span class="hs-identifier hs-type">checkParameters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122491"><span class="hs-identifier hs-type">dc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122489"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122490"><span class="hs-identifier hs-type">pars</span></a></span><span>
</span><span id="line-2003"></span><span>
</span><span id="line-2004"></span><span class="hs-comment">-- | Check that given parameters match the parameters of the inferred</span><span>
</span><span id="line-2005"></span><span class="hs-comment">--   constructor/projection.</span><span>
</span><span id="line-2006"></span><span id="local-6989586621682118277"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkParameters"><span class="hs-identifier hs-type">checkParameters</span></a></span><span>
</span><span id="line-2007"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118277"><span class="hs-identifier hs-type">tcm</span></a></span><span>
</span><span id="line-2008"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The record/data type name of the chosen constructor/projection.</span></span><span>
</span><span id="line-2009"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The record/data type name as supplied by the type signature.</span></span><span>
</span><span id="line-2010"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ The parameters.</span></span><span>
</span><span id="line-2011"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118277"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2012"></span><span id="checkParameters"><span class="annot"><span class="annottext">checkParameters :: forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
QName -&gt; QName -&gt; Args -&gt; tcm ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkParameters"><span class="hs-identifier hs-var hs-var">checkParameters</span></a></span></span><span> </span><span id="local-6989586621682122537"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122537"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621682122538"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122538"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682122539"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122539"><span class="hs-identifier hs-var">pars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; tcm ()
forall a. TCM a -&gt; tcm a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; tcm ()) -&gt; TCMT IO () -&gt; tcm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2013"></span><span>  </span><span id="local-6989586621682122540"><span class="annot"><a href="#local-6989586621682122540"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122537"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2014"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682122540"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2015"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682122541"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122541"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span id="local-6989586621682122542"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682122542"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- compare parameters</span><span>
</span><span id="line-2016"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122543"><span class="annot"><span class="annottext">vs :: Args
</span><a href="#local-6989586621682122543"><span class="hs-identifier hs-var hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682122542"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-2017"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.lhs.split&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2018"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checkParameters&quot;</span></span><span>
</span><span id="line-2019"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;d                   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (QName -&gt; String) -&gt; QName -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122538"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2020"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;d0 (should be == d) =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (QName -&gt; String) -&gt; QName -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122541"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-2021"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;dc                  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (QName -&gt; String) -&gt; QName -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122537"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2022"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;vs                  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Args -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122543"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-2023"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;pars                =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Args -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621682122539"><span class="hs-identifier hs-var">pars</span></a></span><span>
</span><span id="line-2024"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2025"></span><span>      </span><span class="hs-comment">-- when (d0 /= d) __IMPOSSIBLE__ -- d could have extra qualification</span><span>
</span><span id="line-2026"></span><span>      </span><span id="local-6989586621682122544"><span class="annot"><a href="#local-6989586621682122544"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Type
forall (m :: * -&gt; *).
(HasConstInfo m, ReadTCState m) =&gt;
QName -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.Signature.html#typeOfConst"><span class="hs-identifier hs-var">typeOfConst</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682122538"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2027"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#compareArgs"><span class="hs-identifier hs-type">compareArgs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682122544"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122538"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682122543"><span class="hs-identifier hs-type">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682122543"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682122539"><span class="hs-identifier hs-type">pars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span id="local-6989586621682118175"><span id="local-6989586621682118176"><span id="local-6989586621682118177"><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkSortOfSplitVar"><span class="hs-identifier hs-type">checkSortOfSplitVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2031"></span><span>                        </span><span class="annot"><a href="Agda.Syntax.Internal.html#LensSort"><span class="hs-identifier hs-type">LensSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118176"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCM"><span class="hs-identifier hs-type">PrettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118176"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#LensSort"><span class="hs-identifier hs-type">LensSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118177"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#PrettyTCM"><span class="hs-identifier hs-type">PrettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682118177"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2032"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#DataOrRecord"><span class="hs-identifier hs-type">DataOrRecord</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118176"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682118177"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682118175"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-2033"></span><span id="checkSortOfSplitVar"><span class="annot"><span class="annottext">checkSortOfSplitVar :: forall (m :: * -&gt; *) a ty.
(MonadTCM m, PureTCM m, MonadError TCErr m, LensSort a,
 PrettyTCM a, LensSort ty, PrettyTCM ty) =&gt;
DataOrRecord -&gt; a -&gt; Telescope -&gt; Maybe ty -&gt; m ()
</span><a href="Agda.TypeChecking.Rules.LHS.html#checkSortOfSplitVar"><span class="hs-identifier hs-var hs-var">checkSortOfSplitVar</span></a></span></span><span> </span><span id="local-6989586621682122671"><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122671"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span id="local-6989586621682122672"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122672"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682122673"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682122673"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682122674"><span class="annot"><span class="annottext">Maybe ty
</span><a href="#local-6989586621682122674"><span class="hs-identifier hs-var">mtarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2034"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122675"><span class="annot"><span class="annottext">s :: Sort' Term
</span><a href="#local-6989586621682122675"><span class="hs-identifier hs-var hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Sort' Term
forall a. LensSort a =&gt; a -&gt; Sort' Term
</span><a href="Agda.Syntax.Internal.html#getSort"><span class="hs-identifier hs-var">getSort</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122672"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2035"></span><span>  </span><span id="local-6989586621682122676"><span class="annot"><a href="#local-6989586621682122676"><span class="hs-identifier hs-var">sa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Sort' Term) -&gt; m (Sort' Term)
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Sort' Term) -&gt; m (Sort' Term))
-&gt; TCM (Sort' Term) -&gt; m (Sort' Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; TCM (Sort' Term)
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682122675"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2036"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#sortUniv"><span class="hs-identifier hs-type">sortUniv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682122676"><span class="hs-identifier hs-type">sa</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2037"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Univ.html#UType"><span class="hs-identifier hs-type">UType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m () -&gt; m ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">m Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Options.html#isTwoLevelEnabled"><span class="hs-identifier hs-var">isTwoLevelEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621682122680"><span class="hs-identifier hs-var">checkFibrantSplit</span></a></span><span>
</span><span id="line-2038"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Univ.html#UProp"><span class="hs-identifier hs-type">UProp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621682122682"><span class="hs-identifier hs-var">checkPropSplit</span></a></span><span>
</span><span id="line-2039"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Univ.html#USSet"><span class="hs-identifier hs-type">USSet</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2040"></span><span>    </span><span class="annot"><span class="annottext">Maybe Univ
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; m TypeError -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2041"></span><span>      </span><span class="annot"><span class="annottext">TCM TypeError -&gt; m TypeError
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM TypeError -&gt; m TypeError) -&gt; TCM TypeError -&gt; m TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; Doc -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SortOfSplitVarError"><span class="hs-identifier hs-var">SortOfSplitVarError</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Blocker -&gt; Doc -&gt; TypeError)
-&gt; TCMT IO (Maybe Blocker) -&gt; TCMT IO (Doc -&gt; TypeError)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; TCMT IO (Maybe Blocker)
forall t (m :: * -&gt; *).
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; m (Maybe Blocker)
</span><a href="Agda.TypeChecking.Reduce.html#isBlocked"><span class="hs-identifier hs-var">isBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682122676"><span class="hs-identifier hs-var">sa</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Doc -&gt; TypeError) -&gt; TCMT IO Doc -&gt; TCM TypeError
forall a b. TCMT IO (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-2042"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Cannot split on datatype in sort&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sort' Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Sort' Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Sort' Term
</span><a href="#local-6989586621682122675"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2043"></span><span>
</span><span id="line-2044"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2045"></span><span>    </span><span id="local-6989586621682122682"><span class="annot"><span class="annottext">checkPropSplit :: m ()
</span><a href="#local-6989586621682122682"><span class="hs-identifier hs-var hs-var">checkPropSplit</span></a></span></span><span>
</span><span id="line-2046"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IsRecord"><span class="hs-identifier hs-type">IsRecord</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InductionAndEta"><span class="hs-identifier hs-type">InductionAndEta</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recordInduction :: InductionAndEta -&gt; Maybe Induction
</span><a href="Agda.TypeChecking.Monad.Base.html#recordInduction"><span class="hs-identifier hs-var">recordInduction</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Maybe Induction
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122671"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2047"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682122685"><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122685"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ty
</span><a href="#local-6989586621682122674"><span class="hs-identifier hs-var">mtarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2048"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.sort.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;target prop:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ty -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ty -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122685"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-2049"></span><span>        </span><span class="annot"><span class="annottext">ty -&gt; m ()
</span><a href="#local-6989586621682122686"><span class="hs-identifier hs-var">checkIsProp</span></a></span><span> </span><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122685"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-2050"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2051"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.sort.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;no target prop&quot;</span></span><span>
</span><span id="line-2052"></span><span>          </span><span class="annot"><span class="annottext">DataOrRecord -&gt; m ()
forall {m :: * -&gt; *} {a}.
(ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
DataOrRecord -&gt; m a
</span><a href="#local-6989586621682122687"><span class="hs-identifier hs-var">splitOnPropError</span></a></span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122671"><span class="hs-identifier hs-var">dr</span></a></span><span>
</span><span id="line-2053"></span><span>
</span><span id="line-2054"></span><span>    </span><span id="local-6989586621682122686"><span class="annot"><span class="annottext">checkIsProp :: ty -&gt; m ()
</span><a href="#local-6989586621682122686"><span class="hs-identifier hs-var hs-var">checkIsProp</span></a></span></span><span> </span><span id="local-6989586621682122688"><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122688"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockT m Bool -&gt; m (Either Blocker Bool)
forall (m :: * -&gt; *) a.
Monad m =&gt;
BlockT m a -&gt; m (Either Blocker a)
</span><a href="Agda.TypeChecking.Monad.Base.html#runBlocked"><span class="hs-identifier hs-var">runBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ty -&gt; BlockT m Bool
forall a (m :: * -&gt; *).
(LensSort a, PrettyTCM a, PureTCM m, MonadBlock m) =&gt;
a -&gt; m Bool
</span><a href="Agda.TypeChecking.Irrelevance.html#isPropM"><span class="hs-identifier hs-var">isPropM</span></a></span><span> </span><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122688"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Either Blocker Bool) -&gt; (Either Blocker Bool -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2055"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682122691"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122691"><span class="hs-identifier hs-var">b</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataOrRecord -&gt; m ()
forall {m :: * -&gt; *} {a}.
(ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
DataOrRecord -&gt; m a
</span><a href="#local-6989586621682122687"><span class="hs-identifier hs-var">splitOnPropError</span></a></span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122671"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-2056"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataOrRecord -&gt; m ()
forall {m :: * -&gt; *} {a}.
(ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
DataOrRecord -&gt; m a
</span><a href="#local-6989586621682122687"><span class="hs-identifier hs-var">splitOnPropError</span></a></span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122671"><span class="hs-identifier hs-var">dr</span></a></span><span>
</span><span id="line-2057"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2058"></span><span>
</span><span id="line-2059"></span><span>    </span><span id="local-6989586621682122680"><span class="annot"><span class="annottext">checkFibrantSplit :: m ()
</span><a href="#local-6989586621682122680"><span class="hs-identifier hs-var hs-var">checkFibrantSplit</span></a></span></span><span>
</span><span id="line-2060"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IsRecord"><span class="hs-identifier hs-type">IsRecord</span></a></span><span> </span><span class="annot"><span class="annottext">InductionAndEta
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122671"><span class="hs-identifier hs-var">dr</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2061"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682122692"><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122692"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ty
</span><a href="#local-6989586621682122674"><span class="hs-identifier hs-var">mtarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2062"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.sort.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;target:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ty -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ty -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122692"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-2063"></span><span>          </span><span class="annot"><span class="annottext">ty -&gt; m ()
</span><a href="#local-6989586621682122693"><span class="hs-identifier hs-var">checkIsFibrant</span></a></span><span> </span><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122692"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-2064"></span><span>          </span><span class="annot"><span class="annottext">[Dom (String, Type)] -&gt; (Dom (String, Type) -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; [Dom (String, Type)]
forall t. Tele (Dom t) -&gt; [Dom (String, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682122673"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Dom (String, Type) -&gt; m ()) -&gt; m ())
-&gt; (Dom (String, Type) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682122694"><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682122694"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2065"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682122695"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682122695"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((String, Type) -&gt; Type) -&gt; (String, Type) -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom (String, Type) -&gt; (String, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682122694"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2066"></span><span>            </span><span class="annot"><span class="annottext">Type -&gt; m ()
</span><a href="#local-6989586621682122696"><span class="hs-identifier hs-var">checkIsCoFibrant</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122695"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2067"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2068"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.sort.check&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;no target&quot;</span></span><span>
</span><span id="line-2069"></span><span>          </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122697"><span class="hs-identifier hs-var">splitOnFibrantError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2070"></span><span>
</span><span id="line-2071"></span><span>    </span><span class="hs-comment">-- Cofibrant types are those that could be the domain of a fibrant</span><span>
</span><span id="line-2072"></span><span>    </span><span class="hs-comment">-- pi type. (Notion by C. Sattler).</span><span>
</span><span id="line-2073"></span><span>    </span><span id="local-6989586621682122696"><span class="annot"><span class="annottext">checkIsCoFibrant :: Type -&gt; m ()
</span><a href="#local-6989586621682122696"><span class="hs-identifier hs-var hs-var">checkIsCoFibrant</span></a></span></span><span> </span><span id="local-6989586621682122698"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122698"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m (Either Blocker Bool)
forall a (m :: * -&gt; *).
(LensSort a, PureTCM m) =&gt;
a -&gt; m (Either Blocker Bool)
</span><a href="Agda.TypeChecking.Irrelevance.html#isCoFibrantSort"><span class="hs-identifier hs-var">isCoFibrantSort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122698"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either Blocker Bool) -&gt; (Either Blocker Bool -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2074"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682122700"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122700"><span class="hs-identifier hs-var">b</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122701"><span class="hs-identifier hs-var">splitOnFibrantError'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122698"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Blocker -&gt; m ()) -&gt; Maybe Blocker -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Maybe Blocker
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122700"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2075"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; m () -&gt; m ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; m Bool
forall (m :: * -&gt; *). (MonadTCM m, MonadReduce m) =&gt; Type -&gt; m Bool
</span><a href="Agda.TypeChecking.Telescope.Path.html#isInterval"><span class="hs-identifier hs-var">isInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122698"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2076"></span><span>                       </span><span class="annot"><span class="annottext">Type -&gt; Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122701"><span class="hs-identifier hs-var">splitOnFibrantError'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122698"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Blocker -&gt; m ()) -&gt; Maybe Blocker -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2077"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span>    </span><span id="local-6989586621682122693"><span class="annot"><span class="annottext">checkIsFibrant :: ty -&gt; m ()
</span><a href="#local-6989586621682122693"><span class="hs-identifier hs-var hs-var">checkIsFibrant</span></a></span></span><span> </span><span id="local-6989586621682122702"><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122702"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ty -&gt; m (Either Blocker Bool)
forall a (m :: * -&gt; *).
(LensSort a, PureTCM m) =&gt;
a -&gt; m (Either Blocker Bool)
</span><a href="Agda.TypeChecking.Irrelevance.html#isFibrant%27"><span class="hs-identifier hs-var">isFibrant'</span></a></span><span> </span><span class="annot"><span class="annottext">ty
</span><a href="#local-6989586621682122702"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either Blocker Bool) -&gt; (Either Blocker Bool -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2080"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682122704"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122704"><span class="hs-identifier hs-var">b</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122697"><span class="hs-identifier hs-var">splitOnFibrantError</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Blocker -&gt; m ()) -&gt; Maybe Blocker -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Maybe Blocker
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682122704"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2081"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122697"><span class="hs-identifier hs-var">splitOnFibrantError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2082"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2083"></span><span>
</span><span id="line-2084"></span><span>    </span><span id="local-6989586621682122687"><span class="annot"><span class="annottext">splitOnPropError :: DataOrRecord -&gt; m a
</span><a href="#local-6989586621682122687"><span class="hs-identifier hs-var hs-var">splitOnPropError</span></a></span></span><span> </span><span id="local-6989586621682122725"><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122725"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m a) -&gt; TypeError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataOrRecord -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SplitInProp"><span class="hs-identifier hs-var">SplitInProp</span></a></span><span> </span><span class="annot"><span class="annottext">DataOrRecord
</span><a href="#local-6989586621682122725"><span class="hs-identifier hs-var">dr</span></a></span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span>    </span><span id="local-6989586621682122701"><span class="annot"><span class="annottext">splitOnFibrantError' :: Type -&gt; Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122701"><span class="hs-identifier hs-var hs-var">splitOnFibrantError'</span></a></span></span><span> </span><span id="local-6989586621682122727"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122727"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682122728"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122728"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; m TypeError -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2087"></span><span>      </span><span class="annot"><span class="annottext">TCM TypeError -&gt; m TypeError
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM TypeError -&gt; m TypeError) -&gt; TCM TypeError -&gt; m TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; Doc -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SortOfSplitVarError"><span class="hs-identifier hs-var">SortOfSplitVarError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122728"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeError) -&gt; TCMT IO Doc -&gt; TCM TypeError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span>
</span><span id="line-2088"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Cannot eliminate fibrant type&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122672"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2089"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;unless context type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682122727"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;is also fibrant.&quot;</span></span><span>
</span><span id="line-2090"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2091"></span><span>
</span><span id="line-2092"></span><span>    </span><span id="local-6989586621682122697"><span class="annot"><span class="annottext">splitOnFibrantError :: Maybe Blocker -&gt; m ()
</span><a href="#local-6989586621682122697"><span class="hs-identifier hs-var hs-var">splitOnFibrantError</span></a></span></span><span> </span><span id="local-6989586621682122729"><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122729"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, ReadTCState m, MonadError TCErr m, MonadTCEnv m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Rules.LHS.html#softTypeError"><span class="hs-identifier hs-var">softTypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; m TypeError -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2093"></span><span>      </span><span class="annot"><span class="annottext">TCM TypeError -&gt; m TypeError
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM TypeError -&gt; m TypeError) -&gt; TCM TypeError -&gt; m TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; Doc -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#SortOfSplitVarError"><span class="hs-identifier hs-var">SortOfSplitVarError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><a href="#local-6989586621682122729"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeError) -&gt; TCMT IO Doc -&gt; TCM TypeError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span>
</span><span id="line-2094"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Cannot eliminate fibrant type&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682122672"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2095"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;unless target type is also fibrant&quot;</span></span><span>
</span><span id="line-2096"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2097"></span></pre></body></html>