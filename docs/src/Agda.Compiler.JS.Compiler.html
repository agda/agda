<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-binds #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Main module for JS backend.</span></span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html"><span class="hs-identifier">Agda.Compiler.JS.Compiler</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeFile</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">isSpace</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(&lt;&amp;&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">dropWhileEnd</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elemIndex</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">listToMaybe</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">createDirectoryIfMissing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">setEnv</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">splitFileName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">callCommand</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Setup.html"><span class="hs-identifier">Agda.Setup</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Setup.html#getDataDir"><span class="hs-identifier">getDataDir</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html"><span class="hs-identifier">Agda.Syntax.Concrete.Name</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier">isNoName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier">QName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#mnameToList"><span class="hs-identifier">mnameToList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier">qnameName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier">qnameModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier">nameId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier">Type</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#nameFixity"><span class="hs-identifier">nameFixity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier">unDom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier">telToList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html"><span class="hs-identifier">Agda.Syntax.Literal</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier">Literal</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html"><span class="hs-identifier">Agda.Syntax.TopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier">TopLevelModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.Boot.html#TopLevelModuleName%27"><span class="hs-identifier">TopLevelModuleName'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html"><span class="hs-identifier">Agda.Syntax.Treeless</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#ArgUsage"><span class="hs-identifier">ArgUsage</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#filterUsed"><span class="hs-identifier">filterUsed</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html"><span class="hs-identifier">Agda.Syntax.Treeless</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier">instantiateFull</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TC</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier">TelV</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier">raise</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#subst"><span class="hs-identifier">subst</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewPath"><span class="hs-identifier">telViewPath</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html"><span class="hs-identifier">Agda.Utils.FileName</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html#isNewerThan"><span class="hs-identifier">isNewerThan</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html#iterate%27"><span class="hs-identifier">iterate'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier">downFrom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.List.html#headWithDefault"><span class="hs-identifier">headWithDefault</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html#boolToMaybe"><span class="hs-identifier">boolToMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier">caseMaybeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenNothing"><span class="hs-identifier">whenNothing</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier">ifM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier">whenM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier">null</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">render</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IO.Directory.html"><span class="hs-identifier">Agda.Utils.IO.Directory</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IO.UTF8.html"><span class="hs-identifier">Agda.Utils.IO.UTF8</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.IO.UTF8.html#writeFile"><span class="hs-identifier">writeFile</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier">singleton</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Common.html"><span class="hs-identifier">Agda.Compiler.Common</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.ToTreeless.html"><span class="hs-identifier">Agda.Compiler.ToTreeless</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.EliminateDefaults.html"><span class="hs-identifier">Agda.Compiler.Treeless.EliminateDefaults</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.EliminateLiteralPatterns.html"><span class="hs-identifier">Agda.Compiler.Treeless.EliminateLiteralPatterns</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.GuardsToPrims.html"><span class="hs-identifier">Agda.Compiler.Treeless.GuardsToPrims</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.Erase.html"><span class="hs-identifier">Agda.Compiler.Treeless.Erase</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.Erase.html#computeErasedConstructorArgs"><span class="hs-identifier">computeErasedConstructorArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.Erase.html#isErasable"><span class="hs-identifier">isErasable</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.Subst.html"><span class="hs-identifier">Agda.Compiler.Treeless.Subst</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.html"><span class="hs-identifier">Agda.Compiler.Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Backend"><span class="hs-identifier">Backend</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Backend_boot"><span class="hs-identifier">Backend_boot</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Backend%27"><span class="hs-identifier">Backend'</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Backend%27_boot"><span class="hs-identifier">Backend'_boot</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Recompile"><span class="hs-identifier">Recompile</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html"><span class="hs-identifier">Agda.Compiler.JS.Syntax</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier">Exp</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Self"><span class="hs-identifier">Self</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier">Local</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Global"><span class="hs-identifier">Global</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Undefined"><span class="hs-identifier">Undefined</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Null"><span class="hs-identifier">Null</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier">String</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Char"><span class="hs-identifier">Char</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier">Integer</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Double"><span class="hs-identifier">Double</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier">Lambda</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier">Object</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Array"><span class="hs-identifier">Array</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Apply"><span class="hs-identifier">Apply</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lookup"><span class="hs-identifier">Lookup</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#If"><span class="hs-identifier">If</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#BinOp"><span class="hs-identifier">BinOp</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#PlainJS"><span class="hs-identifier">PlainJS</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier">LocalId</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier">LocalId</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier">GlobalId</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier">GlobalId</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier">MemberId</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier">MemberId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberIndex"><span class="hs-identifier">MemberIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier">Export</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier">Export</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#modName"><span class="hs-identifier">modName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#callMain"><span class="hs-identifier">callMain</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Comment"><span class="hs-identifier">Comment</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Comment"><span class="hs-identifier">Comment</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#modName"><span class="hs-identifier">modName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#expName"><span class="hs-identifier">expName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#uses"><span class="hs-identifier">uses</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#JSQName"><span class="hs-identifier">JSQName</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html"><span class="hs-identifier">Agda.Compiler.JS.Substitution</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#curriedLambda"><span class="hs-identifier">curriedLambda</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#curriedApply"><span class="hs-identifier">curriedApply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#emp"><span class="hs-identifier">emp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#apply"><span class="hs-identifier">apply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#substShift"><span class="hs-identifier">substShift</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html"><span class="hs-identifier">Agda.Compiler.JS.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JSPretty</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html"><span class="hs-identifier">Agda.Compiler.JS.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSModuleStyle"><span class="hs-identifier">JSModuleStyle</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier">__IMPOSSIBLE__</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- Entry point into the compiler</span><span>
</span><span id="line-93"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsBackend"><span class="hs-identifier hs-type">jsBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span>
</span><span id="line-96"></span><span id="jsBackend"><span class="annot"><span class="annottext">jsBackend :: Backend
</span><a href="Agda.Compiler.JS.Compiler.html#jsBackend"><span class="hs-identifier hs-var hs-var">jsBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Backend'_boot
  Definition
  (TCMT IO)
  JSOptions
  JSOptions
  JSModuleEnv
  Module
  (Maybe Export)
-&gt; Backend
forall opts definition (tcm :: * -&gt; *) env menv mod def.
NFData opts =&gt;
Backend'_boot definition tcm opts env menv mod def
-&gt; Backend_boot definition tcm
</span><a href="Agda.Compiler.Backend.Base.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span><span> </span><span class="annot"><span class="annottext">Backend'_boot
  Definition
  (TCMT IO)
  JSOptions
  JSOptions
  JSModuleEnv
  Module
  (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#jsBackend%27"><span class="hs-identifier hs-var">jsBackend'</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsBackend%27"><span class="hs-identifier hs-type">jsBackend'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Backend%27"><span class="hs-identifier hs-type">Backend'</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-type">JSModuleEnv</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span id="jsBackend%27"><span class="annot"><span class="annottext">jsBackend' :: Backend'_boot
  Definition
  (TCMT IO)
  JSOptions
  JSOptions
  JSModuleEnv
  Module
  (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#jsBackend%27"><span class="hs-identifier hs-var hs-var">jsBackend'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Backend%27"><span class="hs-identifier hs-type">Backend'</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">backendName :: Text
</span><a href="Agda.Compiler.Backend.Base.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Agda.TypeChecking.Monad.Base.html#jsBackendName"><span class="hs-identifier hs-var">jsBackendName</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendVersion :: Maybe Text
</span><a href="Agda.Compiler.Backend.Base.html#backendVersion"><span class="hs-identifier hs-var">backendVersion</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">options :: JSOptions
</span><a href="Agda.Compiler.Backend.Base.html#options"><span class="hs-identifier hs-var">options</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="Agda.Compiler.JS.Compiler.html#defaultJSOptions"><span class="hs-identifier hs-var">defaultJSOptions</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandLineFlags :: [OptDescr (Flag JSOptions)]
</span><a href="Agda.Compiler.Backend.Base.html#commandLineFlags"><span class="hs-identifier hs-var">commandLineFlags</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptDescr (Flag JSOptions)]
</span><a href="Agda.Compiler.JS.Compiler.html#jsCommandLineFlags"><span class="hs-identifier hs-var">jsCommandLineFlags</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isEnabled :: JSOptions -&gt; Bool
</span><a href="Agda.Compiler.Backend.Base.html#isEnabled"><span class="hs-identifier hs-var">isEnabled</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSCompile"><span class="hs-identifier hs-var">optJSCompile</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preCompile :: JSOptions -&gt; TCMT IO JSOptions
</span><a href="Agda.Compiler.Backend.Base.html#preCompile"><span class="hs-identifier hs-var">preCompile</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; TCMT IO JSOptions
</span><a href="Agda.Compiler.JS.Compiler.html#jsPreCompile"><span class="hs-identifier hs-var">jsPreCompile</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postCompile :: JSOptions -&gt; IsMain -&gt; Map TopLevelModuleName Module -&gt; TCMT IO ()
</span><a href="Agda.Compiler.Backend.Base.html#postCompile"><span class="hs-identifier hs-var">postCompile</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; IsMain -&gt; Map TopLevelModuleName Module -&gt; TCMT IO ()
</span><a href="Agda.Compiler.JS.Compiler.html#jsPostCompile"><span class="hs-identifier hs-var">jsPostCompile</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preModule :: JSOptions
-&gt; IsMain
-&gt; TopLevelModuleName
-&gt; Maybe String
-&gt; TCMT IO (Recompile JSModuleEnv Module)
</span><a href="Agda.Compiler.Backend.Base.html#preModule"><span class="hs-identifier hs-var">preModule</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
-&gt; IsMain
-&gt; TopLevelModuleName
-&gt; Maybe String
-&gt; TCMT IO (Recompile JSModuleEnv Module)
</span><a href="Agda.Compiler.JS.Compiler.html#jsPreModule"><span class="hs-identifier hs-var">jsPreModule</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postModule :: JSOptions
-&gt; JSModuleEnv
-&gt; IsMain
-&gt; TopLevelModuleName
-&gt; [Maybe Export]
-&gt; TCMT IO Module
</span><a href="Agda.Compiler.Backend.Base.html#postModule"><span class="hs-identifier hs-var">postModule</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
-&gt; JSModuleEnv
-&gt; IsMain
-&gt; TopLevelModuleName
-&gt; [Maybe Export]
-&gt; TCMT IO Module
</span><a href="Agda.Compiler.JS.Compiler.html#jsPostModule"><span class="hs-identifier hs-var">jsPostModule</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">compileDef :: JSOptions
-&gt; JSModuleEnv -&gt; IsMain -&gt; Definition -&gt; TCMT IO (Maybe Export)
</span><a href="Agda.Compiler.Backend.Base.html#compileDef"><span class="hs-identifier hs-var">compileDef</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
-&gt; JSModuleEnv -&gt; IsMain -&gt; Definition -&gt; TCMT IO (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#jsCompileDef"><span class="hs-identifier hs-var">jsCompileDef</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scopeCheckingSuffices :: Bool
</span><a href="Agda.Compiler.Backend.Base.html#scopeCheckingSuffices"><span class="hs-identifier hs-var">scopeCheckingSuffices</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mayEraseType :: QName -&gt; TCMT IO Bool
</span><a href="Agda.Compiler.Backend.Base.html#mayEraseType"><span class="hs-identifier hs-var">mayEraseType</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; QName -&gt; TCMT IO Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Bool -&gt; QName -&gt; TCMT IO Bool)
-&gt; TCMT IO Bool -&gt; QName -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-comment">-- Andreas, 2019-05-09, see issue #3732.</span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-comment">-- If you want to use JS data structures generated from Agda</span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-comment">-- @data@/@record@, you might want to tell the treeless compiler</span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-comment">-- not to erase these types even if they have no content,</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">-- to get a stable interface.</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendInteractTop :: Maybe (BackendCommandTop (TCMT IO))
</span><a href="Agda.Compiler.Backend.Base.html#backendInteractTop"><span class="hs-identifier hs-var">backendInteractTop</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (BackendCommandTop (TCMT IO))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendInteractHole :: Maybe (BackendCommandHole (TCMT IO))
</span><a href="Agda.Compiler.Backend.Base.html#backendInteractHole"><span class="hs-identifier hs-var">backendInteractHole</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (BackendCommandHole (TCMT IO))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">--- Options ---</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">data</span><span> </span><span id="JSOptions"><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-var">JSOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="JSOptions"><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-var">JSOptions</span></a></span></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="optJSCompile"><span class="annot"><span class="annottext">JSOptions -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSCompile"><span class="hs-identifier hs-var hs-var">optJSCompile</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optJSOptimize"><span class="annot"><span class="annottext">JSOptions -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSOptimize"><span class="hs-identifier hs-var hs-var">optJSOptimize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optJSMinify"><span class="annot"><span class="annottext">JSOptions -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSMinify"><span class="hs-identifier hs-var hs-var">optJSMinify</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Remove spaces etc. See https://en.wikipedia.org/wiki/Minification_(programming).</span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optJSVerify"><span class="annot"><span class="annottext">JSOptions -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSVerify"><span class="hs-identifier hs-var hs-var">optJSVerify</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Run generated code through interpreter.</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optJSModuleStyle"><span class="annot"><span class="annottext">JSOptions -&gt; JSModuleStyle
</span><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var hs-var">optJSModuleStyle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSModuleStyle"><span class="hs-identifier hs-type">JSModuleStyle</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621682208170"><span id="local-6989586621682208172"><span class="annot"><span class="annottext">(forall x. JSOptions -&gt; Rep JSOptions x)
-&gt; (forall x. Rep JSOptions x -&gt; JSOptions) -&gt; Generic JSOptions
forall x. Rep JSOptions x -&gt; JSOptions
forall x. JSOptions -&gt; Rep JSOptions x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. JSOptions -&gt; Rep JSOptions x
from :: forall x. JSOptions -&gt; Rep JSOptions x
$cto :: forall x. Rep JSOptions x -&gt; JSOptions
to :: forall x. Rep JSOptions x -&gt; JSOptions
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682208178"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSModuleStyle"><span class="hs-identifier hs-type">JSModuleStyle</span></a></span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682208196"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#defaultJSOptions"><span class="hs-identifier hs-type">defaultJSOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span>
</span><span id="line-139"></span><span id="defaultJSOptions"><span class="annot"><span class="annottext">defaultJSOptions :: JSOptions
</span><a href="Agda.Compiler.JS.Compiler.html#defaultJSOptions"><span class="hs-identifier hs-var hs-var">defaultJSOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optJSCompile :: Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSCompile"><span class="hs-identifier hs-var">optJSCompile</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">optJSOptimize :: Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSOptimize"><span class="hs-identifier hs-var">optJSOptimize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">optJSMinify :: Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSMinify"><span class="hs-identifier hs-var">optJSMinify</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">optJSVerify :: Bool
</span><a href="Agda.Compiler.JS.Compiler.html#optJSVerify"><span class="hs-identifier hs-var">optJSVerify</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">optJSModuleStyle :: JSModuleStyle
</span><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="Agda.Compiler.JS.Pretty.html#JSCJS"><span class="hs-identifier hs-var">JSCJS</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsCommandLineFlags"><span class="hs-identifier hs-type">jsCommandLineFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.GetOpt.html#OptDescr"><span class="hs-identifier hs-type">OptDescr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span id="jsCommandLineFlags"><span class="annot"><span class="annottext">jsCommandLineFlags :: [OptDescr (Flag JSOptions)]
</span><a href="Agda.Compiler.JS.Compiler.html#jsCommandLineFlags"><span class="hs-identifier hs-var hs-var">jsCommandLineFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208221"><span class="hs-identifier hs-var">enable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile program using the JS backend&quot;</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js-optimize&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208222"><span class="hs-identifier hs-var">enableOpt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;turn on optimizations during JS code generation&quot;</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">-- Minification is described at https://en.wikipedia.org/wiki/Minification_(programming)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js-minify&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208223"><span class="hs-identifier hs-var">enableMin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;minify generated JS code&quot;</span></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js-verify&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208224"><span class="hs-identifier hs-var">enableVerify</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;except for main module, run generated JS modules through `node` (needs to be in PATH)&quot;</span></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js-es6&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208225"><span class="hs-identifier hs-var">setES6</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use ES6 module style for JS&quot;</span></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js-cjs&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208226"><span class="hs-identifier hs-var">setCJS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use CommonJS module style (default)&quot;</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Flag JSOptions)
-&gt; String
-&gt; OptDescr (Flag JSOptions)
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><a href="Agda.Utils.GetOpt.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;js-amd&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag JSOptions -&gt; ArgDescr (Flag JSOptions)
forall a. a -&gt; ArgDescr a
</span><a href="Agda.Utils.GetOpt.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a></span><span> </span><span class="annot"><span class="annottext">Flag JSOptions
forall {f :: * -&gt; *}. Applicative f =&gt; JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208227"><span class="hs-identifier hs-var">setAMD</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use AMD module style for JS&quot;</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621682208221"><span class="annot"><span class="annottext">enable :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208221"><span class="hs-identifier hs-var hs-var">enable</span></a></span></span><span>       </span><span id="local-6989586621682208233"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208233"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208233"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSCompile"><span class="hs-identifier hs-var">optJSCompile</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621682208222"><span class="annot"><span class="annottext">enableOpt :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208222"><span class="hs-identifier hs-var hs-var">enableOpt</span></a></span></span><span>    </span><span id="local-6989586621682208238"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208238"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208238"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSOptimize"><span class="hs-identifier hs-var">optJSOptimize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621682208223"><span class="annot"><span class="annottext">enableMin :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208223"><span class="hs-identifier hs-var hs-var">enableMin</span></a></span></span><span>    </span><span id="local-6989586621682208243"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208243"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208243"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSMinify"><span class="hs-identifier hs-var">optJSMinify</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621682208224"><span class="annot"><span class="annottext">enableVerify :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208224"><span class="hs-identifier hs-var hs-var">enableVerify</span></a></span></span><span> </span><span id="local-6989586621682208248"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208248"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208248"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSVerify"><span class="hs-identifier hs-var">optJSVerify</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621682208225"><span class="annot"><span class="annottext">setES6 :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208225"><span class="hs-identifier hs-var hs-var">setES6</span></a></span></span><span>       </span><span id="local-6989586621682208253"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208253"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208253"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSES6"><span class="hs-identifier hs-type">JSES6</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621682208226"><span class="annot"><span class="annottext">setCJS :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208226"><span class="hs-identifier hs-var hs-var">setCJS</span></a></span></span><span>       </span><span id="local-6989586621682208259"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208259"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208259"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSCJS"><span class="hs-identifier hs-type">JSCJS</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621682208227"><span class="annot"><span class="annottext">setAMD :: JSOptions -&gt; f JSOptions
</span><a href="#local-6989586621682208227"><span class="hs-identifier hs-var hs-var">setAMD</span></a></span></span><span>       </span><span id="local-6989586621682208264"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208264"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; f JSOptions
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208264"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSAMD"><span class="hs-identifier hs-type">JSAMD</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">--- Top-level compilation ---</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsPreCompile"><span class="hs-identifier hs-type">jsPreCompile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span>
</span><span id="line-170"></span><span id="jsPreCompile"><span class="annot"><span class="annottext">jsPreCompile :: JSOptions -&gt; TCMT IO JSOptions
</span><a href="Agda.Compiler.JS.Compiler.html#jsPreCompile"><span class="hs-identifier hs-var hs-var">jsPreCompile</span></a></span></span><span> </span><span id="local-6989586621682208266"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208266"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208266"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; TCMT IO () -&gt; TCMT IO JSOptions
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="annottext">(Cubical -&gt; TCMT IO (ZonkAny 0)) -&gt; Maybe Cubical -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO (ZonkAny 0)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO (ZonkAny 0))
-&gt; (Cubical -&gt; TypeError) -&gt; Cubical -&gt; TCMT IO (ZonkAny 0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cubical -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CubicalCompilationNotSupported"><span class="hs-identifier hs-var">CubicalCompilationNotSupported</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Cubical -&gt; TCMT IO ())
-&gt; TCMT IO (Maybe Cubical) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Cubical)
forall (m :: * -&gt; *). HasOptions m =&gt; m (Maybe Cubical)
</span><a href="Agda.TypeChecking.Monad.Base.html#cubicalOption"><span class="hs-identifier hs-var">cubicalOption</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><span class="hs-comment">-- | After all modules have been compiled, copy RTE modules and verify compiled modules.</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsPostCompile"><span class="hs-identifier hs-type">jsPostCompile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-type">IsMain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span id="jsPostCompile"><span class="annot"><span class="annottext">jsPostCompile :: JSOptions -&gt; IsMain -&gt; Map TopLevelModuleName Module -&gt; TCMT IO ()
</span><a href="Agda.Compiler.JS.Compiler.html#jsPostCompile"><span class="hs-identifier hs-var hs-var">jsPostCompile</span></a></span></span><span> </span><span id="local-6989586621682208274"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208274"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208275"><span class="annot"><span class="annottext">Map TopLevelModuleName Module
</span><a href="#local-6989586621682208275"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-comment">-- Copy RTE modules.</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621682208276"><span class="annot"><a href="#local-6989586621682208276"><span class="hs-identifier hs-var">compDir</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO String
forall (m :: * -&gt; *). HasOptions m =&gt; m String
</span><a href="Agda.Compiler.Common.html#compileDir"><span class="hs-identifier hs-var">compileDir</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621682208279"><span class="annot"><a href="#local-6989586621682208279"><span class="hs-identifier hs-var">dataDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Setup.html#getDataDir"><span class="hs-identifier hs-type">getDataDir</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208280"><span class="annot"><a href="#local-6989586621682208280"><span class="hs-identifier hs-var hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; JSModuleStyle
</span><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208274"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>          </span><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="Agda.Compiler.JS.Pretty.html#JSCJS"><span class="hs-identifier hs-var">JSCJS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agda-rts.js&quot;</span></span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="Agda.Compiler.JS.Pretty.html#JSAMD"><span class="hs-identifier hs-var">JSAMD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agda-rts.amd.js&quot;</span></span><span>
</span><span id="line-187"></span><span>          </span><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="Agda.Compiler.JS.Pretty.html#JSES6"><span class="hs-identifier hs-var">JSES6</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agda-rts.mjs&quot;</span></span><span>
</span><span id="line-188"></span><span>        </span><span id="local-6989586621682208281"><span class="annot"><a href="#local-6989586621682208281"><span class="hs-identifier hs-var hs-var">srcPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208279"><span class="hs-identifier hs-var">dataDir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;JS&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208280"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span id="local-6989586621682208282"><span class="annot"><a href="#local-6989586621682208282"><span class="hs-identifier hs-var hs-var">compPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208276"><span class="hs-identifier hs-var">compDir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208280"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="Agda.Utils.IO.Directory.html#copyIfChanged"><span class="hs-identifier hs-type">copyIfChanged</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208281"><span class="hs-identifier hs-type">srcPath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208282"><span class="hs-identifier hs-type">compPath</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- Verify generated JS modules (except for main).</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js.verify&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Considering to verify generated JS modules&quot;</span></span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSVerify"><span class="hs-identifier hs-var">optJSVerify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208274"><span class="hs-identifier hs-type">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js.verify&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Verifying generated JS modules&quot;</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">setEnv</span></span><span> </span><span class="annot"><span class="hs-string">&quot;NODE_PATH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682208276"><span class="hs-identifier hs-type">compDir</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682208275"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">{</span><span> </span><span id="local-6989586621682208285"><span class="annot"><span class="annottext">GlobalId
modName :: Module -&gt; GlobalId
modName :: GlobalId
</span><a href="Agda.Compiler.JS.Syntax.html#modName"><span class="hs-identifier hs-var hs-var">modName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208286"><span class="annot"><span class="annottext">Maybe Exp
callMain :: Module -&gt; Maybe Exp
callMain :: Maybe Exp
</span><a href="Agda.Compiler.JS.Syntax.html#callMain"><span class="hs-identifier hs-var hs-var">callMain</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>      </span><span id="local-6989586621682208287"><span class="annot"><a href="#local-6989586621682208287"><span class="hs-identifier hs-var">jsFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">JSModuleStyle -&gt; GlobalId -&gt; TCMT IO String
</span><a href="Agda.Compiler.JS.Compiler.html#outFile"><span class="hs-identifier hs-var">outFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSOptions -&gt; JSModuleStyle
</span><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208274"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GlobalId
</span><a href="#local-6989586621682208285"><span class="hs-identifier hs-var">modName</span></a></span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js.verify&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Considering JS module:&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208287"><span class="hs-identifier hs-type">jsFile</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>      </span><span class="hs-comment">-- Since we do not run a JS program for real, we skip all modules that could</span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-comment">-- have a call to main.</span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-comment">-- Atm, modules whose compilation was skipped are also skipped during verification</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-comment">-- (they appear here as main modules).</span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenNothing"><span class="hs-identifier hs-type">whenNothing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208286"><span class="hs-identifier hs-type">callMain</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-comment">-- node needs to see whether the extension is .js or .mjs,</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-comment">-- so we pass input explicitly, not via stdin</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208290"><span class="annot"><a href="#local-6989586621682208290"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;node&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208287"><span class="hs-identifier hs-var">jsFile</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js.verify&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;calling:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208290"><span class="hs-identifier hs-type">cmd</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">callCommand</span></span><span> </span><span class="annot"><a href="#local-6989586621682208290"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">--- Module compilation ---</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">data</span><span> </span><span id="JSModuleEnv"><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-var">JSModuleEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="JSModuleEnv"><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-var">JSModuleEnv</span></a></span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="jsCoinductionKit"><span class="annot"><span class="annottext">JSModuleEnv -&gt; Maybe CoinductionKit
</span><a href="Agda.Compiler.JS.Compiler.html#jsCoinductionKit"><span class="hs-identifier hs-var hs-var">jsCoinductionKit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#CoinductionKit"><span class="hs-identifier hs-type">CoinductionKit</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="jsCompile"><span class="annot"><span class="annottext">JSModuleEnv -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#jsCompile"><span class="hs-identifier hs-var hs-var">jsCompile</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Should this module be compiled?</span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsPreModule"><span class="hs-identifier hs-type">jsPreModule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-type">IsMain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Recompile"><span class="hs-identifier hs-type">Recompile</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-type">JSModuleEnv</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span id="jsPreModule"><span class="annot"><span class="annottext">jsPreModule :: JSOptions
-&gt; IsMain
-&gt; TopLevelModuleName
-&gt; Maybe String
-&gt; TCMT IO (Recompile JSModuleEnv Module)
</span><a href="Agda.Compiler.JS.Compiler.html#jsPreModule"><span class="hs-identifier hs-var hs-var">jsPreModule</span></a></span></span><span> </span><span id="local-6989586621682208295"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208295"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208296"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682208296"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682208297"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682208297"><span class="hs-identifier hs-var">mifile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621682208298"><span class="annot"><a href="#local-6989586621682208298"><span class="hs-identifier hs-var">cubical</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Cubical)
forall (m :: * -&gt; *). HasOptions m =&gt; m (Maybe Cubical)
</span><a href="Agda.TypeChecking.Monad.Base.html#cubicalOption"><span class="hs-identifier hs-var">cubicalOption</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208299"><span class="annot"><a href="#local-6989586621682208299"><span class="hs-identifier hs-var hs-var">compile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Cubical
</span><a href="#local-6989586621682208298"><span class="hs-identifier hs-var">cubical</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-comment">-- Code that uses --cubical is not compiled.</span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Cubical
</span><a href="Agda.Syntax.Common.html#CFull"><span class="hs-identifier hs-var">CFull</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Cubical
</span><a href="Agda.Syntax.Common.html#CErased"><span class="hs-identifier hs-var">CErased</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Cubical
</span><a href="Agda.Syntax.Common.html#CWithoutGlue"><span class="hs-identifier hs-var">CWithoutGlue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">Maybe Cubical
</span><span class="hs-identifier hs-var">Nothing</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208303"><span class="hs-identifier hs-type">uptodate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208304"><span class="hs-identifier hs-type">noComp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682208305"><span class="hs-identifier hs-type">yesComp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208299"><span class="hs-identifier hs-type">compile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621682208306"><span class="annot"><span class="annottext">outFile_ :: TCMT IO String
</span><a href="#local-6989586621682208306"><span class="hs-identifier hs-var hs-var">outFile_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>      </span><span id="local-6989586621682208307"><span class="annot"><a href="#local-6989586621682208307"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO TopLevelModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m TopLevelModuleName
</span><a href="Agda.Compiler.Common.html#curMName"><span class="hs-identifier hs-var">curMName</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#outFile"><span class="hs-identifier hs-type">outFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208295"><span class="hs-identifier hs-type">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-type">jsMod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208307"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621682208303"><span class="annot"><span class="annottext">uptodate :: TCMT IO Bool
</span><a href="#local-6989586621682208303"><span class="hs-identifier hs-var hs-var">uptodate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682208297"><span class="hs-identifier hs-var">mifile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682208310"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208310"><span class="hs-identifier hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; TCMT IO Bool
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; TCMT IO Bool) -&gt; TCMT IO (IO Bool) -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO Bool
</span><a href="Agda.Utils.FileName.html#isNewerThan"><span class="hs-identifier hs-var">isNewerThan</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String -&gt; IO Bool)
-&gt; TCMT IO String -&gt; TCMT IO (String -&gt; IO Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO String
</span><a href="#local-6989586621682208306"><span class="hs-identifier hs-var">outFile_</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (String -&gt; IO Bool) -&gt; TCMT IO String -&gt; TCMT IO (IO Bool)
forall a b. TCMT IO (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO String
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208310"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621682208312"><span class="annot"><span class="annottext">ifileDesc :: String
</span><a href="#local-6989586621682208312"><span class="hs-identifier hs-var hs-var">ifileDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(memory)&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682208297"><span class="hs-identifier hs-var">mifile</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621682208304"><span class="annot"><span class="annottext">noComp :: TCMT IO (Recompile JSModuleEnv Module)
</span><a href="#local-6989586621682208304"><span class="hs-identifier hs-var hs-var">noComp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO ())
-&gt; (TopLevelModuleName -&gt; String)
-&gt; TopLevelModuleName
-&gt; TCMT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; : no compilation is needed.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; (TopLevelModuleName -&gt; String) -&gt; TopLevelModuleName -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; TCMT IO ())
-&gt; TCMT IO TopLevelModuleName -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TopLevelModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m TopLevelModuleName
</span><a href="Agda.Compiler.Common.html#curMName"><span class="hs-identifier hs-var">curMName</span></a></span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">Recompile JSModuleEnv Module
-&gt; TCMT IO (Recompile JSModuleEnv Module)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Recompile JSModuleEnv Module
 -&gt; TCMT IO (Recompile JSModuleEnv Module))
-&gt; Recompile JSModuleEnv Module
-&gt; TCMT IO (Recompile JSModuleEnv Module)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Recompile JSModuleEnv Module
forall menv mod. mod -&gt; Recompile menv mod
</span><a href="Agda.Compiler.Backend.Base.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682208314"><span class="hs-identifier hs-var">skippedModule</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-comment">-- A skipped module acts as a fake main module, to be skipped by --js-verify as well.</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621682208314"><span class="annot"><span class="annottext">skippedModule :: Module
</span><a href="#local-6989586621682208314"><span class="hs-identifier hs-var hs-var">skippedModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalId -&gt; [GlobalId] -&gt; [Export] -&gt; Maybe Exp -&gt; Module
</span><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-var">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; GlobalId
</span><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-var">jsMod</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682208296"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalId]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[Export]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621682208305"><span class="annot"><span class="annottext">yesComp :: Bool -&gt; TCMT IO (Recompile JSModuleEnv Module)
</span><a href="#local-6989586621682208305"><span class="hs-identifier hs-var hs-var">yesComp</span></a></span></span><span> </span><span id="local-6989586621682208315"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208315"><span class="hs-identifier hs-var">compile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621682208316"><span class="annot"><a href="#local-6989586621682208316"><span class="hs-identifier hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; String)
-&gt; TCMT IO TopLevelModuleName -&gt; TCMT IO String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TopLevelModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m TopLevelModuleName
</span><a href="Agda.Compiler.Common.html#curMName"><span class="hs-identifier hs-var">curMName</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span id="local-6989586621682208317"><span class="annot"><a href="#local-6989586621682208317"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682208306"><span class="hs-identifier hs-type">outFile_</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-type">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.Common.html#repl"><span class="hs-identifier hs-type">repl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682208316"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208312"><span class="hs-identifier hs-type">ifileDesc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208317"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-string">&quot;Compiling &lt;&lt;0&gt;&gt; in &lt;&lt;1&gt;&gt; to &lt;&lt;2&gt;&gt;&quot;</span></span><span>
</span><span id="line-256"></span><span>      </span><span id="local-6989586621682208320"><span class="annot"><a href="#local-6989586621682208320"><span class="hs-identifier hs-var">kit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#coinductionKit"><span class="hs-identifier hs-type">coinductionKit</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.Backend.Base.html#Recompile"><span class="hs-identifier hs-type">Recompile</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-type">JSModuleEnv</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsCoinductionKit"><span class="hs-identifier hs-var">jsCoinductionKit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208320"><span class="hs-identifier hs-type">kit</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsCompile"><span class="hs-identifier hs-var">jsCompile</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208315"><span class="hs-identifier hs-type">compile</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsPostModule"><span class="hs-identifier hs-type">jsPostModule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-type">JSModuleEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-type">IsMain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-265"></span><span id="jsPostModule"><span class="annot"><span class="annottext">jsPostModule :: JSOptions
-&gt; JSModuleEnv
-&gt; IsMain
-&gt; TopLevelModuleName
-&gt; [Maybe Export]
-&gt; TCMT IO Module
</span><a href="Agda.Compiler.JS.Compiler.html#jsPostModule"><span class="hs-identifier hs-var hs-var">jsPostModule</span></a></span></span><span> </span><span id="local-6989586621682208323"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208323"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="annot"><span class="annottext">JSModuleEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208324"><span class="annot"><span class="annottext">IsMain
</span><a href="#local-6989586621682208324"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208325"><span class="annot"><span class="annottext">[Maybe Export]
</span><a href="#local-6989586621682208325"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>  </span><span id="local-6989586621682208326"><span class="annot"><a href="#local-6989586621682208326"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; GlobalId
</span><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-var">jsMod</span></a></span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; GlobalId)
-&gt; TCMT IO TopLevelModuleName -&gt; TCMT IO GlobalId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TopLevelModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m TopLevelModuleName
</span><a href="Agda.Compiler.Common.html#curMName"><span class="hs-identifier hs-var">curMName</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621682208327"><span class="annot"><a href="#local-6989586621682208327"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-type">jsMod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iImportedModules"><span class="hs-identifier hs-var">iImportedModules</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Compiler.Common.html#curIF"><span class="hs-identifier hs-type">curIF</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208331"><span class="annot"><a href="#local-6989586621682208331"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalId -&gt; [GlobalId] -&gt; [Export] -&gt; Maybe Exp -&gt; Module
</span><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-var">Module</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalId
</span><a href="#local-6989586621682208326"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalId]
</span><a href="#local-6989586621682208327"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#reorder"><span class="hs-identifier hs-var">reorder</span></a></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208333"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621682208334"><span class="hs-identifier hs-var">callMain</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#writeModule"><span class="hs-identifier hs-type">writeModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSMinify"><span class="hs-identifier hs-var">optJSMinify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208323"><span class="hs-identifier hs-type">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#optJSModuleStyle"><span class="hs-identifier hs-var">optJSModuleStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208323"><span class="hs-identifier hs-type">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208331"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682208331"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>  </span><span id="local-6989586621682208333"><span class="annot"><span class="annottext">es :: [Export]
</span><a href="#local-6989586621682208333"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Export] -&gt; [Export]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Export]
</span><a href="#local-6989586621682208325"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span id="local-6989586621682208336"><span class="annot"><span class="annottext">main :: MemberId
</span><a href="#local-6989586621682208336"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-comment">-- Andreas, 2020-10-27, only add invocation of &quot;main&quot; if such function is defined.</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-comment">-- This allows loading of generated .js files into an interpreter</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-comment">-- even if they do not define &quot;main&quot;.</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621682208337"><span class="annot"><span class="annottext">hasMain :: Bool
</span><a href="#local-6989586621682208337"><span class="hs-identifier hs-var hs-var">hasMain</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="#local-6989586621682208324"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">IsMain -&gt; IsMain -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsMain
</span><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-var">IsMain</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Export -&gt; Bool) -&gt; [Export] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MemberId -&gt; JSQName
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">MemberId
</span><a href="#local-6989586621682208336"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="annot"><span class="annottext">JSQName -&gt; JSQName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(JSQName -&gt; Bool) -&gt; (Export -&gt; JSQName) -&gt; Export -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Export -&gt; JSQName
</span><a href="Agda.Compiler.JS.Syntax.html#expName"><span class="hs-identifier hs-var">expName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208333"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><a href="#local-6989586621682208334"><span class="hs-identifier hs-type">callMain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621682208334"><span class="annot"><span class="annottext">callMain :: Maybe Exp
</span><a href="#local-6989586621682208334"><span class="hs-identifier hs-var hs-var">callMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Exp -&gt; Maybe Exp
forall a. Bool -&gt; a -&gt; Maybe a
</span><a href="Agda.Utils.Maybe.html#boolToMaybe"><span class="hs-identifier hs-var">boolToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208337"><span class="hs-identifier hs-var">hasMain</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Maybe Exp) -&gt; Exp -&gt; Maybe Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; MemberId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Self"><span class="hs-identifier hs-var">Self</span></a></span><span> </span><span class="annot"><span class="annottext">MemberId
</span><a href="#local-6989586621682208336"><span class="hs-identifier hs-var">main</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Substitution.html#emp"><span class="hs-identifier hs-var">emp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsCompileDef"><span class="hs-identifier hs-type">jsCompileDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-type">JSModuleEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#IsMain"><span class="hs-identifier hs-type">IsMain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span id="jsCompileDef"><span class="annot"><span class="annottext">jsCompileDef :: JSOptions
-&gt; JSModuleEnv -&gt; IsMain -&gt; Definition -&gt; TCMT IO (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#jsCompileDef"><span class="hs-identifier hs-var hs-var">jsCompileDef</span></a></span></span><span> </span><span id="local-6989586621682208341"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208341"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682208342"><span class="annot"><span class="annottext">JSModuleEnv
</span><a href="#local-6989586621682208342"><span class="hs-identifier hs-var">kit</span></a></span></span><span> </span><span id="local-6989586621682208343"><span class="annot"><span class="annottext">IsMain
</span><a href="#local-6989586621682208343"><span class="hs-identifier hs-var">_isMain</span></a></span></span><span> </span><span id="local-6989586621682208344"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208344"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnvWithOpts -&gt; (QName, Definition) -&gt; TCMT IO (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#definition"><span class="hs-identifier hs-var">definition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682208341"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JSModuleEnv
</span><a href="#local-6989586621682208342"><span class="hs-identifier hs-var">kit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208344"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208344"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- Naming</span><span>
</span><span id="line-287"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#prefix"><span class="hs-identifier hs-type">prefix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span id="prefix"><span class="annot"><span class="annottext">prefix :: String
</span><a href="Agda.Compiler.JS.Compiler.html#prefix"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;jAgda&quot;</span></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-type">jsMod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier hs-type">GlobalId</span></a></span><span>
</span><span id="line-293"></span><span id="jsMod"><span class="annot"><span class="annottext">jsMod :: TopLevelModuleName -&gt; GlobalId
</span><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-var hs-var">jsMod</span></a></span></span><span> </span><span id="local-6989586621682208348"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682208348"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; GlobalId
</span><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier hs-var">GlobalId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="Agda.Compiler.JS.Compiler.html#prefix"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; [Text] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleNameParts -&gt; [Item TopLevelModuleNameParts]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TopLevelModuleNameParts
forall range. TopLevelModuleName' range -&gt; TopLevelModuleNameParts
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameParts"><span class="hs-identifier hs-var">moduleNameParts</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682208348"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsFileName"><span class="hs-identifier hs-type">jsFileName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSModuleStyle"><span class="hs-identifier hs-type">JSModuleStyle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier hs-type">GlobalId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-297"></span><span id="jsFileName"><span class="annot"><span class="annottext">jsFileName :: JSModuleStyle -&gt; GlobalId -&gt; String
</span><a href="Agda.Compiler.JS.Compiler.html#jsFileName"><span class="hs-identifier hs-var hs-var">jsFileName</span></a></span></span><span> </span><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="Agda.Compiler.JS.Pretty.html#JSES6"><span class="hs-identifier hs-var">JSES6</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier hs-type">GlobalId</span></a></span><span> </span><span id="local-6989586621682208352"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682208352"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682208352"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.mjs&quot;</span></span><span> </span><span class="hs-comment">-- Hint that file is ES6, not old js</span><span>
</span><span id="line-298"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsFileName"><span class="hs-identifier hs-var">jsFileName</span></a></span><span> </span><span class="annot"><span class="annottext">JSModuleStyle
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier hs-type">GlobalId</span></a></span><span> </span><span id="local-6989586621682208353"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682208353"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682208353"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.js&quot;</span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsMember"><span class="hs-identifier hs-type">jsMember</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-type">MemberId</span></a></span><span>
</span><span id="line-301"></span><span id="jsMember"><span class="annot"><span class="annottext">jsMember :: Name -&gt; MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#jsMember"><span class="hs-identifier hs-var hs-var">jsMember</span></a></span></span><span> </span><span id="local-6989586621682208355"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682208355"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-comment">-- Anonymous fields are used for where clauses,</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-comment">-- and they're all given the concrete name &quot;_&quot;,</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-comment">-- so we disambiguate them using their name id.</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682208355"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NameId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682208355"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; MemberId) -&gt; String -&gt; MemberId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682208355"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#global%27"><span class="hs-identifier hs-type">global'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#JSQName"><span class="hs-identifier hs-type">JSQName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span id="global%27"><span class="annot"><span class="annottext">global' :: QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global%27"><span class="hs-identifier hs-var hs-var">global'</span></a></span></span><span> </span><span id="local-6989586621682208358"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208358"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621682208359"><span class="annot"><a href="#local-6989586621682208359"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; TopLevelModuleName)
-&gt; TCMT IO Interface -&gt; TCMT IO TopLevelModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Interface
forall (m :: * -&gt; *). ReadTCState m =&gt; m Interface
</span><a href="Agda.Compiler.Common.html#curIF"><span class="hs-identifier hs-var">curIF</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span id="local-6989586621682208361"><span class="annot"><a href="#local-6989586621682208361"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Compiler.Common.html#topLevelModuleName"><span class="hs-identifier hs-type">CC.topLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier hs-var">qnameModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208358"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-comment">-- Global module prefix</span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621682208363"><span class="annot"><a href="#local-6989586621682208363"><span class="hs-identifier hs-var hs-var">qms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [Name]
</span><a href="Agda.Syntax.Abstract.Name.html#mnameToList"><span class="hs-identifier hs-var">mnameToList</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; [Name]) -&gt; ModuleName -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ModuleName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier hs-var">qnameModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208358"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- File-local module prefix</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621682208364"><span class="annot"><a href="#local-6989586621682208364"><span class="hs-identifier hs-var hs-var">localms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Name] -&gt; [Name]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682208361"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682208363"><span class="hs-identifier hs-var">qms</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621682208366"><span class="annot"><a href="#local-6989586621682208366"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; MemberId) -&gt; NonEmpty Name -&gt; JSQName
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#jsMember"><span class="hs-identifier hs-var">jsMember</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Name -&gt; JSQName) -&gt; NonEmpty Name -&gt; JSQName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Name -&gt; NonEmpty Name
forall a. [a] -&gt; a -&gt; List1 a
</span><a href="Agda.Utils.List1.html#snoc"><span class="hs-identifier hs-var">List1.snoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682208364"><span class="hs-identifier hs-var">localms</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NonEmpty Name) -&gt; Name -&gt; NonEmpty Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208358"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682208361"><span class="hs-identifier hs-type">top</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682208359"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Self"><span class="hs-identifier hs-type">Self</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208366"><span class="hs-identifier hs-type">nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsMod"><span class="hs-identifier hs-type">jsMod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208361"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208366"><span class="hs-identifier hs-type">nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#global"><span class="hs-identifier hs-type">global</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#JSQName"><span class="hs-identifier hs-type">JSQName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span id="global"><span class="annot"><span class="annottext">global :: QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global"><span class="hs-identifier hs-var hs-var">global</span></a></span></span><span> </span><span id="local-6989586621682208369"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208369"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>  </span><span id="local-6989586621682208370"><span class="annot"><a href="#local-6989586621682208370"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208369"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682208370"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">theDef :: Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">conData :: Defn -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#conData"><span class="hs-identifier hs-var">conData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208376"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208376"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208376"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Definition
-&gt; (Definition -&gt; TCM (Exp, JSQName)) -&gt; TCM (Exp, JSQName)
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-comment">-- Andreas, 2020-10-27, comment quotes outdated fact.</span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-comment">-- anon. constructors are now M.R.constructor.</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-comment">-- We could simplify/remove the workaround by switching &quot;record&quot;</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-comment">-- to &quot;constructor&quot;, but this changes the output of the JS compiler</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- maybe in ways that break user's developments</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-comment">-- (if they link to Agda-generated JS).</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- -- Rather annoyingly, the anonymous constructor of a record R in module M</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-comment">-- -- is given the name M.recCon, but a named constructor C</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-comment">-- -- is given the name M.R.C, sigh. This causes a lot of hoop-jumping</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-comment">-- -- in the map from Agda names to JS names, which we patch by renaming</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">-- -- anonymous constructors to M.R.record.</span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">theDef :: Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recNamedCon :: Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#recNamedCon"><span class="hs-identifier hs-var">recNamedCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682208379"><span class="annot"><a href="#local-6989586621682208379"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682208380"><span class="annot"><a href="#local-6989586621682208380"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global%27"><span class="hs-identifier hs-var">global'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208376"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-341"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682208379"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208380"><span class="hs-identifier hs-type">ls</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-type">MemberId</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;record&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><span class="annottext">Definition
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global%27"><span class="hs-identifier hs-var">global'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208370"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="annottext">Definition
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global%27"><span class="hs-identifier hs-var">global'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208370"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">-- Reorder a list of exports to ensure def-before-use.</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- Note that this can diverge in the case when there is no such reordering.</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- Only top-level values are evaluated before definitions are added to the</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- module, so we put those last, ordered in dependency order. There can't be</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- any recursion between top-level values (unless termination checking has been</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- disabled and someone's written a non-sensical program), so reordering will</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- terminate.</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#reorder"><span class="hs-identifier hs-type">reorder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span id="reorder"><span class="annot"><span class="annottext">reorder :: [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#reorder"><span class="hs-identifier hs-var hs-var">reorder</span></a></span></span><span> </span><span id="local-6989586621682208381"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208381"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208382"><span class="hs-identifier hs-var">datas</span></a></span><span> </span><span class="annot"><span class="annottext">[Export] -&gt; [Export] -&gt; [Export]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208383"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">[Export] -&gt; [Export] -&gt; [Export]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Set JSQName -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#reorder%27"><span class="hs-identifier hs-var">reorder'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[JSQName] -&gt; Set JSQName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([JSQName] -&gt; Set JSQName) -&gt; [JSQName] -&gt; Set JSQName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Export -&gt; JSQName) -&gt; [Export] -&gt; [JSQName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Export -&gt; JSQName
</span><a href="Agda.Compiler.JS.Syntax.html#expName"><span class="hs-identifier hs-var">expName</span></a></span><span> </span><span class="annot"><span class="annottext">([Export] -&gt; [JSQName]) -&gt; [Export] -&gt; [JSQName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208382"><span class="hs-identifier hs-var">datas</span></a></span><span> </span><span class="annot"><span class="annottext">[Export] -&gt; [Export] -&gt; [Export]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208383"><span class="hs-identifier hs-var">funs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208386"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682208387"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208387"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208383"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208383"><span class="hs-identifier hs-var">funs</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Export -&gt; Bool) -&gt; [Export] -&gt; ([Export], [Export])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">Export -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#isTopLevelValue"><span class="hs-identifier hs-var">isTopLevelValue</span></a></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208381"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682208382"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208382"><span class="hs-identifier hs-var">datas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208386"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208386"><span class="hs-identifier hs-var">vals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Export -&gt; Bool) -&gt; [Export] -&gt; ([Export], [Export])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">Export -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#isEmptyObject"><span class="hs-identifier hs-var">isEmptyObject</span></a></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208387"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#reorder%27"><span class="hs-identifier hs-type">reorder'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#JSQName"><span class="hs-identifier hs-type">JSQName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-361"></span><span id="reorder%27"><span class="annot"><span class="annottext">reorder' :: Set JSQName -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#reorder%27"><span class="hs-identifier hs-var hs-var">reorder'</span></a></span></span><span> </span><span id="local-6989586621682208390"><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208390"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#reorder%27"><span class="hs-identifier hs-var">reorder'</span></a></span><span> </span><span id="local-6989586621682208391"><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208391"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208392"><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208392"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682208393"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208393"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208394"><span class="annot"><span class="annottext">us :: Set JSQName
</span><a href="#local-6989586621682208394"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Export -&gt; Set JSQName
forall a. Uses a =&gt; a -&gt; Set JSQName
</span><a href="Agda.Compiler.JS.Syntax.html#uses"><span class="hs-identifier hs-var">uses</span></a></span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208392"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Set JSQName -&gt; Set JSQName -&gt; Set JSQName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208391"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set JSQName -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208394"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208392"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Export -&gt; [Export] -&gt; [Export]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set JSQName -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#reorder%27"><span class="hs-identifier hs-var">reorder'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSQName -&gt; Set JSQName -&gt; Set JSQName
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Export -&gt; JSQName
</span><a href="Agda.Compiler.JS.Syntax.html#expName"><span class="hs-identifier hs-var">expName</span></a></span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208392"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208391"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208393"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set JSQName -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#reorder%27"><span class="hs-identifier hs-var">reorder'</span></a></span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208391"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set JSQName -&gt; Export -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#insertAfter"><span class="hs-identifier hs-var">insertAfter</span></a></span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208394"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208392"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208393"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#isTopLevelValue"><span class="hs-identifier hs-type">isTopLevelValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-369"></span><span id="isTopLevelValue"><span class="annot"><span class="annottext">isTopLevelValue :: Export -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#isTopLevelValue"><span class="hs-identifier hs-var hs-var">isTopLevelValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span> </span><span class="annot"><span class="annottext">JSQName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208398"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208398"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208398"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621682208399"><span class="annot"><span class="annottext">Map MemberId Exp
</span><a href="#local-6989586621682208399"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#flatName"><span class="hs-identifier hs-var">flatName</span></a></span><span> </span><span class="annot"><span class="annottext">MemberId -&gt; Map MemberId Exp -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`Map.member`</span></span><span> </span><span class="annot"><span class="annottext">Map MemberId Exp
</span><a href="#local-6989586621682208399"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#isEmptyObject"><span class="hs-identifier hs-type">isEmptyObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-375"></span><span id="isEmptyObject"><span class="annot"><span class="annottext">isEmptyObject :: Export -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#isEmptyObject"><span class="hs-identifier hs-var hs-var">isEmptyObject</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span> </span><span class="annot"><span class="annottext">JSQName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208402"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208402"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208402"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621682208403"><span class="annot"><span class="annottext">Map MemberId Exp
</span><a href="#local-6989586621682208403"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map MemberId Exp -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Map MemberId Exp
</span><a href="#local-6989586621682208403"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#insertAfter"><span class="hs-identifier hs-type">insertAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#JSQName"><span class="hs-identifier hs-type">JSQName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-381"></span><span id="insertAfter"><span class="annot"><span class="annottext">insertAfter :: Set JSQName -&gt; Export -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#insertAfter"><span class="hs-identifier hs-var hs-var">insertAfter</span></a></span></span><span> </span><span id="local-6989586621682208404"><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208404"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682208405"><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208405"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208405"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#insertAfter"><span class="hs-identifier hs-var">insertAfter</span></a></span><span> </span><span id="local-6989586621682208406"><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208406"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682208407"><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208407"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208408"><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208408"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682208409"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208409"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set JSQName -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208406"><span class="hs-identifier hs-var">us</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208407"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Export -&gt; [Export] -&gt; [Export]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208408"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Export -&gt; [Export] -&gt; [Export]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208409"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-383"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#insertAfter"><span class="hs-identifier hs-var">insertAfter</span></a></span><span> </span><span id="local-6989586621682208410"><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208410"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682208411"><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208411"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208412"><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208412"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682208413"><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208413"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208412"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Export -&gt; [Export] -&gt; [Export]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Set JSQName -&gt; Export -&gt; [Export] -&gt; [Export]
</span><a href="Agda.Compiler.JS.Compiler.html#insertAfter"><span class="hs-identifier hs-var">insertAfter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSQName -&gt; Set JSQName -&gt; Set JSQName
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Export -&gt; JSQName
</span><a href="Agda.Compiler.JS.Syntax.html#expName"><span class="hs-identifier hs-var">expName</span></a></span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208412"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set JSQName
</span><a href="#local-6989586621682208410"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Export
</span><a href="#local-6989586621682208411"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Export]
</span><a href="#local-6989586621682208413"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Main compiling clauses</span><span>
</span><span id="line-388"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-keyword">type</span><span> </span><span id="EnvWithOpts"><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#EnvWithOpts"><span class="hs-identifier hs-var">EnvWithOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSOptions"><span class="hs-identifier hs-type">JSOptions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#JSModuleEnv"><span class="hs-identifier hs-type">JSModuleEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#definition"><span class="hs-identifier hs-type">definition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#EnvWithOpts"><span class="hs-identifier hs-type">EnvWithOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="definition"><span class="annot"><span class="annottext">definition :: EnvWithOpts -&gt; (QName, Definition) -&gt; TCMT IO (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#definition"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span id="local-6989586621682208415"><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208415"><span class="hs-identifier hs-var">kit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208416"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208416"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682208417"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208417"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;compiling def:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208416"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682208421"><span class="annot"><a href="#local-6989586621682208421"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208416"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621682208422"><span class="annot"><a href="#local-6989586621682208422"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208417"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#definition%27"><span class="hs-identifier hs-type">definition'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208415"><span class="hs-identifier hs-type">kit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208416"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208422"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208422"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208421"><span class="hs-identifier hs-type">ls</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="annot"><span class="hs-comment">-- | Ensure that there is at most one pragma for a name.</span></span><span>
</span><span id="line-401"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#checkCompilerPragmas"><span class="hs-identifier hs-type">checkCompilerPragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span id="checkCompilerPragmas"><span class="annot"><span class="annottext">checkCompilerPragmas :: QName -&gt; TCMT IO ()
</span><a href="Agda.Compiler.JS.Compiler.html#checkCompilerPragmas"><span class="hs-identifier hs-var hs-var">checkCompilerPragmas</span></a></span></span><span> </span><span id="local-6989586621682208426"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208426"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO (Maybe CompilerPragma)
-&gt; TCMT IO () -&gt; (CompilerPragma -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; QName -&gt; TCMT IO (Maybe CompilerPragma)
</span><a href="Agda.TypeChecking.Monad.Signature.html#getUniqueCompilerPragma"><span class="hs-identifier hs-var">getUniqueCompilerPragma</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Agda.TypeChecking.Monad.Base.html#jsBackendName"><span class="hs-identifier hs-var">jsBackendName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208426"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((CompilerPragma -&gt; TCMT IO ()) -&gt; TCMT IO ())
-&gt; (CompilerPragma -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CompilerPragma"><span class="hs-identifier hs-type">CompilerPragma</span></a></span><span> </span><span id="local-6989586621682208429"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682208429"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682208430"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208430"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">Range -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682208429"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">-- Issue #3545: Warn user about ignored COMPILE pragma for defined functions.</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208426"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Definition -&gt; (Definition -&gt; Defn) -&gt; TCMT IO Defn
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Defn -&gt; (Defn -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#FunctionDefn"><span class="hs-identifier hs-type">FunctionDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Bool
</span><a href="Agda.Compiler.Treeless.Erase.html#isErasable"><span class="hs-identifier hs-var">isErasable</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208426"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCMT IO ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCMT IO ()) -&gt; Warning -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; QName -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#PragmaCompileErased"><span class="hs-identifier hs-var">PragmaCompileErased</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Agda.TypeChecking.Monad.Base.html#jsBackendName"><span class="hs-identifier hs-var">jsBackendName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208426"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-comment">-- If the pragma is not of the form &quot;q = bla&quot;, complain.</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; Maybe String
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208430"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Maybe String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO ()) -&gt; TypeError -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JSBackendError -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#JSBackendError"><span class="hs-identifier hs-var">JSBackendError</span></a></span><span> </span><span class="annot"><span class="annottext">JSBackendError
</span><a href="Agda.TypeChecking.Monad.Base.html#BadCompilePragma"><span class="hs-identifier hs-var">BadCompilePragma</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-type">defJSDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-414"></span><span id="defJSDef"><span class="annot"><span class="annottext">defJSDef :: Definition -&gt; Maybe String
</span><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-var hs-var">defJSDef</span></a></span></span><span> </span><span id="local-6989586621682208439"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208439"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Definition -&gt; [CompilerPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#defCompilerPragmas"><span class="hs-identifier hs-var">defCompilerPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Agda.TypeChecking.Monad.Base.html#jsBackendName"><span class="hs-identifier hs-var">jsBackendName</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208439"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CompilerPragma"><span class="hs-identifier hs-type">CompilerPragma</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208441"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208441"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621682208442"><span class="hs-identifier hs-var">dropEquals</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208441"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><span class="annottext">CompilerPragma
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">CompilerPragma
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[CompilerPragma]
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621682208442"><span class="annot"><span class="annottext">dropEquals :: String -&gt; String
</span><a href="#local-6989586621682208442"><span class="hs-identifier hs-var hs-var">dropEquals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; String
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">dropWhile</span></span><span> </span><span class="annot"><span class="annottext">((Char -&gt; Bool) -&gt; String -&gt; String)
-&gt; (Char -&gt; Bool) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682208445"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682208445"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682208445"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682208445"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'='</span></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#definition%27"><span class="hs-identifier hs-type">definition'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#EnvWithOpts"><span class="hs-identifier hs-type">EnvWithOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#JSQName"><span class="hs-identifier hs-type">JSQName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span id="definition%27"><span class="annot"><span class="annottext">definition' :: EnvWithOpts
-&gt; QName -&gt; Definition -&gt; Type -&gt; JSQName -&gt; TCMT IO (Maybe Export)
</span><a href="Agda.Compiler.JS.Compiler.html#definition%27"><span class="hs-identifier hs-var hs-var">definition'</span></a></span></span><span> </span><span id="local-6989586621682208447"><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208447"><span class="hs-identifier hs-var">kit</span></a></span></span><span> </span><span id="local-6989586621682208448"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682208449"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682208450"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682208450"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682208451"><span class="annot"><span class="annottext">JSQName
</span><a href="#local-6989586621682208451"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSModuleEnv -&gt; Bool
</span><a href="Agda.Compiler.JS.Compiler.html#jsCompile"><span class="hs-identifier hs-var">jsCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvWithOpts -&gt; JSModuleEnv
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208447"><span class="hs-identifier hs-var">kit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Bool
forall a. LensModality a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#usableModality"><span class="hs-identifier hs-var">usableModality</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Export
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO ()
</span><a href="Agda.Compiler.JS.Compiler.html#checkCompilerPragmas"><span class="hs-identifier hs-var">checkCompilerPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-comment">-- coinduction</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinductionKit -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Builtin.html#nameOfSharp"><span class="hs-identifier hs-var">nameOfSharp</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinductionKit -&gt; QName) -&gt; Maybe CoinductionKit -&gt; Maybe QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">JSModuleEnv -&gt; Maybe CoinductionKit
</span><a href="Agda.Compiler.JS.Compiler.html#jsCoinductionKit"><span class="hs-identifier hs-var">jsCoinductionKit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvWithOpts -&gt; JSModuleEnv
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208447"><span class="hs-identifier hs-var">kit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>      </span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Export
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-434"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinductionKit -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Builtin.html#nameOfFlat"><span class="hs-identifier hs-var">nameOfFlat</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinductionKit -&gt; QName) -&gt; Maybe CoinductionKit -&gt; Maybe QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">JSModuleEnv -&gt; Maybe CoinductionKit
</span><a href="Agda.Compiler.JS.Compiler.html#jsCoinductionKit"><span class="hs-identifier hs-var">jsCoinductionKit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvWithOpts -&gt; JSModuleEnv
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208447"><span class="hs-identifier hs-var">kit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208458"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCMT IO (Maybe Export)) -&gt; Exp -&gt; TCMT IO (Maybe Export)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; MemberId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#flatName"><span class="hs-identifier hs-var">flatName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Export)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682208462"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208462"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Maybe String
</span><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-var">defJSDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208462"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208458"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Export
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682208465"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208465"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Maybe String
</span><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-var">defJSDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208465"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO ()) -&gt; TCMT IO Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;compiling fun:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208466"><span class="annot"><span class="annottext">mTreeless :: TCM (Maybe TTerm)
</span><a href="#local-6989586621682208466"><span class="hs-identifier hs-var hs-var">mTreeless</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvaluationStrategy -&gt; QName -&gt; TCM (Maybe TTerm)
</span><a href="Agda.Compiler.ToTreeless.html#toTreeless"><span class="hs-identifier hs-var">toTreeless</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationStrategy
</span><a href="Agda.Syntax.Treeless.html#EagerEvaluation"><span class="hs-identifier hs-var">T.EagerEvaluation</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-449"></span><span>      </span><span class="annot"><span class="annottext">TCM (Maybe TTerm)
-&gt; TCMT IO (Maybe Export)
-&gt; (TTerm -&gt; TCMT IO (Maybe Export))
-&gt; TCMT IO (Maybe Export)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Maybe a) -&gt; m b -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-var">caseMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Maybe TTerm)
</span><a href="#local-6989586621682208466"><span class="hs-identifier hs-var">mTreeless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe Export
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TTerm -&gt; TCMT IO (Maybe Export)) -&gt; TCMT IO (Maybe Export))
-&gt; (TTerm -&gt; TCMT IO (Maybe Export)) -&gt; TCMT IO (Maybe Export)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682208469"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208469"><span class="hs-identifier hs-var">treeless</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-450"></span><span>        </span><span id="local-6989586621682208470"><span class="annot"><a href="#local-6989586621682208470"><span class="hs-identifier hs-var">used</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ArgUsage] -&gt; Maybe [ArgUsage] -&gt; [ArgUsage]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Maybe [ArgUsage] -&gt; [ArgUsage])
-&gt; TCMT IO (Maybe [ArgUsage]) -&gt; TCMT IO [ArgUsage]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO (Maybe [ArgUsage])
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
QName -&gt; m (Maybe [ArgUsage])
</span><a href="Agda.TypeChecking.Monad.Signature.html#getCompiledArgUse"><span class="hs-identifier hs-var">getCompiledArgUse</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-451"></span><span>        </span><span id="local-6989586621682208472"><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-var">funBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Compiler.Treeless.EliminateDefaults.html#eliminateCaseDefaults"><span class="hs-identifier hs-type">eliminateCaseDefaults</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span>
</span><span id="line-452"></span><span>          </span><span class="annot"><a href="Agda.Compiler.Treeless.EliminateLiteralPatterns.html#eliminateLiteralPatterns"><span class="hs-identifier hs-type">eliminateLiteralPatterns</span></a></span><span>
</span><span id="line-453"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.Treeless.GuardsToPrims.html#convertGuards"><span class="hs-identifier hs-type">convertGuards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208469"><span class="hs-identifier hs-type">treeless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot; compiled treeless fun:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-type">funBody</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot; argument usage:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208470"><span class="hs-identifier hs-type">used</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>        </span><span id="local-6989586621682208478"><span class="annot"><a href="#local-6989586621682208478"><span class="hs-identifier hs-var">funBody'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#compileTerm"><span class="hs-identifier hs-type">compileTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208447"><span class="hs-identifier hs-type">kit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-type">funBody</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;compile.js&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot; compiled JS fun:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208478"><span class="hs-identifier hs-type">funBody'</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-461"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682208478"><span class="hs-identifier hs-type">funBody'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-462"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-type">Export</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208451"><span class="hs-identifier hs-type">ls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208478"><span class="hs-identifier hs-type">funBody'</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">primName :: Defn -&gt; PrimitiveId
</span><a href="Agda.TypeChecking.Monad.Base.html#primName"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208482"><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682208482"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682208482"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; PrimitiveId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtin_glueU"><span class="hs-identifier hs-var">builtin_glueU</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-comment">-- The string prim^glueU is not a valid JS name.</span><span>
</span><span id="line-467"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.prim_glueU&quot;</span></span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682208482"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; PrimitiveId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtin_unglueU"><span class="hs-identifier hs-var">builtin_unglueU</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-comment">-- The string prim^unglueU is not a valid JS name.</span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.prim_unglueU&quot;</span></span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682208482"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; Set PrimitiveId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set PrimitiveId
</span><a href="Agda.Compiler.JS.Compiler.html#primitives"><span class="hs-identifier hs-var">primitives</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO (Maybe Export))
-&gt; String -&gt; TCMT IO (Maybe Export)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; String
forall a. IsBuiltin a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Builtin.html#getBuiltinId"><span class="hs-identifier hs-var">getBuiltinId</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682208482"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-473"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682208488"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208488"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Maybe String
</span><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-var">defJSDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208488"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208458"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Export
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO ()
</span><a href="Agda.Compiler.Treeless.Erase.html#computeErasedConstructorArgs"><span class="hs-identifier hs-var">computeErasedConstructorArgs</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208458"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Substitution.html#emp"><span class="hs-identifier hs-var">emp</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO ()
</span><a href="Agda.Compiler.Treeless.Erase.html#computeErasedConstructorArgs"><span class="hs-identifier hs-var">computeErasedConstructorArgs</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208448"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Export
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682208491"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208491"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Maybe String
</span><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-var">defJSDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208449"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var">plainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208491"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">-- Implements Scott-Encoding of constructor definitions</span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-comment">-- (see the note &quot;Implementing data types&quot;)</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">conData :: Defn -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#conData"><span class="hs-identifier hs-var">conData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208492"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208492"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conPars :: Defn -&gt; Int
</span><a href="Agda.TypeChecking.Monad.Base.html#conPars"><span class="hs-identifier hs-var">conPars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208494"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208494"><span class="hs-identifier hs-var">nc</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682208496"><span class="annot"><a href="#local-6989586621682208496"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *). PureTCM m =&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewPath"><span class="hs-identifier hs-var">telViewPath</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682208450"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-491"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208497"><span class="annot"><a href="#local-6989586621682208497"><span class="hs-identifier hs-var hs-var">nargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom (String, Type)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom (String, Type)]
forall t. Tele (Dom t) -&gt; [Dom (String, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682208496"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208494"><span class="hs-identifier hs-var">nc</span></a></span><span>
</span><span id="line-492"></span><span>          </span><span id="local-6989586621682208499"><span class="annot"><a href="#local-6989586621682208499"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">LocalId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalId -&gt; Exp) -&gt; LocalId -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalId
</span><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-var">LocalId</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LocalId) -&gt; Int -&gt; LocalId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208497"><span class="hs-identifier hs-var">nargs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208500"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682208500"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208500"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208497"><span class="hs-identifier hs-var">nargs</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>      </span><span id="local-6989586621682208501"><span class="annot"><a href="#local-6989586621682208501"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208492"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-494"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208502"><span class="annot"><a href="#local-6989586621682208502"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSQName -&gt; MemberId
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.last</span></span><span> </span><span class="annot"><span class="annottext">JSQName
</span><a href="#local-6989586621682208451"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-495"></span><span>      </span><span class="annot"><a href="#local-6989586621682208458"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#curriedLambda"><span class="hs-identifier hs-type">curriedLambda</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208497"><span class="hs-identifier hs-type">nargs</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208501"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-498"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map MemberId Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MemberId Exp -&gt; Exp)
-&gt; (Exp -&gt; Map MemberId Exp) -&gt; Exp -&gt; Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MemberId -&gt; Exp -&gt; Map MemberId Exp
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">MemberId
</span><a href="#local-6989586621682208502"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-499"></span><span>              </span><span id="local-6989586621682208505"><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682208505"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>  </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-type">LocalId</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208502"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208499"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Export)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-504"></span><span>    </span><span id="local-6989586621682208458"><span class="annot"><span class="annottext">ret :: Exp -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208458"><span class="hs-identifier hs-var hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Export -&gt; TCMT IO (Maybe Export)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Export -&gt; TCMT IO (Maybe Export))
-&gt; (Exp -&gt; Maybe Export) -&gt; Exp -&gt; TCMT IO (Maybe Export)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Export -&gt; Maybe Export
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Export -&gt; Maybe Export) -&gt; (Exp -&gt; Export) -&gt; Exp -&gt; Maybe Export
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">JSQName -&gt; Exp -&gt; Export
</span><a href="Agda.Compiler.JS.Syntax.html#Export"><span class="hs-identifier hs-var">Export</span></a></span><span> </span><span class="annot"><span class="annottext">JSQName
</span><a href="#local-6989586621682208451"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-505"></span><span>    </span><span id="local-6989586621682208463"><span class="annot"><span class="annottext">plainJS :: String -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208463"><span class="hs-identifier hs-var hs-var">plainJS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCMT IO (Maybe Export)
</span><a href="#local-6989586621682208458"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCMT IO (Maybe Export))
-&gt; (String -&gt; Exp) -&gt; String -&gt; TCMT IO (Maybe Export)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#PlainJS"><span class="hs-identifier hs-var">PlainJS</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">-- Implementing data types</span><span>
</span><span id="line-508"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">-- Data types are implemented using a variant of Scott Encoding,</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- which uses JavaScript dicts instead of some lambda-expressions</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="hs-comment">-- For example, given the data type</span><span>
</span><span id="line-514"></span><span class="hs-comment">--</span><span>
</span><span id="line-515"></span><span class="hs-comment">--      data Foo : Set where</span><span>
</span><span id="line-516"></span><span class="hs-comment">--        c1 : Foo</span><span>
</span><span id="line-517"></span><span class="hs-comment">--        c2 : X -&gt; Y -&gt; Foo</span><span>
</span><span id="line-518"></span><span class="hs-comment">--        c3 : Foo -&gt; Foo</span><span>
</span><span id="line-519"></span><span class="hs-comment">--</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- here is how &quot;Foo&quot; is compiled:</span><span>
</span><span id="line-521"></span><span class="hs-comment">--</span><span>
</span><span id="line-522"></span><span class="hs-comment">--  * A constructor definition, e.g.</span><span>
</span><span id="line-523"></span><span class="hs-comment">--</span><span>
</span><span id="line-524"></span><span class="hs-comment">--        c2 : X -&gt; Y -&gt; Foo</span><span>
</span><span id="line-525"></span><span class="hs-comment">--</span><span>
</span><span id="line-526"></span><span class="hs-comment">--    compiles to</span><span>
</span><span id="line-527"></span><span class="hs-comment">--</span><span>
</span><span id="line-528"></span><span class="hs-comment">--        exports[&quot;Foo&quot;][&quot;c2&quot;] = x =&gt; y =&gt; k =&gt; k[&quot;c2&quot;](x,y)</span><span>
</span><span id="line-529"></span><span class="hs-comment">--</span><span>
</span><span id="line-530"></span><span class="hs-comment">--  * A constructor application, e.g.</span><span>
</span><span id="line-531"></span><span class="hs-comment">--</span><span>
</span><span id="line-532"></span><span class="hs-comment">--        c2 x y</span><span>
</span><span id="line-533"></span><span class="hs-comment">--</span><span>
</span><span id="line-534"></span><span class="hs-comment">--    compiles to</span><span>
</span><span id="line-535"></span><span class="hs-comment">--</span><span>
</span><span id="line-536"></span><span class="hs-comment">--        exports[&quot;Foo&quot;][&quot;c2&quot;](x)(y)</span><span>
</span><span id="line-537"></span><span class="hs-comment">--</span><span>
</span><span id="line-538"></span><span class="hs-comment">--  * A case split, e.g.</span><span>
</span><span id="line-539"></span><span class="hs-comment">--</span><span>
</span><span id="line-540"></span><span class="hs-comment">--        case p of</span><span>
</span><span id="line-541"></span><span class="hs-comment">--          (c1    ) -&gt; E1</span><span>
</span><span id="line-542"></span><span class="hs-comment">--          (c2 x y) -&gt; E2</span><span>
</span><span id="line-543"></span><span class="hs-comment">--          (c3 f  ) -&gt; E3</span><span>
</span><span id="line-544"></span><span class="hs-comment">--</span><span>
</span><span id="line-545"></span><span class="hs-comment">--    compiles to</span><span>
</span><span id="line-546"></span><span class="hs-comment">--</span><span>
</span><span id="line-547"></span><span class="hs-comment">--        p(</span><span>
</span><span id="line-548"></span><span class="hs-comment">--          { &quot;c1&quot;: ()    =&gt; E1</span><span>
</span><span id="line-549"></span><span class="hs-comment">--          , &quot;c2&quot;: (x,y) =&gt; E2</span><span>
</span><span id="line-550"></span><span class="hs-comment">--          , &quot;c3&quot;: f     =&gt; E3</span><span>
</span><span id="line-551"></span><span class="hs-comment">--          })</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#compileTerm"><span class="hs-identifier hs-type">compileTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#EnvWithOpts"><span class="hs-identifier hs-type">EnvWithOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TTerm"><span class="hs-identifier hs-type">T.TTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-555"></span><span id="compileTerm"><span class="annot"><span class="annottext">compileTerm :: EnvWithOpts -&gt; TTerm -&gt; TCM Exp
</span><a href="Agda.Compiler.JS.Compiler.html#compileTerm"><span class="hs-identifier hs-var hs-var">compileTerm</span></a></span></span><span> </span><span id="local-6989586621682208508"><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208508"><span class="hs-identifier hs-var">kit</span></a></span></span><span> </span><span id="local-6989586621682208509"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208509"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208509"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-557"></span><span>    </span><span class="annot"><a href="#local-6989586621682208510"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TTerm"><span class="hs-identifier hs-type">T.TTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span id="local-6989586621682208510"><span class="annot"><span class="annottext">go :: TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-559"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TVar"><span class="hs-identifier hs-type">T.TVar</span></a></span><span> </span><span id="local-6989586621682208512"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208512"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCM Exp) -&gt; Exp -&gt; TCM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocalId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalId -&gt; Exp) -&gt; LocalId -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalId
</span><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-var">LocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208512"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TDef"><span class="hs-identifier hs-type">T.TDef</span></a></span><span> </span><span id="local-6989586621682208514"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208514"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-561"></span><span>        </span><span id="local-6989586621682208515"><span class="annot"><a href="#local-6989586621682208515"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208514"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208515"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-563"></span><span>          </span><span class="hs-comment">-- Datatypes and records are erased</span><span>
</span><span id="line-564"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>          </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM Exp
</span><a href="Agda.Compiler.JS.Compiler.html#qname"><span class="hs-identifier hs-var">qname</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208514"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-567"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TApp"><span class="hs-identifier hs-type">T.TApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Treeless.html#TCon"><span class="hs-identifier hs-type">T.TCon</span></a></span><span> </span><span id="local-6989586621682208519"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208519"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682208520"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208520"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208519"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoinductionKit -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Builtin.html#nameOfSharp"><span class="hs-identifier hs-var">nameOfSharp</span></a></span><span> </span><span class="annot"><span class="annottext">(CoinductionKit -&gt; QName) -&gt; Maybe CoinductionKit -&gt; Maybe QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">JSModuleEnv -&gt; Maybe CoinductionKit
</span><a href="Agda.Compiler.JS.Compiler.html#jsCoinductionKit"><span class="hs-identifier hs-var">jsCoinductionKit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvWithOpts -&gt; JSModuleEnv
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208508"><span class="hs-identifier hs-var">kit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>        </span><span id="local-6989586621682208521"><span class="annot"><a href="#local-6989586621682208521"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208520"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208522"><span class="annot"><a href="#local-6989586621682208522"><span class="hs-identifier hs-var hs-var">evalThunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-571"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;function() {&quot;</span></span><span>
</span><span id="line-572"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  delete this.flat;&quot;</span></span><span>
</span><span id="line-573"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  var result = this.__flat_helper();&quot;</span></span><span>
</span><span id="line-574"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  delete this.__flat_helper;&quot;</span></span><span>
</span><span id="line-575"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  this.flat = function() { return result; };&quot;</span></span><span>
</span><span id="line-576"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  return result;&quot;</span></span><span>
</span><span id="line-577"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;}&quot;</span></span><span>
</span><span id="line-578"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.fromListWith</span></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-580"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#flatName"><span class="hs-identifier hs-type">flatName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#PlainJS"><span class="hs-identifier hs-type">PlainJS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208522"><span class="hs-identifier hs-type">evalThunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-type">MemberId</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;__flat_helper&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621682208521"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-582"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TApp"><span class="hs-identifier hs-type">T.TApp</span></a></span><span> </span><span id="local-6989586621682208525"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208525"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682208526"><span class="annot"><span class="annottext">[TTerm]
</span><a href="#local-6989586621682208526"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>            </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#curriedApply"><span class="hs-identifier hs-var">curriedApply</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; [Exp] -&gt; Exp) -&gt; TCM Exp -&gt; TCMT IO ([Exp] -&gt; Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208525"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO ([Exp] -&gt; Exp) -&gt; TCMT IO [Exp] -&gt; TCM Exp
forall a b. TCMT IO (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TTerm -&gt; TCM Exp) -&gt; [TTerm] -&gt; TCMT IO [Exp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[TTerm]
</span><a href="#local-6989586621682208526"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-584"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TLam"><span class="hs-identifier hs-type">T.TLam</span></a></span><span> </span><span id="local-6989586621682208529"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208529"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; TCM Exp -&gt; TCM Exp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208529"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-comment">-- `let x = t in e` is compiled to `(x =&gt; e[x()/x])(() =&gt; t)` so that `t`</span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-comment">-- is only evaluated inside the body</span><span>
</span><span id="line-587"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TLet"><span class="hs-identifier hs-type">T.TLet</span></a></span><span> </span><span id="local-6989586621682208531"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208531"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682208532"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208532"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-588"></span><span>        </span><span id="local-6989586621682208533"><span class="annot"><a href="#local-6989586621682208533"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; TCM Exp -&gt; TCM Exp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208531"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-589"></span><span>        </span><span id="local-6989586621682208534"><span class="annot"><a href="#local-6989586621682208534"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#substShift"><span class="hs-identifier hs-type">substShift</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-type">LocalId</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682208510"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208532"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-590"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621682208534"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682208533"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-591"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TLit"><span class="hs-identifier hs-type">T.TLit</span></a></span><span> </span><span id="local-6989586621682208536"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682208536"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCM Exp) -&gt; Exp -&gt; TCM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#literal"><span class="hs-identifier hs-var">literal</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682208536"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-592"></span><span>      </span><span class="hs-comment">-- Implements Scott-Encoding of constructor applications</span><span>
</span><span id="line-593"></span><span>      </span><span class="hs-comment">-- (see the note &quot;Implementing data types&quot;)</span><span>
</span><span id="line-594"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TCon"><span class="hs-identifier hs-type">T.TCon</span></a></span><span> </span><span id="local-6989586621682208538"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208538"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM Exp
</span><a href="Agda.Compiler.JS.Compiler.html#qname"><span class="hs-identifier hs-var">qname</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208538"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-comment">-- Implements Scott-Encoding of case splits</span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-comment">-- (see the note &quot;Implementing data types&quot;)</span><span>
</span><span id="line-597"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TCase"><span class="hs-identifier hs-type">T.TCase</span></a></span><span> </span><span id="local-6989586621682208540"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208540"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621682208541"><span class="annot"><span class="annottext">CaseInfo
</span><a href="#local-6989586621682208541"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621682208542"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208542"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621682208543"><span class="annot"><span class="annottext">[TAlt]
</span><a href="#local-6989586621682208543"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#CTData"><span class="hs-identifier hs-type">T.CTData</span></a></span><span> </span><span id="local-6989586621682208545"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208545"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CaseInfo -&gt; CaseType
</span><a href="Agda.Syntax.Treeless.html#caseType"><span class="hs-identifier hs-var">T.caseType</span></a></span><span> </span><span class="annot"><span class="annottext">CaseInfo
</span><a href="#local-6989586621682208541"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-598"></span><span>        </span><span id="local-6989586621682208547"><span class="annot"><a href="#local-6989586621682208547"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208545"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-599"></span><span>        </span><span id="local-6989586621682208548"><span class="annot"><a href="#local-6989586621682208548"><span class="hs-identifier hs-var">alts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#compileAlt"><span class="hs-identifier hs-type">compileAlt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208508"><span class="hs-identifier hs-type">kit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208543"><span class="hs-identifier hs-type">alts</span></a></span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208551"><span class="annot"><a href="#local-6989586621682208551"><span class="hs-identifier hs-var hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map MemberId Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MemberId Exp -&gt; Exp) -&gt; Map MemberId Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; [(MemberId, Exp)] -&gt; Map MemberId Exp
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">[(MemberId, Exp)]
</span><a href="#local-6989586621682208548"><span class="hs-identifier hs-var">alts'</span></a></span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208547"><span class="hs-identifier hs-type">dt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#defJSDef"><span class="hs-identifier hs-type">defJSDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208547"><span class="hs-identifier hs-type">dt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-602"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682208552"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208552"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-603"></span><span>            </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCM Exp) -&gt; Exp -&gt; TCM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#PlainJS"><span class="hs-identifier hs-var">PlainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208552"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocalId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LocalId
</span><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-var">LocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208540"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208551"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-604"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-605"></span><span>            </span><span id="local-6989586621682208553"><span class="annot"><a href="#local-6989586621682208553"><span class="hs-identifier hs-var">memId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#visitorName"><span class="hs-identifier hs-var">visitorName</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCM MemberId) -&gt; QName -&gt; TCM MemberId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Defn -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#recCon"><span class="hs-identifier hs-var">recCon</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; QName) -&gt; Defn -&gt; QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682208547"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-606"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Substitution.html#apply"><span class="hs-identifier hs-type">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-type">LocalId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208540"><span class="hs-identifier hs-type">sc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208553"><span class="hs-identifier hs-type">memId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682208551"><span class="hs-identifier hs-type">obj</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-607"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>            </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCM Exp) -&gt; Exp -&gt; TCM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#curriedApply"><span class="hs-identifier hs-var">curriedApply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LocalId
</span><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-var">LocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208540"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208551"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-609"></span><span>          </span><span class="annot"><span class="annottext">(Defn, Maybe String)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TCase"><span class="hs-identifier hs-type">T.TCase</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CaseInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TAlt]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TPrim"><span class="hs-identifier hs-type">T.TPrim</span></a></span><span> </span><span id="local-6989586621682208557"><span class="annot"><span class="annottext">TPrim
</span><a href="#local-6989586621682208557"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TCM Exp) -&gt; Exp -&gt; TCM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TPrim -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#compilePrim"><span class="hs-identifier hs-var">compilePrim</span></a></span><span> </span><span class="annot"><span class="annottext">TPrim
</span><a href="#local-6989586621682208557"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-613"></span><span>      </span><span class="annot"><span class="annottext">TTerm
</span><a href="Agda.Syntax.Treeless.html#TUnit"><span class="hs-identifier hs-var">T.TUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Exp
</span><a href="#local-6989586621682208560"><span class="hs-keyword hs-var">unit</span></a></span><span>
</span><span id="line-614"></span><span>      </span><span class="annot"><span class="annottext">TTerm
</span><a href="Agda.Syntax.Treeless.html#TSort"><span class="hs-identifier hs-var">T.TSort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Exp
</span><a href="#local-6989586621682208560"><span class="hs-keyword hs-var">unit</span></a></span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><span class="annottext">TTerm
</span><a href="Agda.Syntax.Treeless.html#TErased"><span class="hs-identifier hs-var">T.TErased</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM Exp
</span><a href="#local-6989586621682208560"><span class="hs-keyword hs-var">unit</span></a></span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TError"><span class="hs-identifier hs-type">T.TError</span></a></span><span> </span><span class="annot"><span class="annottext">TError
</span><a href="Agda.Syntax.Treeless.html#TUnreachable"><span class="hs-identifier hs-var">T.TUnreachable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span>
</span><span id="line-617"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TError"><span class="hs-identifier hs-type">T.TError</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TMeta"><span class="hs-identifier hs-type">T.TMeta</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TCoerce"><span class="hs-identifier hs-type">T.TCoerce</span></a></span><span> </span><span id="local-6989586621682208567"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208567"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TTerm -&gt; TCM Exp
</span><a href="#local-6989586621682208510"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208567"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>    </span><span id="local-6989586621682208560"><span class="annot"><span class="annottext">unit :: TCM Exp
</span><a href="#local-6989586621682208560"><span class="hs-keyword hs-var hs-var">unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCM Exp
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Null"><span class="hs-identifier hs-var">Null</span></a></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#compilePrim"><span class="hs-identifier hs-type">compilePrim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TPrim"><span class="hs-identifier hs-type">T.TPrim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-624"></span><span id="compilePrim"><span class="annot"><span class="annottext">compilePrim :: TPrim -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#compilePrim"><span class="hs-identifier hs-var hs-var">compilePrim</span></a></span></span><span> </span><span id="local-6989586621682208571"><span class="annot"><span class="annottext">TPrim
</span><a href="#local-6989586621682208571"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TPrim
</span><a href="#local-6989586621682208571"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PIf"><span class="hs-identifier hs-var">T.PIf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#curriedLambda"><span class="hs-identifier hs-var">curriedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PEqI"><span class="hs-identifier hs-var">T.PEqI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerEqual&quot;</span></span><span>
</span><span id="line-628"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PEqF"><span class="hs-identifier hs-var">T.PEqF</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimFloatEquality&quot;</span></span><span>
</span><span id="line-629"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PEqQ"><span class="hs-identifier hs-var">T.PEqQ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimQNameEquality&quot;</span></span><span>
</span><span id="line-630"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PEqS"><span class="hs-identifier hs-var">T.PEqS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208578"><span class="hs-identifier hs-var">primEq</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PEqC"><span class="hs-identifier hs-var">T.PEqC</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621682208578"><span class="hs-identifier hs-var">primEq</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PGeq"><span class="hs-identifier hs-var">T.PGeq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerGreaterOrEqualThan&quot;</span></span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PLt"><span class="hs-identifier hs-var">T.PLt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerLessThan&quot;</span></span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PAdd"><span class="hs-identifier hs-var">T.PAdd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerPlus&quot;</span></span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PSub"><span class="hs-identifier hs-var">T.PSub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerMinus&quot;</span></span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PMul"><span class="hs-identifier hs-var">T.PMul</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerMultiply&quot;</span></span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PRem"><span class="hs-identifier hs-var">T.PRem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerRem&quot;</span></span><span>
</span><span id="line-638"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PQuot"><span class="hs-identifier hs-var">T.PQuot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerQuot&quot;</span></span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PAdd64"><span class="hs-identifier hs-var">T.PAdd64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimWord64Plus&quot;</span></span><span>
</span><span id="line-640"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PSub64"><span class="hs-identifier hs-var">T.PSub64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimWord64Minus&quot;</span></span><span>
</span><span id="line-641"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PMul64"><span class="hs-identifier hs-var">T.PMul64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimWord64Multiply&quot;</span></span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PRem64"><span class="hs-identifier hs-var">T.PRem64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerRem&quot;</span></span><span>     </span><span class="hs-comment">-- -|</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PQuot64"><span class="hs-identifier hs-var">T.PQuot64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerQuot&quot;</span></span><span>   </span><span class="hs-comment">--  &gt; These can use the integer functions</span><span>
</span><span id="line-644"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PEq64"><span class="hs-identifier hs-var">T.PEq64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerEqual&quot;</span></span><span>    </span><span class="hs-comment">--  |</span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PLt64"><span class="hs-identifier hs-var">T.PLt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.uprimIntegerLessThan&quot;</span></span><span> </span><span class="hs-comment">-- -|</span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PITo64"><span class="hs-identifier hs-var">T.PITo64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208595"><span class="hs-identifier hs-var">unOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.primWord64FromNat&quot;</span></span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#P64ToI"><span class="hs-identifier hs-var">T.P64ToI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208595"><span class="hs-identifier hs-var">unOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.primWord64ToNat&quot;</span></span><span>
</span><span id="line-648"></span><span>    </span><span class="annot"><span class="annottext">TPrim
</span><a href="Agda.Syntax.Treeless.html#PSeq"><span class="hs-identifier hs-var">T.PSeq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;agdaRTS.primSeq&quot;</span></span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682208574"><span class="annot"><span class="annottext">binOp :: String -&gt; Exp
</span><a href="#local-6989586621682208574"><span class="hs-identifier hs-var hs-var">binOp</span></a></span></span><span> </span><span id="local-6989586621682208598"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208598"><span class="hs-identifier hs-var">js</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#curriedLambda"><span class="hs-identifier hs-var">curriedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#PlainJS"><span class="hs-identifier hs-var">PlainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208598"><span class="hs-identifier hs-var">js</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span>        </span><span id="local-6989586621682208595"><span class="annot"><span class="annottext">unOp :: String -&gt; Exp
</span><a href="#local-6989586621682208595"><span class="hs-identifier hs-var hs-var">unOp</span></a></span></span><span> </span><span id="local-6989586621682208599"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208599"><span class="hs-identifier hs-var">js</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#curriedLambda"><span class="hs-identifier hs-var">curriedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#PlainJS"><span class="hs-identifier hs-var">PlainJS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208599"><span class="hs-identifier hs-var">js</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>        </span><span id="local-6989586621682208578"><span class="annot"><span class="annottext">primEq :: Exp
</span><a href="#local-6989586621682208578"><span class="hs-identifier hs-var hs-var">primEq</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Substitution.html#curriedLambda"><span class="hs-identifier hs-var">curriedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; String -&gt; Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;===&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">-- Implements Scott-Encoding of case split cases</span><span>
</span><span id="line-654"></span><span class="hs-comment">-- (see the note &quot;Implementing data types&quot;)</span><span>
</span><span id="line-655"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#compileAlt"><span class="hs-identifier hs-type">compileAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#EnvWithOpts"><span class="hs-identifier hs-type">EnvWithOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TAlt"><span class="hs-identifier hs-type">T.TAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-type">MemberId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span id="compileAlt"><span class="annot"><span class="annottext">compileAlt :: EnvWithOpts -&gt; TAlt -&gt; TCMT IO (MemberId, Exp)
</span><a href="Agda.Compiler.JS.Compiler.html#compileAlt"><span class="hs-identifier hs-var hs-var">compileAlt</span></a></span></span><span> </span><span id="local-6989586621682208600"><span class="annot"><span class="annottext">EnvWithOpts
</span><a href="#local-6989586621682208600"><span class="hs-identifier hs-var">kit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-657"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Treeless.html#TACon"><span class="hs-identifier hs-type">T.TACon</span></a></span><span> </span><span id="local-6989586621682208602"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208602"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682208603"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208603"><span class="hs-identifier hs-var">nargs</span></a></span></span><span> </span><span id="local-6989586621682208604"><span class="annot"><span class="annottext">TTerm
</span><a href="#local-6989586621682208604"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-658"></span><span>    </span><span id="local-6989586621682208605"><span class="annot"><a href="#local-6989586621682208605"><span class="hs-identifier hs-var">memId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#visitorName"><span class="hs-identifier hs-var">visitorName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208602"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621682208606"><span class="annot"><a href="#local-6989586621682208606"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208603"><span class="hs-identifier hs-type">nargs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#compileTerm"><span class="hs-identifier hs-type">compileTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208600"><span class="hs-identifier hs-type">kit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208604"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682208605"><span class="hs-identifier hs-type">memId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208606"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>  </span><span class="annot"><span class="annottext">TAlt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO (MemberId, Exp)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#visitorName"><span class="hs-identifier hs-type">visitorName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-type">MemberId</span></a></span><span>
</span><span id="line-664"></span><span id="visitorName"><span class="annot"><span class="annottext">visitorName :: QName -&gt; TCM MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#visitorName"><span class="hs-identifier hs-var hs-var">visitorName</span></a></span></span><span> </span><span id="local-6989586621682208607"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208607"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSQName -&gt; MemberId
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.last</span></span><span> </span><span class="annot"><span class="annottext">(JSQName -&gt; MemberId)
-&gt; ((Exp, JSQName) -&gt; JSQName) -&gt; (Exp, JSQName) -&gt; MemberId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Exp, JSQName) -&gt; JSQName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Exp, JSQName) -&gt; MemberId) -&gt; TCM (Exp, JSQName) -&gt; TCM MemberId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208607"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#flatName"><span class="hs-identifier hs-type">flatName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-type">MemberId</span></a></span><span>
</span><span id="line-667"></span><span id="flatName"><span class="annot"><span class="annottext">flatName :: MemberId
</span><a href="Agda.Compiler.JS.Compiler.html#flatName"><span class="hs-identifier hs-var hs-var">flatName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;flat&quot;</span></span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-type">local</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-670"></span><span id="local"><span class="annot"><span class="annottext">local :: Int -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#local"><span class="hs-identifier hs-var hs-var">local</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalId -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalId -&gt; Exp) -&gt; (Int -&gt; LocalId) -&gt; Int -&gt; Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalId
</span><a href="Agda.Compiler.JS.Syntax.html#LocalId"><span class="hs-identifier hs-var">LocalId</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#qname"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-673"></span><span id="qname"><span class="annot"><span class="annottext">qname :: QName -&gt; TCM Exp
</span><a href="Agda.Compiler.JS.Compiler.html#qname"><span class="hs-identifier hs-var hs-var">qname</span></a></span></span><span> </span><span id="local-6989586621682208609"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208609"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682208610"><span class="annot"><a href="#local-6989586621682208610"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682208611"><span class="annot"><a href="#local-6989586621682208611"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM (Exp, JSQName)
</span><a href="Agda.Compiler.JS.Compiler.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208609"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">foldl</span></span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208610"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208611"><span class="hs-identifier hs-type">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#literal"><span class="hs-identifier hs-type">literal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-678"></span><span id="literal"><span class="annot"><span class="annottext">literal :: Literal -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#literal"><span class="hs-identifier hs-var hs-var">literal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitNat"><span class="hs-identifier hs-type">LitNat</span></a></span><span>    </span><span id="local-6989586621682208614"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682208614"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682208614"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitWord64"><span class="hs-identifier hs-type">LitWord64</span></a></span><span> </span><span id="local-6989586621682208616"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208616"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208616"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span>  </span><span id="local-6989586621682208618"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682208618"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Double"><span class="hs-identifier hs-var">Double</span></a></span><span>  </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682208618"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682208620"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682208620"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span>  </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682208620"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span>   </span><span id="local-6989586621682208622"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682208622"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Char"><span class="hs-identifier hs-var">Char</span></a></span><span>    </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682208622"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitQName"><span class="hs-identifier hs-type">LitQName</span></a></span><span>  </span><span id="local-6989586621682208624"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208624"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#litqname"><span class="hs-identifier hs-var">litqname</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208624"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-685"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Literal.html#LitMeta"><span class="hs-identifier hs-type">LitMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682208627"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682208627"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#litmeta"><span class="hs-identifier hs-var">litmeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682208627"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#litqname"><span class="hs-identifier hs-type">litqname</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-688"></span><span id="litqname"><span class="annot"><span class="annottext">litqname :: QName -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#litqname"><span class="hs-identifier hs-var hs-var">litqname</span></a></span></span><span> </span><span id="local-6989586621682208629"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208629"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="annottext">Map MemberId Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MemberId Exp -&gt; Exp) -&gt; Map MemberId Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; [(MemberId, Exp)] -&gt; Map MemberId Exp
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-690"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Exp) -&gt; Integer -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208631"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;moduleId&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Exp) -&gt; Integer -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208632"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;name&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Exp) -&gt; Text -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208629"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fixity&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; Exp
</span><a href="#local-6989586621682208634"><span class="hs-identifier hs-var">litfixity</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621682208635"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-695"></span><span>    </span><span id="local-6989586621682208630"><span class="annot"><span class="annottext">mem :: String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var hs-var">mem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-type">NameId</span></a></span><span> </span><span id="local-6989586621682208631"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208631"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.Boot.html#ModuleNameHash"><span class="hs-identifier hs-type">ModuleNameHash</span></a></span><span> </span><span id="local-6989586621682208632"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208632"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NameId) -&gt; Name -&gt; NameId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208629"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-697"></span><span>    </span><span id="local-6989586621682208635"><span class="annot"><span class="annottext">fx :: Fixity
</span><a href="#local-6989586621682208635"><span class="hs-identifier hs-var hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fixity' -&gt; Fixity
</span><a href="Agda.Syntax.Common.html#theFixity"><span class="hs-identifier hs-var">theFixity</span></a></span><span> </span><span class="annot"><span class="annottext">(Fixity' -&gt; Fixity) -&gt; Fixity' -&gt; Fixity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity'
</span><a href="Agda.Syntax.Abstract.Name.html#nameFixity"><span class="hs-identifier hs-var">nameFixity</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Fixity') -&gt; Name -&gt; Fixity'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208629"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>    </span><span class="annot"><a href="#local-6989586621682208634"><span class="hs-identifier hs-type">litfixity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-700"></span><span>    </span><span id="local-6989586621682208634"><span class="annot"><span class="annottext">litfixity :: Fixity -&gt; Exp
</span><a href="#local-6989586621682208634"><span class="hs-identifier hs-var hs-var">litfixity</span></a></span></span><span> </span><span id="local-6989586621682208639"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621682208639"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map MemberId Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MemberId Exp -&gt; Exp) -&gt; Map MemberId Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; [(MemberId, Exp)] -&gt; Map MemberId Exp
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assoc&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Associativity -&gt; Exp
</span><a href="#local-6989586621682208640"><span class="hs-identifier hs-var">litAssoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Associativity -&gt; Exp) -&gt; Associativity -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; Associativity
</span><a href="Agda.Syntax.Common.html#fixityAssoc"><span class="hs-identifier hs-var">fixityAssoc</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621682208639"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="#local-6989586621682208630"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;prec&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FixityLevel -&gt; Exp
</span><a href="#local-6989586621682208642"><span class="hs-identifier hs-var">litPrec</span></a></span><span> </span><span class="annot"><span class="annottext">(FixityLevel -&gt; Exp) -&gt; FixityLevel -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; FixityLevel
</span><a href="Agda.Syntax.Common.html#fixityLevel"><span class="hs-identifier hs-var">fixityLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621682208639"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-comment">-- TODO this will probably not work well together with the necessary FFI bindings</span><span>
</span><span id="line-705"></span><span>    </span><span id="local-6989586621682208640"><span class="annot"><span class="annottext">litAssoc :: Associativity -&gt; Exp
</span><a href="#local-6989586621682208640"><span class="hs-identifier hs-var hs-var">litAssoc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Associativity
</span><a href="Agda.Syntax.Common.html#NonAssoc"><span class="hs-identifier hs-var">NonAssoc</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;non-assoc&quot;</span></span><span>
</span><span id="line-706"></span><span>    </span><span class="annot"><a href="#local-6989586621682208640"><span class="hs-identifier hs-var">litAssoc</span></a></span><span> </span><span class="annot"><span class="annottext">Associativity
</span><a href="Agda.Syntax.Common.html#LeftAssoc"><span class="hs-identifier hs-var">LeftAssoc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;left-assoc&quot;</span></span><span>
</span><span id="line-707"></span><span>    </span><span class="annot"><a href="#local-6989586621682208640"><span class="hs-identifier hs-var">litAssoc</span></a></span><span> </span><span class="annot"><span class="annottext">Associativity
</span><a href="Agda.Syntax.Common.html#RightAssoc"><span class="hs-identifier hs-var">RightAssoc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;right-assoc&quot;</span></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>    </span><span id="local-6989586621682208642"><span class="annot"><span class="annottext">litPrec :: FixityLevel -&gt; Exp
</span><a href="#local-6989586621682208642"><span class="hs-identifier hs-var hs-var">litPrec</span></a></span></span><span> </span><span class="annot"><span class="annottext">FixityLevel
</span><a href="Agda.Syntax.Common.html#Unrelated"><span class="hs-identifier hs-var">Unrelated</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unrelated&quot;</span></span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="#local-6989586621682208642"><span class="hs-identifier hs-var">litPrec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Related"><span class="hs-identifier hs-type">Related</span></a></span><span> </span><span id="local-6989586621682208653"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682208653"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Double"><span class="hs-identifier hs-var">Double</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682208653"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#litmeta"><span class="hs-identifier hs-type">litmeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-713"></span><span id="litmeta"><span class="annot"><span class="annottext">litmeta :: MetaId -&gt; Exp
</span><a href="Agda.Compiler.JS.Compiler.html#litmeta"><span class="hs-identifier hs-var hs-var">litmeta</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span id="local-6989586621682208655"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208655"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682208656"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682208656"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-714"></span><span>  </span><span class="annot"><span class="annottext">Map MemberId Exp -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">(Map MemberId Exp -&gt; Exp) -&gt; Map MemberId Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; [(MemberId, Exp)] -&gt; Map MemberId Exp
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-715"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Exp) -&gt; Integer -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682208655"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MemberId
</span><a href="Agda.Compiler.JS.Syntax.html#MemberId"><span class="hs-identifier hs-var">MemberId</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;module&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Exp
</span><a href="Agda.Compiler.JS.Syntax.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Exp) -&gt; Integer -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Integer) -&gt; Word64 -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; Word64
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameHash"><span class="hs-identifier hs-var">moduleNameHash</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682208656"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-720"></span><span class="hs-comment">-- Writing out an ECMAScript module</span><span>
</span><span id="line-721"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#writeModule"><span class="hs-identifier hs-type">writeModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSModuleStyle"><span class="hs-identifier hs-type">JSModuleStyle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span id="writeModule"><span class="annot"><span class="annottext">writeModule :: Bool -&gt; JSModuleStyle -&gt; Module -&gt; TCMT IO ()
</span><a href="Agda.Compiler.JS.Compiler.html#writeModule"><span class="hs-identifier hs-var hs-var">writeModule</span></a></span></span><span> </span><span id="local-6989586621682208658"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208658"><span class="hs-identifier hs-var">minify</span></a></span></span><span> </span><span id="local-6989586621682208659"><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="#local-6989586621682208659"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621682208660"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682208660"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>  </span><span id="local-6989586621682208661"><span class="annot"><a href="#local-6989586621682208661"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">JSModuleStyle -&gt; GlobalId -&gt; TCMT IO String
</span><a href="Agda.Compiler.JS.Compiler.html#outFile"><span class="hs-identifier hs-var">outFile</span></a></span><span> </span><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="#local-6989586621682208659"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GlobalId
</span><a href="Agda.Compiler.JS.Syntax.html#modName"><span class="hs-identifier hs-var">modName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682208660"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.IO.UTF8.html#writeFile"><span class="hs-identifier hs-type">writeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208661"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#prettyShow"><span class="hs-identifier hs-type">JSPretty.prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208658"><span class="hs-identifier hs-type">minify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208659"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#outFile"><span class="hs-identifier hs-type">outFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Pretty.html#JSModuleStyle"><span class="hs-identifier hs-type">JSModuleStyle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Compiler.JS.Syntax.html#GlobalId"><span class="hs-identifier hs-type">GlobalId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-729"></span><span id="outFile"><span class="annot"><span class="annottext">outFile :: JSModuleStyle -&gt; GlobalId -&gt; TCMT IO String
</span><a href="Agda.Compiler.JS.Compiler.html#outFile"><span class="hs-identifier hs-var hs-var">outFile</span></a></span></span><span> </span><span id="local-6989586621682208663"><span class="annot"><span class="annottext">JSModuleStyle
</span><a href="#local-6989586621682208663"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621682208664"><span class="annot"><span class="annottext">GlobalId
</span><a href="#local-6989586621682208664"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-730"></span><span>  </span><span id="local-6989586621682208665"><span class="annot"><a href="#local-6989586621682208665"><span class="hs-identifier hs-var">mdir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO String
forall (m :: * -&gt; *). HasOptions m =&gt; m String
</span><a href="Agda.Compiler.Common.html#compileDir"><span class="hs-identifier hs-var">compileDir</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208666"><span class="annot"><a href="#local-6989586621682208666"><span class="hs-identifier hs-var">fdir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208667"><span class="annot"><a href="#local-6989586621682208667"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitFileName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#jsFileName"><span class="hs-identifier hs-type">jsFileName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208663"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208664"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208668"><span class="annot"><a href="#local-6989586621682208668"><span class="hs-identifier hs-var hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208665"><span class="hs-identifier hs-var">mdir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208666"><span class="hs-identifier hs-var">fdir</span></a></span><span>
</span><span id="line-733"></span><span>      </span><span id="local-6989586621682208669"><span class="annot"><a href="#local-6989586621682208669"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208668"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682208667"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-734"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621682208668"><span class="hs-identifier hs-type">dir</span></a></span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682208669"><span class="hs-identifier hs-type">fp</span></a></span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="hs-comment">-- | Primitives implemented in the JS Agda RTS.</span><span>
</span><span id="line-738"></span><span class="hs-comment">--</span><span>
</span><span id="line-739"></span><span class="hs-comment">-- TODO: Primitives that are not part of this set, and for which</span><span>
</span><span id="line-740"></span><span class="hs-comment">-- 'defJSDef' does not return anything, are silently compiled to</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- 'Undefined'. A better approach might be to list exactly those</span><span>
</span><span id="line-742"></span><span class="hs-comment">-- primitives which should be compiled to 'Undefined'.</span><span>
</span><span id="line-743"></span><span class="annot"><a href="Agda.Compiler.JS.Compiler.html#primitives"><span class="hs-identifier hs-type">primitives</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#PrimitiveId"><span class="hs-identifier hs-type">PrimitiveId</span></a></span><span>
</span><span id="line-744"></span><span id="primitives"><span class="annot"><span class="annottext">primitives :: Set PrimitiveId
</span><a href="Agda.Compiler.JS.Compiler.html#primitives"><span class="hs-identifier hs-var hs-var">primitives</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimitiveId] -&gt; Set PrimitiveId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowInteger"><span class="hs-identifier hs-var">PrimShowInteger</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-comment">-- Natural number functions</span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-comment">-- , PrimNatPlus                 -- missing</span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatMinus"><span class="hs-identifier hs-var">PrimNatMinus</span></a></span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-comment">-- , PrimNatTimes                -- missing</span><span>
</span><span id="line-751"></span><span>  </span><span class="hs-comment">-- , PrimNatDivSucAux            -- missing</span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-comment">-- , PrimNatModSucAux            -- missing</span><span>
</span><span id="line-753"></span><span>  </span><span class="hs-comment">-- , PrimNatEquality             -- missing</span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-comment">-- , PrimNatLess                 -- missing</span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-comment">-- , PrimShowNat                 -- missing</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-comment">-- Machine words</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimWord64ToNat"><span class="hs-identifier hs-var">PrimWord64ToNat</span></a></span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimWord64FromNat"><span class="hs-identifier hs-var">PrimWord64FromNat</span></a></span><span>
</span><span id="line-760"></span><span>  </span><span class="hs-comment">-- , PrimWord64ToNatInjective    -- missing</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span>  </span><span class="hs-comment">-- Level functions</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-comment">-- , PrimLevelZero               -- missing</span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-comment">-- , PrimLevelSuc                -- missing</span><span>
</span><span id="line-765"></span><span>  </span><span class="hs-comment">-- , PrimLevelMax                -- missing</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-comment">-- Floating point functions</span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatEquality"><span class="hs-identifier hs-var">PrimFloatEquality</span></a></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatInequality"><span class="hs-identifier hs-var">PrimFloatInequality</span></a></span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatLess"><span class="hs-identifier hs-var">PrimFloatLess</span></a></span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsInfinite"><span class="hs-identifier hs-var">PrimFloatIsInfinite</span></a></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsNaN"><span class="hs-identifier hs-var">PrimFloatIsNaN</span></a></span><span>
</span><span id="line-773"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsNegativeZero"><span class="hs-identifier hs-var">PrimFloatIsNegativeZero</span></a></span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatIsSafeInteger"><span class="hs-identifier hs-var">PrimFloatIsSafeInteger</span></a></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatToWord64"><span class="hs-identifier hs-var">PrimFloatToWord64</span></a></span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-comment">-- , PrimFloatToWord64Injective  -- missing</span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimNatToFloat"><span class="hs-identifier hs-var">PrimNatToFloat</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimIntToFloat"><span class="hs-identifier hs-var">PrimIntToFloat</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-comment">-- , PrimFloatRound              -- in Agda.Builtin.Float</span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-comment">-- , PrimFloatFloor              -- in Agda.Builtin.Float</span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-comment">-- , PrimFloatCeiling            -- in Agda.Builtin.Float</span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-comment">-- , PrimFloatToRatio            -- in Agda.Builtin.Float</span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimRatioToFloat"><span class="hs-identifier hs-var">PrimRatioToFloat</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-comment">-- , PrimFloatDecode             -- in Agda.Builtin.Float</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-comment">-- , PrimFloatEncode             -- in Agda.Builtin.Float</span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowFloat"><span class="hs-identifier hs-var">PrimShowFloat</span></a></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatPlus"><span class="hs-identifier hs-var">PrimFloatPlus</span></a></span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatMinus"><span class="hs-identifier hs-var">PrimFloatMinus</span></a></span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatTimes"><span class="hs-identifier hs-var">PrimFloatTimes</span></a></span><span>
</span><span id="line-790"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatNegate"><span class="hs-identifier hs-var">PrimFloatNegate</span></a></span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatDiv"><span class="hs-identifier hs-var">PrimFloatDiv</span></a></span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatSqrt"><span class="hs-identifier hs-var">PrimFloatSqrt</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatExp"><span class="hs-identifier hs-var">PrimFloatExp</span></a></span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatLog"><span class="hs-identifier hs-var">PrimFloatLog</span></a></span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatSin"><span class="hs-identifier hs-var">PrimFloatSin</span></a></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatCos"><span class="hs-identifier hs-var">PrimFloatCos</span></a></span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatTan"><span class="hs-identifier hs-var">PrimFloatTan</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatASin"><span class="hs-identifier hs-var">PrimFloatASin</span></a></span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatACos"><span class="hs-identifier hs-var">PrimFloatACos</span></a></span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatATan"><span class="hs-identifier hs-var">PrimFloatATan</span></a></span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatATan2"><span class="hs-identifier hs-var">PrimFloatATan2</span></a></span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatSinh"><span class="hs-identifier hs-var">PrimFloatSinh</span></a></span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatCosh"><span class="hs-identifier hs-var">PrimFloatCosh</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatTanh"><span class="hs-identifier hs-var">PrimFloatTanh</span></a></span><span>
</span><span id="line-805"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatASinh"><span class="hs-identifier hs-var">PrimFloatASinh</span></a></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatACosh"><span class="hs-identifier hs-var">PrimFloatACosh</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatATanh"><span class="hs-identifier hs-var">PrimFloatATanh</span></a></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimFloatPow"><span class="hs-identifier hs-var">PrimFloatPow</span></a></span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-comment">-- Character functions</span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-comment">-- , PrimCharEquality            -- in Agda.Builtin.Char</span><span>
</span><span id="line-812"></span><span>  </span><span class="hs-comment">-- , PrimIsLower                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-813"></span><span>  </span><span class="hs-comment">-- , PrimIsDigit                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-comment">-- , PrimIsAlpha                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-comment">-- , PrimIsSpace                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-comment">-- , PrimIsAscii                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-comment">-- , PrimIsLatin1                -- in Agda.Builtin.Char</span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-comment">-- , PrimIsPrint                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-comment">-- , PrimIsHexDigit              -- in Agda.Builtin.Char</span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-comment">-- , PrimToUpper                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-comment">-- , PrimToLower                 -- in Agda.Builtin.Char</span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-comment">-- , PrimCharToNat               -- in Agda.Builtin.Char</span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-comment">-- , PrimCharToNatInjective      -- missing</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-comment">-- , PrimNatToChar               -- in Agda.Builtin.Char</span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-comment">-- , PrimShowChar                -- in Agda.Builtin.String</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-comment">-- String functions</span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-comment">-- , PrimStringToList            -- in Agda.Builtin.String</span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-comment">-- , PrimStringToListInjective   -- missing</span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-comment">-- , PrimStringFromList          -- in Agda.Builtin.String</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-comment">-- , PrimStringFromListInjective -- missing</span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-comment">-- , PrimStringAppend            -- in Agda.Builtin.String</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-comment">-- , PrimStringEquality          -- in Agda.Builtin.String</span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-comment">-- , PrimShowString              -- in Agda.Builtin.String</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-comment">-- , PrimStringUncons            -- in Agda.Builtin.String</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-comment">-- Other stuff</span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-comment">-- , PrimEraseEquality           -- missing</span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-comment">-- , PrimForce                   -- missing</span><span>
</span><span id="line-840"></span><span>  </span><span class="hs-comment">-- , PrimForceLemma              -- missing</span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimQNameEquality"><span class="hs-identifier hs-var">PrimQNameEquality</span></a></span><span>
</span><span id="line-842"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimQNameLess"><span class="hs-identifier hs-var">PrimQNameLess</span></a></span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowQName"><span class="hs-identifier hs-var">PrimShowQName</span></a></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimQNameFixity"><span class="hs-identifier hs-var">PrimQNameFixity</span></a></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-comment">-- , PrimQNameToWord64s          -- missing</span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-comment">-- , PrimQNameToWord64sInjective -- missing</span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimMetaEquality"><span class="hs-identifier hs-var">PrimMetaEquality</span></a></span><span>
</span><span id="line-848"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimMetaLess"><span class="hs-identifier hs-var">PrimMetaLess</span></a></span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimShowMeta"><span class="hs-identifier hs-var">PrimShowMeta</span></a></span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimMetaToNat"><span class="hs-identifier hs-var">PrimMetaToNat</span></a></span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-comment">-- , PrimMetaToNatInjective      -- missing</span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinIMin"><span class="hs-identifier hs-var">builtinIMin</span></a></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinIMax"><span class="hs-identifier hs-var">builtinIMax</span></a></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinINeg"><span class="hs-identifier hs-var">builtinINeg</span></a></span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimPartial"><span class="hs-identifier hs-var">PrimPartial</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#PrimPartialP"><span class="hs-identifier hs-var">PrimPartialP</span></a></span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinPOr"><span class="hs-identifier hs-var">builtinPOr</span></a></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinComp"><span class="hs-identifier hs-var">builtinComp</span></a></span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinTrans"><span class="hs-identifier hs-var">builtinTrans</span></a></span><span>
</span><span id="line-860"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinHComp"><span class="hs-identifier hs-var">builtinHComp</span></a></span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinSubOut"><span class="hs-identifier hs-var">builtinSubOut</span></a></span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtin_glueU"><span class="hs-identifier hs-var">builtin_glueU</span></a></span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtin_unglueU"><span class="hs-identifier hs-var">builtin_unglueU</span></a></span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="Agda.Syntax.Builtin.html#builtinFaceForall"><span class="hs-identifier hs-var">builtinFaceForall</span></a></span><span>
</span><span id="line-865"></span><span>  </span><span class="hs-comment">-- , builtinGlue                   -- missing</span><span>
</span><span id="line-866"></span><span>  </span><span class="hs-comment">-- , builtin_glue                  -- missing</span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-comment">-- , builtin_unglue                -- missing</span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-869"></span></pre></body></html>