<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | A simple document tree to render @'Doc' ann@ but preserve annotations.</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- 'DocTree' and 'renderToTree'' originally taken from</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- &lt;https://github.com/plt-amy/agda/blob/9fd50b883f14a05792ed79a0b693fbecb2165bf5/src/full/Agda/LSP/Output.hs&gt;</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- but rewritten to encode more invariants.</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html"><span class="hs-identifier">Agda.Utils.DocTree</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier">DocTree</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Node"><span class="hs-identifier">Node</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier">Text</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#prettyDocTree"><span class="hs-identifier">prettyDocTree</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#renderToTree"><span class="hs-identifier">renderToTree</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#renderToTree%27"><span class="hs-identifier">renderToTree'</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#renderTree%27"><span class="hs-identifier">renderTree'</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#treeToText"><span class="hs-identifier">treeToText</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#treeToTextNoAnn"><span class="hs-identifier">treeToTextNoAnn</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#treeToTextWithAnn"><span class="hs-identifier">treeToTextWithAnn</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>          </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-cpp">
#if MIN_VERSION_text(2,0,2)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">strictBuilderToText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">textToStrictBuilder</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span class="hs-cpp">
#else
</span><span class="hs-comment">-- GHC 9.2 ships text-1.2.5.0</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Lazy</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TL</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Lazy.Builder</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Builder</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.PrettyPrint.Annotated.HughesPJ</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Doc</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.PrettyPrint.Annotated.HughesPJ</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ppr</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier">applyUnless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|)</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monoid.html"><span class="hs-identifier">Agda.Utils.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier">Fwd</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier">Fwd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Monoid.html#appFwd"><span class="hs-identifier">appFwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Range.html"><span class="hs-identifier">Agda.Utils.Range</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Range.html#Range"><span class="hs-identifier">Range</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html"><span class="hs-identifier">Agda.Utils.RangeMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier">RangeMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html"><span class="hs-identifier">Agda.Utils.RangeMap</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RangeMap</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="annot"><span class="hs-comment">-- | A rendered document with annotations from type @ann@.</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">data</span><span> </span><span id="DocTree"><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-var">DocTree</span></a></span></span><span> </span><span id="local-6989586621681677967"><span class="annot"><a href="#local-6989586621681677967"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Node"><span class="annot"><a href="Agda.Utils.DocTree.html#Node"><span class="hs-identifier hs-var">Node</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621681677967"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681677967"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Stuff annotated by @ann@.</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Text"><span class="annot"><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-var">Text</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-57"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Atom.</span></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681678123"><span id="local-6989586621681678125"><span class="annot"><span class="annottext">(forall x. DocTree ann -&gt; Rep (DocTree ann) x)
-&gt; (forall x. Rep (DocTree ann) x -&gt; DocTree ann)
-&gt; Generic (DocTree ann)
forall x. Rep (DocTree ann) x -&gt; DocTree ann
forall x. DocTree ann -&gt; Rep (DocTree ann) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall ann x. Rep (DocTree ann) x -&gt; DocTree ann
forall ann x. DocTree ann -&gt; Rep (DocTree ann) x
$cfrom :: forall ann x. DocTree ann -&gt; Rep (DocTree ann) x
from :: forall x. DocTree ann -&gt; Rep (DocTree ann) x
$cto :: forall ann x. Rep (DocTree ann) x -&gt; DocTree ann
to :: forall x. Rep (DocTree ann) x -&gt; DocTree ann
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681678132"><span id="local-6989586621681678143"><span id="local-6989586621681678147"><span class="annot"><span class="annottext">Int -&gt; DocTree ann -&gt; ShowS
[DocTree ann] -&gt; ShowS
DocTree ann -&gt; String
(Int -&gt; DocTree ann -&gt; ShowS)
-&gt; (DocTree ann -&gt; String)
-&gt; ([DocTree ann] -&gt; ShowS)
-&gt; Show (DocTree ann)
forall ann. Show ann =&gt; Int -&gt; DocTree ann -&gt; ShowS
forall ann. Show ann =&gt; [DocTree ann] -&gt; ShowS
forall ann. Show ann =&gt; DocTree ann -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall ann. Show ann =&gt; Int -&gt; DocTree ann -&gt; ShowS
showsPrec :: Int -&gt; DocTree ann -&gt; ShowS
$cshow :: forall ann. Show ann =&gt; DocTree ann -&gt; String
show :: DocTree ann -&gt; String
$cshowList :: forall ann. Show ann =&gt; [DocTree ann] -&gt; ShowS
showList :: [DocTree ann] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681677966"><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681677966"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>  </span><span id="local-6989586621681678157"><span class="annot"><span class="annottext">empty :: DocTree ann
</span><a href="#local-6989586621681678157"><span class="hs-identifier hs-var hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; DocTree ann
forall ann. Text -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621681678164"><span class="annot"><span class="annottext">null :: DocTree ann -&gt; Bool
</span><a href="#local-6989586621681678164"><span class="hs-identifier hs-var hs-var hs-var">null</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Agda.Utils.DocTree.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621681678166"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678166"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678167"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678167"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DocTree ann -&gt; Bool) -&gt; [DocTree ann] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678167"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span id="local-6989586621681678169"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678169"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678169"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681677991"><span id="local-6989586621681678172"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621681677991"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681677991"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- * Converting 'DocTree' to 'Doc'</span></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span id="local-6989586621681677992"><span class="annot"><a href="Agda.Utils.DocTree.html#prettyDocTree"><span class="hs-identifier hs-type">prettyDocTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681677992"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Doc</span></span><span> </span><span class="annot"><a href="#local-6989586621681677992"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-72"></span><span id="prettyDocTree"><span class="annot"><span class="annottext">prettyDocTree :: forall ann. DocTree ann -&gt; Doc ann
</span><a href="Agda.Utils.DocTree.html#prettyDocTree"><span class="hs-identifier hs-var hs-var">prettyDocTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span id="local-6989586621681678200"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678200"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc ann
forall a. String -&gt; Doc a
</span><span class="hs-identifier hs-var">Ppr.text</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Doc ann) -&gt; String -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678200"><span class="hs-identifier hs-var">t</span></a></span><span>  </span><span class="hs-comment">-- Bad, we should have a Doc that supports Text</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Agda.Utils.DocTree.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621681678203"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678203"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678204"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678204"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ann -&gt; Doc ann -&gt; Doc ann
forall a. a -&gt; Doc a -&gt; Doc a
</span><span class="hs-identifier hs-var">Ppr.annotate</span></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678203"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc ann -&gt; Doc ann) -&gt; Doc ann -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DocTree ann -&gt; Doc ann) -&gt; [DocTree ann] -&gt; Doc ann
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; Doc ann
forall ann. DocTree ann -&gt; Doc ann
</span><a href="Agda.Utils.DocTree.html#prettyDocTree"><span class="hs-identifier hs-var">prettyDocTree</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678204"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- * Converting 'Doc' to 'DocTree'</span></span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- Implemented as state machine where the state is a stack of unclosed</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- annotation with the annotated stuff inbetween.</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><span class="hs-comment">-- | State of the right-to-left conversion to tree.</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">data</span><span> </span><span id="St"><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span></span><span> </span><span id="local-6989586621681678005"><span class="annot"><a href="#local-6989586621681678005"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="St"><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="front"><span class="annot"><span class="annottext">forall ann. St ann -&gt; String
</span><a href="Agda.Utils.DocTree.html#front"><span class="hs-identifier hs-var hs-var">front</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Accumulator for text.</span></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stack"><span class="annot"><span class="annottext">forall ann. St ann -&gt; List1 (Item ann)
</span><a href="Agda.Utils.DocTree.html#stack"><span class="hs-identifier hs-var hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678005"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-comment">-- ^ A nonempty stack of annotated trees with their closing annotation bracket,</span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-comment">--   waiting for the opening bracket.</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><span class="hs-comment">-- | Annotated stuff waiting for the opening bracket.</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">data</span><span> </span><span id="Item"><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-var">Item</span></a></span></span><span> </span><span id="local-6989586621681678017"><span class="annot"><a href="#local-6989586621681678017"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Item"><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-var">Item</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621681678017"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678017"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- Initial state.</span><span>
</span><span id="line-95"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681678012"><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678012"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678012"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621681678219"><span class="annot"><span class="annottext">empty :: St ann
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; List1 (Item ann) -&gt; St ann
forall ann. String -&gt; List1 (Item ann) -&gt; St ann
</span><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span><span> </span><span class="annot"><span class="annottext">String
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Item ann -&gt; List1 (Item ann)
forall a. a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">List1.singleton</span></span><span> </span><span class="annot"><span class="annottext">Item ann
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621681678225"><span class="annot"><span class="annottext">null :: St ann -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var hs-var hs-var">null</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678226"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678226"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681678227"><span class="annot"><span class="annottext">List1 (Item ann)
</span><a href="#local-6989586621681678227"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678226"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Item ann -&gt; Bool) -&gt; List1 (Item ann) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Item ann -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Item ann)
</span><a href="#local-6989586621681678227"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681678014"><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678014"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678014"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621681678234"><span class="annot"><span class="annottext">empty :: Item ann
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; [DocTree ann] -&gt; Item ann
forall ann. ann -&gt; [DocTree ann] -&gt; Item ann
</span><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-var">Item</span></a></span><span> </span><span class="annot"><span class="annottext">ann
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621681678237"><span class="annot"><span class="annottext">null :: Item ann -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var hs-var hs-var">null</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span id="local-6989586621681678238"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678238"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678239"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678239"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678238"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[DocTree ann] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678239"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-keyword">type</span><span> </span><span id="Width"><span class="annot"><a href="Agda.Utils.DocTree.html#Width"><span class="hs-identifier hs-var">Width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">type</span><span> </span><span id="Fill"><span class="annot"><a href="Agda.Utils.DocTree.html#Fill"><span class="hs-identifier hs-var">Fill</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- | Render a @'Doc' ann@ to a @'DocTree' ann@ with the given layout parameters.</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- E.g. @width=100@ @fill=1.5@.</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="annot"><a href="Agda.Utils.DocTree.html#renderToTree%27"><span class="hs-identifier hs-type">renderToTree'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681678018"><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Fill"><span class="hs-identifier hs-type">Fill</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Doc</span></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-110"></span><span id="renderToTree%27"><span class="annot"><span class="annottext">renderToTree' :: forall ann. Null ann =&gt; Int -&gt; Fill -&gt; Doc ann -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#renderToTree%27"><span class="hs-identifier hs-var hs-var">renderToTree'</span></a></span></span><span> </span><span id="local-6989586621681678258"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678258"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621681678259"><span class="annot"><span class="annottext">Fill
</span><a href="#local-6989586621681678259"><span class="hs-identifier hs-var">fill</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">St ann -&gt; DocTree ann
</span><a href="#local-6989586621681678260"><span class="hs-identifier hs-var">finalize</span></a></span><span> </span><span class="annot"><span class="annottext">(St ann -&gt; DocTree ann)
-&gt; (Doc ann -&gt; St ann) -&gt; Doc ann -&gt; DocTree ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Mode
-&gt; Int
-&gt; Fill
-&gt; (AnnotDetails ann -&gt; St ann -&gt; St ann)
-&gt; St ann
-&gt; Doc ann
-&gt; St ann
forall b a.
Mode
-&gt; Int -&gt; Fill -&gt; (AnnotDetails b -&gt; a -&gt; a) -&gt; a -&gt; Doc b -&gt; a
</span><span class="hs-identifier hs-var">Ppr.fullRenderAnn</span></span><span> </span><span class="annot"><span class="annottext">Mode
</span><span class="hs-identifier hs-var">Ppr.PageMode</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678258"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Fill
</span><a href="#local-6989586621681678259"><span class="hs-identifier hs-var">fill</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotDetails ann -&gt; St ann -&gt; St ann
</span><a href="#local-6989586621681678264"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">St ann
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- State machine transition for the right-to-left automaton.</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="#local-6989586621681678264"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ppr.AnnotDetails</span></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621681678264"><span class="annot"><span class="annottext">go :: AnnotDetails ann -&gt; St ann -&gt; St ann
</span><a href="#local-6989586621681678264"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">AnnotDetails ann
</span><span class="hs-identifier hs-var">Ppr.AnnotStart</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">St ann -&gt; St ann
</span><a href="#local-6989586621681678266"><span class="hs-identifier hs-var">annotStart</span></a></span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Ppr.NoAnnot</span></span><span> </span><span id="local-6989586621681678268"><span class="annot"><span class="annottext">TextDetails
</span><a href="#local-6989586621681678268"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TextDetails -&gt; St ann -&gt; St ann
</span><a href="#local-6989586621681678269"><span class="hs-identifier hs-var">noAnnot</span></a></span><span> </span><span class="annot"><span class="annottext">TextDetails
</span><a href="#local-6989586621681678268"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Ppr.AnnotEnd</span></span><span> </span><span id="local-6989586621681678271"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678271"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ann -&gt; St ann -&gt; St ann
</span><a href="#local-6989586621681678272"><span class="hs-identifier hs-var">annotEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678271"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="#local-6989586621681678260"><span class="hs-identifier hs-type">finalize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621681678260"><span class="annot"><span class="annottext">finalize :: St ann -&gt; DocTree ann
</span><a href="#local-6989586621681678260"><span class="hs-identifier hs-var hs-var">finalize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678273"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678273"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span id="local-6989586621681678274"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678274"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678275"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678275"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621681678276"><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678276"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Item ann] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678276"><span class="hs-identifier hs-var">is</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; String -&gt; [DocTree ann] -&gt; DocTree ann
</span><a href="#local-6989586621681678277"><span class="hs-identifier hs-var">mkNode</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678274"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678273"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678275"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DocTree ann
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not well-bracketed</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-comment">-- Create a node once the opening bracket has been reached.</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="#local-6989586621681678277"><span class="hs-identifier hs-type">mkNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621681678277"><span class="annot"><span class="annottext">mkNode :: ann -&gt; String -&gt; [DocTree ann] -&gt; DocTree ann
</span><a href="#local-6989586621681678277"><span class="hs-identifier hs-var hs-var">mkNode</span></a></span></span><span> </span><span id="local-6989586621681678279"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678279"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678280"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678280"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681678281"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678281"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; [DocTree ann] -&gt; DocTree ann
forall ann. ann -&gt; [DocTree ann] -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678279"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">([DocTree ann] -&gt; DocTree ann) -&gt; [DocTree ann] -&gt; DocTree ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ([DocTree ann] -&gt; [DocTree ann])
-&gt; [DocTree ann]
-&gt; [DocTree ann]
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier hs-var">applyUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678280"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; DocTree ann
forall ann. Text -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678280"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; [DocTree ann] -&gt; [DocTree ann]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678281"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">-- Got the opening bracket on an annotation:</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">-- Pop an item from the stack</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="#local-6989586621681678266"><span class="hs-identifier hs-type">annotStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621681678266"><span class="annot"><span class="annottext">annotStart :: St ann -&gt; St ann
</span><a href="#local-6989586621681678266"><span class="hs-identifier hs-var hs-var">annotStart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678283"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678283"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span id="local-6989586621681678284"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678284"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678285"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678285"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621681678286"><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678286"><span class="hs-identifier hs-var">is1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678286"><span class="hs-identifier hs-var">is1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-134"></span><span>        </span><span id="local-6989586621681678287"><span class="annot"><span class="annottext">Item ann
</span><a href="#local-6989586621681678287"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681678288"><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678288"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Item ann) -&gt; St ann
forall ann. String -&gt; List1 (Item ann) -&gt; St ann
</span><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DocTree ann -&gt; Item ann -&gt; Item ann
</span><a href="#local-6989586621681678289"><span class="hs-identifier hs-var">consTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann -&gt; String -&gt; [DocTree ann] -&gt; DocTree ann
</span><a href="#local-6989586621681678277"><span class="hs-identifier hs-var">mkNode</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678284"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678283"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678285"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Item ann
</span><a href="#local-6989586621681678287"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Item ann -&gt; [Item ann] -&gt; NonEmpty (Item ann)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678288"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">St ann
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- not well-bracketed</span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><a href="#local-6989586621681678289"><span class="hs-identifier hs-type">consTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span id="local-6989586621681678289"><span class="annot"><span class="annottext">consTree :: DocTree ann -&gt; Item ann -&gt; Item ann
</span><a href="#local-6989586621681678289"><span class="hs-identifier hs-var hs-var">consTree</span></a></span></span><span> </span><span id="local-6989586621681678290"><span class="annot"><span class="annottext">DocTree ann
</span><a href="#local-6989586621681678290"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span id="local-6989586621681678291"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678291"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678292"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678292"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; [DocTree ann] -&gt; Item ann
forall ann. ann -&gt; [DocTree ann] -&gt; Item ann
</span><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-var">Item</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678291"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DocTree ann
</span><a href="#local-6989586621681678290"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; [DocTree ann] -&gt; [DocTree ann]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678292"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- Got text.</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="#local-6989586621681678269"><span class="hs-identifier hs-type">noAnnot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ppr.TextDetails</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621681678269"><span class="annot"><span class="annottext">noAnnot :: TextDetails -&gt; St ann -&gt; St ann
</span><a href="#local-6989586621681678269"><span class="hs-identifier hs-var hs-var">noAnnot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ppr.Chr</span></span><span>  </span><span id="local-6989586621681678294"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681678294"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678295"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678295"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621681678296"><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678296"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Item ann) -&gt; St ann
forall ann. String -&gt; List1 (Item ann) -&gt; St ann
</span><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681678294"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678295"><span class="hs-identifier hs-var">s0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678296"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="#local-6989586621681678269"><span class="hs-identifier hs-var">noAnnot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ppr.Str</span></span><span>  </span><span id="local-6989586621681678298"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678298"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678299"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678299"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621681678300"><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678300"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Item ann) -&gt; St ann
forall ann. String -&gt; List1 (Item ann) -&gt; St ann
</span><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678298"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678299"><span class="hs-identifier hs-var">s0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678300"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="#local-6989586621681678269"><span class="hs-identifier hs-var">noAnnot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ppr.PStr</span></span><span> </span><span id="local-6989586621681678302"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678302"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678303"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678303"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621681678304"><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678304"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Item ann) -&gt; St ann
forall ann. String -&gt; List1 (Item ann) -&gt; St ann
</span><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678302"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678303"><span class="hs-identifier hs-var">s0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678304"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">-- Got the closing bracket of a new annotation:</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- Push a new item on the stack.</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><a href="#local-6989586621681678272"><span class="hs-identifier hs-type">annotEnd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621681678272"><span class="annot"><span class="annottext">annotEnd :: ann -&gt; St ann -&gt; St ann
</span><a href="#local-6989586621681678272"><span class="hs-identifier hs-var hs-var">annotEnd</span></a></span></span><span> </span><span id="local-6989586621681678305"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678305"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-type">St</span></a></span><span> </span><span id="local-6989586621681678306"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678306"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681678307"><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678307"><span class="hs-identifier hs-var">is1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Item ann) -&gt; St ann
forall ann. String -&gt; List1 (Item ann) -&gt; St ann
</span><a href="Agda.Utils.DocTree.html#St"><span class="hs-identifier hs-var">St</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann -&gt; [DocTree ann] -&gt; Item ann
forall ann. ann -&gt; [DocTree ann] -&gt; Item ann
</span><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-var">Item</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678305"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Item ann -&gt; NonEmpty (Item ann) -&gt; NonEmpty (Item ann)
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-operator hs-var">&lt;|</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Item ann) -&gt; NonEmpty (Item ann)
</span><a href="#local-6989586621681678308"><span class="hs-identifier hs-var">pushStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678306"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678307"><span class="hs-identifier hs-var">is1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><a href="#local-6989586621681678308"><span class="hs-identifier hs-type">pushStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678018"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>        </span><span id="local-6989586621681678308"><span class="annot"><span class="annottext">pushStr :: String -&gt; NonEmpty (Item ann) -&gt; NonEmpty (Item ann)
</span><a href="#local-6989586621681678308"><span class="hs-identifier hs-var hs-var">pushStr</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span id="local-6989586621681678309"><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678309"><span class="hs-identifier hs-var">is1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Item ann)
</span><a href="#local-6989586621681678309"><span class="hs-identifier hs-var">is1</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><a href="#local-6989586621681678308"><span class="hs-identifier hs-var">pushStr</span></a></span><span> </span><span id="local-6989586621681678310"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678310"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span id="local-6989586621681678311"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678311"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678312"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678312"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621681678313"><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678313"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; [DocTree ann] -&gt; Item ann
forall ann. ann -&gt; [DocTree ann] -&gt; Item ann
</span><a href="Agda.Utils.DocTree.html#Item"><span class="hs-identifier hs-var">Item</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678311"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; DocTree ann
forall ann. Text -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681678310"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; [DocTree ann] -&gt; [DocTree ann]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678312"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Item ann -&gt; [Item ann] -&gt; NonEmpty (Item ann)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[Item ann]
</span><a href="#local-6989586621681678313"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><span class="hs-comment">-- | Render a @'Doc' ann@ to a @'DocTree' ann@ using standard layout parameters.</span></span><span>
</span><span id="line-156"></span><span class="annot"><a href="Agda.Utils.DocTree.html#renderToTree"><span class="hs-identifier hs-type">renderToTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681678044"><span class="annot"><a href="#local-6989586621681678044"><span class="hs-identifier hs-type">ann</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678044"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Doc</span></span><span> </span><span class="annot"><a href="#local-6989586621681678044"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678044"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-157"></span><span id="renderToTree"><span class="annot"><span class="annottext">renderToTree :: forall ann. Null ann =&gt; Doc ann -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#renderToTree"><span class="hs-identifier hs-var hs-var">renderToTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Fill -&gt; Doc ann -&gt; DocTree ann
forall ann. Null ann =&gt; Int -&gt; Fill -&gt; Doc ann -&gt; DocTree ann
</span><a href="Agda.Utils.DocTree.html#renderToTree%27"><span class="hs-identifier hs-var">renderToTree'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Fill
</span><span class="hs-number">1.5</span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-160"></span><span class="annot"><span class="hs-comment">-- * Converting 'DocTree' to 'Text' et al.</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><span class="hs-comment">-- | Generic 'DocTree' linearization.</span></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Agda.Utils.DocTree.html#renderTree%27"><span class="hs-identifier hs-type">renderTree'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681678047"><span class="annot"><a href="#local-6989586621681678047"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span id="local-6989586621681678046"><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681678047"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678047"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-164"></span><span id="renderTree%27"><span class="annot"><span class="annottext">renderTree' :: forall ann t.
Monoid t =&gt;
(Text -&gt; t) -&gt; (ann -&gt; t -&gt; t) -&gt; DocTree ann -&gt; t
</span><a href="Agda.Utils.DocTree.html#renderTree%27"><span class="hs-identifier hs-var hs-var">renderTree'</span></a></span></span><span> </span><span id="local-6989586621681678319"><span class="annot"><span class="annottext">Text -&gt; t
</span><a href="#local-6989586621681678319"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span id="local-6989586621681678320"><span class="annot"><span class="annottext">ann -&gt; t -&gt; t
</span><a href="#local-6989586621681678320"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; t
</span><a href="#local-6989586621681678321"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="#local-6989586621681678321"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678047"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678046"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621681678321"><span class="annot"><span class="annottext">go :: DocTree ann -&gt; t
</span><a href="#local-6989586621681678321"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><a href="Agda.Utils.DocTree.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621681678322"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678322"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678323"><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678323"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ann -&gt; t -&gt; t
</span><a href="#local-6989586621681678320"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678322"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(t -&gt; t) -&gt; t -&gt; t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DocTree ann -&gt; t) -&gt; [DocTree ann] -&gt; t
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">DocTree ann -&gt; t
</span><a href="#local-6989586621681678321"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[DocTree ann]
</span><a href="#local-6989586621681678323"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><a href="Agda.Utils.DocTree.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span id="local-6989586621681678324"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678324"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; t
</span><a href="#local-6989586621681678319"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678324"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- Compatibility layer for different versions of package text.</span><span class="hs-cpp">

#if MIN_VERSION_text(2,0,2)
</span><span class="hs-cpp">
#if MIN_VERSION_text(2,1,2)
</span><span class="hs-keyword">type</span><span> </span><span id="Builder"><span class="annot"><a href="Agda.Utils.DocTree.html#Builder"><span class="hs-identifier hs-var">Builder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.Text.Encoding.StrictTextBuilder</span></span><span class="hs-cpp">
#else
</span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Builder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Data.Text.Encoding.StrictBuilder</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-181"></span><span class="annot"><a href="Agda.Utils.DocTree.html#builderToText"><span class="hs-identifier hs-type">builderToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-182"></span><span id="builderToText"><span class="annot"><span class="annottext">builderToText :: Builder -&gt; Text
</span><a href="Agda.Utils.DocTree.html#builderToText"><span class="hs-identifier hs-var hs-var">builderToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><span class="hs-identifier hs-var">strictBuilderToText</span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="Agda.Utils.DocTree.html#textToBuilder"><span class="hs-identifier hs-type">textToBuilder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-185"></span><span id="textToBuilder"><span class="annot"><span class="annottext">textToBuilder :: Text -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#textToBuilder"><span class="hs-identifier hs-var hs-var">textToBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">textToStrictBuilder</span></span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-189"></span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Builder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Builder.Builder</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-identifier">builderToText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Builder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Text</span><span>
</span><span id="line-192"></span><span class="hs-identifier">builderToText</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TL.toStrict</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Builder.toLazyText</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-identifier">textToBuilder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Builder</span><span>
</span><span id="line-195"></span><span class="hs-identifier">textToBuilder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Builder.fromText</span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-199"></span><span class="annot"><span class="hs-comment">-- | Linearize a 'DocTree' to 'Text' with the given 'Text'-rendering of the annotations.</span></span><span>
</span><span id="line-200"></span><span id="local-6989586621681678051"><span class="annot"><a href="Agda.Utils.DocTree.html#treeToText"><span class="hs-identifier hs-type">treeToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681678051"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678051"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-201"></span><span id="treeToText"><span class="annot"><span class="annottext">treeToText :: forall ann. (ann -&gt; Text -&gt; Text) -&gt; DocTree ann -&gt; Text
</span><a href="Agda.Utils.DocTree.html#treeToText"><span class="hs-identifier hs-var hs-var">treeToText</span></a></span></span><span> </span><span id="local-6989586621681678330"><span class="annot"><span class="annottext">ann -&gt; Text -&gt; Text
</span><a href="#local-6989586621681678330"><span class="hs-identifier hs-var">ann</span></a></span></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="Agda.Utils.DocTree.html#builderToText"><span class="hs-identifier hs-var">builderToText</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="annottext">(Builder -&gt; Text)
-&gt; (DocTree ann -&gt; Builder) -&gt; DocTree ann -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder)
-&gt; (ann -&gt; Builder -&gt; Builder) -&gt; DocTree ann -&gt; Builder
forall ann t.
Monoid t =&gt;
(Text -&gt; t) -&gt; (ann -&gt; t -&gt; t) -&gt; DocTree ann -&gt; t
</span><a href="Agda.Utils.DocTree.html#renderTree%27"><span class="hs-identifier hs-var">renderTree'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#textToBuilder"><span class="hs-identifier hs-var">textToBuilder</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681678331"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678331"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#textToBuilder"><span class="hs-identifier hs-var">textToBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; (Builder -&gt; Text) -&gt; Builder -&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ann -&gt; Text -&gt; Text
</span><a href="#local-6989586621681678330"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678331"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Builder -&gt; Text) -&gt; Builder -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="Agda.Utils.DocTree.html#builderToText"><span class="hs-identifier hs-var">builderToText</span></a></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- Naive implementation:</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- treeToText = renderTree' id</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><span class="hs-comment">-- | Linearize a 'DocTree' to 'Text' dropping all annotations.</span></span><span>
</span><span id="line-208"></span><span id="local-6989586621681678053"><span class="annot"><a href="Agda.Utils.DocTree.html#treeToTextNoAnn"><span class="hs-identifier hs-type">treeToTextNoAnn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678053"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-209"></span><span id="treeToTextNoAnn"><span class="annot"><span class="annottext">treeToTextNoAnn :: forall ann. DocTree ann -&gt; Text
</span><a href="Agda.Utils.DocTree.html#treeToTextNoAnn"><span class="hs-identifier hs-var hs-var">treeToTextNoAnn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ann -&gt; Text -&gt; Text) -&gt; DocTree ann -&gt; Text
forall ann. (ann -&gt; Text -&gt; Text) -&gt; DocTree ann -&gt; Text
</span><a href="Agda.Utils.DocTree.html#treeToText"><span class="hs-identifier hs-var">treeToText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; ann -&gt; Text -&gt; Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><span class="hs-comment">-- ** Linearizing a 'DocTree' to a 'Text' plus a 'RangeMap'.</span></span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- Outputs one annotation interval per 'Node',</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- leaving it to the 'RangeMap' to combine annotations correctly.</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span id="local-6989586621681678058"><span class="annot"><a href="Agda.Utils.DocTree.html#treeToTextWithAnn"><span class="hs-identifier hs-type">treeToTextWithAnn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678058"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678058"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678058"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier hs-type">RangeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678058"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-217"></span><span id="treeToTextWithAnn"><span class="annot"><span class="annottext">treeToTextWithAnn :: forall ann.
(Monoid ann, Null ann) =&gt;
DocTree ann -&gt; (Text, RangeMap ann)
</span><a href="Agda.Utils.DocTree.html#treeToTextWithAnn"><span class="hs-identifier hs-var hs-var">treeToTextWithAnn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Lin ann -&gt; (Text, RangeMap ann)
forall ann. Monoid ann =&gt; Int -&gt; Lin ann -&gt; (Text, RangeMap ann)
</span><a href="Agda.Utils.DocTree.html#evalLin"><span class="hs-identifier hs-var">evalLin</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Lin ann -&gt; (Text, RangeMap ann))
-&gt; (DocTree ann -&gt; Lin ann) -&gt; DocTree ann -&gt; (Text, RangeMap ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Lin ann)
-&gt; (ann -&gt; Lin ann -&gt; Lin ann) -&gt; DocTree ann -&gt; Lin ann
forall ann t.
Monoid t =&gt;
(Text -&gt; t) -&gt; (ann -&gt; t -&gt; t) -&gt; DocTree ann -&gt; t
</span><a href="Agda.Utils.DocTree.html#renderTree%27"><span class="hs-identifier hs-var">renderTree'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Lin ann
forall ann. Monoid ann =&gt; Text -&gt; Lin ann
</span><a href="Agda.Utils.DocTree.html#linText"><span class="hs-identifier hs-var">linText</span></a></span><span> </span><span class="annot"><span class="annottext">ann -&gt; Lin ann -&gt; Lin ann
forall ann. (Monoid ann, Null ann) =&gt; ann -&gt; Lin ann -&gt; Lin ann
</span><a href="Agda.Utils.DocTree.html#linNode"><span class="hs-identifier hs-var">linNode</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><span class="hs-comment">-- | Linearizer state.</span></span><span>
</span><span id="line-220"></span><span class="hs-keyword">data</span><span> </span><span id="LinSt"><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-var">LinSt</span></a></span></span><span> </span><span id="local-6989586621681678067"><span class="annot"><a href="#local-6989586621681678067"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LinSt"><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-var">LinSt</span></a></span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="linPosition"><span class="annot"><span class="annottext">forall ann. LinSt ann -&gt; Int
</span><a href="Agda.Utils.DocTree.html#linPosition"><span class="hs-identifier hs-var hs-var">linPosition</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Current position.</span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="linBuilder"><span class="annot"><span class="annottext">forall ann. LinSt ann -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#linBuilder"><span class="hs-identifier hs-var hs-var">linBuilder</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Accumulated text.</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="linRangeMap"><span class="annot"><span class="annottext">forall ann. LinSt ann -&gt; RangeMap ann
</span><a href="Agda.Utils.DocTree.html#linRangeMap"><span class="hs-identifier hs-var hs-var">linRangeMap</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier hs-type">RangeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678067"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Accumulated annotation information.</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- | Linearizer.</span><span>
</span><span id="line-230"></span><span class="hs-comment">--   We need forward function composition because we process nodes left-to-right.</span><span>
</span><span id="line-231"></span><span class="hs-keyword">type</span><span> </span><span id="Lin"><span class="annot"><a href="Agda.Utils.DocTree.html#Lin"><span class="hs-identifier hs-var">Lin</span></a></span></span><span> </span><span id="local-6989586621681678349"><span class="annot"><a href="#local-6989586621681678349"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier hs-type">Fwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-type">LinSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678349"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><span class="hs-comment">-- | Run linearizer with given initial offset.</span></span><span>
</span><span id="line-234"></span><span id="local-6989586621681678064"><span class="annot"><a href="Agda.Utils.DocTree.html#evalLin"><span class="hs-identifier hs-type">evalLin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678064"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Lin"><span class="hs-identifier hs-type">Lin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678064"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier hs-type">RangeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678064"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-235"></span><span id="evalLin"><span class="annot"><span class="annottext">evalLin :: forall ann. Monoid ann =&gt; Int -&gt; Lin ann -&gt; (Text, RangeMap ann)
</span><a href="Agda.Utils.DocTree.html#evalLin"><span class="hs-identifier hs-var hs-var">evalLin</span></a></span></span><span> </span><span id="local-6989586621681678352"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678352"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621681678353"><span class="annot"><span class="annottext">Lin ann
</span><a href="#local-6989586621681678353"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Lin ann
</span><a href="#local-6989586621681678353"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Lin ann -&gt; LinSt ann -&gt; LinSt ann
forall a. Fwd a -&gt; a -&gt; a
</span><a href="Agda.Utils.Monoid.html#appFwd"><span class="hs-operator hs-var">`appFwd`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LinSt ann
forall ann. Monoid ann =&gt; Int -&gt; LinSt ann
</span><a href="Agda.Utils.DocTree.html#initLinSt"><span class="hs-identifier hs-var">initLinSt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678352"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-type">LinSt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681678355"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678355"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681678356"><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678356"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="Agda.Utils.DocTree.html#builderToText"><span class="hs-identifier hs-var">builderToText</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678355"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678356"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><span class="hs-comment">-- | Initial linearizer state with configurable offset.</span></span><span>
</span><span id="line-240"></span><span id="local-6989586621681678074"><span class="annot"><a href="Agda.Utils.DocTree.html#initLinSt"><span class="hs-identifier hs-type">initLinSt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678074"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-type">LinSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678074"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-241"></span><span id="initLinSt"><span class="annot"><span class="annottext">initLinSt :: forall ann. Monoid ann =&gt; Int -&gt; LinSt ann
</span><a href="Agda.Utils.DocTree.html#initLinSt"><span class="hs-identifier hs-var hs-var">initLinSt</span></a></span></span><span> </span><span id="local-6989586621681678361"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678361"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Builder -&gt; RangeMap ann -&gt; LinSt ann
forall ann. Int -&gt; Builder -&gt; RangeMap ann -&gt; LinSt ann
</span><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-var">LinSt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678361"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">RangeMap ann
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><span class="hs-comment">-- | Outputting some text under the currently active annotations.</span></span><span>
</span><span id="line-244"></span><span id="local-6989586621681678065"><span class="annot"><a href="Agda.Utils.DocTree.html#linText"><span class="hs-identifier hs-type">linText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678065"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Lin"><span class="hs-identifier hs-type">Lin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678065"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-245"></span><span id="linText"><span class="annot"><span class="annottext">linText :: forall ann. Monoid ann =&gt; Text -&gt; Lin ann
</span><a href="Agda.Utils.DocTree.html#linText"><span class="hs-identifier hs-var hs-var">linText</span></a></span></span><span> </span><span id="local-6989586621681678367"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678367"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LinSt ann -&gt; LinSt ann) -&gt; Fwd (LinSt ann)
forall a. (a -&gt; a) -&gt; Fwd a
</span><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier hs-var">Fwd</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-type">LinSt</span></a></span><span> </span><span id="local-6989586621681678368"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678368"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621681678369"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678369"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681678370"><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678370"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Builder -&gt; RangeMap ann -&gt; LinSt ann
forall ann. Int -&gt; Builder -&gt; RangeMap ann -&gt; LinSt ann
</span><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-var">LinSt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678371"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678372"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678370"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>      </span><span id="local-6989586621681678371"><span class="annot"><span class="annottext">end :: Int
</span><a href="#local-6989586621681678371"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678368"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678367"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621681678372"><span class="annot"><span class="annottext">b' :: Builder
</span><a href="#local-6989586621681678372"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678369"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#textToBuilder"><span class="hs-identifier hs-var">textToBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678367"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><span class="hs-comment">-- | Add an annotation to the 'RangeMap'.</span></span><span>
</span><span id="line-252"></span><span id="local-6989586621681678066"><span class="annot"><a href="Agda.Utils.DocTree.html#linNode"><span class="hs-identifier hs-type">linNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678066"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#Null"><span class="hs-identifier hs-type">Null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678066"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678066"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Lin"><span class="hs-identifier hs-type">Lin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678066"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Lin"><span class="hs-identifier hs-type">Lin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678066"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-253"></span><span id="linNode"><span class="annot"><span class="annottext">linNode :: forall ann. (Monoid ann, Null ann) =&gt; ann -&gt; Lin ann -&gt; Lin ann
</span><a href="Agda.Utils.DocTree.html#linNode"><span class="hs-identifier hs-var hs-var">linNode</span></a></span></span><span> </span><span id="local-6989586621681678382"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678382"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678383"><span class="annot"><span class="annottext">Lin ann
</span><a href="#local-6989586621681678383"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LinSt ann -&gt; LinSt ann) -&gt; Lin ann
forall a. (a -&gt; a) -&gt; Fwd a
</span><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier hs-var">Fwd</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621681678384"><span class="annot"><span class="annottext">st :: LinSt ann
</span><a href="#local-6989586621681678384"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-type">LinSt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">linPosition :: forall ann. LinSt ann -&gt; Int
</span><a href="Agda.Utils.DocTree.html#linPosition"><span class="hs-identifier hs-var">linPosition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681678385"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678385"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LinSt ann
</span><a href="#local-6989586621681678386"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#linRangeMap"><span class="hs-identifier hs-var">linRangeMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681678387"><span class="hs-identifier hs-type">m'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-256"></span><span>     </span><span class="hs-comment">-- Render content first to get the end position.</span><span>
</span><span id="line-257"></span><span>     </span><span id="local-6989586621681678386"><span class="annot"><span class="annottext">st' :: LinSt ann
</span><a href="#local-6989586621681678386"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Utils.DocTree.html#LinSt"><span class="hs-identifier hs-type">LinSt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">linPosition :: forall ann. LinSt ann -&gt; Int
</span><a href="Agda.Utils.DocTree.html#linPosition"><span class="hs-identifier hs-var">linPosition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681678388"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678388"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">linRangeMap :: forall ann. LinSt ann -&gt; RangeMap ann
</span><a href="Agda.Utils.DocTree.html#linRangeMap"><span class="hs-identifier hs-var">linRangeMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681678389"><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678389"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lin ann
</span><a href="#local-6989586621681678383"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Lin ann -&gt; LinSt ann -&gt; LinSt ann
forall a. Fwd a -&gt; a -&gt; a
</span><a href="Agda.Utils.Monoid.html#appFwd"><span class="hs-operator hs-var">`appFwd`</span></a></span><span> </span><span class="annot"><span class="annottext">LinSt ann
</span><a href="#local-6989586621681678384"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-258"></span><span>     </span><span id="local-6989586621681678390"><span class="annot"><span class="annottext">r :: Range
</span><a href="#local-6989586621681678390"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Range.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">from :: Int
</span><a href="Agda.Utils.Range.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678385"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">to :: Int
</span><a href="Agda.Utils.Range.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678388"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>     </span><span class="hs-comment">-- Insert annotation, leaving it to the RangeMap to combine it with the</span><span>
</span><span id="line-260"></span><span>     </span><span class="hs-comment">-- existing annotations.</span><span>
</span><span id="line-261"></span><span>     </span><span id="local-6989586621681678387"><span class="annot"><span class="annottext">m' :: RangeMap ann
</span><a href="#local-6989586621681678387"><span class="hs-identifier hs-var hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (RangeMap ann -&gt; RangeMap ann) -&gt; RangeMap ann -&gt; RangeMap ann
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier hs-var">applyUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678382"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ann -&gt; ann -&gt; ann) -&gt; Range -&gt; ann -&gt; RangeMap ann -&gt; RangeMap ann
forall a. (a -&gt; a -&gt; a) -&gt; Range -&gt; a -&gt; RangeMap a -&gt; RangeMap a
</span><a href="Agda.Utils.RangeMap.html#insert"><span class="hs-identifier hs-var">RangeMap.insert</span></a></span><span> </span><span class="annot"><span class="annottext">ann -&gt; ann -&gt; ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681678390"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678382"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678389"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><span class="hs-comment">-- ** Alternative linearizer (first implementation).</span></span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- This alternative does not need a sophisticated 'RangeMap',</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- it takes care of the annotation composition itself</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- and outputs the final intervals in left-to-right order.</span><span>
</span><span id="line-268"></span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- The drawback is that it produces an annotation interval for each 'Text'</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- leaf of the 'DocTree' rather than preserving continguous intervals</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- stretching over subtrees.</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- As 'RangeMap' does not join adjacent intervals,</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- this leads to a lot of tiny intervals,</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- which increases the communication load between Agda and Emacs.</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span id="local-6989586621681678084"><span class="annot"><a href="Agda.Utils.DocTree.html#treeToTextWithAnnA"><span class="hs-identifier hs-type">treeToTextWithAnnA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678084"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#DocTree"><span class="hs-identifier hs-type">DocTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678084"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier hs-type">RangeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678084"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-277"></span><span id="treeToTextWithAnnA"><span class="annot"><span class="annottext">treeToTextWithAnnA :: forall ann. Monoid ann =&gt; DocTree ann -&gt; (Text, RangeMap ann)
</span><a href="Agda.Utils.DocTree.html#treeToTextWithAnnA"><span class="hs-identifier hs-var hs-var">treeToTextWithAnnA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LinA ann -&gt; (Text, RangeMap ann)
forall ann. Monoid ann =&gt; Int -&gt; LinA ann -&gt; (Text, RangeMap ann)
</span><a href="Agda.Utils.DocTree.html#evalLinA"><span class="hs-identifier hs-var">evalLinA</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(LinA ann -&gt; (Text, RangeMap ann))
-&gt; (DocTree ann -&gt; LinA ann) -&gt; DocTree ann -&gt; (Text, RangeMap ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; LinA ann)
-&gt; (ann -&gt; LinA ann -&gt; LinA ann) -&gt; DocTree ann -&gt; LinA ann
forall ann t.
Monoid t =&gt;
(Text -&gt; t) -&gt; (ann -&gt; t -&gt; t) -&gt; DocTree ann -&gt; t
</span><a href="Agda.Utils.DocTree.html#renderTree%27"><span class="hs-identifier hs-var">renderTree'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; LinA ann
forall ann. Monoid ann =&gt; Text -&gt; LinA ann
</span><a href="Agda.Utils.DocTree.html#linAText"><span class="hs-identifier hs-var">linAText</span></a></span><span> </span><span class="annot"><span class="annottext">ann -&gt; LinA ann -&gt; LinA ann
forall ann. Monoid ann =&gt; ann -&gt; LinA ann -&gt; LinA ann
</span><a href="Agda.Utils.DocTree.html#linANode"><span class="hs-identifier hs-var">linANode</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><span class="hs-comment">-- | Linearizer state.</span></span><span>
</span><span id="line-280"></span><span class="hs-keyword">data</span><span> </span><span id="LinASt"><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-var">LinASt</span></a></span></span><span> </span><span id="local-6989586621681678090"><span class="annot"><a href="#local-6989586621681678090"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LinASt"><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-var">LinASt</span></a></span></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="bstPosition"><span class="annot"><span class="annottext">forall ann. LinASt ann -&gt; Int
</span><a href="Agda.Utils.DocTree.html#bstPosition"><span class="hs-identifier hs-var hs-var">bstPosition</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Current position.</span></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bstAnnotations"><span class="annot"><span class="annottext">forall ann. LinASt ann -&gt; List1 ann
</span><a href="Agda.Utils.DocTree.html#bstAnnotations"><span class="hs-identifier hs-var hs-var">bstAnnotations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678090"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The top of the stack is the currently active annotation(s).</span></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bstBuilder"><span class="annot"><span class="annottext">forall ann. LinASt ann -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#bstBuilder"><span class="hs-identifier hs-var hs-var">bstBuilder</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Accumulated text.</span></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bstRangeMap"><span class="annot"><span class="annottext">forall ann. LinASt ann -&gt; RangeMap ann
</span><a href="Agda.Utils.DocTree.html#bstRangeMap"><span class="hs-identifier hs-var hs-var">bstRangeMap</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier hs-type">RangeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678090"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Accumulated annotation information.</span></span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="annot"><span class="hs-comment">-- | Linearizer.</span></span><span>
</span><span id="line-292"></span><span class="hs-keyword">type</span><span> </span><span id="LinA"><span class="annot"><a href="Agda.Utils.DocTree.html#LinA"><span class="hs-identifier hs-var">LinA</span></a></span></span><span> </span><span id="local-6989586621681678409"><span class="annot"><a href="#local-6989586621681678409"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier hs-type">Fwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-type">LinASt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678409"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="annot"><span class="hs-comment">-- | Run linearizer with given initial offset.</span></span><span>
</span><span id="line-295"></span><span id="local-6989586621681678087"><span class="annot"><a href="Agda.Utils.DocTree.html#evalLinA"><span class="hs-identifier hs-type">evalLinA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678087"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinA"><span class="hs-identifier hs-type">LinA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678087"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.RangeMap.html#RangeMap"><span class="hs-identifier hs-type">RangeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678087"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-296"></span><span id="evalLinA"><span class="annot"><span class="annottext">evalLinA :: forall ann. Monoid ann =&gt; Int -&gt; LinA ann -&gt; (Text, RangeMap ann)
</span><a href="Agda.Utils.DocTree.html#evalLinA"><span class="hs-identifier hs-var hs-var">evalLinA</span></a></span></span><span> </span><span id="local-6989586621681678412"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678412"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621681678413"><span class="annot"><span class="annottext">LinA ann
</span><a href="#local-6989586621681678413"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LinA ann
</span><a href="#local-6989586621681678413"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LinA ann -&gt; LinASt ann -&gt; LinASt ann
forall a. Fwd a -&gt; a -&gt; a
</span><a href="Agda.Utils.Monoid.html#appFwd"><span class="hs-operator hs-var">`appFwd`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LinASt ann
forall ann. Monoid ann =&gt; Int -&gt; LinASt ann
</span><a href="Agda.Utils.DocTree.html#initLinASt"><span class="hs-identifier hs-var">initLinASt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678412"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-type">LinASt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">List1 ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681678415"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678415"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681678416"><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678416"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="Agda.Utils.DocTree.html#builderToText"><span class="hs-identifier hs-var">builderToText</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678415"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678416"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><span class="hs-comment">-- | Initial linearizer state with configurable offset.</span></span><span>
</span><span id="line-301"></span><span id="local-6989586621681678097"><span class="annot"><a href="Agda.Utils.DocTree.html#initLinASt"><span class="hs-identifier hs-type">initLinASt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678097"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-type">LinASt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678097"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-302"></span><span id="initLinASt"><span class="annot"><span class="annottext">initLinASt :: forall ann. Monoid ann =&gt; Int -&gt; LinASt ann
</span><a href="Agda.Utils.DocTree.html#initLinASt"><span class="hs-identifier hs-var hs-var">initLinASt</span></a></span></span><span> </span><span id="local-6989586621681678423"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678423"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; List1 ann -&gt; Builder -&gt; RangeMap ann -&gt; LinASt ann
forall ann.
Int -&gt; List1 ann -&gt; Builder -&gt; RangeMap ann -&gt; LinASt ann
</span><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-var">LinASt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678423"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann -&gt; List1 ann
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">RangeMap ann
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><span class="hs-comment">-- | Outputting some text under the currently active annotations.</span></span><span>
</span><span id="line-305"></span><span id="local-6989586621681678088"><span class="annot"><a href="Agda.Utils.DocTree.html#linAText"><span class="hs-identifier hs-type">linAText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678088"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinA"><span class="hs-identifier hs-type">LinA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678088"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-306"></span><span id="linAText"><span class="annot"><span class="annottext">linAText :: forall ann. Monoid ann =&gt; Text -&gt; LinA ann
</span><a href="Agda.Utils.DocTree.html#linAText"><span class="hs-identifier hs-var hs-var">linAText</span></a></span></span><span> </span><span id="local-6989586621681678430"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678430"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LinASt ann -&gt; LinASt ann) -&gt; Fwd (LinASt ann)
forall a. (a -&gt; a) -&gt; Fwd a
</span><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier hs-var">Fwd</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-type">LinASt</span></a></span><span> </span><span id="local-6989586621681678431"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678431"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621681678432"><span class="annot"><span class="annottext">as :: List1 ann
</span><a href="#local-6989586621681678432"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681678433"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678433"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681678434"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678434"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681678435"><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678435"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; List1 ann -&gt; Builder -&gt; RangeMap ann -&gt; LinASt ann
forall ann.
Int -&gt; List1 ann -&gt; Builder -&gt; RangeMap ann -&gt; LinASt ann
</span><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-var">LinASt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678436"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">List1 ann
</span><a href="#local-6989586621681678432"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678437"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678438"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621681678436"><span class="annot"><span class="annottext">end :: Int
</span><a href="#local-6989586621681678436"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678431"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678430"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span id="local-6989586621681678437"><span class="annot"><span class="annottext">b' :: Builder
</span><a href="#local-6989586621681678437"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621681678434"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="Agda.Utils.DocTree.html#textToBuilder"><span class="hs-identifier hs-var">textToBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681678430"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-311"></span><span>      </span><span id="local-6989586621681678438"><span class="annot"><span class="annottext">m' :: RangeMap ann
</span><a href="#local-6989586621681678438"><span class="hs-identifier hs-var hs-var">m'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ann -&gt; ann -&gt; ann) -&gt; Range -&gt; ann -&gt; RangeMap ann -&gt; RangeMap ann
forall a. (a -&gt; a -&gt; a) -&gt; Range -&gt; a -&gt; RangeMap a -&gt; RangeMap a
</span><a href="Agda.Utils.RangeMap.html#insert"><span class="hs-identifier hs-var">RangeMap.insert</span></a></span><span> </span><span class="annot"><span class="annottext">ann -&gt; ann -&gt; ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621681678439"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678433"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">RangeMap ann
</span><a href="#local-6989586621681678435"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-312"></span><span>      </span><span id="local-6989586621681678439"><span class="annot"><span class="annottext">r :: Range
</span><a href="#local-6989586621681678439"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Range.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">from :: Int
</span><a href="Agda.Utils.Range.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678431"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">to :: Int
</span><a href="Agda.Utils.Range.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681678436"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><span class="hs-comment">-- | Adding an annotation to the currently active ones.</span></span><span>
</span><span id="line-315"></span><span id="local-6989586621681678089"><span class="annot"><a href="Agda.Utils.DocTree.html#linANode"><span class="hs-identifier hs-type">linANode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621681678089"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681678089"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinA"><span class="hs-identifier hs-type">LinA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678089"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#LinA"><span class="hs-identifier hs-type">LinA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681678089"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-316"></span><span id="linANode"><span class="annot"><span class="annottext">linANode :: forall ann. Monoid ann =&gt; ann -&gt; LinA ann -&gt; LinA ann
</span><a href="Agda.Utils.DocTree.html#linANode"><span class="hs-identifier hs-var hs-var">linANode</span></a></span></span><span> </span><span id="local-6989586621681678443"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678443"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681678444"><span class="annot"><span class="annottext">LinA ann
</span><a href="#local-6989586621681678444"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LinASt ann -&gt; LinASt ann) -&gt; LinA ann
forall a. (a -&gt; a) -&gt; Fwd a
</span><a href="Agda.Utils.Monoid.html#Fwd"><span class="hs-identifier hs-var">Fwd</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621681678445"><span class="annot"><span class="annottext">st :: LinASt ann
</span><a href="#local-6989586621681678445"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Utils.DocTree.html#LinASt"><span class="hs-identifier hs-type">LinASt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bstAnnotations :: forall ann. LinASt ann -&gt; List1 ann
</span><a href="Agda.Utils.DocTree.html#bstAnnotations"><span class="hs-identifier hs-var">bstAnnotations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681678446"><span class="annot"><span class="annottext">as :: List1 ann
</span><a href="#local-6989586621681678446"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681678447"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681678447"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">LinA ann
</span><a href="#local-6989586621681678444"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LinA ann -&gt; LinASt ann -&gt; LinASt ann
forall a. Fwd a -&gt; a -&gt; a
</span><a href="Agda.Utils.Monoid.html#appFwd"><span class="hs-operator hs-var">`appFwd`</span></a></span><span> </span><span class="annot"><span class="annottext">LinASt ann
</span><a href="#local-6989586621681678445"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Utils.DocTree.html#bstAnnotations"><span class="hs-identifier hs-var">bstAnnotations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681678443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621681678447"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;|</span></span><span> </span><span class="annot"><a href="#local-6989586621681678446"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-319"></span></pre></body></html>