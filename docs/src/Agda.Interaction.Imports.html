<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{-| This module deals with finding imported modules and loading their
    interface files.
-}</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html"><span class="hs-identifier">Agda.Interaction.Imports</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier">Mode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier">ScopeCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier">TypeCheck</span></a></span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier">CheckResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier">CheckResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crModuleInfo"><span class="hs-identifier">crModuleInfo</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crInterface"><span class="hs-identifier">crInterface</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier">crWarnings</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crMode"><span class="hs-identifier">crMode</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crSource"><span class="hs-identifier">crSource</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier">Source</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#scopeCheckFileImport"><span class="hs-identifier">scopeCheckFileImport</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier">parseSource</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier">typeCheckMain</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier">getNonMainInterface</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#getNonMainModuleInfo"><span class="hs-identifier">getNonMainModuleInfo</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier">getInterface</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#importPrimitiveModules"><span class="hs-identifier">importPrimitiveModules</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#raiseNonFatalErrors"><span class="hs-identifier">raiseNonFatalErrors</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier">MainInterface</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TCWorkers"><span class="hs-identifier">TCWorkers</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#wantsParallelChecking"><span class="hs-identifier">wantsParallelChecking</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseModule"><span class="hs-identifier">chaseModule</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier">setOptionsFromSourcePragmas</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-comment">-- Currently only used by test/api/Issue1168.hs:</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier">readInterface</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withExceptT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">execStateT</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">removeFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isUserError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isFullError</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Definitions.html"><span class="hs-identifier">Agda.Syntax.Concrete.Definitions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Attribute.html"><span class="hs-identifier">Agda.Syntax.Concrete.Attribute</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Generic.html"><span class="hs-identifier">Agda.Syntax.Concrete.Generic</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Mode</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html"><span class="hs-identifier">Agda.Syntax.Parser</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.UnusedImports.html"><span class="hs-identifier">Agda.Syntax.Scope.UnusedImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.UnusedImports.html#warnUnusedImports"><span class="hs-identifier">warnUnusedImports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html"><span class="hs-identifier">Agda.Syntax.TopLevelModuleName</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html"><span class="hs-identifier">Agda.Syntax.Translation.ConcreteToAbstract</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevel"><span class="hs-identifier">TopLevel</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevel"><span class="hs-identifier">TopLevel</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevelInfo"><span class="hs-identifier">TopLevelInfo</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevelInfo"><span class="hs-identifier">TopLevelInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelDecls"><span class="hs-identifier">topLevelDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelScope"><span class="hs-identifier">topLevelScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#checkAttributes"><span class="hs-identifier">checkAttributes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract_"><span class="hs-identifier">concreteToAbstract_</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html"><span class="hs-identifier">Agda.Syntax.Translation.ConcreteToAbstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CToA</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html"><span class="hs-identifier">Agda.TypeChecking.InstanceArguments</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Errors.html"><span class="hs-identifier">Agda.TypeChecking.Errors</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warnings"><span class="hs-identifier">warnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.Confluence</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfRules"><span class="hs-identifier">checkConfluenceOfRules</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html#sortRulesOfSymbol"><span class="hs-identifier">sortRulesOfSymbol</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.NonLinPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#getMatchables"><span class="hs-identifier">getMatchables</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#openMetasToPostulates"><span class="hs-identifier">openMetasToPostulates</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html"><span class="hs-identifier">Agda.TypeChecking.Monad.State</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html"><span class="hs-identifier">Agda.TypeChecking.Serialise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decode"><span class="hs-identifier">decode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#encodeFile"><span class="hs-identifier">encodeFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier">decodeInterface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#deserializeHashes"><span class="hs-identifier">deserializeHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html"><span class="hs-identifier">Agda.TypeChecking.Primitive</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html"><span class="hs-identifier">Agda.TypeChecking.DeadCode</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TheTypeChecker.html"><span class="hs-identifier">Agda.TheTypeChecker</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html"><span class="hs-identifier">Agda.Interaction.BasicOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#getGoals"><span class="hs-identifier">getGoals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#prettyGoals"><span class="hs-identifier">prettyGoals</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html"><span class="hs-identifier">Agda.Interaction.FindFile</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Generate</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Precise</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Highlighting</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Precise.html#convert"><span class="hs-identifier">convert</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Vim.html"><span class="hs-identifier">Agda.Interaction.Highlighting.Vim</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Library.html"><span class="hs-identifier">Agda.Interaction.Library</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html"><span class="hs-identifier">Agda.Interaction.Options.Lenses</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lens</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Warnings.html"><span class="hs-identifier">Agda.Interaction.Options.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Warnings.html#unsolvedWarnings"><span class="hs-identifier">unsolvedWarnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Response.html"><span class="hs-identifier">Agda.Interaction.Response</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#RemoveTokenBasedHighlighting"><span class="hs-identifier">RemoveTokenBasedHighlighting</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier">KeepHighlighting</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.html"><span class="hs-identifier">Agda.Utils.CallStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html"><span class="hs-identifier">Agda.Utils.FileName</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html"><span class="hs-identifier">Agda.Utils.Hash</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IO.Binary.html"><span class="hs-identifier">Agda.Utils.IO.Binary</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier">nubOn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.Strict.html"><span class="hs-identifier">Agda.Utils.Maybe.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html"><span class="hs-identifier">Agda.Interaction.Options.ProfileOptions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Profile</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Set1.html"><span class="hs-identifier">Agda.Utils.Set1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set1</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.Trie.html"><span class="hs-identifier">Agda.Utils.Trie</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Trie</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.IORef.Strict.html"><span class="hs-identifier">Agda.Utils.IORef.Strict</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.WithDefault.html"><span class="hs-identifier">Agda.Utils.WithDefault</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><span class="hs-comment">-- | Whether to ignore interfaces (@.agdai@) other than built-in modules</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span id="local-6989586621682238343"><span class="annot"><a href="Agda.Interaction.Imports.html#ignoreInterfaces"><span class="hs-identifier hs-type">ignoreInterfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682238343"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682238343"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-140"></span><span id="ignoreInterfaces"><span class="annot"><span class="annottext">ignoreInterfaces :: forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreInterfaces"><span class="hs-identifier hs-var hs-var">ignoreInterfaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Types.html#optIgnoreInterfaces"><span class="hs-identifier hs-var">optIgnoreInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool) -&gt; m CommandLineOptions -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><span class="hs-comment">-- | Whether to ignore all interface files (@.agdai@)</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span id="local-6989586621682240079"><span class="annot"><a href="Agda.Interaction.Imports.html#ignoreAllInterfaces"><span class="hs-identifier hs-type">ignoreAllInterfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682240079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-145"></span><span id="ignoreAllInterfaces"><span class="annot"><span class="annottext">ignoreAllInterfaces :: forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreAllInterfaces"><span class="hs-identifier hs-var hs-var">ignoreAllInterfaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Types.html#optIgnoreAllInterfaces"><span class="hs-identifier hs-var">optIgnoreAllInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool) -&gt; m CommandLineOptions -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-comment">-- | Whether to write interface files (@.agdai@)</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span id="local-6989586621682240086"><span class="annot"><a href="Agda.Interaction.Imports.html#writeInterfaces"><span class="hs-identifier hs-type">writeInterfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682240086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-150"></span><span id="writeInterfaces"><span class="annot"><span class="annottext">writeInterfaces :: forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#writeInterfaces"><span class="hs-identifier hs-var hs-var">writeInterfaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Types.html#optWriteInterfaces"><span class="hs-identifier hs-var">optWriteInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Bool) -&gt; m CommandLineOptions -&gt; m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">-- | The decorated source code.</span></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-keyword">data</span><span> </span><span id="Source"><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-var">Source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Source"><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-var">Source</span></a></span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="srcText"><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var hs-var">srcText</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TL.Text</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Source code.</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcFileType"><span class="annot"><span class="annottext">Source -&gt; FileType
</span><a href="Agda.Interaction.Imports.html#srcFileType"><span class="hs-identifier hs-var hs-var">srcFileType</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#FileType"><span class="hs-identifier hs-type">FileType</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Source file type</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcOrigin"><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var hs-var">srcOrigin</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Source location at the time of its parsing</span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcModule"><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var hs-var">srcModule</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Module"><span class="hs-identifier hs-type">C.Module</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ The parsed module.</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcModuleName"><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var hs-var">srcModuleName</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The top-level module name.</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcProjectLibs"><span class="annot"><span class="annottext">Source -&gt; [AgdaLibFile]
</span><a href="Agda.Interaction.Imports.html#srcProjectLibs"><span class="hs-identifier hs-var hs-var">srcProjectLibs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Library.Base.html#AgdaLibFile"><span class="hs-identifier hs-type">AgdaLibFile</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ The .agda-lib file(s) of the project this file belongs to.</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srcAttributes"><span class="annot"><span class="annottext">Source -&gt; Attributes
</span><a href="Agda.Interaction.Imports.html#srcAttributes"><span class="hs-identifier hs-var hs-var">srcAttributes</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Agda.Syntax.Concrete.Attribute.html#Attributes"><span class="hs-identifier hs-type">Attributes</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Every encountered attribute.</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-comment">-- | Parses a source file and prepares the 'Source' record.</span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">parseSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-168"></span><span id="parseSource"><span class="annot"><span class="annottext">parseSource :: SourceFile -&gt; TCM Source
</span><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-var hs-var">parseSource</span></a></span></span><span> </span><span id="local-6989586621682240101"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240101"><span class="hs-identifier hs-var">sourceFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM Source -&gt; TCM Source
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Parsing"><span class="hs-identifier hs-var">Bench.Parsing</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM Source -&gt; TCM Source) -&gt; TCM Source -&gt; TCM Source
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-comment">-- Issue #7303:</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-comment">-- The parser previously used mdo to avoid the duplicate parsing for the</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-comment">-- bootstrapping of the TopLevelModuleName in Range.</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-comment">-- But that made ranges blackholes during parsing,</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-comment">-- introducing regression #7301, fragility of the API as observed in #7492,</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-comment">-- and debugging headaches as ranges could not be showed during parsing.</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- Now we bite the bullet to parse the source twice,</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-comment">-- until a better management of ranges comes about.</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-comment">-- (E.g. it is unclear why ranges need the file name/id in place</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-comment">-- so early, as all the ranges from one file have the same file id.</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-comment">-- It would be sufficient to fill in the file name/id when the mixing</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-comment">-- with other files starts, e.g. during scope checking.)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621682240104"><span class="annot"><a href="#local-6989586621682240104"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCMT IO AbsolutePath
forall (m :: * -&gt; *). MonadFileId m =&gt; SourceFile -&gt; m AbsolutePath
</span><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240101"><span class="hs-identifier hs-var">sourceFile</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-comment">-- Read the source text.</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240106"><span class="annot"><a href="#local-6989586621682240106"><span class="hs-identifier hs-var hs-var">rf0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Maybe TopLevelModuleName -&gt; RangeFile
</span><a href="Agda.Syntax.Position.html#mkRangeFile"><span class="hs-identifier hs-var">mkRangeFile</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240104"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-type">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#beginningOfFile"><span class="hs-identifier hs-type">beginningOfFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240106"><span class="hs-identifier hs-type">rf0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621682240110"><span class="annot"><a href="#local-6989586621682240110"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#runPM"><span class="hs-identifier hs-type">runPM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html#readFilePM"><span class="hs-identifier hs-type">readFilePM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240106"><span class="hs-identifier hs-type">rf0</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240113"><span class="annot"><a href="#local-6989586621682240113"><span class="hs-identifier hs-var hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">TL.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682240110"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- Get the literate markdown option.</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621682240115"><span class="annot"><a href="#local-6989586621682240115"><span class="hs-identifier hs-var">mdOnlyAgdaBlocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#optMdOnlyAgdaBlocks"><span class="hs-identifier hs-var">optMdOnlyAgdaBlocks</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-type">commandLineOptions</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-comment">-- Bootstrapping: parse the module name.</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621682240117"><span class="annot"><a href="#local-6989586621682240117"><span class="hs-identifier hs-var">parsedModName0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleName"><span class="hs-identifier hs-type">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240104"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#runPMDropWarnings"><span class="hs-identifier hs-type">runPMDropWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html#parseFile"><span class="hs-identifier hs-type">parseFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240115"><span class="hs-identifier hs-type">mdOnlyAgdaBlocks</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html#moduleParser"><span class="hs-identifier hs-type">moduleParser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240106"><span class="hs-identifier hs-type">rf0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240113"><span class="hs-identifier hs-type">txt</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-comment">-- Now parse again, with module name present to be filled into the ranges.</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240125"><span class="annot"><a href="#local-6989586621682240125"><span class="hs-identifier hs-var hs-var">rf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; Maybe TopLevelModuleName -&gt; RangeFile
</span><a href="Agda.Syntax.Position.html#mkRangeFile"><span class="hs-identifier hs-var">mkRangeFile</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240104"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe TopLevelModuleName -&gt; RangeFile)
-&gt; Maybe TopLevelModuleName -&gt; RangeFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240117"><span class="hs-identifier hs-var">parsedModName0</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682240126"><span class="annot"><a href="#local-6989586621682240126"><span class="hs-identifier hs-var">parsedMod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240127"><span class="annot"><a href="#local-6989586621682240127"><span class="hs-identifier hs-var">attrs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240128"><span class="annot"><a href="#local-6989586621682240128"><span class="hs-identifier hs-var">fileType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#runPM"><span class="hs-identifier hs-type">runPM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html#parseFile"><span class="hs-identifier hs-type">parseFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240115"><span class="hs-identifier hs-type">mdOnlyAgdaBlocks</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.html#moduleParser"><span class="hs-identifier hs-type">moduleParser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240125"><span class="hs-identifier hs-type">rf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240113"><span class="hs-identifier hs-type">txt</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621682240129"><span class="annot"><a href="#local-6989586621682240129"><span class="hs-identifier hs-var">parsedModName</span></a></span></span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleName"><span class="hs-identifier hs-type">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240104"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240126"><span class="hs-identifier hs-type">parsedMod</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621682240130"><span class="annot"><a href="#local-6989586621682240130"><span class="hs-identifier hs-var">libs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getAgdaLibFiles"><span class="hs-identifier hs-type">getAgdaLibFiles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240104"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240129"><span class="hs-identifier hs-type">parsedModName</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240110"><span class="hs-identifier hs-type">source</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcFileType"><span class="hs-identifier hs-var">srcFileType</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240128"><span class="hs-identifier hs-type">fileType</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240101"><span class="hs-identifier hs-type">sourceFile</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240126"><span class="hs-identifier hs-type">parsedMod</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240129"><span class="hs-identifier hs-type">parsedModName</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcProjectLibs"><span class="hs-identifier hs-var">srcProjectLibs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240130"><span class="hs-identifier hs-type">libs</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcAttributes"><span class="hs-identifier hs-var">srcAttributes</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240127"><span class="hs-identifier hs-type">attrs</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | Computes the module name of the top-level module in the given file.</span><span>
</span><span id="line-217"></span><span class="hs-comment">--</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- If no top-level module name is given, then an attempt is made to</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- use the file name as a module name.</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleName"><span class="hs-identifier hs-type">moduleName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-222"></span><span>     </span><span class="annot"><a href="Agda.Utils.FileName.html#AbsolutePath"><span class="hs-identifier hs-type">AbsolutePath</span></a></span><span>
</span><span id="line-223"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The path to the file.</span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Module"><span class="hs-identifier hs-type">C.Module</span></a></span><span>
</span><span id="line-225"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The parsed module.</span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-227"></span><span id="moduleName"><span class="annot"><span class="annottext">moduleName :: AbsolutePath -&gt; Module -&gt; TCM TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span></span><span> </span><span id="local-6989586621682240132"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240132"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621682240133"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682240133"><span class="hs-identifier hs-var">parsedModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCM TopLevelModuleName -&gt; TCM TopLevelModuleName
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#ModuleName"><span class="hs-identifier hs-var">Bench.ModuleName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM TopLevelModuleName -&gt; TCM TopLevelModuleName)
-&gt; TCM TopLevelModuleName -&gt; TCM TopLevelModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240135"><span class="annot"><span class="annottext">defaultName :: [Char]
</span><a href="#local-6989586621682240135"><span class="hs-identifier hs-var hs-var">defaultName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Interaction.FindFile.html#rootNameModule"><span class="hs-identifier hs-var">rootNameModule</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240132"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span id="local-6989586621682240137"><span class="annot"><span class="annottext">raw :: RawTopLevelModuleName
</span><a href="#local-6989586621682240137"><span class="hs-identifier hs-var hs-var">raw</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; RawTopLevelModuleName
</span><a href="Agda.Syntax.TopLevelModuleName.html#rawTopLevelModuleNameForModule"><span class="hs-identifier hs-var">rawTopLevelModuleNameForModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682240133"><span class="hs-identifier hs-var">parsedModule</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; TCM TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.State.html#topLevelModuleName"><span class="hs-identifier hs-var">topLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">(RawTopLevelModuleName -&gt; TCM TopLevelModuleName)
-&gt; TCMT IO RawTopLevelModuleName -&gt; TCM TopLevelModuleName
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621682240137"><span class="hs-identifier hs-var">raw</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Range
-&gt; TCMT IO RawTopLevelModuleName -&gt; TCMT IO RawTopLevelModuleName
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsolutePath -&gt; Range
</span><a href="Agda.Syntax.Position.html#rangeFromAbsolutePath"><span class="hs-identifier hs-var">rangeFromAbsolutePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240132"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621682240142"><span class="annot"><a href="#local-6989586621682240142"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PM QName -&gt; TCM QName
forall a. PM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Trace.html#runPM"><span class="hs-identifier hs-var">runPM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName, Attributes) -&gt; QName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((QName, Attributes) -&gt; QName)
-&gt; PM (QName, Attributes) -&gt; PM QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser QName -&gt; [Char] -&gt; PM (QName, Attributes)
forall a. Parser a -&gt; [Char] -&gt; PM (a, Attributes)
</span><a href="Agda.Syntax.Parser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">Parser QName
</span><a href="Agda.Syntax.Parser.html#moduleNameParser"><span class="hs-identifier hs-var">moduleNameParser</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240135"><span class="hs-identifier hs-var">defaultName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>             </span><span class="annot"><span class="annottext">TCM QName -&gt; (TCErr -&gt; TCM QName) -&gt; TCM QName
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-234"></span><span>           </span><span class="annot"><span class="annottext">TypeError -&gt; TCM QName
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM QName) -&gt; TypeError -&gt; TCM QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; InvalidFileNameReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#InvalidFileName"><span class="hs-identifier hs-var">InvalidFileName</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240132"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidFileNameReason
</span><a href="Agda.TypeChecking.Monad.Base.html#DoesNotCorrespondToValidModuleName"><span class="hs-identifier hs-var">DoesNotCorrespondToValidModuleName</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682240142"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Qual"><span class="hs-identifier hs-type">C.Qual</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>          </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO RawTopLevelModuleName
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO RawTopLevelModuleName)
-&gt; TypeError -&gt; TCMT IO RawTopLevelModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; InvalidFileNameReason -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#InvalidFileName"><span class="hs-identifier hs-var">InvalidFileName</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240132"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">(InvalidFileNameReason -&gt; TypeError)
-&gt; InvalidFileNameReason -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-238"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; InvalidFileNameReason
</span><a href="Agda.TypeChecking.Monad.Base.html#RootNameModuleNotAQualifiedModuleName"><span class="hs-identifier hs-var">RootNameModuleNotAQualifiedModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InvalidFileNameReason) -&gt; Text -&gt; InvalidFileNameReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240135"><span class="hs-identifier hs-var">defaultName</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; TCMT IO RawTopLevelModuleName
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(RawTopLevelModuleName -&gt; TCMT IO RawTopLevelModuleName)
-&gt; RawTopLevelModuleName -&gt; TCMT IO RawTopLevelModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#RawTopLevelModuleName"><span class="hs-identifier hs-type">RawTopLevelModuleName</span></a></span><span>
</span><span id="line-241"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rawModuleNameRange :: Range
</span><a href="Agda.Syntax.TopLevelModuleName.html#rawModuleNameRange"><span class="hs-identifier hs-var">rawModuleNameRange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240142"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-242"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rawModuleNameParts :: TopLevelModuleNameParts
</span><a href="Agda.Syntax.TopLevelModuleName.html#rawModuleNameParts"><span class="hs-identifier hs-var">rawModuleNameParts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TopLevelModuleNameParts
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240135"><span class="hs-identifier hs-var">defaultName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rawModuleNameInferred :: Bool
</span><a href="Agda.Syntax.TopLevelModuleName.html#rawModuleNameInferred"><span class="hs-identifier hs-var">rawModuleNameInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-244"></span><span>                </span><span class="hs-comment">-- Andreas, 2025-06-21, issue #7953:</span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-comment">-- Remember we made up this module name to improve errors.</span><span>
</span><span id="line-246"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; TCMT IO RawTopLevelModuleName
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName
</span><a href="#local-6989586621682240137"><span class="hs-identifier hs-var">raw</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-type">srcDefaultPragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Library.Base.html#OptionsPragma"><span class="hs-identifier hs-type">OptionsPragma</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span id="srcDefaultPragmas"><span class="annot"><span class="annottext">srcDefaultPragmas :: Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-var hs-var">srcDefaultPragmas</span></a></span></span><span> </span><span id="local-6989586621682240160"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240160"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AgdaLibFile -&gt; OptionsPragma) -&gt; [AgdaLibFile] -&gt; [OptionsPragma]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AgdaLibFile -&gt; OptionsPragma
</span><a href="Agda.Interaction.Library.Base.html#_libPragmas"><span class="hs-identifier hs-var">_libPragmas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; [AgdaLibFile]
</span><a href="Agda.Interaction.Imports.html#srcProjectLibs"><span class="hs-identifier hs-var">srcProjectLibs</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240160"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-type">srcFilePragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Interaction.Library.Base.html#OptionsPragma"><span class="hs-identifier hs-type">OptionsPragma</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-254"></span><span id="srcFilePragmas"><span class="annot"><span class="annottext">srcFilePragmas :: Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-var hs-var">srcFilePragmas</span></a></span></span><span> </span><span id="local-6989586621682240163"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240163"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621682240164"><span class="hs-identifier hs-var">pragmas</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621682240165"><span class="annot"><span class="annottext">cpragmas :: [Pragma]
</span><a href="#local-6989586621682240165"><span class="hs-identifier hs-var hs-var">cpragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Pragma]
</span><a href="Agda.Syntax.Concrete.html#modPragmas"><span class="hs-identifier hs-var">C.modPragmas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240163"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621682240164"><span class="annot"><span class="annottext">pragmas :: [OptionsPragma]
</span><a href="#local-6989586621682240164"><span class="hs-identifier hs-var hs-var">pragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Interaction.Library.Base.html#OptionsPragma"><span class="hs-identifier hs-type">OptionsPragma</span></a></span><span>
</span><span id="line-258"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pragmaStrings :: [[Char]]
</span><a href="Agda.Interaction.Library.Base.html#pragmaStrings"><span class="hs-identifier hs-var">pragmaStrings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621682240169"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-259"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pragmaRange :: Range
</span><a href="Agda.Interaction.Library.Base.html#pragmaRange"><span class="hs-identifier hs-var">pragmaRange</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682240171"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-260"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-261"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#OptionsPragma"><span class="hs-identifier hs-type">C.OptionsPragma</span></a></span><span> </span><span id="local-6989586621682240171"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682240171"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682240169"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621682240169"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Pragma]
</span><a href="#local-6989586621682240165"><span class="hs-identifier hs-var">cpragmas</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Set options from a 'Source' pragma, using the source</span><span>
</span><span id="line-265"></span><span class="hs-comment">--   ranges of the pragmas for error reporting. Flag to check consistency.</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-type">setOptionsFromSourcePragmas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span id="setOptionsFromSourcePragmas"><span class="annot"><span class="annottext">setOptionsFromSourcePragmas :: Bool -&gt; Source -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-var hs-var">setOptionsFromSourcePragmas</span></a></span></span><span> </span><span id="local-6989586621682240173"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682240173"><span class="hs-identifier hs-var">checkOpts</span></a></span></span><span> </span><span id="local-6989586621682240174"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240174"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="annottext">(OptionsPragma -&gt; TCM ()) -&gt; [OptionsPragma] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="#local-6989586621682240176"><span class="hs-identifier hs-var">setOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-var">srcDefaultPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240174"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="annottext">(OptionsPragma -&gt; TCM ()) -&gt; [OptionsPragma] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="#local-6989586621682240176"><span class="hs-identifier hs-var">setOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-var">srcFilePragmas</span></a></span><span>    </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240174"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621682240176"><span class="annot"><span class="annottext">setOpts :: OptionsPragma -&gt; TCM ()
</span><a href="#local-6989586621682240176"><span class="hs-identifier hs-var hs-var">setOpts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682240173"><span class="hs-identifier hs-var">checkOpts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#checkAndSetOptionsFromPragma"><span class="hs-identifier hs-var">checkAndSetOptionsFromPragma</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionsPragma -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setOptionsFromPragma"><span class="hs-identifier hs-var">setOptionsFromPragma</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">-- | Is the aim to type-check the top-level module, or only to</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- scope-check it?</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-keyword">data</span><span> </span><span id="Mode"><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-var">Mode</span></a></span></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ScopeCheck"><span class="annot"><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TypeCheck"><span class="annot"><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682240180"><span id="local-6989586621682240185"><span class="annot"><span class="annottext">Mode -&gt; Mode -&gt; Bool
(Mode -&gt; Mode -&gt; Bool) -&gt; (Mode -&gt; Mode -&gt; Bool) -&gt; Eq Mode
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Mode -&gt; Mode -&gt; Bool
== :: Mode -&gt; Mode -&gt; Bool
$c/= :: Mode -&gt; Mode -&gt; Bool
/= :: Mode -&gt; Mode -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240190"><span id="local-6989586621682240192"><span id="local-6989586621682240196"><span class="annot"><span class="annottext">Int -&gt; Mode -&gt; ShowS
[Mode] -&gt; ShowS
Mode -&gt; [Char]
(Int -&gt; Mode -&gt; ShowS)
-&gt; (Mode -&gt; [Char]) -&gt; ([Mode] -&gt; ShowS) -&gt; Show Mode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Mode -&gt; ShowS
showsPrec :: Int -&gt; Mode -&gt; ShowS
$cshow :: Mode -&gt; [Char]
show :: Mode -&gt; [Char]
$cshowList :: [Mode] -&gt; ShowS
showList :: [Mode] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Are we loading the interface for the user-loaded file</span><span>
</span><span id="line-283"></span><span class="hs-comment">--   or for an import?</span><span>
</span><span id="line-284"></span><span class="hs-keyword">data</span><span> </span><span id="MainInterface"><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MainInterface"><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span> </span><span class="hs-comment">-- ^ For the main file.</span><span>
</span><span id="line-286"></span><span>                       </span><span class="hs-comment">--</span><span>
</span><span id="line-287"></span><span>                       </span><span class="hs-comment">--   In this case state changes inflicted by</span><span>
</span><span id="line-288"></span><span>                       </span><span class="hs-comment">--   'createInterface' are preserved.</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotMainInterface"><span class="annot"><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span></span><span>   </span><span class="hs-comment">-- ^ For an imported file.</span><span>
</span><span id="line-290"></span><span>                       </span><span class="hs-comment">--</span><span>
</span><span id="line-291"></span><span>                       </span><span class="hs-comment">--   In this case state changes inflicted by</span><span>
</span><span id="line-292"></span><span>                       </span><span class="hs-comment">--   'createInterface' are not preserved.</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682240204"><span id="local-6989586621682240209"><span class="annot"><span class="annottext">MainInterface -&gt; MainInterface -&gt; Bool
(MainInterface -&gt; MainInterface -&gt; Bool)
-&gt; (MainInterface -&gt; MainInterface -&gt; Bool) -&gt; Eq MainInterface
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: MainInterface -&gt; MainInterface -&gt; Bool
== :: MainInterface -&gt; MainInterface -&gt; Bool
$c/= :: MainInterface -&gt; MainInterface -&gt; Bool
/= :: MainInterface -&gt; MainInterface -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240213"><span id="local-6989586621682240218"><span id="local-6989586621682240222"><span class="annot"><span class="annottext">Int -&gt; MainInterface -&gt; ShowS
[MainInterface] -&gt; ShowS
MainInterface -&gt; [Char]
(Int -&gt; MainInterface -&gt; ShowS)
-&gt; (MainInterface -&gt; [Char])
-&gt; ([MainInterface] -&gt; ShowS)
-&gt; Show MainInterface
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MainInterface -&gt; ShowS
showsPrec :: Int -&gt; MainInterface -&gt; ShowS
$cshow :: MainInterface -&gt; [Char]
show :: MainInterface -&gt; [Char]
$cshowList :: [MainInterface] -&gt; ShowS
showList :: [MainInterface] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><span class="hs-comment">-- | Should state changes inflicted by 'createInterface' be preserved?</span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-type">includeStateChanges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-298"></span><span id="includeStateChanges"><span class="annot"><span class="annottext">includeStateChanges :: MainInterface -&gt; Bool
</span><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-var hs-var">includeStateChanges</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-var">includeStateChanges</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="annot"><span class="hs-comment">-- | The kind of interface produced by 'createInterface'</span></span><span>
</span><span id="line-302"></span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-type">moduleCheckMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleCheckMode"><span class="hs-identifier hs-type">ModuleCheckMode</span></a></span><span>
</span><span id="line-303"></span><span id="moduleCheckMode"><span class="annot"><span class="annottext">moduleCheckMode :: MainInterface -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-var hs-var">moduleCheckMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#TypeCheck"><span class="hs-identifier hs-var">TypeCheck</span></a></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-var">ModuleTypeChecked</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleScopeChecked"><span class="hs-identifier hs-var">ModuleScopeChecked</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><span class="hs-comment">-- | Merge an interface into the current proof state.</span></span><span>
</span><span id="line-309"></span><span class="annot"><a href="Agda.Interaction.Imports.html#mergeInterface"><span class="hs-identifier hs-type">mergeInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span id="mergeInterface"><span class="annot"><span class="annottext">mergeInterface :: Interface -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#mergeInterface"><span class="hs-identifier hs-var hs-var">mergeInterface</span></a></span></span><span> </span><span id="local-6989586621682240229"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240229"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240230"><span class="annot"><span class="annottext">sig :: Signature
</span><a href="#local-6989586621682240230"><span class="hs-identifier hs-var hs-var hs-var">sig</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#iSignature"><span class="hs-identifier hs-var">iSignature</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240229"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621682240232"><span class="annot"><span class="annottext">builtin :: [(SomeBuiltin, Builtin (PrimitiveId, QName))]
</span><a href="#local-6989586621682240232"><span class="hs-identifier hs-var hs-var hs-var">builtin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin (PrimitiveId, QName))
-&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin (PrimitiveId, QName))
 -&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))])
-&gt; Map SomeBuiltin (Builtin (PrimitiveId, QName))
-&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="Agda.TypeChecking.Monad.Base.html#iBuiltin"><span class="hs-identifier hs-var">iBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240229"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span id="local-6989586621682240235"><span class="annot"><span class="annottext">primOrBi :: (a, Builtin a) -&gt; Either a (a, Builtin pf)
</span><a href="#local-6989586621682240235"><span class="hs-identifier hs-var hs-var hs-var">primOrBi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-314"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621682240237"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682240237"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either a (a, Builtin pf)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682240237"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-315"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682240238"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682240238"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621682240240"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240240"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, Builtin pf) -&gt; Either a (a, Builtin pf)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682240238"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Builtin pf
forall pf. Term -&gt; Builtin pf
</span><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240240"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682240241"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682240241"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-type">BuiltinRewriteRelations</span></a></span><span> </span><span id="local-6989586621682240243"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240243"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, Builtin pf) -&gt; Either a (a, Builtin pf)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682240241"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Builtin pf
forall pf. Set QName -&gt; Builtin pf
</span><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-var">BuiltinRewriteRelations</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240243"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682240244"><span class="annot"><span class="annottext">[(PrimitiveId, QName)]
</span><a href="#local-6989586621682240244"><span class="hs-keyword hs-var hs-var">prim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240245"><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin PrimFun)]
</span><a href="#local-6989586621682240245"><span class="hs-identifier hs-var hs-var">bi'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
-&gt; ([(PrimitiveId, QName)], [(SomeBuiltin, Builtin PrimFun)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
 -&gt; ([(PrimitiveId, QName)], [(SomeBuiltin, Builtin PrimFun)]))
-&gt; [Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
-&gt; ([(PrimitiveId, QName)], [(SomeBuiltin, Builtin PrimFun)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((SomeBuiltin, Builtin (PrimitiveId, QName))
 -&gt; Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun))
-&gt; [(SomeBuiltin, Builtin (PrimitiveId, QName))]
-&gt; [Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SomeBuiltin, Builtin (PrimitiveId, QName))
-&gt; Either (PrimitiveId, QName) (SomeBuiltin, Builtin PrimFun)
forall {a} {a} {pf}. (a, Builtin a) -&gt; Either a (a, Builtin pf)
</span><a href="#local-6989586621682240235"><span class="hs-identifier hs-var">primOrBi</span></a></span><span> </span><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin (PrimitiveId, QName))]
</span><a href="#local-6989586621682240232"><span class="hs-identifier hs-var">builtin</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span id="local-6989586621682240247"><span class="annot"><span class="annottext">bi :: Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621682240247"><span class="hs-identifier hs-var hs-var hs-var">bi</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin PrimFun)]
-&gt; Map SomeBuiltin (Builtin PrimFun)
forall k a. [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromDistinctAscList</span></span><span> </span><span class="annot"><span class="annottext">[(SomeBuiltin, Builtin PrimFun)]
</span><a href="#local-6989586621682240245"><span class="hs-identifier hs-var">bi'</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621682240249"><span class="annot"><span class="annottext">warns :: Set TCWarning
</span><a href="#local-6989586621682240249"><span class="hs-identifier hs-var hs-var hs-var">warns</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Set TCWarning
</span><a href="Agda.TypeChecking.Monad.Base.html#iWarnings"><span class="hs-identifier hs-var">iWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240229"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621682240251"><span class="annot"><a href="#local-6989586621682240251"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; Map SomeBuiltin (Builtin PrimFun))
-&gt; TCMT IO (Map SomeBuiltin (Builtin PrimFun))
forall (m :: * -&gt; *) a. ReadTCState m =&gt; (TCState -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-var">getsTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; Map SomeBuiltin (Builtin PrimFun)
</span><a href="Agda.TypeChecking.Monad.Base.html#stBuiltinThings"><span class="hs-identifier hs-var">stBuiltinThings</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.merge&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Merging interface &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.merge&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="hs-string">&quot;  Current builtins &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.keys</span></span><span> </span><span class="annot"><a href="#local-6989586621682240251"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><span class="hs-string">&quot;  New builtins     &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.keys</span></span><span> </span><span class="annot"><a href="#local-6989586621682240247"><span class="hs-identifier hs-type">bi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240291"><span class="annot"><a href="#local-6989586621682240291"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#BuiltinName"><span class="hs-identifier hs-type">BuiltinName</span></a></span><span> </span><span id="local-6989586621682240293"><span class="annot"><span class="annottext">BuiltinId
</span><a href="#local-6989586621682240293"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621682240294"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240294"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621682240295"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240295"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240294"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240295"><span class="hs-identifier hs-var">y</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; TypeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; Term -&gt; Term -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#DuplicateBuiltinBinding"><span class="hs-identifier hs-var">DuplicateBuiltinBinding</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="#local-6989586621682240293"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240294"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682240295"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><a href="#local-6989586621682240291"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-type">BuiltinRewriteRelations</span></a></span><span> </span><span id="local-6989586621682240297"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240297"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinRewriteRelations"><span class="hs-identifier hs-type">BuiltinRewriteRelations</span></a></span><span> </span><span id="local-6989586621682240298"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240298"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><a href="#local-6989586621682240291"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Builtin pf
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Builtin pf
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">sequence_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.intersectionWithKey</span></span><span> </span><span class="annot"><a href="#local-6989586621682240291"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240251"><span class="hs-identifier hs-type">bs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240247"><span class="hs-identifier hs-type">bi</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-type">addImportedThings</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><a href="#local-6989586621682240230"><span class="hs-identifier hs-type">sig</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iMetaBindings"><span class="hs-identifier hs-var">iMetaBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><a href="#local-6989586621682240247"><span class="hs-identifier hs-type">bi</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iPatternSyns"><span class="hs-identifier hs-var">iPatternSyns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iDisplayForms"><span class="hs-identifier hs-var">iDisplayForms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iUserWarnings"><span class="hs-identifier hs-var">iUserWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iPartialDefs"><span class="hs-identifier hs-var">iPartialDefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><a href="#local-6989586621682240249"><span class="hs-identifier hs-type">warns</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueBlocks"><span class="hs-identifier hs-var">iOpaqueBlocks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueNames"><span class="hs-identifier hs-var">iOpaqueNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240229"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.merge&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="hs-string">&quot;  Rebinding primitives &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240244"><span class="hs-keyword hs-type">prim</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682240310"><span class="hs-identifier hs-type">rebind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240244"><span class="hs-keyword hs-type">prim</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-type">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-type">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240314"><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682240314"><span class="hs-identifier hs-var">confChk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240315"><span class="annot"><span class="annottext">rews :: RewriteRules
</span><a href="#local-6989586621682240315"><span class="hs-identifier hs-var hs-var hs-var">rews</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RewriteRules] -&gt; RewriteRules
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([RewriteRules] -&gt; RewriteRules) -&gt; [RewriteRules] -&gt; RewriteRules
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName RewriteRules -&gt; [RewriteRules]
forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">HMap.elems</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName RewriteRules -&gt; [RewriteRules])
-&gt; HashMap QName RewriteRules -&gt; [RewriteRules]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621682240230"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
-&gt; Lens' Signature (HashMap QName RewriteRules)
-&gt; HashMap QName RewriteRules
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName RewriteRules -&gt; f (HashMap QName RewriteRules))
-&gt; Signature -&gt; f Signature
Lens' Signature (HashMap QName RewriteRules)
</span><a href="Agda.TypeChecking.Monad.Base.html#sigRewriteRules"><span class="hs-identifier hs-var">sigRewriteRules</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.confluence&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RewriteRules -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240315"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  No rewrite rules imported&quot;</span></span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">P.vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">P.nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; [TCMT IO Doc]) -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-354"></span><span>            </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking confluence of imported rewrite rules&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><span class="annottext">(RewriteRule -&gt; TCMT IO Doc) -&gt; RewriteRules -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">P.&lt;+&gt;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (RewriteRule -&gt; TCMT IO Doc) -&gt; RewriteRule -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCMT IO Doc)
-&gt; (RewriteRule -&gt; QName) -&gt; RewriteRule -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewName"><span class="hs-identifier hs-var">rewName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240315"><span class="hs-identifier hs-var">rews</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-comment">-- Andreas, 2025-06-28, PR #7934 and issue #7969:</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-comment">-- Global confluence checker requires rules to be sorted</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-comment">-- according to the generality of their lhs</span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682240314"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; ConfluenceCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="Agda.Interaction.Options.Types.html#GlobalConfluenceCheck"><span class="hs-identifier hs-var">GlobalConfluenceCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><span class="annottext">[QName] -&gt; (QName -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; QName) -&gt; [QName] -&gt; [QName]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier hs-var">nubOn</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [QName]) -&gt; [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RewriteRule -&gt; QName) -&gt; RewriteRules -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#rewHead"><span class="hs-identifier hs-var">rewHead</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240315"><span class="hs-identifier hs-var">rews</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#sortRulesOfSymbol"><span class="hs-identifier hs-var">sortRulesOfSymbol</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-comment">-- #8273: We need to ensure the module we are importing is considered</span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-comment">-- imported when checking confluence.</span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-comment">-- Ideally we would probably add the imports earlier, but this seems very</span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-comment">-- fiddly to do correctly. Instead, we just locally add the imports</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-comment">-- for the duration of checking confluence and revert the state</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-comment">-- afterwards.</span><span>
</span><span id="line-370"></span><span>      </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM () -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#locallyAddImport"><span class="hs-identifier hs-var">locallyAddImport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240229"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; RewriteRules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfRules"><span class="hs-identifier hs-var">checkConfluenceOfRules</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682240314"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240315"><span class="hs-identifier hs-var">rews</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621682240310"><span class="annot"><span class="annottext">rebind :: (PrimitiveId, QName) -&gt; TCM ()
</span><a href="#local-6989586621682240310"><span class="hs-identifier hs-var hs-var">rebind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682240343"><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682240343"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240344"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240344"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimImpl"><span class="hs-identifier hs-type">PrimImpl</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682240346"><span class="annot"><a href="#local-6989586621682240346"><span class="hs-identifier hs-var">pf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimitiveId -&gt; TCM PrimitiveImpl
</span><a href="Agda.TypeChecking.Primitive.Base.html#lookupPrimitiveFunction"><span class="hs-identifier hs-var">lookupPrimitiveFunction</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682240343"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-375"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedBuiltins"><span class="hs-identifier hs-type">stImportedBuiltins</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-type">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#someBuiltin"><span class="hs-identifier hs-type">someBuiltin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240343"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240346"><span class="hs-identifier hs-type">pf</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#primFunName"><span class="hs-identifier hs-var">primFunName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240344"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-type">addImportedThings</span></a></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#RemoteMetaStore"><span class="hs-identifier hs-type">RemoteMetaStore</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BuiltinThings"><span class="hs-identifier hs-type">BuiltinThings</span></a></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">A.PatternSynDefns</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UserWarnings"><span class="hs-identifier hs-type">UserWarnings</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Imported user warnings</span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Name of imported definitions which are partial</span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OpaqueBlock"><span class="hs-identifier hs-type">OpaqueBlock</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span id="addImportedThings"><span class="annot"><span class="annottext">addImportedThings :: Signature
-&gt; RemoteMetaStore
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; PatternSynDefns
-&gt; DisplayForms
-&gt; UserWarnings
-&gt; Set QName
-&gt; Set TCWarning
-&gt; Map OpaqueId OpaqueBlock
-&gt; Map QName OpaqueId
-&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-var hs-var">addImportedThings</span></a></span></span><span> </span><span id="local-6989586621682240356"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621682240356"><span class="hs-identifier hs-var">isig</span></a></span></span><span> </span><span id="local-6989586621682240357"><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621682240357"><span class="hs-identifier hs-var">metas</span></a></span></span><span> </span><span id="local-6989586621682240358"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621682240358"><span class="hs-identifier hs-var">ibuiltin</span></a></span></span><span> </span><span id="local-6989586621682240359"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621682240359"><span class="hs-identifier hs-var">patsyns</span></a></span></span><span> </span><span id="local-6989586621682240360"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621682240360"><span class="hs-identifier hs-var">display</span></a></span></span><span> </span><span id="local-6989586621682240361"><span class="annot"><span class="annottext">UserWarnings
</span><a href="#local-6989586621682240361"><span class="hs-identifier hs-var">userwarn</span></a></span></span><span>
</span><span id="line-390"></span><span>                  </span><span id="local-6989586621682240362"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240362"><span class="hs-identifier hs-var">partialdefs</span></a></span></span><span> </span><span id="local-6989586621682240363"><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682240363"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span id="local-6989586621682240364"><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621682240364"><span class="hs-identifier hs-var">oblock</span></a></span></span><span> </span><span id="local-6989586621682240365"><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621682240365"><span class="hs-identifier hs-var">oid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><span class="annottext">(Signature -&gt; f Signature) -&gt; TCState -&gt; f TCState
Lens' TCState Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-var">stImports</span></a></span><span>              </span><span class="annot"><span class="annottext">Lens' TCState Signature -&gt; (Signature -&gt; Signature) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240369"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621682240369"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Signature -&gt; Signature -&gt; Signature
</span><a href="Agda.Interaction.Imports.html#importSignature"><span class="hs-identifier hs-var">importSignature</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621682240369"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621682240356"><span class="hs-identifier hs-var">isig</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="annottext">(RemoteMetaStore -&gt; f RemoteMetaStore) -&gt; TCState -&gt; f TCState
Lens' TCState RemoteMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedMetaStore"><span class="hs-identifier hs-var">stImportedMetaStore</span></a></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState RemoteMetaStore
-&gt; (RemoteMetaStore -&gt; RemoteMetaStore) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore -&gt; RemoteMetaStore -&gt; RemoteMetaStore
forall k v. Eq k =&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.union</span></span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621682240357"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="annottext">(Map SomeBuiltin (Builtin PrimFun)
 -&gt; f (Map SomeBuiltin (Builtin PrimFun)))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedBuiltins"><span class="hs-identifier hs-var">stImportedBuiltins</span></a></span><span>     </span><span class="annot"><span class="annottext">Lens' TCState (Map SomeBuiltin (Builtin PrimFun))
-&gt; (Map SomeBuiltin (Builtin PrimFun)
    -&gt; Map SomeBuiltin (Builtin PrimFun))
-&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240377"><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621682240377"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin PrimFun)
-&gt; Map SomeBuiltin (Builtin PrimFun)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621682240377"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin PrimFun)
</span><a href="#local-6989586621682240358"><span class="hs-identifier hs-var">ibuiltin</span></a></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">(UserWarnings -&gt; f UserWarnings) -&gt; TCState -&gt; f TCState
Lens' TCState UserWarnings
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedUserWarnings"><span class="hs-identifier hs-var">stImportedUserWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState UserWarnings
-&gt; (UserWarnings -&gt; UserWarnings) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240382"><span class="annot"><span class="annottext">UserWarnings
</span><a href="#local-6989586621682240382"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UserWarnings -&gt; UserWarnings -&gt; UserWarnings
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">UserWarnings
</span><a href="#local-6989586621682240382"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">UserWarnings
</span><a href="#local-6989586621682240361"><span class="hs-identifier hs-var">userwarn</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><span class="annottext">(Set QName -&gt; f (Set QName)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedPartialDefs"><span class="hs-identifier hs-var">stImportedPartialDefs</span></a></span><span>  </span><span class="annot"><span class="annottext">Lens' TCState (Set QName) -&gt; (Set QName -&gt; Set QName) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240386"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240386"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240386"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682240362"><span class="hs-identifier hs-var">partialdefs</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="annottext">(PatternSynDefns -&gt; f PatternSynDefns) -&gt; TCState -&gt; f TCState
Lens' TCState PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#stPatternSynImports"><span class="hs-identifier hs-var">stPatternSynImports</span></a></span><span>    </span><span class="annot"><span class="annottext">Lens' TCState PatternSynDefns
-&gt; (PatternSynDefns -&gt; PatternSynDefns) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240391"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621682240391"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns -&gt; PatternSynDefns -&gt; PatternSynDefns
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621682240391"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621682240359"><span class="hs-identifier hs-var">patsyns</span></a></span><span>
</span><span id="line-397"></span><span>  </span><span class="annot"><span class="annottext">(DisplayForms -&gt; f DisplayForms) -&gt; TCState -&gt; f TCState
Lens' TCState DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedDisplayForms"><span class="hs-identifier hs-var">stImportedDisplayForms</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState DisplayForms
-&gt; (DisplayForms -&gt; DisplayForms) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240395"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621682240395"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(List1 LocalDisplayForm
 -&gt; List1 LocalDisplayForm -&gt; List1 LocalDisplayForm)
-&gt; DisplayForms -&gt; DisplayForms -&gt; DisplayForms
forall k v.
Eq k =&gt;
(v -&gt; v -&gt; v) -&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.unionWith</span></span><span> </span><span class="annot"><span class="annottext">List1 LocalDisplayForm
-&gt; List1 LocalDisplayForm -&gt; List1 LocalDisplayForm
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621682240395"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621682240360"><span class="hs-identifier hs-var">display</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><span class="annottext">(Set TCWarning -&gt; f (Set TCWarning)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set TCWarning)
</span><a href="Agda.TypeChecking.Monad.Base.html#stTCWarnings"><span class="hs-identifier hs-var">stTCWarnings</span></a></span><span>           </span><span class="annot"><span class="annottext">Lens' TCState (Set TCWarning)
-&gt; (Set TCWarning -&gt; Set TCWarning) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240400"><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682240400"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; Set TCWarning -&gt; Set TCWarning
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682240400"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682240363"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="annottext">(Map OpaqueId OpaqueBlock -&gt; f (Map OpaqueId OpaqueBlock))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map OpaqueId OpaqueBlock)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueBlocks"><span class="hs-identifier hs-var">stOpaqueBlocks</span></a></span><span>         </span><span class="annot"><span class="annottext">Lens' TCState (Map OpaqueId OpaqueBlock)
-&gt; (Map OpaqueId OpaqueBlock -&gt; Map OpaqueId OpaqueBlock) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240404"><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621682240404"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621682240404"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
-&gt; Map OpaqueId OpaqueBlock -&gt; Map OpaqueId OpaqueBlock
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621682240364"><span class="hs-identifier hs-var">oblock</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">(Map QName OpaqueId -&gt; f (Map QName OpaqueId))
-&gt; TCState -&gt; f TCState
Lens' TCState (Map QName OpaqueId)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueIds"><span class="hs-identifier hs-var">stOpaqueIds</span></a></span><span>            </span><span class="annot"><span class="annottext">Lens' TCState (Map QName OpaqueId)
-&gt; (Map QName OpaqueId -&gt; Map QName OpaqueId) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240408"><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621682240408"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621682240408"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId -&gt; Map QName OpaqueId -&gt; Map QName OpaqueId
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621682240365"><span class="hs-identifier hs-var">oid</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-comment">-- | Merges two signatures, assuming the second is being imported into the first</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- This is not commutative: `Map.union` is left-biased and we also assume that</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- updates from rewrite rules in the first signature do not need to be</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- re-applied (rewrite rules in the current signature cannot refer to</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- definitions that are not in the current signature)</span><span>
</span><span id="line-408"></span><span class="annot"><a href="Agda.Interaction.Imports.html#importSignature"><span class="hs-identifier hs-type">importSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-409"></span><span>     </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-410"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Current signature</span></span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-412"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Signature being imported</span></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span>
</span><span id="line-414"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Merged signature</span></span><span>
</span><span id="line-415"></span><span id="importSignature"><span class="annot"><span class="annottext">importSignature :: Signature -&gt; Signature -&gt; Signature
</span><a href="Agda.Interaction.Imports.html#importSignature"><span class="hs-identifier hs-var hs-var">importSignature</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Sig"><span class="hs-identifier hs-type">Sig</span></a></span><span> </span><span id="local-6989586621682240410"><span class="annot"><span class="annottext">Sections
</span><a href="#local-6989586621682240410"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682240411"><span class="annot"><span class="annottext">Definitions
</span><a href="#local-6989586621682240411"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682240412"><span class="annot"><span class="annottext">HashMap QName RewriteRules
</span><a href="#local-6989586621682240412"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682240413"><span class="annot"><span class="annottext">InstanceTable
</span><a href="#local-6989586621682240413"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Sig"><span class="hs-identifier hs-type">Sig</span></a></span><span> </span><span id="local-6989586621682240414"><span class="annot"><span class="annottext">Sections
</span><a href="#local-6989586621682240414"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span id="local-6989586621682240415"><span class="annot"><span class="annottext">Definitions
</span><a href="#local-6989586621682240415"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span id="local-6989586621682240416"><span class="annot"><span class="annottext">HashMap QName RewriteRules
</span><a href="#local-6989586621682240416"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span id="local-6989586621682240417"><span class="annot"><span class="annottext">InstanceTable
</span><a href="#local-6989586621682240417"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="annottext">Sections
-&gt; Definitions
-&gt; HashMap QName RewriteRules
-&gt; InstanceTable
-&gt; Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#Sig"><span class="hs-identifier hs-var">Sig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sections -&gt; Sections -&gt; Sections
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Sections
</span><a href="#local-6989586621682240410"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Sections
</span><a href="#local-6989586621682240414"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definitions -&gt; Definitions
</span><a href="#local-6989586621682240418"><span class="hs-identifier hs-var">fixupDefs</span></a></span><span> </span><span class="annot"><span class="annottext">(Definitions -&gt; Definitions) -&gt; Definitions -&gt; Definitions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definitions -&gt; Definitions -&gt; Definitions
forall k v. Eq k =&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.union</span></span><span> </span><span class="annot"><span class="annottext">Definitions
</span><a href="#local-6989586621682240411"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions
</span><a href="#local-6989586621682240415"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- definitions are unique (in at most one module) but need to be fixed to account for the new rewrite rules</span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RewriteRules -&gt; RewriteRules -&gt; RewriteRules)
-&gt; HashMap QName RewriteRules
-&gt; HashMap QName RewriteRules
-&gt; HashMap QName RewriteRules
forall k v.
Eq k =&gt;
(v -&gt; v -&gt; v) -&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.unionWith</span></span><span> </span><span class="annot"><span class="annottext">RewriteRules -&gt; RewriteRules -&gt; RewriteRules
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName RewriteRules
</span><a href="#local-6989586621682240412"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName RewriteRules
</span><a href="#local-6989586621682240416"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- rewrite rules are accumulated</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstanceTable
</span><a href="#local-6989586621682240413"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceTable -&gt; InstanceTable -&gt; InstanceTable
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InstanceTable
</span><a href="#local-6989586621682240417"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- instances are accumulated</span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- #8218: Rewrite rules can modify the signature (e.g. definitional</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- injectivity of the head symbol). We need to replay these adjustments when</span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-comment">-- importing because rewrite rules might be defined in a different module</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- from the definitions they modify.</span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621682240418"><span class="annot"><span class="annottext">fixupDefs :: Definitions -&gt; Definitions
</span><a href="#local-6989586621682240418"><span class="hs-identifier hs-var hs-var">fixupDefs</span></a></span></span><span> </span><span id="local-6989586621682240419"><span class="annot"><span class="annottext">Definitions
</span><a href="#local-6989586621682240419"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((QName, RewriteRules) -&gt; Definitions -&gt; Definitions)
-&gt; Definitions -&gt; [(QName, RewriteRules)] -&gt; Definitions
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682240421"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240421"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240422"><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240422"><span class="hs-identifier hs-var">rews</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; RewriteRules -&gt; [QName] -&gt; Definitions -&gt; Definitions
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefsForRewrites"><span class="hs-identifier hs-var">updateDefsForRewrites</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240421"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240422"><span class="hs-identifier hs-var">rews</span></a></span><span>
</span><span id="line-426"></span><span>                                      </span><span class="annot"><span class="annottext">([QName] -&gt; Definitions -&gt; Definitions)
-&gt; [QName] -&gt; Definitions -&gt; Definitions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RewriteRules
</span><a href="#local-6989586621682240422"><span class="hs-identifier hs-var">rews</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteRules -&gt; (RewriteRule -&gt; [QName]) -&gt; [QName]
forall a b. [a] -&gt; (a -&gt; [b]) -&gt; [b]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">RewriteRule -&gt; [QName]
forall a. GetMatchables a =&gt; a -&gt; [QName]
</span><a href="Agda.TypeChecking.Rewriting.NonLinPattern.html#getMatchables"><span class="hs-identifier hs-var">getMatchables</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>                         </span><span class="annot"><span class="annottext">Definitions
</span><a href="#local-6989586621682240419"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap QName RewriteRules -&gt; [(QName, RewriteRules)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HMap.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName RewriteRules
</span><a href="#local-6989586621682240416"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- | Scope checks the given module, generating an interface or retrieving an existing one.</span><span>
</span><span id="line-430"></span><span class="hs-comment">--   Returns the module name and exported scope from the interface.</span><span>
</span><span id="line-431"></span><span class="hs-comment">--</span><span>
</span><span id="line-432"></span><span class="annot"><a href="Agda.Interaction.Imports.html#scopeCheckFileImport"><span class="hs-identifier hs-type">scopeCheckFileImport</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-433"></span><span>     </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span id="scopeCheckFileImport"><span class="annot"><span class="annottext">scopeCheckFileImport :: TopLevelModuleName -&gt; TCM (ModuleName, Map ModuleName Scope)
</span><a href="Agda.Interaction.Imports.html#scopeCheckFileImport"><span class="hs-identifier hs-var hs-var">scopeCheckFileImport</span></a></span></span><span> </span><span id="local-6989586621682240425"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240425"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Scope checking &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240425"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>      </span><span id="local-6989586621682240426"><span class="annot"><a href="#local-6989586621682240426"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; [Char]) -&gt; TCMT IO Doc -&gt; TCMT IO [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
forall (m :: * -&gt; *). ReadTCState m =&gt; m Doc
</span><a href="Agda.TypeChecking.Monad.Imports.html#getPrettyVisitedModules"><span class="hs-identifier hs-var">getPrettyVisitedModules</span></a></span><span>
</span><span id="line-439"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.scope&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  visited: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682240426"><span class="hs-identifier hs-type">visited</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-comment">-- Since scopeCheckFileImport is called from the scope checker,</span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-comment">-- we need to reimburse her account.</span><span>
</span><span id="line-442"></span><span>    </span><span id="local-6989586621682240428"><span class="annot"><a href="#local-6989586621682240428"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Interface -&gt; TCMT IO Interface)
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var">getNonMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240425"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#addImport"><span class="hs-identifier hs-type">addImport</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240425"><span class="hs-identifier hs-type">top</span></a></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-comment">-- Print list of imported modules in current state.</span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-type">verboseS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.imports&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>      </span><span id="local-6989586621682240430"><span class="annot"><a href="#local-6989586621682240430"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedModules"><span class="hs-identifier hs-type">stImportedModules</span></a></span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.imports&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">intercalate</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-449"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240425"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;added, all imports:&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span>
</span><span id="line-450"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240437"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240437"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240437"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682240430"><span class="hs-identifier hs-type">imports</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-comment">-- Print list of transitively imported modules in current state.</span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-type">verboseS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.imports&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>      </span><span id="local-6989586621682240438"><span class="annot"><a href="#local-6989586621682240438"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedModulesTransitive"><span class="hs-identifier hs-type">stImportedModulesTransitive</span></a></span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.imports&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">intercalate</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-456"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240425"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;added, all transitive imports:&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span>
</span><span id="line-457"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240442"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240442"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240442"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682240438"><span class="hs-identifier hs-type">imports</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-comment">-- If that interface was supposed to raise a warning on import, do so.</span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-type">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iImportWarning"><span class="hs-identifier hs-var">iImportWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240428"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-type">warning</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UserWarning"><span class="hs-identifier hs-type">UserWarning</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-comment">-- let s = publicModules $ iInsideScope i</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240447"><span class="annot"><a href="#local-6989586621682240447"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Map ModuleName Scope
</span><a href="Agda.TypeChecking.Monad.Base.html#iScope"><span class="hs-identifier hs-var">iScope</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240428"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iModuleName"><span class="hs-identifier hs-var">iModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240428"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682240447"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-comment">-- | The result and associated parameters of a type-checked file,</span><span>
</span><span id="line-467"></span><span class="hs-comment">--   when invoked directly via interaction or a backend.</span><span>
</span><span id="line-468"></span><span class="hs-comment">--   Note that the constructor is not exported.</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-keyword">data</span><span> </span><span id="CheckResult"><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-var">CheckResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CheckResult%27"><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult%27"><span class="hs-identifier hs-var">CheckResult'</span></a></span></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="crModuleInfo"><span class="annot"><span class="annottext">CheckResult -&gt; ModuleInfo
</span><a href="Agda.Interaction.Imports.html#crModuleInfo"><span class="hs-identifier hs-var hs-var">crModuleInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="crSource%27"><span class="annot"><span class="annottext">CheckResult -&gt; Source
</span><a href="Agda.Interaction.Imports.html#crSource%27"><span class="hs-identifier hs-var hs-var">crSource'</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="hs-comment">-- | Flattened unidirectional pattern for 'CheckResult' for destructuring inside</span><span>
</span><span id="line-476"></span><span class="hs-comment">--   the 'ModuleInfo' field.</span><span>
</span><span id="line-477"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleCheckMode"><span class="hs-identifier hs-type">ModuleCheckMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span>
</span><span id="line-478"></span><span class="hs-keyword">pattern</span><span> </span><span id="CheckResult"><span id="%24mCheckResult"><span class="annot"><span class="annottext">$mCheckResult :: forall {r}.
CheckResult
-&gt; (Interface -&gt; Set TCWarning -&gt; ModuleCheckMode -&gt; Source -&gt; r)
-&gt; ((# #) -&gt; r)
-&gt; r
</span><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-var hs-var">CheckResult</span></a></span></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="crInterface"><span class="annot"><span class="annottext">CheckResult -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#crInterface"><span class="hs-identifier hs-var hs-var hs-var">crInterface</span></a></span></span><span class="hs-special">,</span><span> </span><span id="crWarnings"><span class="annot"><span class="annottext">CheckResult -&gt; Set TCWarning
</span><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier hs-var hs-var hs-var">crWarnings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="crMode"><span class="annot"><span class="annottext">CheckResult -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#crMode"><span class="hs-identifier hs-var hs-var hs-var">crMode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="crSource"><span class="annot"><span class="annottext">CheckResult -&gt; Source
</span><a href="Agda.Interaction.Imports.html#crSource"><span class="hs-identifier hs-var hs-var hs-var">crSource</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult%27"><span class="hs-identifier hs-type">CheckResult'</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crModuleInfo"><span class="hs-identifier hs-var">crModuleInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-480"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682240454"><span class="annot"><a href="#local-6989586621682240454"><span class="hs-identifier hs-var">crInterface</span></a></span></span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682240455"><span class="annot"><a href="#local-6989586621682240455"><span class="hs-identifier hs-var">crWarnings</span></a></span></span><span>
</span><span id="line-482"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682240456"><span class="annot"><a href="#local-6989586621682240456"><span class="hs-identifier hs-var">crMode</span></a></span></span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#crSource%27"><span class="hs-identifier hs-var">crSource'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682240457"><span class="annot"><a href="#local-6989586621682240457"><span class="hs-identifier hs-var">crSource</span></a></span></span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="annot"><span class="hs-comment">-- | Structure necessary for synchronising parallel type-checking workers.</span></span><span>
</span><span id="line-488"></span><span class="hs-keyword">data</span><span> </span><span id="TCWorkers"><span class="annot"><a href="Agda.Interaction.Imports.html#TCWorkers"><span class="hs-identifier hs-var">TCWorkers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Workers"><span class="annot"><a href="Agda.Interaction.Imports.html#Workers"><span class="hs-identifier hs-var">Workers</span></a></span></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="workerThreads"><span class="annot"><span class="annottext">TCWorkers -&gt; MVar (HashMap TopLevelModuleName (MVar (Maybe TCErr)))
</span><a href="Agda.Interaction.Imports.html#workerThreads"><span class="hs-identifier hs-var hs-var">workerThreads</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HMap.HashMap</span></span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-comment">-- ^ Synchronized map containing synchronisation points for each</span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-comment">-- worker to signal completion (or failure).</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerModules"><span class="annot"><span class="annottext">TCWorkers -&gt; IORef DecodedModules
</span><a href="Agda.Interaction.Imports.html#workerModules"><span class="hs-identifier hs-var hs-var">workerModules</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.IORef.Strict.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DecodedModules"><span class="hs-identifier hs-type">DecodedModules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The shared 'DecodedModules' where workers can put their results.</span></span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">-- | If the user has asked for it, prepare the type checker for loading</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- in parallel, and return a 'TCWorkers' instance that can be used to</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- coordinate a number of type-checking tasks.</span><span>
</span><span id="line-499"></span><span class="hs-comment">--</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- The given module name, when encountered, will be treated as the</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- 'MainInterface'.</span><span>
</span><span id="line-502"></span><span class="annot"><a href="Agda.Interaction.Imports.html#wantsParallelChecking"><span class="hs-identifier hs-type">wantsParallelChecking</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TCWorkers"><span class="hs-identifier hs-type">TCWorkers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span id="wantsParallelChecking"><span class="annot"><span class="annottext">wantsParallelChecking :: TCM (Maybe TCWorkers)
</span><a href="Agda.Interaction.Imports.html#wantsParallelChecking"><span class="hs-identifier hs-var hs-var">wantsParallelChecking</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; Parallelism)
-&gt; TCMT IO CommandLineOptions -&gt; TCMT IO Parallelism
forall a b. (a -&gt; b) -&gt; TCMT IO a -&gt; TCMT IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; Parallelism
</span><a href="Agda.Interaction.Options.Types.html#optParallelChecking"><span class="hs-identifier hs-var">optParallelChecking</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO CommandLineOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m CommandLineOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Parallelism
-&gt; (Parallelism -&gt; TCM (Maybe TCWorkers)) -&gt; TCM (Maybe TCWorkers)
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-504"></span><span>  </span><span class="annot"><span class="annottext">Parallelism
</span><a href="Agda.Interaction.Options.Types.html#Sequential"><span class="hs-identifier hs-var">Sequential</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TCWorkers -&gt; TCM (Maybe TCWorkers)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe TCWorkers
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#Parallel"><span class="hs-identifier hs-type">Parallel</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCWorkers -&gt; Maybe TCWorkers
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TCWorkers -&gt; Maybe TCWorkers)
-&gt; TCMT IO TCWorkers -&gt; TCM (Maybe TCWorkers)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-comment">-- If we're doing parallel type-checking, we have to synchronise the</span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-comment">-- interaction callback to make sure we don't end up with mangled logs</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-comment">-- (or, worse, mangled Lisp!).</span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621682240467"><span class="annot"><a href="#local-6989586621682240467"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ()) -&gt; TCMT IO (MVar ())
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (MVar ()) -&gt; TCMT IO (MVar ()))
-&gt; IO (MVar ()) -&gt; TCMT IO (MVar ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621682240470"><span class="annot"><a href="#local-6989586621682240470"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getInteractionOutputCallback"><span class="hs-identifier hs-type">getInteractionOutputCallback</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setInteractionOutputCallback"><span class="hs-identifier hs-type">setInteractionOutputCallback</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682240473"><span class="annot"><span class="annottext">Response_boot TCErr TCWarning WarningsAndNonFatalErrors
</span><a href="#local-6989586621682240473"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; (() -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar () -&gt; IO ()
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621682240467"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TCM ()) -&gt; (() -&gt; IO ()) -&gt; () -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621682240467"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-512"></span><span>      </span><span class="annot"><span class="annottext">InteractionOutputCallback
</span><a href="#local-6989586621682240470"><span class="hs-identifier hs-var">cb</span></a></span><span> </span><span class="annot"><span class="annottext">Response_boot TCErr TCWarning WarningsAndNonFatalErrors
</span><a href="#local-6989586621682240473"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621682240477"><span class="annot"><a href="#local-6989586621682240477"><span class="hs-identifier hs-var">threads</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">newMVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-515"></span><span>    </span><span id="local-6989586621682240478"><span class="annot"><a href="#local-6989586621682240478"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.IORef.Strict.html#newIORef"><span class="hs-identifier hs-type">newIORef</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModules"><span class="hs-identifier hs-type">getDecodedModules</span></a></span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Workers"><span class="hs-identifier hs-type">Workers</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#workerThreads"><span class="hs-identifier hs-var">workerThreads</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240477"><span class="hs-identifier hs-type">threads</span></a></span><span>
</span><span id="line-518"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#workerModules"><span class="hs-identifier hs-var">workerModules</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240478"><span class="hs-identifier hs-type">results</span></a></span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- | Type-check the given module, using a 'TCWorkers' instance to check</span><span>
</span><span id="line-522"></span><span class="hs-comment">-- its imports in parallel.</span><span>
</span><span id="line-523"></span><span class="hs-comment">--</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- Returns an action which *waits* for completion of type-checking of</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- the given module. Note that the given action updates the</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- 'DecodedModules' in the TC state where it is called to the current</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- results of parallel type-checking. The state after running this</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- action is guaranteed to contain a 'DecodedModule' for the given</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- 'TopLevelModuleName'.</span><span>
</span><span id="line-530"></span><span class="hs-comment">--</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- If the given 'MainInterface' indicates that we are checking the main</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- module, its checking will happen in the calling thread, and in the</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- calling TC state. Otherwise, a thread (with isolated TC state) is</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- created to check it.</span><span>
</span><span id="line-535"></span><span class="hs-comment">--</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- Regardless of whether we spawned a new thread or not, checking of the</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- given module will block until all of its imports have been checked.</span><span>
</span><span id="line-538"></span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseModule"><span class="hs-identifier hs-type">chaseModule</span></a></span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#TCWorkers"><span class="hs-identifier hs-type">TCWorkers</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ For synchronization</span></span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The name of the module to check</span></span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Are we checking the main module?</span></span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Pre-parsed source</span></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span id="chaseModule"><span class="annot"><span class="annottext">chaseModule :: TCWorkers
-&gt; TopLevelModuleName
-&gt; MainInterface
-&gt; Maybe Source
-&gt; TCM (TCM ModuleInfo)
</span><a href="Agda.Interaction.Imports.html#chaseModule"><span class="hs-identifier hs-var hs-var">chaseModule</span></a></span></span><span> </span><span id="local-6989586621682240482"><span class="annot"><span class="annottext">TCWorkers
</span><a href="#local-6989586621682240482"><span class="hs-identifier hs-var">workers</span></a></span></span><span> </span><span id="local-6989586621682240483"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682240484"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240484"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span id="local-6989586621682240485"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240485"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-comment">-- This is the generic action for waiting on the result of checking</span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-comment">-- a module. The MVar is used just for signaling.</span><span>
</span><span id="line-548"></span><span>    </span><span id="local-6989586621682240486"><span class="annot"><span class="annottext">use :: MVar (Maybe TCErr) -&gt; TCM ModuleInfo
</span><a href="#local-6989586621682240486"><span class="hs-identifier hs-var hs-var">use</span></a></span></span><span> </span><span id="local-6989586621682240487"><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240487"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe TCErr) -&gt; TCMT IO (Maybe TCErr)
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar (Maybe TCErr) -&gt; IO (Maybe TCErr)
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240487"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe TCErr)
-&gt; (Maybe TCErr -&gt; TCM ModuleInfo) -&gt; TCM ModuleInfo
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-549"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240489"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682240489"><span class="hs-identifier hs-var">exc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCM ModuleInfo
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682240489"><span class="hs-identifier hs-var">exc</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="annot"><span class="annottext">Maybe TCErr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><span class="annottext">DecodedModules -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Imports.html#setDecodedModules"><span class="hs-identifier hs-var">setDecodedModules</span></a></span><span> </span><span class="annot"><span class="annottext">(DecodedModules -&gt; TCM ()) -&gt; TCMT IO DecodedModules -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO DecodedModules -&gt; TCMT IO DecodedModules
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef DecodedModules -&gt; IO DecodedModules
forall a. IORef a -&gt; IO a
</span><a href="Agda.Utils.IORef.Strict.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCWorkers -&gt; IORef DecodedModules
</span><a href="Agda.Interaction.Imports.html#workerModules"><span class="hs-identifier hs-var">workerModules</span></a></span><span> </span><span class="annot"><span class="annottext">TCWorkers
</span><a href="#local-6989586621682240482"><span class="hs-identifier hs-var">workers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>        </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM (Maybe ModuleInfo)
</span><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModule"><span class="hs-identifier hs-var">getDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Maybe ModuleInfo)
-&gt; (Maybe ModuleInfo -&gt; TCM ModuleInfo) -&gt; TCM ModuleInfo
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-553"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240494"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240494"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TCM ModuleInfo
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240494"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-554"></span><span>          </span><span class="annot"><span class="annottext">Maybe ModuleInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a.
(HasCallStack, MonadDebug m) =&gt;
[Char] -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#__IMPOSSIBLE_VERBOSE__"><span class="hs-identifier hs-var">__IMPOSSIBLE_VERBOSE__</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ModuleInfo) -&gt; [Char] -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-555"></span><span>            </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;internal error: parallel loading had thread responsible for &quot;</span></span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">Agda.Syntax.Common.Pretty.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; marked as ready, but it has not been decoded&quot;</span></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621682240497"><span class="annot"><span class="annottext">has :: IO (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
</span><a href="#local-6989586621682240497"><span class="hs-identifier hs-var hs-var">has</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar (HashMap TopLevelModuleName (MVar (Maybe TCErr)))
-&gt; (HashMap TopLevelModuleName (MVar (Maybe TCErr))
    -&gt; IO
         (HashMap TopLevelModuleName (MVar (Maybe TCErr)),
          Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr))))
-&gt; IO (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">modifyMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCWorkers -&gt; MVar (HashMap TopLevelModuleName (MVar (Maybe TCErr)))
</span><a href="Agda.Interaction.Imports.html#workerThreads"><span class="hs-identifier hs-var">workerThreads</span></a></span><span> </span><span class="annot"><span class="annottext">TCWorkers
</span><a href="#local-6989586621682240482"><span class="hs-identifier hs-var">workers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682240499"><span class="annot"><span class="annottext">HashMap TopLevelModuleName (MVar (Maybe TCErr))
</span><a href="#local-6989586621682240499"><span class="hs-identifier hs-var">wmap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; HashMap TopLevelModuleName (MVar (Maybe TCErr))
-&gt; Maybe (MVar (Maybe TCErr))
forall k v. Hashable k =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TopLevelModuleName (MVar (Maybe TCErr))
</span><a href="#local-6989586621682240499"><span class="hs-identifier hs-var">wmap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240501"><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240501"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HashMap TopLevelModuleName (MVar (Maybe TCErr)),
 Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
-&gt; IO
     (HashMap TopLevelModuleName (MVar (Maybe TCErr)),
      Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap TopLevelModuleName (MVar (Maybe TCErr))
</span><a href="#local-6989586621682240499"><span class="hs-identifier hs-var">wmap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
-&gt; Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240501"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><span class="annottext">Maybe (MVar (Maybe TCErr))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>        </span><span id="local-6989586621682240502"><span class="annot"><a href="#local-6989586621682240502"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (Maybe TCErr))
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240504"><span class="annot"><a href="#local-6989586621682240504"><span class="hs-identifier hs-var hs-var">nmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; MVar (Maybe TCErr)
-&gt; HashMap TopLevelModuleName (MVar (Maybe TCErr))
-&gt; HashMap TopLevelModuleName (MVar (Maybe TCErr))
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.insert</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240502"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TopLevelModuleName (MVar (Maybe TCErr))
</span><a href="#local-6989586621682240499"><span class="hs-identifier hs-var">wmap</span></a></span><span>
</span><span id="line-564"></span><span>        </span><span class="annot"><a href="#local-6989586621682240504"><span class="hs-identifier hs-type">nmap</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240504"><span class="hs-identifier hs-type">nmap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621682240502"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-comment">-- In the critical section that holds workerThreads, we just decide</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-comment">-- whether to spawn a new thread or not.</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-comment">-- If the module already had an entry (Left), we can immediately</span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-comment">-- return the waiting thunk.</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">IO (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
-&gt; TCMT IO (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
</span><a href="#local-6989586621682240497"><span class="hs-identifier hs-var">has</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr)))
-&gt; (Either (MVar (Maybe TCErr)) (MVar (Maybe TCErr))
    -&gt; TCM (TCM ModuleInfo))
-&gt; TCM (TCM ModuleInfo)
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682240506"><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240506"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr) -&gt; TCM ModuleInfo
</span><a href="#local-6989586621682240486"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240506"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ModuleInfo -&gt; TCM () -&gt; TCM (TCM ModuleInfo)
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.parallel&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;reusing &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-comment">-- Otherwise, we have to handle spawning the new thread to do</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-comment">-- type-checking.</span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682240509"><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240509"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr) -&gt; TCM ModuleInfo
</span><a href="#local-6989586621682240486"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240509"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ModuleInfo -&gt; TCM () -&gt; TCM (TCM ModuleInfo)
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-576"></span><span>      </span><span id="local-6989586621682240510"><span class="annot"><a href="#local-6989586621682240510"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv [TopLevelModuleName] -&gt; TCMT IO [TopLevelModuleName]
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; f [TopLevelModuleName])
-&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#eImportStack"><span class="hs-identifier hs-var">eImportStack</span></a></span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-comment">-- If this is the call corresponding to checking the main</span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-comment">-- module, we don't start a new thread.</span><span>
</span><span id="line-581"></span><span>        </span><span class="hs-comment">-- This is because we want to be in the state from checking the</span><span>
</span><span id="line-582"></span><span>        </span><span class="hs-comment">-- main module, e.g. for interactive checking.</span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-584"></span><span>        </span><span class="hs-comment">-- If we *are* starting a new thread, we must install an</span><span>
</span><span id="line-585"></span><span>        </span><span class="hs-comment">-- exception handler to catch any TCErrs that make it to the top</span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-comment">-- level, so that they can propagate back to the main thread</span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-comment">-- eventually.</span><span>
</span><span id="line-588"></span><span>        </span><span id="local-6989586621682240515"><span class="annot"><a href="#local-6989586621682240515"><span class="hs-identifier hs-var hs-var">detach</span></a></span></span><span> </span><span id="local-6989586621682240516"><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682240516"><span class="hs-identifier hs-var">cont</span></a></span></span><span>
</span><span id="line-589"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240484"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682240516"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>            </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Base.html#forkTCM"><span class="hs-identifier hs-var">forkTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; (TCErr -&gt; TCM ()) -&gt; TCM ())
-&gt; (TCErr -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; (TCErr -&gt; TCM ()) -&gt; TCM ()
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">catchError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TCM ()) -&gt; (TCErr -&gt; IO ()) -&gt; TCErr -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr) -&gt; Maybe TCErr -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe TCErr)
</span><a href="#local-6989586621682240509"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe TCErr -&gt; IO ()) -&gt; (TCErr -&gt; Maybe TCErr) -&gt; TCErr -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; Maybe TCErr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-592"></span><span>            </span><span class="hs-comment">-- If we're starting a new thread, we also need to parse the source file.</span><span>
</span><span id="line-593"></span><span>            </span><span class="hs-comment">-- For debugging/profiling/etc., label the thread with the</span><span>
</span><span id="line-594"></span><span>            </span><span class="hs-comment">-- name of the module that we're checking.</span><span>
</span><span id="line-595"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-596"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240519"><span class="annot"><span class="annottext">name :: [Char]
</span><a href="#local-6989586621682240519"><span class="hs-identifier hs-var hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">Agda.Syntax.Common.Pretty.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>              </span><span id="local-6989586621682240520"><span class="annot"><a href="#local-6989586621682240520"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><span class="hs-identifier hs-var">myThreadId</span></span><span>
</span><span id="line-598"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">labelThread</span></span><span> </span><span class="annot"><a href="#local-6989586621682240520"><span class="hs-identifier hs-type">me</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;TC &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682240519"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>            </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682240516"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><a href="#local-6989586621682240515"><span class="hs-identifier hs-type">detach</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-602"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.parallel&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;checking &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">P.pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240483"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span id="local-6989586621682240523"><span class="annot"><a href="#local-6989586621682240523"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">parseSource</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#findFile"><span class="hs-identifier hs-type">findFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240483"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682240485"><span class="hs-identifier hs-type">msrc</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-comment">-- Now we traverse through all the imports and collect the</span><span>
</span><span id="line-606"></span><span>        </span><span class="hs-comment">-- &quot;promises&quot; for waiting on them. This will spawn the threads</span><span>
</span><span id="line-607"></span><span>        </span><span class="hs-comment">-- to check them.</span><span>
</span><span id="line-608"></span><span>        </span><span id="local-6989586621682240526"><span class="annot"><a href="#local-6989586621682240526"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Generic.html#foldDecl"><span class="hs-identifier hs-type">foldDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240523"><span class="hs-identifier hs-type">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-609"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Import"><span class="hs-identifier hs-type">C.Import</span></a></span><span> </span><span id="local-6989586621682240529"><span class="annot"><span class="annottext">OpenShortHand
</span><a href="#local-6989586621682240529"><span class="hs-identifier hs-var">opn</span></a></span></span><span> </span><span id="local-6989586621682240530"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682240530"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682240531"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240531"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240532"><span class="annot"><span class="annottext">Either AsName RawOpenArgs
</span><a href="#local-6989586621682240532"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621682240533"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621682240533"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240534"><span class="annot"><span class="annottext">dec :: NiceDeclaration
</span><a href="#local-6989586621682240534"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenShortHand
-&gt; KwRange
-&gt; QName
-&gt; Either AsName RawOpenArgs
-&gt; ImportDirective
-&gt; NiceDeclaration
</span><a href="Agda.Syntax.Concrete.Definitions.Types.html#NiceImport"><span class="hs-identifier hs-var">C.NiceImport</span></a></span><span> </span><span class="annot"><span class="annottext">OpenShortHand
</span><a href="#local-6989586621682240529"><span class="hs-identifier hs-var">opn</span></a></span><span> </span><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682240530"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240531"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Either AsName RawOpenArgs
</span><a href="#local-6989586621682240532"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621682240533"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-611"></span><span>            </span><span class="annot"><span class="annottext">Call
-&gt; TCMT IO (Endo [TCM ModuleInfo])
-&gt; TCMT IO (Endo [TCM ModuleInfo])
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NiceDeclaration -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#ScopeCheckDeclaration"><span class="hs-identifier hs-var">ScopeCheckDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">NiceDeclaration
</span><a href="#local-6989586621682240534"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>            </span><span id="local-6989586621682240538"><span class="annot"><a href="#local-6989586621682240538"><span class="hs-identifier hs-var">tl</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RawTopLevelModuleName -&gt; TCM TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.State.html#topLevelModuleName"><span class="hs-identifier hs-var">S.topLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; RawTopLevelModuleName
</span><a href="Agda.Syntax.TopLevelModuleName.html#rawTopLevelModuleNameForQName"><span class="hs-identifier hs-var">rawTopLevelModuleNameForQName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682240531"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span>            </span><span class="hs-comment">-- This is a bit fiddly. 'getInterface' below will push mod</span><span>
</span><span id="line-616"></span><span>            </span><span class="hs-comment">-- onto the import stack, so if we push it around the entire</span><span>
</span><span id="line-617"></span><span>            </span><span class="hs-comment">-- thread, we get a spurious cyclic import error.</span><span>
</span><span id="line-618"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-619"></span><span>            </span><span class="hs-comment">-- However, we can't also push tl, because *its* worker</span><span>
</span><span id="line-620"></span><span>            </span><span class="hs-comment">-- thread would end up pushing it, so *it* would be on the</span><span>
</span><span id="line-621"></span><span>            </span><span class="hs-comment">-- stack twice, too!</span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-comment">-- We have to check for import cycles here because GHC does</span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-comment">-- not seem to always generate the proper &quot;thread blocked</span><span>
</span><span id="line-625"></span><span>            </span><span class="hs-comment">-- indefinitely on MVar operation&quot;.</span><span>
</span><span id="line-626"></span><span>            </span><span id="local-6989586621682240540"><span class="annot"><a href="#local-6989586621682240540"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-type">locallyTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eImportStack"><span class="hs-identifier hs-type">eImportStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mod</span></span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-627"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-type">locallyTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eImportStack"><span class="hs-identifier hs-type">eImportStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tl</span></span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#checkForImportCycle"><span class="hs-identifier hs-type">checkForImportCycle</span></a></span><span>
</span><span id="line-628"></span><span>              </span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseModule"><span class="hs-identifier hs-type">chaseModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240482"><span class="hs-identifier hs-type">workers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240538"><span class="hs-identifier hs-type">tl</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-type">NotMainInterface</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Endo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">act</span></span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>          </span><span class="annot"><span class="annottext">Declaration
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Endo [TCM ModuleInfo] -&gt; TCMT IO (Endo [TCM ModuleInfo])
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Endo [TCM ModuleInfo]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-comment">-- Now we wait for all the dependencies and, when that's done,</span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-comment">-- we can just type-check the module as usual.</span><span>
</span><span id="line-636"></span><span>        </span><span class="hs-comment">-- Waiting for the dependencies will have moved us to a TC state</span><span>
</span><span id="line-637"></span><span>        </span><span class="hs-comment">-- where they have been placed in the DecodedModules map, so the</span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-comment">-- normal type-checking code will just reuse them when we get</span><span>
</span><span id="line-639"></span><span>        </span><span class="hs-comment">-- around to actually scope checking the import.</span><span>
</span><span id="line-640"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">sequence_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-var">appEndo</span></span><span> </span><span class="annot"><a href="#local-6989586621682240526"><span class="hs-identifier hs-type">imports</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>        </span><span id="local-6989586621682240549"><span class="annot"><a href="#local-6989586621682240549"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-type">getInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240483"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240484"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682240523"><span class="hs-identifier hs-type">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-comment">-- After we're done, update the shared DecodedModules map and</span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-comment">-- signal our completion.</span><span>
</span><span id="line-646"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-647"></span><span>          </span><span class="annot"><a href="Agda.Utils.IORef.Strict.html#atomicModifyIORef"><span class="hs-identifier hs-type">atomicModifyIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#workerModules"><span class="hs-identifier hs-var">workerModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240482"><span class="hs-identifier hs-type">workers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682240551"><span class="annot"><span class="annottext">DecodedModules
</span><a href="#local-6989586621682240551"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; ModuleInfo -&gt; DecodedModules -&gt; DecodedModules
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240483"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240549"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">DecodedModules
</span><a href="#local-6989586621682240551"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">putMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621682240509"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-comment">-- | Type checks the main file of the interaction.</span><span>
</span><span id="line-651"></span><span class="hs-comment">--   This could be the file loaded in the interacting editor (emacs),</span><span>
</span><span id="line-652"></span><span class="hs-comment">--   or the file passed on the command line.</span><span>
</span><span id="line-653"></span><span class="hs-comment">--</span><span>
</span><span id="line-654"></span><span class="hs-comment">--   First, the primitive modules are imported.</span><span>
</span><span id="line-655"></span><span class="hs-comment">--   Then, @getInterface@ is called to do the main work.</span><span>
</span><span id="line-656"></span><span class="hs-comment">--</span><span>
</span><span id="line-657"></span><span class="hs-comment">--   If the 'Mode' is 'ScopeCheck', then type-checking is not</span><span>
</span><span id="line-658"></span><span class="hs-comment">--   performed, only scope-checking. (This may include type-checking</span><span>
</span><span id="line-659"></span><span class="hs-comment">--   of imported modules.) In this case the generated, partial</span><span>
</span><span id="line-660"></span><span class="hs-comment">--   interface is not stored in the state ('stDecodedModules'). Note,</span><span>
</span><span id="line-661"></span><span class="hs-comment">--   however, that if the file has already been type-checked, then a</span><span>
</span><span id="line-662"></span><span class="hs-comment">--   complete interface is returned.</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="annot"><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier hs-type">typeCheckMain</span></a></span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span>
</span><span id="line-666"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Should the file be type-checked, or only scope-checked?</span></span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-668"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The decorated source code.</span></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span>
</span><span id="line-670"></span><span id="typeCheckMain"><span class="annot"><span class="annottext">typeCheckMain :: Mode -&gt; Source -&gt; TCM CheckResult
</span><a href="Agda.Interaction.Imports.html#typeCheckMain"><span class="hs-identifier hs-var hs-var">typeCheckMain</span></a></span></span><span> </span><span id="local-6989586621682240553"><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621682240553"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621682240554"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-comment">-- liftIO $ putStrLn $ &quot;This is typeCheckMain &quot; ++ prettyShow f</span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-comment">-- liftIO . putStrLn . show =&lt;&lt; getVerbosity</span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-comment">-- For the main interface, we also remember the pragmas from the file</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Source -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-var">setOptionsFromSourcePragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-comment">-- Import the Agda.Primitive modules</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="annottext">TCM ()
</span><a href="Agda.Interaction.Imports.html#importPrimitiveModules"><span class="hs-identifier hs-var">importPrimitiveModules</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-comment">-- Now do the type checking via getInterface.</span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#checkModuleName%27"><span class="hs-identifier hs-var">checkModuleName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span>  </span><span id="local-6989586621682240556"><span class="annot"><a href="#local-6989586621682240556"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe TCWorkers)
</span><a href="Agda.Interaction.Imports.html#wantsParallelChecking"><span class="hs-identifier hs-var">wantsParallelChecking</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Maybe TCWorkers)
-&gt; (Maybe TCWorkers -&gt; TCM ModuleInfo) -&gt; TCM ModuleInfo
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240557"><span class="annot"><span class="annottext">TCWorkers
</span><a href="#local-6989586621682240557"><span class="hs-identifier hs-var">workers</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (TCM ModuleInfo) -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(TCM (TCM ModuleInfo) -&gt; TCM ModuleInfo)
-&gt; TCM (TCM ModuleInfo) -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCWorkers
-&gt; TopLevelModuleName
-&gt; MainInterface
-&gt; Maybe Source
-&gt; TCM (TCM ModuleInfo)
</span><a href="Agda.Interaction.Imports.html#chaseModule"><span class="hs-identifier hs-var">chaseModule</span></a></span><span> </span><span class="annot"><span class="annottext">TCWorkers
</span><a href="#local-6989586621682240557"><span class="hs-identifier hs-var">workers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode -&gt; MainInterface
</span><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621682240553"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Maybe Source
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>    </span><span class="annot"><span class="annottext">Maybe TCWorkers
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-var">getInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode -&gt; MainInterface
</span><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-var">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621682240553"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Maybe Source
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240554"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stCurrentModule"><span class="hs-identifier hs-type">stCurrentModule</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens%27"><span class="hs-operator hs-type">`setTCLens'`</span></a></span><span>
</span><span id="line-688"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iModuleName"><span class="hs-identifier hs-var">iModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240556"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240556"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult%27"><span class="hs-identifier hs-type">CheckResult'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240556"><span class="hs-identifier hs-type">mi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240554"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="hs-comment">-- Andreas, 2016-07-11, issue 2092</span><span>
</span><span id="line-695"></span><span class="hs-comment">-- The error range should be set to the file with the wrong module name</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- not the importing one (which would be the default).</span><span>
</span><span id="line-697"></span><span class="annot"><a href="Agda.Interaction.Imports.html#checkModuleName%27"><span class="hs-identifier hs-type">checkModuleName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.Boot.html#TopLevelModuleName%27"><span class="hs-identifier hs-type">TopLevelModuleName'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span id="checkModuleName%27"><span class="annot"><span class="annottext">checkModuleName' :: TopLevelModuleName -&gt; SourceFile -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#checkModuleName%27"><span class="hs-identifier hs-var hs-var">checkModuleName'</span></a></span></span><span> </span><span id="local-6989586621682240562"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240562"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682240563"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240563"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-699"></span><span>  </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240562"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; Maybe TopLevelModuleName -&gt; TCM ()
</span><a href="Agda.Interaction.FindFile.html#checkModuleName"><span class="hs-identifier hs-var">checkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240562"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240563"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TopLevelModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="annot"><span class="hs-comment">-- | Import the primitive modules (unless --no-load-primitives).</span></span><span>
</span><span id="line-702"></span><span class="annot"><a href="Agda.Interaction.Imports.html#importPrimitiveModules"><span class="hs-identifier hs-type">importPrimitiveModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span id="importPrimitiveModules"><span class="annot"><span class="annottext">importPrimitiveModules :: TCM ()
</span><a href="Agda.Interaction.Imports.html#importPrimitiveModules"><span class="hs-identifier hs-var hs-var">importPrimitiveModules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#optLoadPrimitives"><span class="hs-identifier hs-var">optLoadPrimitives</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; Bool) -&gt; TCMT IO PragmaOptions -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-704"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.main&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Importing the primitive modules.&quot;</span></span><span>
</span><span id="line-705"></span><span>  </span><span id="local-6989586621682240567"><span class="annot"><a href="#local-6989586621682240567"><span class="hs-identifier hs-var">libdirPrim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' SessionState AbsolutePath -&gt; TCMT IO AbsolutePath
forall (m :: * -&gt; *) a.
ReadTCState m =&gt;
Lens' SessionState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useSession"><span class="hs-identifier hs-var">useSession</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; f AbsolutePath) -&gt; SessionState -&gt; f SessionState
Lens' SessionState AbsolutePath
</span><a href="Agda.TypeChecking.Monad.Base.html#lensPrimitiveLibDir"><span class="hs-identifier hs-var">lensPrimitiveLibDir</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.main&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Library primitive dir = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240567"><span class="hs-identifier hs-type">libdirPrim</span></a></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-comment">-- Turn off import-chasing messages.</span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-comment">-- We have to modify the persistent verbosity setting, since</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-comment">-- getInterface resets the current verbosity settings to the persistent ones.</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-type">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-type">getsTC</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html#getPersistentVerbosity"><span class="hs-identifier hs-type">Lens.getPersistentVerbosity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html#putPersistentVerbosity"><span class="hs-identifier hs-type">Lens.putPersistentVerbosity</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-comment">-- set root verbosity to 0</span><span>
</span><span id="line-713"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Options.Lenses.html#modifyPersistentVerbosity"><span class="hs-identifier hs-type">Lens.modifyPersistentVerbosity</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Strict.Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Utils.Trie.html#insert"><span class="hs-identifier hs-type">Trie.insert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.fromMaybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">Trie.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-comment">-- We don't want to generate highlighting information for Agda.Primitive.</span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#withHighlightingLevel"><span class="hs-identifier hs-type">withHighlightingLevel</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#None"><span class="hs-identifier hs-type">None</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-718"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">filePath</span></span><span> </span><span class="annot"><span class="hs-identifier">libdirPrim</span></span><span> </span><span class="annot"><span class="hs-operator">&lt;/&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Library.html#primitiveModules"><span class="hs-identifier hs-type">primitiveModules</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240583"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240583"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>        </span><span id="local-6989586621682240584"><span class="annot"><a href="#local-6989586621682240584"><span class="hs-identifier hs-var">sf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; TCMT IO SourceFile
forall (m :: * -&gt; *). MonadFileId m =&gt; AbsolutePath -&gt; m SourceFile
</span><a href="Agda.TypeChecking.Monad.Base.html#srcFromPath"><span class="hs-identifier hs-var">srcFromPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; AbsolutePath
</span><a href="Agda.Utils.FileName.html#mkAbsolute"><span class="hs-identifier hs-var">mkAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240583"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>        </span><span id="local-6989586621682240587"><span class="annot"><a href="#local-6989586621682240587"><span class="hs-identifier hs-var">primSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">parseSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240584"><span class="hs-identifier hs-type">sf</span></a></span><span>
</span><span id="line-721"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Imports.html#checkModuleName%27"><span class="hs-identifier hs-type">checkModuleName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240587"><span class="hs-identifier hs-type">primSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240587"><span class="hs-identifier hs-type">primSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-type">getNonMainInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240587"><span class="hs-identifier hs-type">primSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682240587"><span class="hs-identifier hs-type">primSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.main&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Done importing the primitive modules.&quot;</span></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="hs-comment">-- | Tries to return the interface associated to the given (imported) module.</span><span>
</span><span id="line-727"></span><span class="hs-comment">--   The time stamp of the relevant interface file is also returned.</span><span>
</span><span id="line-728"></span><span class="hs-comment">--   Calls itself recursively for the imports of the given module.</span><span>
</span><span id="line-729"></span><span class="hs-comment">--   May type check the module.</span><span>
</span><span id="line-730"></span><span class="hs-comment">--   An error is raised if a warning is encountered.</span><span>
</span><span id="line-731"></span><span class="hs-comment">--</span><span>
</span><span id="line-732"></span><span class="hs-comment">--   Do not use this for the main file, use 'typeCheckMain' instead.</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-type">getNonMainInterface</span></a></span><span>
</span><span id="line-735"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-737"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-739"></span><span id="getNonMainInterface"><span class="annot"><span class="annottext">getNonMainInterface :: TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var hs-var">getNonMainInterface</span></a></span></span><span> </span><span id="local-6989586621682240589"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240589"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240590"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240590"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621682240591"><span class="annot"><a href="#local-6989586621682240591"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getNonMainModuleInfo"><span class="hs-identifier hs-var">getNonMainModuleInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240589"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240590"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-741"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Pretty.Warning.html#tcWarningsToError"><span class="hs-identifier hs-type">tcWarningsToError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#TopLevelModuleNameWithSourceFile"><span class="hs-identifier hs-type">TopLevelModuleNameWithSourceFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240589"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miSourceFile"><span class="hs-identifier hs-var">miSourceFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240591"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toAscList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240591"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240591"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getNonMainModuleInfo"><span class="hs-identifier hs-type">getNonMainModuleInfo</span></a></span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-747"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-749"></span><span id="getNonMainModuleInfo"><span class="annot"><span class="annottext">getNonMainModuleInfo :: TopLevelModuleName -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getNonMainModuleInfo"><span class="hs-identifier hs-var hs-var">getNonMainModuleInfo</span></a></span></span><span> </span><span id="local-6989586621682240596"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240596"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240597"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240597"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-comment">-- Preserve/restore the current pragma options, which will be mutated when loading</span><span>
</span><span id="line-751"></span><span>  </span><span class="hs-comment">-- and checking the interface.</span><span>
</span><span id="line-752"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
-&gt; (PragmaOptions -&gt; TCM ()) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; PragmaOptions -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; a -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-var">`setTCLens`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-753"></span><span>           </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-var">getInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240596"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240597"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="hs-comment">-- | If the module has already been visited (without warnings), then</span><span>
</span><span id="line-756"></span><span class="hs-comment">-- its interface is returned directly.</span><span>
</span><span id="line-757"></span><span class="hs-comment">--</span><span>
</span><span id="line-758"></span><span class="hs-comment">-- Otherwise the interface is loaded via 'getStoredInterface'.</span><span>
</span><span id="line-759"></span><span class="hs-comment">--</span><span>
</span><span id="line-760"></span><span class="hs-comment">-- If that fails it is created via 'createInterface' or, for non-main modules,</span><span>
</span><span id="line-761"></span><span class="hs-comment">-- 'createInterfaceIsolated'.</span><span>
</span><span id="line-762"></span><span class="hs-comment">-- A such created interface is stored for potential later use.</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-type">getInterface</span></a></span><span>
</span><span id="line-765"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-768"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-770"></span><span id="getInterface"><span class="annot"><span class="annottext">getInterface :: TopLevelModuleName
-&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getInterface"><span class="hs-identifier hs-var hs-var">getInterface</span></a></span></span><span> </span><span id="local-6989586621682240606"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240607"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240607"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621682240608"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240608"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv [TopLevelModuleName]
-&gt; ([TopLevelModuleName] -&gt; [TopLevelModuleName])
-&gt; TCM ModuleInfo
-&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a b.
MonadTCEnv m =&gt;
Lens' TCEnv a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-var">locallyTC</span></a></span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; f [TopLevelModuleName])
-&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#eImportStack"><span class="hs-identifier hs-var">eImportStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [TopLevelModuleName] -&gt; [TopLevelModuleName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-comment">-- We remember but reset the pragma options locally.</span><span>
</span><span id="line-773"></span><span>  </span><span id="local-6989586621682240611"><span class="annot"><a href="#local-6989586621682240611"><span class="hs-identifier hs-var">currentOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState PragmaOptions -&gt; TCMT IO PragmaOptions
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(PragmaOptions -&gt; f PragmaOptions) -&gt; TCState -&gt; f TCState
Lens' TCState PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-var">stPragmaOptions</span></a></span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-comment">-- Issue #3644 (Abel 2020-05-08): Set approximate range for errors in options.</span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-type">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.html#modPragmas"><span class="hs-identifier hs-var">C.modPragmas</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682240608"><span class="hs-identifier hs-type">msrc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>    </span><span class="hs-comment">-- Now reset the options</span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-type">setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getsTC"><span class="hs-identifier hs-type">getsTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentOptions"><span class="hs-identifier hs-var">stPersistentOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-comment">-- Lookup x in the collection of visited modules.</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModule"><span class="hs-identifier hs-type">getVisitedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-comment">-- Case: already visited and usable.</span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240618"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240618"><span class="hs-identifier hs-var">mi</span></a></span></span><span>
</span><span id="line-784"></span><span>        </span><span class="hs-comment">-- We can only reuse a sufficiently checked module,</span><span>
</span><span id="line-785"></span><span>        </span><span class="hs-comment">-- e.g. we cannot import a just scope-checked module when type-checking a module.</span><span>
</span><span id="line-786"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240618"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; ModuleCheckMode -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-var">moduleCheckMode</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240607"><span class="hs-identifier hs-var">isMain</span></a></span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-comment">-- A module with warnings should never be allowed to be imported from another module.</span><span>
</span><span id="line-788"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TCWarning -&gt; Bool) -&gt; Set TCWarning -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Set TCWarning
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240618"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-789"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.visit&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Already visited &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-790"></span><span>          </span><span class="annot"><span class="annottext">PragmaOptions -&gt; ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621682240619"><span class="hs-identifier hs-var">addOptionsCompatibilityWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240611"><span class="hs-identifier hs-var">currentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240618"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>    </span><span class="hs-comment">-- Case: not already visited or unusable.</span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><span class="annottext">Maybe ModuleInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-comment">-- Load the module.</span><span>
</span><span id="line-796"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.visit&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  Getting interface for &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>      </span><span id="local-6989586621682240620"><span class="annot"><a href="#local-6989586621682240620"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240608"><span class="hs-identifier hs-var">msrc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-799"></span><span>        </span><span class="annot"><span class="annottext">Maybe Source
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO SourceFile
</span><a href="Agda.Interaction.FindFile.html#findFile"><span class="hs-identifier hs-var">findFile</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-800"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240621"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240621"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-801"></span><span>          </span><span class="hs-comment">-- Andreas, 2021-08-17, issue #5508.</span><span>
</span><span id="line-802"></span><span>          </span><span class="hs-comment">-- So it happened with @msrc == Just{}@ that the file was not added to @ModuleToSource@,</span><span>
</span><span id="line-803"></span><span>          </span><span class="hs-comment">-- only with @msrc == Nothing@ (then @findFile@ does it).</span><span>
</span><span id="line-804"></span><span>          </span><span class="hs-comment">-- As a consequence, the file was added later, but with a file name constructed</span><span>
</span><span id="line-805"></span><span>          </span><span class="hs-comment">-- from a module name.  As #5508 shows, this can be fatal in case-insensitive file systems.</span><span>
</span><span id="line-806"></span><span>          </span><span class="hs-comment">-- The file name (with case variant) then no longer maps to the module name.</span><span>
</span><span id="line-807"></span><span>          </span><span class="hs-comment">-- To prevent this, we register the connection in @ModuleToSource@ here,</span><span>
</span><span id="line-808"></span><span>          </span><span class="hs-comment">-- where we have the correct spelling of the file name.</span><span>
</span><span id="line-809"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240622"><span class="annot"><span class="annottext">file :: SourceFile
</span><a href="#local-6989586621682240622"><span class="hs-identifier hs-var hs-var hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; SourceFile
</span><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240621"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-810"></span><span>          </span><span class="annot"><span class="annottext">Lens' SessionState (Map TopLevelModuleName SourceFile)
-&gt; (Map TopLevelModuleName SourceFile
    -&gt; Map TopLevelModuleName SourceFile)
-&gt; TCM ()
forall (m :: * -&gt; *) a.
ModifySession m =&gt;
Lens' SessionState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TopLevelModuleName SourceFile
 -&gt; f (Map TopLevelModuleName SourceFile))
-&gt; SessionState -&gt; f SessionState
Lens' SessionState (Map TopLevelModuleName SourceFile)
</span><a href="Agda.TypeChecking.Monad.Base.html#lensModuleToSourceId"><span class="hs-identifier hs-var">lensModuleToSourceId</span></a></span><span> </span><span class="annot"><span class="annottext">((Map TopLevelModuleName SourceFile
  -&gt; Map TopLevelModuleName SourceFile)
 -&gt; TCM ())
-&gt; (Map TopLevelModuleName SourceFile
    -&gt; Map TopLevelModuleName SourceFile)
-&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile
-&gt; Map TopLevelModuleName SourceFile
-&gt; Map TopLevelModuleName SourceFile
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240622"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-811"></span><span>          </span><span class="annot"><span class="annottext">SourceFile -&gt; TCMT IO SourceFile
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240622"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-814"></span><span>        </span><span id="local-6989586621682240627"><span class="annot"><a href="#local-6989586621682240627"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-type">srcFilePath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240620"><span class="hs-identifier hs-type">file</span></a></span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">P.text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.intercalate</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="hs-operator">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;module: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-817"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;file:   &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240627"><span class="hs-identifier hs-type">path</span></a></span><span>
</span><span id="line-818"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  Check for cycle&quot;</span></span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#checkForImportCycle"><span class="hs-identifier hs-type">checkForImportCycle</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>      </span><span id="local-6989586621682240629"><span class="annot"><a href="#local-6989586621682240629"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Import"><span class="hs-identifier hs-type">Bench.Import</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#getStoredInterface"><span class="hs-identifier hs-type">getStoredInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240620"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240608"><span class="hs-identifier hs-type">msrc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#catchExceptT"><span class="hs-operator hs-type">`catchExceptT`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240632"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240632"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; is not up-to-date because &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240632"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-827"></span><span>            </span><span class="annot"><span class="annottext">CommandLineOptions -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-var">setCommandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOptions -&gt; TCM ())
-&gt; (TCState -&gt; CommandLineOptions) -&gt; TCState -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PersistentTCState -&gt; CommandLineOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentOptions"><span class="hs-identifier hs-var">stPersistentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">(PersistentTCState -&gt; CommandLineOptions)
-&gt; (TCState -&gt; PersistentTCState) -&gt; TCState -&gt; CommandLineOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCState -&gt; PersistentTCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCM ()) -&gt; TCMT IO TCState -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-828"></span><span>            </span><span id="local-6989586621682240634"><span class="annot"><a href="#local-6989586621682240634"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240607"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-829"></span><span>              </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
-&gt; SourceFile -&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-var">createInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240620"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240607"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240608"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-830"></span><span>              </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-var">createInterfaceIsolated</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240606"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240620"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240608"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span>            </span><span class="hs-comment">-- Ensure that the given module name matches the one in the file.</span><span>
</span><span id="line-833"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240635"><span class="annot"><a href="#local-6989586621682240635"><span class="hs-identifier hs-var hs-var">topLevelName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240634"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>            </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240635"><span class="hs-identifier hs-type">topLevelName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-835"></span><span>              </span><span id="local-6989586621682240637"><span class="annot"><a href="#local-6989586621682240637"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-type">srcFilePath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240620"><span class="hs-identifier hs-type">file</span></a></span><span>
</span><span id="line-836"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OverlappingProjects"><span class="hs-identifier hs-type">OverlappingProjects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240637"><span class="hs-identifier hs-type">path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240635"><span class="hs-identifier hs-type">topLevelName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682240634"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span>      </span><span id="local-6989586621682240639"><span class="annot"><a href="#local-6989586621682240639"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682240619"><span class="hs-identifier hs-type">addOptionsCompatibilityWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240611"><span class="hs-identifier hs-type">currentOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240629"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-841"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.visit&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  Now we've looked at &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>      </span><span class="hs-comment">-- Interfaces are not stored if we are only scope-checking, or</span><span>
</span><span id="line-844"></span><span>      </span><span class="hs-comment">-- if any warnings were encountered.</span><span>
</span><span id="line-845"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-type">moduleCheckMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240607"><span class="hs-identifier hs-type">isMain</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-type">ModuleTypeChecked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240639"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-846"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#storeDecodedModule"><span class="hs-identifier hs-type">storeDecodedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240639"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-type">reportS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;warning.import&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span>
</span><span id="line-849"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;module: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameParts"><span class="hs-identifier hs-var">moduleNameParts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240606"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;WarningOnImport: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iImportWarning"><span class="hs-identifier hs-var">iImportWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240639"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>      </span><span class="hs-comment">-- Record the module as visited.</span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#visitModule"><span class="hs-identifier hs-type">visitModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240639"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-855"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682240639"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-857"></span><span>    </span><span class="annot"><a href="#local-6989586621682240619"><span class="hs-identifier hs-type">addOptionsCompatibilityWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-858"></span><span>    </span><span id="local-6989586621682240619"><span class="annot"><span class="annottext">addOptionsCompatibilityWarnings :: PragmaOptions -&gt; ModuleInfo -&gt; TCM ModuleInfo
</span><a href="#local-6989586621682240619"><span class="hs-identifier hs-var hs-var">addOptionsCompatibilityWarnings</span></a></span></span><span> </span><span id="local-6989586621682240645"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240645"><span class="hs-identifier hs-var">currentOptions</span></a></span></span><span> </span><span id="local-6989586621682240646"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240646"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span>      </span><span class="hs-comment">-- Andreas, 2026-02-03, issue #8361, debug printing by @nad.</span><span>
</span><span id="line-861"></span><span>      </span><span class="hs-comment">-- For testing whether 'isBuiltinModule' is thread-safe.</span><span>
</span><span id="line-862"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.builtin&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-863"></span><span>        </span><span id="local-6989586621682240647"><span class="annot"><a href="#local-6989586621682240647"><span class="hs-identifier hs-var">isBuiltin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe IsBuiltinModule -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe IsBuiltinModule -&gt; Bool)
-&gt; TCMT IO (Maybe IsBuiltinModule) -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FileId -&gt; TCMT IO (Maybe IsBuiltinModule)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
FileId -&gt; m (Maybe IsBuiltinModule)
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-var">isBuiltinModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; FileId
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#srcFileId"><span class="hs-identifier hs-var">srcFileId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; SourceFile
</span><a href="Agda.TypeChecking.Monad.Base.html#miSourceFile"><span class="hs-identifier hs-var">miSourceFile</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240646"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-type">P.hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;The module&quot;</span></span><span>
</span><span id="line-865"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240646"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;is&quot;</span></span><span>
</span><span id="line-866"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682240647"><span class="hs-identifier hs-type">isBuiltin</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-string">&quot;primitive.&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-string">&quot;not primitive.&quot;</span></span><span>
</span><span id="line-867"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>      </span><span class="hs-comment">-- Check that imported options are compatible with current ones (issue #2487),</span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-comment">-- but give primitive modules a pass.</span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-comment">-- Compute updated warnings if needed.</span><span>
</span><span id="line-872"></span><span>      </span><span id="local-6989586621682240652"><span class="annot"><a href="#local-6989586621682240652"><span class="hs-identifier hs-var">ws'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; Maybe (Set TCWarning) -&gt; Set TCWarning
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleInfo -&gt; Set TCWarning
</span><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240646"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Set TCWarning) -&gt; Set TCWarning)
-&gt; TCMT IO (Maybe (Set TCWarning)) -&gt; TCMT IO (Set TCWarning)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-873"></span><span>             </span><span class="annot"><span class="annottext">MainInterface
-&gt; PragmaOptions -&gt; ModuleInfo -&gt; TCMT IO (Maybe (Set TCWarning))
</span><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-var">getOptionsCompatibilityWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240607"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240645"><span class="hs-identifier hs-var">currentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240646"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-874"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682240646"><span class="hs-identifier hs-type">mi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240652"><span class="hs-identifier hs-type">ws'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="hs-comment">-- | If checking produced non-benign warnings, error out.</span><span>
</span><span id="line-877"></span><span class="hs-comment">--</span><span>
</span><span id="line-878"></span><span id="local-6989586621682238647"><span class="annot"><a href="Agda.Interaction.Imports.html#raiseNonFatalErrors"><span class="hs-identifier hs-type">raiseNonFatalErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682238647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCError"><span class="hs-identifier hs-type">MonadTCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682238647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#CheckResult"><span class="hs-identifier hs-type">CheckResult</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ E.g. obtained from 'typeCheckMain'.</span></span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682238647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-881"></span><span id="raiseNonFatalErrors"><span class="annot"><span class="annottext">raiseNonFatalErrors :: forall (m :: * -&gt; *).
(HasOptions m, MonadTCError m) =&gt;
CheckResult -&gt; m ()
</span><a href="Agda.Interaction.Imports.html#raiseNonFatalErrors"><span class="hs-identifier hs-var hs-var">raiseNonFatalErrors</span></a></span></span><span> </span><span id="local-6989586621682240664"><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682240664"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-882"></span><span>  </span><span class="annot"><span class="annottext">m (Set TCWarning) -&gt; (Set1 TCWarning -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Set a) -&gt; (Set1 a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Set1.html#unlessNullM"><span class="hs-identifier hs-var">Set1.unlessNullM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TCWarning -&gt; m (Set TCWarning)
forall (m :: * -&gt; *).
HasOptions m =&gt;
Set TCWarning -&gt; m (Set TCWarning)
</span><a href="Agda.TypeChecking.Pretty.Warning.html#applyFlagsToTCWarnings"><span class="hs-identifier hs-var">applyFlagsToTCWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckResult -&gt; Set TCWarning
</span><a href="Agda.Interaction.Imports.html#crWarnings"><span class="hs-identifier hs-var">crWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="#local-6989586621682240664"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Set1 TCWarning -&gt; m ()) -&gt; m ())
-&gt; (Set1 TCWarning -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240667"><span class="annot"><span class="annottext">Set1 TCWarning
</span><a href="#local-6989586621682240667"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-883"></span><span>    </span><span class="annot"><span class="annottext">TypeError -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; m ()) -&gt; TypeError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set1 TCWarning -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NonFatalErrors"><span class="hs-identifier hs-var">NonFatalErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Set1 TCWarning
</span><a href="#local-6989586621682240667"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span class="hs-comment">-- | Check if the options used for checking an imported module are</span><span>
</span><span id="line-886"></span><span class="hs-comment">--   compatible with the current options. Raises Non-fatal errors if</span><span>
</span><span id="line-887"></span><span class="hs-comment">--   not.</span><span>
</span><span id="line-888"></span><span class="annot"><a href="Agda.Interaction.Imports.html#checkOptionsCompatible"><span class="hs-identifier hs-type">checkOptionsCompatible</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-889"></span><span>  </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-890"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-891"></span><span id="checkOptionsCompatible"><span class="annot"><span class="annottext">checkOptionsCompatible :: PragmaOptions
-&gt; PragmaOptions
-&gt; SourceFile
-&gt; TopLevelModuleName
-&gt; TCMT IO Bool
</span><a href="Agda.Interaction.Imports.html#checkOptionsCompatible"><span class="hs-identifier hs-var hs-var">checkOptionsCompatible</span></a></span></span><span> </span><span id="local-6989586621682240670"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240670"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span id="local-6989586621682240671"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240671"><span class="hs-identifier hs-var">imported</span></a></span></span><span> </span><span id="local-6989586621682240672"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240672"><span class="hs-identifier hs-var">importedFile</span></a></span></span><span> </span><span id="local-6989586621682240673"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240673"><span class="hs-identifier hs-var">importedModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-892"></span><span>  </span><span class="annot"><span class="annottext">(StateT Bool (TCMT IO) () -&gt; Bool -&gt; TCMT IO Bool)
-&gt; Bool -&gt; StateT Bool (TCMT IO) () -&gt; TCMT IO Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT Bool (TCMT IO) () -&gt; Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(StateT Bool (TCMT IO) () -&gt; TCMT IO Bool)
-&gt; StateT Bool (TCMT IO) () -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-comment">-- The flag --erasure is ignored for builtin modules.</span><span>
</span><span id="line-894"></span><span>  </span><span id="local-6989586621682240674"><span class="annot"><a href="#local-6989586621682240674"><span class="hs-identifier hs-var">imported</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-895"></span><span>    </span><span class="annot"><span class="annottext">StateT Bool (TCMT IO) Bool
-&gt; StateT Bool (TCMT IO) PragmaOptions
-&gt; StateT Bool (TCMT IO) PragmaOptions
-&gt; StateT Bool (TCMT IO) PragmaOptions
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe IsBuiltinModule -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe IsBuiltinModule -&gt; Bool)
-&gt; StateT Bool (TCMT IO) (Maybe IsBuiltinModule)
-&gt; StateT Bool (TCMT IO) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FileId -&gt; StateT Bool (TCMT IO) (Maybe IsBuiltinModule)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
FileId -&gt; m (Maybe IsBuiltinModule)
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-var">isBuiltinModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceFile -&gt; FileId
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#srcFileId"><span class="hs-identifier hs-var">srcFileId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240672"><span class="hs-identifier hs-var">importedFile</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; StateT Bool (TCMT IO) PragmaOptions
forall a. a -&gt; StateT Bool (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' PragmaOptions (WithDefault' Bool 'False)
-&gt; LensSet PragmaOptions (WithDefault' Bool 'False)
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">(WithDefault' Bool 'False -&gt; f (WithDefault' Bool 'False))
-&gt; PragmaOptions -&gt; f PragmaOptions
Lens' PragmaOptions (WithDefault' Bool 'False)
</span><a href="Agda.Interaction.Options.Base.html#lensOptErasure"><span class="hs-identifier hs-var">lensOptErasure</span></a></span><span> </span><span class="annot"><span class="annottext">WithDefault' Bool 'False
forall a (b :: Bool). WithDefault' a b
</span><a href="Agda.Utils.WithDefault.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240671"><span class="hs-identifier hs-var">imported</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; StateT Bool (TCMT IO) PragmaOptions
forall a. a -&gt; StateT Bool (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240671"><span class="hs-identifier hs-var">imported</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.options&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">P.nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;current options  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">P.&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240681"><span class="hs-identifier hs-type">showOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240670"><span class="hs-identifier hs-type">current</span></a></span><span>
</span><span id="line-899"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.options&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">P.nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;imported options =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">P.&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240681"><span class="hs-identifier hs-type">showOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240674"><span class="hs-identifier hs-type">imported</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#infectiveCoinfectiveOptions"><span class="hs-identifier hs-type">infectiveCoinfectiveOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682240683"><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; StateT Bool (TCMT IO) () -&gt; StateT Bool (TCMT IO) ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
-&gt; PragmaOptions -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#icOptionOK"><span class="hs-identifier hs-var">icOptionOK</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240670"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240674"><span class="hs-identifier hs-var">imported</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT Bool (TCMT IO) () -&gt; StateT Bool (TCMT IO) ())
-&gt; StateT Bool (TCMT IO) () -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-902"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; StateT Bool (TCMT IO) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.options&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; StateT Bool (TCMT IO) ())
-&gt; TCMT IO Doc -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">P.nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-903"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;incompatible: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">P.text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; [Char]
</span><a href="Agda.Interaction.Options.Base.html#icOptionDescription"><span class="hs-identifier hs-var">icOptionDescription</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;, current: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#icOptionActive"><span class="hs-identifier hs-var">icOptionActive</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240670"><span class="hs-identifier hs-var">current</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;, imported: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#icOptionActive"><span class="hs-identifier hs-var">icOptionActive</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240674"><span class="hs-identifier hs-var">imported</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; StateT Bool (TCMT IO) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-907"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; StateT Bool (TCMT IO) ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; StateT Bool (TCMT IO) ())
-&gt; Warning -&gt; StateT Bool (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-908"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; InfectiveCoinfective
</span><a href="Agda.Interaction.Options.Base.html#icOptionKind"><span class="hs-identifier hs-var">icOptionKind</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-909"></span><span>           </span><span class="annot"><span class="annottext">InfectiveCoinfective
</span><a href="Agda.Interaction.Options.Types.html#Infective"><span class="hs-identifier hs-var">Infective</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#InfectiveImport"><span class="hs-identifier hs-var">InfectiveImport</span></a></span><span>
</span><span id="line-910"></span><span>           </span><span class="annot"><span class="annottext">InfectiveCoinfective
</span><a href="Agda.Interaction.Options.Types.html#Coinfective"><span class="hs-identifier hs-var">Coinfective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#CoInfectiveImport"><span class="hs-identifier hs-var">CoInfectiveImport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; TopLevelModuleName -&gt; Doc
</span><a href="Agda.Interaction.Options.Base.html#icOptionWarning"><span class="hs-identifier hs-var">icOptionWarning</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240683"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240673"><span class="hs-identifier hs-var">importedModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-913"></span><span>  </span><span id="local-6989586621682240681"><span class="annot"><span class="annottext">showOptions :: PragmaOptions -&gt; m Doc
</span><a href="#local-6989586621682240681"><span class="hs-identifier hs-var hs-var">showOptions</span></a></span></span><span> </span><span id="local-6989586621682240707"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240707"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-914"></span><span>    </span><span class="annot"><span class="annottext">[m Doc] -&gt; m Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">P.prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">([m Doc] -&gt; m Doc) -&gt; [m Doc] -&gt; m Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-915"></span><span>    </span><span class="annot"><span class="annottext">(InfectiveCoinfectiveOption -&gt; m Doc)
-&gt; [InfectiveCoinfectiveOption] -&gt; [m Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682240709"><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240709"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">P.text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; [Char]
</span><a href="Agda.Interaction.Options.Base.html#icOptionDescription"><span class="hs-identifier hs-var">icOptionDescription</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240709"><span class="hs-identifier hs-var">opt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Doc
</span><span class="hs-string">&quot;: &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Doc -&gt; m Doc -&gt; m Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">P.&lt;+&gt;</span></a></span><span>
</span><span id="line-916"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; m Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption -&gt; PragmaOptions -&gt; Bool
</span><a href="Agda.Interaction.Options.Base.html#icOptionActive"><span class="hs-identifier hs-var">icOptionActive</span></a></span><span> </span><span class="annot"><span class="annottext">InfectiveCoinfectiveOption
</span><a href="#local-6989586621682240709"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240707"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>      </span><span class="annot"><span class="annottext">[InfectiveCoinfectiveOption]
</span><a href="Agda.Interaction.Options.Base.html#infectiveCoinfectiveOptions"><span class="hs-identifier hs-var">infectiveCoinfectiveOptions</span></a></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="hs-comment">-- | Compare options and return collected warnings.</span><span>
</span><span id="line-920"></span><span class="hs-comment">-- | Returns `Nothing` if warning collection was skipped.</span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-type">getOptionsCompatibilityWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-923"></span><span>     </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#PragmaOptions"><span class="hs-identifier hs-type">PragmaOptions</span></a></span><span>
</span><span id="line-925"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span id="getOptionsCompatibilityWarnings"><span class="annot"><span class="annottext">getOptionsCompatibilityWarnings :: MainInterface
-&gt; PragmaOptions -&gt; ModuleInfo -&gt; TCMT IO (Maybe (Set TCWarning))
</span><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-var hs-var">getOptionsCompatibilityWarnings</span></a></span></span><span>
</span><span id="line-928"></span><span>  </span><span id="local-6989586621682240710"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240710"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621682240711"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240711"><span class="hs-identifier hs-var">currentOptions</span></a></span></span><span>
</span><span id="line-929"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span class="hs-special">{</span><span>
</span><span id="line-930"></span><span>    </span><span class="annot"><span class="annottext">miPrimitive :: ModuleInfo -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-931"></span><span>    </span><span class="annot"><span class="annottext">miInterface :: ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span class="hs-special">{</span><span> </span><span id="local-6989586621682240714"><span class="annot"><span class="annottext">PragmaOptions
iOptionsUsed :: PragmaOptions
iOptionsUsed :: Interface -&gt; PragmaOptions
</span><a href="#local-6989586621682240714"><span class="hs-identifier hs-var hs-var">iOptionsUsed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240716"><span class="annot"><span class="annottext">TopLevelModuleName
iTopLevelModuleName :: Interface -&gt; TopLevelModuleName
iTopLevelModuleName :: TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var hs-var">iTopLevelModuleName</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-932"></span><span>    </span><span id="local-6989586621682240717"><span class="annot"><span class="annottext">SourceFile
miSourceFile :: ModuleInfo -&gt; SourceFile
miSourceFile :: SourceFile
</span><a href="Agda.TypeChecking.Monad.Base.html#miSourceFile"><span class="hs-identifier hs-var hs-var">miSourceFile</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-933"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Bool
-&gt; TCMT IO (Maybe (Set TCWarning))
-&gt; TCMT IO (Maybe (Set TCWarning))
-&gt; TCMT IO (Maybe (Set TCWarning))
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions
-&gt; PragmaOptions
-&gt; SourceFile
-&gt; TopLevelModuleName
-&gt; TCMT IO Bool
</span><a href="Agda.Interaction.Imports.html#checkOptionsCompatible"><span class="hs-identifier hs-var">checkOptionsCompatible</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240711"><span class="hs-identifier hs-var">currentOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682240714"><span class="hs-identifier hs-var">iOptionsUsed</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240717"><span class="hs-identifier hs-var">miSourceFile</span></a></span><span>
</span><span id="line-934"></span><span>         </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240716"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Set TCWarning) -&gt; TCMT IO (Maybe (Set TCWarning))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set TCWarning)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- No warnings to collect because options were compatible.</span><span>
</span><span id="line-936"></span><span>    </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TCWarning -&gt; Maybe (Set TCWarning)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Set TCWarning -&gt; Maybe (Set TCWarning))
-&gt; TCMT IO (Set TCWarning) -&gt; TCMT IO (Maybe (Set TCWarning))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; WhichWarnings -&gt; TCMT IO (Set TCWarning)
forall (m :: * -&gt; *).
(MonadWarning m, MonadTCM m) =&gt;
MainInterface -&gt; WhichWarnings -&gt; m (Set TCWarning)
</span><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var">getAllWarnings'</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682240710"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#ErrorWarnings"><span class="hs-identifier hs-var">ErrorWarnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span class="hs-comment">-- Options consistency checking is disabled for always-available primitive modules.</span><span>
</span><span id="line-938"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getOptionsCompatibilityWarnings"><span class="hs-identifier hs-var">getOptionsCompatibilityWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">miPrimitive :: ModuleInfo -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-939"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Set TCWarning) -&gt; TCMT IO (Maybe (Set TCWarning))
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set TCWarning)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span class="annot"><span class="hs-comment">-- | Try to get the interface from interface file or cache.</span></span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getStoredInterface"><span class="hs-identifier hs-type">getStoredInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-945"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Module name of file we process.</span></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-947"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ File we process.</span></span><span>
</span><span id="line-948"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-950"></span><span id="getStoredInterface"><span class="annot"><span class="annottext">getStoredInterface :: HasCallStack =&gt;
TopLevelModuleName
-&gt; SourceFile
-&gt; Maybe Source
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#getStoredInterface"><span class="hs-identifier hs-var hs-var">getStoredInterface</span></a></span></span><span> </span><span id="local-6989586621682240826"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240826"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240827"><span class="annot"><span class="annottext">file :: SourceFile
</span><a href="#local-6989586621682240827"><span class="hs-identifier hs-var">file</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span id="local-6989586621682240829"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621682240829"><span class="hs-identifier hs-var">fi</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682240830"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240830"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>  </span><span class="hs-comment">-- Check whether interface file exists and is in cache</span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-comment">--  in the correct version (as testified by the interface file hash).</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-comment">-- This is a lazy action which may be skipped if there is no cached interface</span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-comment">-- and we're ignoring interface files for some reason.</span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240831"><span class="annot"><span class="annottext">getIFileHashesET :: ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
</span><a href="#local-6989586621682240831"><span class="hs-identifier hs-var hs-var hs-var">getIFileHashesET</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-958"></span><span>        </span><span class="hs-comment">-- Check that the interface file exists and return its hash.</span><span>
</span><span id="line-959"></span><span>        </span><span id="local-6989586621682240832"><span class="annot"><a href="#local-6989586621682240832"><span class="hs-identifier hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (TCMT IO) InterfaceFile
-&gt; ExceptT [Char] (TCMT IO) InterfaceFile
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the interface file could not be found&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (TCMT IO) InterfaceFile
 -&gt; ExceptT [Char] (TCMT IO) InterfaceFile)
-&gt; MaybeT (TCMT IO) InterfaceFile
-&gt; ExceptT [Char] (TCMT IO) InterfaceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe InterfaceFile) -&gt; MaybeT (TCMT IO) InterfaceFile
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe InterfaceFile) -&gt; MaybeT (TCMT IO) InterfaceFile)
-&gt; TCMT IO (Maybe InterfaceFile) -&gt; MaybeT (TCMT IO) InterfaceFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-960"></span><span>          </span><span class="annot"><span class="annottext">HasCallStack =&gt; SourceFile -&gt; TCMT IO (Maybe InterfaceFile)
SourceFile -&gt; TCMT IO (Maybe InterfaceFile)
</span><a href="Agda.Interaction.FindFile.html#findInterfaceFile%27"><span class="hs-identifier hs-var">findInterfaceFile'</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240827"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span>        </span><span class="hs-comment">-- Check that the interface file exists and return its hash.</span><span>
</span><span id="line-963"></span><span>        </span><span id="local-6989586621682240836"><span class="annot"><a href="#local-6989586621682240836"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToExceptT</span></span><span> </span><span class="annot"><span class="hs-string">&quot;the interface file hash could not be read&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-964"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterfaceFileHashes"><span class="hs-identifier hs-type">getInterfaceFileHashes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240832"><span class="hs-identifier hs-type">ifile</span></a></span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240832"><span class="hs-identifier hs-type">ifile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682240836"><span class="hs-identifier hs-type">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-comment">-- Examine the hash of the interface file. If it is different from the</span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-comment">-- stored version (in stDecodedModules), or if there is no stored version,</span><span>
</span><span id="line-970"></span><span>  </span><span class="hs-comment">-- read and decode it. Otherwise use the stored version.</span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-comment">-- This is a lazy action which may be skipped if the cached or on-disk interface</span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-comment">-- is invalid, missing, or skipped for some other reason.</span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240838"><span class="annot"><span class="annottext">checkSourceHashET :: Hash -&gt; ExceptT [Char] (TCMT IO) ()
</span><a href="#local-6989586621682240838"><span class="hs-identifier hs-var hs-var hs-var">checkSourceHashET</span></a></span></span><span> </span><span id="local-6989586621682240839"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682240839"><span class="hs-identifier hs-var">ifaceH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-975"></span><span>        </span><span id="local-6989586621682240840"><span class="annot"><a href="#local-6989586621682240840"><span class="hs-identifier hs-var">sourceH</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240830"><span class="hs-identifier hs-var">msrc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-976"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Source
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-977"></span><span>                      </span><span id="local-6989586621682240841"><span class="annot"><a href="#local-6989586621682240841"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; ExceptT [Char] (TCMT IO) AbsolutePath
forall (m :: * -&gt; *). MonadFileId m =&gt; SourceFile -&gt; m AbsolutePath
</span><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240827"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-978"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#hashTextFile"><span class="hs-identifier hs-type">hashTextFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240841"><span class="hs-identifier hs-type">path</span></a></span><span>
</span><span id="line-979"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682240843"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240843"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a. a -&gt; ExceptT [Char] (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; ExceptT [Char] (TCMT IO) Hash)
-&gt; Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Hash
</span><a href="Agda.Utils.Hash.html#hashText"><span class="hs-identifier hs-var">hashText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682240843"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240840"><span class="hs-identifier hs-type">sourceH</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682240839"><span class="hs-identifier hs-type">ifaceH</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-982"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span>
</span><span id="line-983"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;the source hash (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240840"><span class="hs-identifier hs-type">sourceH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-984"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; does not match the source hash for the interface (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240839"><span class="hs-identifier hs-type">ifaceH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-985"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240826"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; is up-to-date.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-990"></span><span>    </span><span class="hs-comment">-- Load or reload the interface file, if possible.</span><span>
</span><span id="line-991"></span><span>    </span><span id="local-6989586621682240845"><span class="annot"><span class="annottext">loadInterfaceFile :: [Char] -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="#local-6989586621682240845"><span class="hs-identifier hs-var hs-var hs-var">loadInterfaceFile</span></a></span></span><span> </span><span id="local-6989586621682240846"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240846"><span class="hs-identifier hs-var">whyNotCached</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-992"></span><span>      </span><span class="annot"><span class="annottext">ShowS
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682240847"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240847"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240846"><span class="hs-identifier hs-var">whyNotCached</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; and &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240847"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-993"></span><span>      </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreAllInterfaces"><span class="hs-identifier hs-var">ignoreAllInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-994"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;we're ignoring all interface files&quot;</span></span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>      </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Bool
forall (m :: * -&gt; *). HasOptions m =&gt; m Bool
</span><a href="Agda.Interaction.Imports.html#ignoreInterfaces"><span class="hs-identifier hs-var">ignoreInterfaces</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-997"></span><span>        </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (Maybe IsBuiltinModule)
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenNothingM"><span class="hs-identifier hs-var">whenNothingM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileId -&gt; ExceptT [Char] (TCMT IO) (Maybe IsBuiltinModule)
forall (m :: * -&gt; *).
ReadTCState m =&gt;
FileId -&gt; m (Maybe IsBuiltinModule)
</span><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-var">isBuiltinModule</span></a></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621682240829"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ())
-&gt; ExceptT [Char] (TCMT IO) () -&gt; ExceptT [Char] (TCMT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-998"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ()
forall a. [Char] -&gt; ExceptT [Char] (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;we're ignoring non-builtin interface files&quot;</span></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682240849"><span class="annot"><a href="#local-6989586621682240849"><span class="hs-identifier hs-var">ifile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240850"><span class="annot"><a href="#local-6989586621682240850"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
</span><a href="#local-6989586621682240831"><span class="hs-identifier hs-var">getIFileHashesET</span></a></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240851"><span class="annot"><a href="#local-6989586621682240851"><span class="hs-identifier hs-var hs-var">ifp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(InterfaceFile -&gt; AbsolutePath) -&gt; InterfaceFile -&gt; AbsolutePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621682240849"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span>      </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-type">Bench.Deserialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1005"></span><span>        </span><span class="annot"><a href="#local-6989586621682240838"><span class="hs-identifier hs-type">checkSourceHashET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621682240850"><span class="hs-identifier hs-type">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  no stored version, reading &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682240851"><span class="hs-identifier hs-type">ifp</span></a></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span>        </span><span id="local-6989586621682240854"><span class="annot"><a href="#local-6989586621682240854"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToExceptT</span></span><span> </span><span class="annot"><span class="hs-string">&quot;bad interface, re-type checking&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1010"></span><span>          </span><span class="annot"><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier hs-type">readInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240849"><span class="hs-identifier hs-type">ifile</span></a></span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span>        </span><span class="hs-comment">-- Ensure that the given module name matches the one in the file.</span><span>
</span><span id="line-1013"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240855"><span class="annot"><a href="#local-6989586621682240855"><span class="hs-identifier hs-var hs-var">topLevelName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240854"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1014"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240855"><span class="hs-identifier hs-type">topLevelName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682240826"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1015"></span><span>          </span><span id="local-6989586621682240856"><span class="annot"><a href="#local-6989586621682240856"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-type">srcFilePath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240827"><span class="hs-identifier hs-type">file</span></a></span><span>
</span><span id="line-1016"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OverlappingProjects"><span class="hs-identifier hs-type">OverlappingProjects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240856"><span class="hs-identifier hs-type">path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240855"><span class="hs-identifier hs-type">topLevelName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240826"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>        </span><span id="local-6989586621682240858"><span class="annot"><a href="#local-6989586621682240858"><span class="hs-identifier hs-var">isPrimitiveMod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#isPrimitiveModule"><span class="hs-identifier hs-type">isPrimitiveModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240829"><span class="hs-identifier hs-type">fi</span></a></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-type">chaseMsg</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Loading &quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682240826"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682240851"><span class="hs-identifier hs-type">ifp</span></a></span><span>
</span><span id="line-1021"></span><span>        </span><span class="hs-comment">-- print imported warnings</span><span>
</span><span id="line-1022"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Imports.html#reportWarningsForModule"><span class="hs-identifier hs-type">reportWarningsForModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240826"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iWarnings"><span class="hs-identifier hs-var">iWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240854"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-type">loadDecodedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240827"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1025"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240854"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-1026"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-1027"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240858"><span class="hs-identifier hs-type">isPrimitiveMod</span></a></span><span>
</span><span id="line-1028"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleTypeChecked"><span class="hs-identifier hs-type">ModuleTypeChecked</span></a></span><span>
</span><span id="line-1029"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miSourceFile"><span class="hs-identifier hs-var">miSourceFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240827"><span class="hs-identifier hs-type">file</span></a></span><span>
</span><span id="line-1030"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>  </span><span class="hs-comment">-- Check if we have cached the module.</span><span>
</span><span id="line-1033"></span><span>  </span><span id="local-6989586621682240863"><span class="annot"><a href="#local-6989586621682240863"><span class="hs-identifier hs-var">cachedE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ModuleInfo)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
 -&gt; ExceptT [Char] (TCMT IO) (Either [Char] ModuleInfo))
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">maybeToExceptT</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;the interface has not been decoded&quot;</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
 -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo)
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
 -&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
-&gt; MaybeT (ExceptT [Char] (TCMT IO)) ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1034"></span><span>      </span><span class="annot"><span class="annottext">TCM (Maybe ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe ModuleInfo)
 -&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo))
-&gt; TCM (Maybe ModuleInfo)
-&gt; ExceptT [Char] (TCMT IO) (Maybe ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCM (Maybe ModuleInfo)
</span><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModule"><span class="hs-identifier hs-var">getDecodedModule</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240826"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682240863"><span class="hs-identifier hs-type">cachedE</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1037"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682240864"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240864"><span class="hs-identifier hs-var">whyNotCached</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="#local-6989586621682240845"><span class="hs-identifier hs-var">loadInterfaceFile</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240864"><span class="hs-identifier hs-var">whyNotCached</span></a></span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span>    </span><span class="hs-comment">-- If it's cached ignoreInterfaces has no effect;</span><span>
</span><span id="line-1040"></span><span>    </span><span class="hs-comment">-- to avoid typechecking a file more than once.</span><span>
</span><span id="line-1041"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682240865"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240865"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1042"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682240866"><span class="annot"><a href="#local-6989586621682240866"><span class="hs-identifier hs-var">ifile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240867"><span class="annot"><a href="#local-6989586621682240867"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) (InterfaceFile, (Hash, Hash))
</span><a href="#local-6989586621682240831"><span class="hs-identifier hs-var">getIFileHashesET</span></a></span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240868"><span class="annot"><a href="#local-6989586621682240868"><span class="hs-identifier hs-var hs-var">ifp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621682240866"><span class="hs-identifier hs-var">ifile</span></a></span><span>
</span><span id="line-1045"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240869"><span class="annot"><a href="#local-6989586621682240869"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240865"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span>      </span><span class="hs-comment">-- Make sure the hashes match.</span><span>
</span><span id="line-1048"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240870"><span class="annot"><a href="#local-6989586621682240870"><span class="hs-identifier hs-var hs-var">cachedIfaceHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-var">iFullHash</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240869"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1049"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240872"><span class="annot"><a href="#local-6989586621682240872"><span class="hs-identifier hs-var hs-var">fileIfaceHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Hash, Hash) -&gt; Hash
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Hash, Hash)
</span><a href="#local-6989586621682240867"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-1050"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682240870"><span class="hs-identifier hs-type">cachedIfaceHash</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="#local-6989586621682240872"><span class="hs-identifier hs-type">fileIfaceHash</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1051"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#dropDecodedModule"><span class="hs-identifier hs-type">dropDecodedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240826"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-1052"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  cached hash = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240870"><span class="hs-identifier hs-type">cachedIfaceHash</span></a></span><span>
</span><span id="line-1053"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  stored hash = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240872"><span class="hs-identifier hs-type">fileIfaceHash</span></a></span><span>
</span><span id="line-1054"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  file is newer, re-reading &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682240868"><span class="hs-identifier hs-type">ifp</span></a></span><span>
</span><span id="line-1055"></span><span>        </span><span class="annot"><a href="#local-6989586621682240845"><span class="hs-identifier hs-type">loadInterfaceFile</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span>
</span><span id="line-1056"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;the cached interface hash (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240870"><span class="hs-identifier hs-type">cachedIfaceHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1057"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; does not match interface file (&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682240872"><span class="hs-identifier hs-type">fileIfaceHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1058"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1059"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-type">Bench.Deserialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1060"></span><span>        </span><span class="annot"><a href="#local-6989586621682240838"><span class="hs-identifier hs-type">checkSourceHashET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240869"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>
</span><span id="line-1062"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  using stored version of &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-type">filePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240866"><span class="hs-identifier hs-type">ifile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>        </span><span class="annot"><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-type">loadDecodedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240827"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240865"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span class="annot"><span class="hs-comment">-- | Report those given warnings that come from the given module.</span></span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span id="local-6989586621682238692"><span class="annot"><a href="Agda.Interaction.Imports.html#reportWarningsForModule"><span class="hs-identifier hs-type">reportWarningsForModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682238692"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682238692"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1068"></span><span id="reportWarningsForModule"><span class="annot"><span class="annottext">reportWarningsForModule :: forall (m :: * -&gt; *).
MonadDebug m =&gt;
TopLevelModuleName -&gt; Set TCWarning -&gt; m ()
</span><a href="Agda.Interaction.Imports.html#reportWarningsForModule"><span class="hs-identifier hs-var hs-var">reportWarningsForModule</span></a></span></span><span> </span><span id="local-6989586621682240895"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240895"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240896"><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682240896"><span class="hs-identifier hs-var">warns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1069"></span><span>  </span><span class="annot"><span class="annottext">[TCWarning] -&gt; ([TCWarning] -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TCWarning -&gt; Bool) -&gt; [TCWarning] -&gt; [TCWarning]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TopLevelModuleName -&gt; Maybe (Maybe TopLevelModuleName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Strict.Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe TopLevelModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240895"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe TopLevelModuleName)
-&gt; Maybe (Maybe TopLevelModuleName) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Maybe TopLevelModuleName) -&gt; Bool)
-&gt; (TCWarning -&gt; Maybe (Maybe TopLevelModuleName))
-&gt; TCWarning
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RangeFile -&gt; Maybe TopLevelModuleName)
-&gt; Maybe RangeFile -&gt; Maybe (Maybe TopLevelModuleName)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RangeFile -&gt; Maybe TopLevelModuleName
</span><a href="Agda.Syntax.Position.html#rangeFileName"><span class="hs-identifier hs-var">rangeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe RangeFile -&gt; Maybe (Maybe TopLevelModuleName))
-&gt; (TCWarning -&gt; Maybe RangeFile)
-&gt; TCWarning
-&gt; Maybe (Maybe TopLevelModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; Maybe RangeFile
</span><a href="Agda.TypeChecking.Monad.Base.html#tcWarningOrigin"><span class="hs-identifier hs-var">tcWarningOrigin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; [TCWarning]) -&gt; [TCWarning] -&gt; [TCWarning]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; [TCWarning]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toAscList</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682240896"><span class="hs-identifier hs-var">warns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240900"><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621682240900"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1070"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSDoc"><span class="hs-identifier hs-var">alwaysReportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;warning&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-comment">-- Andreas, 2025-08-01, PR #8040</span><span>
</span><span id="line-1072"></span><span>      </span><span class="hs-comment">-- Make sure that imported warnings coming from different modules are separated by an empty line.</span><span>
</span><span id="line-1073"></span><span>      </span><span class="hs-comment">-- E.g. test/Succeed/ImportWarnings</span><span>
</span><span id="line-1074"></span><span>      </span><span class="hs-comment">-- Technique from PR #7473:</span><span>
</span><span id="line-1075"></span><span>      </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">P.vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; [TCMT IO Doc]) -&gt; [TCWarning] -&gt; [TCMT IO Doc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682240903"><span class="annot"><span class="annottext">TCWarning
</span><a href="#local-6989586621682240903"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; TCWarning -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">P.prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCWarning
</span><a href="#local-6989586621682240903"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621682240900"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-1076"></span><span>      </span><span class="hs-comment">-- Technique from PR #7362:</span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-comment">-- P.vsep $ map P.prettyTCM ws</span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span class="hs-comment">-- | Check whether the loaded module is up-to-date</span><span>
</span><span id="line-1080"></span><span class="hs-comment">--   and merge into state if this is the case.</span><span>
</span><span id="line-1081"></span><span class="hs-comment">--</span><span>
</span><span id="line-1082"></span><span class="annot"><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-type">loadDecodedModule</span></a></span><span>
</span><span id="line-1083"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-1084"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ File we process.</span></span><span>
</span><span id="line-1085"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1086"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The interface we loaded or created.</span></span><span>
</span><span id="line-1087"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1088"></span><span id="loadDecodedModule"><span class="annot"><span class="annottext">loadDecodedModule :: SourceFile -&gt; ModuleInfo -&gt; ExceptT [Char] (TCMT IO) ModuleInfo
</span><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-var hs-var">loadDecodedModule</span></a></span></span><span> </span><span id="local-6989586621682240904"><span class="annot"><span class="annottext">sf :: SourceFile
</span><a href="#local-6989586621682240904"><span class="hs-identifier hs-var">sf</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span id="local-6989586621682240905"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621682240905"><span class="hs-identifier hs-var">fi</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682240906"><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240906"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1089"></span><span>  </span><span id="local-6989586621682240907"><span class="annot"><a href="#local-6989586621682240907"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; ExceptT [Char] (TCMT IO) AbsolutePath
forall (m :: * -&gt; *). MonadFileId m =&gt; SourceFile -&gt; m AbsolutePath
</span><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240904"><span class="hs-identifier hs-var">sf</span></a></span><span>
</span><span id="line-1090"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240908"><span class="annot"><a href="#local-6989586621682240908"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682240907"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240909"><span class="annot"><a href="#local-6989586621682240909"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleInfo -&gt; Interface
</span><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleInfo
</span><a href="#local-6989586621682240906"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240910"><span class="annot"><a href="#local-6989586621682240910"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; [(TopLevelModuleName, Hash)]
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportedModules"><span class="hs-identifier hs-var">iImportedModules</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240909"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1093"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240912"><span class="annot"><a href="#local-6989586621682240912"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682240909"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span>  </span><span class="hs-comment">-- Print imported modules.</span><span>
</span><span id="line-1096"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-type">verboseS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.imports&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240910"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1097"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.imports&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">intercalate</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1098"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240912"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;imports:&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span>
</span><span id="line-1099"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682240913"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240913"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240914"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682240914"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240913"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;(hash: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682240914"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>        </span><span class="annot"><a href="#local-6989586621682240910"><span class="hs-identifier hs-type">imports</span></a></span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-comment">-- We set the pragma options of the skipped file here, so that</span><span>
</span><span id="line-1103"></span><span>  </span><span class="hs-comment">-- we can check that they are compatible with those of the</span><span>
</span><span id="line-1104"></span><span>  </span><span class="hs-comment">-- imported modules. Also, if the top-level file is skipped we</span><span>
</span><span id="line-1105"></span><span>  </span><span class="hs-comment">-- want the pragmas to apply to interactive commands in the UI.</span><span>
</span><span id="line-1106"></span><span>  </span><span class="hs-comment">-- Jesper, 2021-04-18: Check for changed options in library files!</span><span>
</span><span id="line-1107"></span><span>  </span><span class="hs-comment">-- (see #5250)</span><span>
</span><span id="line-1108"></span><span>  </span><span id="local-6989586621682240915"><span class="annot"><a href="#local-6989586621682240915"><span class="hs-identifier hs-var">libOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getLibraryOptions"><span class="hs-identifier hs-type">getLibraryOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240907"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240912"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-1109"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#setOptionsFromPragma"><span class="hs-identifier hs-type">setOptionsFromPragma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240915"><span class="hs-identifier hs-type">libOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iFilePragmaOptions"><span class="hs-identifier hs-var">iFilePragmaOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240909"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span>  </span><span class="hs-comment">-- Check that options that matter haven't changed compared to</span><span>
</span><span id="line-1112"></span><span>  </span><span class="hs-comment">-- current options (issue #2487).</span><span>
</span><span id="line-1113"></span><span>  </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenNothingM"><span class="hs-identifier hs-type">whenNothingM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#isBuiltinModule"><span class="hs-identifier hs-type">isBuiltinModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240905"><span class="hs-identifier hs-type">fi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1114"></span><span>    </span><span id="local-6989586621682240918"><span class="annot"><a href="#local-6989586621682240918"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-type">stPragmaOptions</span></a></span><span>
</span><span id="line-1115"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#recheckBecausePragmaOptionsChanged"><span class="hs-identifier hs-type">recheckBecausePragmaOptionsChanged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iOptionsUsed"><span class="hs-identifier hs-var">iOptionsUsed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240909"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682240918"><span class="hs-identifier hs-type">current</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1116"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;options changed&quot;</span></span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-comment">-- If any of the imports are newer we need to re-typecheck.</span><span>
</span><span id="line-1119"></span><span>  </span><span id="local-6989586621682240922"><span class="annot"><a href="#local-6989586621682240922"><span class="hs-identifier hs-var">badHashMessages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">lefts</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682240910"><span class="hs-identifier hs-type">imports</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682240925"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240925"><span class="hs-identifier hs-var">impName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240926"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682240926"><span class="hs-identifier hs-var">impHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
-&gt; ExceptT [Char] (TCMT IO) (Either [Char] ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1120"></span><span>    </span><span class="annot"><span class="annottext">[Char]
-&gt; Int -&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ())
-&gt; [Char] -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking that module hash of import &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240925"><span class="hs-identifier hs-var">impName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; matches &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682240926"><span class="hs-identifier hs-var">impHash</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1121"></span><span>    </span><span id="local-6989586621682240927"><span class="annot"><a href="#local-6989586621682240927"><span class="hs-identifier hs-var">latestImpHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT [Char] (TCMT IO) Hash
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) Hash
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT [Char] (TCMT IO) Hash
 -&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) Hash)
-&gt; ExceptT [Char] (TCMT IO) Hash
-&gt; ExceptT [Char] (ExceptT [Char] (TCMT IO)) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT [Char] m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Hash -&gt; ExceptT [Char] (TCMT IO) Hash)
-&gt; TCMT IO Hash -&gt; ExceptT [Char] (TCMT IO) Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO Hash -&gt; TCMT IO Hash
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240925"><span class="hs-identifier hs-var">impName</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Hash -&gt; TCMT IO Hash) -&gt; TCMT IO Hash -&gt; TCMT IO Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO Hash
</span><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-var">moduleHash</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240925"><span class="hs-identifier hs-var">impName</span></a></span><span>
</span><span id="line-1122"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;Done checking module hash of import &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240925"><span class="hs-identifier hs-type">impName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1123"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240926"><span class="hs-identifier hs-type">impHash</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="#local-6989586621682240927"><span class="hs-identifier hs-type">latestImpHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1124"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span>
</span><span id="line-1125"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;module hash for imported module &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240925"><span class="hs-identifier hs-type">impName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; is out of date&quot;</span></span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; (import cached=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240926"><span class="hs-identifier hs-type">impHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;, latest=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240927"><span class="hs-identifier hs-type">latestImpHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1127"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>  </span><span class="annot"><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-type">unlessNull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240922"><span class="hs-identifier hs-type">badHashMessages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">unlines</span></span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span>
</span><span id="line-1131"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240912"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: interface is valid and can be merged into the state.&quot;</span></span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#mergeInterface"><span class="hs-identifier hs-type">mergeInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240909"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-1134"></span><span>  </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-type">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-type">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1136"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Imports.html#highlightFromInterface"><span class="hs-identifier hs-type">highlightFromInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240909"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240904"><span class="hs-identifier hs-type">sf</span></a></span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682240906"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span class="hs-comment">-- | Run the type checker on a file and create an interface.</span><span>
</span><span id="line-1141"></span><span class="hs-comment">--</span><span>
</span><span id="line-1142"></span><span class="hs-comment">--   Mostly, this function calls 'createInterface'.</span><span>
</span><span id="line-1143"></span><span class="hs-comment">--   But if it is not the main module we check,</span><span>
</span><span id="line-1144"></span><span class="hs-comment">--   we do it in a fresh state, suitably initialize,</span><span>
</span><span id="line-1145"></span><span class="hs-comment">--   in order to forget some state changes after successful type checking.</span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span class="annot"><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-type">createInterfaceIsolated</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1148"></span><span>     </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>
</span><span id="line-1149"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Module name of file we process.</span></span><span>
</span><span id="line-1150"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-1151"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ File we process.</span></span><span>
</span><span id="line-1152"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-1153"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Optional: the source code and some information about the source code.</span></span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1155"></span><span id="createInterfaceIsolated"><span class="annot"><span class="annottext">createInterfaceIsolated :: TopLevelModuleName -&gt; SourceFile -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-var hs-var">createInterfaceIsolated</span></a></span></span><span> </span><span id="local-6989586621682240934"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240934"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240935"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240935"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621682240936"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240936"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1156"></span><span>      </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). (MonadDebug m, MonadTCState m) =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cleanCachedLog"><span class="hs-identifier hs-var">cleanCachedLog</span></a></span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>      </span><span id="local-6989586621682240938"><span class="annot"><a href="#local-6989586621682240938"><span class="hs-identifier hs-var">ms</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; [TopLevelModuleName]) -&gt; TCMT IO [TopLevelModuleName]
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#envImportStack"><span class="hs-identifier hs-var">envImportStack</span></a></span><span>
</span><span id="line-1159"></span><span>      </span><span id="local-6989586621682240941"><span class="annot"><a href="#local-6989586621682240941"><span class="hs-identifier hs-var">range</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envRange"><span class="hs-identifier hs-var">envRange</span></a></span><span>
</span><span id="line-1160"></span><span>      </span><span id="local-6989586621682240943"><span class="annot"><a href="#local-6989586621682240943"><span class="hs-identifier hs-var">call</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCall"><span class="hs-identifier hs-var">envCall</span></a></span><span>
</span><span id="line-1161"></span><span>      </span><span id="local-6989586621682240945"><span class="annot"><a href="#local-6989586621682240945"><span class="hs-identifier hs-var">vs</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getVisitedModules"><span class="hs-identifier hs-type">getVisitedModules</span></a></span><span>
</span><span id="line-1162"></span><span>      </span><span id="local-6989586621682240947"><span class="annot"><a href="#local-6989586621682240947"><span class="hs-identifier hs-var">ds</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModules"><span class="hs-identifier hs-type">getDecodedModules</span></a></span><span>
</span><span id="line-1163"></span><span>      </span><span id="local-6989586621682240948"><span class="annot"><a href="#local-6989586621682240948"><span class="hs-identifier hs-var">opts</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentOptions"><span class="hs-identifier hs-var">stPersistentOptions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPersistentState"><span class="hs-identifier hs-var">stPersistentState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-type">getTC</span></a></span><span>
</span><span id="line-1164"></span><span>      </span><span id="local-6989586621682240949"><span class="annot"><a href="#local-6989586621682240949"><span class="hs-identifier hs-var">isig</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImports"><span class="hs-identifier hs-type">stImports</span></a></span><span>
</span><span id="line-1165"></span><span>      </span><span id="local-6989586621682240952"><span class="annot"><a href="#local-6989586621682240952"><span class="hs-identifier hs-var">metas</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedMetaStore"><span class="hs-identifier hs-type">stImportedMetaStore</span></a></span><span>
</span><span id="line-1166"></span><span>      </span><span id="local-6989586621682240955"><span class="annot"><a href="#local-6989586621682240955"><span class="hs-identifier hs-var">ibuiltin</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedBuiltins"><span class="hs-identifier hs-type">stImportedBuiltins</span></a></span><span>
</span><span id="line-1167"></span><span>      </span><span id="local-6989586621682240958"><span class="annot"><a href="#local-6989586621682240958"><span class="hs-identifier hs-var">display</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportsDisplayForms"><span class="hs-identifier hs-type">stImportsDisplayForms</span></a></span><span>
</span><span id="line-1168"></span><span>      </span><span id="local-6989586621682240962"><span class="annot"><a href="#local-6989586621682240962"><span class="hs-identifier hs-var">userwarn</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedUserWarnings"><span class="hs-identifier hs-type">stImportedUserWarnings</span></a></span><span>
</span><span id="line-1169"></span><span>      </span><span id="local-6989586621682240965"><span class="annot"><a href="#local-6989586621682240965"><span class="hs-identifier hs-var">partialdefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stImportedPartialDefs"><span class="hs-identifier hs-type">stImportedPartialDefs</span></a></span><span>
</span><span id="line-1170"></span><span>      </span><span id="local-6989586621682240968"><span class="annot"><a href="#local-6989586621682240968"><span class="hs-identifier hs-var">opaqueblk</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueBlocks"><span class="hs-identifier hs-type">stOpaqueBlocks</span></a></span><span>
</span><span id="line-1171"></span><span>      </span><span id="local-6989586621682240971"><span class="annot"><a href="#local-6989586621682240971"><span class="hs-identifier hs-var">opaqueid</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueIds"><span class="hs-identifier hs-type">stOpaqueIds</span></a></span><span>
</span><span id="line-1172"></span><span>      </span><span id="local-6989586621682240974"><span class="annot"><a href="#local-6989586621682240974"><span class="hs-identifier hs-var">ipatsyns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getPatternSynImports"><span class="hs-identifier hs-type">getPatternSynImports</span></a></span><span>
</span><span id="line-1173"></span><span>      </span><span class="hs-comment">-- Every interface is treated in isolation. Note: Some changes to</span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-comment">-- the persistent state may not be preserved if an error other</span><span>
</span><span id="line-1175"></span><span>      </span><span class="hs-comment">-- than a type error or an IO exception is encountered in an</span><span>
</span><span id="line-1176"></span><span>      </span><span class="hs-comment">-- imported module.</span><span>
</span><span id="line-1177"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682240976"><span class="annot"><a href="#local-6989586621682240976"><span class="hs-identifier hs-var">mi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682240977"><span class="annot"><a href="#local-6989586621682240977"><span class="hs-identifier hs-var">newDecodedModules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">either</span></span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span> </span><span class="annot"><span class="hs-identifier">pure</span></span><span> </span><span class="annot"><span class="hs-operator">=&lt;&lt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1178"></span><span>           </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#withoutCache"><span class="hs-identifier hs-type">withoutCache</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1179"></span><span>           </span><span class="hs-comment">-- The cache should not be used for an imported module, and it</span><span>
</span><span id="line-1180"></span><span>           </span><span class="hs-comment">-- should be restored after the module has been type-checked</span><span>
</span><span id="line-1181"></span><span>           </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#freshTCM"><span class="hs-identifier hs-type">freshTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1182"></span><span>             </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-type">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682240982"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682240982"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682240982"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1183"></span><span>                              </span><span class="hs-comment">-- Andreas, 2014-08-18:</span><span>
</span><span id="line-1184"></span><span>                              </span><span class="hs-comment">-- Preserve the range of import statement</span><span>
</span><span id="line-1185"></span><span>                              </span><span class="hs-comment">-- for reporting termination errors in</span><span>
</span><span id="line-1186"></span><span>                              </span><span class="hs-comment">-- imported modules:</span><span>
</span><span id="line-1187"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envRange"><span class="hs-identifier hs-var">envRange</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240941"><span class="hs-identifier hs-type">range</span></a></span><span>
</span><span id="line-1188"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCall"><span class="hs-identifier hs-var">envCall</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240943"><span class="hs-identifier hs-type">call</span></a></span><span>
</span><span id="line-1189"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envImportStack"><span class="hs-identifier hs-var">envImportStack</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682240938"><span class="hs-identifier hs-type">ms</span></a></span><span>
</span><span id="line-1190"></span><span>                            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1191"></span><span>               </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#setDecodedModules"><span class="hs-identifier hs-type">setDecodedModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240947"><span class="hs-identifier hs-type">ds</span></a></span><span>
</span><span id="line-1192"></span><span>               </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#setCommandLineOptions"><span class="hs-identifier hs-type">setCommandLineOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240948"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-1193"></span><span>               </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#setVisitedModules"><span class="hs-identifier hs-type">setVisitedModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240945"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-1194"></span><span>               </span><span class="annot"><a href="Agda.Interaction.Imports.html#addImportedThings"><span class="hs-identifier hs-type">addImportedThings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240949"><span class="hs-identifier hs-type">isig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240952"><span class="hs-identifier hs-type">metas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240955"><span class="hs-identifier hs-type">ibuiltin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240974"><span class="hs-identifier hs-type">ipatsyns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240958"><span class="hs-identifier hs-type">display</span></a></span><span>
</span><span id="line-1195"></span><span>                 </span><span class="annot"><a href="#local-6989586621682240962"><span class="hs-identifier hs-type">userwarn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240965"><span class="hs-identifier hs-type">partialdefs</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240968"><span class="hs-identifier hs-type">opaqueblk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240971"><span class="hs-identifier hs-type">opaqueid</span></a></span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span>               </span><span id="local-6989586621682240984"><span class="annot"><a href="#local-6989586621682240984"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-type">createInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240934"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240935"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-type">NotMainInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240936"><span class="hs-identifier hs-type">msrc</span></a></span><span>
</span><span id="line-1198"></span><span>               </span><span id="local-6989586621682240985"><span class="annot"><a href="#local-6989586621682240985"><span class="hs-identifier hs-var">ds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getDecodedModules"><span class="hs-identifier hs-type">getDecodedModules</span></a></span><span>
</span><span id="line-1199"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682240984"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682240985"><span class="hs-identifier hs-type">ds'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#setDecodedModules"><span class="hs-identifier hs-type">setDecodedModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240977"><span class="hs-identifier hs-type">newDecodedModules</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>      </span><span class="hs-comment">-- We skip the file which has just been type-checked to</span><span>
</span><span id="line-1204"></span><span>      </span><span class="hs-comment">-- be able to forget some of the local state from</span><span>
</span><span id="line-1205"></span><span>      </span><span class="hs-comment">-- checking the module.</span><span>
</span><span id="line-1206"></span><span>      </span><span class="hs-comment">-- Note that this doesn't actually read the interface</span><span>
</span><span id="line-1207"></span><span>      </span><span class="hs-comment">-- file, only the cached interface. (This comment is not</span><span>
</span><span id="line-1208"></span><span>      </span><span class="hs-comment">-- correct, see</span><span>
</span><span id="line-1209"></span><span>      </span><span class="hs-comment">-- test/Fail/customised/NestedProjectRoots.err.)</span><span>
</span><span id="line-1210"></span><span>      </span><span id="local-6989586621682240986"><span class="annot"><a href="#local-6989586621682240986"><span class="hs-identifier hs-var">validated</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">runExceptT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#loadDecodedModule"><span class="hs-identifier hs-type">loadDecodedModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240935"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240976"><span class="hs-identifier hs-type">mi</span></a></span><span>
</span><span id="line-1211"></span><span>
</span><span id="line-1212"></span><span>      </span><span class="hs-comment">-- NOTE: This attempts to type-check FOREVER if for some</span><span>
</span><span id="line-1213"></span><span>      </span><span class="hs-comment">-- reason it continually fails to validate interface.</span><span>
</span><span id="line-1214"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240987"><span class="annot"><a href="#local-6989586621682240987"><span class="hs-identifier hs-var hs-var">recheckOnError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682240988"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240988"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1215"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to validate just-loaded interface: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240988"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1216"></span><span>            </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; SourceFile -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterfaceIsolated"><span class="hs-identifier hs-var">createInterfaceIsolated</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240934"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682240935"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682240936"><span class="hs-identifier hs-var">msrc</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">either</span></span><span> </span><span class="annot"><a href="#local-6989586621682240987"><span class="hs-identifier hs-type">recheckOnError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682240986"><span class="hs-identifier hs-type">validated</span></a></span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span class="annot"><span class="hs-comment">-- | Formats and outputs the &quot;Checking&quot;, &quot;Finished&quot; and &quot;Loading &quot; messages.</span></span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-type">chaseMsg</span></a></span><span>
</span><span id="line-1224"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ The prefix, like @Checking@, @Finished@, @Loading @.</span></span><span>
</span><span id="line-1225"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ The module name.</span></span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Optionally: the file name.</span></span><span>
</span><span id="line-1227"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span id="chaseMsg"><span class="annot"><span class="annottext">chaseMsg :: [Char] -&gt; TopLevelModuleName -&gt; Maybe [Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-var hs-var">chaseMsg</span></a></span></span><span> </span><span id="local-6989586621682240990"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240990"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621682240991"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682240991"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682240992"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621682240992"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1229"></span><span>  </span><span id="local-6989586621682240993"><span class="annot"><a href="#local-6989586621682240993"><span class="hs-identifier hs-var">indentation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; [Char]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-operator hs-var">`replicate`</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Char]) -&gt; TCMT IO Int -&gt; TCMT IO [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Int) -&gt; TCMT IO Int
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (TCEnv -&gt; Int) -&gt; TCEnv -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TopLevelModuleName] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; Int)
-&gt; (TCEnv -&gt; [TopLevelModuleName]) -&gt; TCEnv -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; [TopLevelModuleName]
</span><a href="Agda.TypeChecking.Monad.Base.html#envImportStack"><span class="hs-identifier hs-var">envImportStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>  </span><span id="local-6989586621682240997"><span class="annot"><a href="#local-6989586621682240997"><span class="hs-identifier hs-var">traceImports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Types.html#optTraceImports"><span class="hs-identifier hs-var">optTraceImports</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-type">commandLineOptions</span></a></span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682240999"><span class="annot"><a href="#local-6989586621682240999"><span class="hs-identifier hs-var hs-var">maybeFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; ShowS -&gt; [Char]
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621682240992"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; [Char]) -&gt; ShowS -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682241001"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241001"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; (&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241001"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;).&quot;</span></span><span>
</span><span id="line-1232"></span><span>      </span><span id="local-6989586621682241002"><span class="annot"><a href="#local-6989586621682241002"><span class="hs-identifier hs-var hs-var">vLvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240990"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking&quot;</span></span><span>
</span><span id="line-1233"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682240997"><span class="hs-identifier hs-var">traceImports</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1234"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240990"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Finished&quot;</span></span><span>
</span><span id="line-1235"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682240997"><span class="hs-identifier hs-var">traceImports</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1236"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-identifier hs-var">List.isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Loading&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682240990"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-1237"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682240997"><span class="hs-identifier hs-var">traceImports</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1238"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1239"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-type">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.chase&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682241002"><span class="hs-identifier hs-type">vLvl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span>
</span><span id="line-1240"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621682240993"><span class="hs-identifier hs-type">indentation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682240990"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682240991"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682240999"><span class="hs-identifier hs-type">maybeFile</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span class="annot"><span class="hs-comment">-- | Print the highlighting information contained in the given interface.</span></span><span>
</span><span id="line-1243"></span><span>
</span><span id="line-1244"></span><span class="annot"><a href="Agda.Interaction.Imports.html#highlightFromInterface"><span class="hs-identifier hs-type">highlightFromInterface</span></a></span><span>
</span><span id="line-1245"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1246"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>
</span><span id="line-1247"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The corresponding file.</span></span><span>
</span><span id="line-1248"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span id="highlightFromInterface"><span class="annot"><span class="annottext">highlightFromInterface :: Interface -&gt; SourceFile -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#highlightFromInterface"><span class="hs-identifier hs-var hs-var">highlightFromInterface</span></a></span></span><span> </span><span id="local-6989586621682241005"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241005"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682241006"><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682241006"><span class="hs-identifier hs-var">sf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1250"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1251"></span><span>    </span><span id="local-6989586621682241007"><span class="annot"><a href="#local-6989586621682241007"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCMT IO AbsolutePath
forall (m :: * -&gt; *). MonadFileId m =&gt; SourceFile -&gt; m AbsolutePath
</span><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682241006"><span class="hs-identifier hs-var">sf</span></a></span><span>
</span><span id="line-1252"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">P.text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Generating syntax info for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-type">filePath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241007"><span class="hs-identifier hs-type">file</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-1253"></span><span>      </span><span class="annot"><span class="hs-string">&quot; (read from interface).&quot;</span></span><span>
</span><span id="line-1254"></span><span>  </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTrace m =&gt;
RemoveTokenBasedHighlighting -&gt; HighlightingInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-var">printHighlightingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveTokenBasedHighlighting
</span><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-var">KeepHighlighting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iHighlighting"><span class="hs-identifier hs-var">iHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241005"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span class="annot"><span class="hs-comment">-- | Read interface file corresponding to a module.</span></span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span class="annot"><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier hs-type">readInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#InterfaceFile"><span class="hs-identifier hs-type">InterfaceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span id="readInterface"><span class="annot"><span class="annottext">readInterface :: InterfaceFile -&gt; TCMT IO (Maybe Interface)
</span><a href="Agda.Interaction.Imports.html#readInterface"><span class="hs-identifier hs-var hs-var">readInterface</span></a></span></span><span> </span><span id="local-6989586621682241010"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621682241010"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1260"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241011"><span class="annot"><span class="annottext">ifp :: [Char]
</span><a href="#local-6989586621682241011"><span class="hs-identifier hs-var hs-var hs-var">ifp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621682241010"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-1261"></span><span>    </span><span id="local-6989586621682241012"><span class="annot"><a href="#local-6989586621682241012"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe ByteString) -&gt; TCMT IO (Maybe ByteString)
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ByteString) -&gt; TCMT IO (Maybe ByteString))
-&gt; IO (Maybe ByteString) -&gt; TCMT IO (Maybe ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString)
-&gt; IO ByteString -&gt; IO (Maybe ByteString)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241011"><span class="hs-identifier hs-var">ifp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe ByteString)
-&gt; (TCErr -&gt; TCMT IO (Maybe ByteString))
-&gt; TCMT IO (Maybe ByteString)
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1262"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682241016"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682241016"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1263"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;IO exception: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682241016"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1264"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; TCMT IO (Maybe ByteString)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-comment">-- Work-around for file locking bug.</span><span>
</span><span id="line-1265"></span><span>                         </span><span class="hs-comment">-- TODO: What does this refer to? Please</span><span>
</span><span id="line-1266"></span><span>                         </span><span class="hs-comment">-- document.</span><span>
</span><span id="line-1267"></span><span>      </span><span id="local-6989586621682241017"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682241017"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO (Maybe ByteString)
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682241017"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1268"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682241012"><span class="hs-identifier hs-type">bstr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1269"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682241018"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682241018"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT (TCMT IO) Interface -&gt; TCMT IO (Maybe Interface)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interface -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-var">constructIScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Interface)
-&gt; MaybeT (TCMT IO) Interface -&gt; MaybeT (TCMT IO) Interface
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; MaybeT (TCMT IO) Interface
</span><a href="Agda.TypeChecking.Serialise.html#decodeInterface"><span class="hs-identifier hs-var">decodeInterface</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682241018"><span class="hs-identifier hs-var">bstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>      </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Interface -&gt; TCMT IO (Maybe Interface)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe Interface
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1271"></span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span class="hs-comment">-- | Writes the given interface to the given file.</span><span>
</span><span id="line-1274"></span><span class="hs-comment">--</span><span>
</span><span id="line-1275"></span><span class="hs-comment">-- The written interface is decoded and returned.</span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span class="annot"><a href="Agda.Interaction.Imports.html#writeInterface"><span class="hs-identifier hs-type">writeInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html#AbsolutePath"><span class="hs-identifier hs-type">AbsolutePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1278"></span><span id="writeInterface"><span class="annot"><span class="annottext">writeInterface :: AbsolutePath -&gt; Interface -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#writeInterface"><span class="hs-identifier hs-var hs-var">writeInterface</span></a></span></span><span> </span><span id="local-6989586621682241022"><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682241022"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621682241023"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241023"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241024"><span class="annot"><span class="annottext">fp :: [Char]
</span><a href="#local-6989586621682241024"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682241022"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1279"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.write&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>  </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1280"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Writing interface file &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241024"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1281"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-07-13</span><span>
</span><span id="line-1282"></span><span>    </span><span class="hs-comment">-- After QName memoization (AIM XXI), scope serialization might be cheap enough.</span><span>
</span><span id="line-1283"></span><span>    </span><span class="hs-comment">-- -- Andreas, Makoto, 2014-10-18 AIM XX:</span><span>
</span><span id="line-1284"></span><span>    </span><span class="hs-comment">-- -- iInsideScope is bloating the interface files, so we do not serialize it?</span><span>
</span><span id="line-1285"></span><span>    </span><span class="hs-comment">-- i &lt;- return $</span><span>
</span><span id="line-1286"></span><span>    </span><span class="hs-comment">--   i { iInsideScope  = emptyScopeInfo</span><span>
</span><span id="line-1287"></span><span>    </span><span class="hs-comment">--     }</span><span>
</span><span id="line-1288"></span><span>    </span><span class="hs-comment">-- [Old: Andreas, 2016-02-02 this causes issue #1804, so don't do it:]</span><span>
</span><span id="line-1289"></span><span>    </span><span class="hs-comment">-- Andreas, 2020-05-13, #1804, #4647: removed private declarations</span><span>
</span><span id="line-1290"></span><span>    </span><span class="hs-comment">-- only when we actually write the interface.</span><span>
</span><span id="line-1291"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1292"></span><span>      </span><span id="local-6989586621682241025"><span class="annot"><span class="annottext">filteredIface :: Interface
</span><a href="#local-6989586621682241025"><span class="hs-identifier hs-var hs-var hs-var">filteredIface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241023"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#withoutPrivates"><span class="hs-identifier hs-type">withoutPrivates</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241023"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1293"></span><span>    </span><span id="local-6989586621682241028"><span class="annot"><a href="#local-6989586621682241028"><span class="hs-identifier hs-var">filteredIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
</span><a href="Agda.TypeChecking.InstanceArguments.html#pruneTemporaryInstances"><span class="hs-identifier hs-var">pruneTemporaryInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241025"><span class="hs-identifier hs-var">filteredIface</span></a></span><span>
</span><span id="line-1294"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.write&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1295"></span><span>      </span><span class="annot"><span class="hs-string">&quot;Writing interface file with hash &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-type">iFullHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241028"><span class="hs-identifier hs-type">filteredIface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1296"></span><span>    </span><span id="local-6989586621682241030"><span class="annot"><a href="#local-6989586621682241030"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#encodeFile"><span class="hs-identifier hs-type">encodeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241024"><span class="hs-identifier hs-type">fp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241028"><span class="hs-identifier hs-type">filteredIface</span></a></span><span>
</span><span id="line-1297"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.write&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Wrote interface file.&quot;</span></span><span>
</span><span id="line-1298"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682241030"><span class="hs-identifier hs-type">iface</span></a></span><span>
</span><span id="line-1299"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Interface
-&gt; (TCErr -&gt; TCMT IO Interface) -&gt; TCMT IO Interface
forall a. TCMT IO a -&gt; (TCErr -&gt; TCMT IO a) -&gt; TCMT IO a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682241031"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682241031"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1300"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#alwaysReportSLn"><span class="hs-identifier hs-var">alwaysReportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1301"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to write interface &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241024"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1302"></span><span>    </span><span class="hs-comment">-- Andreas, 2025-09-12, issue #8098, don't delete when writing failed on a readonly file.</span><span>
</span><span id="line-1303"></span><span>    </span><span class="hs-comment">-- Only delete file when disk is full or Agda had an internal error during serialization.</span><span>
</span><span id="line-1304"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682241031"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1305"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682241032"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682241032"><span class="hs-identifier hs-var">ioe</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><span class="hs-identifier hs-var">isUserError</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682241032"><span class="hs-identifier hs-var">ioe</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><span class="hs-identifier hs-var">isFullError</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682241032"><span class="hs-identifier hs-var">ioe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1307"></span><span>      </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; TCM ()
forall a. IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TCM ()) -&gt; IO () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241024"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">removeFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241024"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-1308"></span><span>    </span><span class="annot"><span class="annottext">TCErr -&gt; TCMT IO Interface
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682241031"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span class="hs-comment">-- | Tries to type check a module and write out its interface. The</span><span>
</span><span id="line-1311"></span><span class="hs-comment">-- function only writes out an interface file if it does not encounter</span><span>
</span><span id="line-1312"></span><span class="hs-comment">-- any warnings.</span><span>
</span><span id="line-1313"></span><span class="hs-comment">--</span><span>
</span><span id="line-1314"></span><span class="hs-comment">-- If appropriate this function writes out syntax highlighting</span><span>
</span><span id="line-1315"></span><span class="hs-comment">-- information.</span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span class="annot"><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-type">createInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1318"></span><span>     </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The expected module name.</span></span><span>
</span><span id="line-1319"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ The file to type check.</span></span><span>
</span><span id="line-1320"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Are we dealing with the main module?</span></span><span>
</span><span id="line-1321"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Optional information about the source code.</span></span><span>
</span><span id="line-1322"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1323"></span><span id="createInterface"><span class="annot"><span class="annottext">createInterface :: TopLevelModuleName
-&gt; SourceFile -&gt; MainInterface -&gt; Maybe Source -&gt; TCM ModuleInfo
</span><a href="Agda.Interaction.Imports.html#createInterface"><span class="hs-identifier hs-var hs-var">createInterface</span></a></span></span><span> </span><span id="local-6989586621682241034"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241034"><span class="hs-identifier hs-var">mname</span></a></span></span><span> </span><span id="local-6989586621682241035"><span class="annot"><span class="annottext">sf :: SourceFile
</span><a href="#local-6989586621682241035"><span class="hs-identifier hs-var">sf</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#SourceFile"><span class="hs-identifier hs-type">SourceFile</span></a></span><span> </span><span id="local-6989586621682241036"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621682241036"><span class="hs-identifier hs-var">sfi</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682241037"><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682241037"><span class="hs-identifier hs-var">isMain</span></a></span></span><span> </span><span id="local-6989586621682241038"><span class="annot"><span class="annottext">Maybe Source
</span><a href="#local-6989586621682241038"><span class="hs-identifier hs-var">msrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1324"></span><span>  </span><span id="local-6989586621682241039"><span class="annot"><a href="#local-6989586621682241039"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SourceFile -&gt; TCMT IO AbsolutePath
forall (m :: * -&gt; *). MonadFileId m =&gt; SourceFile -&gt; m AbsolutePath
</span><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-var">srcFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682241035"><span class="hs-identifier hs-var">sf</span></a></span><span>
</span><span id="line-1325"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1326"></span><span>    </span><span id="local-6989586621682241040"><span class="annot"><a href="#local-6989586621682241040"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">AbsolutePath
</span><a href="#local-6989586621682241039"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-1327"></span><span>    </span><span id="local-6989586621682241041"><span class="annot"><a href="#local-6989586621682241041"><span class="hs-identifier hs-var hs-var">onlyScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleScopeChecked"><span class="hs-identifier hs-var">ModuleScopeChecked</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCheckMode -&gt; ModuleCheckMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MainInterface -&gt; ModuleCheckMode
</span><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-var">moduleCheckMode</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682241037"><span class="hs-identifier hs-var">isMain</span></a></span><span>
</span><span id="line-1328"></span><span>    </span><span id="local-6989586621682241042"><span class="annot"><a href="#local-6989586621682241042"><span class="hs-identifier hs-var hs-var">checkMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682241041"><span class="hs-identifier hs-var">onlyScope</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reading &quot;</span></span><span>
</span><span id="line-1329"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking&quot;</span></span><span>
</span><span id="line-1330"></span><span>    </span><span id="local-6989586621682241043"><span class="annot"><a href="#local-6989586621682241043"><span class="hs-identifier hs-var hs-var">withMsgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; (() -&gt; TCM ()) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; TopLevelModuleName -&gt; Maybe [Char] -&gt; TCM ()
</span><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-var">chaseMsg</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241042"><span class="hs-identifier hs-var">checkMsg</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241034"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Char] -&gt; TCM ()) -&gt; Maybe [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241040"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((() -&gt; TCM ()) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo)
-&gt; (() -&gt; TCM ()) -&gt; TCM ModuleInfo -&gt; TCM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; () -&gt; TCM ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; () -&gt; TCM ()) -&gt; TCM () -&gt; () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1331"></span><span>      </span><span id="local-6989586621682241045"><span class="annot"><a href="#local-6989586621682241045"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichWarnings -&gt; TCMT IO (Set TCWarning)
forall (m :: * -&gt; *).
(MonadWarning m, MonadTCM m) =&gt;
WhichWarnings -&gt; m (Set TCWarning)
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarnings"><span class="hs-identifier hs-var">getAllWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WhichWarnings
</span><a href="Agda.TypeChecking.Warnings.html#AllWarnings"><span class="hs-identifier hs-var">AllWarnings</span></a></span><span>
</span><span id="line-1332"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241048"><span class="annot"><a href="#local-6989586621682241048"><span class="hs-identifier hs-var hs-var">classified</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; WarningsAndNonFatalErrors
</span><a href="Agda.TypeChecking.Warnings.html#classifyWarnings"><span class="hs-identifier hs-var">classifyWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">([TCWarning] -&gt; WarningsAndNonFatalErrors)
-&gt; [TCWarning] -&gt; WarningsAndNonFatalErrors
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; [TCWarning]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toAscList</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682241045"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-1333"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Imports.html#reportWarningsForModule"><span class="hs-identifier hs-type">reportWarningsForModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#tcWarnings"><span class="hs-identifier hs-var">tcWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241048"><span class="hs-identifier hs-type">classified</span></a></span><span>
</span><span id="line-1334"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#nonFatalErrors"><span class="hs-identifier hs-var">nonFatalErrors</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241048"><span class="hs-identifier hs-type">classified</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#chaseMsg"><span class="hs-identifier hs-type">chaseMsg</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Finished&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span>  </span><span class="annot"><a href="#local-6989586621682241043"><span class="hs-identifier hs-type">withMsgs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#TopModule"><span class="hs-identifier hs-type">Bench.TopModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-type">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682241053"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682241053"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682241053"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCurrentPath"><span class="hs-identifier hs-var">envCurrentPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682241036"><span class="hs-identifier hs-type">sfi</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1337"></span><span>
</span><span id="line-1338"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1339"></span><span>      </span><span class="annot"><span class="hs-string">&quot;Creating interface for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;...&quot;</span></span><span>
</span><span id="line-1340"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-type">verboseS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1341"></span><span>      </span><span id="local-6989586621682241055"><span class="annot"><a href="#local-6989586621682241055"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Imports.html#getPrettyVisitedModules"><span class="hs-identifier hs-type">getPrettyVisitedModules</span></a></span><span>
</span><span id="line-1342"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  visited: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682241055"><span class="hs-identifier hs-type">visited</span></a></span><span>
</span><span id="line-1343"></span><span>
</span><span id="line-1344"></span><span>    </span><span id="local-6989586621682241056"><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#parseSource"><span class="hs-identifier hs-type">parseSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241035"><span class="hs-identifier hs-type">sf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682241038"><span class="hs-identifier hs-type">msrc</span></a></span><span>
</span><span id="line-1345"></span><span>
</span><span id="line-1346"></span><span>    </span><span id="local-6989586621682241057"><span class="annot"><a href="#local-6989586621682241057"><span class="hs-identifier hs-var">srcPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#srcFilePath"><span class="hs-identifier hs-type">srcFilePath</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-1347"></span><span>
</span><span id="line-1348"></span><span>    </span><span id="local-6989586621682241058"><span class="annot"><a href="#local-6989586621682241058"><span class="hs-identifier hs-var">fileTokenInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-type">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1349"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#generateTokenInfoFromSource"><span class="hs-identifier hs-type">generateTokenInfoFromSource</span></a></span><span>
</span><span id="line-1350"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682241060"><span class="annot"><a href="#local-6989586621682241060"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241056"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1351"></span><span>         </span><span class="annot"><a href="Agda.Syntax.Position.html#mkRangeFile"><span class="hs-identifier hs-type">mkRangeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241057"><span class="hs-identifier hs-type">srcPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682241060"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1352"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TL.unpack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-type">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1353"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTokens"><span class="hs-identifier hs-type">stTokens</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-type">`modifyTCLens`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fileTokenInfo</span></span><span> </span><span class="annot"><span class="hs-operator">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span>    </span><span class="hs-comment">-- Only check consistency if not main (we check consistency for the main module in</span><span>
</span><span id="line-1356"></span><span>    </span><span class="hs-comment">-- `typeCheckMain`.</span><span>
</span><span id="line-1357"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241064"><span class="annot"><a href="#local-6989586621682241064"><span class="hs-identifier hs-var hs-var">checkConsistency</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="#local-6989586621682241037"><span class="hs-identifier hs-var">isMain</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1358"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1359"></span><span>    </span><span class="annot"><a href="Agda.Interaction.Imports.html#setOptionsFromSourcePragmas"><span class="hs-identifier hs-type">setOptionsFromSourcePragmas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241064"><span class="hs-identifier hs-type">checkConsistency</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-1360"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#checkAttributes"><span class="hs-identifier hs-type">checkAttributes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#srcAttributes"><span class="hs-identifier hs-var">srcAttributes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-type">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1361"></span><span>    </span><span id="local-6989586621682241065"><span class="annot"><a href="#local-6989586621682241065"><span class="hs-identifier hs-var">syntactic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optSyntacticEquality"><span class="hs-identifier hs-type">optSyntacticEquality</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span>
</span><span id="line-1362"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-type">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682241067"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682241067"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682241067"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envSyntacticEqualityFuel"><span class="hs-identifier hs-var">envSyntacticEqualityFuel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682241065"><span class="hs-identifier hs-type">syntactic</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1363"></span><span>
</span><span id="line-1364"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-type">verboseS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1365"></span><span>      </span><span id="local-6989586621682241069"><span class="annot"><a href="#local-6989586621682241069"><span class="hs-identifier hs-var">nestingLevel</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pred</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envImportStack"><span class="hs-identifier hs-var">envImportStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>      </span><span id="local-6989586621682241070"><span class="annot"><a href="#local-6989586621682241070"><span class="hs-identifier hs-var">highlightingLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envHighlightingLevel"><span class="hs-identifier hs-var">envHighlightingLevel</span></a></span><span>
</span><span id="line-1367"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">unlines</span></span><span>
</span><span id="line-1368"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;  nesting      level: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682241069"><span class="hs-identifier hs-type">nestingLevel</span></a></span><span>
</span><span id="line-1369"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  highlighting level: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682241070"><span class="hs-identifier hs-type">highlightingLevel</span></a></span><span>
</span><span id="line-1370"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1371"></span><span>
</span><span id="line-1372"></span><span>    </span><span class="hs-comment">-- Scope checking.</span><span>
</span><span id="line-1373"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Starting scope checking.&quot;</span></span><span>
</span><span id="line-1374"></span><span>    </span><span id="local-6989586621682241072"><span class="annot"><a href="#local-6989586621682241072"><span class="hs-identifier hs-var">topLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Scoping"><span class="hs-identifier hs-type">Bench.Scoping</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1375"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241074"><span class="annot"><a href="#local-6989586621682241074"><span class="hs-identifier hs-var hs-var">topDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Declaration]
</span><a href="Agda.Syntax.Concrete.html#modDecls"><span class="hs-identifier hs-var">C.modDecls</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; [Declaration]) -&gt; Module -&gt; [Declaration]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Source -&gt; Module
</span><a href="Agda.Interaction.Imports.html#srcModule"><span class="hs-identifier hs-var">srcModule</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241056"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1376"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#concreteToAbstract_"><span class="hs-identifier hs-type">concreteToAbstract_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevel"><span class="hs-identifier hs-type">TopLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#srcOrigin"><span class="hs-identifier hs-var">srcOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-type">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241074"><span class="hs-identifier hs-type">topDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1377"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Finished scope checking.&quot;</span></span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241076"><span class="annot"><a href="#local-6989586621682241076"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; [Declaration]
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelDecls"><span class="hs-identifier hs-var">topLevelDecls</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621682241072"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1380"></span><span>        </span><span id="local-6989586621682241077"><span class="annot"><a href="#local-6989586621682241077"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelScope"><span class="hs-identifier hs-var">topLevelScope</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621682241072"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1381"></span><span>
</span><span id="line-1382"></span><span>    </span><span class="hs-comment">-- Highlighting from scope checker.</span><span>
</span><span id="line-1383"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.highlight&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Starting highlighting from scope.&quot;</span></span><span>
</span><span id="line-1384"></span><span>    </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-type">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1385"></span><span>      </span><span class="hs-comment">-- Generate and print approximate syntax highlighting info.</span><span>
</span><span id="line-1386"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-type">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1387"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-type">printHighlightingInfo</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-type">KeepHighlighting</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241058"><span class="hs-identifier hs-type">fileTokenInfo</span></a></span><span>
</span><span id="line-1388"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIsOr"><span class="hs-identifier hs-type">ifTopLevelAndHighlightingLevelIsOr</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241041"><span class="hs-identifier hs-type">onlyScope</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1389"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682241079"><span class="annot"><span class="annottext">Declaration
</span><a href="#local-6989586621682241079"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Declaration -&gt; Level -&gt; Bool -&gt; TCM ()
</span><a href="Agda.Interaction.Highlighting.Generate.html#generateAndPrintSyntaxInfo"><span class="hs-identifier hs-var">generateAndPrintSyntaxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration
</span><a href="#local-6989586621682241079"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="Agda.Interaction.Highlighting.Generate.html#Partial"><span class="hs-identifier hs-var">Partial</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682241041"><span class="hs-identifier hs-var">onlyScope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682241076"><span class="hs-identifier hs-type">ds</span></a></span><span>
</span><span id="line-1390"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.highlight&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Finished highlighting from scope.&quot;</span></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>
</span><span id="line-1393"></span><span>    </span><span class="hs-comment">-- Type checking.</span><span>
</span><span id="line-1394"></span><span>
</span><span id="line-1395"></span><span>    </span><span class="hs-comment">-- Now that all the options are in we can check if caching should</span><span>
</span><span id="line-1396"></span><span>    </span><span class="hs-comment">-- be on.</span><span>
</span><span id="line-1397"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#activateLoadedFileCache"><span class="hs-identifier hs-type">activateLoadedFileCache</span></a></span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span>    </span><span class="hs-comment">-- invalidate cache if pragmas change, TODO move</span><span>
</span><span id="line-1400"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#cachingStarts"><span class="hs-identifier hs-type">cachingStarts</span></a></span><span>
</span><span id="line-1401"></span><span>    </span><span id="local-6989586621682241084"><span class="annot"><a href="#local-6989586621682241084"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-type">stPragmaOptions</span></a></span><span>
</span><span id="line-1402"></span><span>    </span><span id="local-6989586621682241087"><span class="annot"><a href="#local-6989586621682241087"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#readFromCachedLog"><span class="hs-identifier hs-type">readFromCachedLog</span></a></span><span>
</span><span id="line-1403"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682241087"><span class="hs-identifier hs-type">me</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1404"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Pragmas"><span class="hs-identifier hs-type">Pragmas</span></a></span><span> </span><span id="local-6989586621682241090"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682241090"><span class="hs-identifier hs-var">opts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PostScopeState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682241084"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions -&gt; PragmaOptions -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682241090"><span class="hs-identifier hs-var">opts'</span></a></span><span>
</span><span id="line-1405"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1406"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1407"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cache&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;pragma changed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeCheckAction, PostScopeState)
</span><a href="#local-6989586621682241087"><span class="hs-identifier hs-var">me</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1408"></span><span>        </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). (MonadDebug m, MonadTCState m) =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Caching.html#cleanCachedLog"><span class="hs-identifier hs-var">cleanCachedLog</span></a></span><span>
</span><span id="line-1409"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#writeToCurrentLog"><span class="hs-identifier hs-type">writeToCurrentLog</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Pragmas"><span class="hs-identifier hs-type">Pragmas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241084"><span class="hs-identifier hs-type">opts</span></a></span><span>
</span><span id="line-1410"></span><span>
</span><span id="line-1411"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682241041"><span class="hs-identifier hs-type">onlyScope</span></a></span><span>
</span><span id="line-1412"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1413"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Skipping type checking.&quot;</span></span><span>
</span><span id="line-1414"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#cacheCurrentLog"><span class="hs-identifier hs-type">cacheCurrentLog</span></a></span><span>
</span><span id="line-1415"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1416"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Starting type checking.&quot;</span></span><span>
</span><span id="line-1417"></span><span>        </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-type">Bench.Typing</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html#checkDeclCached"><span class="hs-identifier hs-type">checkDeclCached</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241076"><span class="hs-identifier hs-type">ds</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#finally_"><span class="hs-operator hs-type">`finally_`</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Caching.html#cacheCurrentLog"><span class="hs-identifier hs-type">cacheCurrentLog</span></a></span><span>
</span><span id="line-1418"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Finished type checking.&quot;</span></span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span>    </span><span class="hs-comment">-- Ulf, 2013-11-09: Since we're rethrowing the error, leave it up to the</span><span>
</span><span id="line-1421"></span><span>    </span><span class="hs-comment">-- code that handles that error to reset the state.</span><span>
</span><span id="line-1422"></span><span>    </span><span class="hs-comment">-- Ulf, 2013-11-13: Errors are now caught and highlighted in InteractionTop.</span><span>
</span><span id="line-1423"></span><span>    </span><span class="hs-comment">-- catchError_ (checkDecls ds) $ \e -&gt; do</span><span>
</span><span id="line-1424"></span><span>    </span><span class="hs-comment">--   ifTopLevelAndHighlightingLevelIs NonInteractive $</span><span>
</span><span id="line-1425"></span><span>    </span><span class="hs-comment">--     printErrorInfo e</span><span>
</span><span id="line-1426"></span><span>    </span><span class="hs-comment">--   throwError e</span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#unfreezeMetas"><span class="hs-identifier hs-type">unfreezeMetas</span></a></span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span>    </span><span class="hs-comment">-- Profiling: Count number of metas.</span><span>
</span><span id="line-1431"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#whenProfile"><span class="hs-identifier hs-type">whenProfile</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html#Metas"><span class="hs-identifier hs-type">Profile.Metas</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1432"></span><span>      </span><span id="local-6989586621682241099"><span class="annot"><a href="#local-6989586621682241099"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#fresh"><span class="hs-identifier hs-type">fresh</span></a></span><span>
</span><span id="line-1433"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Statistics.html#tickN"><span class="hs-identifier hs-type">tickN</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;metas&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#metaId"><span class="hs-identifier hs-var">metaId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241099"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>
</span><span id="line-1435"></span><span>    </span><span class="hs-comment">-- Generate unused imports warning.</span><span>
</span><span id="line-1436"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.UnusedImports.html#warnUnusedImports"><span class="hs-identifier hs-type">warnUnusedImports</span></a></span><span>
</span><span id="line-1437"></span><span>
</span><span id="line-1438"></span><span>    </span><span class="hs-comment">-- Highlighting from type checker.</span><span>
</span><span id="line-1439"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.highlight&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Starting highlighting from type info.&quot;</span></span><span>
</span><span id="line-1440"></span><span>    </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Highlighting"><span class="hs-identifier hs-type">Bench.Highlighting</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1441"></span><span>
</span><span id="line-1442"></span><span>      </span><span class="hs-comment">-- Move any remaining token highlighting to stSyntaxInfo.</span><span>
</span><span id="line-1443"></span><span>      </span><span id="local-6989586621682241103"><span class="annot"><a href="#local-6989586621682241103"><span class="hs-identifier hs-var">toks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTokens"><span class="hs-identifier hs-type">stTokens</span></a></span><span>
</span><span id="line-1444"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-type">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1445"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#printHighlightingInfo"><span class="hs-identifier hs-type">printHighlightingInfo</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Response.Base.html#KeepHighlighting"><span class="hs-identifier hs-type">KeepHighlighting</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241103"><span class="hs-identifier hs-type">toks</span></a></span><span>
</span><span id="line-1446"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stTokens"><span class="hs-identifier hs-type">stTokens</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span>      </span><span class="hs-comment">-- Grabbing warnings and unsolved metas to highlight them</span><span>
</span><span id="line-1449"></span><span>      </span><span id="local-6989586621682241108"><span class="annot"><a href="#local-6989586621682241108"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarnings"><span class="hs-identifier hs-type">getAllWarnings</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#AllWarnings"><span class="hs-identifier hs-type">AllWarnings</span></a></span><span>
</span><span id="line-1450"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241108"><span class="hs-identifier hs-type">warnings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.highlight&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1451"></span><span>        </span><span class="annot"><span class="hs-string">&quot;collected warnings: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241108"><span class="hs-identifier hs-type">warnings</span></a></span><span>
</span><span id="line-1452"></span><span>      </span><span id="local-6989586621682241109"><span class="annot"><a href="#local-6989586621682241109"><span class="hs-identifier hs-var">unsolved</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.Warning.html#getAllUnsolvedWarnings"><span class="hs-identifier hs-type">getAllUnsolvedWarnings</span></a></span><span>
</span><span id="line-1453"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241109"><span class="hs-identifier hs-type">unsolved</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.highlight&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1454"></span><span>        </span><span class="annot"><span class="hs-string">&quot;collected unsolved: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241109"><span class="hs-identifier hs-type">unsolved</span></a></span><span>
</span><span id="line-1455"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241111"><span class="annot"><a href="#local-6989586621682241111"><span class="hs-identifier hs-var hs-var">warningInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1456"></span><span>            </span><span class="annot"><span class="annottext">HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. Convert a b =&gt; a -&gt; b
</span><a href="Agda.Interaction.Highlighting.Precise.html#convert"><span class="hs-identifier hs-var">Highlighting.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(HighlightingInfoBuilder -&gt; HighlightingInfo)
-&gt; HighlightingInfoBuilder -&gt; HighlightingInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TCWarning -&gt; HighlightingInfoBuilder)
-&gt; Set TCWarning -&gt; HighlightingInfoBuilder
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TCWarning -&gt; HighlightingInfoBuilder
</span><a href="Agda.Interaction.Highlighting.Generate.html#warningHighlighting"><span class="hs-identifier hs-var">warningHighlighting</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TCWarning -&gt; HighlightingInfoBuilder)
-&gt; Set TCWarning -&gt; HighlightingInfoBuilder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning] -&gt; Set TCWarning
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[TCWarning]
</span><a href="#local-6989586621682241109"><span class="hs-identifier hs-var">unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">Set TCWarning -&gt; Set TCWarning -&gt; Set TCWarning
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.union`</span></span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682241108"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-1457"></span><span>
</span><span id="line-1458"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stSyntaxInfo"><span class="hs-identifier hs-type">stSyntaxInfo</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-type">`modifyTCLens`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682241118"><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682241118"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682241118"><span class="hs-identifier hs-var">inf</span></a></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo -&gt; HighlightingInfo -&gt; HighlightingInfo
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682241103"><span class="hs-identifier hs-var">toks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HighlightingInfo -&gt; HighlightingInfo -&gt; HighlightingInfo
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682241111"><span class="hs-identifier hs-var">warningInfo</span></a></span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Types.html#optGenerateVimFile"><span class="hs-identifier hs-var">optGenerateVimFile</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#commandLineOptions"><span class="hs-identifier hs-type">commandLineOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1461"></span><span>        </span><span class="hs-comment">-- Generate Vim file.</span><span>
</span><span id="line-1462"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#evalWithScope"><span class="hs-identifier hs-type">evalWithScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241077"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Vim.html#generateVimFile"><span class="hs-identifier hs-type">generateVimFile</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-type">filePath</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682241057"><span class="hs-identifier hs-type">srcPath</span></a></span><span>
</span><span id="line-1463"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Finished highlighting from type info.&quot;</span></span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#setScope"><span class="hs-identifier hs-type">setScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241077"><span class="hs-identifier hs-type">scope</span></a></span><span>
</span><span id="line-1466"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;scope.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;SCOPE &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682241077"><span class="hs-identifier hs-type">scope</span></a></span><span>
</span><span id="line-1467"></span><span>
</span><span id="line-1468"></span><span>    </span><span class="hs-comment">-- TODO: It would be nice if unsolved things were highlighted</span><span>
</span><span id="line-1469"></span><span>    </span><span class="hs-comment">-- after every mutual block.</span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span>    </span><span id="local-6989586621682241123"><span class="annot"><a href="#local-6989586621682241123"><span class="hs-identifier hs-var">openMetas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#getOpenMetas"><span class="hs-identifier hs-type">getOpenMetas</span></a></span><span>
</span><span id="line-1472"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241123"><span class="hs-identifier hs-type">openMetas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1473"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.metas&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: We have unsolved metas.&quot;</span></span><span>
</span><span id="line-1474"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.metas&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#prettyGoals"><span class="hs-identifier hs-type">prettyGoals</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.BasicOps.html#getGoals"><span class="hs-identifier hs-type">getGoals</span></a></span><span>
</span><span id="line-1475"></span><span>
</span><span id="line-1476"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ifTopLevelAndHighlightingLevelIs"><span class="hs-identifier hs-type">ifTopLevelAndHighlightingLevelIs</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.Types.html#NonInteractive"><span class="hs-identifier hs-type">NonInteractive</span></a></span><span> </span><span class="annot"><a href="Agda.Interaction.Highlighting.Generate.html#printUnsolvedInfo"><span class="hs-identifier hs-type">printUnsolvedInfo</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-08-03, issue #964</span><span>
</span><span id="line-1479"></span><span>    </span><span class="hs-comment">-- When open metas are allowed,</span><span>
</span><span id="line-1480"></span><span>    </span><span class="hs-comment">-- permanently freeze them now by turning them into postulates.</span><span>
</span><span id="line-1481"></span><span>    </span><span class="hs-comment">-- This will enable serialization.</span><span>
</span><span id="line-1482"></span><span>    </span><span class="hs-comment">-- savedMetaStore &lt;- useTC stMetaStore</span><span>
</span><span id="line-1483"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Imports.html#includeStateChanges"><span class="hs-identifier hs-type">includeStateChanges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241037"><span class="hs-identifier hs-type">isMain</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1484"></span><span>      </span><span class="hs-comment">-- Andreas, 2018-11-15, re issue #3393:</span><span>
</span><span id="line-1485"></span><span>      </span><span class="hs-comment">-- We do not get here when checking the main module</span><span>
</span><span id="line-1486"></span><span>      </span><span class="hs-comment">-- (then includeStateChanges is True).</span><span>
</span><span id="line-1487"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optAllowUnsolved"><span class="hs-identifier hs-type">optAllowUnsolved</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1488"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Turning unsolved metas (if any) into postulates.&quot;</span></span><span>
</span><span id="line-1489"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#withCurrentModule"><span class="hs-identifier hs-type">withCurrentModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682241077"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier hs-type">scopeCurrent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#openMetasToPostulates"><span class="hs-identifier hs-type">openMetasToPostulates</span></a></span><span>
</span><span id="line-1490"></span><span>        </span><span class="hs-comment">-- Clear constraints as they might refer to what</span><span>
</span><span id="line-1491"></span><span>        </span><span class="hs-comment">-- they think are open metas.</span><span>
</span><span id="line-1492"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stAwakeConstraints"><span class="hs-identifier hs-type">stAwakeConstraints</span></a></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1493"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stSleepingConstraints"><span class="hs-identifier hs-type">stSleepingConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#setTCLens"><span class="hs-operator hs-type">`setTCLens`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span>    </span><span class="hs-comment">-- Serialization.</span><span>
</span><span id="line-1496"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Starting serialization.&quot;</span></span><span>
</span><span id="line-1497"></span><span>    </span><span id="local-6989586621682241137"><span class="annot"><a href="#local-6989586621682241137"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-type">Bench.Serialization</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html#BuildInterface"><span class="hs-identifier hs-type">Bench.BuildInterface</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1498"></span><span>      </span><span class="annot"><a href="Agda.Interaction.Imports.html#buildInterface"><span class="hs-identifier hs-type">buildInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241056"><span class="hs-identifier hs-type">src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241072"><span class="hs-identifier hs-type">topLevel</span></a></span><span>
</span><span id="line-1499"></span><span>
</span><span id="line-1500"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-type">reportS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">101</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1501"></span><span>      </span><span class="annot"><span class="hs-string">&quot;Signature:&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span>
</span><span id="line-1502"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unlines</span></span><span>
</span><span id="line-1503"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241141"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-1504"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  type: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241143"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  def:  &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682241144"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-1506"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1507"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682241141"><span class="annot"><a href="#local-6989586621682241141"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682241143"><span class="annot"><a href="#local-6989586621682241143"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HMap.toList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iSignature"><span class="hs-identifier hs-var">iSignature</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241137"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-type">sigDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1508"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funCompiled"><span class="hs-identifier hs-var">funCompiled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682241144"><span class="annot"><a href="#local-6989586621682241144"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241143"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1509"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1510"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Finished serialization.&quot;</span></span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span>    </span><span id="local-6989586621682241151"><span class="annot"><a href="#local-6989586621682241151"><span class="hs-identifier hs-var">mallWarnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-type">getAllWarnings'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241037"><span class="hs-identifier hs-type">isMain</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#ErrorWarnings"><span class="hs-identifier hs-type">ErrorWarnings</span></a></span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span>    </span><span id="local-6989586621682241152"><span class="annot"><a href="#local-6989586621682241152"><span class="hs-identifier hs-var">isWritingInterfaces</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#writeInterfaces"><span class="hs-identifier hs-type">writeInterfaces</span></a></span><span>
</span><span id="line-1515"></span><span>
</span><span id="line-1516"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Considering writing to interface file.&quot;</span></span><span>
</span><span id="line-1517"></span><span>    </span><span id="local-6989586621682241153"><span class="annot"><a href="#local-6989586621682241153"><span class="hs-identifier hs-var">finalIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-type">constructIScope</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241151"><span class="hs-identifier hs-type">mallWarnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682241037"><span class="hs-identifier hs-type">isMain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682241152"><span class="hs-identifier hs-type">isWritingInterfaces</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1518"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1519"></span><span>        </span><span class="hs-comment">-- Andreas, 2018-11-15, re issue #3393</span><span>
</span><span id="line-1520"></span><span>        </span><span class="hs-comment">-- The following is not sufficient to fix #3393</span><span>
</span><span id="line-1521"></span><span>        </span><span class="hs-comment">-- since the replacement of metas by postulates did not happen.</span><span>
</span><span id="line-1522"></span><span>        </span><span class="hs-comment">-- -- | not (allowUnsolved &amp;&amp; all (isUnsolvedWarning . tcWarning) allWarnings) -&gt; do</span><span>
</span><span id="line-1523"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241034"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: We have warnings, skipping writing interface file.&quot;</span></span><span>
</span><span id="line-1524"></span><span>        </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241137"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1525"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Agda.Interaction.Imports.html#ScopeCheck"><span class="hs-identifier hs-var">ScopeCheck</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1526"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241034"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: We are just scope-checking, skipping writing interface file.&quot;</span></span><span>
</span><span id="line-1527"></span><span>        </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241137"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1528"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1529"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241034"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: We are not writing any interfaces, skipping writing interface file.&quot;</span></span><span>
</span><span id="line-1530"></span><span>        </span><span class="annot"><span class="annottext">Interface -&gt; TCMT IO Interface
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241137"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1531"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Serialization"><span class="hs-identifier hs-var">Bench.Serialization</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCMT IO Interface -&gt; TCMT IO Interface)
-&gt; TCMT IO Interface -&gt; TCMT IO Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1532"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCM ()) -&gt; [Char] -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241034"><span class="hs-identifier hs-var">mname</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;: Actually calling writeInterface.&quot;</span></span><span>
</span><span id="line-1533"></span><span>        </span><span class="hs-comment">-- The file was successfully type-checked (and no warnings were</span><span>
</span><span id="line-1534"></span><span>        </span><span class="hs-comment">-- encountered), so the interface should be written out.</span><span>
</span><span id="line-1535"></span><span>        </span><span id="local-6989586621682241154"><span class="annot"><a href="#local-6989586621682241154"><span class="hs-identifier hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; SourceFile -&gt; TCMT IO AbsolutePath
SourceFile -&gt; TCMT IO AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#toIFile"><span class="hs-identifier hs-var">toIFile</span></a></span><span> </span><span class="annot"><span class="annottext">SourceFile
</span><a href="#local-6989586621682241035"><span class="hs-identifier hs-var">sf</span></a></span><span>
</span><span id="line-1536"></span><span>        </span><span id="local-6989586621682241156"><span class="annot"><a href="#local-6989586621682241156"><span class="hs-identifier hs-var">serializedIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#writeInterface"><span class="hs-identifier hs-type">writeInterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241154"><span class="hs-identifier hs-type">ifile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241137"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-1537"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface.create&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Finished writing to interface file.&quot;</span></span><span>
</span><span id="line-1538"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682241156"><span class="hs-identifier hs-type">serializedIface</span></a></span><span>
</span><span id="line-1539"></span><span>
</span><span id="line-1540"></span><span>    </span><span class="hs-comment">-- -- Restore the open metas, as we might continue in interaction mode.</span><span>
</span><span id="line-1541"></span><span>    </span><span class="hs-comment">-- Actually, we do not serialize the metas if checking the MainInterface</span><span>
</span><span id="line-1542"></span><span>    </span><span class="hs-comment">-- stMetaStore `setTCLens` savedMetaStore</span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span>    </span><span class="hs-comment">-- Profiling: Print statistics.</span><span>
</span><span id="line-1545"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Statistics.html#printStatistics"><span class="hs-identifier hs-type">printStatistics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Statistics.html#getStatistics"><span class="hs-identifier hs-type">getStatistics</span></a></span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span>    </span><span class="hs-comment">-- Get the statistics of the current module</span><span>
</span><span id="line-1548"></span><span>    </span><span class="hs-comment">-- and add it to the accumulated statistics.</span><span>
</span><span id="line-1549"></span><span>    </span><span id="local-6989586621682241159"><span class="annot"><a href="#local-6989586621682241159"><span class="hs-identifier hs-var">localStatistics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Statistics.html#getStatistics"><span class="hs-identifier hs-type">getStatistics</span></a></span><span>
</span><span id="line-1550"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#lensAccumStatistics"><span class="hs-identifier hs-type">lensAccumStatistics</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens%27"><span class="hs-operator hs-type">`modifyTCLens'`</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">(&lt;&gt;)</span></span><span> </span><span class="annot"><a href="#local-6989586621682241159"><span class="hs-identifier hs-type">localStatistics</span></a></span><span>
</span><span id="line-1551"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241034"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: Added statistics to the accumulated statistics.&quot;</span></span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span>    </span><span id="local-6989586621682241164"><span class="annot"><a href="#local-6989586621682241164"><span class="hs-identifier hs-var">isPrimitiveMod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#isPrimitiveModule"><span class="hs-identifier hs-type">isPrimitiveModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241036"><span class="hs-identifier hs-type">sfi</span></a></span><span>
</span><span id="line-1554"></span><span>
</span><span id="line-1555"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a></span><span>
</span><span id="line-1556"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miInterface"><span class="hs-identifier hs-var">miInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682241153"><span class="hs-identifier hs-type">finalIface</span></a></span><span>
</span><span id="line-1557"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miWarnings"><span class="hs-identifier hs-var">miWarnings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682241151"><span class="hs-identifier hs-type">mallWarnings</span></a></span><span>
</span><span id="line-1558"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miPrimitive"><span class="hs-identifier hs-var">miPrimitive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682241164"><span class="hs-identifier hs-type">isPrimitiveMod</span></a></span><span>
</span><span id="line-1559"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miMode"><span class="hs-identifier hs-var">miMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleCheckMode"><span class="hs-identifier hs-type">moduleCheckMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241037"><span class="hs-identifier hs-type">isMain</span></a></span><span>
</span><span id="line-1560"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#miSourceFile"><span class="hs-identifier hs-var">miSourceFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682241035"><span class="hs-identifier hs-type">sf</span></a></span><span>
</span><span id="line-1561"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span class="hs-comment">-- | Expert version of 'getAllWarnings'; if 'isMain' is a</span><span>
</span><span id="line-1564"></span><span class="hs-comment">-- 'MainInterface', the warnings definitely include also unsolved</span><span>
</span><span id="line-1565"></span><span class="hs-comment">-- warnings.</span><span>
</span><span id="line-1566"></span><span>
</span><span id="line-1567"></span><span id="local-6989586621682238671"><span class="annot"><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-type">getAllWarnings'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#MonadWarning"><span class="hs-identifier hs-type">MonadWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682238671"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682238671"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#WhichWarnings"><span class="hs-identifier hs-type">WhichWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682238671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCWarning"><span class="hs-identifier hs-type">TCWarning</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1568"></span><span id="getAllWarnings%27"><span class="annot"><span class="annottext">getAllWarnings' :: forall (m :: * -&gt; *).
(MonadWarning m, MonadTCM m) =&gt;
MainInterface -&gt; WhichWarnings -&gt; m (Set TCWarning)
</span><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var hs-var">getAllWarnings'</span></a></span></span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#MainInterface"><span class="hs-identifier hs-type">MainInterface</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set WarningName -&gt; WhichWarnings -&gt; m (Set TCWarning)
forall (m :: * -&gt; *).
(MonadWarning m, MonadTCM m) =&gt;
Set WarningName -&gt; WhichWarnings -&gt; m (Set TCWarning)
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarningsPreserving"><span class="hs-identifier hs-var">getAllWarningsPreserving</span></a></span><span> </span><span class="annot"><span class="annottext">Set WarningName
</span><a href="Agda.Interaction.Options.Warnings.html#unsolvedWarnings"><span class="hs-identifier hs-var">unsolvedWarnings</span></a></span><span>
</span><span id="line-1569"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getAllWarnings%27"><span class="hs-identifier hs-var">getAllWarnings'</span></a></span><span> </span><span class="annot"><span class="annottext">MainInterface
</span><a href="Agda.Interaction.Imports.html#NotMainInterface"><span class="hs-identifier hs-var">NotMainInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set WarningName -&gt; WhichWarnings -&gt; m (Set TCWarning)
forall (m :: * -&gt; *).
(MonadWarning m, MonadTCM m) =&gt;
Set WarningName -&gt; WhichWarnings -&gt; m (Set TCWarning)
</span><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarningsPreserving"><span class="hs-identifier hs-var">getAllWarningsPreserving</span></a></span><span> </span><span class="annot"><span class="annottext">Set WarningName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-1570"></span><span>
</span><span id="line-1571"></span><span class="hs-comment">-- Andreas, issue 964: not checking null interactionPoints</span><span>
</span><span id="line-1572"></span><span class="hs-comment">-- anymore; we want to serialize with open interaction points now!</span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span class="hs-comment">-- | Reconstruct the 'iScope' (not serialized)</span><span>
</span><span id="line-1575"></span><span class="hs-comment">--   from the 'iInsideScope' (serialized).</span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span class="annot"><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-type">constructIScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1578"></span><span id="constructIScope"><span class="annot"><span class="annottext">constructIScope :: Interface -&gt; Interface
</span><a href="Agda.Interaction.Imports.html#constructIScope"><span class="hs-identifier hs-var hs-var">constructIScope</span></a></span></span><span> </span><span id="local-6989586621682241173"><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241173"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Phase] -&gt; Interface -&gt; Interface
forall a. [Phase] -&gt; a -&gt; a
</span><a href="Agda.Benchmarking.html#billToPure"><span class="hs-identifier hs-var">billToPure</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="Agda.Benchmarking.html#Deserialization"><span class="hs-identifier hs-var">Deserialization</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Interface) -&gt; Interface -&gt; Interface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1579"></span><span>  </span><span class="annot"><span class="annottext">Interface
</span><a href="#local-6989586621682241173"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iScope"><span class="hs-identifier hs-var">iScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#publicModules"><span class="hs-identifier hs-type">publicModules</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241173"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span class="hs-comment">-- | Builds an interface for the current module, which should already</span><span>
</span><span id="line-1582"></span><span class="hs-comment">--   have been successfully type checked.</span><span>
</span><span id="line-1583"></span><span class="annot"><a href="Agda.Interaction.Imports.html#buildInterface"><span class="hs-identifier hs-type">buildInterface</span></a></span><span>
</span><span id="line-1584"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.Imports.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span>
</span><span id="line-1585"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ 'Source' for the current module.</span></span><span>
</span><span id="line-1586"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#TopLevelInfo"><span class="hs-identifier hs-type">TopLevelInfo</span></a></span><span>
</span><span id="line-1587"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ 'TopLevelInfo' scope information for the current module.</span></span><span>
</span><span id="line-1588"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1589"></span><span id="buildInterface"><span class="annot"><span class="annottext">buildInterface :: Source -&gt; TopLevelInfo -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#buildInterface"><span class="hs-identifier hs-var hs-var">buildInterface</span></a></span></span><span> </span><span id="local-6989586621682241176"><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621682241177"><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621682241177"><span class="hs-identifier hs-var">topLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1590"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Building interface...&quot;</span></span><span>
</span><span id="line-1591"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241178"><span class="annot"><span class="annottext">mname :: ModuleName
</span><a href="#local-6989586621682241178"><span class="hs-identifier hs-var hs-var hs-var">mname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; ModuleName
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelModuleName"><span class="hs-identifier hs-var">CToA.topLevelModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621682241177"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1592"></span><span>        </span><span id="local-6989586621682241180"><span class="annot"><span class="annottext">source :: Text
</span><a href="#local-6989586621682241180"><span class="hs-identifier hs-var hs-var hs-var">source</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; Text
</span><a href="Agda.Interaction.Imports.html#srcText"><span class="hs-identifier hs-var">srcText</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1593"></span><span>        </span><span id="local-6989586621682241181"><span class="annot"><span class="annottext">fileType :: FileType
</span><a href="#local-6989586621682241181"><span class="hs-identifier hs-var hs-var hs-var">fileType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; FileType
</span><a href="Agda.Interaction.Imports.html#srcFileType"><span class="hs-identifier hs-var">srcFileType</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1594"></span><span>        </span><span id="local-6989586621682241182"><span class="annot"><span class="annottext">defPragmas :: [OptionsPragma]
</span><a href="#local-6989586621682241182"><span class="hs-identifier hs-var hs-var hs-var">defPragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcDefaultPragmas"><span class="hs-identifier hs-var">srcDefaultPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1595"></span><span>        </span><span id="local-6989586621682241183"><span class="annot"><span class="annottext">filePragmas :: [OptionsPragma]
</span><a href="#local-6989586621682241183"><span class="hs-identifier hs-var hs-var hs-var">filePragmas</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; [OptionsPragma]
</span><a href="Agda.Interaction.Imports.html#srcFilePragmas"><span class="hs-identifier hs-var">srcFilePragmas</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1596"></span><span>
</span><span id="line-1597"></span><span>    </span><span class="hs-comment">-- Andreas, 2014-05-03: killRange did not result in significant reduction</span><span>
</span><span id="line-1598"></span><span>    </span><span class="hs-comment">-- of .agdai file size, and lost a few seconds performance on library-test.</span><span>
</span><span id="line-1599"></span><span>    </span><span class="hs-comment">-- Andreas, Makoto, 2014-10-18 AIM XX: repeating the experiment</span><span>
</span><span id="line-1600"></span><span>    </span><span class="hs-comment">-- with discarding also the nameBindingSite in QName:</span><span>
</span><span id="line-1601"></span><span>    </span><span class="hs-comment">-- Saves 10% on serialization time (and file size)!</span><span>
</span><span id="line-1602"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1603"></span><span>    </span><span class="hs-comment">-- NOTE: We no longer discard all nameBindingSites (but the commit</span><span>
</span><span id="line-1604"></span><span>    </span><span class="hs-comment">-- that introduced this change seems to have made Agda a bit</span><span>
</span><span id="line-1605"></span><span>    </span><span class="hs-comment">-- faster and interface file sizes a bit smaller, at least for the</span><span>
</span><span id="line-1606"></span><span>    </span><span class="hs-comment">-- standard library).</span><span>
</span><span id="line-1607"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241184"><span class="annot"><a href="#local-6989586621682241184"><span class="hs-identifier hs-var">mhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TopLevelModuleName -&gt; TCMT IO (TopLevelModuleName, Hash))
-&gt; [TopLevelModuleName] -&gt; TCMT IO [(TopLevelModuleName, Hash)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682241186"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241186"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241186"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; (TopLevelModuleName, Hash))
-&gt; TCMT IO Hash -&gt; TCMT IO (TopLevelModuleName, Hash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; TCMT IO Hash
</span><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-var">moduleHash</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241186"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TopLevelModuleName] -&gt; TCMT IO [(TopLevelModuleName, Hash)])
-&gt; (Set TopLevelModuleName -&gt; [TopLevelModuleName])
-&gt; Set TopLevelModuleName
-&gt; TCMT IO [(TopLevelModuleName, Hash)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set TopLevelModuleName -&gt; [TopLevelModuleName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Set TopLevelModuleName -&gt; TCMT IO [(TopLevelModuleName, Hash)])
-&gt; TCMT IO (Set TopLevelModuleName)
-&gt; TCMT IO [(TopLevelModuleName, Hash)]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Set TopLevelModuleName)
-&gt; TCMT IO (Set TopLevelModuleName)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TopLevelModuleName -&gt; f (Set TopLevelModuleName))
-&gt; TCState -&gt; f TCState
Lens' TCState (Set TopLevelModuleName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stImportedModules"><span class="hs-identifier hs-var">stImportedModules</span></a></span><span>
</span><span id="line-1608"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241190"><span class="annot"><a href="#local-6989586621682241190"><span class="hs-identifier hs-var">foreignCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stForeignCode"><span class="hs-identifier hs-type">stForeignCode</span></a></span><span>
</span><span id="line-1609"></span><span>
</span><span id="line-1610"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682241194"><span class="annot"><a href="#local-6989586621682241194"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Translation.ConcreteToAbstract.html#topLevelScope"><span class="hs-identifier hs-var">topLevelScope</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelInfo
</span><a href="#local-6989586621682241177"><span class="hs-identifier hs-var">topLevel</span></a></span><span>
</span><span id="line-1611"></span><span>
</span><span id="line-1612"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682241195"><span class="annot"><a href="#local-6989586621682241195"><span class="hs-identifier hs-var">solvedMetas</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682241196"><span class="annot"><a href="#local-6989586621682241196"><span class="hs-identifier hs-var">definitions</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682241197"><span class="annot"><a href="#local-6989586621682241197"><span class="hs-identifier hs-var">displayForms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier hs-type">eliminateDeadCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241194"><span class="hs-identifier hs-type">scope</span></a></span><span>
</span><span id="line-1613"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241199"><span class="annot"><a href="#local-6989586621682241199"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-type">sigDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241196"><span class="hs-identifier hs-type">definitions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getSignature"><span class="hs-identifier hs-type">getSignature</span></a></span><span>
</span><span id="line-1614"></span><span>
</span><span id="line-1615"></span><span>    </span><span class="hs-comment">-- Andreas, 2015-02-09 kill ranges in pattern synonyms before</span><span>
</span><span id="line-1616"></span><span>    </span><span class="hs-comment">-- serialization to avoid error locations pointing to external files</span><span>
</span><span id="line-1617"></span><span>    </span><span class="hs-comment">-- when expanding a pattern synonym.</span><span>
</span><span id="line-1618"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241203"><span class="annot"><a href="#local-6989586621682241203"><span class="hs-identifier hs-var">patsyns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-type">killRange</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-type">getPatternSyns</span></a></span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241206"><span class="annot"><a href="#local-6989586621682241206"><span class="hs-identifier hs-var">userwarns</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stLocalUserWarnings"><span class="hs-identifier hs-type">stLocalUserWarnings</span></a></span><span>
</span><span id="line-1621"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241210"><span class="annot"><a href="#local-6989586621682241210"><span class="hs-identifier hs-var">importwarn</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stWarningOnImport"><span class="hs-identifier hs-type">stWarningOnImport</span></a></span><span>
</span><span id="line-1622"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241214"><span class="annot"><a href="#local-6989586621682241214"><span class="hs-identifier hs-var">syntaxInfo</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stSyntaxInfo"><span class="hs-identifier hs-type">stSyntaxInfo</span></a></span><span>
</span><span id="line-1623"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241217"><span class="annot"><a href="#local-6989586621682241217"><span class="hs-identifier hs-var">optionsUsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stPragmaOptions"><span class="hs-identifier hs-type">stPragmaOptions</span></a></span><span>
</span><span id="line-1624"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241220"><span class="annot"><a href="#local-6989586621682241220"><span class="hs-identifier hs-var">partialDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stLocalPartialDefs"><span class="hs-identifier hs-type">stLocalPartialDefs</span></a></span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span>    </span><span class="hs-comment">-- Only serialise the opaque blocks actually defined in this</span><span>
</span><span id="line-1627"></span><span>    </span><span class="hs-comment">-- top-level module.</span><span>
</span><span id="line-1628"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241224"><span class="annot"><a href="#local-6989586621682241224"><span class="hs-identifier hs-var">opaqueBlocks'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueBlocks"><span class="hs-identifier hs-type">stOpaqueBlocks</span></a></span><span>
</span><span id="line-1629"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241227"><span class="annot"><a href="#local-6989586621682241227"><span class="hs-identifier hs-var">opaqueIds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stOpaqueIds"><span class="hs-identifier hs-type">stOpaqueIds</span></a></span><span>
</span><span id="line-1630"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1631"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621682241230"><span class="annot"><a href="#local-6989586621682241230"><span class="hs-identifier hs-var hs-var">mh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; ModuleNameHash
forall range. TopLevelModuleName' range -&gt; ModuleNameHash
</span><a href="Agda.Syntax.TopLevelModuleName.Boot.html#moduleNameId"><span class="hs-identifier hs-var">moduleNameId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1632"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621682241232"><span class="annot"><a href="#local-6989586621682241232"><span class="hs-identifier hs-var hs-var">opaqueBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OpaqueId -&gt; OpaqueBlock -&gt; Bool)
-&gt; Map OpaqueId OpaqueBlock -&gt; Map OpaqueId OpaqueBlock
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682241235"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241235"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OpaqueBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241235"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241230"><span class="hs-identifier hs-var">mh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621682241224"><span class="hs-identifier hs-var">opaqueBlocks'</span></a></span><span>
</span><span id="line-1633"></span><span>      </span><span id="local-6989586621682241236"><span class="annot"><a href="#local-6989586621682241236"><span class="hs-identifier hs-var hs-var">isLocal</span></a></span></span><span> </span><span id="local-6989586621682241237"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682241237"><span class="hs-identifier hs-var">qnm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QName -&gt; NameId
forall a. HasNameId a =&gt; a -&gt; NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682241237"><span class="hs-identifier hs-var">qnm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1634"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Common.html#NameId"><span class="hs-identifier hs-type">NameId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682241240"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241240"><span class="hs-identifier hs-var">mh'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241240"><span class="hs-identifier hs-var">mh'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241230"><span class="hs-identifier hs-var">mh</span></a></span><span>
</span><span id="line-1635"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621682241241"><span class="annot"><a href="#local-6989586621682241241"><span class="hs-identifier hs-var hs-var">opaqueIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; OpaqueId -&gt; Bool)
-&gt; Map QName OpaqueId -&gt; Map QName OpaqueId
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682241242"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682241242"><span class="hs-identifier hs-var">qnm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#OpaqueId"><span class="hs-identifier hs-type">OpaqueId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682241243"><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241243"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Bool
</span><a href="#local-6989586621682241236"><span class="hs-identifier hs-var">isLocal</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682241242"><span class="hs-identifier hs-var">qnm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241243"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash -&gt; ModuleNameHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameHash
</span><a href="#local-6989586621682241230"><span class="hs-identifier hs-var">mh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621682241227"><span class="hs-identifier hs-var">opaqueIds'</span></a></span><span>
</span><span id="line-1636"></span><span>
</span><span id="line-1637"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241245"><span class="annot"><a href="#local-6989586621682241245"><span class="hs-identifier hs-var">builtin</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.mapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682241247"><span class="annot"><span class="annottext">SomeBuiltin
</span><a href="#local-6989586621682241247"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682241248"><span class="annot"><span class="annottext">Builtin PrimFun
</span><a href="#local-6989586621682241248"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeBuiltin -&gt; PrimFun -&gt; (PrimitiveId, QName)
</span><a href="#local-6989586621682241249"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">SomeBuiltin
</span><a href="#local-6989586621682241247"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimFun -&gt; (PrimitiveId, QName))
-&gt; Builtin PrimFun -&gt; Builtin (PrimitiveId, QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builtin PrimFun
</span><a href="#local-6989586621682241248"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stLocalBuiltins"><span class="hs-identifier hs-type">stLocalBuiltins</span></a></span><span>
</span><span id="line-1638"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241253"><span class="annot"><a href="#local-6989586621682241253"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#isSourceCodeWarning"><span class="hs-identifier hs-type">isSourceCodeWarning</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#warningName"><span class="hs-identifier hs-type">warningName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#tcWarning"><span class="hs-identifier hs-var">tcWarning</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.Warning.html#getAllWarnings"><span class="hs-identifier hs-type">getAllWarnings</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#AllWarnings"><span class="hs-identifier hs-type">AllWarnings</span></a></span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682241258"><span class="annot"><a href="#local-6989586621682241258"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Interface"><span class="hs-identifier hs-type">Interface</span></a></span><span>
</span><span id="line-1641"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iSourceHash :: Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iSourceHash"><span class="hs-identifier hs-var">iSourceHash</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Hash
</span><a href="Agda.Utils.Hash.html#hashText"><span class="hs-identifier hs-var">hashText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682241180"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1642"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iSource :: Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iSource"><span class="hs-identifier hs-var">iSource</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682241180"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1643"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iFileType :: FileType
</span><a href="Agda.TypeChecking.Monad.Base.html#iFileType"><span class="hs-identifier hs-var">iFileType</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="#local-6989586621682241181"><span class="hs-identifier hs-var">fileType</span></a></span><span>
</span><span id="line-1644"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iImportedModules :: [(TopLevelModuleName, Hash)]
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportedModules"><span class="hs-identifier hs-var">iImportedModules</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TopLevelModuleName, Hash)]
</span><a href="#local-6989586621682241184"><span class="hs-identifier hs-var">mhs</span></a></span><span>
</span><span id="line-1645"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iModuleName :: ModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iModuleName"><span class="hs-identifier hs-var">iModuleName</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682241178"><span class="hs-identifier hs-var">mname</span></a></span><span>
</span><span id="line-1646"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iTopLevelModuleName :: TopLevelModuleName
</span><a href="Agda.TypeChecking.Monad.Base.html#iTopLevelModuleName"><span class="hs-identifier hs-var">iTopLevelModuleName</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Source -&gt; TopLevelModuleName
</span><a href="Agda.Interaction.Imports.html#srcModuleName"><span class="hs-identifier hs-var">srcModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">Source
</span><a href="#local-6989586621682241176"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1647"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iScope :: Map ModuleName Scope
</span><a href="Agda.TypeChecking.Monad.Base.html#iScope"><span class="hs-identifier hs-var">iScope</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName Scope
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-comment">-- publicModules scope</span><span>
</span><span id="line-1648"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iInsideScope :: ScopeInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iInsideScope"><span class="hs-identifier hs-var">iInsideScope</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621682241194"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-1649"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iSignature :: Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#iSignature"><span class="hs-identifier hs-var">iSignature</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621682241199"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1650"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iMetaBindings :: RemoteMetaStore
</span><a href="Agda.TypeChecking.Monad.Base.html#iMetaBindings"><span class="hs-identifier hs-var">iMetaBindings</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteMetaStore
</span><a href="#local-6989586621682241195"><span class="hs-identifier hs-var">solvedMetas</span></a></span><span>
</span><span id="line-1651"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iDisplayForms :: DisplayForms
</span><a href="Agda.TypeChecking.Monad.Base.html#iDisplayForms"><span class="hs-identifier hs-var">iDisplayForms</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621682241197"><span class="hs-identifier hs-var">displayForms</span></a></span><span>
</span><span id="line-1652"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iUserWarnings :: UserWarnings
</span><a href="Agda.TypeChecking.Monad.Base.html#iUserWarnings"><span class="hs-identifier hs-var">iUserWarnings</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserWarnings
</span><a href="#local-6989586621682241206"><span class="hs-identifier hs-var">userwarns</span></a></span><span>
</span><span id="line-1653"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iImportWarning :: Maybe Text
</span><a href="Agda.TypeChecking.Monad.Base.html#iImportWarning"><span class="hs-identifier hs-var">iImportWarning</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621682241210"><span class="hs-identifier hs-var">importwarn</span></a></span><span>
</span><span id="line-1654"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iBuiltin :: Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="Agda.TypeChecking.Monad.Base.html#iBuiltin"><span class="hs-identifier hs-var">iBuiltin</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SomeBuiltin (Builtin (PrimitiveId, QName))
</span><a href="#local-6989586621682241245"><span class="hs-identifier hs-var">builtin</span></a></span><span>
</span><span id="line-1655"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iForeignCode :: Map Text ForeignCodeStack
</span><a href="Agda.TypeChecking.Monad.Base.html#iForeignCode"><span class="hs-identifier hs-var">iForeignCode</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text ForeignCodeStack
</span><a href="#local-6989586621682241190"><span class="hs-identifier hs-var">foreignCode</span></a></span><span>
</span><span id="line-1656"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iHighlighting :: HighlightingInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#iHighlighting"><span class="hs-identifier hs-var">iHighlighting</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighlightingInfo
</span><a href="#local-6989586621682241214"><span class="hs-identifier hs-var">syntaxInfo</span></a></span><span>
</span><span id="line-1657"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iDefaultPragmaOptions :: [OptionsPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#iDefaultPragmaOptions"><span class="hs-identifier hs-var">iDefaultPragmaOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621682241182"><span class="hs-identifier hs-var">defPragmas</span></a></span><span>
</span><span id="line-1658"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iFilePragmaOptions :: [OptionsPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#iFilePragmaOptions"><span class="hs-identifier hs-var">iFilePragmaOptions</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OptionsPragma]
</span><a href="#local-6989586621682241183"><span class="hs-identifier hs-var">filePragmas</span></a></span><span>
</span><span id="line-1659"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iOptionsUsed :: PragmaOptions
</span><a href="Agda.TypeChecking.Monad.Base.html#iOptionsUsed"><span class="hs-identifier hs-var">iOptionsUsed</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621682241217"><span class="hs-identifier hs-var">optionsUsed</span></a></span><span>
</span><span id="line-1660"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iPatternSyns :: PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.Base.html#iPatternSyns"><span class="hs-identifier hs-var">iPatternSyns</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621682241203"><span class="hs-identifier hs-var">patsyns</span></a></span><span>
</span><span id="line-1661"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iWarnings :: Set TCWarning
</span><a href="Agda.TypeChecking.Monad.Base.html#iWarnings"><span class="hs-identifier hs-var">iWarnings</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TCWarning
</span><a href="#local-6989586621682241253"><span class="hs-identifier hs-var">warnings</span></a></span><span>
</span><span id="line-1662"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iPartialDefs :: Set QName
</span><a href="Agda.TypeChecking.Monad.Base.html#iPartialDefs"><span class="hs-identifier hs-var">iPartialDefs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621682241220"><span class="hs-identifier hs-var">partialDefs</span></a></span><span>
</span><span id="line-1663"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iOpaqueBlocks :: Map OpaqueId OpaqueBlock
</span><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueBlocks"><span class="hs-identifier hs-var">iOpaqueBlocks</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map OpaqueId OpaqueBlock
</span><a href="#local-6989586621682241232"><span class="hs-identifier hs-var">opaqueBlocks</span></a></span><span>
</span><span id="line-1664"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iOpaqueNames :: Map QName OpaqueId
</span><a href="Agda.TypeChecking.Monad.Base.html#iOpaqueNames"><span class="hs-identifier hs-var">iOpaqueNames</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map QName OpaqueId
</span><a href="#local-6989586621682241241"><span class="hs-identifier hs-var">opaqueIds</span></a></span><span>
</span><span id="line-1665"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1666"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682241263"><span class="annot"><a href="#local-6989586621682241263"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1667"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optSaveMetas"><span class="hs-identifier hs-type">optSaveMetas</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1668"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682241258"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span>
</span><span id="line-1670"></span><span>              </span><span class="annot"><span class="hs-string">&quot;  instantiating all metavariables in interface&quot;</span></span><span>
</span><span id="line-1671"></span><span>            </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#InterfaceInstantiateFull"><span class="hs-identifier hs-type">Bench.InterfaceInstantiateFull</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftReduce"><span class="hs-identifier hs-type">liftReduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull%27"><span class="hs-identifier hs-type">instantiateFull'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241258"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1672"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;import.iface&quot;</span></span><span> </span><span class="annot"><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  interface complete&quot;</span></span><span>
</span><span id="line-1673"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682241263"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1676"></span><span>      </span><span id="local-6989586621682241249"><span class="annot"><span class="annottext">primName :: SomeBuiltin -&gt; PrimFun -&gt; (PrimitiveId, QName)
</span><a href="#local-6989586621682241249"><span class="hs-identifier hs-var hs-var">primName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#PrimitiveName"><span class="hs-identifier hs-type">PrimitiveName</span></a></span><span> </span><span id="local-6989586621682241271"><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682241271"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682241272"><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621682241272"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimitiveId
</span><a href="#local-6989586621682241271"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimFun -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#primFunName"><span class="hs-identifier hs-var">primFunName</span></a></span><span> </span><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621682241272"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>      </span><span class="annot"><a href="#local-6989586621682241249"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Builtin.html#BuiltinName"><span class="hs-identifier hs-type">BuiltinName</span></a></span><span> </span><span id="local-6989586621682241273"><span class="annot"><span class="annottext">BuiltinId
</span><a href="#local-6989586621682241273"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621682241274"><span class="annot"><span class="annottext">PrimFun
</span><a href="#local-6989586621682241274"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrimitiveId, QName)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span class="hs-comment">-- | Returns (iSourceHash, iFullHash)</span><span>
</span><span id="line-1680"></span><span class="hs-comment">--   We do not need to check that the file exist because we only</span><span>
</span><span id="line-1681"></span><span class="hs-comment">--   accept @InterfaceFile@ as an input and not arbitrary @AbsolutePath@!</span><span>
</span><span id="line-1682"></span><span class="annot"><a href="Agda.Interaction.Imports.html#getInterfaceFileHashes"><span class="hs-identifier hs-type">getInterfaceFileHashes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Interaction.FindFile.html#InterfaceFile"><span class="hs-identifier hs-type">InterfaceFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1683"></span><span id="getInterfaceFileHashes"><span class="annot"><span class="annottext">getInterfaceFileHashes :: InterfaceFile -&gt; IO (Maybe (Hash, Hash))
</span><a href="Agda.Interaction.Imports.html#getInterfaceFileHashes"><span class="hs-identifier hs-var hs-var">getInterfaceFileHashes</span></a></span></span><span> </span><span id="local-6989586621682241275"><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621682241275"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1684"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682241276"><span class="annot"><span class="annottext">ifile :: [Char]
</span><a href="#local-6989586621682241276"><span class="hs-identifier hs-var hs-var hs-var">ifile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbsolutePath -&gt; [Char]
</span><a href="Agda.Utils.FileName.html#filePath"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">(AbsolutePath -&gt; [Char]) -&gt; AbsolutePath -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InterfaceFile -&gt; AbsolutePath
</span><a href="Agda.Interaction.FindFile.html#intFilePath"><span class="hs-identifier hs-var">intFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">InterfaceFile
</span><a href="#local-6989586621682241275"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-1685"></span><span>  </span><span id="local-6989586621682241277"><span class="annot"><a href="#local-6989586621682241277"><span class="hs-identifier hs-var">h</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IOMode -&gt; IO Handle
</span><span class="hs-identifier hs-var">openBinaryFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621682241276"><span class="hs-identifier hs-var">ifile</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadMode</span></span><span>
</span><span id="line-1686"></span><span>  </span><span id="local-6989586621682241280"><span class="annot"><a href="#local-6989586621682241280"><span class="hs-identifier hs-var">bstr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.hGetSome</span></span><span> </span><span class="annot"><a href="#local-6989586621682241277"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">*</span></span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#hashSize"><span class="hs-identifier hs-type">hashSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1687"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">hClose</span></span><span> </span><span class="annot"><a href="#local-6989586621682241277"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-1688"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Serialise.html#deserializeHashes"><span class="hs-identifier hs-type">deserializeHashes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682241280"><span class="hs-identifier hs-type">bstr</span></a></span><span>
</span><span id="line-1689"></span><span>
</span><span id="line-1690"></span><span class="annot"><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-type">moduleHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.TopLevelModuleName.html#TopLevelModuleName"><span class="hs-identifier hs-type">TopLevelModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span>
</span><span id="line-1691"></span><span id="moduleHash"><span class="annot"><span class="annottext">moduleHash :: TopLevelModuleName -&gt; TCMT IO Hash
</span><a href="Agda.Interaction.Imports.html#moduleHash"><span class="hs-identifier hs-var hs-var">moduleHash</span></a></span></span><span> </span><span id="local-6989586621682241285"><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241285"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interface -&gt; Hash
</span><a href="Agda.TypeChecking.Monad.Base.html#iFullHash"><span class="hs-identifier hs-var">iFullHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Interface -&gt; Hash) -&gt; TCMT IO Interface -&gt; TCMT IO Hash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName -&gt; Maybe Source -&gt; TCMT IO Interface
</span><a href="Agda.Interaction.Imports.html#getNonMainInterface"><span class="hs-identifier hs-var">getNonMainInterface</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelModuleName
</span><a href="#local-6989586621682241285"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Source
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1692"></span></pre></body></html>