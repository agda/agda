<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html"><span class="hs-identifier">Agda.TypeChecking.Constraints</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html"><span class="hs-identifier">Agda.TypeChecking.InstanceArguments</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.LevelConstraints.html"><span class="hs-identifier">Agda.TypeChecking.LevelConstraints</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.html"><span class="hs-identifier">Agda.TypeChecking.SizedTypes</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Sort.html"><span class="hs-identifier">Agda.TypeChecking.Sort</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html"><span class="hs-identifier">Agda.TypeChecking.Irrelevance</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Application.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Application</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Data.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Data</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Data.html#checkDataSort"><span class="hs-identifier">checkDataSort</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Def</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Term</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Empty.html"><span class="hs-identifier">Agda.TypeChecking.Empty</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Lock.html"><span class="hs-identifier">Agda.TypeChecking.Lock</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CheckInternal.html"><span class="hs-identifier">Agda.TypeChecking.CheckInternal</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CheckInternal.html#checkType"><span class="hs-identifier">checkType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.html"><span class="hs-identifier">Agda.Utils.CallStack</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.Base.html#withCurrentCallStack"><span class="hs-identifier">withCurrentCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.ProfileOptions.html"><span class="hs-identifier">Agda.Interaction.Options.ProfileOptions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Profile</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier">applyUnless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621682052282"><span class="annot"><span class="annottext">addConstraint :: Blocker -&gt; Constraint -&gt; TCM ()
</span><a href="#local-6989586621682052282"><span class="hs-identifier hs-var hs-var hs-var">addConstraint</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#addConstraintTCM"><span class="hs-identifier hs-var">addConstraintTCM</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621682052285"><span class="annot"><span class="annottext">addAwakeConstraint :: Blocker -&gt; Constraint -&gt; TCM ()
</span><a href="#local-6989586621682052285"><span class="hs-identifier hs-var hs-var hs-var">addAwakeConstraint</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#addAwakeConstraint%27"><span class="hs-identifier hs-var">addAwakeConstraint'</span></a></span><span>
</span><span id="line-53"></span><span>  </span><span id="local-6989586621682052288"><span class="annot"><span class="annottext">solveConstraint :: Constraint -&gt; TCM ()
</span><a href="#local-6989586621682052288"><span class="hs-identifier hs-var hs-var hs-var">solveConstraint</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#solveConstraintTCM"><span class="hs-identifier hs-var">solveConstraintTCM</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621682052291"><span class="annot"><span class="annottext">solveSomeAwakeConstraints :: (ProblemConstraint -&gt; Bool) -&gt; Bool -&gt; TCM ()
</span><a href="#local-6989586621682052291"><span class="hs-identifier hs-var hs-var hs-var">solveSomeAwakeConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; Bool) -&gt; Bool -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#solveSomeAwakeConstraintsTCM"><span class="hs-identifier hs-var">solveSomeAwakeConstraintsTCM</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span id="local-6989586621682052294"><span class="annot"><span class="annottext">wakeConstraints :: (ProblemConstraint -&gt; WakeUp) -&gt; TCM ()
</span><a href="#local-6989586621682052294"><span class="hs-identifier hs-var hs-var hs-var">wakeConstraints</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; WakeUp) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#wakeConstraintsTCM"><span class="hs-identifier hs-var">wakeConstraintsTCM</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span id="local-6989586621682052297"><span class="annot"><span class="annottext">stealConstraints :: ProblemId -&gt; TCM ()
</span><a href="#local-6989586621682052297"><span class="hs-identifier hs-var hs-var hs-var">stealConstraints</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProblemId -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#stealConstraintsTCM"><span class="hs-identifier hs-var">stealConstraintsTCM</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621682052301"><span class="annot"><span class="annottext">modifyAwakeConstraints :: (Constraints -&gt; Constraints) -&gt; TCM ()
</span><a href="#local-6989586621682052301"><span class="hs-identifier hs-var hs-var hs-var">modifyAwakeConstraints</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(TCState -&gt; TCState) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-var">modifyTC</span></a></span><span> </span><span class="annot"><span class="annottext">((TCState -&gt; TCState) -&gt; TCM ())
-&gt; ((Constraints -&gt; Constraints) -&gt; TCState -&gt; TCState)
-&gt; (Constraints -&gt; Constraints)
-&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; Constraints) -&gt; TCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Constraints.html#mapAwakeConstraints"><span class="hs-identifier hs-var">mapAwakeConstraints</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621682052307"><span class="annot"><span class="annottext">modifySleepingConstraints :: (Constraints -&gt; Constraints) -&gt; TCM ()
</span><a href="#local-6989586621682052307"><span class="hs-identifier hs-var hs-var hs-var">modifySleepingConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCState -&gt; TCState) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(TCState -&gt; TCState) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTC"><span class="hs-identifier hs-var">modifyTC</span></a></span><span> </span><span class="annot"><span class="annottext">((TCState -&gt; TCState) -&gt; TCM ())
-&gt; ((Constraints -&gt; Constraints) -&gt; TCState -&gt; TCState)
-&gt; (Constraints -&gt; Constraints)
-&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; Constraints) -&gt; TCState -&gt; TCState
</span><a href="Agda.TypeChecking.Monad.Constraints.html#mapSleepingConstraints"><span class="hs-identifier hs-var">mapSleepingConstraints</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#addConstraintTCM"><span class="hs-identifier hs-type">addConstraintTCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span id="addConstraintTCM"><span class="annot"><span class="annottext">addConstraintTCM :: Blocker -&gt; Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#addConstraintTCM"><span class="hs-identifier hs-var hs-var">addConstraintTCM</span></a></span></span><span> </span><span id="local-6989586621682052310"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052310"><span class="hs-identifier hs-var">unblock</span></a></span></span><span> </span><span id="local-6989586621682052311"><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052311"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>      </span><span id="local-6989586621682052312"><span class="annot"><a href="#local-6989586621682052312"><span class="hs-identifier hs-var">pids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Set ProblemId) -&gt; TCMT IO (Set ProblemId)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Set ProblemId
</span><a href="Agda.TypeChecking.Monad.Base.html#envActiveProblems"><span class="hs-identifier hs-var">envActiveProblems</span></a></span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.constr.add&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-type">hsep</span></a></span><span>
</span><span id="line-64"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;adding constraint&quot;</span></span><span>
</span><span id="line-65"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PConstr"><span class="hs-identifier hs-type">PConstr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052312"><span class="hs-identifier hs-type">pids</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052310"><span class="hs-identifier hs-type">unblock</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#buildClosure"><span class="hs-identifier hs-type">buildClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052311"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-66"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;unblocker: &quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052310"><span class="hs-identifier hs-type">unblock</span></a></span><span>
</span><span id="line-67"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-comment">-- Jesper, 2022-10-22: We should never block on a meta that is</span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-comment">-- already solved.</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#allBlockingMetas"><span class="hs-identifier hs-type">allBlockingMetas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052310"><span class="hs-identifier hs-type">unblock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052323"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052323"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
forall a (m :: * -&gt; *).
(IsInstantiatedMeta a, ReadTCState m) =&gt;
a -&gt; m Bool
forall (m :: * -&gt; *). ReadTCState m =&gt; MetaId -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isInstantiatedMeta"><span class="hs-identifier hs-var">isInstantiatedMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052323"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.add&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Attempted to block on solved meta&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; MetaId -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052323"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-73"></span><span>          </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-74"></span><span>      </span><span class="hs-comment">-- Need to reduce to reveal possibly blocking metas</span><span>
</span><span id="line-75"></span><span>      </span><span id="local-6989586621682052328"><span class="annot"><a href="#local-6989586621682052328"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052311"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybeM"><span class="hs-identifier hs-type">caseMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682052332"><span class="hs-identifier hs-type">simpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052328"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-no-}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#addConstraint%27"><span class="hs-identifier hs-type">addConstraint'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052310"><span class="hs-identifier hs-type">unblock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052328"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-comment">{-yes-}</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052334"><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621682052334"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-77"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.add&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;  simplified:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Constraint -&gt; TCMT IO Doc) -&gt; [Constraint] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Constraint -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621682052334"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>          </span><span class="annot"><span class="annottext">(Constraint -&gt; TCM ()) -&gt; [Constraint] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621682052334"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-comment">-- The added constraint can cause instance constraints to be solved,</span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-comment">-- but only the constraints which aren&#8217;t blocked on an uninstantiated meta.</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#isInstanceConstraint"><span class="hs-identifier hs-type">isInstanceConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052328"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-82"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#wakeConstraints%27"><span class="hs-identifier hs-type">wakeConstraints'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052341"><span class="hs-identifier hs-type">isWakeableInstanceConstraint</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>      </span><span class="annot"><a href="#local-6989586621682052341"><span class="hs-identifier hs-type">isWakeableInstanceConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ProblemConstraint"><span class="hs-identifier hs-type">ProblemConstraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#WakeUp"><span class="hs-identifier hs-type">WakeUp</span></a></span><span>
</span><span id="line-85"></span><span>      </span><span id="local-6989586621682052341"><span class="annot"><span class="annottext">isWakeableInstanceConstraint :: ProblemConstraint -&gt; WakeUp
</span><a href="#local-6989586621682052341"><span class="hs-identifier hs-var hs-var">isWakeableInstanceConstraint</span></a></span></span><span> </span><span id="local-6989586621682052342"><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052342"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Closure Constraint -&gt; Constraint
forall a. Closure a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#clValue"><span class="hs-identifier hs-var">clValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Constraint -&gt; Constraint)
-&gt; Closure Constraint -&gt; Constraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Closure Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#theConstraint"><span class="hs-identifier hs-var">theConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052342"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-87"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#FindInstance"><span class="hs-identifier hs-type">FindInstance</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Blocker
</span><a href="Agda.TypeChecking.Monad.Base.html#constraintUnblocker"><span class="hs-identifier hs-var">constraintUnblocker</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052342"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Blocker -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-var">alwaysUnblock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WakeUp
</span><a href="Agda.Syntax.Internal.Blockers.html#WakeUp"><span class="hs-identifier hs-var">WakeUp</span></a></span><span>
</span><span id="line-89"></span><span>          </span><span class="annot"><span class="annottext">Constraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; WakeUp
</span><a href="Agda.Syntax.Internal.Blockers.html#DontWakeUp"><span class="hs-identifier hs-var">DontWakeUp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>      </span><span id="local-6989586621682052350"><span class="annot"><span class="annottext">isLvl :: Constraint -&gt; Bool
</span><a href="#local-6989586621682052350"><span class="hs-identifier hs-var hs-var">isLvl</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LevelCmp"><span class="hs-identifier hs-type">LevelCmp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><a href="#local-6989586621682052350"><span class="hs-identifier hs-var">isLvl</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>      </span><span class="hs-comment">-- Try to simplify a level constraint</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><a href="#local-6989586621682052332"><span class="hs-identifier hs-type">simpl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>      </span><span id="local-6989586621682052332"><span class="annot"><span class="annottext">simpl :: Constraint -&gt; TCMT IO (Maybe [Constraint])
</span><a href="#local-6989586621682052332"><span class="hs-identifier hs-var hs-var">simpl</span></a></span></span><span> </span><span id="local-6989586621682052352"><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052352"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; Bool
</span><a href="#local-6989586621682052350"><span class="hs-identifier hs-var">isLvl</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052352"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>          </span><span class="hs-comment">-- Get all level constraints.</span><span>
</span><span id="line-99"></span><span>          </span><span id="local-6989586621682052353"><span class="annot"><a href="#local-6989586621682052353"><span class="hs-identifier hs-var">lvlcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Closure Constraint] -&gt; TCMT IO [Closure Constraint]
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">([Closure Constraint] -&gt; TCMT IO [Closure Constraint])
-&gt; TCMT IO [Closure Constraint] -&gt; TCMT IO [Closure Constraint]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>            </span><span class="annot"><span class="annottext">(Closure Constraint -&gt; Bool)
-&gt; [Closure Constraint] -&gt; [Closure Constraint]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint -&gt; Bool
</span><a href="#local-6989586621682052350"><span class="hs-identifier hs-var">isLvl</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; Bool)
-&gt; (Closure Constraint -&gt; Constraint) -&gt; Closure Constraint -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Closure Constraint -&gt; Constraint
forall a. Closure a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#clValue"><span class="hs-identifier hs-var">clValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Closure Constraint] -&gt; [Closure Constraint])
-&gt; (Constraints -&gt; [Closure Constraint])
-&gt; Constraints
-&gt; [Closure Constraint]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; Closure Constraint)
-&gt; Constraints -&gt; [Closure Constraint]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Closure Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#theConstraint"><span class="hs-identifier hs-var">theConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; [Closure Constraint])
-&gt; TCMT IO Constraints -&gt; TCMT IO [Closure Constraint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Constraints
forall (m :: * -&gt; *). ReadTCState m =&gt; m Constraints
</span><a href="Agda.TypeChecking.Monad.Constraints.html#getAllConstraints"><span class="hs-identifier hs-var">getAllConstraints</span></a></span><span>
</span><span id="line-101"></span><span>          </span><span class="annot"><a href="Agda.Utils.List1.html#ifNull"><span class="hs-identifier hs-type">List1.ifNull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052353"><span class="hs-identifier hs-type">lvlcs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052357"><span class="annot"><span class="annottext">List1 (Closure Constraint)
</span><a href="#local-6989586621682052357"><span class="hs-identifier hs-var">lvlcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.lvl&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-103"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;simplifying level constraint&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Constraint -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052352"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-104"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *).
Applicative m =&gt;
m Doc -&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;using&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (Closure Constraint) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *).
MonadPretty m =&gt;
List1 (Closure Constraint) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Closure Constraint)
</span><a href="#local-6989586621682052357"><span class="hs-identifier hs-var">lvlcs</span></a></span><span>
</span><span id="line-105"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-comment">-- Try to simplify @c@ using the other constraints.</span><span>
</span><span id="line-107"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Constraint] -&gt; TCMT IO (Maybe [Constraint])
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [Constraint] -&gt; TCMT IO (Maybe [Constraint]))
-&gt; Maybe [Constraint] -&gt; TCMT IO (Maybe [Constraint])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; List1 Constraint -&gt; Maybe [Constraint]
</span><a href="Agda.TypeChecking.LevelConstraints.html#simplifyLevelConstraint"><span class="hs-identifier hs-var">simplifyLevelConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052352"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 Constraint -&gt; Maybe [Constraint])
-&gt; List1 Constraint -&gt; Maybe [Constraint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Closure Constraint -&gt; Constraint)
-&gt; List1 (Closure Constraint) -&gt; List1 Constraint
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Closure Constraint -&gt; Constraint
forall a. Closure a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#clValue"><span class="hs-identifier hs-var">clValue</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Closure Constraint)
</span><a href="#local-6989586621682052357"><span class="hs-identifier hs-var">lvlcs</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Constraint] -&gt; TCMT IO (Maybe [Constraint])
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Constraint]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#wakeConstraintsTCM"><span class="hs-identifier hs-type">wakeConstraintsTCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ProblemConstraint"><span class="hs-identifier hs-type">ProblemConstraint</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#WakeUp"><span class="hs-identifier hs-type">WakeUp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span id="wakeConstraintsTCM"><span class="annot"><span class="annottext">wakeConstraintsTCM :: (ProblemConstraint -&gt; WakeUp) -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#wakeConstraintsTCM"><span class="hs-identifier hs-var hs-var">wakeConstraintsTCM</span></a></span></span><span> </span><span id="local-6989586621682052362"><span class="annot"><span class="annottext">ProblemConstraint -&gt; WakeUp
</span><a href="#local-6989586621682052362"><span class="hs-identifier hs-var">wake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621682052363"><span class="annot"><a href="#local-6989586621682052363"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState Constraints -&gt; TCMT IO Constraints
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useR"><span class="hs-identifier hs-var">useR</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; f Constraints) -&gt; TCState -&gt; f TCState
Lens' TCState Constraints
</span><a href="Agda.TypeChecking.Monad.Base.html#stSleepingConstraints"><span class="hs-identifier hs-var">stSleepingConstraints</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682052368"><span class="annot"><a href="#local-6989586621682052368"><span class="hs-identifier hs-var">wakeup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682052369"><span class="annot"><a href="#local-6989586621682052369"><span class="hs-identifier hs-var">sleepin</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">partitionEithers</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="#local-6989586621682052371"><span class="hs-identifier hs-type">checkWakeUp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052363"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.constr.wake&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="hs-string">&quot;waking up         &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">List.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#constraintProblems"><span class="hs-identifier hs-var">constraintProblems</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682052368"><span class="hs-identifier hs-type">wakeup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="hs-string">&quot;  still sleeping: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">List.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#constraintProblems"><span class="hs-identifier hs-var">constraintProblems</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682052369"><span class="hs-identifier hs-type">sleepin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#modifySleepingConstraints"><span class="hs-identifier hs-type">modifySleepingConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><a href="#local-6989586621682052369"><span class="hs-identifier hs-type">sleepin</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#modifyAwakeConstraints"><span class="hs-identifier hs-type">modifyAwakeConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">++</span></span><span> </span><span class="annot"><span class="hs-identifier">wakeup</span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621682052371"><span class="annot"><span class="annottext">checkWakeUp :: ProblemConstraint -&gt; Either ProblemConstraint ProblemConstraint
</span><a href="#local-6989586621682052371"><span class="hs-identifier hs-var hs-var">checkWakeUp</span></a></span></span><span> </span><span id="local-6989586621682052377"><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052377"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; WakeUp
</span><a href="#local-6989586621682052362"><span class="hs-identifier hs-var">wake</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052377"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">WakeUp
</span><a href="Agda.Syntax.Internal.Blockers.html#WakeUp"><span class="hs-identifier hs-var">WakeUp</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Either ProblemConstraint ProblemConstraint
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052377"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#DontWakeUp"><span class="hs-identifier hs-type">DontWakeUp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Either ProblemConstraint ProblemConstraint
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052377"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#DontWakeUp"><span class="hs-identifier hs-type">DontWakeUp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682052378"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052378"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Either ProblemConstraint ProblemConstraint
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052377"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#constraintUnblocker"><span class="hs-identifier hs-var">constraintUnblocker</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682052378"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><span class="hs-comment">-- | Add all constraints belonging to the given problem to the current problem(s).</span></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#stealConstraintsTCM"><span class="hs-identifier hs-type">stealConstraintsTCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="stealConstraintsTCM"><span class="annot"><span class="annottext">stealConstraintsTCM :: ProblemId -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#stealConstraintsTCM"><span class="hs-identifier hs-var hs-var">stealConstraintsTCM</span></a></span></span><span> </span><span id="local-6989586621682052379"><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052379"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621682052380"><span class="annot"><a href="#local-6989586621682052380"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Set ProblemId) -&gt; TCMT IO (Set ProblemId)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Set ProblemId
</span><a href="Agda.TypeChecking.Monad.Base.html#envActiveProblems"><span class="hs-identifier hs-var">envActiveProblems</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.constr.steal&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;problem &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682052380"><span class="hs-identifier hs-type">current</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot; is stealing problem &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682052379"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;'s constraints!&quot;</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-comment">-- Add current to any constraint in pid.</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682052381"><span class="annot"><a href="#local-6989586621682052381"><span class="hs-identifier hs-var hs-var">rename</span></a></span></span><span> </span><span id="local-6989586621682052382"><span class="annot"><span class="annottext">pc :: ProblemConstraint
</span><a href="#local-6989586621682052382"><span class="hs-identifier hs-var">pc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PConstr"><span class="hs-identifier hs-type">PConstr</span></a></span><span> </span><span id="local-6989586621682052383"><span class="annot"><span class="annottext">Set ProblemId
</span><a href="#local-6989586621682052383"><span class="hs-identifier hs-var">pids</span></a></span></span><span> </span><span id="local-6989586621682052384"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052384"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682052385"><span class="annot"><span class="annottext">Closure Constraint
</span><a href="#local-6989586621682052385"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ProblemId -&gt; Set ProblemId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052379"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Set ProblemId
</span><a href="#local-6989586621682052383"><span class="hs-identifier hs-var">pids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ProblemId -&gt; Blocker -&gt; Closure Constraint -&gt; ProblemConstraint
</span><a href="Agda.TypeChecking.Monad.Base.html#PConstr"><span class="hs-identifier hs-var">PConstr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ProblemId -&gt; Set ProblemId -&gt; Set ProblemId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set ProblemId
</span><a href="#local-6989586621682052380"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="annot"><span class="annottext">Set ProblemId
</span><a href="#local-6989586621682052383"><span class="hs-identifier hs-var">pids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052384"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Closure Constraint
</span><a href="#local-6989586621682052385"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-132"></span><span>                                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052382"><span class="hs-identifier hs-var">pc</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">-- We should never steal from an active problem.</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.member</span></span><span> </span><span class="annot"><a href="#local-6989586621682052379"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envActiveProblems"><span class="hs-identifier hs-var">envActiveProblems</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#modifyAwakeConstraints"><span class="hs-identifier hs-type">modifyAwakeConstraints</span></a></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.map</span></span><span> </span><span class="annot"><a href="#local-6989586621682052381"><span class="hs-identifier hs-type">rename</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#modifySleepingConstraints"><span class="hs-identifier hs-type">modifySleepingConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.map</span></span><span> </span><span class="annot"><a href="#local-6989586621682052381"><span class="hs-identifier hs-type">rename</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-pragma hs-type">noConstraints</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span id="local-6989586621682052389"><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052389"><span class="hs-pragma hs-type">a</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052389"><span class="hs-pragma hs-type">a</span></a></span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | Error out with @'NonFatalErrors' 'UnsolvedConstraints'@</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- if the computation produced blocking constraints.</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- WARNING: this does not mean that the given computation cannot</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- constrain the solution space further.</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- It can well do so, by solving metas.</span><span>
</span><span id="line-146"></span><span id="local-6989586621682051748"><span id="local-6989586621682051749"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-type">noConstraints</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051748"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#MonadWarning"><span class="hs-identifier hs-type">MonadWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051748"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051748"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadFresh"><span class="hs-identifier hs-type">MonadFresh</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051748"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051748"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051749"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051748"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051749"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-149"></span><span id="noConstraints"><span class="annot"><span class="annottext">noConstraints :: forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var hs-var">noConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
Bool -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints%27"><span class="hs-identifier hs-var">noConstraints'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="annot"><span class="hs-comment">-- | As 'noConstraints' but also fail for non-blocking constraints.</span></span><span>
</span><span id="line-152"></span><span id="local-6989586621682052401"><span id="local-6989586621682052402"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#reallyNoConstraints"><span class="hs-identifier hs-type">reallyNoConstraints</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052401"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#MonadWarning"><span class="hs-identifier hs-type">MonadWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052401"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052401"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadFresh"><span class="hs-identifier hs-type">MonadFresh</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052401"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682052401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052402"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682052401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052402"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-155"></span><span id="reallyNoConstraints"><span class="annot"><span class="annottext">reallyNoConstraints :: forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#reallyNoConstraints"><span class="hs-identifier hs-var hs-var">reallyNoConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
Bool -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints%27"><span class="hs-identifier hs-var">noConstraints'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | Error out with @'NonFatalErrors' 'UnsolvedConstraints'@</span><span>
</span><span id="line-158"></span><span class="hs-comment">--   when given computation produced constraints ('True') or blocking constraints ('False').</span><span>
</span><span id="line-159"></span><span id="local-6989586621682051752"><span id="local-6989586621682051753"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#noConstraints%27"><span class="hs-identifier hs-type">noConstraints'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-160"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051752"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#MonadWarning"><span class="hs-identifier hs-type">MonadWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051752"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051752"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadFresh"><span class="hs-identifier hs-type">MonadFresh</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051752"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051752"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051753"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051752"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051753"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-162"></span><span id="noConstraints%27"><span class="annot"><span class="annottext">noConstraints' :: forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
Bool -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints%27"><span class="hs-identifier hs-var hs-var">noConstraints'</span></a></span></span><span> </span><span id="local-6989586621682052445"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682052445"><span class="hs-identifier hs-var">includingNonBlocking</span></a></span></span><span> </span><span id="local-6989586621682052446"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682052446"><span class="hs-identifier hs-var">problem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682052447"><span class="annot"><a href="#local-6989586621682052447"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682052448"><span class="annot"><a href="#local-6989586621682052448"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m (ProblemId, a)
forall (m :: * -&gt; *) a.
(MonadFresh ProblemId m, MonadConstraint m) =&gt;
m a -&gt; m (ProblemId, a)
</span><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-identifier hs-var">newProblem</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682052446"><span class="hs-identifier hs-var">problem</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">-- Consider only blocking constraints unless @includingNonBlocking@.</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682052450"><span class="annot"><a href="#local-6989586621682052450"><span class="hs-identifier hs-var hs-var">isBlocking</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Constraints.html#isBlockingConstraint"><span class="hs-identifier hs-var">isBlockingConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; Bool)
-&gt; (ProblemConstraint -&gt; Constraint) -&gt; ProblemConstraint -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Closure Constraint -&gt; Constraint
forall a. Closure a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#clValue"><span class="hs-identifier hs-var">clValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Constraint -&gt; Constraint)
-&gt; (ProblemConstraint -&gt; Closure Constraint)
-&gt; ProblemConstraint
-&gt; Constraint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Closure Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#theConstraint"><span class="hs-identifier hs-var">theConstraint</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621682052452"><span class="annot"><a href="#local-6989586621682052452"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html#applyUnless"><span class="hs-identifier hs-type">applyUnless</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052445"><span class="hs-identifier hs-type">includingNonBlocking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">List.filter</span></span><span> </span><span class="annot"><a href="#local-6989586621682052450"><span class="hs-identifier hs-type">isBlocking</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#getConstraintsForProblem"><span class="hs-identifier hs-type">getConstraintsForProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052447"><span class="hs-identifier hs-type">pid</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><a href="Agda.Utils.List1.html#unlessNull"><span class="hs-identifier hs-type">List1.unlessNull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052452"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052455"><span class="annot"><span class="annottext">List1 ProblemConstraint
</span><a href="#local-6989586621682052455"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">(CallStack -&gt; m ()) -&gt; m ()
forall b. HasCallStack =&gt; (CallStack -&gt; b) -&gt; b
</span><a href="Agda.Utils.CallStack.Base.html#withCurrentCallStack"><span class="hs-identifier hs-var">withCurrentCallStack</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052456"><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621682052456"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>      </span><span id="local-6989586621682052457"><span class="annot"><a href="#local-6989586621682052457"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; Warning -&gt; m TCWarning
forall (m :: * -&gt; *).
MonadWarning m =&gt;
CallStack -&gt; Warning -&gt; m TCWarning
</span><a href="Agda.TypeChecking.Warnings.html#warning%27_"><span class="hs-identifier hs-var">warning'_</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621682052456"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; m TCWarning) -&gt; Warning -&gt; m TCWarning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 ProblemConstraint -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#UnsolvedConstraints"><span class="hs-identifier hs-var">UnsolvedConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">List1 ProblemConstraint
</span><a href="#local-6989586621682052455"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError%27"><span class="hs-identifier hs-type">typeError'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052456"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NonFatalErrors"><span class="hs-identifier hs-type">NonFatalErrors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052457"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682052448"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | Run a computation that should succeeds without constraining</span><span>
</span><span id="line-174"></span><span class="hs-comment">--   the solution space, i.e., not add any information about meta-variables.</span><span>
</span><span id="line-175"></span><span id="local-6989586621682051782"><span id="local-6989586621682051783"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#nonConstraining"><span class="hs-identifier hs-type">nonConstraining</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#HasOptions"><span class="hs-identifier hs-type">HasOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#MonadDebug"><span class="hs-identifier hs-type">MonadDebug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCErr"><span class="hs-identifier hs-type">TCErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadFresh"><span class="hs-identifier hs-type">MonadFresh</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCEnv"><span class="hs-identifier hs-type">MonadTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#MonadWarning"><span class="hs-identifier hs-type">MonadWarning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051783"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051782"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051783"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-184"></span><span id="nonConstraining"><span class="annot"><span class="annottext">nonConstraining :: forall (m :: * -&gt; *) a.
(HasOptions m, MonadConstraint m, MonadDebug m, MonadError TCErr m,
 MonadFresh ProblemId m, MonadTCEnv m, MonadWarning m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#nonConstraining"><span class="hs-identifier hs-var hs-var">nonConstraining</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#dontAssignMetas"><span class="hs-identifier hs-var">dontAssignMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; (m a -&gt; m a) -&gt; m a -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-pragma hs-type">newProblem</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span id="local-6989586621682052477"><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052477"><span class="hs-pragma hs-type">a</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-pragma hs-type">ProblemId</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="#local-6989586621682052477"><span class="hs-pragma hs-type">a</span></a></span><span class="hs-pragma">)</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-187"></span><span class="annot"><span class="hs-comment">-- | Create a fresh problem for the given action.</span></span><span>
</span><span id="line-188"></span><span id="local-6989586621682051767"><span id="local-6989586621682051768"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-identifier hs-type">newProblem</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadFresh"><span class="hs-identifier hs-type">MonadFresh</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051767"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051767"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051768"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682051768"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-191"></span><span id="newProblem"><span class="annot"><span class="annottext">newProblem :: forall (m :: * -&gt; *) a.
(MonadFresh ProblemId m, MonadConstraint m) =&gt;
m a -&gt; m (ProblemId, a)
</span><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-identifier hs-var hs-var">newProblem</span></a></span></span><span> </span><span id="local-6989586621682052491"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682052491"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621682052492"><span class="annot"><a href="#local-6989586621682052492"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ProblemId
forall i (m :: * -&gt; *). MonadFresh i m =&gt; m i
</span><a href="Agda.TypeChecking.Monad.Base.html#fresh"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-comment">-- Don't get distracted by other constraints while working on the problem</span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621682052494"><span class="annot"><a href="#local-6989586621682052494"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#nowSolvingConstraints"><span class="hs-identifier hs-type">nowSolvingConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#solvingProblem"><span class="hs-identifier hs-type">solvingProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052492"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052491"><span class="hs-identifier hs-type">action</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-comment">-- Now we can check any woken constraints</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#solveAwakeConstraints"><span class="hs-identifier hs-type">solveAwakeConstraints</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682052492"><span class="hs-identifier hs-type">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682052494"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#newProblem_"><span class="hs-pragma hs-type">newProblem_</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span id="local-6989586621682052499"><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052499"><span class="hs-pragma hs-type">a</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-pragma hs-type">ProblemId</span></a></span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-200"></span><span id="local-6989586621682051797"><span id="local-6989586621682051798"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#newProblem_"><span class="hs-identifier hs-type">newProblem_</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadFresh"><span class="hs-identifier hs-type">MonadFresh</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051797"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#MonadConstraint"><span class="hs-identifier hs-type">MonadConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051797"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051798"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span></span></span><span>
</span><span id="line-203"></span><span id="newProblem_"><span class="annot"><span class="annottext">newProblem_ :: forall (m :: * -&gt; *) a.
(MonadFresh ProblemId m, MonadConstraint m) =&gt;
m a -&gt; m ProblemId
</span><a href="Agda.TypeChecking.Constraints.html#newProblem_"><span class="hs-identifier hs-var hs-var">newProblem_</span></a></span></span><span> </span><span id="local-6989586621682052507"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682052507"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ProblemId, a) -&gt; ProblemId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((ProblemId, a) -&gt; ProblemId) -&gt; m (ProblemId, a) -&gt; m ProblemId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m (ProblemId, a)
forall (m :: * -&gt; *) a.
(MonadFresh ProblemId m, MonadConstraint m) =&gt;
m a -&gt; m (ProblemId, a)
</span><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-identifier hs-var">newProblem</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682052507"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621682051803"><span id="local-6989586621682051804"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints"><span class="hs-identifier hs-type">ifNoConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051803"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682051803"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051804"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051803"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051804"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051804"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-206"></span><span id="ifNoConstraints"><span class="annot"><span class="annottext">ifNoConstraints :: forall a b.
TCM a -&gt; (a -&gt; TCM b) -&gt; (ProblemId -&gt; a -&gt; TCM b) -&gt; TCM b
</span><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints"><span class="hs-identifier hs-var hs-var">ifNoConstraints</span></a></span></span><span> </span><span id="local-6989586621682052516"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682052516"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682052517"><span class="annot"><span class="annottext">a -&gt; TCM b
</span><a href="#local-6989586621682052517"><span class="hs-identifier hs-var">ifNo</span></a></span></span><span> </span><span id="local-6989586621682052518"><span class="annot"><span class="annottext">ProblemId -&gt; a -&gt; TCM b
</span><a href="#local-6989586621682052518"><span class="hs-identifier hs-var">ifCs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682052519"><span class="annot"><a href="#local-6989586621682052519"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682052520"><span class="annot"><a href="#local-6989586621682052520"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; TCMT IO (ProblemId, a)
forall (m :: * -&gt; *) a.
(MonadFresh ProblemId m, MonadConstraint m) =&gt;
m a -&gt; m (ProblemId, a)
</span><a href="Agda.TypeChecking.Constraints.html#newProblem"><span class="hs-identifier hs-var">newProblem</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682052516"><span class="hs-identifier hs-var">check</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Constraints.html#isProblemSolved"><span class="hs-identifier hs-type">isProblemSolved</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052519"><span class="hs-identifier hs-type">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682052517"><span class="hs-identifier hs-type">ifNo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052520"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682052518"><span class="hs-identifier hs-type">ifCs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052519"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052520"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span id="local-6989586621682051810"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints_"><span class="hs-identifier hs-type">ifNoConstraints_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051810"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ProblemId"><span class="hs-identifier hs-type">ProblemId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051810"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051810"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-211"></span><span id="ifNoConstraints_"><span class="annot"><span class="annottext">ifNoConstraints_ :: forall a. TCM () -&gt; TCM a -&gt; (ProblemId -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints_"><span class="hs-identifier hs-var hs-var">ifNoConstraints_</span></a></span></span><span> </span><span id="local-6989586621682052524"><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052524"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682052525"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682052525"><span class="hs-identifier hs-var">ifNo</span></a></span></span><span> </span><span id="local-6989586621682052526"><span class="annot"><span class="annottext">ProblemId -&gt; TCM a
</span><a href="#local-6989586621682052526"><span class="hs-identifier hs-var">ifCs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; (() -&gt; TCM a) -&gt; (ProblemId -&gt; () -&gt; TCM a) -&gt; TCM a
forall a b.
TCM a -&gt; (a -&gt; TCM b) -&gt; (ProblemId -&gt; a -&gt; TCM b) -&gt; TCM b
</span><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints"><span class="hs-identifier hs-var">ifNoConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052524"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM a -&gt; () -&gt; TCM a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682052525"><span class="hs-identifier hs-var">ifNo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682052527"><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052527"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProblemId -&gt; TCM a
</span><a href="#local-6989586621682052526"><span class="hs-identifier hs-var">ifCs</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052527"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- | @guardConstraint c blocker@ tries to solve @blocker@ first.</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   If successful without constraints, it moves on to solve @c@, otherwise it</span><span>
</span><span id="line-215"></span><span class="hs-comment">--   adds a @c@ to the constraint pool, blocked by the problem generated by @blocker@.</span><span>
</span><span id="line-216"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#guardConstraint"><span class="hs-identifier hs-type">guardConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span id="guardConstraint"><span class="annot"><span class="annottext">guardConstraint :: Constraint -&gt; TCM () -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#guardConstraint"><span class="hs-identifier hs-var hs-var">guardConstraint</span></a></span></span><span> </span><span id="local-6989586621682052529"><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052529"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682052530"><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052530"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; TCM () -&gt; (ProblemId -&gt; TCM ()) -&gt; TCM ()
forall a. TCM () -&gt; TCM a -&gt; (ProblemId -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints_"><span class="hs-identifier hs-var">ifNoConstraints_</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052530"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint -&gt; TCM ()
forall (m :: * -&gt; *). MonadConstraint m =&gt; Constraint -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#solveConstraint"><span class="hs-identifier hs-var">solveConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052529"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052531"><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052531"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Constraint -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
Blocker -&gt; Constraint -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#addConstraint"><span class="hs-identifier hs-var">addConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProblemId -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#unblockOnProblem"><span class="hs-identifier hs-var">unblockOnProblem</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052531"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052529"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#whenConstraints"><span class="hs-identifier hs-type">whenConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span id="whenConstraints"><span class="annot"><span class="annottext">whenConstraints :: TCM () -&gt; TCM () -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#whenConstraints"><span class="hs-identifier hs-var hs-var">whenConstraints</span></a></span></span><span> </span><span id="local-6989586621682052534"><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052534"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621682052535"><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052535"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><span class="annottext">TCM () -&gt; TCM () -&gt; (ProblemId -&gt; TCM ()) -&gt; TCM ()
forall a. TCM () -&gt; TCM a -&gt; (ProblemId -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Constraints.html#ifNoConstraints_"><span class="hs-identifier hs-var">ifNoConstraints_</span></a></span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052534"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ProblemId -&gt; TCM ()) -&gt; TCM ())
-&gt; (ProblemId -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682052536"><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052536"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="annottext">ProblemId -&gt; TCM ()
forall (m :: * -&gt; *). MonadConstraint m =&gt; ProblemId -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#stealConstraints"><span class="hs-identifier hs-var">stealConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemId
</span><a href="#local-6989586621682052536"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052535"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#wakeupConstraints"><span class="hs-pragma hs-type">wakeupConstraints</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-pragma hs-type">MetaId</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-pragma hs-type">TCM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-227"></span><span class="annot"><span class="hs-comment">-- | Wake up the constraints depending on the given meta.</span></span><span>
</span><span id="line-228"></span><span id="local-6989586621682051812"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#wakeupConstraints"><span class="hs-identifier hs-type">wakeupConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadMetaSolver"><span class="hs-identifier hs-type">MonadMetaSolver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051812"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051812"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-229"></span><span id="wakeupConstraints"><span class="annot"><span class="annottext">wakeupConstraints :: forall (m :: * -&gt; *). MonadMetaSolver m =&gt; MetaId -&gt; m ()
</span><a href="Agda.TypeChecking.Constraints.html#wakeupConstraints"><span class="hs-identifier hs-var hs-var">wakeupConstraints</span></a></span></span><span> </span><span id="local-6989586621682052548"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052548"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; WakeUp) -&gt; m ()
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
(ProblemConstraint -&gt; WakeUp) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#wakeConstraints%27"><span class="hs-identifier hs-var">wakeConstraints'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Blocker -&gt; WakeUp
</span><a href="Agda.Syntax.Internal.Blockers.html#wakeIfBlockedOnMeta"><span class="hs-identifier hs-var">wakeIfBlockedOnMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052548"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; WakeUp)
-&gt; (ProblemConstraint -&gt; Blocker) -&gt; ProblemConstraint -&gt; WakeUp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Blocker
</span><a href="Agda.TypeChecking.Monad.Base.html#constraintUnblocker"><span class="hs-identifier hs-var">constraintUnblocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). MonadConstraint m =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#solveAwakeConstraints"><span class="hs-identifier hs-var">solveAwakeConstraints</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><span class="hs-comment">-- | Wake up all constraints not blocked on a problem.</span></span><span>
</span><span id="line-234"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#wakeupConstraints_"><span class="hs-identifier hs-type">wakeupConstraints_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span id="wakeupConstraints_"><span class="annot"><span class="annottext">wakeupConstraints_ :: TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#wakeupConstraints_"><span class="hs-identifier hs-var hs-var">wakeupConstraints_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; WakeUp) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
(ProblemConstraint -&gt; WakeUp) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#wakeConstraints%27"><span class="hs-identifier hs-var">wakeConstraints'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; WakeUp
</span><a href="#local-6989586621682052551"><span class="hs-identifier hs-var">wakeup</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; WakeUp)
-&gt; (ProblemConstraint -&gt; Blocker) -&gt; ProblemConstraint -&gt; WakeUp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Blocker
</span><a href="Agda.TypeChecking.Monad.Base.html#constraintUnblocker"><span class="hs-identifier hs-var">constraintUnblocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="annottext">TCM ()
forall (m :: * -&gt; *). MonadConstraint m =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#solveAwakeConstraints"><span class="hs-identifier hs-var">solveAwakeConstraints</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621682052551"><span class="annot"><span class="annottext">wakeup :: Blocker -&gt; WakeUp
</span><a href="#local-6989586621682052551"><span class="hs-identifier hs-var hs-var">wakeup</span></a></span></span><span> </span><span id="local-6989586621682052552"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052552"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set ProblemId -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">(Set ProblemId -&gt; Bool) -&gt; Set ProblemId -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Set ProblemId
</span><a href="Agda.Syntax.Internal.Blockers.html#allBlockingProblems"><span class="hs-identifier hs-var">allBlockingProblems</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052552"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WakeUp
</span><a href="Agda.Syntax.Internal.Blockers.html#WakeUp"><span class="hs-identifier hs-var">WakeUp</span></a></span><span>
</span><span id="line-240"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Blocker -&gt; WakeUp
</span><a href="Agda.Syntax.Internal.Blockers.html#DontWakeUp"><span class="hs-identifier hs-var">DontWakeUp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Blocker
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Solve awake constraints matching the predicate. If the second argument is</span><span>
</span><span id="line-243"></span><span class="hs-comment">--   True solve constraints even if already 'isSolvingConstraints'.</span><span>
</span><span id="line-244"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveSomeAwakeConstraintsTCM"><span class="hs-identifier hs-type">solveSomeAwakeConstraintsTCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ProblemConstraint"><span class="hs-identifier hs-type">ProblemConstraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span id="solveSomeAwakeConstraintsTCM"><span class="annot"><span class="annottext">solveSomeAwakeConstraintsTCM :: (ProblemConstraint -&gt; Bool) -&gt; Bool -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#solveSomeAwakeConstraintsTCM"><span class="hs-identifier hs-var hs-var">solveSomeAwakeConstraintsTCM</span></a></span></span><span> </span><span id="local-6989586621682052556"><span class="annot"><span class="annottext">ProblemConstraint -&gt; Bool
</span><a href="#local-6989586621682052556"><span class="hs-identifier hs-var">solveThis</span></a></span></span><span> </span><span id="local-6989586621682052557"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682052557"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">ProfileOption -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; ProfileOption -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#whenProfile"><span class="hs-identifier hs-var">whenProfile</span></a></span><span> </span><span class="annot"><span class="annottext">ProfileOption
</span><a href="Agda.Interaction.Options.ProfileOptions.html#Constraints"><span class="hs-identifier hs-var">Profile.Constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall a. TCM a -&gt; TCM a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Word64 -&gt; TCM ()
forall (m :: * -&gt; *). MonadStatistics m =&gt; [Char] -&gt; Word64 -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Statistics.html#tickMax"><span class="hs-identifier hs-var">tickMax</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;max-open-constraints&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; TCM ())
-&gt; (Constraints -&gt; Word64) -&gt; Constraints -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Constraints -&gt; Word64
forall i a. Num i =&gt; [a] -&gt; i
</span><span class="hs-identifier hs-var">List.genericLength</span></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; TCM ()) -&gt; TCMT IO Constraints -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Constraints
forall (m :: * -&gt; *). ReadTCState m =&gt; m Constraints
</span><a href="Agda.TypeChecking.Monad.Constraints.html#getAllConstraints"><span class="hs-identifier hs-var">getAllConstraints</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682052557"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.Constraints.html#isSolvingConstraints"><span class="hs-identifier hs-var">isSolvingConstraints</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Constraints.html#nowSolvingConstraints"><span class="hs-identifier hs-var">nowSolvingConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>     </span><span class="hs-comment">-- solveSizeConstraints -- Andreas, 2012-09-27 attacks size constrs too early</span><span>
</span><span id="line-249"></span><span>     </span><span class="hs-comment">-- Ulf, 2016-12-06: Don't inherit problems here! Stored constraints</span><span>
</span><span id="line-250"></span><span>     </span><span class="hs-comment">-- already contain all their dependencies.</span><span>
</span><span id="line-251"></span><span>     </span><span class="annot"><span class="annottext">Lens' TCEnv (Set ProblemId)
-&gt; (Set ProblemId -&gt; Set ProblemId) -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a b.
MonadTCEnv m =&gt;
Lens' TCEnv a -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-var">locallyTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Set ProblemId -&gt; f (Set ProblemId)) -&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv (Set ProblemId)
</span><a href="Agda.TypeChecking.Monad.Base.html#eActiveProblems"><span class="hs-identifier hs-var">eActiveProblems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ProblemId -&gt; Set ProblemId -&gt; Set ProblemId
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Set ProblemId
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052570"><span class="hs-identifier hs-var">solve</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621682052570"><span class="annot"><span class="annottext">solve :: TCM ()
</span><a href="#local-6989586621682052570"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.solve&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Solving awake constraints.&quot;</span></span><span>
</span><span id="line-255"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc)
-&gt; (Constraints -&gt; [Char]) -&gt; Constraints -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Char]) -&gt; (Constraints -&gt; Int) -&gt; Constraints -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Constraints -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; TCMT IO Doc) -&gt; TCMT IO Constraints -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Constraints
forall (m :: * -&gt; *). ReadTCState m =&gt; m Constraints
</span><a href="Agda.TypeChecking.Monad.Constraints.html#getAwakeConstraints"><span class="hs-identifier hs-var">getAwakeConstraints</span></a></span><span>
</span><span id="line-256"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;remaining.&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO (Maybe ProblemConstraint)
-&gt; (ProblemConstraint -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; Bool) -&gt; TCMT IO (Maybe ProblemConstraint)
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
(ProblemConstraint -&gt; Bool) -&gt; m (Maybe ProblemConstraint)
</span><a href="Agda.TypeChecking.Monad.Constraints.html#takeAwakeConstraint%27"><span class="hs-identifier hs-var">takeAwakeConstraint'</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Bool
</span><a href="#local-6989586621682052556"><span class="hs-identifier hs-var">solveThis</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ProblemConstraint -&gt; TCM ()) -&gt; TCM ())
-&gt; (ProblemConstraint -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052576"><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052576"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">(Constraint -&gt; TCM ()) -&gt; ProblemConstraint -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadConstraint m =&gt;
(Constraint -&gt; m a) -&gt; ProblemConstraint -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Constraints.html#withConstraint"><span class="hs-identifier hs-var">withConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; TCM ()
forall (m :: * -&gt; *). MonadConstraint m =&gt; Constraint -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#solveConstraint"><span class="hs-identifier hs-var">solveConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint
</span><a href="#local-6989586621682052576"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="annottext">TCM ()
</span><a href="#local-6989586621682052570"><span class="hs-identifier hs-var">solve</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraintTCM"><span class="hs-identifier hs-type">solveConstraintTCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span id="solveConstraintTCM"><span class="annot"><span class="annottext">solveConstraintTCM :: Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#solveConstraintTCM"><span class="hs-identifier hs-var hs-var">solveConstraintTCM</span></a></span></span><span> </span><span id="local-6989586621682052578"><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621682052578"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="annottext">ProfileOption -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; ProfileOption -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#whenProfile"><span class="hs-identifier hs-var">whenProfile</span></a></span><span> </span><span class="annot"><span class="annottext">ProfileOption
</span><a href="Agda.Interaction.Options.ProfileOptions.html#Constraints"><span class="hs-identifier hs-var">Profile.Constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall a. TCM a -&gt; TCM a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCM ()
forall (m :: * -&gt; *). MonadStatistics m =&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Statistics.html#tick"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;attempted-constraints&quot;</span></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCM () -&gt; TCM ()
forall a. [Char] -&gt; Int -&gt; [Char] -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseBracket"><span class="hs-identifier hs-var">verboseBracket</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.solve&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;solving constraint&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621682052581"><span class="annot"><a href="#local-6989586621682052581"><span class="hs-identifier hs-var">pids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Set ProblemId) -&gt; TCMT IO (Set ProblemId)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Set ProblemId
</span><a href="Agda.TypeChecking.Monad.Base.html#envActiveProblems"><span class="hs-identifier hs-var">envActiveProblems</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.constr.solve.constr&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682052581"><span class="hs-identifier hs-type">pids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052578"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-type">solveConstraint_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052578"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-type">solveConstraint_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span id="solveConstraint_"><span class="annot"><span class="annottext">solveConstraint_ :: Constraint -&gt; TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var hs-var">solveConstraint_</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ValueCmp"><span class="hs-identifier hs-type">ValueCmp</span></a></span><span> </span><span id="local-6989586621682052583"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052583"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052584"><span class="annot"><span class="annottext">CompareAs
</span><a href="#local-6989586621682052584"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052585"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052585"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682052586"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052586"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; CompareAs -&gt; Term -&gt; Term -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Comparison -&gt; CompareAs -&gt; Term -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#compareAs"><span class="hs-identifier hs-var">compareAs</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052583"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">CompareAs
</span><a href="#local-6989586621682052584"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052585"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052586"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-271"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ValueCmpOnFace"><span class="hs-identifier hs-type">ValueCmpOnFace</span></a></span><span> </span><span id="local-6989586621682052589"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052589"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052590"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052590"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682052591"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052591"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052592"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052592"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682052593"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052593"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Term -&gt; Type -&gt; Term -&gt; Term -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Comparison -&gt; Term -&gt; Type -&gt; Term -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#compareTermOnFace"><span class="hs-identifier hs-var">compareTermOnFace</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052589"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052590"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052591"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052592"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052593"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ElimCmp"><span class="hs-identifier hs-type">ElimCmp</span></a></span><span> </span><span id="local-6989586621682052596"><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621682052596"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052597"><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621682052597"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682052598"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052598"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052599"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052599"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682052600"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621682052600"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682052601"><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621682052601"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Polarity]
-&gt; [IsForced] -&gt; Type -&gt; Term -&gt; [Elim] -&gt; [Elim] -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
[Polarity]
-&gt; [IsForced] -&gt; Type -&gt; Term -&gt; [Elim] -&gt; [Elim] -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#compareElims"><span class="hs-identifier hs-var">compareElims</span></a></span><span> </span><span class="annot"><span class="annottext">[Polarity]
</span><a href="#local-6989586621682052596"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">[IsForced]
</span><a href="#local-6989586621682052597"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052598"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052599"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621682052600"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[Elim]
</span><a href="#local-6989586621682052601"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-273"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#SortCmp"><span class="hs-identifier hs-type">SortCmp</span></a></span><span> </span><span id="local-6989586621682052604"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052604"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052605"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052605"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682052606"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052606"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Sort -&gt; Sort -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Comparison -&gt; Sort -&gt; Sort -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#compareSort"><span class="hs-identifier hs-var">compareSort</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052604"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052605"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052606"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LevelCmp"><span class="hs-identifier hs-type">LevelCmp</span></a></span><span> </span><span id="local-6989586621682052608"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052608"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052609"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682052609"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052610"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682052610"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Level -&gt; Level -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Comparison -&gt; Level -&gt; Level -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#compareLevel"><span class="hs-identifier hs-var">compareLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052608"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682052609"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682052610"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsEmpty"><span class="hs-identifier hs-type">IsEmpty</span></a></span><span> </span><span id="local-6989586621682052613"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682052613"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682052614"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052614"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Empty.html#ensureEmptyType"><span class="hs-identifier hs-var">ensureEmptyType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682052613"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052614"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-276"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckSizeLtSat"><span class="hs-identifier hs-type">CheckSizeLtSat</span></a></span><span> </span><span id="local-6989586621682052617"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052617"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM ()
</span><a href="Agda.TypeChecking.SizedTypes.html#checkSizeLtSat"><span class="hs-identifier hs-var">checkSizeLtSat</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052617"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-277"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UnquoteTactic"><span class="hs-identifier hs-type">UnquoteTactic</span></a></span><span> </span><span id="local-6989586621682052620"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052620"><span class="hs-identifier hs-var">tac</span></a></span></span><span> </span><span id="local-6989586621682052621"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052621"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span id="local-6989586621682052622"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052622"><span class="hs-identifier hs-var">goal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Term.html#unquoteTactic"><span class="hs-identifier hs-var">unquoteTactic</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052620"><span class="hs-identifier hs-var">tac</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052621"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052622"><span class="hs-identifier hs-var">goal</span></a></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UnBlock"><span class="hs-identifier hs-type">UnBlock</span></a></span><span> </span><span id="local-6989586621682052625"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span>   </span><span class="hs-comment">-- alwaysUnblock since these have their own unblocking logic (for now)</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isFrozen"><span class="hs-identifier hs-var">isFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#or2M"><span class="hs-operator hs-var">`or2M`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Bool) -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#envAssignMetas"><span class="hs-identifier hs-var">envAssignMetas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.unblock&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;not unblocking&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; MetaId -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;because&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>                                                  </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isFrozen"><span class="hs-identifier hs-var">isFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;it's frozen&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;meta assignments are turned off&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">Blocker -&gt; Constraint -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
Blocker -&gt; Constraint -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#addConstraint"><span class="hs-identifier hs-var">addConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-var">alwaysUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; TCM ()) -&gt; Constraint -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#UnBlock"><span class="hs-identifier hs-var">UnBlock</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621682052629"><span class="annot"><a href="#local-6989586621682052629"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaInstantiation
forall (m :: * -&gt; *).
ReadTCState m =&gt;
MetaId -&gt; m MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMetaInstantiation"><span class="hs-identifier hs-var">lookupMetaInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.constr.unblock&quot;</span></span><span> </span><span class="annot"><span class="hs-number">65</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unblocking a metavar yields the constraint:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052629"><span class="hs-identifier hs-type">inst</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682052629"><span class="hs-identifier hs-type">inst</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#BlockedConst"><span class="hs-identifier hs-type">BlockedConst</span></a></span><span> </span><span id="local-6989586621682052633"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052633"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr.blocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;blocked const &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; :=&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052633"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">MetaId -&gt; [Arg [Char]] -&gt; Term -&gt; TCM ()
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
MetaId -&gt; [Arg [Char]] -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.MetaVars.html#assignTerm"><span class="hs-identifier hs-var">assignTerm</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052625"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052633"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PostponedTypeCheckingProblem"><span class="hs-identifier hs-type">PostponedTypeCheckingProblem</span></a></span><span> </span><span id="local-6989586621682052636"><span class="annot"><span class="annottext">Closure TypeCheckingProblem
</span><a href="#local-6989586621682052636"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Closure TypeCheckingProblem
-&gt; (TypeCheckingProblem -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) c a b.
(MonadTCEnv m, ReadTCState m, LensClosure c a) =&gt;
c -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Closure TypeCheckingProblem
</span><a href="#local-6989586621682052636"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">((TypeCheckingProblem -&gt; TCM ()) -&gt; TCM ())
-&gt; (TypeCheckingProblem -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682052638"><span class="annot"><span class="annottext">TypeCheckingProblem
</span><a href="#local-6989586621682052638"><span class="hs-identifier hs-var">prob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>          </span><span id="local-6989586621682052639"><span class="annot"><a href="#local-6989586621682052639"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-292"></span><span>          </span><span id="local-6989586621682052641"><span class="annot"><a href="#local-6989586621682052641"><span class="hs-identifier hs-var">v</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#checkTypeCheckingProblem"><span class="hs-identifier hs-type">checkTypeCheckingProblem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052638"><span class="hs-identifier hs-type">prob</span></a></span><span>
</span><span id="line-293"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#assignTerm"><span class="hs-identifier hs-type">assignTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052625"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#telToArgs"><span class="hs-identifier hs-type">telToArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052639"><span class="hs-identifier hs-type">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682052641"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-comment">-- Andreas, 2009-02-09, the following were IMPOSSIBLE cases</span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-comment">-- somehow they pop up in the context of sized types</span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-comment">-- already solved metavariables: should only happen for size</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-comment">-- metas (not sure why it does, Andreas?)</span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-comment">-- Andreas, 2017-07-11:</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-comment">-- I think this is because the size solver instantiates</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-comment">-- some metas with infinity but does not clean up the UnBlock constraints.</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-comment">-- See also issue #2637.</span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-comment">-- Ulf, 2018-04-30: The size solver shouldn't touch blocked terms! They have</span><span>
</span><span id="line-304"></span><span>      </span><span class="hs-comment">-- a twin meta that it's safe to solve.</span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InstV"><span class="hs-identifier hs-type">InstV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#OpenMeta"><span class="hs-identifier hs-type">OpenMeta</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-307"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#FindInstance"><span class="hs-identifier hs-type">FindInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682052646"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052646"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682052647"><span class="annot"><span class="annottext">Maybe [Candidate]
</span><a href="#local-6989586621682052647"><span class="hs-identifier hs-var">cands</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Maybe [Candidate] -&gt; TCM ()
</span><a href="Agda.TypeChecking.InstanceArguments.html#findInstance"><span class="hs-identifier hs-var">findInstance</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052646"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Candidate]
</span><a href="#local-6989586621682052647"><span class="hs-identifier hs-var">cands</span></a></span><span>
</span><span id="line-308"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ResolveInstanceHead"><span class="hs-identifier hs-type">ResolveInstanceHead</span></a></span><span> </span><span id="local-6989586621682052650"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682052650"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.InstanceArguments.html#resolveInstanceHead"><span class="hs-identifier hs-var">resolveInstanceHead</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682052650"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-309"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckFunDef"><span class="hs-identifier hs-type">CheckFunDef</span></a></span><span> </span><span id="local-6989586621682052653"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682052653"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682052654"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682052654"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682052655"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682052655"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682052656"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682052656"><span class="hs-identifier hs-var">_err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(MonadTCState m, ReadTCState m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Caching.html#withoutCache"><span class="hs-identifier hs-var">withoutCache</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-comment">-- re #3498: checking a fundef would normally be cached, but here it's</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- happening out of order so it would only corrupt the caching log.</span><span>
</span><span id="line-312"></span><span>  </span><span class="annot"><span class="annottext">DefInfo -&gt; QName -&gt; [Clause] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef"><span class="hs-identifier hs-var">checkFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682052653"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682052654"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682052655"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-313"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckLockedVars"><span class="hs-identifier hs-type">CheckLockedVars</span></a></span><span> </span><span id="local-6989586621682052660"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052660"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052661"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052661"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682052662"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682052662"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682052663"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052663"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type -&gt; Arg Term -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Lock.html#checkLockedVars"><span class="hs-identifier hs-var">checkLockedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052660"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052661"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682052662"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052663"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HasBiggerSort"><span class="hs-identifier hs-type">HasBiggerSort</span></a></span><span> </span><span id="local-6989586621682052666"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052666"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; TCM ()
</span><a href="Agda.TypeChecking.Sort.html#hasBiggerSort"><span class="hs-identifier hs-var">hasBiggerSort</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052666"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-315"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HasPTSRule"><span class="hs-identifier hs-type">HasPTSRule</span></a></span><span> </span><span id="local-6989586621682052669"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682052669"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052670"><span class="annot"><span class="annottext">Abs Sort
</span><a href="#local-6989586621682052670"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Sort -&gt; TCM ()
</span><a href="Agda.TypeChecking.Sort.html#hasPTSRule"><span class="hs-identifier hs-var">hasPTSRule</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682052669"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Sort
</span><a href="#local-6989586621682052670"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckDataSort"><span class="hs-identifier hs-type">CheckDataSort</span></a></span><span> </span><span id="local-6989586621682052673"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682052673"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682052674"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052674"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Sort -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Data.html#checkDataSort"><span class="hs-identifier hs-var">checkDataSort</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682052673"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682052674"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckMetaInst"><span class="hs-identifier hs-type">CheckMetaInst</span></a></span><span> </span><span id="local-6989586621682052676"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052676"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.html#checkMetaInst"><span class="hs-identifier hs-var">checkMetaInst</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682052676"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-318"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckType"><span class="hs-identifier hs-type">CheckType</span></a></span><span> </span><span id="local-6989586621682052679"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052679"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM ()
forall (m :: * -&gt; *). MonadCheckInternal m =&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.CheckInternal.html#checkType"><span class="hs-identifier hs-var">checkType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052679"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-319"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#solveConstraint_"><span class="hs-identifier hs-var">solveConstraint_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#UsableAtModality"><span class="hs-identifier hs-type">UsableAtModality</span></a></span><span> </span><span id="local-6989586621682052681"><span class="annot"><span class="annottext">WhyCheckModality
</span><a href="#local-6989586621682052681"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682052682"><span class="annot"><span class="annottext">Maybe Sort
</span><a href="#local-6989586621682052682"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621682052683"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682052683"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682052684"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052684"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Sort -&gt; WhyCheckModality -&gt; Modality -&gt; Term -&gt; TCM ()
MonadConstraint (TCMT IO) =&gt;
Maybe Sort -&gt; WhyCheckModality -&gt; Modality -&gt; Term -&gt; TCM ()
</span><a href="Agda.TypeChecking.Irrelevance.html#usableAtModality%27"><span class="hs-identifier hs-var">usableAtModality'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Sort
</span><a href="#local-6989586621682052682"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">WhyCheckModality
</span><a href="#local-6989586621682052681"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682052683"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052684"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#checkTypeCheckingProblem"><span class="hs-identifier hs-type">checkTypeCheckingProblem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeCheckingProblem"><span class="hs-identifier hs-type">TypeCheckingProblem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-322"></span><span id="checkTypeCheckingProblem"><span class="annot"><span class="annottext">checkTypeCheckingProblem :: TypeCheckingProblem -&gt; TCM Term
</span><a href="Agda.TypeChecking.Constraints.html#checkTypeCheckingProblem"><span class="hs-identifier hs-var hs-var">checkTypeCheckingProblem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckExpr"><span class="hs-identifier hs-type">CheckExpr</span></a></span><span> </span><span id="local-6989586621682052687"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052687"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052688"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052688"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682052689"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052689"><span class="hs-identifier hs-var">t</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr%27"><span class="hs-identifier hs-var">checkExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052687"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052688"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052689"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckArgs"><span class="hs-identifier hs-type">CheckArgs</span></a></span><span> </span><span id="local-6989586621682052692"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052692"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052693"><span class="annot"><span class="annottext">ExpandHidden
</span><a href="#local-6989586621682052693"><span class="hs-identifier hs-var">eh</span></a></span></span><span> </span><span id="local-6989586621682052694"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052694"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682052695"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682052695"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682052696"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052696"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span id="local-6989586621682052697"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052697"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682052698"><span class="annot"><span class="annottext">ArgsCheckState CheckedTarget -&gt; TCM Term
</span><a href="#local-6989586621682052698"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; ExpandHidden
-&gt; Expr
-&gt; [NamedArg Expr]
-&gt; Type
-&gt; Type
-&gt; (ArgsCheckState CheckedTarget -&gt; TCM Term)
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Application.html#checkArguments"><span class="hs-identifier hs-var">checkArguments</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052692"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpandHidden
</span><a href="#local-6989586621682052693"><span class="hs-identifier hs-var">eh</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052694"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682052695"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052696"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052697"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">ArgsCheckState CheckedTarget -&gt; TCM Term
</span><a href="#local-6989586621682052698"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckProjAppToKnownPrincipalArg"><span class="hs-identifier hs-type">CheckProjAppToKnownPrincipalArg</span></a></span><span> </span><span id="local-6989586621682052701"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052701"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052702"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052702"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682052703"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682052703"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682052704"><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682052704"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682052705"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052705"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621682052706"><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682052706"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682052707"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052707"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682052708"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682052708"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682052709"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052709"><span class="hs-identifier hs-var">v0</span></a></span></span><span> </span><span id="local-6989586621682052710"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052710"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621682052711"><span class="annot"><span class="annottext">PrincipalArgTypeMetas
</span><a href="#local-6989586621682052711"><span class="hs-identifier hs-var">patm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">Comparison
-&gt; Expr
-&gt; ProjOrigin
-&gt; List1 QName
-&gt; Expr
-&gt; [NamedArg Expr]
-&gt; Type
-&gt; Int
-&gt; Term
-&gt; Type
-&gt; PrincipalArgTypeMetas
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Application.html#checkProjAppToKnownPrincipalArg"><span class="hs-identifier hs-var">checkProjAppToKnownPrincipalArg</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052701"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052702"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682052703"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621682052704"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052705"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg Expr]
</span><a href="#local-6989586621682052706"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052707"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682052708"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052709"><span class="hs-identifier hs-var">v0</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052710"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">PrincipalArgTypeMetas
</span><a href="#local-6989586621682052711"><span class="hs-identifier hs-var">patm</span></a></span><span>
</span><span id="line-327"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckLambda"><span class="hs-identifier hs-type">CheckLambda</span></a></span><span> </span><span id="local-6989586621682052714"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052714"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052715"><span class="annot"><span class="annottext">Arg (List1 (WithHiding Name), Maybe Type)
</span><a href="#local-6989586621682052715"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682052716"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052716"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682052717"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052717"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison
-&gt; Arg (List1 (WithHiding Name), Maybe Type)
-&gt; Expr
-&gt; Type
-&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkPostponedLambda"><span class="hs-identifier hs-var">checkPostponedLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052714"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (List1 (WithHiding Name), Maybe Type)
</span><a href="#local-6989586621682052715"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682052716"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052717"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DoQuoteTerm"><span class="hs-identifier hs-type">DoQuoteTerm</span></a></span><span> </span><span id="local-6989586621682052720"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052720"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682052721"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052721"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621682052722"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052722"><span class="hs-identifier hs-var">t</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Term -&gt; Type -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Term.html#doQuoteTerm"><span class="hs-identifier hs-var">doQuoteTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682052720"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682052721"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682052722"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisambiguateConstructor"><span class="hs-identifier hs-type">DisambiguateConstructor</span></a></span><span> </span><span id="local-6989586621682052725"><span class="annot"><span class="annottext">ConstructorDisambiguationData
</span><a href="#local-6989586621682052725"><span class="hs-identifier hs-var">bcd</span></a></span></span><span> </span><span id="local-6989586621682052726"><span class="annot"><span class="annottext">ConHead -&gt; TCM Term
</span><a href="#local-6989586621682052726"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConstructorDisambiguationData -&gt; (ConHead -&gt; TCM Term) -&gt; TCM Term
</span><a href="Agda.TypeChecking.Rules.Application.html#disambiguateConstructor%27"><span class="hs-identifier hs-var">disambiguateConstructor'</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorDisambiguationData
</span><a href="#local-6989586621682052725"><span class="hs-identifier hs-var">bcd</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; TCM Term
</span><a href="#local-6989586621682052726"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#debugConstraints"><span class="hs-identifier hs-type">debugConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span id="debugConstraints"><span class="annot"><span class="annottext">debugConstraints :: TCM ()
</span><a href="Agda.TypeChecking.Constraints.html#debugConstraints"><span class="hs-identifier hs-var hs-var">debugConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; [Char] -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.constr&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>  </span><span id="local-6989586621682052730"><span class="annot"><a href="#local-6989586621682052730"><span class="hs-identifier hs-var">awake</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCState Constraints -&gt; TCMT IO Constraints
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; f Constraints) -&gt; TCState -&gt; f TCState
Lens' TCState Constraints
</span><a href="Agda.TypeChecking.Monad.Base.html#stAwakeConstraints"><span class="hs-identifier hs-var">stAwakeConstraints</span></a></span><span>
</span><span id="line-334"></span><span>  </span><span id="local-6989586621682052735"><span class="annot"><a href="#local-6989586621682052735"><span class="hs-identifier hs-var">sleeping</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-type">useTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#stSleepingConstraints"><span class="hs-identifier hs-type">stSleepingConstraints</span></a></span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.constr&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Current constraints&quot;</span></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;awake &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052730"><span class="hs-identifier hs-type">awake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;asleep&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052735"><span class="hs-identifier hs-type">sleeping</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">-- Update the blocker after some instantiation or pruning might have happened.</span><span>
</span><span id="line-341"></span><span id="local-6989586621682051895"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#updateBlocker"><span class="hs-identifier hs-type">updateBlocker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051895"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051895"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span></span><span>
</span><span id="line-342"></span><span id="updateBlocker"><span class="annot"><span class="annottext">updateBlocker :: forall (m :: * -&gt; *). PureTCM m =&gt; Blocker -&gt; m Blocker
</span><a href="Agda.TypeChecking.Constraints.html#updateBlocker"><span class="hs-identifier hs-var hs-var">updateBlocker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; m Blocker
forall a (m :: * -&gt; *). (Instantiate a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span id="local-6989586621682051901"><span id="local-6989586621682051902"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#addAndUnblocker"><span class="hs-identifier hs-type">addAndUnblocker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051901"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051901"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051901"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051902"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051901"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051902"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-345"></span><span id="addAndUnblocker"><span class="annot"><span class="annottext">addAndUnblocker :: forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addAndUnblocker"><span class="hs-identifier hs-var hs-var">addAndUnblocker</span></a></span></span><span> </span><span id="local-6989586621682052756"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052756"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052756"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Blocker -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-var">alwaysUnblock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; m a) -&gt; m a -&gt; m a
forall a. (Blocker -&gt; m a) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadBlock m =&gt;
(Blocker -&gt; m a) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#catchPatternErr"><span class="hs-identifier hs-var">catchPatternErr</span></a></span><span> </span><span class="annot"><span class="annottext">((Blocker -&gt; m a) -&gt; m a -&gt; m a) -&gt; (Blocker -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052759"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052759"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>      </span><span id="local-6989586621682052760"><span class="annot"><a href="#local-6989586621682052760"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; m Blocker
forall (m :: * -&gt; *). PureTCM m =&gt; Blocker -&gt; m Blocker
</span><a href="Agda.TypeChecking.Constraints.html#updateBlocker"><span class="hs-identifier hs-var">updateBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052756"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#patternViolation"><span class="hs-identifier hs-type">patternViolation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#unblockOnBoth"><span class="hs-identifier hs-type">unblockOnBoth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052760"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052759"><span class="hs-identifier hs-type">u'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span id="local-6989586621682052763"><span id="local-6989586621682052764"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-type">addOrUnblocker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052763"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052763"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682052763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682052763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052764"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-352"></span><span id="addOrUnblocker"><span class="annot"><span class="annottext">addOrUnblocker :: forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-var hs-var">addOrUnblocker</span></a></span></span><span> </span><span id="local-6989586621682052774"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052774"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052774"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Blocker -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; m a) -&gt; m a -&gt; m a
forall a. (Blocker -&gt; m a) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadBlock m =&gt;
(Blocker -&gt; m a) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#catchPatternErr"><span class="hs-identifier hs-var">catchPatternErr</span></a></span><span> </span><span class="annot"><span class="annottext">((Blocker -&gt; m a) -&gt; m a -&gt; m a) -&gt; (Blocker -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682052776"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052776"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>      </span><span id="local-6989586621682052777"><span class="annot"><a href="#local-6989586621682052777"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; m Blocker
forall (m :: * -&gt; *). PureTCM m =&gt; Blocker -&gt; m Blocker
</span><a href="Agda.TypeChecking.Constraints.html#updateBlocker"><span class="hs-identifier hs-var">updateBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052774"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#patternViolation"><span class="hs-identifier hs-type">patternViolation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#unblockOnEither"><span class="hs-identifier hs-type">unblockOnEither</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052777"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682052776"><span class="hs-identifier hs-type">u'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="hs-comment">-- Reduce a term and call the continuation. If the continuation is</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- blocked, the whole call is blocked either on what blocked the reduction</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- or on what blocked the continuation (using `blockedOnEither`).</span><span>
</span><span id="line-361"></span><span id="local-6989586621682051911"><span id="local-6989586621682051913"><span id="local-6989586621682051914"><span class="annot"><a href="Agda.TypeChecking.Constraints.html#withReduced"><span class="hs-identifier hs-type">withReduced</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#Reduce"><span class="hs-identifier hs-type">Reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051911"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#IsMeta"><span class="hs-identifier hs-type">IsMeta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051911"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051913"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadBlock"><span class="hs-identifier hs-type">MonadBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051913"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682051911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051913"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051914"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682051913"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682051914"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-364"></span><span id="withReduced"><span class="annot"><span class="annottext">withReduced :: forall a (m :: * -&gt; *) b.
(Reduce a, IsMeta a, PureTCM m, MonadBlock m) =&gt;
a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Constraints.html#withReduced"><span class="hs-identifier hs-var hs-var">withReduced</span></a></span></span><span> </span><span id="local-6989586621682052790"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682052790"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682052791"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621682052791"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; (Blocker -&gt; a -&gt; m b) -&gt; (NotBlocked -&gt; a -&gt; m b) -&gt; m b
forall t (m :: * -&gt; *) a.
(Reduce t, IsMeta t, MonadReduce m) =&gt;
t -&gt; (Blocker -&gt; t -&gt; m a) -&gt; (NotBlocked -&gt; t -&gt; m a) -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#ifBlocked"><span class="hs-identifier hs-var">ifBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682052790"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682052793"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052793"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682052794"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682052794"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-var">addOrUnblocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682052793"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(m b -&gt; m b) -&gt; m b -&gt; m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621682052791"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682052794"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NotBlocked
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682052795"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682052795"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621682052791"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682052795"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span></pre></body></html>