<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause.Compile</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Identity</span></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.html"><span class="hs-identifier">Agda.TypeChecking.Coverage</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html"><span class="hs-identifier">Agda.TypeChecking.Coverage.SplitTree</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.RecordPatterns.html"><span class="hs-identifier">Agda.TypeChecking.RecordPatterns</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Precompute.html"><span class="hs-identifier">Agda.TypeChecking.Free.Precompute</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Update.html"><span class="hs-identifier">Agda.Utils.Update</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">data</span><span> </span><span id="RunRecordPatternTranslation"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#RunRecordPatternTranslation"><span class="hs-identifier hs-var">RunRecordPatternTranslation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunRecordPatternTranslation"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#RunRecordPatternTranslation"><span class="hs-identifier hs-var">RunRecordPatternTranslation</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DontRunRecordPatternTranslation"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#DontRunRecordPatternTranslation"><span class="hs-identifier hs-var">DontRunRecordPatternTranslation</span></a></span></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208805"><span id="local-6989586621682208810"><span class="annot"><span class="annottext">RunRecordPatternTranslation -&gt; RunRecordPatternTranslation -&gt; Bool
(RunRecordPatternTranslation
 -&gt; RunRecordPatternTranslation -&gt; Bool)
-&gt; (RunRecordPatternTranslation
    -&gt; RunRecordPatternTranslation -&gt; Bool)
-&gt; Eq RunRecordPatternTranslation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: RunRecordPatternTranslation -&gt; RunRecordPatternTranslation -&gt; Bool
== :: RunRecordPatternTranslation -&gt; RunRecordPatternTranslation -&gt; Bool
$c/= :: RunRecordPatternTranslation -&gt; RunRecordPatternTranslation -&gt; Bool
/= :: RunRecordPatternTranslation -&gt; RunRecordPatternTranslation -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileClauses%27"><span class="hs-identifier hs-type">compileClauses'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#RunRecordPatternTranslation"><span class="hs-identifier hs-type">RunRecordPatternTranslation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitTree"><span class="hs-identifier hs-type">SplitTree</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span>
</span><span id="line-41"></span><span id="compileClauses%27"><span class="annot"><span class="annottext">compileClauses' :: QName
-&gt; RunRecordPatternTranslation
-&gt; [Clause]
-&gt; Maybe SplitTree
-&gt; TCM CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileClauses%27"><span class="hs-identifier hs-var hs-var">compileClauses'</span></a></span></span><span> </span><span id="local-6989586621682208814"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208814"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682208815"><span class="annot"><span class="annottext">RunRecordPatternTranslation
</span><a href="#local-6989586621682208815"><span class="hs-identifier hs-var">recpat</span></a></span></span><span> </span><span id="local-6989586621682208816"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682208816"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682208817"><span class="annot"><span class="annottext">Maybe SplitTree
</span><a href="#local-6989586621682208817"><span class="hs-identifier hs-var">mSplitTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-comment">-- Throw away the unreachable clauses (#2723).</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208821"><span class="annot"><span class="annottext">notUnreachable :: Clause -&gt; Bool
</span><a href="#local-6989586621682208821"><span class="hs-identifier hs-var hs-var hs-var">notUnreachable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; (Clause -&gt; Maybe Bool) -&gt; Clause -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Maybe Bool
</span><a href="Agda.Syntax.Internal.html#clauseUnreachable"><span class="hs-identifier hs-var">clauseUnreachable</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span id="local-6989586621682208825"><span class="annot"><a href="#local-6989586621682208825"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int, Clause) -&gt; Cl) -&gt; [(Int, Clause)] -&gt; Cls
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Clause) -&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#unBruijn"><span class="hs-identifier hs-var">unBruijn</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Clause)] -&gt; Cls) -&gt; TCMT IO [(Int, Clause)] -&gt; TCMT IO Cls
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Clause)] -&gt; TCMT IO [(Int, Clause)]
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *).
HasConstInfo m =&gt;
[(Int, Clause)] -&gt; m [(Int, Clause)]
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Clause) -&gt; Bool) -&gt; [(Int, Clause)] -&gt; [(Int, Clause)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Bool
</span><a href="#local-6989586621682208821"><span class="hs-identifier hs-var">notUnreachable</span></a></span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; Bool)
-&gt; ((Int, Clause) -&gt; Clause) -&gt; (Int, Clause) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int, Clause) -&gt; Clause
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, Clause)] -&gt; [(Int, Clause)])
-&gt; [(Int, Clause)] -&gt; [(Int, Clause)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Clause] -&gt; [(Int, Clause)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682208816"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208830"><span class="annot"><a href="#local-6989586621682208830"><span class="hs-identifier hs-var hs-var">translate</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RunRecordPatternTranslation
</span><a href="#local-6989586621682208815"><span class="hs-identifier hs-var">recpat</span></a></span><span> </span><span class="annot"><span class="annottext">RunRecordPatternTranslation -&gt; RunRecordPatternTranslation -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RunRecordPatternTranslation
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#RunRecordPatternTranslation"><span class="hs-identifier hs-var">RunRecordPatternTranslation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdentityT (TCMT IO) CompiledClauses -&gt; TCM CompiledClauses
forall {k} (f :: k -&gt; *) (a :: k). IdentityT f a -&gt; f a
</span><span class="hs-identifier hs-var">runIdentityT</span></span><span> </span><span class="annot"><span class="annottext">(IdentityT (TCMT IO) CompiledClauses -&gt; TCM CompiledClauses)
-&gt; (CompiledClauses -&gt; IdentityT (TCMT IO) CompiledClauses)
-&gt; CompiledClauses
-&gt; TCM CompiledClauses
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; CompiledClauses -&gt; IdentityT (TCMT IO) CompiledClauses
forall (m :: * -&gt; *).
(HasConstInfo m, MonadChange m) =&gt;
QName -&gt; CompiledClauses -&gt; m CompiledClauses
</span><a href="Agda.TypeChecking.RecordPatterns.html#translateCompiledClauses"><span class="hs-identifier hs-var">translateCompiledClauses</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208814"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-48"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledClauses -&gt; TCM CompiledClauses
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="#local-6989586621682208830"><span class="hs-identifier hs-type">translate</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-type">caseMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208817"><span class="hs-identifier hs-type">mSplitTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-type">compile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208825"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682208835"><span class="annot"><span class="annottext">SplitTree
</span><a href="#local-6989586621682208835"><span class="hs-identifier hs-var">splitTree</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="annottext">SplitTree -&gt; Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-var">compileWithSplitTree</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTree
</span><a href="#local-6989586621682208835"><span class="hs-identifier hs-var">splitTree</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208825"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- | Process function clauses into case tree.</span><span>
</span><span id="line-54"></span><span class="hs-comment">--   This involves:</span><span>
</span><span id="line-55"></span><span class="hs-comment">--   1. Coverage checking, generating a split tree.</span><span>
</span><span id="line-56"></span><span class="hs-comment">--   2. Translation of lhs record patterns into rhs uses of projection.</span><span>
</span><span id="line-57"></span><span class="hs-comment">--      Update the split tree.</span><span>
</span><span id="line-58"></span><span class="hs-comment">--   3. Generating a case tree from the split tree.</span><span>
</span><span id="line-59"></span><span class="hs-comment">--   Phases 1. and 2. are skipped if @Nothing@.</span><span>
</span><span id="line-60"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileClauses"><span class="hs-identifier hs-type">compileClauses</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Translate record patterns and coverage check with given type?</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitTree"><span class="hs-identifier hs-type">SplitTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The 'Bool' indicates whether we turned a record expression into a copattern match.</span></span><span>
</span><span id="line-65"></span><span id="compileClauses"><span class="annot"><span class="annottext">compileClauses :: Maybe (QName, Type)
-&gt; [Clause] -&gt; TCM (Maybe SplitTree, Bool, CompiledClauses)
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileClauses"><span class="hs-identifier hs-var hs-var">compileClauses</span></a></span></span><span> </span><span id="local-6989586621682208838"><span class="annot"><span class="annottext">Maybe (QName, Type)
</span><a href="#local-6989586621682208838"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span id="local-6989586621682208839"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682208839"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-comment">-- Construct clauses with pattern variables bound in left-to-right order.</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-comment">-- Discard de Bruijn indices in patterns.</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (QName, Type)
</span><a href="#local-6989586621682208838"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">Maybe (QName, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SplitTree
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompiledClauses -&gt; (Maybe SplitTree, Bool, CompiledClauses))
-&gt; ([Clause] -&gt; CompiledClauses)
-&gt; [Clause]
-&gt; (Maybe SplitTree, Bool, CompiledClauses)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">(Cls -&gt; CompiledClauses)
-&gt; ([Clause] -&gt; Cls) -&gt; [Clause] -&gt; CompiledClauses
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, Clause) -&gt; Cl) -&gt; [(Int, Clause)] -&gt; Cls
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Clause) -&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#unBruijn"><span class="hs-identifier hs-var">unBruijn</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Clause)] -&gt; Cls)
-&gt; ([Clause] -&gt; [(Int, Clause)]) -&gt; [Clause] -&gt; Cls
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Clause] -&gt; [(Int, Clause)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Clause] -&gt; (Maybe SplitTree, Bool, CompiledClauses))
-&gt; TCMT IO [Clause] -&gt; TCM (Maybe SplitTree, Bool, CompiledClauses)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Clause] -&gt; TCMT IO [Clause]
forall a (m :: * -&gt; *).
(NormaliseProjP a, HasConstInfo m) =&gt;
a -&gt; m a
forall (m :: * -&gt; *). HasConstInfo m =&gt; [Clause] -&gt; m [Clause]
</span><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-var">normaliseProjP</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682208839"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208840"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208840"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208841"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682208841"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>      </span><span id="local-6989586621682208842"><span class="annot"><a href="#local-6989586621682208842"><span class="hs-identifier hs-var">splitTree</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Type -&gt; [Clause] -&gt; TCM SplitTree
</span><a href="Agda.TypeChecking.Coverage.html#coverageCheck"><span class="hs-identifier hs-var">coverageCheck</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208840"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682208841"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682208839"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc.tree&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;split tree of &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; from coverage check &quot;</span></span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-type">P.pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208842"><span class="hs-identifier hs-type">splitTree</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-comment">-- The coverage checker might have added some clauses (#2288)!</span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-comment">-- Throw away the unreachable clauses (#2723).</span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208851"><span class="annot"><a href="#local-6989586621682208851"><span class="hs-identifier hs-var hs-var">notUnreachable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; (Clause -&gt; Maybe Bool) -&gt; Clause -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Maybe Bool
</span><a href="Agda.Syntax.Internal.html#clauseUnreachable"><span class="hs-identifier hs-var">clauseUnreachable</span></a></span><span>
</span><span id="line-81"></span><span>      </span><span id="local-6989586621682208852"><span class="annot"><a href="#local-6989586621682208852"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#normaliseProjP"><span class="hs-identifier hs-type">normaliseProjP</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682208851"><span class="hs-identifier hs-type">notUnreachable</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defClauses"><span class="hs-identifier hs-type">defClauses</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208857"><span class="annot"><a href="#local-6989586621682208857"><span class="hs-identifier hs-var hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Clause) -&gt; Cl) -&gt; [(Int, Clause)] -&gt; Cls
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Clause) -&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#unBruijn"><span class="hs-identifier hs-var">unBruijn</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Clause)]
</span><a href="#local-6989586621682208852"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;clauses patterns of &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; before compilation&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#clPats"><span class="hs-identifier hs-var">clPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682208857"><span class="hs-identifier hs-type">cls</span></a></span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="hs-string">&quot;clauses of &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; before compilation&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-type">&lt;?&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208852"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682208863"><span class="annot"><a href="#local-6989586621682208863"><span class="hs-identifier hs-var hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitTree -&gt; Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-var">compileWithSplitTree</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTree
</span><a href="#local-6989586621682208842"><span class="hs-identifier hs-var">splitTree</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208857"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;compiled clauses of &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; (still containing record splits)&quot;</span></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-type">P.pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208863"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682208865"><span class="annot"><a href="#local-6989586621682208865"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208866"><span class="annot"><a href="#local-6989586621682208866"><span class="hs-identifier hs-var">becameCopatternLHS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Update.html#runChangeT"><span class="hs-identifier hs-type">runChangeT</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.RecordPatterns.html#translateCompiledClauses"><span class="hs-identifier hs-type">translateCompiledClauses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208863"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">12</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;compiled clauses of &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208840"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-type">P.pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208865"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-102"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682208842"><span class="hs-identifier hs-type">splitTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682208866"><span class="hs-identifier hs-type">becameCopatternLHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Precompute.html#precomputeFreeVars_"><span class="hs-identifier hs-type">precomputeFreeVars_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208865"><span class="hs-identifier hs-type">cc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | Stripped-down version of 'Agda.Syntax.Internal.Clause'</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   used in clause compiler.</span><span>
</span><span id="line-107"></span><span class="hs-keyword">data</span><span> </span><span id="Cl"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Cl"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="clNumber"><span class="annot"><span class="annottext">Cl -&gt; Int
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clNumber"><span class="hs-identifier hs-var hs-var">clNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#ClauseNumber"><span class="hs-identifier hs-type">ClauseNumber</span></a></span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Which original 'Clause' did this clause come from?</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clRecursive"><span class="annot"><span class="annottext">Cl -&gt; ClauseRecursive
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clRecursive"><span class="hs-identifier hs-var hs-var">clRecursive</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ClauseRecursive"><span class="hs-identifier hs-type">ClauseRecursive</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Does the clause body contain calls to the mutually recursive functions?</span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clPats"><span class="annot"><span class="annottext">Cl -&gt; [Arg (Pattern' PatVarName)]
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clPats"><span class="hs-identifier hs-var hs-var">clPats</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Pattern variables are considered in left-to-right order.</span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clBody"><span class="annot"><span class="annottext">Cl -&gt; Maybe Term
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clBody"><span class="hs-identifier hs-var hs-var">clBody</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208877"><span id="local-6989586621682208890"><span id="local-6989586621682208894"><span class="annot"><span class="annottext">Int -&gt; Cl -&gt; ShowS
Cls -&gt; ShowS
Cl -&gt; PatVarName
(Int -&gt; Cl -&gt; ShowS)
-&gt; (Cl -&gt; PatVarName) -&gt; (Cls -&gt; ShowS) -&gt; Show Cl
forall a.
(Int -&gt; a -&gt; ShowS)
-&gt; (a -&gt; PatVarName) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Cl -&gt; ShowS
showsPrec :: Int -&gt; Cl -&gt; ShowS
$cshow :: Cl -&gt; PatVarName
show :: Cl -&gt; PatVarName
$cshowList :: Cls -&gt; ShowS
showList :: Cls -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682208907"><span id="local-6989586621682208911"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">P.Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621682208928"><span class="annot"><span class="annottext">pretty :: Cl -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span id="local-6989586621682208929"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208929"><span class="hs-identifier hs-var">no</span></a></span></span><span> </span><span id="local-6989586621682208930"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682208930"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682208931"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682208931"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682208932"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682208932"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208929"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#prettyList"><span class="hs-identifier hs-var">P.prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682208931"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Doc a -&gt; Doc a -&gt; Doc a
</span><span class="hs-operator hs-var">P.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; (Term -&gt; Doc) -&gt; Maybe Term -&gt; Doc
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;_|_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">P.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682208932"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">type</span><span> </span><span id="Cls"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-var">Cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Strip down a clause. Don't forget to apply the substitution to the dot</span><span>
</span><span id="line-123"></span><span class="hs-comment">--   patterns!</span><span>
</span><span id="line-124"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#unBruijn"><span class="hs-identifier hs-type">unBruijn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#ClauseNumber"><span class="hs-identifier hs-type">ClauseNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span>
</span><span id="line-125"></span><span id="unBruijn"><span class="annot"><span class="annottext">unBruijn :: (Int, Clause) -&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#unBruijn"><span class="hs-identifier hs-var hs-var">unBruijn</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208936"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208936"><span class="hs-identifier hs-var">no</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208937"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682208937"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208936"><span class="hs-identifier hs-var">no</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; ClauseRecursive
</span><a href="Agda.Syntax.Internal.html#clauseRecursive"><span class="hs-identifier hs-var">clauseRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682208937"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg [Arg (Pattern' PatVarName)])
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg [Arg (Pattern' PatVarName)])
</span><a href="#local-6989586621682208940"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)])
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; Arg (Pattern' PatVarName))
-&gt; [NamedArg DeBruijnPattern] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((NamedArg DeBruijnPattern -&gt; Arg (Pattern' PatVarName))
 -&gt; [NamedArg DeBruijnPattern] -&gt; [Arg (Pattern' PatVarName)])
-&gt; ((Named_ DeBruijnPattern -&gt; Pattern' PatVarName)
    -&gt; NamedArg DeBruijnPattern -&gt; Arg (Pattern' PatVarName))
-&gt; (Named_ DeBruijnPattern -&gt; Pattern' PatVarName)
-&gt; [NamedArg DeBruijnPattern]
-&gt; [Arg (Pattern' PatVarName)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Named_ DeBruijnPattern -&gt; Pattern' PatVarName)
-&gt; NamedArg DeBruijnPattern -&gt; Arg (Pattern' PatVarName)
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DBPatVar -&gt; PatVarName) -&gt; DeBruijnPattern -&gt; Pattern' PatVarName
forall a b. (a -&gt; b) -&gt; Pattern' a -&gt; Pattern' b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DBPatVar -&gt; PatVarName
</span><a href="Agda.Syntax.Internal.html#dbPatVarName"><span class="hs-identifier hs-var">dbPatVarName</span></a></span><span> </span><span class="annot"><span class="annottext">(DeBruijnPattern -&gt; Pattern' PatVarName)
-&gt; (Named_ DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; Named_ DeBruijnPattern
-&gt; Pattern' PatVarName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Named_ DeBruijnPattern -&gt; DeBruijnPattern
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; [Arg (Pattern' PatVarName)])
-&gt; [NamedArg DeBruijnPattern] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682208937"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg (Maybe Term)) -&gt; Maybe Term -&gt; Maybe Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' Term
Substitution' (SubstArg (Maybe Term))
</span><a href="#local-6989586621682208940"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Term -&gt; Maybe Term) -&gt; Maybe Term -&gt; Maybe Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Maybe Term
</span><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682208937"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621682208940"><span class="annot"><span class="annottext">sub :: Substitution' Term
</span><a href="#local-6989586621682208940"><span class="hs-identifier hs-var hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; Substitution' Term
forall a. DeBruijn a =&gt; Permutation -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.html#renamingR"><span class="hs-identifier hs-var">renamingR</span></a></span><span> </span><span class="annot"><span class="annottext">(Permutation -&gt; Substitution' Term)
-&gt; Permutation -&gt; Substitution' Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; Maybe Permutation -&gt; Permutation
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Permutation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Maybe Permutation
</span><a href="Agda.Syntax.Internal.Pattern.html#clausePerm"><span class="hs-identifier hs-var">clausePerm</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682208937"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-type">compileWithSplitTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitTree"><span class="hs-identifier hs-type">SplitTree</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span>
</span><span id="line-133"></span><span id="compileWithSplitTree"><span class="annot"><span class="annottext">compileWithSplitTree :: SplitTree -&gt; Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-var hs-var">compileWithSplitTree</span></a></span></span><span> </span><span id="local-6989586621682208949"><span class="annot"><span class="annottext">SplitTree
</span><a href="#local-6989586621682208949"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682208950"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208950"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SplitTree
</span><a href="#local-6989586621682208949"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitAt"><span class="hs-identifier hs-type">SplitAt</span></a></span><span> </span><span id="local-6989586621682208952"><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682208952"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682208953"><span class="annot"><span class="annottext">LazySplit
</span><a href="#local-6989586621682208953"><span class="hs-identifier hs-var">lz</span></a></span></span><span> </span><span id="local-6989586621682208954"><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208954"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arg Int -&gt; Case CompiledClauses -&gt; CompiledClauses
forall a.
Arg Int -&gt; Case (CompiledClauses' a) -&gt; CompiledClauses' a
</span><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682208952"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Case CompiledClauses -&gt; CompiledClauses)
-&gt; Case CompiledClauses -&gt; CompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LazySplit
-&gt; SplitTrees' SplitTag -&gt; Case Cls -&gt; Case CompiledClauses
</span><a href="#local-6989586621682208956"><span class="hs-identifier hs-var">compiles</span></a></span><span> </span><span class="annot"><span class="annottext">LazySplit
</span><a href="#local-6989586621682208953"><span class="hs-identifier hs-var">lz</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208954"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">(Case Cls -&gt; Case CompiledClauses)
-&gt; Case Cls -&gt; Case CompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Cls -&gt; Case Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitOn"><span class="hs-identifier hs-var">splitOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SplitTrees' SplitTag -&gt; Peano
forall a. Sized a =&gt; a -&gt; Peano
</span><a href="Agda.Utils.Size.html#natSize"><span class="hs-identifier hs-var">natSize</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208954"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Peano -&gt; Peano -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Peano
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Int -&gt; Int
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682208952"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208950"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-comment">-- if there is just one case, we force expansion of catch-alls</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-comment">-- this is needed to generate a sound tree on which we can</span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-comment">-- collapse record pattern splits</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplittingDone"><span class="hs-identifier hs-type">SplittingDone</span></a></span><span> </span><span id="local-6989586621682208960"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682208960"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208950"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">-- after end of split tree, continue with left-to-right strategy</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="#local-6989586621682208956"><span class="hs-identifier hs-type">compiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#LazySplit"><span class="hs-identifier hs-type">LazySplit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitTrees"><span class="hs-identifier hs-type">SplitTrees</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621682208956"><span class="annot"><span class="annottext">compiles :: LazySplit
-&gt; SplitTrees' SplitTag -&gt; Case Cls -&gt; Case CompiledClauses
</span><a href="#local-6989586621682208956"><span class="hs-identifier hs-var hs-var">compiles</span></a></span></span><span> </span><span id="local-6989586621682208962"><span class="annot"><span class="annottext">LazySplit
</span><a href="#local-6989586621682208962"><span class="hs-identifier hs-var">lz</span></a></span></span><span> </span><span id="local-6989586621682208963"><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208963"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621682208964"><span class="annot"><span class="annottext">br :: Case Cls
</span><a href="#local-6989586621682208964"><span class="hs-identifier hs-var">br</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Branches"><span class="hs-identifier hs-type">Branches</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">projPatterns :: forall c. Case c -&gt; Bool
</span><a href="Agda.TypeChecking.CompiledClause.html#projPatterns"><span class="hs-identifier hs-var">projPatterns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208967"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208967"><span class="hs-identifier hs-var">cop</span></a></span></span><span>
</span><span id="line-143"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conBranches :: forall c. Case c -&gt; Map QName (WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#conBranches"><span class="hs-identifier hs-var">conBranches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208969"><span class="annot"><span class="annottext">Map QName (WithArity Cls)
</span><a href="#local-6989586621682208969"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-144"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">etaBranch :: forall c. Case c -&gt; Maybe (ConHead, WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#etaBranch"><span class="hs-identifier hs-var">etaBranch</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ConHead, WithArity Cls)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-145"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">litBranches :: forall c. Case c -&gt; Map Literal c
</span><a href="Agda.TypeChecking.CompiledClause.html#litBranches"><span class="hs-identifier hs-var">litBranches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208972"><span class="annot"><span class="annottext">Map Literal Cls
</span><a href="#local-6989586621682208972"><span class="hs-identifier hs-var">lits</span></a></span></span><span>
</span><span id="line-146"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fallThrough :: forall c. Case c -&gt; Maybe Bool
</span><a href="Agda.TypeChecking.CompiledClause.html#fallThrough"><span class="hs-identifier hs-var">fallThrough</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208974"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682208974"><span class="hs-identifier hs-var">fT</span></a></span></span><span>
</span><span id="line-147"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">catchallBranch :: forall c. Case c -&gt; Maybe c
</span><a href="Agda.TypeChecking.CompiledClause.html#catchallBranch"><span class="hs-identifier hs-var">catchallBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208976"><span class="annot"><span class="annottext">Maybe Cls
</span><a href="#local-6989586621682208976"><span class="hs-identifier hs-var">catchall</span></a></span></span><span>
</span><span id="line-148"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lazyMatch :: forall c. Case c -&gt; Bool
</span><a href="Agda.TypeChecking.CompiledClause.html#lazyMatch"><span class="hs-identifier hs-var">lazyMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682208978"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208978"><span class="hs-identifier hs-var">lazy</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Case Cls
</span><a href="#local-6989586621682208964"><span class="hs-identifier hs-var">br</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#conBranches"><span class="hs-identifier hs-var">conBranches</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208979"><span class="hs-identifier hs-type">updCons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208969"><span class="hs-identifier hs-type">cons</span></a></span><span>
</span><span id="line-150"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#etaBranch"><span class="hs-identifier hs-var">etaBranch</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-151"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#litBranches"><span class="hs-identifier hs-var">litBranches</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208980"><span class="hs-identifier hs-type">updLits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208972"><span class="hs-identifier hs-type">lits</span></a></span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#fallThrough"><span class="hs-identifier hs-var">fallThrough</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208974"><span class="hs-identifier hs-type">fT</span></a></span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#catchallBranch"><span class="hs-identifier hs-var">catchallBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208981"><span class="hs-identifier hs-type">updCatchall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208976"><span class="hs-identifier hs-type">catchall</span></a></span><span>
</span><span id="line-154"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#lazyMatch"><span class="hs-identifier hs-var">lazyMatch</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682208978"><span class="hs-identifier hs-type">lazy</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621682208962"><span class="hs-identifier hs-type">lz</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#LazySplit"><span class="hs-identifier hs-type">LazySplit</span></a></span><span>
</span><span id="line-155"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>        </span><span id="local-6989586621682208979"><span class="annot"><span class="annottext">updCons :: Map QName (WithArity Cls) -&gt; Map QName (WithArity CompiledClauses)
</span><a href="#local-6989586621682208979"><span class="hs-identifier hs-var hs-var">updCons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; WithArity Cls -&gt; WithArity CompiledClauses)
-&gt; Map QName (WithArity Cls)
-&gt; Map QName (WithArity CompiledClauses)
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapWithKey</span></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; WithArity Cls -&gt; WithArity CompiledClauses)
 -&gt; Map QName (WithArity Cls)
 -&gt; Map QName (WithArity CompiledClauses))
-&gt; (QName -&gt; WithArity Cls -&gt; WithArity CompiledClauses)
-&gt; Map QName (WithArity Cls)
-&gt; Map QName (WithArity CompiledClauses)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682208985"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208985"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682208986"><span class="annot"><span class="annottext">WithArity Cls
</span><a href="#local-6989586621682208986"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>         </span><span class="annot"><span class="annottext">Maybe SplitTree
-&gt; (Cls -&gt; CompiledClauses)
-&gt; (SplitTree -&gt; Cls -&gt; CompiledClauses)
-&gt; Cls
-&gt; CompiledClauses
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SplitTag -&gt; SplitTrees' SplitTag -&gt; Maybe SplitTree
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; SplitTag
</span><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitCon"><span class="hs-identifier hs-var">SplitCon</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682208985"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208963"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTree -&gt; Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-var">compileWithSplitTree</span></a></span><span> </span><span class="annot"><span class="annottext">(Cls -&gt; CompiledClauses)
-&gt; WithArity Cls -&gt; WithArity CompiledClauses
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WithArity Cls
</span><a href="#local-6989586621682208986"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-159"></span><span>         </span><span class="hs-comment">-- When the split tree is finished, we continue with @compile@.</span><span>
</span><span id="line-160"></span><span>        </span><span id="local-6989586621682208980"><span class="annot"><span class="annottext">updLits :: Map Literal Cls -&gt; Map Literal CompiledClauses
</span><a href="#local-6989586621682208980"><span class="hs-identifier hs-var hs-var">updLits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; Cls -&gt; CompiledClauses)
-&gt; Map Literal Cls -&gt; Map Literal CompiledClauses
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapWithKey</span></span><span> </span><span class="annot"><span class="annottext">((Literal -&gt; Cls -&gt; CompiledClauses)
 -&gt; Map Literal Cls -&gt; Map Literal CompiledClauses)
-&gt; (Literal -&gt; Cls -&gt; CompiledClauses)
-&gt; Map Literal Cls
-&gt; Map Literal CompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682208989"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682208989"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682208990"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208990"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>          </span><span class="annot"><span class="annottext">Maybe SplitTree
-&gt; (Cls -&gt; CompiledClauses)
-&gt; (SplitTree -&gt; Cls -&gt; CompiledClauses)
-&gt; Cls
-&gt; CompiledClauses
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SplitTag -&gt; SplitTrees' SplitTag -&gt; Maybe SplitTree
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; SplitTag
</span><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitLit"><span class="hs-identifier hs-var">SplitLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682208989"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208963"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTree -&gt; Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-var">compileWithSplitTree</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208990"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span id="local-6989586621682208981"><span class="annot"><span class="annottext">updCatchall :: Maybe Cls -&gt; Maybe CompiledClauses
</span><a href="#local-6989586621682208981"><span class="hs-identifier hs-var hs-var">updCatchall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Cls -&gt; CompiledClauses) -&gt; Maybe Cls -&gt; Maybe CompiledClauses
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Cls -&gt; CompiledClauses) -&gt; Maybe Cls -&gt; Maybe CompiledClauses)
-&gt; (Cls -&gt; CompiledClauses) -&gt; Maybe Cls -&gt; Maybe CompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe SplitTree
-&gt; (Cls -&gt; CompiledClauses)
-&gt; (SplitTree -&gt; Cls -&gt; CompiledClauses)
-&gt; Cls
-&gt; CompiledClauses
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SplitTag -&gt; SplitTrees' SplitTag -&gt; Maybe SplitTree
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">SplitTag
</span><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplitCatchall"><span class="hs-identifier hs-var">SplitCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><a href="#local-6989586621682208963"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">SplitTree -&gt; Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileWithSplitTree"><span class="hs-identifier hs-var">compileWithSplitTree</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="#local-6989586621682208956"><span class="hs-identifier hs-var">compiles</span></a></span><span> </span><span class="annot"><span class="annottext">LazySplit
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SplitTrees' SplitTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Branches"><span class="hs-identifier hs-type">Branches</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">etaBranch :: forall c. Case c -&gt; Maybe (ConHead, WithArity c)
</span><a href="Agda.TypeChecking.CompiledClause.html#etaBranch"><span class="hs-identifier hs-var">etaBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Case CompiledClauses
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>  </span><span class="hs-comment">-- we haven't inserted eta matches yet</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-type">compile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses"><span class="hs-identifier hs-type">CompiledClauses</span></a></span><span>
</span><span id="line-166"></span><span id="compile"><span class="annot"><span class="annottext">compile :: Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var hs-var">compile</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg PatVarName] -&gt; CompiledClauses
forall a. [Arg PatVarName] -&gt; CompiledClauses' a
</span><a href="Agda.TypeChecking.CompiledClause.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208994"><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682208994"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682208995"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208995"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Cl -&gt; Cls -&gt; Maybe (Bool, Arg Int)
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#nextSplit"><span class="hs-identifier hs-var">nextSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682208994"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208995"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682208997"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208997"><span class="hs-identifier hs-var">isRecP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682208998"><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682208998"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arg Int -&gt; Case CompiledClauses -&gt; CompiledClauses
forall a.
Arg Int -&gt; Case (CompiledClauses' a) -&gt; CompiledClauses' a
</span><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682208998"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Case CompiledClauses -&gt; CompiledClauses)
-&gt; Case CompiledClauses -&gt; CompiledClauses
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cls -&gt; CompiledClauses
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">(Cls -&gt; CompiledClauses) -&gt; Case Cls -&gt; Case CompiledClauses
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Cls -&gt; Case Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitOn"><span class="hs-identifier hs-var">splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682208997"><span class="hs-identifier hs-var">isRecP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Int -&gt; Int
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Int
</span><a href="#local-6989586621682208998"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682208994"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Cl -&gt; Cls -&gt; Cls
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682208995"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Bool, Arg Int)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- It's possible to get more than one clause here due to catch-all expansion.</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682208999"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682209000"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682209000"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive -&gt; [Arg PatVarName] -&gt; Term -&gt; CompiledClauses
forall a.
Int
-&gt; ClauseRecursive -&gt; [Arg PatVarName] -&gt; a -&gt; CompiledClauses' a
</span><a href="Agda.TypeChecking.CompiledClause.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209002"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209003"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg PatVarName]
</span><a href="#local-6989586621682209004"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682209000"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">Maybe Term
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Arg PatVarName] -&gt; CompiledClauses
forall a. [Arg PatVarName] -&gt; CompiledClauses' a
</span><a href="Agda.TypeChecking.CompiledClause.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg PatVarName]
</span><a href="#local-6989586621682209004"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- If there are more than one clauses, take the first one.</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span id="local-6989586621682209002"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209002"><span class="hs-identifier hs-var">no</span></a></span></span><span> </span><span id="local-6989586621682209003"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209003"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682209005"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209005"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682208999"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682208999"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682208994"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621682209004"><span class="annot"><span class="annottext">xs :: [Arg PatVarName]
</span><a href="#local-6989586621682209004"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Arg PatVarName)
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg PatVarName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pattern' PatVarName -&gt; PatVarName)
-&gt; Arg (Pattern' PatVarName) -&gt; Arg PatVarName
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Pattern' PatVarName -&gt; PatVarName
forall {x}. Underscore x =&gt; Pattern' x -&gt; x
</span><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209005"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621682209006"><span class="annot"><span class="annottext">name :: Pattern' x -&gt; x
</span><a href="#local-6989586621682209006"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209021"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621682209021"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621682209021"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
forall a. Underscore a =&gt; a
</span><a href="Agda.Syntax.Common.html#underscore"><span class="hs-identifier hs-var">underscore</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="#local-6989586621682209006"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209029"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621682209029"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621682209029"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Get the index of the next argument we need to split on.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--   This the number of the first pattern that does a (non-lazy) match in the first clause.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--   Or the first lazy match where all clauses agree on the constructor, if there are no</span><span>
</span><span id="line-189"></span><span class="hs-comment">--   non-lazy matches.</span><span>
</span><span id="line-190"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#nextSplit"><span class="hs-identifier hs-type">nextSplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span id="nextSplit"><span class="annot"><span class="annottext">nextSplit :: Cl -&gt; Cls -&gt; Maybe (Bool, Arg Int)
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#nextSplit"><span class="hs-identifier hs-var hs-var">nextSplit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209030"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209030"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682209031"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209031"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Pattern' PatVarName -&gt; Bool)
-&gt; [Arg (Pattern' PatVarName)] -&gt; Maybe (Bool, Arg Int)
forall {t} {a}.
(Num t, Enum t) =&gt;
(t -&gt; Pattern' a -&gt; Bool)
-&gt; [Arg (Pattern' a)] -&gt; Maybe (Bool, Arg t)
</span><a href="#local-6989586621682209032"><span class="hs-identifier hs-var">findSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Pattern' PatVarName -&gt; Bool
forall {p} {x}. p -&gt; Pattern' x -&gt; Bool
</span><a href="#local-6989586621682209033"><span class="hs-identifier hs-var">nonLazy</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209030"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Bool, Arg Int)
-&gt; Maybe (Bool, Arg Int) -&gt; Maybe (Bool, Arg Int)
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Pattern' PatVarName -&gt; Bool)
-&gt; [Arg (Pattern' PatVarName)] -&gt; Maybe (Bool, Arg Int)
forall {t} {a}.
(Num t, Enum t) =&gt;
(t -&gt; Pattern' a -&gt; Bool)
-&gt; [Arg (Pattern' a)] -&gt; Maybe (Bool, Arg t)
</span><a href="#local-6989586621682209032"><span class="hs-identifier hs-var">findSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Pattern' PatVarName -&gt; Bool
</span><a href="#local-6989586621682209035"><span class="hs-identifier hs-var">allAgree</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209030"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682209033"><span class="annot"><span class="annottext">nonLazy :: p -&gt; Pattern' x -&gt; Bool
</span><a href="#local-6989586621682209033"><span class="hs-identifier hs-var hs-var">nonLazy</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209036"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209036"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPLazy"><span class="hs-identifier hs-var">conPLazy</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209036"><span class="hs-identifier hs-var">cpi</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="#local-6989586621682209033"><span class="hs-identifier hs-var">nonLazy</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621682209032"><span class="annot"><span class="annottext">findSplit :: (t -&gt; Pattern' a -&gt; Bool)
-&gt; [Arg (Pattern' a)] -&gt; Maybe (Bool, Arg t)
</span><a href="#local-6989586621682209032"><span class="hs-identifier hs-var hs-var">findSplit</span></a></span></span><span> </span><span id="local-6989586621682209047"><span class="annot"><span class="annottext">t -&gt; Pattern' a -&gt; Bool
</span><a href="#local-6989586621682209047"><span class="hs-identifier hs-var">okPat</span></a></span></span><span> </span><span id="local-6989586621682209048"><span class="annot"><span class="annottext">[Arg (Pattern' a)]
</span><a href="#local-6989586621682209048"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Bool, Arg t)] -&gt; Maybe (Bool, Arg t)
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (Bool, Arg t)] -&gt; [(Bool, Arg t)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Bool, Arg t)] -&gt; [(Bool, Arg t)])
-&gt; [Maybe (Bool, Arg t)] -&gt; [(Bool, Arg t)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><span class="annottext">(Arg (Pattern' a) -&gt; t -&gt; Maybe (Bool, Arg t))
-&gt; [Arg (Pattern' a)] -&gt; [t] -&gt; [Maybe (Bool, Arg t)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682209053"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682209053"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682209054"><span class="annot"><span class="annottext">Pattern' a
</span><a href="#local-6989586621682209054"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682209055"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682209055"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; t -&gt; Arg t
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682209053"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682209055"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; (Bool, Arg t)) -&gt; Maybe Bool -&gt; Maybe (Bool, Arg t)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pattern' a -&gt; Maybe Bool
forall a. Pattern' a -&gt; Maybe Bool
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' a
</span><a href="#local-6989586621682209054"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Bool, Arg t) -&gt; Maybe () -&gt; Maybe (Bool, Arg t)
forall a b. Maybe a -&gt; Maybe b -&gt; Maybe a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Pattern' a -&gt; Bool
</span><a href="#local-6989586621682209047"><span class="hs-identifier hs-var">okPat</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682209055"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' a
</span><a href="#local-6989586621682209054"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' a)]
</span><a href="#local-6989586621682209048"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621682209035"><span class="annot"><span class="annottext">allAgree :: Int -&gt; Pattern' PatVarName -&gt; Bool
</span><a href="#local-6989586621682209035"><span class="hs-identifier hs-var hs-var">allAgree</span></a></span></span><span> </span><span id="local-6989586621682209058"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209058"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682209059"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209059"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Bool) -&gt; Cls -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209059"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe QName -&gt; Bool) -&gt; (Cl -&gt; Maybe QName) -&gt; Cl -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Pattern' PatVarName] -&gt; Maybe QName
forall {x}. [Pattern' x] -&gt; Maybe QName
</span><a href="#local-6989586621682209062"><span class="hs-identifier hs-var">getCon</span></a></span><span> </span><span class="annot"><span class="annottext">([Pattern' PatVarName] -&gt; Maybe QName)
-&gt; (Cl -&gt; [Pattern' PatVarName]) -&gt; Cl -&gt; Maybe QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Pattern' PatVarName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; [Pattern' PatVarName])
-&gt; (Cl -&gt; [Arg (Pattern' PatVarName)])
-&gt; Cl
-&gt; [Pattern' PatVarName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209058"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)])
-&gt; (Cl -&gt; [Arg (Pattern' PatVarName)])
-&gt; Cl
-&gt; [Arg (Pattern' PatVarName)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cl -&gt; [Arg (Pattern' PatVarName)]
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clPats"><span class="hs-identifier hs-var">clPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209031"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><a href="#local-6989586621682209035"><span class="hs-identifier hs-var">allAgree</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Pattern' PatVarName
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621682209062"><span class="annot"><span class="annottext">getCon :: [Pattern' x] -&gt; Maybe QName
</span><a href="#local-6989586621682209062"><span class="hs-identifier hs-var hs-var">getCon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682209064"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209064"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Pattern' x]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Maybe QName) -&gt; QName -&gt; Maybe QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209064"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621682209062"><span class="hs-identifier hs-var">getCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Pattern' x]
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe QName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Is is not a variable pattern?</span><span>
</span><span id="line-206"></span><span class="hs-comment">--   And if yes, is it a record pattern and/or a fallThrough one?</span><span>
</span><span id="line-207"></span><span id="local-6989586621682208436"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-type">properSplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern%27"><span class="hs-identifier hs-type">Pattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208436"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-208"></span><span id="properSplit"><span class="annot"><span class="annottext">properSplit :: forall a. Pattern' a -&gt; Maybe Bool
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var hs-var">properSplit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209067"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209067"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' a)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPRecord"><span class="hs-identifier hs-var">conPRecord</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209067"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; PatOrigin
</span><a href="Agda.Syntax.Internal.html#patOrigin"><span class="hs-identifier hs-var">patOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConPatternInfo -&gt; PatternInfo
</span><a href="Agda.Syntax.Internal.html#conPInfo"><span class="hs-identifier hs-var">conPInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209067"><span class="hs-identifier hs-var">cpi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatOrigin -&gt; PatOrigin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PatOrigin
</span><a href="Agda.Syntax.Internal.html#PatORec"><span class="hs-identifier hs-var">PatORec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPFallThrough"><span class="hs-identifier hs-var">conPFallThrough</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209067"><span class="hs-identifier hs-var">cpi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-210"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-211"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-212"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-214"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#properSplit"><span class="hs-identifier hs-var">properSplit</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | Is this a variable pattern?</span><span>
</span><span id="line-217"></span><span class="hs-comment">--</span><span>
</span><span id="line-218"></span><span class="hs-comment">--   Maintain invariant: @isVar = isNothing . properSplit@!</span><span>
</span><span id="line-219"></span><span id="local-6989586621682208447"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-type">isVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern%27"><span class="hs-identifier hs-type">Pattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208447"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-220"></span><span id="isVar"><span class="annot"><span class="annottext">isVar :: forall a. Pattern' a -&gt; Bool
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var hs-var">isVar</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-226"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | @splitOn single n cs@ will force expansion of catch-alls</span><span>
</span><span id="line-229"></span><span class="hs-comment">--   if @single@.</span><span>
</span><span id="line-230"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitOn"><span class="hs-identifier hs-type">splitOn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span>
</span><span id="line-231"></span><span id="splitOn"><span class="annot"><span class="annottext">splitOn :: Bool -&gt; Int -&gt; Cls -&gt; Case Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitOn"><span class="hs-identifier hs-var hs-var">splitOn</span></a></span></span><span> </span><span id="local-6989586621682209075"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682209075"><span class="hs-identifier hs-var">single</span></a></span></span><span> </span><span id="local-6989586621682209076"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209076"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682209077"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209077"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Case Cls] -&gt; Case Cls
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Case Cls] -&gt; Case Cls) -&gt; [Case Cls] -&gt; Case Cls
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Case Cls) -&gt; Cls -&gt; [Case Cls]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Cl -&gt; Cls) -&gt; Case Cl -&gt; Case Cls
forall a b. (a -&gt; b) -&gt; Case a -&gt; Case b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl -&gt; Cls -&gt; Cls
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Case Cl -&gt; Case Cls) -&gt; (Cl -&gt; Case Cl) -&gt; Cl -&gt; Case Cls
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Cl -&gt; Case Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitC"><span class="hs-identifier hs-var">splitC</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209076"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cls -&gt; [Case Cls]) -&gt; Cls -&gt; [Case Cls]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-comment">-- (\ cs -&gt; trace (&quot;splitting on &quot; ++ show n ++ &quot; after expandCatchalls &quot; ++ show single ++ &quot;: &quot; ++ prettyShow (P.prettyList cs)) cs) $</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Cls -&gt; Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#expandCatchalls"><span class="hs-identifier hs-var">expandCatchalls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682209075"><span class="hs-identifier hs-var">single</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209076"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209077"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitC"><span class="hs-identifier hs-type">splitC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span>
</span><span id="line-236"></span><span id="splitC"><span class="annot"><span class="annottext">splitC :: Int -&gt; Cl -&gt; Case Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#splitC"><span class="hs-identifier hs-var hs-var">splitC</span></a></span></span><span> </span><span id="local-6989586621682209080"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209080"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span id="local-6989586621682209081"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209081"><span class="hs-identifier hs-var">no</span></a></span></span><span> </span><span id="local-6989586621682209082"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209082"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682209083"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209083"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682209084"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209084"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Pattern' PatVarName)
-&gt; Case Cl -&gt; (Pattern' PatVarName -&gt; Case Cl) -&gt; Case Cl
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Pattern' PatVarName)
</span><a href="#local-6989586621682209085"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Case Cl
</span><a href="#local-6989586621682209086"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="annot"><span class="annottext">((Pattern' PatVarName -&gt; Case Cl) -&gt; Case Cl)
-&gt; (Pattern' PatVarName -&gt; Case Cl) -&gt; Case Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#ProjP"><span class="hs-identifier hs-type">ProjP</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209087"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209087"><span class="hs-identifier hs-var">d</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Cl -&gt; Case Cl
forall c. QName -&gt; c -&gt; Case c
</span><a href="Agda.TypeChecking.CompiledClause.html#projCase"><span class="hs-identifier hs-var">projCase</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209087"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Case Cl) -&gt; Cl -&gt; Case Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209081"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209082"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209089"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209090"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209084"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#IApplyP"><span class="hs-identifier hs-type">IApplyP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Case Cl
</span><a href="#local-6989586621682209086"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682209091"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209091"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682209092"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209092"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682209093"><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209093"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Bool -&gt; WithArity Cl -&gt; Case Cl
forall c. QName -&gt; Bool -&gt; WithArity c -&gt; Case c
</span><a href="Agda.TypeChecking.CompiledClause.html#conCase"><span class="hs-identifier hs-var">conCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209091"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPFallThrough"><span class="hs-identifier hs-var">conPFallThrough</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209092"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(WithArity Cl -&gt; Case Cl) -&gt; WithArity Cl -&gt; Case Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Cl -&gt; WithArity Cl
forall c. Int -&gt; c -&gt; WithArity c
</span><a href="Agda.TypeChecking.CompiledClause.html#WithArity"><span class="hs-identifier hs-var">WithArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209093"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; WithArity Cl) -&gt; Cl -&gt; WithArity Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-240"></span><span>                   </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209081"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209082"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209089"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' PatVarName) -&gt; Arg (Pattern' PatVarName))
-&gt; [NamedArg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; NamedArg (Pattern' PatVarName) -&gt; Arg (Pattern' PatVarName)
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Named NamedName (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209093"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209090"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209084"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#lazyMatch"><span class="hs-identifier hs-var">lazyMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conPLazy"><span class="hs-identifier hs-var">conPLazy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682209092"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span> </span><span id="local-6989586621682209097"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682209097"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682209098"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209098"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682209099"><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209099"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Bool -&gt; WithArity Cl -&gt; Case Cl
forall c. QName -&gt; Bool -&gt; WithArity c -&gt; Case c
</span><a href="Agda.TypeChecking.CompiledClause.html#conCase"><span class="hs-identifier hs-var">conCase</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209098"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(WithArity Cl -&gt; Case Cl) -&gt; WithArity Cl -&gt; Case Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Cl -&gt; WithArity Cl
forall c. Int -&gt; c -&gt; WithArity c
</span><a href="Agda.TypeChecking.CompiledClause.html#WithArity"><span class="hs-identifier hs-var">WithArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209099"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; WithArity Cl) -&gt; Cl -&gt; WithArity Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-242"></span><span>                   </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209081"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209082"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209089"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' PatVarName) -&gt; Arg (Pattern' PatVarName))
-&gt; [NamedArg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; NamedArg (Pattern' PatVarName) -&gt; Arg (Pattern' PatVarName)
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Named NamedName (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209099"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209090"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209084"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#lazyMatch"><span class="hs-identifier hs-var">lazyMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209100"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209100"><span class="hs-identifier hs-var">l</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Cl -&gt; Case Cl
forall c. Literal -&gt; c -&gt; Case c
</span><a href="Agda.TypeChecking.CompiledClause.html#litCase"><span class="hs-identifier hs-var">litCase</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209100"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Case Cl) -&gt; Cl -&gt; Case Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209081"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209082"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209089"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209090"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209084"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Case Cl
</span><a href="#local-6989586621682209086"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Case Cl
</span><a href="#local-6989586621682209086"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682209089"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209089"><span class="hs-identifier hs-var">ps0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682209102"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209102"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Arg (Pattern' PatVarName)]
-&gt; ([Arg (Pattern' PatVarName)], [Arg (Pattern' PatVarName)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209080"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209083"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621682209085"><span class="annot"><span class="annottext">mp :: Maybe (Pattern' PatVarName)
</span><a href="#local-6989586621682209085"><span class="hs-identifier hs-var hs-var">mp</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; Maybe (Arg (Pattern' PatVarName)) -&gt; Maybe (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Maybe (Arg (Pattern' PatVarName))
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209102"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621682209090"><span class="annot"><span class="annottext">ps1 :: [Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209090"><span class="hs-identifier hs-var hs-var">ps1</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209102"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621682209086"><span class="annot"><span class="annottext">fallback :: Case Cl
</span><a href="#local-6989586621682209086"><span class="hs-identifier hs-var hs-var">fallback</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cl -&gt; Case Cl
forall c. c -&gt; Case c
</span><a href="Agda.TypeChecking.CompiledClause.html#catchall"><span class="hs-identifier hs-var">catchall</span></a></span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Case Cl) -&gt; Cl -&gt; Case Cl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209081"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209082"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209083"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209084"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | Expand catch-alls that appear before actual matches.</span><span>
</span><span id="line-253"></span><span class="hs-comment">--</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-255"></span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-257"></span><span class="hs-comment">--    true  y</span><span>
</span><span id="line-258"></span><span class="hs-comment">--    x     false</span><span>
</span><span id="line-259"></span><span class="hs-comment">--    false y</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-261"></span><span class="hs-comment">--</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- will expand the catch-all @x@ to @false@.</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- Catch-alls need also to be expanded if</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- they come before/after a record pattern, otherwise we get into</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- trouble when we want to eliminate splits on records later.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- Another example (see Issue 1650):</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-270"></span><span class="hs-comment">--   f (x, (y, z)) true  = a</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   f _           false = b</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- Split tree:</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-275"></span><span class="hs-comment">--   0 (first argument of f)</span><span>
</span><span id="line-276"></span><span class="hs-comment">--    \- 1 (second component of the pair)</span><span>
</span><span id="line-277"></span><span class="hs-comment">--        \- 3 (last argument of f)</span><span>
</span><span id="line-278"></span><span class="hs-comment">--            \-- true  -&gt; a</span><span>
</span><span id="line-279"></span><span class="hs-comment">--             \- false -&gt; b</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- We would like to get the following case tree:</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-283"></span><span class="hs-comment">--   case 0 of</span><span>
</span><span id="line-284"></span><span class="hs-comment">--   _,_ -&gt; case 1 of</span><span>
</span><span id="line-285"></span><span class="hs-comment">--          _,_ -&gt; case 3 of true  -&gt; a; false -&gt; b</span><span>
</span><span id="line-286"></span><span class="hs-comment">--          _   -&gt; case 3 of true  -&gt; a; false -&gt; b</span><span>
</span><span id="line-287"></span><span class="hs-comment">--   _          -&gt; case 3 of true  -&gt; a; false -&gt; b</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-289"></span><span class="hs-comment">--</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- Example from issue #2168:</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-292"></span><span class="hs-comment">--   f x     false = a</span><span>
</span><span id="line-293"></span><span class="hs-comment">--   f false       = \ _ -&gt; b</span><span>
</span><span id="line-294"></span><span class="hs-comment">--   f x     true  = c</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- case tree:</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-298"></span><span class="hs-comment">--   f x y = case y of</span><span>
</span><span id="line-299"></span><span class="hs-comment">--     true  -&gt; case x of</span><span>
</span><span id="line-300"></span><span class="hs-comment">--       true  -&gt; c</span><span>
</span><span id="line-301"></span><span class="hs-comment">--       false -&gt; b</span><span>
</span><span id="line-302"></span><span class="hs-comment">--     false -&gt; a</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- Example from issue #3628:</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-307"></span><span class="hs-comment">--   f i j k (i = i0)(k = i1) = base</span><span>
</span><span id="line-308"></span><span class="hs-comment">--   f i j k (j = i1)         = base</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- case tree:</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-312"></span><span class="hs-comment">--   f i j k o = case i of</span><span>
</span><span id="line-313"></span><span class="hs-comment">--     i0 -&gt; case k of</span><span>
</span><span id="line-314"></span><span class="hs-comment">--             i1 -&gt; base</span><span>
</span><span id="line-315"></span><span class="hs-comment">--             _  -&gt; case j of</span><span>
</span><span id="line-316"></span><span class="hs-comment">--                     i1 -&gt; base</span><span>
</span><span id="line-317"></span><span class="hs-comment">--     _  -&gt; case j of</span><span>
</span><span id="line-318"></span><span class="hs-comment">--             i1 -&gt; base</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-320"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#expandCatchalls"><span class="hs-identifier hs-type">expandCatchalls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cls"><span class="hs-identifier hs-type">Cls</span></a></span><span>
</span><span id="line-321"></span><span id="expandCatchalls"><span class="annot"><span class="annottext">expandCatchalls :: Bool -&gt; Int -&gt; Cls -&gt; Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#expandCatchalls"><span class="hs-identifier hs-var hs-var">expandCatchalls</span></a></span></span><span> </span><span id="local-6989586621682209105"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682209105"><span class="hs-identifier hs-var">single</span></a></span></span><span> </span><span id="local-6989586621682209106"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682209107"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209107"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209107"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">Cls
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-comment">-- Andreas, 2013-03-22</span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-comment">-- if there is a single case (such as for record splits)</span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-comment">-- we force expansion</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682209105"><span class="hs-identifier hs-var">single</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cl -&gt; Cls
</span><a href="#local-6989586621682209108"><span class="hs-identifier hs-var">doExpand</span></a></span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Cls) -&gt; Cls -&gt; Cls
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209107"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-comment">-- If all clauses have a variable at the nth argument, expansion</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-comment">-- would have no effect</span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Bool) -&gt; Cls -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Bool
</span><a href="#local-6989586621682209109"><span class="hs-identifier hs-var">isCatchallNth</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; Bool)
-&gt; (Cl -&gt; [Arg (Pattern' PatVarName)]) -&gt; Cl -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cl -&gt; [Arg (Pattern' PatVarName)]
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clPats"><span class="hs-identifier hs-var">clPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209107"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209107"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>    </span><span id="local-6989586621682209110"><span class="annot"><span class="annottext">c :: Cl
</span><a href="#local-6989586621682209110"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209111"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209111"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682209112"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209112"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682209113"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209113"><span class="hs-identifier hs-var">cs</span></a></span></span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-comment">-- If the head clause does not have a catch-all pattern for the</span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-comment">-- nth argument, we can keep it at the head and do no expansion</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Bool
</span><a href="#local-6989586621682209109"><span class="hs-identifier hs-var">isCatchallNth</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209111"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209110"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cl -&gt; Cls -&gt; Cls
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Cls -&gt; Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#expandCatchalls"><span class="hs-identifier hs-var">expandCatchalls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209113"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-comment">-- If there's a DefP clause for this argument later on, then it</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-comment">-- should take priority over catch-all clauses, so we rotate them</span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-comment">-- out of the way.</span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-comment">-- DefP clauses are always inserted by the system and should</span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-comment">-- &quot;defeat&quot; user-written inexact patterns.</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682209114"><span class="annot"><span class="annottext">defps :: Cls
</span><a href="#local-6989586621682209114"><span class="hs-identifier hs-var">defps</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Cls
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682209115"><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209115"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Cl -&gt; Bool) -&gt; Cls -&gt; (Cls, Cls)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">Cl -&gt; Bool
</span><a href="#local-6989586621682209116"><span class="hs-identifier hs-var">isDefPNth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209110"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Cl -&gt; Cls -&gt; Cls
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209113"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209114"><span class="hs-identifier hs-var">defps</span></a></span><span> </span><span class="annot"><span class="annottext">Cls -&gt; Cls -&gt; Cls
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Cls -&gt; Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#expandCatchalls"><span class="hs-identifier hs-var">expandCatchalls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209115"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>      </span><span class="hs-comment">-- If the head clause *does* have an irrefutable pattern for the</span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-comment">-- nth argument, and there's nothing more important after, then we</span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-comment">-- duplicate the subsequent overlapping clauses with c's RHS</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-comment">-- instead.</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)) -&gt; Cl)
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
-&gt; Cls
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl
-&gt; ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)) -&gt; Cl
</span><a href="#local-6989586621682209117"><span class="hs-identifier hs-var">expand</span></a></span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209110"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
</span><a href="#local-6989586621682209118"><span class="hs-identifier hs-var">expansions</span></a></span><span> </span><span class="annot"><span class="annottext">Cls -&gt; Cls -&gt; Cls
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209110"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Cl -&gt; Cls -&gt; Cls
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Cls -&gt; Cls
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#expandCatchalls"><span class="hs-identifier hs-var">expandCatchalls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209113"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">Cls
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cls
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-comment">-- In case there is only one branch in the split tree, we expand all</span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-comment">-- catch-alls for this position</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-comment">-- The @expansions@ are collected from all the clauses @cs@ then.</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-comment">-- Note: @expansions@ could be empty, so we keep the orignal clause.</span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621682209108"><span class="annot"><span class="annottext">doExpand :: Cl -&gt; Cls
</span><a href="#local-6989586621682209108"><span class="hs-identifier hs-var hs-var">doExpand</span></a></span></span><span> </span><span id="local-6989586621682209119"><span class="annot"><span class="annottext">c :: Cl
</span><a href="#local-6989586621682209119"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209120"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209120"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Bool
</span><a href="#local-6989586621682209121"><span class="hs-identifier hs-var">exCatchallNth</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209120"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)) -&gt; Cl)
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
-&gt; Cls
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl
-&gt; ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)) -&gt; Cl
</span><a href="#local-6989586621682209117"><span class="hs-identifier hs-var">expand</span></a></span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209119"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
</span><a href="#local-6989586621682209118"><span class="hs-identifier hs-var">expansions</span></a></span><span> </span><span class="annot"><span class="annottext">Cls -&gt; Cls -&gt; Cls
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209119"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209119"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-comment">-- True if nth pattern is variable or there are less than n patterns.</span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621682209109"><span class="annot"><span class="annottext">isCatchallNth :: [Arg (Pattern' PatVarName)] -&gt; Bool
</span><a href="#local-6989586621682209109"><span class="hs-identifier hs-var hs-var">isCatchallNth</span></a></span></span><span> </span><span id="local-6989586621682209122"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209122"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Bool)
-&gt; [Arg (Pattern' PatVarName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern' PatVarName -&gt; Bool
forall a. Pattern' a -&gt; Bool
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' PatVarName -&gt; Bool)
-&gt; (Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; Arg (Pattern' PatVarName)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; Bool)
-&gt; [Arg (Pattern' PatVarName)] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)])
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209122"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- True if nth pattern exists and is variable.</span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621682209121"><span class="annot"><span class="annottext">exCatchallNth :: [Arg (Pattern' PatVarName)] -&gt; Bool
</span><a href="#local-6989586621682209121"><span class="hs-identifier hs-var hs-var">exCatchallNth</span></a></span></span><span> </span><span id="local-6989586621682209124"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209124"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Bool)
-&gt; [Arg (Pattern' PatVarName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern' PatVarName -&gt; Bool
forall a. Pattern' a -&gt; Bool
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' PatVarName -&gt; Bool)
-&gt; (Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; Arg (Pattern' PatVarName)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; Bool)
-&gt; [Arg (Pattern' PatVarName)] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)])
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209124"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621682209128"><span class="annot"><span class="annottext">classify :: Pattern' x -&gt; Either Literal (Either ConHead QName)
</span><a href="#local-6989586621682209128"><span class="hs-identifier hs-var hs-var">classify</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209129"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209129"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Either Literal (Either ConHead QName)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209129"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><a href="#local-6989586621682209128"><span class="hs-identifier hs-var">classify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682209130"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209130"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either ConHead QName -&gt; Either Literal (Either ConHead QName)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; Either ConHead QName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209130"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><a href="#local-6989586621682209128"><span class="hs-identifier hs-var">classify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682209131"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209131"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' x)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either ConHead QName -&gt; Either Literal (Either ConHead QName)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Either ConHead QName
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209131"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><a href="#local-6989586621682209128"><span class="hs-identifier hs-var">classify</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' x
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Literal (Either ConHead QName)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621682209116"><span class="annot"><span class="annottext">isDefPNth :: Cl -&gt; Bool
</span><a href="#local-6989586621682209116"><span class="hs-identifier hs-var hs-var">isDefPNth</span></a></span></span><span> </span><span id="local-6989586621682209132"><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209132"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; Maybe (Arg (Pattern' PatVarName)) -&gt; Maybe (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Maybe (Arg (Pattern' PatVarName))
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cl -&gt; [Arg (Pattern' PatVarName)]
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clPats"><span class="hs-identifier hs-var">clPats</span></a></span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209132"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Pattern' PatVarName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">-- All non-catch-all patterns following this one (at position n).</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- These are the cases the wildcard needs to be expanded into.</span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621682209118"><span class="annot"><span class="annottext">expansions :: [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
</span><a href="#local-6989586621682209118"><span class="hs-identifier hs-var hs-var">expansions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
 -&gt; Either Literal (Either ConHead QName))
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier hs-var">nubOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern' PatVarName -&gt; Either Literal (Either ConHead QName)
forall {x}. Pattern' x -&gt; Either Literal (Either ConHead QName)
</span><a href="#local-6989586621682209128"><span class="hs-identifier hs-var">classify</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' PatVarName -&gt; Either Literal (Either ConHead QName))
-&gt; (([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
    -&gt; Pattern' PatVarName)
-&gt; ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
-&gt; Either Literal (Either ConHead QName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName)
-&gt; (([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
    -&gt; Arg (Pattern' PatVarName))
-&gt; ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
-&gt; Pattern' PatVarName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
-&gt; Arg (Pattern' PatVarName)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>               </span><span class="annot"><span class="annottext">([([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
 -&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))])
-&gt; (Cls
    -&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))])
-&gt; Cls
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Cl
 -&gt; Maybe ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)))
-&gt; Cls
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; Maybe ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
</span><a href="#local-6989586621682209135"><span class="hs-identifier hs-var">notVarNth</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)]
 -&gt; Maybe ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)))
-&gt; (Cl -&gt; [Arg (Pattern' PatVarName)])
-&gt; Cl
-&gt; Maybe ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Cl -&gt; [Arg (Pattern' PatVarName)]
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#clPats"><span class="hs-identifier hs-var">clPats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>               </span><span class="annot"><span class="annottext">(Cls -&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))])
-&gt; Cls
-&gt; [([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cls
</span><a href="#local-6989586621682209107"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><a href="#local-6989586621682209135"><span class="hs-identifier hs-type">notVarNth</span></a></span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- First @n@ patterns.</span><span>
</span><span id="line-383"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- @n+1@st pattern, not a variable</span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621682209135"><span class="annot"><span class="annottext">notVarNth :: [Arg (Pattern' PatVarName)]
-&gt; Maybe ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName))
</span><a href="#local-6989586621682209135"><span class="hs-identifier hs-var hs-var">notVarNth</span></a></span></span><span> </span><span id="local-6989586621682209136"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209136"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682209137"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209137"><span class="hs-identifier hs-var hs-var">ps1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682209138"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209138"><span class="hs-identifier hs-var hs-var">ps2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Arg (Pattern' PatVarName)]
-&gt; ([Arg (Pattern' PatVarName)], [Arg (Pattern' PatVarName)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209136"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span id="local-6989586621682209139"><span class="annot"><a href="#local-6989586621682209139"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Maybe (Arg (Pattern' PatVarName))
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209138"><span class="hs-identifier hs-var">ps2</span></a></span><span>
</span><span id="line-387"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">guard</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#isVar"><span class="hs-identifier hs-type">isVar</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682209139"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-388"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682209137"><span class="hs-identifier hs-type">ps1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682209139"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621682209117"><span class="annot"><span class="annottext">expand :: Cl
-&gt; ([Arg (Pattern' PatVarName)], Arg (Pattern' PatVarName)) -&gt; Cl
</span><a href="#local-6989586621682209117"><span class="hs-identifier hs-var hs-var">expand</span></a></span></span><span> </span><span id="local-6989586621682209140"><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209140"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682209141"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209141"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682209142"><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><a href="#local-6989586621682209142"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; Pattern' PatVarName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><a href="#local-6989586621682209142"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682209143"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209143"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682209144"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209144"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span id="local-6989586621682209145"><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209145"><span class="hs-identifier hs-var">qs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209146"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209147"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209148"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><a href="#local-6989586621682209142"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
-&gt; Pattern' PatVarName -&gt; Arg (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConHead
-&gt; ConPatternInfo
-&gt; [NamedArg (Pattern' PatVarName)]
-&gt; Pattern' PatVarName
forall x.
ConHead -&gt; ConPatternInfo -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-var">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209143"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209144"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209150"><span class="hs-identifier hs-var">conPArgs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209151"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SubstArg (Maybe Term) -&gt; Maybe Term -&gt; Maybe Term
forall a. Subst a =&gt; Int -&gt; Int -&gt; SubstArg a -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#substBody"><span class="hs-identifier hs-var">substBody</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209153"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209154"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682209143"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682209156"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; [Arg Term] -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682209158"><span class="hs-identifier hs-var">conArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209159"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-395"></span><span>            </span><span id="local-6989586621682209156"><span class="annot"><span class="annottext">ci :: ConInfo
</span><a href="#local-6989586621682209156"><span class="hs-identifier hs-var hs-var">ci</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConPatternInfo -&gt; ConInfo
</span><a href="Agda.Syntax.Internal.html#fromConPatternInfo"><span class="hs-identifier hs-var">fromConPatternInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682209144"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span id="local-6989586621682209154"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621682209154"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209145"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-comment">-- replace all direct subpatterns of q by _</span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-comment">-- TODO Andrea: might need these to sometimes be IApply?</span><span>
</span><span id="line-399"></span><span>            </span><span id="local-6989586621682209150"><span class="annot"><span class="annottext">conPArgs :: [NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209150"><span class="hs-identifier hs-var hs-var">conPArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' PatVarName) -&gt; NamedArg (Pattern' PatVarName))
-&gt; [NamedArg (Pattern' PatVarName)]
-&gt; [NamedArg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName (Pattern' PatVarName)
 -&gt; Named NamedName (Pattern' PatVarName))
-&gt; NamedArg (Pattern' PatVarName) -&gt; NamedArg (Pattern' PatVarName)
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Named NamedName (Pattern' PatVarName)
-&gt; Pattern' PatVarName -&gt; Named NamedName (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatVarName -&gt; Pattern' PatVarName
forall a. a -&gt; Pattern' a
</span><a href="Agda.Syntax.Internal.html#varP"><span class="hs-identifier hs-var">varP</span></a></span><span> </span><span class="annot"><span class="annottext">PatVarName
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209145"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-400"></span><span>            </span><span id="local-6989586621682209158"><span class="annot"><span class="annottext">conArgs :: [Arg Term]
</span><a href="#local-6989586621682209158"><span class="hs-identifier hs-var hs-var">conArgs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' PatVarName) -&gt; Int -&gt; Arg Term)
-&gt; [NamedArg (Pattern' PatVarName)] -&gt; [Int] -&gt; [Arg Term]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682209162"><span class="annot"><span class="annottext">NamedArg (Pattern' PatVarName)
</span><a href="#local-6989586621682209162"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span id="local-6989586621682209163"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209163"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' PatVarName)
</span><a href="#local-6989586621682209162"><span class="hs-identifier hs-var">q'</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' PatVarName) -&gt; Term -&gt; Arg Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209163"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209145"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Arg Term]) -&gt; [Int] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209154"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-type">LitP</span></a></span><span> </span><span id="local-6989586621682209166"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682209166"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682209167"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209167"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209146"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209147"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209148"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><a href="#local-6989586621682209142"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
-&gt; Pattern' PatVarName -&gt; Arg (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo -&gt; Literal -&gt; Pattern' PatVarName
forall x. PatternInfo -&gt; Literal -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#LitP"><span class="hs-identifier hs-var">LitP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682209166"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209167"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209151"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SubstArg (Maybe Term) -&gt; Maybe Term -&gt; Maybe Term
forall a. Subst a =&gt; Int -&gt; Int -&gt; SubstArg a -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#substBody"><span class="hs-identifier hs-var">substBody</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209153"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682209167"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209159"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-type">DefP</span></a></span><span> </span><span id="local-6989586621682209169"><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682209169"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682209170"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209170"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682209171"><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209171"><span class="hs-identifier hs-var">qs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209146"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209147"><span class="hs-identifier hs-var">mr</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209148"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><a href="#local-6989586621682209142"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
-&gt; Pattern' PatVarName -&gt; Arg (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatternInfo
-&gt; QName -&gt; [NamedArg (Pattern' PatVarName)] -&gt; Pattern' PatVarName
forall x.
PatternInfo -&gt; QName -&gt; [NamedArg (Pattern' x)] -&gt; Pattern' x
</span><a href="Agda.Syntax.Internal.html#DefP"><span class="hs-identifier hs-var">DefP</span></a></span><span> </span><span class="annot"><span class="annottext">PatternInfo
</span><a href="#local-6989586621682209169"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209170"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209172"><span class="hs-identifier hs-var">conPArgs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209151"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SubstArg (Maybe Term) -&gt; Maybe Term -&gt; Maybe Term
forall a. Subst a =&gt; Int -&gt; Int -&gt; SubstArg a -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#substBody"><span class="hs-identifier hs-var">substBody</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209153"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209173"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682209170"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim) -&gt; [Arg Term] -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682209175"><span class="hs-identifier hs-var">conArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209159"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>            </span><span id="local-6989586621682209173"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621682209173"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209171"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-406"></span><span>            </span><span class="hs-comment">-- replace all direct subpatterns of q by _</span><span>
</span><span id="line-407"></span><span>            </span><span id="local-6989586621682209172"><span class="annot"><span class="annottext">conPArgs :: [NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209172"><span class="hs-identifier hs-var hs-var">conPArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' PatVarName) -&gt; NamedArg (Pattern' PatVarName))
-&gt; [NamedArg (Pattern' PatVarName)]
-&gt; [NamedArg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Named NamedName (Pattern' PatVarName)
 -&gt; Named NamedName (Pattern' PatVarName))
-&gt; NamedArg (Pattern' PatVarName) -&gt; NamedArg (Pattern' PatVarName)
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Named NamedName (Pattern' PatVarName)
-&gt; Pattern' PatVarName -&gt; Named NamedName (Pattern' PatVarName)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatVarName -&gt; Pattern' PatVarName
forall a. a -&gt; Pattern' a
</span><a href="Agda.Syntax.Internal.html#varP"><span class="hs-identifier hs-var">varP</span></a></span><span> </span><span class="annot"><span class="annottext">PatVarName
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209171"><span class="hs-identifier hs-var">qs'</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span id="local-6989586621682209175"><span class="annot"><span class="annottext">conArgs :: [Arg Term]
</span><a href="#local-6989586621682209175"><span class="hs-identifier hs-var hs-var">conArgs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' PatVarName) -&gt; Int -&gt; Arg Term)
-&gt; [NamedArg (Pattern' PatVarName)] -&gt; [Int] -&gt; [Arg Term]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682209176"><span class="annot"><span class="annottext">NamedArg (Pattern' PatVarName)
</span><a href="#local-6989586621682209176"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span id="local-6989586621682209177"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209177"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' PatVarName)
</span><a href="#local-6989586621682209176"><span class="hs-identifier hs-var">q'</span></a></span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' PatVarName) -&gt; Term -&gt; Arg Term
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209177"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209171"><span class="hs-identifier hs-var">qs'</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Arg Term]) -&gt; [Int] -&gt; [Arg Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209173"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="annottext">Pattern' PatVarName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cl
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-410"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-comment">-- Andreas, 2016-09-19 issue #2168</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-comment">-- Due to varying function arity, some clauses might be eta-contracted.</span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-comment">-- Thus, we eta-expand them.</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span id="local-6989586621682209146"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209146"><span class="hs-identifier hs-var">no</span></a></span></span><span> </span><span id="local-6989586621682209147"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209147"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682209178"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209178"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682209159"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209159"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [ArgInfo] -&gt; Cl -&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#ensureNPatterns"><span class="hs-identifier hs-var">ensureNPatterns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg (Pattern' PatVarName) -&gt; ArgInfo)
-&gt; [Arg (Pattern' PatVarName)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName) -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' PatVarName)] -&gt; [ArgInfo])
-&gt; [Arg (Pattern' PatVarName)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209141"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><a href="#local-6989586621682209142"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209140"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-comment">-- The following pattern match cannot fail (by construction of @ps@).</span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682209148"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209148"><span class="hs-identifier hs-var">ps0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arg (Pattern' PatVarName)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682209151"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209151"><span class="hs-identifier hs-var">ps1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Arg (Pattern' PatVarName)]
-&gt; ([Arg (Pattern' PatVarName)], [Arg (Pattern' PatVarName)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209106"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209178"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span>        </span><span id="local-6989586621682209153"><span class="annot"><span class="annottext">n' :: Int
</span><a href="#local-6989586621682209153"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Int
forall a. CountPatternVars a =&gt; a -&gt; Int
</span><a href="Agda.Syntax.Internal.Pattern.html#countPatternVars"><span class="hs-identifier hs-var">countPatternVars</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209151"><span class="hs-identifier hs-var">ps1</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- | Make sure (by eta-expansion) that clause has arity at least @n@</span><span>
</span><span id="line-421"></span><span class="hs-comment">--   where @n@ is also the length of the provided list.</span><span>
</span><span id="line-422"></span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#ensureNPatterns"><span class="hs-identifier hs-type">ensureNPatterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span>
</span><span id="line-423"></span><span id="ensureNPatterns"><span class="annot"><span class="annottext">ensureNPatterns :: Int -&gt; [ArgInfo] -&gt; Cl -&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#ensureNPatterns"><span class="hs-identifier hs-var hs-var">ensureNPatterns</span></a></span></span><span> </span><span id="local-6989586621682209183"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209183"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682209184"><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682209184"><span class="hs-identifier hs-var">ais0</span></a></span></span><span> </span><span id="local-6989586621682209185"><span class="annot"><span class="annottext">cl :: Cl
</span><a href="#local-6989586621682209185"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-type">Cl</span></a></span><span> </span><span id="local-6989586621682209186"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209186"><span class="hs-identifier hs-var">no</span></a></span></span><span> </span><span id="local-6989586621682209187"><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209187"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span id="local-6989586621682209188"><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209188"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682209189"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209189"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209190"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cl
</span><a href="#local-6989586621682209185"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ClauseRecursive
-&gt; [Arg (Pattern' PatVarName)]
-&gt; Maybe Term
-&gt; Cl
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#Cl"><span class="hs-identifier hs-var">Cl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209186"><span class="hs-identifier hs-var">no</span></a></span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="#local-6989586621682209187"><span class="hs-identifier hs-var">mr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209188"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
-&gt; [Arg (Pattern' PatVarName)] -&gt; [Arg (Pattern' PatVarName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209192"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Term -&gt; Maybe Term
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209190"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682209189"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; [Arg Term] -&gt; Maybe Term
forall t. Apply t =&gt; t -&gt; [Arg Term] -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682209195"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-427"></span><span>  </span><span id="local-6989586621682209196"><span class="annot"><span class="annottext">k :: Int
</span><a href="#local-6989586621682209196"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209188"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span id="local-6989586621682209197"><span class="annot"><span class="annottext">ais :: [ArgInfo]
</span><a href="#local-6989586621682209197"><span class="hs-identifier hs-var hs-var">ais</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [ArgInfo] -&gt; [ArgInfo]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209196"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682209184"><span class="hs-identifier hs-var">ais0</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-comment">-- m = Number of arguments to add</span><span>
</span><span id="line-430"></span><span>  </span><span id="local-6989586621682209190"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621682209190"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209183"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209196"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-431"></span><span>  </span><span id="local-6989586621682209192"><span class="annot"><span class="annottext">ps' :: [Arg (Pattern' PatVarName)]
</span><a href="#local-6989586621682209192"><span class="hs-identifier hs-var hs-var">ps'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
-&gt; (ArgInfo -&gt; Arg (Pattern' PatVarName))
-&gt; [Arg (Pattern' PatVarName)]
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682209197"><span class="hs-identifier hs-var">ais</span></a></span><span> </span><span class="annot"><span class="annottext">((ArgInfo -&gt; Arg (Pattern' PatVarName))
 -&gt; [Arg (Pattern' PatVarName)])
-&gt; (ArgInfo -&gt; Arg (Pattern' PatVarName))
-&gt; [Arg (Pattern' PatVarName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682209199"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682209199"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Pattern' PatVarName -&gt; Arg (Pattern' PatVarName)
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682209199"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' PatVarName -&gt; Arg (Pattern' PatVarName))
-&gt; Pattern' PatVarName -&gt; Arg (Pattern' PatVarName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatVarName -&gt; Pattern' PatVarName
forall a. a -&gt; Pattern' a
</span><a href="Agda.Syntax.Internal.html#varP"><span class="hs-identifier hs-var">varP</span></a></span><span> </span><span class="annot"><span class="annottext">PatVarName
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-432"></span><span>  </span><span id="local-6989586621682209195"><span class="annot"><span class="annottext">args :: [Arg Term]
</span><a href="#local-6989586621682209195"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ArgInfo -&gt; Arg Term) -&gt; [Int] -&gt; [ArgInfo] -&gt; [Arg Term]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682209200"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209200"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682209201"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682209201"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682209201"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; Term -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209200"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209190"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621682209197"><span class="hs-identifier hs-var">ais</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span id="local-6989586621682208472"><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#substBody"><span class="hs-identifier hs-type">substBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#SubstArg"><span class="hs-identifier hs-type">SubstArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682208472"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-435"></span><span id="substBody"><span class="annot"><span class="annottext">substBody :: forall a. Subst a =&gt; Int -&gt; Int -&gt; SubstArg a -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.CompiledClause.Compile.html#substBody"><span class="hs-identifier hs-var hs-var">substBody</span></a></span></span><span> </span><span id="local-6989586621682209204"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209204"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682209205"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209205"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682209206"><span class="annot"><span class="annottext">SubstArg a
</span><a href="#local-6989586621682209206"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg a) -&gt; a -&gt; a
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(Substitution' (SubstArg a) -&gt; a -&gt; a)
-&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution' (SubstArg a) -&gt; Substitution' (SubstArg a)
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209204"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Substitution' (SubstArg a) -&gt; Substitution' (SubstArg a))
-&gt; Substitution' (SubstArg a) -&gt; Substitution' (SubstArg a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubstArg a
</span><a href="#local-6989586621682209206"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SubstArg a
-&gt; Substitution' (SubstArg a) -&gt; Substitution' (SubstArg a)
forall a. a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.Syntax.Internal.html#%3A%23"><span class="hs-operator hs-var">:#</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution' (SubstArg a)
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682209205"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682208495"><span id="local-6989586621682209212"><span class="annot"><a href="Agda.TypeChecking.Free.Precompute.html#PrecomputeFreeVars"><span class="hs-identifier hs-type">PrecomputeFreeVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208495"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Precompute.html#PrecomputeFreeVars"><span class="hs-identifier hs-type">PrecomputeFreeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses%27"><span class="hs-identifier hs-type">CompiledClauses'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682208495"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span></pre></body></html>