<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | General functions for stateful manipulation of the scope.</span></span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- This module has been originally created to avoid import cycles between</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Agda.Syntax.Scope.Monad and Agda.Syntax.Scope.UnusedImports.</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.State.html"><span class="hs-identifier">Agda.Syntax.Scope.State</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#SetRange"><span class="hs-identifier">SetRange</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier">setRange</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier">noRange</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier">scopeCurrent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Base</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier">TCM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier">MonadTCState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier">ReadTCState</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html"><span class="hs-identifier">Agda.TypeChecking.Monad.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier">useScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier">modifyScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#recomputeInverseScope"><span class="hs-identifier">recomputeInverseScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier">set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadTrans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-19"></span><span class="annot"><span class="hs-comment">-- * The scope checking monad</span></span><span>
</span><span id="line-20"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | To simplify interaction between scope checking and type checking (in</span><span>
</span><span id="line-23"></span><span class="hs-comment">--   particular when chasing imports), we use the same monad.</span><span>
</span><span id="line-24"></span><span class="hs-keyword">type</span><span> </span><span id="ScopeM"><span class="annot"><a href="Agda.Syntax.Scope.State.html#ScopeM"><span class="hs-identifier hs-var">ScopeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- * Current module</span></span><span>
</span><span id="line-28"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span id="local-6989586621681946995"><span class="annot"><a href="Agda.Syntax.Scope.State.html#getCurrentModule"><span class="hs-identifier hs-type">getCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681946995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681946995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span></span><span>
</span><span id="line-31"></span><span id="getCurrentModule"><span class="annot"><span class="annottext">getCurrentModule :: forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.State.html#getCurrentModule"><span class="hs-identifier hs-var hs-var">getCurrentModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; ModuleName -&gt; ModuleName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; ModuleName) -&gt; m ModuleName -&gt; m ModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ScopeInfo ModuleName -&gt; m ModuleName
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' ScopeInfo a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; f ModuleName) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' ScopeInfo ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier hs-var">scopeCurrent</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span id="local-6989586621681947015"><span class="annot"><a href="Agda.Syntax.Scope.State.html#setCurrentModule"><span class="hs-identifier hs-type">setCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947015"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681947015"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-34"></span><span id="setCurrentModule"><span class="annot"><span class="annottext">setCurrentModule :: forall (m :: * -&gt; *). MonadTCState m =&gt; ModuleName -&gt; m ()
</span><a href="Agda.Syntax.Scope.State.html#setCurrentModule"><span class="hs-identifier hs-var hs-var">setCurrentModule</span></a></span></span><span> </span><span id="local-6989586621681947079"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681947079"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-var">modifyScope</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; m ())
-&gt; (ScopeInfo -&gt; ScopeInfo) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' ScopeInfo ModuleName -&gt; LensSet ScopeInfo ModuleName
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; f ModuleName) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' ScopeInfo ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier hs-var">scopeCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681947079"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). MonadTCState m =&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#recomputeInverseScope"><span class="hs-identifier hs-var">recomputeInverseScope</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span id="local-6989586621681947029"><span id="local-6989586621681947030"><span class="annot"><a href="Agda.Syntax.Scope.State.html#withCurrentModule"><span class="hs-identifier hs-type">withCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947029"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947029"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681947029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947030"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681947029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947030"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-39"></span><span id="withCurrentModule"><span class="annot"><span class="annottext">withCurrentModule :: forall (m :: * -&gt; *) a.
(ReadTCState m, MonadTCState m) =&gt;
ModuleName -&gt; m a -&gt; m a
</span><a href="Agda.Syntax.Scope.State.html#withCurrentModule"><span class="hs-identifier hs-var hs-var">withCurrentModule</span></a></span></span><span> </span><span id="local-6989586621681947094"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681947094"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621681947095"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681947095"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-40"></span><span>  </span><span id="local-6989586621681947096"><span class="annot"><a href="#local-6989586621681947096"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.State.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#setCurrentModule"><span class="hs-identifier hs-type">setCurrentModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947094"><span class="hs-identifier hs-type">new</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span id="local-6989586621681947097"><span class="annot"><a href="#local-6989586621681947097"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621681947095"><span class="hs-identifier hs-type">action</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#setCurrentModule"><span class="hs-identifier hs-type">setCurrentModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947096"><span class="hs-identifier hs-type">old</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681947097"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span id="local-6989586621681947034"><span id="local-6989586621681947037"><span class="annot"><a href="Agda.Syntax.Scope.State.html#withCurrentModule%27"><span class="hs-identifier hs-type">withCurrentModule'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621681947034"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681947034"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681947034"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947037"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681947034"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947037"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-47"></span><span id="withCurrentModule%27"><span class="annot"><span class="annottext">withCurrentModule' :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(MonadTrans t, Monad (t ScopeM)) =&gt;
ModuleName -&gt; t ScopeM a -&gt; t ScopeM a
</span><a href="Agda.Syntax.Scope.State.html#withCurrentModule%27"><span class="hs-identifier hs-var hs-var">withCurrentModule'</span></a></span></span><span> </span><span id="local-6989586621681947122"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681947122"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621681947123"><span class="annot"><span class="annottext">t ScopeM a
</span><a href="#local-6989586621681947123"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621681947124"><span class="annot"><a href="#local-6989586621681947124"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName -&gt; t ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.State.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#setCurrentModule"><span class="hs-identifier hs-type">setCurrentModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947122"><span class="hs-identifier hs-type">new</span></a></span><span>
</span><span id="line-50"></span><span>  </span><span id="local-6989586621681947125"><span class="annot"><a href="#local-6989586621681947125"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621681947123"><span class="hs-identifier hs-type">action</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.State.html#setCurrentModule"><span class="hs-identifier hs-type">setCurrentModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681947124"><span class="hs-identifier hs-type">old</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621681947125"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-53"></span></pre></body></html>